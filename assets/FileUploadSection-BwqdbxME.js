const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B1-1bjJO.js","assets/ui-B5h6-wmd.js","assets/vendor-BFl3bqVE.js","assets/firebase-CiLlnz7t.js","assets/index-BA2bQjcR.css"])))=>i.map(i=>d[i]);
var tr=Object.defineProperty;var rr=(b,d,p)=>d in b?tr(b,d,{enumerable:!0,configurable:!0,writable:!0,value:p}):b[d]=p;var At=(b,d,p)=>rr(b,typeof d!="symbol"?d+"":d,p);import{h as nr,i as ir,p as sr,_ as Xe,b as re,s as H,c as W,t as G,R as or,a as It,v as mt}from"./index-B1-1bjJO.js";import{t as Rt,P as ar,y as ft,h as ve,z as Ee,e as pe,i as Oe,R as qe,D as Re,B as Ve,A as Ne,f as Ke,E as Ct,q as et,u as tt,L as kt,w as Mt,x as Tt}from"./firebase-CiLlnz7t.js";import{j as L,V as jt,W as lr,B as se,b_ as dr,T as ae,X as zt,Z as cr,a as rt,r as le,t as nt,I as He,c2 as fr,c3 as Dt,b7 as _t,a7 as St,aJ as Lt,al as Pt,A as Bt,G as Ft,E as ur,bT as hr,H as gr,z as pr,ac as mr,bR as br,a8 as Ot,aU as yr,aK as bt,a0 as xr,a1 as vr,by as wr,a2 as Ar,bU as Ir,v as Cr,bV as Dr,bW as _r,at as Ut,bX as Sr,bY as Fr}from"./ui-B5h6-wmd.js";import Ye from"./purify.es-CQJ0hv7W.js";const We=b=>b?b instanceof Rt||b.toDate&&typeof b.toDate=="function"?b.toDate():b.seconds?new Date(b.seconds*1e3):new Date:new Date,ut={courseId:null,searchQuery:"",dateRange:{start:null,end:null},nodeTypes:{designs:!0,builds:!0,tests:!0}},ht={x:0,y:0,zoom:1},Vr=nr()(ir(sr((b,d)=>({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,layoutType:"horizontal",viewMode:"graph",isExpanded:!1,deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null},filters:ut,viewport:ht,fetchAllData:async(p,i=!1,e=[])=>{b({isLoading:!0,error:null});try{const{collection:t,query:l,where:o,getDocs:y,orderBy:v}=await Xe(async()=>{const{collection:R,query:F,where:D,getDocs:j,orderBy:h}=await import("./firebase-CiLlnz7t.js").then(U=>U.N);return{collection:R,query:F,where:D,getDocs:j,orderBy:h}},[]),{db:n}=await Xe(async()=>{const{db:R}=await import("./index-B1-1bjJO.js").then(F=>F.G);return{db:R}},__vite__mapDeps([0,1,2,3,4]));let s;if(i&&e.length>0){const{doc:R,getDoc:F}=await Xe(async()=>{const{doc:f,getDoc:w}=await import("./firebase-CiLlnz7t.js").then(I=>I.N);return{doc:f,getDoc:w}},[]),D=await F(R(n,"users",p)),j=D.exists()?D.data():null,h=(j==null?void 0:j.classes)||{},U=Object.entries(h).filter(([f,w])=>w.isCourseAdmin).map(([f,w])=>f),u=Object.entries(h).filter(([f,w])=>!w.isCourseAdmin).map(([f,w])=>f);if(U.length>0&&u.length>0){const f=l(t(n,"designs"),o("course","in",U),v("dateCreated","desc")),w=l(t(n,"designs"),o("course","in",u),o("userId","==",p),v("dateCreated","desc")),[I,C]=await Promise.all([y(f),y(w)]),S=I.docs.map(O=>({id:O.id,...O.data()})),A=C.docs.map(O=>({id:O.id,...O.data()})),g=[...S,...A].map(O=>({id:O.id,title:O.title||"",description:O.description||"",course:O.course||"",dateCreated:O.dateCreated,dateModified:O.dateModified,userId:O.userId||"",images:O.images||[],files:O.files||[]})),c=g.map(O=>O.id);let z=[];if(c.length>0){const O=[];for(let $=0;$<c.length;$+=10){const B=c.slice($,$+10),T=l(t(n,"builds"),o("design_ID","in",B));O.push(y(T))}z=(await Promise.all(O)).flatMap($=>$.docs.map(B=>{const T=B.data();return{id:B.id,title:T.title||"",description:T.description||"",design_ID:T.design_ID||"",dateCreated:T.dateCreated,userId:T.userId||"",images:T.images||[],files:T.files||[],dataAnalysis:T.dataAnalysis}}))}const E=z.map(O=>O.id);let P=[];if(E.length>0){const O=[];for(let $=0;$<E.length;$+=10){const B=E.slice($,$+10),T=l(t(n,"tests"),o("build_ID","in",B));O.push(y(T))}P=(await Promise.all(O)).flatMap($=>$.docs.map(B=>{const T=B.data();return{id:B.id,title:T.title||"",description:T.description||"",build_ID:T.build_ID||"",dateCreated:T.dateCreated,userId:T.userId||"",images:T.images||[],files:T.files||[],dataAnalysis:T.dataAnalysis}}))}b({designs:g,builds:z,tests:P,isLoading:!1});return}else U.length>0?s=l(t(n,"designs"),o("course","in",U),v("dateCreated","desc")):s=l(t(n,"designs"),o("course","in",u),o("userId","==",p),v("dateCreated","desc"))}else s=l(t(n,"designs"),o("userId","==",p),v("dateCreated","desc"));const a=(await y(s)).docs.map(R=>{const F=R.data();return{id:R.id,title:F.title||"",description:F.description||"",course:F.course||"",dateCreated:F.dateCreated,dateModified:F.dateModified,userId:F.userId||"",images:F.images||[],files:F.files||[],dataAnalysis:F.dataAnalysis}}),m=a.map(R=>R.id);let _=[];if(m.length>0){const R=[];for(let D=0;D<m.length;D+=10){const j=m.slice(D,D+10),h=l(t(n,"builds"),o("design_ID","in",j));R.push(y(h))}_=(await Promise.all(R)).flatMap(D=>D.docs.map(j=>{const h=j.data();return{id:j.id,title:h.title||"",description:h.description||"",design_ID:h.design_ID||"",dateCreated:h.dateCreated,userId:h.userId||"",images:h.images||[],files:h.files||[],dataAnalysis:h.dataAnalysis}}))}const M=_.map(R=>R.id);let x=[];if(M.length>0){const R=[];for(let D=0;D<M.length;D+=10){const j=M.slice(D,D+10),h=l(t(n,"tests"),o("build_ID","in",j));R.push(y(h))}x=(await Promise.all(R)).flatMap(D=>D.docs.map(j=>{const h=j.data();return{id:j.id,title:h.title||"",description:h.description||"",results:h.results||"",conclusions:h.conclusions||"",build_ID:h.build_ID||"",design_ID:h.design_ID||"",dateCreated:h.dateCreated,userId:h.userId||"",images:h.images||[],files:h.files||[],dataAnalysis:h.dataAnalysis}}))}b({designs:a,builds:_,tests:x,isLoading:!1}),d().buildGraph()}catch(t){console.error("Error fetching lab notebook data:",t);const l=t instanceof Error?t.message:String(t),o=l.includes("permission")||l.includes("insufficient")||l.includes("PERMISSION_DENIED");b({error:o?"Database permissions not configured. Please contact your administrator or deploy Firebase security rules. See docs/FIREBASE_RULES_SETUP.md for instructions.":t instanceof Error?t.message:"Failed to fetch data",isLoading:!1})}},setDesigns:p=>{b({designs:p}),d().buildGraph()},addDesign:p=>{b(i=>({designs:[...i.designs,p]})),d().buildGraph()},updateDesignLocal:(p,i)=>{b(e=>({designs:e.designs.map(t=>t.id===p?{...t,...i}:t)})),d().buildGraph()},removeDesign:p=>{b(i=>({designs:i.designs.filter(e=>e.id!==p),builds:i.builds.filter(e=>e.design_ID!==p),tests:i.tests.filter(e=>e.design_ID!==p)})),d().buildGraph()},setBuilds:p=>{b({builds:p}),d().buildGraph()},addBuild:p=>{b(i=>({builds:[...i.builds,p]})),d().buildGraph()},updateBuildLocal:(p,i)=>{b(e=>({builds:e.builds.map(t=>t.id===p?{...t,...i}:t)})),d().buildGraph()},removeBuild:p=>{b(i=>({builds:i.builds.filter(e=>e.id!==p),tests:i.tests.filter(e=>e.build_ID!==p)})),d().buildGraph()},setTests:p=>{b({tests:p}),d().buildGraph()},addTest:p=>{b(i=>({tests:[...i.tests,p]})),d().buildGraph()},updateTestLocal:(p,i)=>{b(e=>({tests:e.tests.map(t=>t.id===p?{...t,...i}:t)})),d().buildGraph()},removeTest:p=>{b(i=>({tests:i.tests.filter(e=>e.id!==p)})),d().buildGraph()},buildGraph:()=>{const p=d(),{designs:i,builds:e,tests:t,filters:l}=p;let o=i,y=e,v=t;if(l.courseId){o=o.filter(m=>m.course===l.courseId);const r=o.map(m=>m.id);y=y.filter(m=>r.includes(m.design_ID));const a=y.map(m=>m.id);v=v.filter(m=>a.includes(m.build_ID))}if(l.searchQuery){const r=l.searchQuery.toLowerCase();o=o.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r)),y=y.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r)),v=v.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r))}l.nodeTypes.designs||(o=[]),l.nodeTypes.builds||(y=[]),l.nodeTypes.tests||(v=[]);const n=[],s=[];o.forEach((r,a)=>{const m=y.filter(x=>x.design_ID===r.id).length,_=v.filter(x=>x.design_ID===r.id).length,M={type:"design",designId:r.id,label:r.title,title:r.title,description:r.description,dateCreated:We(r.dateCreated),dateModified:We(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],course:r.course,buildCount:m,testCount:_,dataAnalysis:r.dataAnalysis};r.dataAnalysis&&console.log(`Design ${r.id} has dataAnalysis:`,r.dataAnalysis),n.push({id:`design-${r.id}`,type:"designNode",position:{x:0,y:a*200},data:M})}),y.forEach((r,a)=>{const m=v.filter(_=>_.build_ID===r.id).length;n.push({id:`build-${r.id}`,type:"buildNode",position:{x:400,y:a*180},data:{type:"build",buildId:r.id,designId:r.design_ID,label:r.title,title:r.title,description:r.description,dateCreated:We(r.dateCreated),dateModified:We(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],testCount:m,dataAnalysis:r.dataAnalysis}}),s.push({id:`edge-design-${r.design_ID}-build-${r.id}`,source:`design-${r.design_ID}`,target:`build-${r.id}`,type:"smoothstep",animated:!1})}),v.forEach((r,a)=>{n.push({id:`test-${r.id}`,type:"testNode",position:{x:800,y:a*180},data:{type:"test",testId:r.id,buildId:r.build_ID,designId:r.design_ID,label:r.title,title:r.title,description:r.description,results:r.results,conclusions:r.conclusions,dateCreated:We(r.dateCreated),dateModified:We(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],dataAnalysis:r.dataAnalysis}}),s.push({id:`edge-build-${r.build_ID}-test-${r.id}`,source:`build-${r.build_ID}`,target:`test-${r.id}`,type:"smoothstep",animated:!1})}),b({nodes:n,edges:s})},selectNode:p=>{b({selectedNodeId:p}),p&&b({activePanel:"detail"})},setHoveredNode:p=>{b({hoveredNodeId:p})},updateNodePosition:(p,i)=>{b(e=>({nodes:e.nodes.map(t=>t.id===p?{...t,position:i}:t)}))},resetGraph:()=>{b({nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null})},setLoading:p=>b({isLoading:p}),setError:p=>b({error:p}),setActivePanel:p=>b({activePanel:p}),setLayoutType:p=>b({layoutType:p}),setViewMode:p=>b({viewMode:p}),setIsExpanded:p=>b({isExpanded:p}),openDeleteDialog:(p,i,e)=>b({deleteDialog:{open:!0,nodeId:p,nodeType:i,nodeName:e}}),closeDeleteDialog:()=>b({deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null}}),confirmDelete:async()=>{const p=d(),{nodeId:i,nodeType:e}=p.deleteDialog;if(!(!i||!e))try{const{labNotebookService:t}=await Xe(async()=>{const{labNotebookService:y}=await Promise.resolve().then(()=>Mr);return{labNotebookService:y}},void 0),l=p.nodes.find(y=>y.id.includes(i));if(!l)return;const o=l.data.userId;e==="build"?(await t.deleteBuild(i,o),d().removeBuild(i)):e==="test"&&(await t.deleteTest(i,o),d().removeTest(i)),d().closeDeleteDialog(),d().selectNode(null),d().setActivePanel(null),await d().fetchAllData(o,!1,[])}catch(t){console.error("Error deleting:",t),b({error:t instanceof Error?t.message:"Failed to delete"})}},setSelectedCourse:p=>{b(i=>({filters:{...i.filters,courseId:p}})),d().buildGraph()},setSearchQuery:p=>{b(i=>({filters:{...i.filters,searchQuery:p}})),d().buildGraph()},setDateRange:(p,i)=>{b(e=>({filters:{...e.filters,dateRange:{start:p,end:i}}})),d().buildGraph()},toggleNodeTypeFilter:p=>{b(i=>({filters:{...i.filters,nodeTypes:{...i.filters.nodeTypes,[p]:!i.filters.nodeTypes[p]}}})),d().buildGraph()},resetFilters:()=>{b({filters:ut}),d().buildGraph()},setViewport:p=>b({viewport:p}),resetViewport:()=>b({viewport:ht}),getGraphMetrics:()=>{const p=d();return{designCount:p.designs.length,buildCount:p.builds.length,testCount:p.tests.length,totalNodes:p.nodes.length,totalEdges:p.edges.length}},getNodeById:p=>d().nodes.find(i=>i.id===p),getDesignById:p=>d().designs.find(i=>i.id===p),getBuildById:p=>d().builds.find(i=>i.id===p),getTestById:p=>d().tests.find(i=>i.id===p),getBuildsByDesignId:p=>d().builds.filter(i=>i.design_ID===p),getTestsByBuildId:p=>d().tests.filter(i=>i.build_ID===p),reset:()=>{b({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,filters:ut,viewport:ht})}}),{name:"lab-notebook-storage",partialize:b=>({layoutType:b.layoutType,viewMode:b.viewMode,viewport:b.viewport})}),{name:"LabNotebookStore"}));function Ur(b){const{data:d,...p}=b;return p}function Kr(b){return b.type==="linear_regression"}function Zr(b){return b.type==="correlation"}function Xr(b){return b.type==="descriptive_stats"}function Yr(b){return b.type==="ml_classification"}function Jr(b){return b.type==="ml_regression"}function Er(b){return b.some(d=>Array.isArray(d))}function ke(b){if(b==null)return null;if(b instanceof Date)return Rt.fromDate(b);if(Array.isArray(b))return Er(b)?{_type:"nested_array",rows:b.map(d=>({values:Array.isArray(d)?d:[d]}))}:b.length>100?b.slice(0,100).map(d=>ke(d)):b.map(d=>ke(d));if(typeof b=="object"){const d={};for(const p in b)if(Object.prototype.hasOwnProperty.call(b,p)){const i=b[p];i!==void 0&&(d[p]=ke(i))}return d}return b}class Rr{constructor(){At(this,"db",null)}initialize(){this.db||(this.db=ar())}async createDesign(d){this.initialize();const p={title:d.title,description:d.description,course:d.course,userId:d.userId,dateCreated:ve(),dateModified:ve(),images:d.images||[],files:d.files||[]},i=await ft(Ee(this.db,"designs"),p);return console.log("Design created with ID:",i.id),i.id}async updateDesign(d){this.initialize();const p={dateModified:ve()};d.title!==void 0&&(p.title=d.title),d.description!==void 0&&(p.description=d.description),d.course!==void 0&&(p.course=d.course),d.images!==void 0&&(p.images=d.images),d.files!==void 0&&(p.files=d.files);const i=pe(this.db,"designs",d.id);await Oe(i,p),console.log("Design updated:",d.id)}async deleteDesign(d,p){this.initialize();const i=qe(Ee(this.db,"builds"),Re("design_ID","==",d),Re("userId","==",p)),e=await Ve(i);for(const t of e.docs){const l=t.id,o=qe(Ee(this.db,"tests"),Re("build_ID","==",l),Re("userId","==",p)),y=await Ve(o);for(const v of y.docs)await Ne(pe(this.db,"tests",v.id)),console.log("Test deleted:",v.id);await Ne(pe(this.db,"builds",l)),console.log("Build deleted:",l)}await Ne(pe(this.db,"designs",d)),console.log("Design deleted:",d)}async getDesign(d){this.initialize();const p=pe(this.db,"designs",d),i=await Ke(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",course:e.course||"",dateCreated:e.dateCreated,dateModified:e.dateModified,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async createBuild(d){this.initialize();const p={title:d.title,description:d.description,design_ID:d.designId,userId:d.userId,dateCreated:ve(),dateModified:ve(),images:d.images||[],files:d.files||[]},i=await ft(Ee(this.db,"builds"),p);return console.log("Build created with ID:",i.id),i.id}async updateBuild(d){this.initialize();const p={dateModified:ve()};d.title!==void 0&&(p.title=d.title),d.description!==void 0&&(p.description=d.description),d.images!==void 0&&(p.images=d.images),d.files!==void 0&&(p.files=d.files);const i=pe(this.db,"builds",d.id);await Oe(i,p),console.log("Build updated:",d.id)}async deleteBuild(d,p){this.initialize();const i=qe(Ee(this.db,"tests"),Re("build_ID","==",d),Re("userId","==",p)),e=await Ve(i);for(const t of e.docs)await Ne(pe(this.db,"tests",t.id)),console.log("Test deleted:",t.id);await Ne(pe(this.db,"builds",d)),console.log("Build deleted:",d)}async getBuild(d){this.initialize();const p=pe(this.db,"builds",d),i=await Ke(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",design_ID:e.design_ID||"",dateCreated:e.dateCreated,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async getBuildsByDesign(d){this.initialize();const p=qe(Ee(this.db,"builds"),Re("design_ID","==",d),Ct("dateCreated","desc"));return(await Ve(p)).docs.map(e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}})}async createTest(d){this.initialize();const p={title:d.title,description:d.description,results:d.results,conclusions:d.conclusions,build_ID:d.buildId,design_ID:d.designId,userId:d.userId,dateCreated:ve(),dateModified:ve(),images:d.images||[],files:d.files||[]},i=await ft(Ee(this.db,"tests"),p);return console.log("Test created with ID:",i.id),i.id}async updateTest(d){this.initialize();const p={dateModified:ve()};d.title!==void 0&&(p.title=d.title),d.description!==void 0&&(p.description=d.description),d.results!==void 0&&(p.results=d.results),d.conclusions!==void 0&&(p.conclusions=d.conclusions),d.images!==void 0&&(p.images=d.images),d.files!==void 0&&(p.files=d.files);const i=pe(this.db,"tests",d.id);await Oe(i,p),console.log("Test updated:",d.id)}async deleteTest(d,p){this.initialize(),await Ne(pe(this.db,"tests",d)),console.log("Test deleted:",d)}async getTest(d){this.initialize();const p=pe(this.db,"tests",d),i=await Ke(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",results:e.results||"",conclusions:e.conclusions||"",build_ID:e.build_ID||"",design_ID:e.design_ID||"",dateCreated:e.dateCreated,dateModified:e.dateModified,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async getTestsByBuild(d){this.initialize();const p=qe(Ee(this.db,"tests"),Re("build_ID","==",d),Ct("dateCreated","desc"));return(await Ve(p)).docs.map(e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",results:t.results||"",conclusions:t.conclusions||"",build_ID:t.build_ID||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}})}async updateDataAnalysis(d,p,i){this.initialize();const e=d==="design"?"designs":d==="build"?"builds":"tests",t=pe(this.db,e,p);await Oe(t,{dataAnalysis:ke(i),dateModified:ve()}),console.log(`Data analysis updated for ${d} ${p}`)}async addDataset(d,p,i){this.initialize();const e=d==="design"?"designs":d==="build"?"builds":"tests",t=pe(this.db,e,p),l=await Ke(t);if(!l.exists())throw new Error(`${d} with ID ${p} not found`);const y=l.data().dataAnalysis||{datasets:[],analyses:[]},v=Ur(i),n=ke(v);y.datasets.push(n),await Oe(t,{dataAnalysis:ke(y),dateModified:ve()}),console.log(`Dataset metadata added to ${d} ${p} (${i.rowCount} rows, ${(i.fileSize/1024).toFixed(1)} KB)`)}async addAnalysis(d,p,i){this.initialize();const e=d==="design"?"designs":d==="build"?"builds":"tests",t=pe(this.db,e,p),l=await Ke(t);if(!l.exists())throw new Error(`${d} with ID ${p} not found`);const y=l.data().dataAnalysis||{datasets:[],analyses:[]},v=ke(i);y.analyses.push(v),await Oe(t,{dataAnalysis:ke(y),dateModified:ve()}),console.log(`Analysis added to ${d} ${p}`)}}let gt=null;const Nt=()=>(gt||(gt=new Rr),gt),kr=Nt(),Mr=Object.freeze(Object.defineProperty({__proto__:null,getLabNotebookService:Nt,labNotebookService:kr},Symbol.toStringTag,{value:"Module"})),en=({open:b,title:d,message:p,confirmLabel:i="Confirm",cancelLabel:e="Cancel",onConfirm:t,onCancel:l,isDestructive:o=!1})=>L.jsxs(jt,{open:b,onClose:l,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:re.xl}},children:[L.jsx(lr,{children:L.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:H[2]},children:[o&&L.jsx(dr,{sx:{color:W.error,fontSize:28}}),L.jsx(ae,{variant:"h5",sx:{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.bold,color:W.text.primary},children:d})]})}),L.jsx(zt,{children:L.jsx(ae,{variant:"body1",sx:{color:W.text.secondary,lineHeight:G.lineHeight.relaxed},children:p})}),L.jsxs(cr,{sx:{p:H[3],gap:H[2]},children:[L.jsx(rt,{onClick:l,variant:"outlined",sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium},children:e}),L.jsx(rt,{onClick:t,variant:"contained",sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium,backgroundColor:o?W.error:W.primary[500],"&:hover":{backgroundColor:o?"#C62828":W.primary[600]}},children:i})]})]}),tn=({content:b,maxLines:d})=>{const p=Ye.sanitize(b||"");return L.jsx(se,{sx:{"& p":{margin:0,marginBottom:H[2],color:W.text.primary,fontSize:G.fontSize.base,fontFamily:G.fontFamily.secondary,lineHeight:1.6},"& p:last-child":{marginBottom:0},"& h1, & h2, & h3":{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.bold,color:W.text.primary,marginTop:H[3],marginBottom:H[2]},"& h1":{fontSize:G.fontSize["2xl"]},"& h2":{fontSize:G.fontSize.xl},"& h3":{fontSize:G.fontSize.lg},"& strong":{fontWeight:G.fontWeight.semibold},"& em":{fontStyle:"italic"},"& u":{textDecoration:"underline"},"& s":{textDecoration:"line-through"},"& a":{color:W.primary[500],textDecoration:"none","&:hover":{textDecoration:"underline"}},"& ul, & ol":{paddingLeft:H[6],marginBottom:H[2],fontFamily:G.fontFamily.secondary},"& li":{marginBottom:H[1],fontFamily:G.fontFamily.secondary},"& blockquote":{borderLeft:`4px solid ${W.primary[500]}`,paddingLeft:H[4],marginLeft:0,marginBottom:H[2],fontStyle:"italic",color:W.text.secondary,fontFamily:G.fontFamily.secondary},"& code":{backgroundColor:W.background.secondary,padding:`${H[.5]} ${H[1.5]}`,borderRadius:"4px",fontSize:G.fontSize.sm,fontFamily:"monospace"},"& pre":{backgroundColor:W.background.secondary,padding:H[3],borderRadius:"8px",overflow:"auto",marginBottom:H[2],"& code":{backgroundColor:"transparent",padding:0}},...d&&{display:"-webkit-box",WebkitLineClamp:d,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"}},dangerouslySetInnerHTML:{__html:p}})},rn=({value:b,onChange:d,placeholder:p="Start writing...",minHeight:i=200,disabled:e=!1})=>{const[t,l]=le.useState(Ye.sanitize(b||"")),[o,y]=le.useState(null),[v,n]=le.useState(null),s=le.useRef(null),r=le.useRef(!1);le.useEffect(()=>{if(r.current){const h=Ye.sanitize(b||"");h!==t&&l(h)}else r.current=!0},[b]);const a=h=>{const U=Ye.sanitize(h);l(U),d(U)},m=h=>{if(!s.current){console.warn("Editor not initialized");return}const U=s.current.getEditor(),u=U.getSelection();if(u)U.insertText(u.index,h),U.setSelection(u.index+h.length);else{const f=U.getText().length;U.insertText(f,h),U.setSelection(f+h.length)}y(null),n(null),U.focus()},_=h=>{y(h.currentTarget),n(null)},M=h=>{n(h.currentTarget),y(null)},x=()=>{y(null),n(null)},R=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],F=["+","−","×","÷","±","=","≈","≠","≤","≥","<",">","°","∞","√","∑","∫","π","Δ","∂","∇","∈","∉","⊂","⊃","∩","∪","∅"],D={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],["blockquote","code-block"],["link"],["clean"]]},j=["header","bold","italic","underline","strike","list","script","indent","blockquote","code-block","link"];return L.jsxs(se,{children:[L.jsxs(se,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:H[1],mb:H[2]},children:[L.jsx(ae,{variant:"body2",sx:{color:W.text.secondary,fontSize:G.fontSize.sm,fontWeight:G.fontWeight.medium,mr:H[1]},children:"Insert:"}),L.jsx(nt,{title:"Math Symbols",placement:"top",children:L.jsx(He,{onClick:_,disabled:e,size:"small",sx:{border:`1px solid ${W.neutral[300]}`,borderRadius:re.md,backgroundColor:o?W.primary[50]:W.background.primary,"&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400]}},children:L.jsx(fr,{sx:{fontSize:18,color:W.primary[600]}})})}),L.jsx(nt,{title:"Greek Letters",placement:"top",children:L.jsx(He,{onClick:M,disabled:e,size:"small",sx:{border:`1px solid ${W.neutral[300]}`,borderRadius:re.md,backgroundColor:v?W.primary[50]:W.background.primary,fontWeight:G.fontWeight.bold,fontSize:G.fontSize.lg,color:W.primary[600],"&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400]}},children:"Ω"})})]}),L.jsx(Dt,{open:!!o,anchorEl:o,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:re.lg,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",mt:H[1]}},children:L.jsxs(se,{sx:{p:H[2],maxWidth:320},children:[L.jsx(ae,{variant:"subtitle2",sx:{fontWeight:G.fontWeight.semibold,color:W.text.primary,mb:H[2]},children:"Math Symbols"}),L.jsx(se,{sx:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",gap:H[1]},children:F.map(h=>L.jsx(_t,{onClick:()=>m(h),sx:{width:32,height:32,borderRadius:re.md,border:`1px solid ${W.neutral[200]}`,backgroundColor:W.background.primary,fontSize:G.fontSize.lg,fontWeight:G.fontWeight.medium,color:W.text.primary,transition:"all 0.2s","&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400],transform:"scale(1.1)"}},children:h},h))})]})}),L.jsx(Dt,{open:!!v,anchorEl:v,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:re.lg,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",mt:H[1]}},children:L.jsxs(se,{sx:{p:H[2],maxWidth:360},children:[L.jsx(ae,{variant:"subtitle2",sx:{fontWeight:G.fontWeight.semibold,color:W.text.primary,mb:H[2]},children:"Greek Letters"}),L.jsx(se,{sx:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:H[1]},children:R.map(h=>L.jsx(_t,{onClick:()=>m(h),sx:{width:28,height:28,borderRadius:re.md,border:`1px solid ${W.neutral[200]}`,backgroundColor:W.background.primary,fontSize:G.fontSize.base,fontWeight:G.fontWeight.medium,color:W.text.primary,transition:"all 0.2s","&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400],transform:"scale(1.15)"}},children:h},h))})]})}),L.jsx(se,{sx:{"& .quill":{borderRadius:re.lg,border:`1px solid ${W.neutral[300]}`,backgroundColor:W.background.primary},"& .ql-toolbar":{borderTopLeftRadius:re.lg,borderTopRightRadius:re.lg,borderBottom:`1px solid ${W.neutral[200]}`,backgroundColor:W.background.secondary},"& .ql-container":{borderBottomLeftRadius:re.lg,borderBottomRightRadius:re.lg,minHeight:`${i}px`,fontSize:G.fontSize.base,fontFamily:G.fontFamily.body},"& .ql-editor":{minHeight:`${i}px`,color:W.text.primary},"& .ql-editor.ql-blank::before":{color:W.text.tertiary,fontStyle:"normal"}},children:L.jsx(or,{ref:s,value:t,onChange:a,modules:D,formats:j,theme:"snow",placeholder:p,readOnly:e})})]})};function Tr(b,d){return d.forEach(function(p){p&&typeof p!="string"&&!Array.isArray(p)&&Object.keys(p).forEach(function(i){if(i!=="default"&&!(i in b)){var e=Object.getOwnPropertyDescriptor(p,i);Object.defineProperty(b,i,e.get?e:{enumerable:!0,get:function(){return p[i]}})}})}),Object.freeze(b)}function Wt(b,d){return new Promise(function(p,i){let e;return jr(b).then(function(t){try{return e=t,p(new Blob([d.slice(0,2),e,d.slice(2)],{type:"image/jpeg"}))}catch(l){return i(l)}},i)})}const jr=b=>new Promise((d,p)=>{const i=new FileReader;i.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let l=0;if(t.getUint16(l)!==65496)return p("not a valid JPEG");for(l+=2;;){const o=t.getUint16(l);if(o===65498)break;const y=t.getUint16(l+2);if(o===65505&&t.getUint32(l+4)===1165519206){const v=l+10;let n;switch(t.getUint16(v)){case 18761:n=!0;break;case 19789:n=!1;break;default:return p("TIFF header contains invalid endian")}if(t.getUint16(v+2,n)!==42)return p("TIFF header contains invalid version");const s=t.getUint32(v+4,n),r=v+s+2+12*t.getUint16(v+s,n);for(let a=v+s+2;a<r;a+=12)if(t.getUint16(a,n)==274){if(t.getUint16(a+2,n)!==3)return p("Orientation data type is invalid");if(t.getUint32(a+4,n)!==1)return p("Orientation data count is invalid");t.setUint16(a+8,1,n);break}return d(e.slice(l,l+2+y))}l+=2+y}return d(new Blob)}),i.readAsArrayBuffer(b)});var it={},zr={get exports(){return it},set exports(b){it=b}};(function(b){var d,p,i={};zr.exports=i,i.parse=function(e,t){for(var l=i.bin.readUshort,o=i.bin.readUint,y=0,v={},n=new Uint8Array(e),s=n.length-4;o(n,s)!=101010256;)s--;y=s,y+=4;var r=l(n,y+=4);l(n,y+=2);var a=o(n,y+=2),m=o(n,y+=4);y+=4,y=m;for(var _=0;_<r;_++){o(n,y),y+=4,y+=4,y+=4,o(n,y+=4),a=o(n,y+=4);var M=o(n,y+=4),x=l(n,y+=4),R=l(n,y+2),F=l(n,y+4);y+=6;var D=o(n,y+=8);y+=4,y+=x+R+F,i._readLocal(n,D,v,a,M,t)}return v},i._readLocal=function(e,t,l,o,y,v){var n=i.bin.readUshort,s=i.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var a=n(e,t+=8),m=n(e,t+=2);t+=2;var _=i.bin.readUTF8(e,t,a);if(t+=a,t+=m,v)l[_]={size:y,csize:o};else{var M=new Uint8Array(e.buffer,t);if(r==0)l[_]=new Uint8Array(M.buffer.slice(t,t+o));else{if(r!=8)throw"unknown compression method: "+r;var x=new Uint8Array(y);i.inflateRaw(M,x),l[_]=x}}},i.inflateRaw=function(e,t){return i.F.inflate(e,t)},i.inflate=function(e,t){return e[0],e[1],i.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},i.deflate=function(e,t){t==null&&(t={level:6});var l=0,o=new Uint8Array(50+Math.floor(1.1*e.length));o[l]=120,o[l+1]=156,l+=2,l=i.F.deflateRaw(e,o,l,t.level);var y=i.adler(e,0,e.length);return o[l+0]=y>>>24&255,o[l+1]=y>>>16&255,o[l+2]=y>>>8&255,o[l+3]=y>>>0&255,new Uint8Array(o.buffer,0,l+4)},i.deflateRaw=function(e,t){t==null&&(t={level:6});var l=new Uint8Array(50+Math.floor(1.1*e.length)),o=i.F.deflateRaw(e,l,o,t.level);return new Uint8Array(l.buffer,0,o)},i.encode=function(e,t){t==null&&(t=!1);var l=0,o=i.bin.writeUint,y=i.bin.writeUshort,v={};for(var n in e){var s=!i._noNeed(n)&&!t,r=e[n],a=i.crc.crc(r,0,r.length);v[n]={cpr:s,usize:r.length,crc:a,file:s?i.deflateRaw(r):r}}for(var n in v)l+=v[n].file.length+30+46+2*i.bin.sizeUTF8(n);l+=22;var m=new Uint8Array(l),_=0,M=[];for(var n in v){var x=v[n];M.push(_),_=i._writeHeader(m,_,n,x,0)}var R=0,F=_;for(var n in v)x=v[n],M.push(_),_=i._writeHeader(m,_,n,x,1,M[R++]);var D=_-F;return o(m,_,101010256),_+=4,y(m,_+=4,R),y(m,_+=2,R),o(m,_+=2,D),o(m,_+=4,F),_+=4,_+=2,m.buffer},i._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},i._writeHeader=function(e,t,l,o,y,v){var n=i.bin.writeUint,s=i.bin.writeUshort,r=o.file;return n(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,o.cpr?8:0),n(e,t+=2,0),n(e,t+=4,o.crc),n(e,t+=4,r.length),n(e,t+=4,o.usize),s(e,t+=4,i.bin.sizeUTF8(l)),s(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,n(e,t+=6,v),t+=4),t+=i.bin.writeUTF8(e,t,l),y==0&&(e.set(r,t),t+=r.length),t},i.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var l=t,o=0;o<8;o++)1&l?l=3988292384^l>>>1:l>>>=1;e[t]=l}return e}(),update:function(e,t,l,o){for(var y=0;y<o;y++)e=i.crc.table[255&(e^t[l+y])]^e>>>8;return e},crc:function(e,t,l){return 4294967295^i.crc.update(4294967295,e,t,l)}},i.adler=function(e,t,l){for(var o=1,y=0,v=t,n=t+l;v<n;){for(var s=Math.min(v+5552,n);v<s;)y+=o+=e[v++];o%=65521,y%=65521}return y<<16|o},i.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255,e[t+2]=l>>16&255,e[t+3]=l>>24&255},readASCII:function(e,t,l){for(var o="",y=0;y<l;y++)o+=String.fromCharCode(e[t+y]);return o},writeASCII:function(e,t,l){for(var o=0;o<l.length;o++)e[t+o]=l.charCodeAt(o)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,l){for(var o,y="",v=0;v<l;v++)y+="%"+i.bin.pad(e[t+v].toString(16));try{o=decodeURIComponent(y)}catch{return i.bin.readASCII(e,t,l)}return o},writeUTF8:function(e,t,l){for(var o=l.length,y=0,v=0;v<o;v++){var n=l.charCodeAt(v);if((4294967168&n)==0)e[t+y]=n,y++;else if((4294965248&n)==0)e[t+y]=192|n>>6,e[t+y+1]=128|n>>0&63,y+=2;else if((4294901760&n)==0)e[t+y]=224|n>>12,e[t+y+1]=128|n>>6&63,e[t+y+2]=128|n>>0&63,y+=3;else{if((4292870144&n)!=0)throw"e";e[t+y]=240|n>>18,e[t+y+1]=128|n>>12&63,e[t+y+2]=128|n>>6&63,e[t+y+3]=128|n>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,l=0,o=0;o<t;o++){var y=e.charCodeAt(o);if((4294967168&y)==0)l++;else if((4294965248&y)==0)l+=2;else if((4294901760&y)==0)l+=3;else{if((4292870144&y)!=0)throw"e";l+=4}}return l}},i.F={},i.F.deflateRaw=function(e,t,l,o){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],v=i.F.U,n=i.F._goodIndex;i.F._hash;var s=i.F._putsE,r=0,a=l<<3,m=0,_=e.length;if(o==0){for(;r<_;)s(t,a,r+(I=Math.min(65535,_-r))==_?1:0),a=i.F._copyExact(e,r,I,t,a+8),r+=I;return a>>>3}var M=v.lits,x=v.strt,R=v.prev,F=0,D=0,j=0,h=0,U=0,u=0;for(_>2&&(x[u=i.F._hash(e,0)]=0),r=0;r<_;r++){if(U=u,r+1<_-2){u=i.F._hash(e,r+1);var f=r+1&32767;R[f]=x[u],x[u]=f}if(m<=r){(F>14e3||D>26697)&&_-r>100&&(m<r&&(M[F]=r-m,F+=2,m=r),a=i.F._writeBlock(r==_-1||m==_?1:0,M,F,h,e,j,r-j,t,a),F=D=h=0,j=r);var w=0;r<_-2&&(w=i.F._bestMatch(e,r,R,U,Math.min(y[2],_-r),y[3]));var I=w>>>16,C=65535&w;if(w!=0){C=65535&w;var S=n(I=w>>>16,v.of0);v.lhst[257+S]++;var A=n(C,v.df0);v.dhst[A]++,h+=v.exb[S]+v.dxb[A],M[F]=I<<23|r-m,M[F+1]=C<<16|S<<8|A,F+=2,m=r+I}else v.lhst[e[r]]++;D++}}for(j==r&&e.length!=0||(m<r&&(M[F]=r-m,F+=2,m=r),a=i.F._writeBlock(1,M,F,h,e,j,r-j,t,a),F=0,D=0,F=D=h=0,j=r);(7&a)!=0;)a++;return a>>>3},i.F._bestMatch=function(e,t,l,o,y,v){var n=32767&t,s=l[n],r=n-s+32768&32767;if(s==n||o!=i.F._hash(e,t-r))return 0;for(var a=0,m=0,_=Math.min(32767,t);r<=_&&--v!=0&&s!=n;){if(a==0||e[t+a]==e[t+a-r]){var M=i.F._howLong(e,t,r);if(M>a){if(m=r,(a=M)>=y)break;r+2<M&&(M=r+2);for(var x=0,R=0;R<M-2;R++){var F=t-r+R+32768&32767,D=F-l[F]+32768&32767;D>x&&(x=D,s=F)}}}r+=(n=s)-(s=l[n])+32768&32767}return a<<16|m},i.F._howLong=function(e,t,l){if(e[t]!=e[t-l]||e[t+1]!=e[t+1-l]||e[t+2]!=e[t+2-l])return 0;var o=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-l];)t++;return t-o},i.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},i.saved=0,i.F._writeBlock=function(e,t,l,o,y,v,n,s,r){var a,m,_,M,x,R,F,D,j,h=i.F.U,U=i.F._putsF,u=i.F._putsE;h.lhst[256]++,m=(a=i.F.getTrees())[0],_=a[1],M=a[2],x=a[3],R=a[4],F=a[5],D=a[6],j=a[7];var f=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),w=o+i.F.contSize(h.fltree,h.lhst)+i.F.contSize(h.fdtree,h.dhst),I=o+i.F.contSize(h.ltree,h.lhst)+i.F.contSize(h.dtree,h.dhst);I+=14+3*F+i.F.contSize(h.itree,h.ihst)+(2*h.ihst[16]+3*h.ihst[17]+7*h.ihst[18]);for(var C=0;C<286;C++)h.lhst[C]=0;for(C=0;C<30;C++)h.dhst[C]=0;for(C=0;C<19;C++)h.ihst[C]=0;var S=f<w&&f<I?0:w<I?1:2;if(U(s,r,e),U(s,r+1,S),r+=3,S==0){for(;(7&r)!=0;)r++;r=i.F._copyExact(y,v,n,s,r)}else{var A,k;if(S==1&&(A=h.fltree,k=h.fdtree),S==2){i.F.makeCodes(h.ltree,m),i.F.revCodes(h.ltree,m),i.F.makeCodes(h.dtree,_),i.F.revCodes(h.dtree,_),i.F.makeCodes(h.itree,M),i.F.revCodes(h.itree,M),A=h.ltree,k=h.dtree,u(s,r,x-257),u(s,r+=5,R-1),u(s,r+=5,F-4),r+=4;for(var g=0;g<F;g++)u(s,r+3*g,h.itree[1+(h.ordr[g]<<1)]);r+=3*F,r=i.F._codeTiny(D,h.itree,s,r),r=i.F._codeTiny(j,h.itree,s,r)}for(var c=v,z=0;z<l;z+=2){for(var E=t[z],P=E>>>23,O=c+(8388607&E);c<O;)r=i.F._writeLit(y[c++],A,s,r);if(P!=0){var N=t[z+1],$=N>>16,B=N>>8&255,T=255&N;u(s,r=i.F._writeLit(257+B,A,s,r),P-h.of0[B]),r+=h.exb[B],U(s,r=i.F._writeLit(T,k,s,r),$-h.df0[T]),r+=h.dxb[T],c+=P}}r=i.F._writeLit(256,A,s,r)}return r},i.F._copyExact=function(e,t,l,o,y){var v=y>>>3;return o[v]=l,o[v+1]=l>>>8,o[v+2]=255-o[v],o[v+3]=255-o[v+1],v+=4,o.set(new Uint8Array(e.buffer,t,l),v),y+(l+4<<3)},i.F.getTrees=function(){for(var e=i.F.U,t=i.F._hufTree(e.lhst,e.ltree,15),l=i.F._hufTree(e.dhst,e.dtree,15),o=[],y=i.F._lenCodes(e.ltree,o),v=[],n=i.F._lenCodes(e.dtree,v),s=0;s<o.length;s+=2)e.ihst[o[s]]++;for(s=0;s<v.length;s+=2)e.ihst[v[s]]++;for(var r=i.F._hufTree(e.ihst,e.itree,7),a=19;a>4&&e.itree[1+(e.ordr[a-1]<<1)]==0;)a--;return[t,l,r,y,n,a,o,v]},i.F.getSecond=function(e){for(var t=[],l=0;l<e.length;l+=2)t.push(e[l+1]);return t},i.F.nonZero=function(e){for(var t="",l=0;l<e.length;l+=2)e[l+1]!=0&&(t+=(l>>1)+",");return t},i.F.contSize=function(e,t){for(var l=0,o=0;o<t.length;o++)l+=t[o]*e[1+(o<<1)];return l},i.F._codeTiny=function(e,t,l,o){for(var y=0;y<e.length;y+=2){var v=e[y],n=e[y+1];o=i.F._writeLit(v,t,l,o);var s=v==16?2:v==17?3:7;v>15&&(i.F._putsE(l,o,n,s),o+=s)}return o},i.F._lenCodes=function(e,t){for(var l=e.length;l!=2&&e[l-1]==0;)l-=2;for(var o=0;o<l;o+=2){var y=e[o+1],v=o+3<l?e[o+3]:-1,n=o+5<l?e[o+5]:-1,s=o==0?-1:e[o-1];if(y==0&&v==y&&n==y){for(var r=o+5;r+2<l&&e[r+2]==y;)r+=2;(a=Math.min(r+1-o>>>1,138))<11?t.push(17,a-3):t.push(18,a-11),o+=2*a-2}else if(y==s&&v==y&&n==y){for(r=o+5;r+2<l&&e[r+2]==y;)r+=2;var a=Math.min(r+1-o>>>1,6);t.push(16,a-3),o+=2*a-2}else t.push(y,0)}return l>>>1},i.F._hufTree=function(e,t,l){var o=[],y=e.length,v=t.length,n=0;for(n=0;n<v;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<y;n++)e[n]!=0&&o.push({lit:n,f:e[n]});var s=o.length,r=o.slice(0);if(s==0)return 0;if(s==1){var a=o[0].lit;return r=a==0?1:0,t[1+(a<<1)]=1,t[1+(r<<1)]=1,1}o.sort(function(D,j){return D.f-j.f});var m=o[0],_=o[1],M=0,x=1,R=2;for(o[0]={lit:-1,f:m.f+_.f,l:m,r:_,d:0};x!=s-1;)m=M!=x&&(R==s||o[M].f<o[R].f)?o[M++]:o[R++],_=M!=x&&(R==s||o[M].f<o[R].f)?o[M++]:o[R++],o[x++]={lit:-1,f:m.f+_.f,l:m,r:_};var F=i.F.setDepth(o[x-1],0);for(F>l&&(i.F.restrictDepth(r,l,F),F=l),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return F},i.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(i.F.setDepth(e.l,t+1),i.F.setDepth(e.r,t+1))},i.F.restrictDepth=function(e,t,l){var o=0,y=1<<l-t,v=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),o=0;o<e.length&&e[o].d>t;o++){var n=e[o].d;e[o].d=t,v+=y-(1<<l-n)}for(v>>>=l-t;v>0;)(n=e[o].d)<t?(e[o].d++,v-=1<<t-n-1):o++;for(;o>=0;o--)e[o].d==t&&v<0&&(e[o].d--,v++);v!=0&&console.log("debt left")},i.F._goodIndex=function(e,t){var l=0;return t[16|l]<=e&&(l|=16),t[8|l]<=e&&(l|=8),t[4|l]<=e&&(l|=4),t[2|l]<=e&&(l|=2),t[1|l]<=e&&(l|=1),l},i.F._writeLit=function(e,t,l,o){return i.F._putsF(l,o,t[e<<1]),o+t[1+(e<<1)]},i.F.inflate=function(e,t){var l=Uint8Array;if(e[0]==3&&e[1]==0)return t||new l(0);var o=i.F,y=o._bitsF,v=o._bitsE,n=o._decodeTiny,s=o.makeCodes,r=o.codes2map,a=o._get17,m=o.U,_=t==null;_&&(t=new l(e.length>>>2<<3));for(var M,x,R=0,F=0,D=0,j=0,h=0,U=0,u=0,f=0,w=0;R==0;)if(R=y(e,w,1),F=y(e,w+1,2),w+=3,F!=0){if(_&&(t=i.F._check(t,f+(1<<17))),F==1&&(M=m.flmap,x=m.fdmap,U=511,u=31),F==2){D=v(e,w,5)+257,j=v(e,w+5,5)+1,h=v(e,w+10,4)+4,w+=14;for(var I=0;I<38;I+=2)m.itree[I]=0,m.itree[I+1]=0;var C=1;for(I=0;I<h;I++){var S=v(e,w+3*I,3);m.itree[1+(m.ordr[I]<<1)]=S,S>C&&(C=S)}w+=3*h,s(m.itree,C),r(m.itree,C,m.imap),M=m.lmap,x=m.dmap,w=n(m.imap,(1<<C)-1,D+j,e,w,m.ttree);var A=o._copyOut(m.ttree,0,D,m.ltree);U=(1<<A)-1;var k=o._copyOut(m.ttree,D,j,m.dtree);u=(1<<k)-1,s(m.ltree,A),r(m.ltree,A,M),s(m.dtree,k),r(m.dtree,k,x)}for(;;){var g=M[a(e,w)&U];w+=15&g;var c=g>>>4;if(!(c>>>8))t[f++]=c;else{if(c==256)break;var z=f+c-254;if(c>264){var E=m.ldef[c-257];z=f+(E>>>3)+v(e,w,7&E),w+=7&E}var P=x[a(e,w)&u];w+=15&P;var O=P>>>4,N=m.ddef[O],$=(N>>>4)+y(e,w,15&N);for(w+=15&N,_&&(t=i.F._check(t,f+(1<<17)));f<z;)t[f]=t[f++-$],t[f]=t[f++-$],t[f]=t[f++-$],t[f]=t[f++-$];f=z}}}else{(7&w)!=0&&(w+=8-(7&w));var B=4+(w>>>3),T=e[B-4]|e[B-3]<<8;_&&(t=i.F._check(t,f+T)),t.set(new l(e.buffer,e.byteOffset+B,T),f),w=B+T<<3,f+=T}return t.length==f?t:t.slice(0,f)},i.F._check=function(e,t){var l=e.length;if(t<=l)return e;var o=new Uint8Array(Math.max(l<<1,t));return o.set(e,0),o},i.F._decodeTiny=function(e,t,l,o,y,v){for(var n=i.F._bitsE,s=i.F._get17,r=0;r<l;){var a=e[s(o,y)&t];y+=15&a;var m=a>>>4;if(m<=15)v[r]=m,r++;else{var _=0,M=0;m==16?(M=3+n(o,y,2),y+=2,_=v[r-1]):m==17?(M=3+n(o,y,3),y+=3):m==18&&(M=11+n(o,y,7),y+=7);for(var x=r+M;r<x;)v[r]=_,r++}}return y},i.F._copyOut=function(e,t,l,o){for(var y=0,v=0,n=o.length>>>1;v<l;){var s=e[v+t];o[v<<1]=0,o[1+(v<<1)]=s,s>y&&(y=s),v++}for(;v<n;)o[v<<1]=0,o[1+(v<<1)]=0,v++;return y},i.F.makeCodes=function(e,t){for(var l,o,y,v,n=i.F.U,s=e.length,r=n.bl_count,a=0;a<=t;a++)r[a]=0;for(a=1;a<s;a+=2)r[e[a]]++;var m=n.next_code;for(l=0,r[0]=0,o=1;o<=t;o++)l=l+r[o-1]<<1,m[o]=l;for(y=0;y<s;y+=2)(v=e[y+1])!=0&&(e[y]=m[v],m[v]++)},i.F.codes2map=function(e,t,l){for(var o=e.length,y=i.F.U.rev15,v=0;v<o;v+=2)if(e[v+1]!=0)for(var n=v>>1,s=e[v+1],r=n<<4|s,a=t-s,m=e[v]<<a,_=m+(1<<a);m!=_;)l[y[m]>>>15-t]=r,m++},i.F.revCodes=function(e,t){for(var l=i.F.U.rev15,o=15-t,y=0;y<e.length;y+=2){var v=e[y]<<t-e[y+1];e[y]=l[v]>>>o}},i.F._putsE=function(e,t,l){l<<=7&t;var o=t>>>3;e[o]|=l,e[o+1]|=l>>>8},i.F._putsF=function(e,t,l){l<<=7&t;var o=t>>>3;e[o]|=l,e[o+1]|=l>>>8,e[o+2]|=l>>>16},i.F._bitsE=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<l)-1},i.F._bitsF=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<l)-1},i.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},i.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},i.F.U=(d=Uint16Array,p=Uint32Array,{next_code:new d(16),bl_count:new d(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new d(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new p(32),flmap:new d(512),fltree:[],fdmap:new d(32),fdtree:[],lmap:new d(32768),ltree:[],ttree:[],dmap:new d(32768),dtree:[],imap:new d(512),itree:[],rev15:new d(32768),lhst:new p(286),dhst:new p(30),ihst:new p(19),lits:new p(15e3),strt:new d(65536),prev:new d(32768)}),function(){for(var e=i.F.U,t=0;t<32768;t++){var l=t;l=(4278255360&(l=(4042322160&(l=(3435973836&(l=(2863311530&l)>>>1|(1431655765&l)<<1))>>>2|(858993459&l)<<2))>>>4|(252645135&l)<<4))>>>8|(16711935&l)<<8,e.rev15[t]=(l>>>16|l<<16)>>>17}function o(y,v,n){for(;v--!=0;)y.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];o(e.fltree,144,8),o(e.fltree,112,9),o(e.fltree,24,7),o(e.fltree,8,8),i.F.makeCodes(e.fltree,9),i.F.codes2map(e.fltree,9,e.flmap),i.F.revCodes(e.fltree,9),o(e.fdtree,32,5),i.F.makeCodes(e.fdtree,5),i.F.codes2map(e.fdtree,5,e.fdmap),i.F.revCodes(e.fdtree,5),o(e.itree,19,0),o(e.ltree,286,0),o(e.dtree,30,0),o(e.ttree,320,0)}()})();var Lr=Tr({__proto__:null,default:it},[it]);const Ae=function(){var b={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let a="";for(let m=0;m<r;m++)a+=String.fromCharCode(n[s+m]);return a},writeASCII(n,s,r){for(let a=0;a<r.length;a++)n[s+a]=r.charCodeAt(a)},readBytes(n,s,r){const a=[];for(let m=0;m<r;m++)a.push(n[s+m]);return a},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let a,m="";for(let _=0;_<r;_++)m+=`%${b.pad(n[s+_].toString(16))}`;try{a=decodeURIComponent(m)}catch{return b.readASCII(n,s,r)}return a}};function d(n,s,r,a){const m=s*r,_=t(a),M=Math.ceil(s*_/8),x=new Uint8Array(4*m),R=new Uint32Array(x.buffer),{ctype:F}=a,{depth:D}=a,j=b.readUshort;if(F==6){const E=m<<2;if(D==8)for(var h=0;h<E;h+=4)x[h]=n[h],x[h+1]=n[h+1],x[h+2]=n[h+2],x[h+3]=n[h+3];if(D==16)for(h=0;h<E;h++)x[h]=n[h<<1]}else if(F==2){const E=a.tabs.tRNS;if(E==null){if(D==8)for(h=0;h<m;h++){var U=3*h;R[h]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U]}if(D==16)for(h=0;h<m;h++)U=6*h,R[h]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U]}else{var u=E[0];const P=E[1],O=E[2];if(D==8)for(h=0;h<m;h++){var f=h<<2;U=3*h,R[h]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U],n[U]==u&&n[U+1]==P&&n[U+2]==O&&(x[f+3]=0)}if(D==16)for(h=0;h<m;h++)f=h<<2,U=6*h,R[h]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U],j(n,U)==u&&j(n,U+2)==P&&j(n,U+4)==O&&(x[f+3]=0)}}else if(F==3){const E=a.tabs.PLTE,P=a.tabs.tRNS,O=P?P.length:0;if(D==1)for(var w=0;w<r;w++){var I=w*M,C=w*s;for(h=0;h<s;h++){f=C+h<<2;var S=3*(A=n[I+(h>>3)]>>7-((7&h)<<0)&1);x[f]=E[S],x[f+1]=E[S+1],x[f+2]=E[S+2],x[f+3]=A<O?P[A]:255}}if(D==2)for(w=0;w<r;w++)for(I=w*M,C=w*s,h=0;h<s;h++)f=C+h<<2,S=3*(A=n[I+(h>>2)]>>6-((3&h)<<1)&3),x[f]=E[S],x[f+1]=E[S+1],x[f+2]=E[S+2],x[f+3]=A<O?P[A]:255;if(D==4)for(w=0;w<r;w++)for(I=w*M,C=w*s,h=0;h<s;h++)f=C+h<<2,S=3*(A=n[I+(h>>1)]>>4-((1&h)<<2)&15),x[f]=E[S],x[f+1]=E[S+1],x[f+2]=E[S+2],x[f+3]=A<O?P[A]:255;if(D==8)for(h=0;h<m;h++){var A;f=h<<2,S=3*(A=n[h]),x[f]=E[S],x[f+1]=E[S+1],x[f+2]=E[S+2],x[f+3]=A<O?P[A]:255}}else if(F==4){if(D==8)for(h=0;h<m;h++){f=h<<2;var k=n[g=h<<1];x[f]=k,x[f+1]=k,x[f+2]=k,x[f+3]=n[g+1]}if(D==16)for(h=0;h<m;h++){var g;f=h<<2,k=n[g=h<<2],x[f]=k,x[f+1]=k,x[f+2]=k,x[f+3]=n[g+2]}}else if(F==0)for(u=a.tabs.tRNS?a.tabs.tRNS:-1,w=0;w<r;w++){const E=w*M,P=w*s;if(D==1)for(var c=0;c<s;c++){var z=(k=255*(n[E+(c>>>3)]>>>7-(7&c)&1))==255*u?0:255;R[P+c]=z<<24|k<<16|k<<8|k}else if(D==2)for(c=0;c<s;c++)z=(k=85*(n[E+(c>>>2)]>>>6-((3&c)<<1)&3))==85*u?0:255,R[P+c]=z<<24|k<<16|k<<8|k;else if(D==4)for(c=0;c<s;c++)z=(k=17*(n[E+(c>>>1)]>>>4-((1&c)<<2)&15))==17*u?0:255,R[P+c]=z<<24|k<<16|k<<8|k;else if(D==8)for(c=0;c<s;c++)z=(k=n[E+c])==u?0:255,R[P+c]=z<<24|k<<16|k<<8|k;else if(D==16)for(c=0;c<s;c++)k=n[E+(c<<1)],z=j(n,E+(c<<1))==u?0:255,R[P+c]=z<<24|k<<16|k<<8|k}return x}function p(n,s,r,a){const m=t(n),_=Math.ceil(r*m/8),M=new Uint8Array((_+1+n.interlace)*a);return s=n.tabs.CgBI?e(s,M):i(s,M),n.interlace==0?s=l(s,n,0,r,a):n.interlace==1&&(s=function(R,F){const D=F.width,j=F.height,h=t(F),U=h>>3,u=Math.ceil(D*h/8),f=new Uint8Array(j*u);let w=0;const I=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],S=[8,8,8,4,4,2,2],A=[8,8,4,4,2,2,1];let k=0;for(;k<7;){const c=S[k],z=A[k];let E=0,P=0,O=I[k];for(;O<j;)O+=c,P++;let N=C[k];for(;N<D;)N+=z,E++;const $=Math.ceil(E*h/8);l(R,F,w,E,P);let B=0,T=I[k];for(;T<j;){let Q=C[k],Y=w+B*$<<3;for(;Q<D;){var g;if(h==1&&(g=(g=R[Y>>3])>>7-(7&Y)&1,f[T*u+(Q>>3)]|=g<<7-((7&Q)<<0)),h==2&&(g=(g=R[Y>>3])>>6-(7&Y)&3,f[T*u+(Q>>2)]|=g<<6-((3&Q)<<1)),h==4&&(g=(g=R[Y>>3])>>4-(7&Y)&15,f[T*u+(Q>>1)]|=g<<4-((1&Q)<<2)),h>=8){const V=T*u+Q*U;for(let q=0;q<U;q++)f[V+q]=R[(Y>>3)+q]}Y+=h,Q+=z}B++,T+=c}E*P!=0&&(w+=P*(1+$)),k+=1}return f}(s,n)),s}function i(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const a=Uint8Array;let m,_,M=0,x=0,R=0,F=0,D=0,j=0,h=0,U=0,u=0;if(s[0]==3&&s[1]==0)return r||new a(0);const f=n.H,w=f.b,I=f.e,C=f.R,S=f.n,A=f.A,k=f.Z,g=f.m,c=r==null;for(c&&(r=new a(s.length>>>2<<5));M==0;)if(M=w(s,u,1),x=w(s,u+1,2),u+=3,x!=0){if(c&&(r=n.H.W(r,U+(1<<17))),x==1&&(m=g.J,_=g.h,j=511,h=31),x==2){R=I(s,u,5)+257,F=I(s,u+5,5)+1,D=I(s,u+10,4)+4,u+=14;let E=1;for(var z=0;z<38;z+=2)g.Q[z]=0,g.Q[z+1]=0;for(z=0;z<D;z++){const N=I(s,u+3*z,3);g.Q[1+(g.X[z]<<1)]=N,N>E&&(E=N)}u+=3*D,S(g.Q,E),A(g.Q,E,g.u),m=g.w,_=g.d,u=C(g.u,(1<<E)-1,R+F,s,u,g.v);const P=f.V(g.v,0,R,g.C);j=(1<<P)-1;const O=f.V(g.v,R,F,g.D);h=(1<<O)-1,S(g.C,P),A(g.C,P,m),S(g.D,O),A(g.D,O,_)}for(;;){const E=m[k(s,u)&j];u+=15&E;const P=E>>>4;if(!(P>>>8))r[U++]=P;else{if(P==256)break;{let O=U+P-254;if(P>264){const Q=g.q[P-257];O=U+(Q>>>3)+I(s,u,7&Q),u+=7&Q}const N=_[k(s,u)&h];u+=15&N;const $=N>>>4,B=g.c[$],T=(B>>>4)+w(s,u,15&B);for(u+=15&B;U<O;)r[U]=r[U++-T],r[U]=r[U++-T],r[U]=r[U++-T],r[U]=r[U++-T];U=O}}}}else{(7&u)!=0&&(u+=8-(7&u));const E=4+(u>>>3),P=s[E-4]|s[E-3]<<8;c&&(r=n.H.W(r,U+P)),r.set(new a(s.buffer,s.byteOffset+E,P),U),u=E+P<<3,U+=P}return r.length==U?r:r.slice(0,U)},n.H.W=function(s,r){const a=s.length;if(r<=a)return s;const m=new Uint8Array(a<<1);return m.set(s,0),m},n.H.R=function(s,r,a,m,_,M){const x=n.H.e,R=n.H.Z;let F=0;for(;F<a;){const D=s[R(m,_)&r];_+=15&D;const j=D>>>4;if(j<=15)M[F]=j,F++;else{let h=0,U=0;j==16?(U=3+x(m,_,2),_+=2,h=M[F-1]):j==17?(U=3+x(m,_,3),_+=3):j==18&&(U=11+x(m,_,7),_+=7);const u=F+U;for(;F<u;)M[F]=h,F++}}return _},n.H.V=function(s,r,a,m){let _=0,M=0;const x=m.length>>>1;for(;M<a;){const R=s[M+r];m[M<<1]=0,m[1+(M<<1)]=R,R>_&&(_=R),M++}for(;M<x;)m[M<<1]=0,m[1+(M<<1)]=0,M++;return _},n.H.n=function(s,r){const a=n.H.m,m=s.length;let _,M,x,R;const F=a.j;for(var D=0;D<=r;D++)F[D]=0;for(D=1;D<m;D+=2)F[s[D]]++;const j=a.K;for(_=0,F[0]=0,M=1;M<=r;M++)_=_+F[M-1]<<1,j[M]=_;for(x=0;x<m;x+=2)R=s[x+1],R!=0&&(s[x]=j[R],j[R]++)},n.H.A=function(s,r,a){const m=s.length,_=n.H.m.r;for(let M=0;M<m;M+=2)if(s[M+1]!=0){const x=M>>1,R=s[M+1],F=x<<4|R,D=r-R;let j=s[M]<<D;const h=j+(1<<D);for(;j!=h;)a[_[j]>>>15-r]=F,j++}},n.H.l=function(s,r){const a=n.H.m.r,m=15-r;for(let _=0;_<s.length;_+=2){const M=s[_]<<r-s[_+1];s[_]=a[M]>>>m}},n.H.M=function(s,r,a){a<<=7&r;const m=r>>>3;s[m]|=a,s[m+1]|=a>>>8},n.H.I=function(s,r,a){a<<=7&r;const m=r>>>3;s[m]|=a,s[m+1]|=a>>>8,s[m+2]|=a>>>16},n.H.e=function(s,r,a){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<a)-1},n.H.b=function(s,r,a){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<a)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let m=r;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,s.r[r]=(m>>>16|m<<16)>>>17}function a(m,_,M){for(;_--!=0;)m.push(0,M)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];a(s._,144,8),a(s._,112,9),a(s._,24,7),a(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),a(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),a(s.Q,19,0),a(s.C,286,0),a(s.D,30,0),a(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function l(n,s,r,a,m){let _=t(s);const M=Math.ceil(a*_/8);let x,R;_=Math.ceil(_/8);let F=n[r],D=0;if(F>1&&(n[r]=[0,0,1][F-2]),F==3)for(D=_;D<M;D++)n[D+1]=n[D+1]+(n[D+1-_]>>>1)&255;for(let j=0;j<m;j++)if(x=r+j*M,R=x+j+1,F=n[R-1],D=0,F==0)for(;D<M;D++)n[x+D]=n[R+D];else if(F==1){for(;D<_;D++)n[x+D]=n[R+D];for(;D<M;D++)n[x+D]=n[R+D]+n[x+D-_]}else if(F==2)for(;D<M;D++)n[x+D]=n[R+D]+n[x+D-M];else if(F==3){for(;D<_;D++)n[x+D]=n[R+D]+(n[x+D-M]>>>1);for(;D<M;D++)n[x+D]=n[R+D]+(n[x+D-M]+n[x+D-_]>>>1)}else{for(;D<_;D++)n[x+D]=n[R+D]+o(0,n[x+D-M],0);for(;D<M;D++)n[x+D]=n[R+D]+o(n[x+D-_],n[x+D-M],n[x+D-_-M])}return n}function o(n,s,r){const a=n+s-r,m=a-n,_=a-s,M=a-r;return m*m<=_*_&&m*m<=M*M?n:_*_<=M*M?s:r}function y(n,s,r){r.width=b.readUint(n,s),s+=4,r.height=b.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function v(n,s,r,a,m,_,M,x,R){const F=Math.min(s,m),D=Math.min(r,_);let j=0,h=0;for(let k=0;k<D;k++)for(let g=0;g<F;g++)if(M>=0&&x>=0?(j=k*s+g<<2,h=(x+k)*m+M+g<<2):(j=(-x+k)*s-M+g<<2,h=k*m+g<<2),R==0)a[h]=n[j],a[h+1]=n[j+1],a[h+2]=n[j+2],a[h+3]=n[j+3];else if(R==1){var U=n[j+3]*.00392156862745098,u=n[j]*U,f=n[j+1]*U,w=n[j+2]*U,I=a[h+3]*(1/255),C=a[h]*I,S=a[h+1]*I,A=a[h+2]*I;const c=1-U,z=U+I*c,E=z==0?0:1/z;a[h+3]=255*z,a[h+0]=(u+C*c)*E,a[h+1]=(f+S*c)*E,a[h+2]=(w+A*c)*E}else if(R==2)U=n[j+3],u=n[j],f=n[j+1],w=n[j+2],I=a[h+3],C=a[h],S=a[h+1],A=a[h+2],U==I&&u==C&&f==S&&w==A?(a[h]=0,a[h+1]=0,a[h+2]=0,a[h+3]=0):(a[h]=u,a[h+1]=f,a[h+2]=w,a[h+3]=U);else if(R==3){if(U=n[j+3],u=n[j],f=n[j+1],w=n[j+2],I=a[h+3],C=a[h],S=a[h+1],A=a[h+2],U==I&&u==C&&f==S&&w==A)continue;if(U<220&&I>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let a=8;const m=b,_=m.readUshort,M=m.readUint,x={tabs:{},frames:[]},R=new Uint8Array(r.length);let F,D=0,j=0;const h=[137,80,78,71,13,10,26,10];for(var U=0;U<8;U++)if(r[U]!=h[U])throw"The input is not a PNG file!";for(;a<r.length;){const k=m.readUint(r,a);a+=4;const g=m.readASCII(r,a,4);if(a+=4,g=="IHDR")y(r,a,x);else if(g=="iCCP"){for(var u=a;r[u]!=0;)u++;m.readASCII(r,a,u-a),r[u+1];const c=r.slice(u+2,a+k);let z=null;try{z=i(c)}catch{z=e(c)}x.tabs[g]=z}else if(g=="CgBI")x.tabs[g]=r.slice(a,a+4);else if(g=="IDAT"){for(U=0;U<k;U++)R[D+U]=r[a+U];D+=k}else if(g=="acTL")x.tabs[g]={num_frames:M(r,a),num_plays:M(r,a+4)},F=new Uint8Array(r.length);else if(g=="fcTL"){j!=0&&((A=x.frames[x.frames.length-1]).data=p(x,F.slice(0,j),A.rect.width,A.rect.height),j=0);const c={x:M(r,a+12),y:M(r,a+16),width:M(r,a+4),height:M(r,a+8)};let z=_(r,a+22);z=_(r,a+20)/(z==0?100:z);const E={rect:c,delay:Math.round(1e3*z),dispose:r[a+24],blend:r[a+25]};x.frames.push(E)}else if(g=="fdAT"){for(U=0;U<k-4;U++)F[j+U]=r[a+U+4];j+=k-4}else if(g=="pHYs")x.tabs[g]=[m.readUint(r,a),m.readUint(r,a+4),r[a+8]];else if(g=="cHRM")for(x.tabs[g]=[],U=0;U<8;U++)x.tabs[g].push(m.readUint(r,a+4*U));else if(g=="tEXt"||g=="zTXt"){x.tabs[g]==null&&(x.tabs[g]={});var f=m.nextZero(r,a),w=m.readASCII(r,a,f-a),I=a+k-f-1;if(g=="tEXt")S=m.readASCII(r,f+1,I);else{var C=i(r.slice(f+2,f+2+I));S=m.readUTF8(C,0,C.length)}x.tabs[g][w]=S}else if(g=="iTXt"){x.tabs[g]==null&&(x.tabs[g]={}),f=0,u=a,f=m.nextZero(r,u),w=m.readASCII(r,u,f-u);const c=r[u=f+1];var S;r[u+1],u+=2,f=m.nextZero(r,u),m.readASCII(r,u,f-u),u=f+1,f=m.nextZero(r,u),m.readUTF8(r,u,f-u),I=k-((u=f+1)-a),c==0?S=m.readUTF8(r,u,I):(C=i(r.slice(u,u+I)),S=m.readUTF8(C,0,C.length)),x.tabs[g][w]=S}else if(g=="PLTE")x.tabs[g]=m.readBytes(r,a,k);else if(g=="hIST"){const c=x.tabs.PLTE.length/3;for(x.tabs[g]=[],U=0;U<c;U++)x.tabs[g].push(_(r,a+2*U))}else if(g=="tRNS")x.ctype==3?x.tabs[g]=m.readBytes(r,a,k):x.ctype==0?x.tabs[g]=_(r,a):x.ctype==2&&(x.tabs[g]=[_(r,a),_(r,a+2),_(r,a+4)]);else if(g=="gAMA")x.tabs[g]=m.readUint(r,a)/1e5;else if(g=="sRGB")x.tabs[g]=r[a];else if(g=="bKGD")x.ctype==0||x.ctype==4?x.tabs[g]=[_(r,a)]:x.ctype==2||x.ctype==6?x.tabs[g]=[_(r,a),_(r,a+2),_(r,a+4)]:x.ctype==3&&(x.tabs[g]=r[a]);else if(g=="IEND")break;a+=k,m.readUint(r,a),a+=4}var A;return j!=0&&((A=x.frames[x.frames.length-1]).data=p(x,F.slice(0,j),A.rect.width,A.rect.height)),x.data=p(x,R,x.width,x.height),delete x.compress,delete x.interlace,delete x.filter,x},toRGBA8:function(s){const r=s.width,a=s.height;if(s.tabs.acTL==null)return[d(s.data,r,a,s).buffer];const m=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const _=r*a*4,M=new Uint8Array(_),x=new Uint8Array(_),R=new Uint8Array(_);for(let D=0;D<s.frames.length;D++){const j=s.frames[D],h=j.rect.x,U=j.rect.y,u=j.rect.width,f=j.rect.height,w=d(j.data,u,f,s);if(D!=0)for(var F=0;F<_;F++)R[F]=M[F];if(j.blend==0?v(w,u,f,M,r,a,h,U,0):j.blend==1&&v(w,u,f,M,r,a,h,U,1),m.push(M.buffer.slice(0)),j.dispose!=0){if(j.dispose==1)v(x,u,f,M,r,a,h,U,0);else if(j.dispose==2)for(F=0;F<_;F++)M[F]=R[F]}}return m},_paeth:o,_copyTile:v,_bin:b}}();(function(){const{_copyTile:b}=Ae,{_bin:d}=Ae,p=Ae._paeth;var i={table:function(){const u=new Uint32Array(256);for(let f=0;f<256;f++){let w=f;for(let I=0;I<8;I++)1&w?w=3988292384^w>>>1:w>>>=1;u[f]=w}return u}(),update(u,f,w,I){for(let C=0;C<I;C++)u=i.table[255&(u^f[w+C])]^u>>>8;return u},crc:(u,f,w)=>4294967295^i.update(4294967295,u,f,w)};function e(u,f,w,I){f[w]+=u[0]*I>>4,f[w+1]+=u[1]*I>>4,f[w+2]+=u[2]*I>>4,f[w+3]+=u[3]*I>>4}function t(u){return Math.max(0,Math.min(255,u))}function l(u,f){const w=u[0]-f[0],I=u[1]-f[1],C=u[2]-f[2],S=u[3]-f[3];return w*w+I*I+C*C+S*S}function o(u,f,w,I,C,S,A){A==null&&(A=1);const k=I.length,g=[];for(var c=0;c<k;c++){const T=I[c];g.push([T>>>0&255,T>>>8&255,T>>>16&255,T>>>24&255])}for(c=0;c<k;c++){let T=4294967295;for(var z=0,E=0;E<k;E++){var P=l(g[c],g[E]);E!=c&&P<T&&(T=P,z=E)}}const O=new Uint32Array(C.buffer),N=new Int16Array(f*w*4),$=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(c=0;c<$.length;c++)$[c]=255*(($[c]+.5)/16-.5);for(let T=0;T<w;T++)for(let Q=0;Q<f;Q++){var B;c=4*(T*f+Q),A!=2?B=[t(u[c]+N[c]),t(u[c+1]+N[c+1]),t(u[c+2]+N[c+2]),t(u[c+3]+N[c+3])]:(P=$[4*(3&T)+(3&Q)],B=[t(u[c]+P),t(u[c+1]+P),t(u[c+2]+P),t(u[c+3]+P)]),z=0;let Y=16777215;for(E=0;E<k;E++){const K=l(B,g[E]);K<Y&&(Y=K,z=E)}const V=g[z],q=[B[0]-V[0],B[1]-V[1],B[2]-V[2],B[3]-V[3]];A==1&&(Q!=f-1&&e(q,N,c+4,7),T!=w-1&&(Q!=0&&e(q,N,c+4*f-4,3),e(q,N,c+4*f,5),Q!=f-1&&e(q,N,c+4*f+4,1))),S[c>>2]=z,O[c>>2]=I[z]}}function y(u,f,w,I,C){C==null&&(C={});const{crc:S}=i,A=d.writeUint,k=d.writeUshort,g=d.writeASCII;let c=8;const z=u.frames.length>1;let E,P=!1,O=33+(z?20:0);if(C.sRGB!=null&&(O+=13),C.pHYs!=null&&(O+=21),C.iCCP!=null&&(E=pako.deflate(C.iCCP),O+=21+E.length+4),u.ctype==3){for(var N=u.plte.length,$=0;$<N;$++)u.plte[$]>>>24!=255&&(P=!0);O+=8+3*N+4+(P?8+1*N+4:0)}for(var B=0;B<u.frames.length;B++)z&&(O+=38),O+=(V=u.frames[B]).cimg.length+12,B!=0&&(O+=4);O+=12;const T=new Uint8Array(O),Q=[137,80,78,71,13,10,26,10];for($=0;$<8;$++)T[$]=Q[$];if(A(T,c,13),c+=4,g(T,c,"IHDR"),c+=4,A(T,c,f),c+=4,A(T,c,w),c+=4,T[c]=u.depth,c++,T[c]=u.ctype,c++,T[c]=0,c++,T[c]=0,c++,T[c]=0,c++,A(T,c,S(T,c-17,17)),c+=4,C.sRGB!=null&&(A(T,c,1),c+=4,g(T,c,"sRGB"),c+=4,T[c]=C.sRGB,c++,A(T,c,S(T,c-5,5)),c+=4),C.iCCP!=null){const q=13+E.length;A(T,c,q),c+=4,g(T,c,"iCCP"),c+=4,g(T,c,"ICC profile"),c+=11,c+=2,T.set(E,c),c+=E.length,A(T,c,S(T,c-(q+4),q+4)),c+=4}if(C.pHYs!=null&&(A(T,c,9),c+=4,g(T,c,"pHYs"),c+=4,A(T,c,C.pHYs[0]),c+=4,A(T,c,C.pHYs[1]),c+=4,T[c]=C.pHYs[2],c++,A(T,c,S(T,c-13,13)),c+=4),z&&(A(T,c,8),c+=4,g(T,c,"acTL"),c+=4,A(T,c,u.frames.length),c+=4,A(T,c,C.loop!=null?C.loop:0),c+=4,A(T,c,S(T,c-12,12)),c+=4),u.ctype==3){for(A(T,c,3*(N=u.plte.length)),c+=4,g(T,c,"PLTE"),c+=4,$=0;$<N;$++){const q=3*$,K=u.plte[$],te=255&K,oe=K>>>8&255,Me=K>>>16&255;T[c+q+0]=te,T[c+q+1]=oe,T[c+q+2]=Me}if(c+=3*N,A(T,c,S(T,c-3*N-4,3*N+4)),c+=4,P){for(A(T,c,N),c+=4,g(T,c,"tRNS"),c+=4,$=0;$<N;$++)T[c+$]=u.plte[$]>>>24&255;c+=N,A(T,c,S(T,c-N-4,N+4)),c+=4}}let Y=0;for(B=0;B<u.frames.length;B++){var V=u.frames[B];z&&(A(T,c,26),c+=4,g(T,c,"fcTL"),c+=4,A(T,c,Y++),c+=4,A(T,c,V.rect.width),c+=4,A(T,c,V.rect.height),c+=4,A(T,c,V.rect.x),c+=4,A(T,c,V.rect.y),c+=4,k(T,c,I[B]),c+=2,k(T,c,1e3),c+=2,T[c]=V.dispose,c++,T[c]=V.blend,c++,A(T,c,S(T,c-30,30)),c+=4);const q=V.cimg;A(T,c,(N=q.length)+(B==0?0:4)),c+=4;const K=c;g(T,c,B==0?"IDAT":"fdAT"),c+=4,B!=0&&(A(T,c,Y++),c+=4),T.set(q,c),c+=N,A(T,c,S(T,K,c-K)),c+=4}return A(T,c,0),c+=4,g(T,c,"IEND"),c+=4,A(T,c,S(T,c-4,4)),c+=4,T.buffer}function v(u,f,w){for(let I=0;I<u.frames.length;I++){const C=u.frames[I];C.rect.width;const S=C.rect.height,A=new Uint8Array(S*C.bpl+S);C.cimg=a(C.img,S,C.bpp,C.bpl,A,f,w)}}function n(u,f,w,I,C){const S=C[0],A=C[1],k=C[2],g=C[3],c=C[4],z=C[5];let E=6,P=8,O=255;for(var N=0;N<u.length;N++){const ce=new Uint8Array(u[N]);for(var $=ce.length,B=0;B<$;B+=4)O&=ce[B+3]}const T=O!=255,Q=function(J,Z,de,he,ne,be){const ie=[];for(var X=0;X<J.length;X++){const ge=new Uint8Array(J[X]),we=new Uint32Array(ge.buffer);var ye;let xe=0,_e=0,Ce=Z,je=de,dt=he?1:0;if(X!=0){const Jt=be||he||X==1||ie[X-2].dispose!=0?1:2;let ct=0,vt=1e9;for(let Qe=0;Qe<Jt;Qe++){var Se=new Uint8Array(J[X-1-Qe]);const er=new Uint32Array(J[X-1-Qe]);let Fe=Z,Ue=de,Be=-1,Ge=-1;for(let ze=0;ze<de;ze++)for(let Le=0;Le<Z;Le++)we[fe=ze*Z+Le]!=er[fe]&&(Le<Fe&&(Fe=Le),Le>Be&&(Be=Le),ze<Ue&&(Ue=ze),ze>Ge&&(Ge=ze));Be==-1&&(Fe=Ue=Be=Ge=0),ne&&((1&Fe)==1&&Fe--,(1&Ue)==1&&Ue--);const wt=(Be-Fe+1)*(Ge-Ue+1);wt<vt&&(vt=wt,ct=Qe,xe=Fe,_e=Ue,Ce=Be-Fe+1,je=Ge-Ue+1)}Se=new Uint8Array(J[X-1-ct]),ct==1&&(ie[X-1].dispose=2),ye=new Uint8Array(Ce*je*4),b(Se,Z,de,ye,Ce,je,-xe,-_e,0),dt=b(ge,Z,de,ye,Ce,je,-xe,-_e,3)?1:0,dt==1?r(ge,Z,de,ye,{x:xe,y:_e,width:Ce,height:je}):b(ge,Z,de,ye,Ce,je,-xe,-_e,0)}else ye=ge.slice(0);ie.push({rect:{x:xe,y:_e,width:Ce,height:je},img:ye,blend:dt,dispose:0})}if(he)for(X=0;X<ie.length;X++){if((Te=ie[X]).blend==1)continue;const ge=Te.rect,we=ie[X-1].rect,xe=Math.min(ge.x,we.x),_e=Math.min(ge.y,we.y),Ce={x:xe,y:_e,width:Math.max(ge.x+ge.width,we.x+we.width)-xe,height:Math.max(ge.y+ge.height,we.y+we.height)-_e};ie[X-1].dispose=1,X-1!=0&&s(J,Z,de,ie,X-1,Ce,ne),s(J,Z,de,ie,X,Ce,ne)}let Ze=0;if(J.length!=1)for(var fe=0;fe<ie.length;fe++){var Te;Ze+=(Te=ie[fe]).rect.width*Te.rect.height}return ie}(u,f,w,S,A,k),Y={},V=[],q=[];if(I!=0){const ce=[];for(B=0;B<Q.length;B++)ce.push(Q[B].img.buffer);const J=function(ne){let be=0;for(var ie=0;ie<ne.length;ie++)be+=ne[ie].byteLength;const X=new Uint8Array(be);let ye=0;for(ie=0;ie<ne.length;ie++){const Se=new Uint8Array(ne[ie]),Ze=Se.length;for(let fe=0;fe<Ze;fe+=4){let Te=Se[fe],ge=Se[fe+1],we=Se[fe+2];const xe=Se[fe+3];xe==0&&(Te=ge=we=0),X[ye+fe]=Te,X[ye+fe+1]=ge,X[ye+fe+2]=we,X[ye+fe+3]=xe}ye+=Ze}return X.buffer}(ce),Z=_(J,I);for(B=0;B<Z.plte.length;B++)V.push(Z.plte[B].est.rgba);let de=0;for(B=0;B<Q.length;B++){const he=(te=Q[B]).img.length;var K=new Uint8Array(Z.inds.buffer,de>>2,he>>2);q.push(K);const ne=new Uint8Array(Z.abuf,de,he);z&&o(te.img,te.rect.width,te.rect.height,V,ne,K),te.img.set(ne),de+=he}}else for(N=0;N<Q.length;N++){var te=Q[N];const ce=new Uint32Array(te.img.buffer);var oe=te.rect.width;for($=ce.length,K=new Uint8Array($),q.push(K),B=0;B<$;B++){const J=ce[B];if(B!=0&&J==ce[B-1])K[B]=K[B-1];else if(B>oe&&J==ce[B-oe])K[B]=K[B-oe];else{let Z=Y[J];if(Z==null&&(Y[J]=Z=V.length,V.push(J),V.length>=300))break;K[B]=Z}}}const Me=V.length;for(Me<=256&&c==0&&(P=Me<=2?1:Me<=4?2:Me<=16?4:8,P=Math.max(P,g)),N=0;N<Q.length;N++){(te=Q[N]).rect.x,te.rect.y,oe=te.rect.width;const ce=te.rect.height;let J=te.img;new Uint32Array(J.buffer);let Z=4*oe,de=4;if(Me<=256&&c==0){Z=Math.ceil(P*oe/8);var Ie=new Uint8Array(Z*ce);const he=q[N];for(let ne=0;ne<ce;ne++){B=ne*Z;const be=ne*oe;if(P==8)for(var ee=0;ee<oe;ee++)Ie[B+ee]=he[be+ee];else if(P==4)for(ee=0;ee<oe;ee++)Ie[B+(ee>>1)]|=he[be+ee]<<4-4*(1&ee);else if(P==2)for(ee=0;ee<oe;ee++)Ie[B+(ee>>2)]|=he[be+ee]<<6-2*(3&ee);else if(P==1)for(ee=0;ee<oe;ee++)Ie[B+(ee>>3)]|=he[be+ee]<<7-1*(7&ee)}J=Ie,E=3,de=1}else if(T==0&&Q.length==1){Ie=new Uint8Array(oe*ce*3);const he=oe*ce;for(B=0;B<he;B++){const ne=3*B,be=4*B;Ie[ne]=J[be],Ie[ne+1]=J[be+1],Ie[ne+2]=J[be+2]}J=Ie,E=2,de=3,Z=3*oe}te.img=J,te.bpl=Z,te.bpp=de}return{ctype:E,depth:P,plte:V,frames:Q}}function s(u,f,w,I,C,S,A){const k=Uint8Array,g=Uint32Array,c=new k(u[C-1]),z=new g(u[C-1]),E=C+1<u.length?new k(u[C+1]):null,P=new k(u[C]),O=new g(P.buffer);let N=f,$=w,B=-1,T=-1;for(let Y=0;Y<S.height;Y++)for(let V=0;V<S.width;V++){const q=S.x+V,K=S.y+Y,te=K*f+q,oe=O[te];oe==0||I[C-1].dispose==0&&z[te]==oe&&(E==null||E[4*te+3]!=0)||(q<N&&(N=q),q>B&&(B=q),K<$&&($=K),K>T&&(T=K))}B==-1&&(N=$=B=T=0),A&&((1&N)==1&&N--,(1&$)==1&&$--),S={x:N,y:$,width:B-N+1,height:T-$+1};const Q=I[C];Q.rect=S,Q.blend=1,Q.img=new Uint8Array(S.width*S.height*4),I[C-1].dispose==0?(b(c,f,w,Q.img,S.width,S.height,-S.x,-S.y,0),r(P,f,w,Q.img,S)):b(P,f,w,Q.img,S.width,S.height,-S.x,-S.y,0)}function r(u,f,w,I,C){b(u,f,w,I,C.width,C.height,-C.x,-C.y,2)}function a(u,f,w,I,C,S,A){const k=[];let g,c=[0,1,2,3,4];S!=-1?c=[S]:(f*I>5e5||w==1)&&(c=[0]),A&&(g={level:0});const z=Lr;for(var E=0;E<c.length;E++){for(let N=0;N<f;N++)m(C,u,N,I,w,c[E]);k.push(z.deflate(C,g))}let P,O=1e9;for(E=0;E<k.length;E++)k[E].length<O&&(P=E,O=k[E].length);return k[P]}function m(u,f,w,I,C,S){const A=w*I;let k=A+w;if(u[k]=S,k++,S==0)if(I<500)for(var g=0;g<I;g++)u[k+g]=f[A+g];else u.set(new Uint8Array(f.buffer,A,I),k);else if(S==1){for(g=0;g<C;g++)u[k+g]=f[A+g];for(g=C;g<I;g++)u[k+g]=f[A+g]-f[A+g-C]+256&255}else if(w==0){for(g=0;g<C;g++)u[k+g]=f[A+g];if(S==2)for(g=C;g<I;g++)u[k+g]=f[A+g];if(S==3)for(g=C;g<I;g++)u[k+g]=f[A+g]-(f[A+g-C]>>1)+256&255;if(S==4)for(g=C;g<I;g++)u[k+g]=f[A+g]-p(f[A+g-C],0,0)+256&255}else{if(S==2)for(g=0;g<I;g++)u[k+g]=f[A+g]+256-f[A+g-I]&255;if(S==3){for(g=0;g<C;g++)u[k+g]=f[A+g]+256-(f[A+g-I]>>1)&255;for(g=C;g<I;g++)u[k+g]=f[A+g]+256-(f[A+g-I]+f[A+g-C]>>1)&255}if(S==4){for(g=0;g<C;g++)u[k+g]=f[A+g]+256-p(0,f[A+g-I],0)&255;for(g=C;g<I;g++)u[k+g]=f[A+g]+256-p(f[A+g-C],f[A+g-I],f[A+g-C-I])&255}}}function _(u,f){const w=new Uint8Array(u),I=w.slice(0),C=new Uint32Array(I.buffer),S=M(I,f),A=S[0],k=S[1],g=w.length,c=new Uint8Array(g>>2);let z;if(w.length<2e7)for(var E=0;E<g;E+=4)z=x(A,P=w[E]*(1/255),O=w[E+1]*(1/255),N=w[E+2]*(1/255),$=w[E+3]*(1/255)),c[E>>2]=z.ind,C[E>>2]=z.est.rgba;else for(E=0;E<g;E+=4){var P=w[E]*.00392156862745098,O=w[E+1]*(1/255),N=w[E+2]*(1/255),$=w[E+3]*(1/255);for(z=A;z.left;)z=R(z.est,P,O,N,$)<=0?z.left:z.right;c[E>>2]=z.ind,C[E>>2]=z.est.rgba}return{abuf:I.buffer,inds:c,plte:k}}function M(u,f,w){w==null&&(w=1e-4);const I=new Uint32Array(u.buffer),C={i0:0,i1:u.length,bst:null,est:null,tdst:0,left:null,right:null};C.bst=j(u,C.i0,C.i1),C.est=h(C.bst);const S=[C];for(;S.length<f;){let k=0,g=0;for(var A=0;A<S.length;A++)S[A].est.L>k&&(k=S[A].est.L,g=A);if(k<w)break;const c=S[g],z=F(u,I,c.i0,c.i1,c.est.e,c.est.eMq255);if(c.i0>=z||c.i1<=z){c.est.L=0;continue}const E={i0:c.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};E.bst=j(u,E.i0,E.i1),E.est=h(E.bst);const P={i0:z,i1:c.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:c.bst.N-E.bst.N},A=0;A<16;A++)P.bst.R[A]=c.bst.R[A]-E.bst.R[A];for(A=0;A<4;A++)P.bst.m[A]=c.bst.m[A]-E.bst.m[A];P.est=h(P.bst),c.left=E,c.right=P,S[g]=E,S.push(P)}for(S.sort((k,g)=>g.bst.N-k.bst.N),A=0;A<S.length;A++)S[A].ind=A;return[C,S]}function x(u,f,w,I,C){if(u.left==null)return u.tdst=function(E,P,O,N,$){const B=P-E[0],T=O-E[1],Q=N-E[2],Y=$-E[3];return B*B+T*T+Q*Q+Y*Y}(u.est.q,f,w,I,C),u;const S=R(u.est,f,w,I,C);let A=u.left,k=u.right;S>0&&(A=u.right,k=u.left);const g=x(A,f,w,I,C);if(g.tdst<=S*S)return g;const c=x(k,f,w,I,C);return c.tdst<g.tdst?c:g}function R(u,f,w,I,C){const{e:S}=u;return S[0]*f+S[1]*w+S[2]*I+S[3]*C-u.eMq}function F(u,f,w,I,C,S){for(I-=4;w<I;){for(;D(u,w,C)<=S;)w+=4;for(;D(u,I,C)>S;)I-=4;if(w>=I)break;const A=f[w>>2];f[w>>2]=f[I>>2],f[I>>2]=A,w+=4,I-=4}for(;D(u,w,C)>S;)w-=4;return w+4}function D(u,f,w){return u[f]*w[0]+u[f+1]*w[1]+u[f+2]*w[2]+u[f+3]*w[3]}function j(u,f,w){const I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0],S=w-f>>2;for(let A=f;A<w;A+=4){const k=u[A]*.00392156862745098,g=u[A+1]*(1/255),c=u[A+2]*(1/255),z=u[A+3]*(1/255);C[0]+=k,C[1]+=g,C[2]+=c,C[3]+=z,I[0]+=k*k,I[1]+=k*g,I[2]+=k*c,I[3]+=k*z,I[5]+=g*g,I[6]+=g*c,I[7]+=g*z,I[10]+=c*c,I[11]+=c*z,I[15]+=z*z}return I[4]=I[1],I[8]=I[2],I[9]=I[6],I[12]=I[3],I[13]=I[7],I[14]=I[11],{R:I,m:C,N:S}}function h(u){const{R:f}=u,{m:w}=u,{N:I}=u,C=w[0],S=w[1],A=w[2],k=w[3],g=I==0?0:1/I,c=[f[0]-C*C*g,f[1]-C*S*g,f[2]-C*A*g,f[3]-C*k*g,f[4]-S*C*g,f[5]-S*S*g,f[6]-S*A*g,f[7]-S*k*g,f[8]-A*C*g,f[9]-A*S*g,f[10]-A*A*g,f[11]-A*k*g,f[12]-k*C*g,f[13]-k*S*g,f[14]-k*A*g,f[15]-k*k*g],z=c,E=U;let P=[Math.random(),Math.random(),Math.random(),Math.random()],O=0,N=0;if(I!=0)for(let B=0;B<16&&(P=E.multVec(z,P),N=Math.sqrt(E.dot(P,P)),P=E.sml(1/N,P),!(B!=0&&Math.abs(N-O)<1e-9));B++)O=N;const $=[C*g,S*g,A*g,k*g];return{Cov:c,q:$,e:P,L:O,eMq255:E.dot(E.sml(255,$),P),eMq:E.dot(P,$),rgba:(Math.round(255*$[3])<<24|Math.round(255*$[2])<<16|Math.round(255*$[1])<<8|Math.round(255*$[0])<<0)>>>0}}var U={multVec:(u,f)=>[u[0]*f[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3],u[4]*f[0]+u[5]*f[1]+u[6]*f[2]+u[7]*f[3],u[8]*f[0]+u[9]*f[1]+u[10]*f[2]+u[11]*f[3],u[12]*f[0]+u[13]*f[1]+u[14]*f[2]+u[15]*f[3]],dot:(u,f)=>u[0]*f[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3],sml:(u,f)=>[u*f[0],u*f[1],u*f[2],u*f[3]]};Ae.encode=function(f,w,I,C,S,A,k){C==null&&(C=0),k==null&&(k=!1);const g=n(f,w,I,C,[!1,!1,!1,0,k,!1]);return v(g,-1),y(g,w,I,S,A)},Ae.encodeLL=function(f,w,I,C,S,A,k,g){const c={ctype:0+(C==1?0:2)+(S==0?0:4),depth:A,frames:[]},z=(C+S)*A,E=z*w;for(let P=0;P<f.length;P++)c.frames.push({rect:{x:0,y:0,width:w,height:I},img:new Uint8Array(f[P]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(E/8)});return v(c,0,!0),y(c,w,I,k,g)},Ae.encode.compress=n,Ae.encode.dither=o,Ae.quantize=_,Ae.quantize.getKDtree=M,Ae.quantize.getNearest=x})();const $t={toArrayBuffer(b,d){const p=b.width,i=b.height,e=p<<2,t=b.getContext("2d").getImageData(0,0,p,i),l=new Uint32Array(t.data.buffer),o=(32*p+31)/32<<2,y=o*i,v=122+y,n=new ArrayBuffer(v),s=new DataView(n),r=1<<20;let a,m,_,M,x=r,R=0,F=0,D=0;function j(u){s.setUint16(F,u,!0),F+=2}function h(u){s.setUint32(F,u,!0),F+=4}function U(u){F+=u}j(19778),h(v),U(4),h(122),h(108),h(p),h(-i>>>0),j(1),j(32),h(3),h(y),h(2835),h(2835),U(8),h(16711680),h(65280),h(255),h(4278190080),h(1466527264),function u(){for(;R<i&&x>0;){for(M=122+R*o,a=0;a<e;)x--,m=l[D++],_=m>>>24,s.setUint32(M+a,m<<8|_),a+=4;R++}D<l.length?(x=r,setTimeout(u,$t._dly)):d(n)}()},toBlob(b,d){this.toArrayBuffer(b,p=>{d(new Blob([p],{type:"image/bmp"}))})},_dly:9};var me={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Pr={[me.CHROME]:16384,[me.FIREFOX]:11180,[me.DESKTOP_SAFARI]:16384,[me.IE]:8192,[me.IOS]:4096,[me.ETC]:8192};const yt=typeof window<"u",Ht=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,st=yt&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Br=(yt||Ht)&&(st&&st.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Qt=(yt||Ht)&&(st&&st.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function xt(b,d,p=Date.now()){return new Promise(i=>{const e=b.split(","),t=e[0].match(/:(.*?);/)[1],l=globalThis.atob(e[1]);let o=l.length;const y=new Uint8Array(o);for(;o--;)y[o]=l.charCodeAt(o);const v=new Blob([y],{type:t});v.name=d,v.lastModified=p,i(v)})}function Gt(b){return new Promise((d,p)=>{const i=new Qt;i.onload=()=>d(i.result),i.onerror=e=>p(e),i.readAsDataURL(b)})}function qt(b){return new Promise((d,p)=>{const i=new Image;i.onload=()=>d(i),i.onerror=e=>p(e),i.src=b})}function Pe(){if(Pe.cachedResult!==void 0)return Pe.cachedResult;let b=me.ETC;const{userAgent:d}=navigator;return/Chrom(e|ium)/i.test(d)?b=me.CHROME:/iP(ad|od|hone)/i.test(d)&&/WebKit/i.test(d)?b=me.IOS:/Safari/i.test(d)?b=me.DESKTOP_SAFARI:/Firefox/i.test(d)?b=me.FIREFOX:(/MSIE/i.test(d)||document.documentMode)&&(b=me.IE),Pe.cachedResult=b,Pe.cachedResult}function Vt(b,d){const p=Pe(),i=Pr[p];let e=b,t=d,l=e*t;const o=e>t?t/e:e/t;for(;l>i*i;){const y=(i+e)/2,v=(i+t)/2;y<v?(t=v,e=v*o):(t=y*o,e=y),l=e*t}return{width:e,height:t}}function lt(b,d){let p,i;try{if(p=new OffscreenCanvas(b,d),i=p.getContext("2d"),i===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{p=document.createElement("canvas"),i=p.getContext("2d")}return p.width=b,p.height=d,[p,i]}function Kt(b,d){const{width:p,height:i}=Vt(b.width,b.height),[e,t]=lt(p,i);return d&&/jpe?g/.test(d)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(b,0,0,e.width,e.height),e}function Je(){return Je.cachedResult!==void 0||(Je.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Je.cachedResult}function ot(b,d={}){return new Promise(function(p,i){let e,t;var l=function(){try{return t=Kt(e,d.fileType||b.type),p([e,t])}catch(y){return i(y)}},o=function(y){try{var v=function(n){try{throw n}catch(s){return i(s)}};try{let n;return Gt(b).then(function(s){try{return n=s,qt(n).then(function(r){try{return e=r,function(){try{return l()}catch(a){return i(a)}}()}catch(a){return v(a)}},v)}catch(r){return v(r)}},v)}catch(n){v(n)}}catch(n){return i(n)}};try{if(Je()||[me.DESKTOP_SAFARI,me.MOBILE_SAFARI].includes(Pe()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(b).then(function(y){try{return e=y,l()}catch{return o()}},o)}catch{o()}})}function at(b,d,p,i,e=1){return new Promise(function(t,l){let o;if(d==="image/png"){let v,n,s;return v=b.getContext("2d"),{data:n}=v.getImageData(0,0,b.width,b.height),s=Ae.encode([n.buffer],b.width,b.height,4096*e),o=new Blob([s],{type:d}),o.name=p,o.lastModified=i,y.call(this)}{let v=function(){return y.call(this)};if(d==="image/bmp")return new Promise(n=>$t.toBlob(b,n)).then((function(n){try{return o=n,o.name=p,o.lastModified=i,v.call(this)}catch(s){return l(s)}}).bind(this),l);{let n=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&b instanceof OffscreenCanvas)return b.convertToBlob({type:d,quality:e}).then((function(s){try{return o=s,o.name=p,o.lastModified=i,n.call(this)}catch(r){return l(r)}}).bind(this),l);{let s;return s=b.toDataURL(d,e),xt(s,p,i).then((function(r){try{return o=r,n.call(this)}catch(a){return l(a)}}).bind(this),l)}}}function y(){return t(o)}})}function De(b){b.width=0,b.height=0}function $e(){return new Promise(function(b,d){let p,i,e,t;return $e.cachedResult!==void 0?b($e.cachedResult):xt("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(l){try{return p=l,ot(p).then(function(o){try{return i=o[1],at(i,p.type,p.name,p.lastModified).then(function(y){try{return e=y,De(i),ot(e).then(function(v){try{return t=v[0],$e.cachedResult=t.width===1&&t.height===2,b($e.cachedResult)}catch(n){return d(n)}},d)}catch(v){return d(v)}},d)}catch(y){return d(y)}},d)}catch(o){return d(o)}},d)})}function Zt(b){return new Promise((d,p)=>{const i=new Qt;i.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return d(-2);const l=t.byteLength;let o=2;for(;o<l;){if(t.getUint16(o+2,!1)<=8)return d(-1);const y=t.getUint16(o,!1);if(o+=2,y==65505){if(t.getUint32(o+=2,!1)!=1165519206)return d(-1);const v=t.getUint16(o+=6,!1)==18761;o+=t.getUint32(o+4,v);const n=t.getUint16(o,v);o+=2;for(let s=0;s<n;s++)if(t.getUint16(o+12*s,v)==274)return d(t.getUint16(o+12*s+8,v))}else{if((65280&y)!=65280)break;o+=t.getUint16(o,!1)}}return d(-1)},i.onerror=e=>p(e),i.readAsArrayBuffer(b)})}function Xt(b,d){const{width:p}=b,{height:i}=b,{maxWidthOrHeight:e}=d;let t,l=b;return isFinite(e)&&(p>e||i>e)&&([l,t]=lt(p,i),p>i?(l.width=e,l.height=i/p*e):(l.width=p/i*e,l.height=e),t.drawImage(b,0,0,l.width,l.height),De(b)),l}function Yt(b,d){const{width:p}=b,{height:i}=b,[e,t]=lt(p,i);switch(d>4&&d<9?(e.width=i,e.height=p):(e.width=p,e.height=i),d){case 2:t.transform(-1,0,0,1,p,0);break;case 3:t.transform(-1,0,0,-1,p,i);break;case 4:t.transform(1,0,0,-1,0,i);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,i,0);break;case 7:t.transform(0,-1,-1,0,i,p);break;case 8:t.transform(0,-1,1,0,0,p)}return t.drawImage(b,0,0,p,i),De(b),e}function Et(b,d,p=0){return new Promise(function(i,e){let t,l,o,y,v,n,s,r,a,m,_,M,x,R,F,D,j,h,U,u;function f(I=5){if(d.signal&&d.signal.aborted)throw d.signal.reason;t+=I,d.onProgress(Math.min(t,100))}function w(I){if(d.signal&&d.signal.aborted)throw d.signal.reason;t=Math.min(Math.max(I,t),100),d.onProgress(t)}return t=p,l=d.maxIteration||10,o=1024*d.maxSizeMB*1024,f(),ot(b,d).then((function(I){try{return[,y]=I,f(),v=Xt(y,d),f(),new Promise(function(C,S){var A;if(!(A=d.exifOrientation))return Zt(b).then((function(g){try{return A=g,k.call(this)}catch(c){return S(c)}}).bind(this),S);function k(){return C(A)}return k.call(this)}).then((function(C){try{return n=C,f(),$e().then((function(S){try{return s=S?v:Yt(v,n),f(),r=d.initialQuality||1,a=d.fileType||b.type,at(s,a,b.name,b.lastModified,r).then((function(A){try{{let g=function(){if(l--&&(F>o||F>x)){let z,E;return z=u?.95*U.width:U.width,E=u?.95*U.height:U.height,[j,h]=lt(z,E),h.drawImage(U,0,0,z,E),r*=a==="image/png"?.85:.95,at(j,a,b.name,b.lastModified,r).then(function(P){try{return D=P,De(U),U=j,F=D.size,w(Math.min(99,Math.floor((R-F)/(R-o)*100))),g}catch(O){return e(O)}},e)}return[1]},c=function(){return De(U),De(j),De(v),De(s),De(y),w(100),i(D)};if(m=A,f(),_=m.size>o,M=m.size>b.size,!_&&!M)return w(100),i(m);var k;return x=b.size,R=m.size,F=R,U=s,u=!d.alwaysKeepResolution&&_,(k=(function(z){for(;z;){if(z.then)return void z.then(k,e);try{if(z.pop){if(z.length)return z.pop()?c.call(this):z;z=g}else z=z.call(this)}catch(E){return e(E)}}}).bind(this))(g)}}catch(g){return e(g)}}).bind(this),e)}catch(A){return e(A)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)})}const Or=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let pt;function Nr(b,d){return new Promise((p,i)=>{pt||(pt=function(l){const o=[];return o.push(l),URL.createObjectURL(new Blob(o))}(Or));const e=new Worker(pt);e.addEventListener("message",function(l){if(d.signal&&d.signal.aborted)e.terminate();else if(l.data.progress===void 0){if(l.data.error)return i(new Error(l.data.error)),void e.terminate();p(l.data.file),e.terminate()}else d.onProgress(l.data.progress)}),e.addEventListener("error",i),d.signal&&d.signal.addEventListener("abort",()=>{i(d.signal.reason),e.terminate()}),e.postMessage({file:b,imageCompressionLibUrl:d.libURL,options:{...d,onProgress:void 0,signal:void 0}})})}function ue(b,d){return new Promise(function(p,i){let e,t,l,o,y,v;if(e={...d},l=0,{onProgress:o}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=a=>{l=a,typeof o=="function"&&o(l)},!(b instanceof Blob||b instanceof Br))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(b.type))return i(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||v)return Et(b,e).then((function(a){try{return t=a,r.call(this)}catch(m){return i(m)}}).bind(this),i);var n=(function(){try{return r.call(this)}catch(a){return i(a)}}).bind(this),s=function(a){try{return Et(b,e).then(function(m){try{return t=m,n()}catch(_){return i(_)}},i)}catch(m){return i(m)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Nr(b,e).then(function(a){try{return t=a,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=b.name,t.lastModified=b.lastModified}catch{}try{e.preserveExif&&b.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===b.type)&&(t=Wt(b,t))}catch{}return p(t)}})}ue.getDataUrlFromFile=Gt,ue.getFilefromDataUrl=xt,ue.loadImage=qt,ue.drawImageInCanvas=Kt,ue.drawFileInCanvas=ot,ue.canvasToFile=at,ue.getExifOrientation=Zt,ue.handleMaxWidthOrHeight=Xt,ue.followExifOrientation=Yt,ue.cleanupCanvasMemory=De,ue.isAutoOrientationInBrowser=$e,ue.approximateBelowMaximumCanvasSizeOfBrowser=Vt,ue.copyExifWithoutOrientation=Wt,ue.getBrowserName=Pe,ue.version="2.0.2";const nn=({images:b,onImagesChange:d,storagePath:p,disabled:i=!1})=>{const[e,t]=le.useState(!1),[l,o]=le.useState(0),[y,v]=le.useState(null),[n,s]=le.useState(null),r=le.useRef(null),a=async x=>{const R=Array.from(x.target.files||[]);if(R.length!==0){t(!0),s(null),o(0);try{const F=et(),D=[];for(let j=0;j<R.length;j++){const h=R[j];let U=h;h.size>1024*1024&&(U=await ue(h,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}));const u=`${Date.now()}_${mt()}.${U.type.split("/")[1]}`,f=`${p}/${u}`,w=tt(F,f),I=kt(w,U);await new Promise((C,S)=>{I.on("state_changed",A=>{const k=(j+A.bytesTransferred/A.totalBytes)/R.length*100;o(k)},A=>{console.error("Upload error:",A),S(A)},async()=>{const A=await Mt(I.snapshot.ref);D.push({url:A,path:f,title:h.name.replace(/\.[^/.]+$/,"")}),C()})})}d([...b,...D])}catch(F){console.error("Error uploading images:",F),s("Failed to upload images. Please try again.")}finally{t(!1),o(0),r.current&&(r.current.value="")}}},m=async x=>{const R=b[x];try{const F=et(),D=tt(F,R.path);await Tt(D);const j=b.filter((h,U)=>U!==x);d(j)}catch(F){console.error("Error deleting image:",F),s("Failed to delete image. It may have been already deleted.");const D=b.filter((j,h)=>h!==x);d(D)}},_=le.useCallback((x,R)=>{const F=[...b];F[x]={...F[x],title:R},d(F)},[b,d]),M=x=>{v(x)};return L.jsxs(se,{children:[L.jsxs(se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:H[3]},children:[L.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:H[2]},children:[L.jsx(St,{sx:{color:W.text.tertiary}}),L.jsx(ae,{variant:"h6",sx:{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.semibold,color:W.text.primary},children:"Images"}),L.jsxs(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:G.fontSize.sm},children:[b.length," ",b.length===1?"image":"images"]})]}),L.jsx(rt,{variant:"outlined",startIcon:L.jsx(Lt,{}),onClick:()=>{var x;return(x=r.current)==null?void 0:x.click()},disabled:i||e,sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium},children:"Upload Images"}),L.jsx("input",{ref:r,type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:a,disabled:i})]}),e&&L.jsxs(se,{sx:{mb:H[3]},children:[L.jsx(Pt,{variant:"determinate",value:l}),L.jsxs(ae,{variant:"caption",sx:{color:W.text.tertiary,mt:H[1],display:"block"},children:["Uploading... ",Math.round(l),"%"]})]}),n&&L.jsx(Bt,{severity:"error",onClose:()=>s(null),sx:{mb:H[3]},children:n}),b.length>0?L.jsx(Ft,{container:!0,spacing:H[2],children:b.map((x,R)=>L.jsx(Ft,{item:!0,xs:12,sm:6,md:4,children:L.jsxs(ur,{sx:{borderRadius:re.lg,boxShadow:It.sm,transition:"all 0.2s","&:hover":{boxShadow:It.md}},children:[L.jsx(hr,{component:"img",height:"160",image:x.url,alt:x.title,sx:{objectFit:"cover",cursor:"pointer"},onClick:()=>M(x)}),L.jsx(gr,{sx:{p:H[2]},children:L.jsx(pr,{fullWidth:!0,size:"small",placeholder:"Image title...",value:x.title,onChange:F=>_(R,F.target.value),disabled:i,sx:{"& .MuiInputBase-root":{fontSize:G.fontSize.sm}}})}),L.jsxs(mr,{sx:{px:H[2],pb:H[2],pt:0,justifyContent:"space-between"},children:[L.jsx(nt,{title:"View fullscreen",children:L.jsx(He,{size:"small",onClick:()=>M(x),children:L.jsx(br,{fontSize:"small"})})}),L.jsx(nt,{title:"Delete image",children:L.jsx(He,{size:"small",onClick:()=>m(R),disabled:i,sx:{color:W.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:L.jsx(Ot,{fontSize:"small"})})})]})]})},R))}):L.jsxs(se,{sx:{border:`2px dashed ${W.neutral[300]}`,borderRadius:re.lg,p:H[6],textAlign:"center",backgroundColor:W.background.secondary},children:[L.jsx(St,{sx:{fontSize:48,color:W.text.tertiary,mb:H[2]}}),L.jsx(ae,{variant:"body1",sx:{color:W.text.secondary,mb:H[1]},children:"No images yet"}),L.jsxs(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:G.fontSize.sm},children:['Click "Upload Images" to add images to this ',p.includes("design")?"design":p.includes("build")?"build":"test"]})]}),L.jsx(jt,{open:!!y,onClose:()=>v(null),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{backgroundColor:W.background.primary,borderRadius:re.xl}},children:L.jsx(zt,{sx:{p:0,position:"relative"},children:y&&L.jsxs(L.Fragment,{children:[L.jsx(He,{onClick:()=>v(null),sx:{position:"absolute",top:H[2],right:H[2],backgroundColor:"rgba(0, 0, 0, 0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"},zIndex:1},children:L.jsx(yr,{})}),L.jsx("img",{src:y.url,alt:y.title,style:{width:"100%",height:"auto",display:"block"}}),y.title&&L.jsx(se,{sx:{p:H[3],backgroundColor:W.background.secondary},children:L.jsx(ae,{variant:"h6",sx:{fontFamily:G.fontFamily.display,color:W.text.primary},children:y.title})})]})})})]})},Wr=b=>{var p;switch((p=b.split(".").pop())==null?void 0:p.toLowerCase()){case"pdf":return L.jsx(Fr,{sx:{color:"#D32F2F"}});case"doc":case"docx":return L.jsx(Ut,{sx:{color:"#1976D2"}});case"xls":case"xlsx":case"csv":return L.jsx(Sr,{sx:{color:"#2E7D32"}});case"txt":case"md":return L.jsx(Ut,{sx:{color:W.text.secondary}});case"json":case"xml":case"html":case"css":case"js":case"ts":return L.jsx(_r,{sx:{color:"#F57C00"}});case"zip":case"rar":case"7z":return L.jsx(Dr,{sx:{color:"#5E35B1"}});default:return L.jsx(bt,{sx:{color:W.text.tertiary}})}},sn=({files:b,onFilesChange:d,storagePath:p,disabled:i=!1,maxFileSize:e=10,allowedTypes:t=[]})=>{const[l,o]=le.useState(!1),[y,v]=le.useState(0),[n,s]=le.useState(""),[r,a]=le.useState(null),m=le.useRef(null),_=le.useCallback(R=>{var D;const F=e*1024*1024;if(R.size>F)return`File size exceeds ${e}MB limit`;if(t.length>0){const j=`.${(D=R.name.split(".").pop())==null?void 0:D.toLowerCase()}`;if(!t.some(U=>U.startsWith(".")?U.toLowerCase()===j:R.type===U))return`File type not allowed. Allowed types: ${t.join(", ")}`}return null},[e,t]),M=async R=>{const F=Array.from(R.target.files||[]);if(F.length!==0){o(!0),a(null),v(0);try{const D=et(),j=[];for(let h=0;h<F.length;h++){const U=F[h];s(U.name);const u=_(U);if(u){a(u);continue}const f=U.name.split(".").pop(),w=`${Date.now()}_${mt()}.${f}`,I=`${p}/files/${w}`,C=tt(D,I),S=kt(C,U);await new Promise((A,k)=>{S.on("state_changed",g=>{const c=(h+g.bytesTransferred/g.totalBytes)/F.length*100;v(c)},g=>{console.error("Upload error:",g),k(g)},async()=>{const g=await Mt(S.snapshot.ref);j.push({id:mt(),url:g,name:U.name,path:I}),A()})})}d([...b,...j])}catch(D){console.error("Error uploading files:",D),a("Failed to upload files. Please try again.")}finally{o(!1),v(0),s(""),m.current&&(m.current.value="")}}},x=async R=>{const F=b[R];try{const D=et(),j=tt(D,F.path);await Tt(j);const h=b.filter((U,u)=>u!==R);d(h)}catch(D){console.error("Error deleting file:",D),a("Failed to delete file. It may have been already deleted.");const j=b.filter((h,U)=>U!==R);d(j)}};return L.jsxs(se,{children:[L.jsxs(se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:H[3]},children:[L.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:H[2]},children:[L.jsx(bt,{sx:{color:W.text.tertiary}}),L.jsx(ae,{variant:"h6",sx:{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.semibold,color:W.text.primary},children:"Files"}),L.jsxs(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:G.fontSize.sm},children:[b.length," ",b.length===1?"file":"files"]})]}),L.jsx(rt,{variant:"outlined",startIcon:L.jsx(Lt,{}),onClick:()=>{var R;return(R=m.current)==null?void 0:R.click()},disabled:i||l,sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium},children:"Upload Files"}),L.jsx("input",{ref:m,type:"file",multiple:!0,style:{display:"none"},onChange:M,disabled:i,accept:t.length>0?t.join(","):void 0})]}),l&&L.jsxs(se,{sx:{mb:H[3]},children:[L.jsxs(ae,{variant:"caption",sx:{color:W.text.secondary,mb:H[1],display:"block"},children:["Uploading ",n,"..."]}),L.jsx(Pt,{variant:"determinate",value:y}),L.jsxs(ae,{variant:"caption",sx:{color:W.text.tertiary,mt:H[1],display:"block"},children:[Math.round(y),"%"]})]}),r&&L.jsx(Bt,{severity:"error",onClose:()=>a(null),sx:{mb:H[3]},children:r}),b.length>0?L.jsx(xr,{sx:{border:`1px solid ${W.neutral[200]}`,borderRadius:re.lg,backgroundColor:W.background.secondary,overflow:"hidden"},children:b.map((R,F)=>{var D;return L.jsxs(vr,{sx:{borderBottom:F<b.length-1?`1px solid ${W.neutral[200]}`:"none","&:hover":{backgroundColor:W.neutral[50]}},children:[L.jsx(wr,{children:Wr(R.name)}),L.jsx(Ar,{primary:L.jsx(ae,{variant:"body2",sx:{fontWeight:G.fontWeight.medium,color:W.text.primary},children:R.name}),secondary:L.jsxs(ae,{variant:"caption",sx:{color:W.text.tertiary},children:[(D=R.name.split(".").pop())==null?void 0:D.toUpperCase()," file"]})}),L.jsx(Ir,{children:L.jsx(He,{edge:"end",onClick:()=>x(F),disabled:i,sx:{color:W.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:L.jsx(Ot,{})})})]},R.id)})}):L.jsxs(se,{sx:{border:`2px dashed ${W.neutral[300]}`,borderRadius:re.lg,p:H[6],textAlign:"center",backgroundColor:W.background.secondary},children:[L.jsx(bt,{sx:{fontSize:48,color:W.text.tertiary,mb:H[2]}}),L.jsx(ae,{variant:"body1",sx:{color:W.text.secondary,mb:H[1]},children:"No files attached"}),L.jsx(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:G.fontSize.sm},children:'Click "Upload Files" to attach documents, data files, or other resources'}),e&&L.jsx(Cr,{label:`Max file size: ${e}MB`,size:"small",sx:{mt:H[2]}})]})]})};export{en as C,sn as F,nn as I,tn as R,rn as a,Xr as b,Zr as c,Jr as d,Yr as e,Kr as i,kr as l,Vr as u};
