import{j as e,B as c,a as p,c as te,T as d,n as O,o as _,p as L,q as J,s as K,r as o,C as ne,G as m,S as ae,A as le,I as D,aq as re,x as ie,m as oe,f as ce,h as de,w as ue}from"./ui-CMMQRcxn.js";import{u as C,b as Q,e as he,B as xe}from"./index-COMDOZ5h.js";import{P as F,e as U,y as pe,i as me,f as be,R as G,x as H,t as M,_ as q,I as fe}from"./firebase-DlMVyB9t.js";import"./vendor-DeqkGhWy.js";const je=()=>{const s=C(),a=()=>{s("/")};return e.jsxs(c,{children:[e.jsx(c,{className:"supplemental-header",children:e.jsx(p,{variant:"text",startIcon:e.jsx(te,{}),onClick:a,className:"supplemental-back-button",children:"Home Page"})}),e.jsx(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(d,{className:"supplemental-title",children:"Course Materials"})})]})},ge=({selectedCourse:s})=>{const a=C();return e.jsx(p,{className:"add-material-button",variant:"contained",color:"primary",disabled:!s,onClick:()=>s&&a(`/add-material?course=${s}`),children:"+ Add Material"})},Ce=({materialId:s,open:a,onClose:n,onDelete:l})=>{const i=F(),u=async()=>{const h=U(i,"materials",s);await pe(h),l(),n()};return e.jsxs(O,{open:a,onClose:n,children:[e.jsx(_,{children:"Delete Material"}),e.jsx(L,{children:e.jsx(J,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(K,{children:[e.jsx(p,{onClick:n,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:u,color:"secondary",children:"Delete"})]})]})},ye=({materialId:s,onClick:a})=>e.jsx(p,{variant:"contained",color:"error",onClick:()=>a(s),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),ke=({materialId:s,open:a,onClose:n,onUnpublish:l})=>{const i=F(),u=async()=>{const h=U(i,"materials",s);await me(h,{published:!1}),l(),n()};return e.jsxs(O,{open:a,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(_,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(L,{children:e.jsx(J,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(K,{children:[e.jsx(p,{onClick:n,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:u,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},ve=({initialCourse:s})=>{const{userDetails:a}=Q(),n=F(),[l,i]=o.useState([]),[u,h]=o.useState(!0),[V,N]=o.useState(!1),[b,T]=o.useState(!1),[r,X]=o.useState(s??null),[y,$]=o.useState(null),[f,B]=o.useState({open:!1,materialId:null}),[k,v]=o.useState(null),S=C(),E=o.useCallback(async()=>{if(!r)return;const t=U(n,"courses",r),j=await be(t);if(j.exists()){const x=j.data(),g=(x==null?void 0:x.courseAdmin)||[];T(g.includes(a==null?void 0:a.uid))}else T(!1)},[r,n,a]);o.useEffect(()=>{r&&E()},[r,E]),o.useEffect(()=>{s&&r!==s&&X(s)},[s,r]),o.useEffect(()=>{if(!r){console.log("No course selected"),i([]),h(!1);return}console.log(`Fetching materials for course: ${r}`),h(!0);const t=a!=null&&a.isAdmin?G(q(n,"materials"),M("course","==",r),H("timestamp","desc")):G(q(n,"materials"),M("course","==",r),M("published","==",!0),H("timestamp","desc")),j=fe(t,x=>{const g=x.docs.map(z=>({id:z.id,...z.data()}));i(g),console.log(`Fetched ${g.length} materials for course: ${r}`),h(!1)},x=>{console.error(x),v("Failed to fetch materials"),h(!1)});return()=>j()},[n,r,a]);const w=t=>{$(t),N(!0)},Y=()=>{N(!1),$(null)},Z=()=>{i(l.filter(t=>t.id!==y))},I=t=>{B({open:!0,materialId:t})},ee=()=>{i(l.map(t=>t.id===f.materialId?{...t,published:!1}:t))},se=()=>{B({open:!1,materialId:null})};if(u)return e.jsx(ne,{});const R=l.filter(t=>!t.published&&!t.scheduledTimestamp),P=l.filter(t=>t.scheduledTimestamp&&!t.published),W=l.filter(t=>t.published);return e.jsxs(c,{sx:{width:"100%"},children:[l.length===0&&r&&e.jsx(d,{variant:"body1",align:"center",sx:{width:"100%",mb:4},children:"No materials found for the selected course."}),b&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{mb:4},children:[e.jsx(d,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00",mb:2},children:"Saved"}),e.jsx(m,{container:!0,spacing:3,children:R.length===0?e.jsx(d,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):R.map(t=>e.jsx(A,{material:t,isCourseAdmin:b,navigate:S,selectedCourse:r||"",onDeleteClick:w,onUnpublishClick:I},t.id))})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(d,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1",mb:2},children:"Publish Scheduled"}),e.jsx(m,{container:!0,spacing:3,children:P.length===0?e.jsx(d,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):P.map(t=>e.jsx(A,{material:t,isCourseAdmin:b,navigate:S,selectedCourse:r||"",onDeleteClick:w,onUnpublishClick:I},t.id))})]})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(d,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32",mb:2},children:"Published"}),e.jsx(m,{container:!0,spacing:3,children:W.length===0?e.jsx(d,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):W.map(t=>e.jsx(A,{material:t,isCourseAdmin:b,navigate:S,selectedCourse:r||"",onDeleteClick:w,onUnpublishClick:I},t.id))})]}),y&&e.jsx(Ce,{materialId:y,open:V,onClose:Y,onDelete:Z}),f.materialId&&e.jsx(ke,{materialId:f.materialId,open:f.open,onClose:se,onUnpublish:ee}),k&&e.jsx(ae,{open:!0,autoHideDuration:6e3,onClose:()=>v(null),children:e.jsx(le,{onClose:()=>v(null),severity:"error",children:k})},k)]})},A=({material:s,isCourseAdmin:a,navigate:n,selectedCourse:l,onDeleteClick:i,onUnpublishClick:u})=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:s.published?"#E8F5E9":"#FFF9C4"},children:[e.jsx(D,{onClick:()=>n(`/view-material/${s.id}?course=${l}`),"aria-label":"view",children:e.jsx(re,{})}),e.jsx(d,{variant:"h6",children:s.title||"Untitled"}),e.jsx(c,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:a&&e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>n(`/edit-material/${s.id}?course=${l}`),"aria-label":"edit",children:e.jsx(ie,{})}),e.jsx(D,{onClick:()=>i(s.id),"aria-label":"delete",children:e.jsx(oe,{})}),s.published&&e.jsx(ye,{materialId:s.id,onClick:u})]})})]})}),Se=({courses:s})=>{const a=C();return e.jsxs(c,{sx:{width:"100%",padding:4},children:[e.jsx(d,{variant:"h5",align:"center",sx:{mt:3,pb:2,fontFamily:"Staatliches, sans-serif",fontSize:"2rem",color:"#00695c",textTransform:"uppercase",letterSpacing:"1px"},children:"Select a Course"}),e.jsx(m,{container:!0,spacing:4,justifyContent:"center",children:s.map(n=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(ce,{onClick:()=>a(`/supplemental-materials?course=${n.id}`),sx:{cursor:"pointer",borderRadius:"15px",transition:"transform 0.3s, box-shadow 0.3s","&:hover":{transform:"scale(1.05)",boxShadow:"0 6px 20px rgba(0, 0, 0, 0.1)"},boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:e.jsxs(de,{sx:{textAlign:"center",padding:3,backgroundColor:"#e0f7fa","&:hover":{backgroundColor:"#b2ebf2"}},children:[e.jsx(d,{variant:"h5",sx:{fontFamily:"Staatliches, sans-serif",fontSize:"1.5rem",color:"#006064"},children:n.number}),e.jsx(d,{variant:"body1",sx:{fontFamily:"Gabarito, sans-serif",fontSize:"1rem",color:"#004d40",marginTop:1},children:n.title})]})})},n.id))})]})},Ae=()=>{const{userDetails:s}=Q(),[a]=he(),n=a.get("course")||null,l=o.useMemo(()=>s!=null&&s.classes?Object.entries(s.classes).map(([u,h])=>({id:u,number:h.number,title:h.title})):[],[s==null?void 0:s.classes]),i=o.useMemo(()=>l.find(u=>u.id===n),[l,n]);return e.jsxs(c,{className:"supplemental-container",children:[e.jsx(je,{}),n?e.jsxs(c,{children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(xe,{returnToSelection:!0}),e.jsx(ue,{label:i?`${i.number} - ${i.title}`:"Selected Course",variant:"outlined",sx:{borderRadius:"15px",fontSize:"32px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",cursor:"pointer",transition:"background-color 0.3s",fontFamily:"Staatliches, sans-serif",padding:"20px 20px","&:hover":{backgroundColor:"#b2dfdb"}}})]}),e.jsxs(c,{className:"supplemental-content",children:[(s==null?void 0:s.isAdmin)&&e.jsx(ge,{selectedCourse:n}),e.jsx(ve,{initialCourse:n})]})]}):e.jsx(e.Fragment,{children:e.jsx(Se,{courses:l})})]})};export{Ae as default};
