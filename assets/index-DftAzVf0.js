import{p as $,q as M,r as p,j as e,B as x,z as H,bu as X,bv as Y,a as E,$ as _,T as h,i as G,P as J,k as K,l as Z,m as B,n as g,o as ee,v as O,t as Q,I as R,aH as te,a8 as se,b1 as oe,A as F,C as q,a3 as ie,f as ne}from"./ui-DvOWEHrS.js";import{u as N,s as a,i as V,c as s,b as z,a as T,t as i,k as re,d as ae,P}from"./index-D6pEo3hE.js";import{u as d,C as le,l as U,R as de}from"./RichTextEditor-oZBypEDn.js";import"./firebase-CTJJwFJC.js";import"./vendor-BFl3bqVE.js";import"./purify.es-CQJ0hv7W.js";const ce=()=>{const r=$(),b=M(r.breakpoints.down("md")),{userDetails:y}=N(),[f,k]=p.useState(""),j=d(o=>o.filters.searchQuery),W=d(o=>o.setSearchQuery),c=d(o=>o.filters.courseId),D=d(o=>o.setSelectedCourse);d(o=>o.viewMode),d(o=>o.setViewMode);const m=d(o=>o.setActivePanel);d(o=>o.fetchAllData),p.useEffect(()=>{k(j)},[]),p.useEffect(()=>{const o=setTimeout(()=>{f!==j&&W(f)},300);return()=>clearTimeout(o)},[f,j,W]);const S=Object.entries((y==null?void 0:y.classes)||{}).map(([o,v])=>({id:o,number:v.number,title:v.title,isCourseAdmin:v.isCourseAdmin})),C=()=>{m("create")};return e.jsxs(x,{sx:{display:"flex",flexDirection:b?"column":"row",gap:a[3],alignItems:b?"stretch":"center"},children:[e.jsx(x,{sx:{minWidth:b?"100%":300},children:e.jsx(V,{value:c||"",onChange:o=>D(o||null),courses:[{id:"",number:"All",title:"All Courses",isCourseAdmin:!1},...S],size:"medium",showAdminBadge:!1})}),e.jsx(x,{sx:{flex:1},children:e.jsx(H,{placeholder:"Search designs...",value:f,onChange:o=>k(o.target.value),size:"medium",fullWidth:!0,InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(Y,{sx:{color:s.text.tertiary}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:z.lg,backgroundColor:s.background.secondary,"& fieldset":{borderColor:s.neutral[200]},"&:hover fieldset":{borderColor:s.neutral[300]},"&.Mui-focused fieldset":{borderColor:s.primary[500]}}}})}),e.jsx(x,{children:e.jsx(E,{variant:"contained",startIcon:e.jsx(_,{}),onClick:C,sx:{backgroundColor:s.primary[500],color:s.text.inverse,fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.semibold,fontSize:i.fontSize.base,padding:`${a[3]} ${a[6]}`,borderRadius:z.xl,textTransform:"none",boxShadow:T.sm,"&:hover":{backgroundColor:s.primary[600],boxShadow:T.md}},children:b?"New":"New Design"})})]})},ue=({designs:r})=>{const b=re(),y=$(),f=M(y.breakpoints.down("md")),k=d(t=>t.builds),j=d(t=>t.tests),W=d(t=>t.fetchAllData),[c,D]=p.useState({open:!1,designId:null,designTitle:null,buildCount:0,testCount:0}),[m,S]=p.useState(!1),C=t=>{const l=k.filter(A=>A.design_ID===t),w=l.map(A=>A.id),L=j.filter(A=>w.includes(A.build_ID));return{buildCount:l.length,testCount:L.length}},o=t=>{if(!t)return"N/A";let l;t.toDate&&typeof t.toDate=="function"?l=t.toDate():t.seconds?l=new Date(t.seconds*1e3):l=new Date(t);const w=l.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),L=l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`${w}, ${L}`},v=t=>{b(`/laboratory-notebook/${t}`)},I=t=>{const l=C(t.id);D({open:!0,designId:t.id,designTitle:t.title,buildCount:l.buildCount,testCount:l.testCount})},n=()=>{D({open:!1,designId:null,designTitle:null,buildCount:0,testCount:0})},u=async()=>{if(c.designId){S(!0);try{const t=r.find(l=>l.id===c.designId);if(!t)return;await U.deleteDesign(c.designId,t.userId),await W(t.userId,!1,[]),n()}catch(t){console.error("Error deleting design:",t),alert("Failed to delete design. Please try again.")}finally{S(!1)}}};return r.length===0?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,p:a[6]},children:[e.jsx(h,{variant:"h5",sx:{fontFamily:i.fontFamily.display,color:s.text.secondary,mb:a[2]},children:"No Designs Yet"}),e.jsx(h,{variant:"body1",sx:{color:s.text.tertiary,textAlign:"center",maxWidth:500},children:"Start by creating your first design to visualize your experimental workflow."})]}):e.jsxs(G,{component:J,sx:{borderRadius:z.xl,boxShadow:T.md,border:`1px solid ${s.neutral[200]}`},children:[e.jsxs(K,{children:[e.jsx(Z,{children:e.jsxs(B,{sx:{backgroundColor:s.background.secondary},children:[e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Title"}),!f&&e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Description"}),e.jsx(g,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Builds"}),e.jsx(g,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Tests"}),!f&&e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Created"}),e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Modified"})]}),e.jsx(g,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Actions"})]})}),e.jsx(ee,{children:r.map(t=>{const l=C(t.id);return e.jsxs(B,{sx:{"&:hover":{backgroundColor:s.primary[50],cursor:"pointer"},transition:ae.transitions.fast},onClick:()=>v(t.id),children:[e.jsx(g,{children:e.jsx(h,{variant:"body1",sx:{fontWeight:i.fontWeight.semibold,color:s.text.primary,fontFamily:i.fontFamily.secondary},children:t.title})}),!f&&e.jsx(g,{children:e.jsx(h,{variant:"body2",sx:{color:s.text.secondary,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",maxWidth:400},children:t.description||"No description"})}),e.jsx(g,{align:"center",children:e.jsx(O,{label:l.buildCount,size:"small",sx:{backgroundColor:l.buildCount>0?s.secondary[100]:s.neutral[100],color:l.buildCount>0?s.secondary[700]:s.text.tertiary,fontWeight:i.fontWeight.bold,minWidth:40}})}),e.jsx(g,{align:"center",children:e.jsx(O,{label:l.testCount,size:"small",sx:{backgroundColor:l.testCount>0?"#FFEDD5":s.neutral[100],color:l.testCount>0?"#C2410C":s.text.tertiary,fontWeight:i.fontWeight.bold,minWidth:40}})}),!f&&e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(h,{variant:"body2",sx:{color:s.text.tertiary,fontSize:i.fontSize.sm},children:o(t.dateCreated)})}),e.jsx(g,{children:e.jsx(h,{variant:"body2",sx:{color:s.text.tertiary,fontSize:i.fontSize.sm},children:o(t.dateModified)})})]}),e.jsx(g,{align:"center",children:e.jsxs(x,{sx:{display:"flex",gap:a[1],justifyContent:"center"},children:[e.jsx(Q,{title:"View Diagram",children:e.jsx(R,{size:"small",onClick:w=>{w.stopPropagation(),v(t.id)},sx:{color:s.primary[500],"&:hover":{backgroundColor:s.primary[50]}},children:e.jsx(te,{fontSize:"small"})})}),e.jsx(Q,{title:"Delete Design",children:e.jsx(R,{size:"small",onClick:w=>{w.stopPropagation(),I(t)},sx:{color:s.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:e.jsx(se,{fontSize:"small"})})})]})})]},t.id)})})]}),e.jsx(le,{open:c.open,title:"Delete Design?",message:`Are you sure you want to delete "${c.designTitle}"? ${c.buildCount>0||c.testCount>0?`This will also delete ${c.buildCount} build${c.buildCount!==1?"s":""} and ${c.testCount} test${c.testCount!==1?"s":""}. `:""}This action cannot be undone.`,confirmLabel:m?"Deleting...":"Delete",cancelLabel:"Cancel",onConfirm:u,onCancel:n,isDestructive:!0})]})},xe=()=>{const{userDetails:r}=N(),b=d(u=>u.setActivePanel);d(u=>u.addDesign);const y=d(u=>u.fetchAllData),[f,k]=p.useState(""),[j,W]=p.useState(""),[c,D]=p.useState(""),[m,S]=p.useState(!1),[C,o]=p.useState(null),v=Object.entries((r==null?void 0:r.classes)||{}).map(([u,t])=>({id:u,number:t.number,title:t.title,isCourseAdmin:t.isCourseAdmin})),I=()=>{b(null)},n=async u=>{if(u.preventDefault(),!f.trim()){o("Title is required");return}if(!j.trim()){o("Description is required");return}if(!c){o("Please select a course");return}if(!r){o("User not authenticated");return}S(!0),o(null);try{const t=await U.createDesign({title:f.trim(),description:j.trim(),course:c,userId:r.uid}),l=Object.keys(r.classes||{});await y(r.uid,r.isAdmin,l),b(null)}catch(t){console.error("Error creating design:",t),o(t instanceof Error?t.message:"Failed to create design")}finally{S(!1)}};return e.jsxs(x,{sx:{position:"fixed",right:0,top:0,height:"100vh",width:480,backgroundColor:s.background.primary,boxShadow:T["2xl"],zIndex:1300,display:"flex",flexDirection:"column",animation:"slideInRight 0.3s ease-out","@keyframes slideInRight":{from:{transform:"translateX(100%)"},to:{transform:"translateX(0)"}}},children:[e.jsx(x,{sx:{p:a[4],borderBottom:`1px solid ${s.neutral[200]}`,backgroundColor:s.primary[50]},children:e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(h,{variant:"h4",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:s.text.primary},children:"Create New Design"}),e.jsx(R,{size:"small",onClick:I,disabled:m,children:e.jsx(oe,{})})]})}),e.jsxs(x,{component:"form",onSubmit:n,sx:{flex:1,overflowY:"auto",p:a[4],display:"flex",flexDirection:"column",gap:a[4]},children:[C&&e.jsx(F,{severity:"error",onClose:()=>o(null),children:C}),e.jsx(H,{label:"Title",value:f,onChange:u=>k(u.target.value),required:!0,fullWidth:!0,disabled:m,placeholder:"Enter design title",sx:{"& .MuiOutlinedInput-root":{borderRadius:z.lg}}}),e.jsxs(x,{children:[e.jsx(h,{variant:"body2",sx:{mb:a[1],color:s.text.secondary,fontWeight:i.fontWeight.medium},children:"Description *"}),e.jsx(de,{value:j,onChange:W,placeholder:"Describe your design, its purpose, and goals...",minHeight:200,disabled:m})]}),e.jsx(x,{children:e.jsx(V,{value:c,onChange:u=>D(u||""),courses:v,disabled:m,size:"medium",showAdminBadge:!1})}),e.jsx(F,{severity:"info",sx:{borderRadius:z.lg},children:e.jsx(h,{variant:"body2",children:"After creating your design, you can add builds and tests to it from the graph view."})})]}),e.jsxs(x,{sx:{p:a[4],borderTop:`1px solid ${s.neutral[200]}`,display:"flex",gap:a[2]},children:[e.jsx(E,{variant:"outlined",onClick:I,fullWidth:!0,disabled:m,children:"Cancel"}),e.jsx(E,{type:"submit",variant:"contained",onClick:n,fullWidth:!0,disabled:m,startIcon:m?e.jsx(q,{size:20}):e.jsx(ie,{}),sx:{backgroundColor:s.primary[500],"&:hover":{backgroundColor:s.primary[600]}},children:m?"Creating...":"Create Design"})]})]})},pe=()=>{const{userDetails:r,loading:b}=N(),[y,f]=p.useState(!1),k=$(),j=M(k.breakpoints.down("md")),W=d(n=>n.isLoading),c=d(n=>n.error),D=d(n=>n.fetchAllData),m=d(n=>n.designs),S=d(n=>n.activePanel),C=d(n=>n.filters.searchQuery),o=d(n=>n.filters.courseId),v=ne.useMemo(()=>{let n=m;if(o&&(n=n.filter(u=>u.course===o)),C){const u=C.toLowerCase();n=n.filter(t=>t.title.toLowerCase().includes(u)||t.description.toLowerCase().includes(u))}return n},[m,C,o]);return p.useEffect(()=>{if(!b&&r&&!y){const n=Object.keys(r.classes||{});D(r.uid,r.isAdmin,n),f(!0)}},[r,b,D,y]),b||W&&!y?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"80vh",gap:a[4]},children:[e.jsx(q,{size:60,sx:{color:s.primary[500]}}),e.jsx(h,{variant:"h6",sx:{fontFamily:i.fontFamily.display,color:s.text.secondary},children:"Loading your laboratory notebook..."})]}):c?e.jsxs(x,{sx:{p:a[6]},children:[e.jsx(P,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(F,{severity:"error",sx:{mt:a[4],borderRadius:"12px"},children:[e.jsx(h,{variant:"h6",sx:{mb:1},children:"Error Loading Data"}),e.jsx(h,{variant:"body2",children:c})]})]}):r&&(r.isAdmin||r.isSuperAdmin||r.classes&&Object.keys(r.classes).length>0)?e.jsxs(x,{sx:{p:j?a[3]:a[6],backgroundColor:s.background.primary,minHeight:"100vh"},children:[e.jsx(P,{title:"Laboratory Notebook",subtitle:"Manage your experimental designs, builds, and tests"}),e.jsx(x,{sx:{mb:a[6]},children:e.jsx(ce,{})}),y&&e.jsxs(e.Fragment,{children:[e.jsx(x,{sx:{display:"flex",gap:a[4],mb:a[4],flexWrap:"wrap"},children:e.jsxs(x,{sx:{flex:1,minWidth:200,p:a[4],backgroundColor:s.primary[50],borderRadius:z.xl,border:`1px solid ${s.primary[200]}`},children:[e.jsx(h,{variant:"h3",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:s.primary[700],mb:a[1]},children:v.length}),e.jsx(h,{variant:"body2",sx:{color:s.text.secondary,fontWeight:i.fontWeight.medium},children:"Total Designs"})]})}),e.jsx(ue,{designs:v})]}),S==="create"&&e.jsx(xe,{})]}):e.jsxs(x,{sx:{p:a[6]},children:[e.jsx(P,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(F,{severity:"info",sx:{mt:a[4],borderRadius:"12px"},children:[e.jsx(h,{variant:"h6",sx:{mb:1},children:"Course Enrollment Required"}),e.jsx(h,{variant:"body2",children:"The Laboratory Notebook is accessible to users enrolled in an academic course. Please enroll in a course via 'My Account' by following the instructions provided by your academic instructor."})]})]})};export{pe as default};
