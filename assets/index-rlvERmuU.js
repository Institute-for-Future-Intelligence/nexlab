import{r as k,j as e,P as b,T as t,B as r,aJ as L,v as y,I as G,a8 as J,al as E,a as F,A as w,bY as Q,as as V,at as Y,aK as Z,aP as q,aQ as X,aR as ee,bc as R,aN as te,c6 as re,c7 as se,b$ as ne,c0 as W,bW as ae,aH as oe,a9 as ie,a3 as le,c8 as ce,ak as _,aA as H,aB as O,a6 as U,aD as K,ay as B,az as D,aM as de,c9 as M,D as xe}from"./ui-B5h6-wmd.js";import{y as $,z as P,A as pe,B as ue,F as me}from"./index-B1-1bjJO.js";import{u as he}from"./index-DOt34aJI.js";import"./vendor-BFl3bqVE.js";import"./firebase-CiLlnz7t.js";const ge=({disabled:s=!1})=>{const{setUploadedFile:n,extractTextFromFile:l,setError:m}=$(),{uploadedFile:i,extractedText:h,isProcessing:o}=P(),[c,g]=k.useState(!1),f=k.useCallback(async u=>{if(u.length===0)return;const a=u[0],S=pe(a);if(!S.isValid){m(S.error||"Invalid file");return}n(a),setTimeout(async()=>{await l()},100)},[n,l,m]),{getRootProps:v,getInputProps:j,isDragActive:p}=he({onDrop:f,accept:{"application/pdf":[".pdf"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".pptx"],"text/plain":[".txt"]},multiple:!1,disabled:s||o,onDragEnter:()=>g(!0),onDragLeave:()=>g(!1),onDropAccepted:()=>g(!1),onDropRejected:()=>g(!1)}),x=()=>{n(null),m(null)},T=u=>{const a=u.toLowerCase();return a.includes("pdf")?e.jsx(Q,{sx:{fontSize:40,color:"error.main"}}):a.includes("presentation")||a.includes("powerpoint")?e.jsx(V,{sx:{fontSize:40,color:"warning.main"}}):a.includes("word")||a.includes("document")?e.jsx(Y,{sx:{fontSize:40,color:"info.main"}}):e.jsx(Z,{sx:{fontSize:40,color:"text.secondary"}})},I=u=>{if(u===0)return"0 Bytes";const a=1024,S=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(u)/Math.log(a));return parseFloat((u/Math.pow(a,d)).toFixed(2))+" "+S[d]};return e.jsxs(b,{elevation:2,sx:{p:3},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"ğŸ“ Upload Material"}),i?e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,border:"1px solid",borderColor:"success.main",borderRadius:1,bgcolor:"success.50"},children:[T(i.type),e.jsxs(r,{sx:{flex:1},children:[e.jsx(t,{variant:"body1",fontWeight:"bold",children:i.name}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[ue(i)," â€¢ ",I(i.size)]}),h&&e.jsxs(t,{variant:"caption",color:"success.main",children:["âœ… Text extracted successfully (",h.split(/\s+/).length," words)"]})]}),e.jsx(G,{onClick:x,color:"error",disabled:o,size:"small",children:e.jsx(J,{})})]}),o&&e.jsxs(r,{sx:{mt:2},children:[e.jsx(E,{}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Processing file..."})]}),!o&&e.jsx(r,{sx:{mt:2,textAlign:"center"},children:e.jsx(F,{variant:"outlined",size:"small",onClick:x,startIcon:e.jsx(L,{}),children:"Upload Different File"})})]}):e.jsxs(r,{...v(),sx:{border:"2px dashed",borderColor:c?"primary.main":"grey.300",borderRadius:2,p:4,textAlign:"center",cursor:s?"not-allowed":"pointer",bgcolor:c?"primary.50":"grey.50",transition:"all 0.2s ease","&:hover":{borderColor:s?"grey.300":"primary.main",bgcolor:s?"grey.50":"primary.50"}},children:[e.jsx("input",{...j()}),e.jsx(L,{sx:{fontSize:64,color:"primary.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:p?"Drop your file here!":"Upload Material File"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Drag and drop your file here, or click to browse"}),e.jsxs(r,{sx:{display:"flex",gap:1,justifyContent:"center",flexWrap:"wrap",mb:2},children:[e.jsx(y,{label:"PDF",size:"small",color:"error",variant:"outlined"}),e.jsx(y,{label:"PowerPoint",size:"small",color:"warning",variant:"outlined"}),e.jsx(y,{label:"Word",size:"small",color:"info",variant:"outlined"}),e.jsx(y,{label:"Text",size:"small",color:"success",variant:"outlined"})]}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Maximum file size: 50MB"})]}),e.jsx(w,{severity:"info",sx:{mt:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Supported formats:"})," PDF documents, PowerPoint presentations (.pptx), Word documents (.docx), and plain text files (.txt). The AI will automatically structure your content into organized course materials."]})})]})},je=()=>{const{progress:s}=P();if(!s)return null;const n=o=>{switch(o){case"uploading":return e.jsx(L,{});case"extracting":return e.jsx(se,{});case"analyzing":return e.jsx(R,{});case"structuring":return e.jsx(re,{});case"complete":return e.jsx(te,{});default:return e.jsx(R,{})}},l=o=>{switch(o){case"uploading":return"Uploading File";case"extracting":return"Extracting Text";case"analyzing":return"AI Analysis";case"structuring":return"Structuring Content";case"complete":return"Complete";case"error":return"Error";default:return"Processing"}},m=()=>s.stage==="error"?"error":s.stage==="complete"?"success":"primary",i=[{key:"uploading",label:"Upload"},{key:"extracting",label:"Extract"},{key:"analyzing",label:"Analyze"},{key:"structuring",label:"Structure"},{key:"complete",label:"Complete"}],h=()=>i.findIndex(o=>o.key===s.stage);return e.jsxs(b,{elevation:2,sx:{p:3,mb:3,bgcolor:"primary.50"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[n(s.stage),e.jsx(t,{variant:"h6",color:"primary.main",children:l(s.stage)})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(E,{variant:"determinate",value:s.percentage,color:m(),sx:{height:8,borderRadius:4}}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:s.currentOperation}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[Math.round(s.percentage),"%"]})]})]}),s.subSteps&&e.jsx(w,{severity:"info",sx:{mb:2},children:e.jsxs(t,{variant:"body2",children:["Step ",s.subSteps.current," of ",s.subSteps.total,": ",s.subSteps.description]})}),e.jsx(q,{activeStep:h(),alternativeLabel:!0,children:i.map((o,c)=>e.jsx(X,{completed:h()>c,children:e.jsx(ee,{children:e.jsx(t,{variant:"caption",children:o.label})})},o.key))}),s.stage==="analyzing"&&e.jsx(w,{severity:"info",sx:{mt:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"AI Processing:"})," The system is analyzing your content structure, identifying sections, and extracting educational information. This usually takes a moment for larger files."]})}),s.stage==="structuring"&&e.jsx(w,{severity:"info",sx:{mt:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Content Structuring:"})," Creating organized sections, subsections, and formatting the material for optimal learning experience."]})})]})},ye=({extractedText:s,convertedMaterial:n,onMaterialReady:l,onCancel:m,imageUploadProgress:i,isSaving:h=!1})=>{const[o,c]=k.useState(0),[g,f]=k.useState({}),v=(I,u)=>{c(u)},j=I=>{f(u=>({...u,[I]:!u[I]}))},p=()=>{n&&l&&l(n)},x=()=>e.jsx(b,{variant:"outlined",sx:{p:2,maxHeight:600,overflow:"auto"},children:e.jsx(t,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:s})}),T=()=>{var I,u;return n?e.jsxs(r,{children:[e.jsxs(b,{elevation:1,sx:{p:3,mb:2,bgcolor:"primary.50"},children:[e.jsx(t,{variant:"h4",gutterBottom:!0,color:"primary",children:n.title}),((I=n.header)==null?void 0:I.content)&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:n.header.title}),e.jsx(t,{variant:"body1",dangerouslySetInnerHTML:{__html:n.header.content},sx:{"& > *":{mb:1}}})]}),n.sourceInfo&&e.jsxs(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:2},children:[e.jsx(y,{icon:e.jsx(ce,{}),label:`Source: ${n.sourceInfo.fileName}`,size:"small",variant:"outlined"}),e.jsx(y,{icon:e.jsx(_,{}),label:`Processed: ${new Date(n.sourceInfo.extractedAt).toLocaleString()}`,size:"small",variant:"outlined",color:"secondary"})]})]}),e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:n.sections.map((a,S)=>e.jsxs(H,{expanded:g[a.id]!==!1,onChange:()=>j(a.id),children:[e.jsx(O,{expandIcon:e.jsx(U,{}),children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsxs(t,{variant:"h6",sx:{flex:1},children:[S+1,". ",a.title]}),a.subsections.length>0&&e.jsx(y,{label:`${a.subsections.length} subsections`,size:"small",color:"primary",variant:"outlined"})]})}),e.jsxs(K,{children:[a.content&&e.jsx(t,{variant:"body1",dangerouslySetInnerHTML:{__html:a.content},sx:{mb:2,"& > *":{mb:1}}}),a.images&&a.images.length>0&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"ğŸ“¸ Images Referenced:"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:1},children:a.images.map((d,C)=>e.jsxs(r,{sx:{border:"1px solid #e0e0e0",borderRadius:1,p:1,maxWidth:200,textAlign:"center"},children:[e.jsx("img",{src:d.url,alt:d.title,style:{width:"100%",maxHeight:"120px",objectFit:"contain",marginBottom:"8px"},onError:()=>{console.warn(`Failed to load image: ${d.url}`)}}),e.jsx(t,{variant:"caption",sx:{display:"block",fontSize:"0.75rem",color:"text.secondary"},children:d.title})]},C))})]}),a.links&&a.links.length>0&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"ğŸ”— Links Referenced:"}),a.links.map((d,C)=>e.jsx(r,{sx:{mb:1},children:e.jsxs(t,{variant:"body2",children:[e.jsxs("strong",{children:[d.title,":"]})," ",d.description,d.url&&e.jsxs(t,{component:"span",variant:"caption",color:"primary",sx:{ml:1},children:["(",d.url,")"]})]})},C))]}),a.subsections.map((d,C)=>e.jsxs(r,{sx:{ml:2,mb:2},children:[e.jsxs(t,{variant:"h6",gutterBottom:!0,children:[S+1,".",C+1," ",d.title]}),d.content&&e.jsx(t,{variant:"body2",dangerouslySetInnerHTML:{__html:d.content},sx:{mb:1,"& > *":{mb:1}}}),d.subSubsections.map((A,N)=>e.jsxs(r,{sx:{ml:2,mb:1},children:[e.jsxs(t,{variant:"subtitle1",gutterBottom:!0,children:[S+1,".",C+1,".",N+1," ",A.title]}),A.content&&e.jsx(t,{variant:"body2",dangerouslySetInnerHTML:{__html:A.content},sx:{"& > *":{mb:1}}})]},A.id))]},d.id))]})]},a.id))}),((u=n.footer)==null?void 0:u.content)&&e.jsxs(b,{elevation:1,sx:{p:2,mt:2,bgcolor:"grey.50"},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:n.footer.title}),e.jsx(t,{variant:"body2",dangerouslySetInnerHTML:{__html:n.footer.content},sx:{"& > *":{mb:1}}})]})]}):e.jsx(w,{severity:"info",children:e.jsx(t,{children:"Upload a file and process it with AI to see the structured preview."})})};return e.jsxs(b,{elevation:2,sx:{height:"fit-content"},children:[e.jsxs(r,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"ğŸ“‹ Material Preview"}),e.jsxs(ne,{value:o,onChange:v,children:[e.jsx(W,{icon:e.jsx(ae,{}),label:"Raw Text",disabled:!s}),e.jsx(W,{icon:e.jsx(oe,{}),label:"Structured Preview",disabled:!n})]})]}),e.jsxs(r,{sx:{p:2,maxHeight:800,overflow:"auto"},children:[o===0&&x(),o===1&&T()]}),i&&e.jsx(r,{sx:{p:2,borderTop:1,borderColor:"divider"},children:e.jsxs(b,{elevation:1,sx:{p:2,backgroundColor:"primary.50",borderRadius:2,border:"1px solid",borderColor:"primary.200"},children:[e.jsxs(t,{variant:"body2",sx:{mb:1,color:"primary.main",fontWeight:"medium"},children:["ğŸ“¸ Uploading images... (",i.completed," of ",i.total,")"]}),e.jsx(E,{variant:"determinate",value:i.completed/i.total*100,sx:{borderRadius:2,height:8,backgroundColor:"primary.100","& .MuiLinearProgress-bar":{borderRadius:2,backgroundColor:"primary.main"}}})]})}),n&&e.jsxs(r,{sx:{p:2,borderTop:1,borderColor:"divider",display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(F,{variant:"outlined",onClick:m,startIcon:e.jsx(ie,{}),disabled:h,children:"Cancel"}),e.jsx(F,{variant:"contained",onClick:p,startIcon:e.jsx(le,{}),color:"success",disabled:h,children:h?"Saving...":"Save Material"})]})]})},fe=({courseId:s,authorId:n,disabled:l=!1})=>{const{processWithAI:m,setProcessingOptions:i}=$(),{processingOptions:h}=P(),o=me(),c=h||{maxOutputTokens:4096,topP:.1,preserveFormatting:!0,extractImages:!0,extractLinks:!0},[g,f]=k.useState(!1),v=async()=>{try{await m(s,n)}catch(p){console.error("Failed to start AI processing:",p)}},j=(p,x)=>{i({[p]:x})};return e.jsxs(b,{elevation:2,sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(R,{color:"primary"}),e.jsx(t,{variant:"h6",children:"AI Processing Settings"})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(B,{control:e.jsx(D,{checked:c.preserveFormatting||!1,onChange:p=>j("preserveFormatting",p.target.checked),disabled:l}),label:"Preserve Original Formatting"}),e.jsx(t,{variant:"caption",display:"block",color:"text.secondary",sx:{ml:4},children:"Maintain text formatting and structure from the original document"})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(B,{control:e.jsx(D,{checked:c.extractImages||!1,onChange:p=>j("extractImages",p.target.checked),disabled:l}),label:"Extract Image References"}),e.jsx(t,{variant:"caption",display:"block",color:"text.secondary",sx:{ml:4},children:"Identify and note image locations and descriptions"})]}),e.jsxs(r,{sx:{mb:3},children:[e.jsx(B,{control:e.jsx(D,{checked:c.extractLinks||!1,onChange:p=>j("extractLinks",p.target.checked),disabled:l}),label:"Extract Links and Resources"}),e.jsx(t,{variant:"caption",display:"block",color:"text.secondary",sx:{ml:4},children:"Find and organize URLs and external references"})]}),e.jsxs(H,{expanded:g,onChange:()=>f(!g),children:[e.jsx(O,{expandIcon:e.jsx(U,{}),children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{fontSize:"small"}),e.jsx(t,{children:"Advanced AI Settings"})]})}),e.jsx(K,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(r,{children:[e.jsx(t,{gutterBottom:!0,children:"Max Output Tokens"}),e.jsx(M,{value:c.maxOutputTokens||4096,onChange:(p,x)=>j("maxOutputTokens",x),min:2048,max:8192,step:1024,marks:[{value:2048,label:"2K"},{value:4096,label:"4K"},{value:8192,label:"8K"}],valueLabelDisplay:"auto",disabled:l}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Higher values allow more detailed processing but may take longer"})]}),e.jsxs(r,{children:[e.jsx(t,{gutterBottom:!0,children:"Creativity Level (TopP)"}),e.jsx(M,{value:c.topP||.1,onChange:(p,x)=>j("topP",x),min:.1,max:.5,step:.05,marks:[{value:.1,label:"Factual"},{value:.3,label:"Balanced"},{value:.5,label:"Flexible"}],valueLabelDisplay:"auto",disabled:l}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Lower values prioritize factual extraction, higher values allow more interpretation"})]})]})})]}),e.jsx(xe,{sx:{my:2}}),e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(F,{variant:"contained",size:"large",onClick:v,disabled:l||!o||!1,startIcon:e.jsx(_,{}),sx:{px:4,py:1.5,background:"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)","&:hover":{background:"linear-gradient(45deg, #1976D2 30%, #0288D1 90%)"}},children:"ğŸ¤– Process with AI"}),!o&&e.jsx(t,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Upload and extract text from a file first"})]}),e.jsxs(w,{severity:"info",sx:{mt:2},children:[e.jsx(t,{variant:"body2",children:e.jsx("strong",{children:"What AI Processing Does:"})}),e.jsxs(r,{component:"ul",sx:{mt:1,mb:0,pl:2},children:[e.jsx(t,{component:"li",variant:"body2",children:"Automatically structures content into sections and subsections"}),e.jsx(t,{component:"li",variant:"body2",children:"Identifies key topics and creates logical organization"}),e.jsx(t,{component:"li",variant:"body2",children:"Extracts educational objectives and learning points"}),e.jsx(t,{component:"li",variant:"body2",children:"Formats content with proper HTML for rich display"}),e.jsx(t,{component:"li",variant:"body2",children:"Preserves source file reference for debugging"})]})]}),e.jsxs(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:2},children:[e.jsx(y,{label:"Smart Structuring",size:"small",color:"primary",variant:"outlined"}),e.jsx(y,{label:"Content Analysis",size:"small",color:"secondary",variant:"outlined"}),e.jsx(y,{label:"Auto-Formatting",size:"small",color:"success",variant:"outlined"}),e.jsx(y,{label:"Source Tracking",size:"small",color:"info",variant:"outlined"})]})]})},Ce=({courseId:s,authorId:n,onMaterialReady:l,onCancel:m,imageUploadProgress:i,isSaving:h=!1})=>{const{uploadedFile:o,extractedText:c,aiExtractedData:g,convertedMaterial:f,isProcessing:v,error:j}=P(),x=f?"preview":g?"processed":c?"extracted":o?"uploaded":"upload";return e.jsxs(r,{sx:{maxWidth:1200,mx:"auto",p:3},children:[e.jsxs(b,{elevation:2,sx:{p:3,mb:3,bgcolor:"primary.50"},children:[e.jsx(t,{variant:"h4",component:"h1",gutterBottom:!0,sx:{color:"primary.main"},children:"ğŸ¤– AI-Powered Material Import"}),e.jsx(t,{variant:"body1",color:"text.secondary",children:"Upload your presentation slides, documents, or materials and let AI automatically structure them into course content with sections, subsections, and organized information."})]}),j&&e.jsx(w,{severity:"error",sx:{mb:3},onClose:()=>{},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Import Error:"})," ",j]})}),v&&e.jsx(je,{}),e.jsxs(r,{sx:{display:"flex",gap:3},children:[e.jsxs(r,{sx:{flex:1,minWidth:400},children:[e.jsx(ge,{disabled:v}),(x==="extracted"||x==="upload")&&!v&&e.jsx(r,{sx:{mt:3},children:e.jsx(fe,{courseId:s,authorId:n,disabled:!c})}),e.jsxs(b,{elevation:1,sx:{p:2,mt:3,bgcolor:"grey.50"},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Import Progress"}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(z,{step:1,title:"Upload File",completed:!!o,active:x==="upload"}),e.jsx(z,{step:2,title:"Extract Text",completed:!!c,active:x==="uploaded"}),e.jsx(z,{step:3,title:"AI Processing",completed:!!g,active:x==="extracted"}),e.jsx(z,{step:4,title:"Review & Save",completed:!!f,active:x==="processed"})]})]})]}),(c||f)&&e.jsx(r,{sx:{flex:1,minWidth:500},children:e.jsx(ye,{extractedText:c,convertedMaterial:f,onMaterialReady:l,onCancel:m,imageUploadProgress:i,isSaving:h})})]})]})},z=({step:s,title:n,completed:l,active:m})=>{const i=()=>l?"success.main":m?"primary.main":"grey.400",h=()=>l?"âœ…":m?"ğŸ”„":"â³";return e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(r,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:i(),color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold"},children:l?"âœ“":s}),e.jsx(r,{sx:{flex:1},children:e.jsxs(t,{variant:"body2",sx:{fontWeight:m?"bold":"normal",color:i()},children:[h()," ",n]})})]})};export{Ce as default};
