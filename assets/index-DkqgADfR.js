import{p as M,q as N,r as p,j as e,B as x,z as E,bu as X,bv as Y,a as R,$ as _,T as m,i as G,P as J,k as K,l as Z,m as B,n as g,o as ee,v as Q,t as q,I as $,aH as te,a8 as se,b1 as oe,A as F,C as H,a3 as ie,f as ne}from"./ui-Ce4HUEU5.js";import{u as O,s as a,i as V,c as s,b as I,a as T,t as i,k as re,d as ae,P}from"./index-C1w9W7xM.js";import{u as c,C as le,l as U}from"./ConfirmationDialog-DEEduAiS.js";import"./firebase-CTJJwFJC.js";import"./vendor-BFl3bqVE.js";const de=()=>{const r=M(),b=N(r.breakpoints.down("md")),{userDetails:y}=O(),[h,k]=p.useState(""),j=c(o=>o.filters.searchQuery),w=c(o=>o.setSearchQuery),u=c(o=>o.filters.courseId),D=c(o=>o.setSelectedCourse);c(o=>o.viewMode),c(o=>o.setViewMode);const f=c(o=>o.setActivePanel);c(o=>o.fetchAllData),p.useEffect(()=>{k(j)},[]),p.useEffect(()=>{const o=setTimeout(()=>{h!==j&&w(h)},300);return()=>clearTimeout(o)},[h,j,w]);const S=Object.entries((y==null?void 0:y.classes)||{}).map(([o,v])=>({id:o,number:v.number,title:v.title,isCourseAdmin:v.isCourseAdmin})),C=()=>{f("create")};return e.jsxs(x,{sx:{display:"flex",flexDirection:b?"column":"row",gap:a[3],alignItems:b?"stretch":"center"},children:[e.jsx(x,{sx:{minWidth:b?"100%":300},children:e.jsx(V,{value:u||"",onChange:o=>D(o||null),courses:[{id:"",number:"All",title:"All Courses",isCourseAdmin:!1},...S],size:"medium",showAdminBadge:!1})}),e.jsx(x,{sx:{flex:1},children:e.jsx(E,{placeholder:"Search designs...",value:h,onChange:o=>k(o.target.value),size:"medium",fullWidth:!0,InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(Y,{sx:{color:s.text.tertiary}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:I.lg,backgroundColor:s.background.secondary,"& fieldset":{borderColor:s.neutral[200]},"&:hover fieldset":{borderColor:s.neutral[300]},"&.Mui-focused fieldset":{borderColor:s.primary[500]}}}})}),e.jsx(x,{children:e.jsx(R,{variant:"contained",startIcon:e.jsx(_,{}),onClick:C,sx:{backgroundColor:s.primary[500],color:s.text.inverse,fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.semibold,fontSize:i.fontSize.base,padding:`${a[3]} ${a[6]}`,borderRadius:I.xl,textTransform:"none",boxShadow:T.sm,"&:hover":{backgroundColor:s.primary[600],boxShadow:T.md}},children:b?"New":"New Design"})})]})},ce=({designs:r})=>{const b=re(),y=M(),h=N(y.breakpoints.down("md")),k=c(t=>t.builds),j=c(t=>t.tests),w=c(t=>t.fetchAllData),[u,D]=p.useState({open:!1,designId:null,designTitle:null,buildCount:0,testCount:0}),[f,S]=p.useState(!1),C=t=>{const d=k.filter(A=>A.design_ID===t),W=d.map(A=>A.id),L=j.filter(A=>W.includes(A.build_ID));return{buildCount:d.length,testCount:L.length}},o=t=>{if(!t)return"N/A";let d;t.toDate&&typeof t.toDate=="function"?d=t.toDate():t.seconds?d=new Date(t.seconds*1e3):d=new Date(t);const W=d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),L=d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`${W}, ${L}`},v=t=>{b(`/laboratory-notebook/${t}`)},z=t=>{const d=C(t.id);D({open:!0,designId:t.id,designTitle:t.title,buildCount:d.buildCount,testCount:d.testCount})},n=()=>{D({open:!1,designId:null,designTitle:null,buildCount:0,testCount:0})},l=async()=>{if(u.designId){S(!0);try{const t=r.find(d=>d.id===u.designId);if(!t)return;await U.deleteDesign(u.designId,t.userId),await w(t.userId,!1,[]),n()}catch(t){console.error("Error deleting design:",t),alert("Failed to delete design. Please try again.")}finally{S(!1)}}};return r.length===0?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,p:a[6]},children:[e.jsx(m,{variant:"h5",sx:{fontFamily:i.fontFamily.display,color:s.text.secondary,mb:a[2]},children:"No Designs Yet"}),e.jsx(m,{variant:"body1",sx:{color:s.text.tertiary,textAlign:"center",maxWidth:500},children:"Start by creating your first design to visualize your experimental workflow."})]}):e.jsxs(G,{component:J,sx:{borderRadius:I.xl,boxShadow:T.md,border:`1px solid ${s.neutral[200]}`},children:[e.jsxs(K,{children:[e.jsx(Z,{children:e.jsxs(B,{sx:{backgroundColor:s.background.secondary},children:[e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Title"}),!h&&e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Description"}),e.jsx(g,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Builds"}),e.jsx(g,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Tests"}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Created"}),e.jsx(g,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Modified"})]}),e.jsx(g,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:s.text.primary,fontSize:i.fontSize.sm},children:"Actions"})]})}),e.jsx(ee,{children:r.map(t=>{const d=C(t.id);return e.jsxs(B,{sx:{"&:hover":{backgroundColor:s.primary[50],cursor:"pointer"},transition:ae.transitions.fast},onClick:()=>v(t.id),children:[e.jsx(g,{children:e.jsx(m,{variant:"body1",sx:{fontWeight:i.fontWeight.semibold,color:s.text.primary,fontFamily:i.fontFamily.secondary},children:t.title})}),!h&&e.jsx(g,{children:e.jsx(m,{variant:"body2",sx:{color:s.text.secondary,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",maxWidth:400},children:t.description||"No description"})}),e.jsx(g,{align:"center",children:e.jsx(Q,{label:d.buildCount,size:"small",sx:{backgroundColor:d.buildCount>0?s.secondary[100]:s.neutral[100],color:d.buildCount>0?s.secondary[700]:s.text.tertiary,fontWeight:i.fontWeight.bold,minWidth:40}})}),e.jsx(g,{align:"center",children:e.jsx(Q,{label:d.testCount,size:"small",sx:{backgroundColor:d.testCount>0?"#FFEDD5":s.neutral[100],color:d.testCount>0?"#C2410C":s.text.tertiary,fontWeight:i.fontWeight.bold,minWidth:40}})}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(m,{variant:"body2",sx:{color:s.text.tertiary,fontSize:i.fontSize.sm},children:o(t.dateCreated)})}),e.jsx(g,{children:e.jsx(m,{variant:"body2",sx:{color:s.text.tertiary,fontSize:i.fontSize.sm},children:o(t.dateModified)})})]}),e.jsx(g,{align:"center",children:e.jsxs(x,{sx:{display:"flex",gap:a[1],justifyContent:"center"},children:[e.jsx(q,{title:"View Diagram",children:e.jsx($,{size:"small",onClick:W=>{W.stopPropagation(),v(t.id)},sx:{color:s.primary[500],"&:hover":{backgroundColor:s.primary[50]}},children:e.jsx(te,{fontSize:"small"})})}),e.jsx(q,{title:"Delete Design",children:e.jsx($,{size:"small",onClick:W=>{W.stopPropagation(),z(t)},sx:{color:s.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:e.jsx(se,{fontSize:"small"})})})]})})]},t.id)})})]}),e.jsx(le,{open:u.open,title:"Delete Design?",message:`Are you sure you want to delete "${u.designTitle}"? ${u.buildCount>0||u.testCount>0?`This will also delete ${u.buildCount} build${u.buildCount!==1?"s":""} and ${u.testCount} test${u.testCount!==1?"s":""}. `:""}This action cannot be undone.`,confirmLabel:f?"Deleting...":"Delete",cancelLabel:"Cancel",onConfirm:l,onCancel:n,isDestructive:!0})]})},ue=()=>{const{userDetails:r}=O(),b=c(l=>l.setActivePanel);c(l=>l.addDesign);const y=c(l=>l.fetchAllData),[h,k]=p.useState(""),[j,w]=p.useState(""),[u,D]=p.useState(""),[f,S]=p.useState(!1),[C,o]=p.useState(null),v=Object.entries((r==null?void 0:r.classes)||{}).map(([l,t])=>({id:l,number:t.number,title:t.title,isCourseAdmin:t.isCourseAdmin})),z=()=>{b(null)},n=async l=>{if(l.preventDefault(),!h.trim()){o("Title is required");return}if(!j.trim()){o("Description is required");return}if(!u){o("Please select a course");return}if(!r){o("User not authenticated");return}S(!0),o(null);try{const t=await U.createDesign({title:h.trim(),description:j.trim(),course:u,userId:r.uid}),d=Object.keys(r.classes||{});await y(r.uid,r.isAdmin,d),b(null)}catch(t){console.error("Error creating design:",t),o(t instanceof Error?t.message:"Failed to create design")}finally{S(!1)}};return e.jsxs(x,{sx:{position:"fixed",right:0,top:0,height:"100vh",width:480,backgroundColor:s.background.primary,boxShadow:T["2xl"],zIndex:1300,display:"flex",flexDirection:"column",animation:"slideInRight 0.3s ease-out","@keyframes slideInRight":{from:{transform:"translateX(100%)"},to:{transform:"translateX(0)"}}},children:[e.jsx(x,{sx:{p:a[4],borderBottom:`1px solid ${s.neutral[200]}`,backgroundColor:s.primary[50]},children:e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:s.text.primary},children:"Create New Design"}),e.jsx($,{size:"small",onClick:z,disabled:f,children:e.jsx(oe,{})})]})}),e.jsxs(x,{component:"form",onSubmit:n,sx:{flex:1,overflowY:"auto",p:a[4],display:"flex",flexDirection:"column",gap:a[4]},children:[C&&e.jsx(F,{severity:"error",onClose:()=>o(null),children:C}),e.jsx(E,{label:"Title",value:h,onChange:l=>k(l.target.value),required:!0,fullWidth:!0,disabled:f,placeholder:"Enter design title",sx:{"& .MuiOutlinedInput-root":{borderRadius:I.lg}}}),e.jsx(E,{label:"Description",value:j,onChange:l=>w(l.target.value),required:!0,fullWidth:!0,multiline:!0,rows:6,disabled:f,placeholder:"Describe your design, its purpose, and goals",sx:{"& .MuiOutlinedInput-root":{borderRadius:I.lg}}}),e.jsx(x,{children:e.jsx(V,{value:u,onChange:l=>D(l||""),courses:v,disabled:f,size:"medium",showAdminBadge:!1})}),e.jsx(F,{severity:"info",sx:{borderRadius:I.lg},children:e.jsx(m,{variant:"body2",children:"After creating your design, you can add builds and tests to it from the graph view."})})]}),e.jsxs(x,{sx:{p:a[4],borderTop:`1px solid ${s.neutral[200]}`,display:"flex",gap:a[2]},children:[e.jsx(R,{variant:"outlined",onClick:z,fullWidth:!0,disabled:f,children:"Cancel"}),e.jsx(R,{type:"submit",variant:"contained",onClick:n,fullWidth:!0,disabled:f,startIcon:f?e.jsx(H,{size:20}):e.jsx(ie,{}),sx:{backgroundColor:s.primary[500],"&:hover":{backgroundColor:s.primary[600]}},children:f?"Creating...":"Create Design"})]})]})},be=()=>{const{userDetails:r,loading:b}=O(),[y,h]=p.useState(!1),k=M(),j=N(k.breakpoints.down("md")),w=c(n=>n.isLoading),u=c(n=>n.error),D=c(n=>n.fetchAllData),f=c(n=>n.designs),S=c(n=>n.activePanel),C=c(n=>n.filters.searchQuery),o=c(n=>n.filters.courseId),v=ne.useMemo(()=>{let n=f;if(o&&(n=n.filter(l=>l.course===o)),C){const l=C.toLowerCase();n=n.filter(t=>t.title.toLowerCase().includes(l)||t.description.toLowerCase().includes(l))}return n},[f,C,o]);return p.useEffect(()=>{if(!b&&r&&!y){const n=Object.keys(r.classes||{});D(r.uid,r.isAdmin,n),h(!0)}},[r,b,D,y]),b||w&&!y?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"80vh",gap:a[4]},children:[e.jsx(H,{size:60,sx:{color:s.primary[500]}}),e.jsx(m,{variant:"h6",sx:{fontFamily:i.fontFamily.display,color:s.text.secondary},children:"Loading your laboratory notebook..."})]}):u?e.jsxs(x,{sx:{p:a[6]},children:[e.jsx(P,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(F,{severity:"error",sx:{mt:a[4],borderRadius:"12px"},children:[e.jsx(m,{variant:"h6",sx:{mb:1},children:"Error Loading Data"}),e.jsx(m,{variant:"body2",children:u})]})]}):r&&(r.isAdmin||r.isSuperAdmin||r.classes&&Object.keys(r.classes).length>0)?e.jsxs(x,{sx:{p:j?a[3]:a[6],backgroundColor:s.background.primary,minHeight:"100vh"},children:[e.jsx(P,{title:"Laboratory Notebook",subtitle:"Manage your experimental designs, builds, and tests"}),e.jsx(x,{sx:{mb:a[6]},children:e.jsx(de,{})}),y&&e.jsxs(e.Fragment,{children:[e.jsx(x,{sx:{display:"flex",gap:a[4],mb:a[4],flexWrap:"wrap"},children:e.jsxs(x,{sx:{flex:1,minWidth:200,p:a[4],backgroundColor:s.primary[50],borderRadius:I.xl,border:`1px solid ${s.primary[200]}`},children:[e.jsx(m,{variant:"h3",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:s.primary[700],mb:a[1]},children:v.length}),e.jsx(m,{variant:"body2",sx:{color:s.text.secondary,fontWeight:i.fontWeight.medium},children:"Total Designs"})]})}),e.jsx(ce,{designs:v})]}),S==="create"&&e.jsx(ue,{})]}):e.jsxs(x,{sx:{p:a[6]},children:[e.jsx(P,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(F,{severity:"info",sx:{mt:a[4],borderRadius:"12px"},children:[e.jsx(m,{variant:"h6",sx:{mb:1},children:"Course Enrollment Required"}),e.jsx(m,{variant:"body2",children:"The Laboratory Notebook is accessible to users enrolled in an academic course. Please enroll in a course via 'My Account' by following the instructions provided by your academic instructor."})]})]})};export{be as default};
