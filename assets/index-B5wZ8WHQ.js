import{r as q,b3 as dr,b4 as cr,j as i,B as Ge,a as Fe,T as Xe,am as Wr,P as ur,an as $r,ao as Vr,ap as ln,aq as Oe,ar as Qr,as as Gr,N as fr,z as Qt,I as Be,c as st,d as it,D as ut,m as ft,V as ht,W as gt,aj as Zr,ai as Pn,ak as Gt,_ as bt,t as Yr,v as Kr,b8 as Xr,x as Zt,w as Jr,l as Ct,n as zt,o as At,k as es}from"./ui-ySD7tZ62.js";import{u as ts,a as vt,c as ee,s as ve,b as Yt,d as In,t as te,f as Bt,r as ot,C as ns,R as rs,g as qt,h as re,V as dn}from"./index-fxPA-dzp.js";import{q as Un,k as yt,r as jt,n as $t,z as hr,l as gr,p as Dn,_ as Te,h as Pt,e as Ce,f as ss,R as Ee,x as He,v as be,t as rt,m as nt,i as cn,y as wt}from"./firebase-DpGenoA-.js";import{E as mr}from"./Edit-CXVG3aNa.js";import{g as Je}from"./vendor-BFl3bqVE.js";import un from"./purify.es-CQJ0hv7W.js";const pr=q.memo(({setIsAdding:g})=>{console.log("Header loaded");const T=ts(),D=dr(),o=cr(D.breakpoints.down("md")),e=()=>{T("/")};return i.jsxs(Ge,{sx:{p:o?ve[4]:ve[6],backgroundColor:ee.primary[50],borderRadius:Yt["2xl"],mb:ve[6],border:`1px solid ${ee.primary[200]}`,boxShadow:vt.sm},children:[i.jsx(Ge,{sx:{mb:ve[4]},children:i.jsx(Fe,{variant:"text",onClick:e,sx:{fontFamily:te.fontFamily.secondary,fontSize:o?te.fontSize.base:te.fontSize.lg,color:ee.primary[600],textTransform:"none",fontWeight:te.fontWeight.medium,"&:hover":{backgroundColor:ee.primary[100],color:ee.primary[700]},transition:In.transitions.fast},children:"â† Home Page"})}),i.jsxs(Ge,{sx:{mb:ve[6]},children:[i.jsx(Xe,{variant:"h2",sx:{fontFamily:te.fontFamily.display,fontSize:o?te.fontSize["3xl"]:te.fontSize["5xl"],fontWeight:te.fontWeight.bold,color:ee.primary[700],lineHeight:te.lineHeight.tight,mb:ve[2]},children:"Laboratory Notebook"}),i.jsx(Xe,{variant:"body1",sx:{fontFamily:te.fontFamily.primary,fontSize:o?te.fontSize.base:te.fontSize.lg,color:ee.text.secondary,lineHeight:te.lineHeight.relaxed},children:"Manage your lab experiments, designs, and research projects"})]}),i.jsx(Ge,{sx:{display:"flex",justifyContent:"flex-start"},children:i.jsx(Fe,{variant:"contained",onClick:()=>g(!0),sx:{fontFamily:te.fontFamily.display,fontSize:o?te.fontSize.lg:te.fontSize.xl,fontWeight:te.fontWeight.semibold,textTransform:"none",px:o?ve[4]:ve[6],py:ve[3],backgroundColor:ee.primary[500],borderRadius:Yt.xl,boxShadow:vt.md,transition:In.transitions.fast,"&:hover":{backgroundColor:ee.primary[600],boxShadow:vt.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"}},children:"+ Create New Design"})})]})});pr.displayName="Header";const mt=({designs:g,handleEdit:T,handleDelete:D,userDetails:o,showUserIdColumn:e})=>{const t=a=>a?a instanceof Un?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx(Wr,{component:ur,sx:{borderRadius:Yt["2xl"],boxShadow:vt.lg,border:`1px solid ${ee.neutral[200]}`,overflow:"hidden"},children:i.jsxs($r,{sx:{"& .MuiTableCell-root":{fontSize:te.fontSize.base,fontFamily:te.fontFamily.primary,borderBottom:`1px solid ${ee.neutral[200]}`},"& .MuiTableCell-head":{fontSize:te.fontSize.lg,fontFamily:te.fontFamily.display,fontWeight:te.fontWeight.semibold,backgroundColor:ee.primary[500],color:ee.text.inverse,textTransform:"uppercase",letterSpacing:"0.5px"},"& .MuiTableRow-root:hover":{backgroundColor:ee.primary[25]}},children:[i.jsx(Vr,{children:i.jsxs(ln,{sx:{height:"64px"},children:[i.jsx(Oe,{sx:{width:e?"30%":"35%"},children:"Design Title"}),i.jsx(Oe,{sx:{width:"20%"},children:"Course"}),e&&i.jsx(Oe,{sx:{width:"15%"},children:"User"}),i.jsx(Oe,{sx:{width:"15%"},children:"Created"}),i.jsx(Oe,{sx:{width:"15%"},children:"Modified"}),i.jsx(Oe,{sx:{width:"15%",textAlign:"center"},children:"Actions"})]})}),i.jsx(Qr,{children:g&&g.length>0?g.map(a=>{const l=a.userId===(o==null?void 0:o.uid),x=a.course&&(o!=null&&o.classes)&&o.classes[a.course]?o.classes[a.course]:null;return i.jsxs(ln,{sx:{height:"72px",transition:In.transitions.fast,"&:hover":{backgroundColor:ee.primary[25],transform:"translateY(-1px)",boxShadow:vt.sm}},children:[i.jsx(Oe,{children:i.jsxs(Ge,{sx:{display:"flex",alignItems:"center",gap:ve[3]},children:[i.jsx(Gr,{sx:{width:40,height:40,backgroundColor:ee.primary[100],color:ee.primary[700],fontSize:te.fontSize.sm,fontWeight:te.fontWeight.semibold},children:a.title.charAt(0).toUpperCase()}),i.jsx(Xe,{variant:"body1",sx:{fontFamily:te.fontFamily.secondary,fontSize:te.fontSize.base,fontWeight:te.fontWeight.semibold,color:ee.text.primary,cursor:"pointer","&:hover":{color:ee.primary[600],textDecoration:"underline"}},onClick:()=>T(a.id),children:a.title})]})}),i.jsx(Oe,{children:x?i.jsx(fr,{label:`${x.number}`,size:"small",sx:{backgroundColor:ee.secondary[100],color:ee.secondary[700],fontFamily:te.fontFamily.secondary,fontWeight:te.fontWeight.medium,fontSize:te.fontSize.sm}}):i.jsx(Xe,{variant:"body2",sx:{color:ee.text.disabled,fontStyle:"italic"},children:"No Course"})}),e&&i.jsx(Oe,{children:i.jsx(Xe,{variant:"body2",sx:{fontFamily:"monospace",fontSize:te.fontSize.sm,color:ee.text.secondary,wordBreak:"break-all"},children:a.userId})}),i.jsx(Oe,{children:i.jsx(Xe,{variant:"body2",sx:{color:ee.text.secondary,fontSize:te.fontSize.sm},children:t(a.dateCreated)})}),i.jsx(Oe,{children:i.jsx(Xe,{variant:"body2",sx:{color:ee.text.secondary,fontSize:te.fontSize.sm},children:t(a.dateModified)})}),i.jsx(Oe,{sx:{textAlign:"center"},children:i.jsxs(Ge,{sx:{display:"flex",justifyContent:"center",gap:ve[1]},children:[i.jsx(Qt,{title:l?"Edit Design":"Cannot edit others' designs",children:i.jsx("span",{children:i.jsx(Be,{size:"small",onClick:()=>l&&T(a.id),disabled:!l,sx:{color:l?ee.primary[600]:ee.text.disabled,"&:hover":{backgroundColor:l?ee.primary[100]:"transparent"}},children:i.jsx(mr,{fontSize:"small"})})})}),i.jsx(Qt,{title:l?"Delete Design":"Cannot delete others' designs",children:i.jsx("span",{children:i.jsx(Be,{size:"small",onClick:()=>l&&D(a.id),disabled:!l,sx:{color:l?ee.error:ee.text.disabled,"&:hover":{backgroundColor:l?ee.error+"20":"transparent"}},children:i.jsx(Bt,{fontSize:"small"})})})})]})})]},a.id)}):i.jsx(ln,{children:i.jsx(Oe,{colSpan:e?6:5,sx:{textAlign:"center",py:ve[8],color:ee.text.secondary,fontStyle:"italic"},children:i.jsx(Xe,{variant:"body1",children:"No designs found. Create your first design to get started!"})})})})]})})};function is(g,T){return T.forEach(function(D){D&&typeof D!="string"&&!Array.isArray(D)&&Object.keys(D).forEach(function(o){if(o!=="default"&&!(o in g)){var e=Object.getOwnPropertyDescriptor(D,o);Object.defineProperty(g,o,e.get?e:{enumerable:!0,get:function(){return D[o]}})}})}),Object.freeze(g)}function br(g,T){return new Promise(function(D,o){let e;return os(g).then(function(t){try{return e=t,D(new Blob([T.slice(0,2),e,T.slice(2)],{type:"image/jpeg"}))}catch(a){return o(a)}},o)})}const os=g=>new Promise((T,D)=>{const o=new FileReader;o.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let a=0;if(t.getUint16(a)!==65496)return D("not a valid JPEG");for(a+=2;;){const l=t.getUint16(a);if(l===65498)break;const x=t.getUint16(a+2);if(l===65505&&t.getUint32(a+4)===1165519206){const v=a+10;let n;switch(t.getUint16(v)){case 18761:n=!0;break;case 19789:n=!1;break;default:return D("TIFF header contains invalid endian")}if(t.getUint16(v+2,n)!==42)return D("TIFF header contains invalid version");const s=t.getUint32(v+4,n),r=v+s+2+12*t.getUint16(v+s,n);for(let c=v+s+2;c<r;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return D("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return D("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return T(e.slice(a,a+2+x))}a+=2+x}return T(new Blob)}),o.readAsArrayBuffer(g)});var Kt={},as={get exports(){return Kt},set exports(g){Kt=g}};(function(g){var T,D,o={};as.exports=o,o.parse=function(e,t){for(var a=o.bin.readUshort,l=o.bin.readUint,x=0,v={},n=new Uint8Array(e),s=n.length-4;l(n,s)!=101010256;)s--;x=s,x+=4;var r=a(n,x+=4);a(n,x+=2);var c=l(n,x+=2),m=l(n,x+=4);x+=4,x=m;for(var A=0;A<r;A++){l(n,x),x+=4,x+=4,x+=4,l(n,x+=4),c=l(n,x+=4);var U=l(n,x+=4),w=a(n,x+=4),B=a(n,x+2),M=a(n,x+4);x+=6;var _=l(n,x+=8);x+=4,x+=w+B+M,o._readLocal(n,_,v,c,U,t)}return v},o._readLocal=function(e,t,a,l,x,v){var n=o.bin.readUshort,s=o.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var c=n(e,t+=8),m=n(e,t+=2);t+=2;var A=o.bin.readUTF8(e,t,c);if(t+=c,t+=m,v)a[A]={size:x,csize:l};else{var U=new Uint8Array(e.buffer,t);if(r==0)a[A]=new Uint8Array(U.buffer.slice(t,t+l));else{if(r!=8)throw"unknown compression method: "+r;var w=new Uint8Array(x);o.inflateRaw(U,w),a[A]=w}}},o.inflateRaw=function(e,t){return o.F.inflate(e,t)},o.inflate=function(e,t){return e[0],e[1],o.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},o.deflate=function(e,t){t==null&&(t={level:6});var a=0,l=new Uint8Array(50+Math.floor(1.1*e.length));l[a]=120,l[a+1]=156,a+=2,a=o.F.deflateRaw(e,l,a,t.level);var x=o.adler(e,0,e.length);return l[a+0]=x>>>24&255,l[a+1]=x>>>16&255,l[a+2]=x>>>8&255,l[a+3]=x>>>0&255,new Uint8Array(l.buffer,0,a+4)},o.deflateRaw=function(e,t){t==null&&(t={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),l=o.F.deflateRaw(e,a,l,t.level);return new Uint8Array(a.buffer,0,l)},o.encode=function(e,t){t==null&&(t=!1);var a=0,l=o.bin.writeUint,x=o.bin.writeUshort,v={};for(var n in e){var s=!o._noNeed(n)&&!t,r=e[n],c=o.crc.crc(r,0,r.length);v[n]={cpr:s,usize:r.length,crc:c,file:s?o.deflateRaw(r):r}}for(var n in v)a+=v[n].file.length+30+46+2*o.bin.sizeUTF8(n);a+=22;var m=new Uint8Array(a),A=0,U=[];for(var n in v){var w=v[n];U.push(A),A=o._writeHeader(m,A,n,w,0)}var B=0,M=A;for(var n in v)w=v[n],U.push(A),A=o._writeHeader(m,A,n,w,1,U[B++]);var _=A-M;return l(m,A,101010256),A+=4,x(m,A+=4,B),x(m,A+=2,B),l(m,A+=2,_),l(m,A+=4,M),A+=4,A+=2,m.buffer},o._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},o._writeHeader=function(e,t,a,l,x,v){var n=o.bin.writeUint,s=o.bin.writeUshort,r=l.file;return n(e,t,x==0?67324752:33639248),t+=4,x==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,l.cpr?8:0),n(e,t+=2,0),n(e,t+=4,l.crc),n(e,t+=4,r.length),n(e,t+=4,l.usize),s(e,t+=4,o.bin.sizeUTF8(a)),s(e,t+=2,0),t+=2,x==1&&(t+=2,t+=2,n(e,t+=6,v),t+=4),t+=o.bin.writeUTF8(e,t,a),x==0&&(e.set(r,t),t+=r.length),t},o.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var a=t,l=0;l<8;l++)1&a?a=3988292384^a>>>1:a>>>=1;e[t]=a}return e}(),update:function(e,t,a,l){for(var x=0;x<l;x++)e=o.crc.table[255&(e^t[a+x])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^o.crc.update(4294967295,e,t,a)}},o.adler=function(e,t,a){for(var l=1,x=0,v=t,n=t+a;v<n;){for(var s=Math.min(v+5552,n);v<s;)x+=l+=e[v++];l%=65521,x%=65521}return x<<16|l},o.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255,e[t+2]=a>>16&255,e[t+3]=a>>24&255},readASCII:function(e,t,a){for(var l="",x=0;x<a;x++)l+=String.fromCharCode(e[t+x]);return l},writeASCII:function(e,t,a){for(var l=0;l<a.length;l++)e[t+l]=a.charCodeAt(l)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,a){for(var l,x="",v=0;v<a;v++)x+="%"+o.bin.pad(e[t+v].toString(16));try{l=decodeURIComponent(x)}catch{return o.bin.readASCII(e,t,a)}return l},writeUTF8:function(e,t,a){for(var l=a.length,x=0,v=0;v<l;v++){var n=a.charCodeAt(v);if((4294967168&n)==0)e[t+x]=n,x++;else if((4294965248&n)==0)e[t+x]=192|n>>6,e[t+x+1]=128|n>>0&63,x+=2;else if((4294901760&n)==0)e[t+x]=224|n>>12,e[t+x+1]=128|n>>6&63,e[t+x+2]=128|n>>0&63,x+=3;else{if((4292870144&n)!=0)throw"e";e[t+x]=240|n>>18,e[t+x+1]=128|n>>12&63,e[t+x+2]=128|n>>6&63,e[t+x+3]=128|n>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var t=e.length,a=0,l=0;l<t;l++){var x=e.charCodeAt(l);if((4294967168&x)==0)a++;else if((4294965248&x)==0)a+=2;else if((4294901760&x)==0)a+=3;else{if((4292870144&x)!=0)throw"e";a+=4}}return a}},o.F={},o.F.deflateRaw=function(e,t,a,l){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][l],v=o.F.U,n=o.F._goodIndex;o.F._hash;var s=o.F._putsE,r=0,c=a<<3,m=0,A=e.length;if(l==0){for(;r<A;)s(t,c,r+(j=Math.min(65535,A-r))==A?1:0),c=o.F._copyExact(e,r,j,t,c+8),r+=j;return c>>>3}var U=v.lits,w=v.strt,B=v.prev,M=0,_=0,P=0,y=0,R=0,u=0;for(A>2&&(w[u=o.F._hash(e,0)]=0),r=0;r<A;r++){if(R=u,r+1<A-2){u=o.F._hash(e,r+1);var f=r+1&32767;B[f]=w[u],w[u]=f}if(m<=r){(M>14e3||_>26697)&&A-r>100&&(m<r&&(U[M]=r-m,M+=2,m=r),c=o.F._writeBlock(r==A-1||m==A?1:0,U,M,y,e,P,r-P,t,c),M=_=y=0,P=r);var p=0;r<A-2&&(p=o.F._bestMatch(e,r,B,R,Math.min(x[2],A-r),x[3]));var j=p>>>16,S=65535&p;if(p!=0){S=65535&p;var C=n(j=p>>>16,v.of0);v.lhst[257+C]++;var b=n(S,v.df0);v.dhst[b]++,y+=v.exb[C]+v.dxb[b],U[M]=j<<23|r-m,U[M+1]=S<<16|C<<8|b,M+=2,m=r+j}else v.lhst[e[r]]++;_++}}for(P==r&&e.length!=0||(m<r&&(U[M]=r-m,M+=2,m=r),c=o.F._writeBlock(1,U,M,y,e,P,r-P,t,c),M=0,_=0,M=_=y=0,P=r);(7&c)!=0;)c++;return c>>>3},o.F._bestMatch=function(e,t,a,l,x,v){var n=32767&t,s=a[n],r=n-s+32768&32767;if(s==n||l!=o.F._hash(e,t-r))return 0;for(var c=0,m=0,A=Math.min(32767,t);r<=A&&--v!=0&&s!=n;){if(c==0||e[t+c]==e[t+c-r]){var U=o.F._howLong(e,t,r);if(U>c){if(m=r,(c=U)>=x)break;r+2<U&&(U=r+2);for(var w=0,B=0;B<U-2;B++){var M=t-r+B+32768&32767,_=M-a[M]+32768&32767;_>w&&(w=_,s=M)}}}r+=(n=s)-(s=a[n])+32768&32767}return c<<16|m},o.F._howLong=function(e,t,a){if(e[t]!=e[t-a]||e[t+1]!=e[t+1-a]||e[t+2]!=e[t+2-a])return 0;var l=t,x=Math.min(e.length,t+258);for(t+=3;t<x&&e[t]==e[t-a];)t++;return t-l},o.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},o.saved=0,o.F._writeBlock=function(e,t,a,l,x,v,n,s,r){var c,m,A,U,w,B,M,_,P,y=o.F.U,R=o.F._putsF,u=o.F._putsE;y.lhst[256]++,m=(c=o.F.getTrees())[0],A=c[1],U=c[2],w=c[3],B=c[4],M=c[5],_=c[6],P=c[7];var f=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),p=l+o.F.contSize(y.fltree,y.lhst)+o.F.contSize(y.fdtree,y.dhst),j=l+o.F.contSize(y.ltree,y.lhst)+o.F.contSize(y.dtree,y.dhst);j+=14+3*M+o.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var S=0;S<286;S++)y.lhst[S]=0;for(S=0;S<30;S++)y.dhst[S]=0;for(S=0;S<19;S++)y.ihst[S]=0;var C=f<p&&f<j?0:p<j?1:2;if(R(s,r,e),R(s,r+1,C),r+=3,C==0){for(;(7&r)!=0;)r++;r=o.F._copyExact(x,v,n,s,r)}else{var b,F;if(C==1&&(b=y.fltree,F=y.fdtree),C==2){o.F.makeCodes(y.ltree,m),o.F.revCodes(y.ltree,m),o.F.makeCodes(y.dtree,A),o.F.revCodes(y.dtree,A),o.F.makeCodes(y.itree,U),o.F.revCodes(y.itree,U),b=y.ltree,F=y.dtree,u(s,r,w-257),u(s,r+=5,B-1),u(s,r+=5,M-4),r+=4;for(var h=0;h<M;h++)u(s,r+3*h,y.itree[1+(y.ordr[h]<<1)]);r+=3*M,r=o.F._codeTiny(_,y.itree,s,r),r=o.F._codeTiny(P,y.itree,s,r)}for(var d=v,E=0;E<a;E+=2){for(var I=t[E],N=I>>>23,$=d+(8388607&I);d<$;)r=o.F._writeLit(x[d++],b,s,r);if(N!=0){var H=t[E+1],V=H>>16,L=H>>8&255,O=255&H;u(s,r=o.F._writeLit(257+L,b,s,r),N-y.of0[L]),r+=y.exb[L],R(s,r=o.F._writeLit(O,F,s,r),V-y.df0[O]),r+=y.dxb[O],d+=N}}r=o.F._writeLit(256,b,s,r)}return r},o.F._copyExact=function(e,t,a,l,x){var v=x>>>3;return l[v]=a,l[v+1]=a>>>8,l[v+2]=255-l[v],l[v+3]=255-l[v+1],v+=4,l.set(new Uint8Array(e.buffer,t,a),v),x+(a+4<<3)},o.F.getTrees=function(){for(var e=o.F.U,t=o.F._hufTree(e.lhst,e.ltree,15),a=o.F._hufTree(e.dhst,e.dtree,15),l=[],x=o.F._lenCodes(e.ltree,l),v=[],n=o.F._lenCodes(e.dtree,v),s=0;s<l.length;s+=2)e.ihst[l[s]]++;for(s=0;s<v.length;s+=2)e.ihst[v[s]]++;for(var r=o.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,a,r,x,n,c,l,v]},o.F.getSecond=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(e[a+1]);return t},o.F.nonZero=function(e){for(var t="",a=0;a<e.length;a+=2)e[a+1]!=0&&(t+=(a>>1)+",");return t},o.F.contSize=function(e,t){for(var a=0,l=0;l<t.length;l++)a+=t[l]*e[1+(l<<1)];return a},o.F._codeTiny=function(e,t,a,l){for(var x=0;x<e.length;x+=2){var v=e[x],n=e[x+1];l=o.F._writeLit(v,t,a,l);var s=v==16?2:v==17?3:7;v>15&&(o.F._putsE(a,l,n,s),l+=s)}return l},o.F._lenCodes=function(e,t){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var l=0;l<a;l+=2){var x=e[l+1],v=l+3<a?e[l+3]:-1,n=l+5<a?e[l+5]:-1,s=l==0?-1:e[l-1];if(x==0&&v==x&&n==x){for(var r=l+5;r+2<a&&e[r+2]==x;)r+=2;(c=Math.min(r+1-l>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),l+=2*c-2}else if(x==s&&v==x&&n==x){for(r=l+5;r+2<a&&e[r+2]==x;)r+=2;var c=Math.min(r+1-l>>>1,6);t.push(16,c-3),l+=2*c-2}else t.push(x,0)}return a>>>1},o.F._hufTree=function(e,t,a){var l=[],x=e.length,v=t.length,n=0;for(n=0;n<v;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<x;n++)e[n]!=0&&l.push({lit:n,f:e[n]});var s=l.length,r=l.slice(0);if(s==0)return 0;if(s==1){var c=l[0].lit;return r=c==0?1:0,t[1+(c<<1)]=1,t[1+(r<<1)]=1,1}l.sort(function(_,P){return _.f-P.f});var m=l[0],A=l[1],U=0,w=1,B=2;for(l[0]={lit:-1,f:m.f+A.f,l:m,r:A,d:0};w!=s-1;)m=U!=w&&(B==s||l[U].f<l[B].f)?l[U++]:l[B++],A=U!=w&&(B==s||l[U].f<l[B].f)?l[U++]:l[B++],l[w++]={lit:-1,f:m.f+A.f,l:m,r:A};var M=o.F.setDepth(l[w-1],0);for(M>a&&(o.F.restrictDepth(r,a,M),M=a),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return M},o.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(o.F.setDepth(e.l,t+1),o.F.setDepth(e.r,t+1))},o.F.restrictDepth=function(e,t,a){var l=0,x=1<<a-t,v=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),l=0;l<e.length&&e[l].d>t;l++){var n=e[l].d;e[l].d=t,v+=x-(1<<a-n)}for(v>>>=a-t;v>0;)(n=e[l].d)<t?(e[l].d++,v-=1<<t-n-1):l++;for(;l>=0;l--)e[l].d==t&&v<0&&(e[l].d--,v++);v!=0&&console.log("debt left")},o.F._goodIndex=function(e,t){var a=0;return t[16|a]<=e&&(a|=16),t[8|a]<=e&&(a|=8),t[4|a]<=e&&(a|=4),t[2|a]<=e&&(a|=2),t[1|a]<=e&&(a|=1),a},o.F._writeLit=function(e,t,a,l){return o.F._putsF(a,l,t[e<<1]),l+t[1+(e<<1)]},o.F.inflate=function(e,t){var a=Uint8Array;if(e[0]==3&&e[1]==0)return t||new a(0);var l=o.F,x=l._bitsF,v=l._bitsE,n=l._decodeTiny,s=l.makeCodes,r=l.codes2map,c=l._get17,m=l.U,A=t==null;A&&(t=new a(e.length>>>2<<3));for(var U,w,B=0,M=0,_=0,P=0,y=0,R=0,u=0,f=0,p=0;B==0;)if(B=x(e,p,1),M=x(e,p+1,2),p+=3,M!=0){if(A&&(t=o.F._check(t,f+(1<<17))),M==1&&(U=m.flmap,w=m.fdmap,R=511,u=31),M==2){_=v(e,p,5)+257,P=v(e,p+5,5)+1,y=v(e,p+10,4)+4,p+=14;for(var j=0;j<38;j+=2)m.itree[j]=0,m.itree[j+1]=0;var S=1;for(j=0;j<y;j++){var C=v(e,p+3*j,3);m.itree[1+(m.ordr[j]<<1)]=C,C>S&&(S=C)}p+=3*y,s(m.itree,S),r(m.itree,S,m.imap),U=m.lmap,w=m.dmap,p=n(m.imap,(1<<S)-1,_+P,e,p,m.ttree);var b=l._copyOut(m.ttree,0,_,m.ltree);R=(1<<b)-1;var F=l._copyOut(m.ttree,_,P,m.dtree);u=(1<<F)-1,s(m.ltree,b),r(m.ltree,b,U),s(m.dtree,F),r(m.dtree,F,w)}for(;;){var h=U[c(e,p)&R];p+=15&h;var d=h>>>4;if(!(d>>>8))t[f++]=d;else{if(d==256)break;var E=f+d-254;if(d>264){var I=m.ldef[d-257];E=f+(I>>>3)+v(e,p,7&I),p+=7&I}var N=w[c(e,p)&u];p+=15&N;var $=N>>>4,H=m.ddef[$],V=(H>>>4)+x(e,p,15&H);for(p+=15&H,A&&(t=o.F._check(t,f+(1<<17)));f<E;)t[f]=t[f++-V],t[f]=t[f++-V],t[f]=t[f++-V],t[f]=t[f++-V];f=E}}}else{(7&p)!=0&&(p+=8-(7&p));var L=4+(p>>>3),O=e[L-4]|e[L-3]<<8;A&&(t=o.F._check(t,f+O)),t.set(new a(e.buffer,e.byteOffset+L,O),f),p=L+O<<3,f+=O}return t.length==f?t:t.slice(0,f)},o.F._check=function(e,t){var a=e.length;if(t<=a)return e;var l=new Uint8Array(Math.max(a<<1,t));return l.set(e,0),l},o.F._decodeTiny=function(e,t,a,l,x,v){for(var n=o.F._bitsE,s=o.F._get17,r=0;r<a;){var c=e[s(l,x)&t];x+=15&c;var m=c>>>4;if(m<=15)v[r]=m,r++;else{var A=0,U=0;m==16?(U=3+n(l,x,2),x+=2,A=v[r-1]):m==17?(U=3+n(l,x,3),x+=3):m==18&&(U=11+n(l,x,7),x+=7);for(var w=r+U;r<w;)v[r]=A,r++}}return x},o.F._copyOut=function(e,t,a,l){for(var x=0,v=0,n=l.length>>>1;v<a;){var s=e[v+t];l[v<<1]=0,l[1+(v<<1)]=s,s>x&&(x=s),v++}for(;v<n;)l[v<<1]=0,l[1+(v<<1)]=0,v++;return x},o.F.makeCodes=function(e,t){for(var a,l,x,v,n=o.F.U,s=e.length,r=n.bl_count,c=0;c<=t;c++)r[c]=0;for(c=1;c<s;c+=2)r[e[c]]++;var m=n.next_code;for(a=0,r[0]=0,l=1;l<=t;l++)a=a+r[l-1]<<1,m[l]=a;for(x=0;x<s;x+=2)(v=e[x+1])!=0&&(e[x]=m[v],m[v]++)},o.F.codes2map=function(e,t,a){for(var l=e.length,x=o.F.U.rev15,v=0;v<l;v+=2)if(e[v+1]!=0)for(var n=v>>1,s=e[v+1],r=n<<4|s,c=t-s,m=e[v]<<c,A=m+(1<<c);m!=A;)a[x[m]>>>15-t]=r,m++},o.F.revCodes=function(e,t){for(var a=o.F.U.rev15,l=15-t,x=0;x<e.length;x+=2){var v=e[x]<<t-e[x+1];e[x]=a[v]>>>l}},o.F._putsE=function(e,t,a){a<<=7&t;var l=t>>>3;e[l]|=a,e[l+1]|=a>>>8},o.F._putsF=function(e,t,a){a<<=7&t;var l=t>>>3;e[l]|=a,e[l+1]|=a>>>8,e[l+2]|=a>>>16},o.F._bitsE=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<a)-1},o.F._bitsF=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<a)-1},o.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},o.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},o.F.U=(T=Uint16Array,D=Uint32Array,{next_code:new T(16),bl_count:new T(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new T(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new T(512),fltree:[],fdmap:new T(32),fdtree:[],lmap:new T(32768),ltree:[],ttree:[],dmap:new T(32768),dtree:[],imap:new T(512),itree:[],rev15:new T(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new T(65536),prev:new T(32768)}),function(){for(var e=o.F.U,t=0;t<32768;t++){var a=t;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[t]=(a>>>16|a<<16)>>>17}function l(x,v,n){for(;v--!=0;)x.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];l(e.fltree,144,8),l(e.fltree,112,9),l(e.fltree,24,7),l(e.fltree,8,8),o.F.makeCodes(e.fltree,9),o.F.codes2map(e.fltree,9,e.flmap),o.F.revCodes(e.fltree,9),l(e.fdtree,32,5),o.F.makeCodes(e.fdtree,5),o.F.codes2map(e.fdtree,5,e.fdmap),o.F.revCodes(e.fdtree,5),l(e.itree,19,0),l(e.ltree,286,0),l(e.dtree,30,0),l(e.ttree,320,0)}()})();var ls=is({__proto__:null,default:Kt},[Kt]);const qe=function(){var g={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let c="";for(let m=0;m<r;m++)c+=String.fromCharCode(n[s+m]);return c},writeASCII(n,s,r){for(let c=0;c<r.length;c++)n[s+c]=r.charCodeAt(c)},readBytes(n,s,r){const c=[];for(let m=0;m<r;m++)c.push(n[s+m]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let c,m="";for(let A=0;A<r;A++)m+=`%${g.pad(n[s+A].toString(16))}`;try{c=decodeURIComponent(m)}catch{return g.readASCII(n,s,r)}return c}};function T(n,s,r,c){const m=s*r,A=t(c),U=Math.ceil(s*A/8),w=new Uint8Array(4*m),B=new Uint32Array(w.buffer),{ctype:M}=c,{depth:_}=c,P=g.readUshort;if(M==6){const I=m<<2;if(_==8)for(var y=0;y<I;y+=4)w[y]=n[y],w[y+1]=n[y+1],w[y+2]=n[y+2],w[y+3]=n[y+3];if(_==16)for(y=0;y<I;y++)w[y]=n[y<<1]}else if(M==2){const I=c.tabs.tRNS;if(I==null){if(_==8)for(y=0;y<m;y++){var R=3*y;B[y]=255<<24|n[R+2]<<16|n[R+1]<<8|n[R]}if(_==16)for(y=0;y<m;y++)R=6*y,B[y]=255<<24|n[R+4]<<16|n[R+2]<<8|n[R]}else{var u=I[0];const N=I[1],$=I[2];if(_==8)for(y=0;y<m;y++){var f=y<<2;R=3*y,B[y]=255<<24|n[R+2]<<16|n[R+1]<<8|n[R],n[R]==u&&n[R+1]==N&&n[R+2]==$&&(w[f+3]=0)}if(_==16)for(y=0;y<m;y++)f=y<<2,R=6*y,B[y]=255<<24|n[R+4]<<16|n[R+2]<<8|n[R],P(n,R)==u&&P(n,R+2)==N&&P(n,R+4)==$&&(w[f+3]=0)}}else if(M==3){const I=c.tabs.PLTE,N=c.tabs.tRNS,$=N?N.length:0;if(_==1)for(var p=0;p<r;p++){var j=p*U,S=p*s;for(y=0;y<s;y++){f=S+y<<2;var C=3*(b=n[j+(y>>3)]>>7-((7&y)<<0)&1);w[f]=I[C],w[f+1]=I[C+1],w[f+2]=I[C+2],w[f+3]=b<$?N[b]:255}}if(_==2)for(p=0;p<r;p++)for(j=p*U,S=p*s,y=0;y<s;y++)f=S+y<<2,C=3*(b=n[j+(y>>2)]>>6-((3&y)<<1)&3),w[f]=I[C],w[f+1]=I[C+1],w[f+2]=I[C+2],w[f+3]=b<$?N[b]:255;if(_==4)for(p=0;p<r;p++)for(j=p*U,S=p*s,y=0;y<s;y++)f=S+y<<2,C=3*(b=n[j+(y>>1)]>>4-((1&y)<<2)&15),w[f]=I[C],w[f+1]=I[C+1],w[f+2]=I[C+2],w[f+3]=b<$?N[b]:255;if(_==8)for(y=0;y<m;y++){var b;f=y<<2,C=3*(b=n[y]),w[f]=I[C],w[f+1]=I[C+1],w[f+2]=I[C+2],w[f+3]=b<$?N[b]:255}}else if(M==4){if(_==8)for(y=0;y<m;y++){f=y<<2;var F=n[h=y<<1];w[f]=F,w[f+1]=F,w[f+2]=F,w[f+3]=n[h+1]}if(_==16)for(y=0;y<m;y++){var h;f=y<<2,F=n[h=y<<2],w[f]=F,w[f+1]=F,w[f+2]=F,w[f+3]=n[h+2]}}else if(M==0)for(u=c.tabs.tRNS?c.tabs.tRNS:-1,p=0;p<r;p++){const I=p*U,N=p*s;if(_==1)for(var d=0;d<s;d++){var E=(F=255*(n[I+(d>>>3)]>>>7-(7&d)&1))==255*u?0:255;B[N+d]=E<<24|F<<16|F<<8|F}else if(_==2)for(d=0;d<s;d++)E=(F=85*(n[I+(d>>>2)]>>>6-((3&d)<<1)&3))==85*u?0:255,B[N+d]=E<<24|F<<16|F<<8|F;else if(_==4)for(d=0;d<s;d++)E=(F=17*(n[I+(d>>>1)]>>>4-((1&d)<<2)&15))==17*u?0:255,B[N+d]=E<<24|F<<16|F<<8|F;else if(_==8)for(d=0;d<s;d++)E=(F=n[I+d])==u?0:255,B[N+d]=E<<24|F<<16|F<<8|F;else if(_==16)for(d=0;d<s;d++)F=n[I+(d<<1)],E=P(n,I+(d<<1))==u?0:255,B[N+d]=E<<24|F<<16|F<<8|F}return w}function D(n,s,r,c){const m=t(n),A=Math.ceil(r*m/8),U=new Uint8Array((A+1+n.interlace)*c);return s=n.tabs.CgBI?e(s,U):o(s,U),n.interlace==0?s=a(s,n,0,r,c):n.interlace==1&&(s=function(B,M){const _=M.width,P=M.height,y=t(M),R=y>>3,u=Math.ceil(_*y/8),f=new Uint8Array(P*u);let p=0;const j=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let F=0;for(;F<7;){const d=C[F],E=b[F];let I=0,N=0,$=j[F];for(;$<P;)$+=d,N++;let H=S[F];for(;H<_;)H+=E,I++;const V=Math.ceil(I*y/8);a(B,M,p,I,N);let L=0,O=j[F];for(;O<P;){let Y=S[F],ne=p+L*V<<3;for(;Y<_;){var h;if(y==1&&(h=(h=B[ne>>3])>>7-(7&ne)&1,f[O*u+(Y>>3)]|=h<<7-((7&Y)<<0)),y==2&&(h=(h=B[ne>>3])>>6-(7&ne)&3,f[O*u+(Y>>2)]|=h<<6-((3&Y)<<1)),y==4&&(h=(h=B[ne>>3])>>4-(7&ne)&15,f[O*u+(Y>>1)]|=h<<4-((1&Y)<<2)),y>=8){const K=O*u+Y*R;for(let J=0;J<R;J++)f[K+J]=B[(ne>>3)+J]}ne+=y,Y+=E}L++,O+=d}I*N!=0&&(p+=N*(1+V)),F+=1}return f}(s,n)),s}function o(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const c=Uint8Array;let m,A,U=0,w=0,B=0,M=0,_=0,P=0,y=0,R=0,u=0;if(s[0]==3&&s[1]==0)return r||new c(0);const f=n.H,p=f.b,j=f.e,S=f.R,C=f.n,b=f.A,F=f.Z,h=f.m,d=r==null;for(d&&(r=new c(s.length>>>2<<5));U==0;)if(U=p(s,u,1),w=p(s,u+1,2),u+=3,w!=0){if(d&&(r=n.H.W(r,R+(1<<17))),w==1&&(m=h.J,A=h.h,P=511,y=31),w==2){B=j(s,u,5)+257,M=j(s,u+5,5)+1,_=j(s,u+10,4)+4,u+=14;let I=1;for(var E=0;E<38;E+=2)h.Q[E]=0,h.Q[E+1]=0;for(E=0;E<_;E++){const H=j(s,u+3*E,3);h.Q[1+(h.X[E]<<1)]=H,H>I&&(I=H)}u+=3*_,C(h.Q,I),b(h.Q,I,h.u),m=h.w,A=h.d,u=S(h.u,(1<<I)-1,B+M,s,u,h.v);const N=f.V(h.v,0,B,h.C);P=(1<<N)-1;const $=f.V(h.v,B,M,h.D);y=(1<<$)-1,C(h.C,N),b(h.C,N,m),C(h.D,$),b(h.D,$,A)}for(;;){const I=m[F(s,u)&P];u+=15&I;const N=I>>>4;if(!(N>>>8))r[R++]=N;else{if(N==256)break;{let $=R+N-254;if(N>264){const Y=h.q[N-257];$=R+(Y>>>3)+j(s,u,7&Y),u+=7&Y}const H=A[F(s,u)&y];u+=15&H;const V=H>>>4,L=h.c[V],O=(L>>>4)+p(s,u,15&L);for(u+=15&L;R<$;)r[R]=r[R++-O],r[R]=r[R++-O],r[R]=r[R++-O],r[R]=r[R++-O];R=$}}}}else{(7&u)!=0&&(u+=8-(7&u));const I=4+(u>>>3),N=s[I-4]|s[I-3]<<8;d&&(r=n.H.W(r,R+N)),r.set(new c(s.buffer,s.byteOffset+I,N),R),u=I+N<<3,R+=N}return r.length==R?r:r.slice(0,R)},n.H.W=function(s,r){const c=s.length;if(r<=c)return s;const m=new Uint8Array(c<<1);return m.set(s,0),m},n.H.R=function(s,r,c,m,A,U){const w=n.H.e,B=n.H.Z;let M=0;for(;M<c;){const _=s[B(m,A)&r];A+=15&_;const P=_>>>4;if(P<=15)U[M]=P,M++;else{let y=0,R=0;P==16?(R=3+w(m,A,2),A+=2,y=U[M-1]):P==17?(R=3+w(m,A,3),A+=3):P==18&&(R=11+w(m,A,7),A+=7);const u=M+R;for(;M<u;)U[M]=y,M++}}return A},n.H.V=function(s,r,c,m){let A=0,U=0;const w=m.length>>>1;for(;U<c;){const B=s[U+r];m[U<<1]=0,m[1+(U<<1)]=B,B>A&&(A=B),U++}for(;U<w;)m[U<<1]=0,m[1+(U<<1)]=0,U++;return A},n.H.n=function(s,r){const c=n.H.m,m=s.length;let A,U,w,B;const M=c.j;for(var _=0;_<=r;_++)M[_]=0;for(_=1;_<m;_+=2)M[s[_]]++;const P=c.K;for(A=0,M[0]=0,U=1;U<=r;U++)A=A+M[U-1]<<1,P[U]=A;for(w=0;w<m;w+=2)B=s[w+1],B!=0&&(s[w]=P[B],P[B]++)},n.H.A=function(s,r,c){const m=s.length,A=n.H.m.r;for(let U=0;U<m;U+=2)if(s[U+1]!=0){const w=U>>1,B=s[U+1],M=w<<4|B,_=r-B;let P=s[U]<<_;const y=P+(1<<_);for(;P!=y;)c[A[P]>>>15-r]=M,P++}},n.H.l=function(s,r){const c=n.H.m.r,m=15-r;for(let A=0;A<s.length;A+=2){const U=s[A]<<r-s[A+1];s[A]=c[U]>>>m}},n.H.M=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8},n.H.I=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8,s[m+2]|=c>>>16},n.H.e=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<c)-1},n.H.b=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<c)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let m=r;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,s.r[r]=(m>>>16|m<<16)>>>17}function c(m,A,U){for(;A--!=0;)m.push(0,U)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];c(s._,144,8),c(s._,112,9),c(s._,24,7),c(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),c(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),c(s.Q,19,0),c(s.C,286,0),c(s.D,30,0),c(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function a(n,s,r,c,m){let A=t(s);const U=Math.ceil(c*A/8);let w,B;A=Math.ceil(A/8);let M=n[r],_=0;if(M>1&&(n[r]=[0,0,1][M-2]),M==3)for(_=A;_<U;_++)n[_+1]=n[_+1]+(n[_+1-A]>>>1)&255;for(let P=0;P<m;P++)if(w=r+P*U,B=w+P+1,M=n[B-1],_=0,M==0)for(;_<U;_++)n[w+_]=n[B+_];else if(M==1){for(;_<A;_++)n[w+_]=n[B+_];for(;_<U;_++)n[w+_]=n[B+_]+n[w+_-A]}else if(M==2)for(;_<U;_++)n[w+_]=n[B+_]+n[w+_-U];else if(M==3){for(;_<A;_++)n[w+_]=n[B+_]+(n[w+_-U]>>>1);for(;_<U;_++)n[w+_]=n[B+_]+(n[w+_-U]+n[w+_-A]>>>1)}else{for(;_<A;_++)n[w+_]=n[B+_]+l(0,n[w+_-U],0);for(;_<U;_++)n[w+_]=n[B+_]+l(n[w+_-A],n[w+_-U],n[w+_-A-U])}return n}function l(n,s,r){const c=n+s-r,m=c-n,A=c-s,U=c-r;return m*m<=A*A&&m*m<=U*U?n:A*A<=U*U?s:r}function x(n,s,r){r.width=g.readUint(n,s),s+=4,r.height=g.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function v(n,s,r,c,m,A,U,w,B){const M=Math.min(s,m),_=Math.min(r,A);let P=0,y=0;for(let F=0;F<_;F++)for(let h=0;h<M;h++)if(U>=0&&w>=0?(P=F*s+h<<2,y=(w+F)*m+U+h<<2):(P=(-w+F)*s-U+h<<2,y=F*m+h<<2),B==0)c[y]=n[P],c[y+1]=n[P+1],c[y+2]=n[P+2],c[y+3]=n[P+3];else if(B==1){var R=n[P+3]*.00392156862745098,u=n[P]*R,f=n[P+1]*R,p=n[P+2]*R,j=c[y+3]*(1/255),S=c[y]*j,C=c[y+1]*j,b=c[y+2]*j;const d=1-R,E=R+j*d,I=E==0?0:1/E;c[y+3]=255*E,c[y+0]=(u+S*d)*I,c[y+1]=(f+C*d)*I,c[y+2]=(p+b*d)*I}else if(B==2)R=n[P+3],u=n[P],f=n[P+1],p=n[P+2],j=c[y+3],S=c[y],C=c[y+1],b=c[y+2],R==j&&u==S&&f==C&&p==b?(c[y]=0,c[y+1]=0,c[y+2]=0,c[y+3]=0):(c[y]=u,c[y+1]=f,c[y+2]=p,c[y+3]=R);else if(B==3){if(R=n[P+3],u=n[P],f=n[P+1],p=n[P+2],j=c[y+3],S=c[y],C=c[y+1],b=c[y+2],R==j&&u==S&&f==C&&p==b)continue;if(R<220&&j>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let c=8;const m=g,A=m.readUshort,U=m.readUint,w={tabs:{},frames:[]},B=new Uint8Array(r.length);let M,_=0,P=0;const y=[137,80,78,71,13,10,26,10];for(var R=0;R<8;R++)if(r[R]!=y[R])throw"The input is not a PNG file!";for(;c<r.length;){const F=m.readUint(r,c);c+=4;const h=m.readASCII(r,c,4);if(c+=4,h=="IHDR")x(r,c,w);else if(h=="iCCP"){for(var u=c;r[u]!=0;)u++;m.readASCII(r,c,u-c),r[u+1];const d=r.slice(u+2,c+F);let E=null;try{E=o(d)}catch{E=e(d)}w.tabs[h]=E}else if(h=="CgBI")w.tabs[h]=r.slice(c,c+4);else if(h=="IDAT"){for(R=0;R<F;R++)B[_+R]=r[c+R];_+=F}else if(h=="acTL")w.tabs[h]={num_frames:U(r,c),num_plays:U(r,c+4)},M=new Uint8Array(r.length);else if(h=="fcTL"){P!=0&&((b=w.frames[w.frames.length-1]).data=D(w,M.slice(0,P),b.rect.width,b.rect.height),P=0);const d={x:U(r,c+12),y:U(r,c+16),width:U(r,c+4),height:U(r,c+8)};let E=A(r,c+22);E=A(r,c+20)/(E==0?100:E);const I={rect:d,delay:Math.round(1e3*E),dispose:r[c+24],blend:r[c+25]};w.frames.push(I)}else if(h=="fdAT"){for(R=0;R<F-4;R++)M[P+R]=r[c+R+4];P+=F-4}else if(h=="pHYs")w.tabs[h]=[m.readUint(r,c),m.readUint(r,c+4),r[c+8]];else if(h=="cHRM")for(w.tabs[h]=[],R=0;R<8;R++)w.tabs[h].push(m.readUint(r,c+4*R));else if(h=="tEXt"||h=="zTXt"){w.tabs[h]==null&&(w.tabs[h]={});var f=m.nextZero(r,c),p=m.readASCII(r,c,f-c),j=c+F-f-1;if(h=="tEXt")C=m.readASCII(r,f+1,j);else{var S=o(r.slice(f+2,f+2+j));C=m.readUTF8(S,0,S.length)}w.tabs[h][p]=C}else if(h=="iTXt"){w.tabs[h]==null&&(w.tabs[h]={}),f=0,u=c,f=m.nextZero(r,u),p=m.readASCII(r,u,f-u);const d=r[u=f+1];var C;r[u+1],u+=2,f=m.nextZero(r,u),m.readASCII(r,u,f-u),u=f+1,f=m.nextZero(r,u),m.readUTF8(r,u,f-u),j=F-((u=f+1)-c),d==0?C=m.readUTF8(r,u,j):(S=o(r.slice(u,u+j)),C=m.readUTF8(S,0,S.length)),w.tabs[h][p]=C}else if(h=="PLTE")w.tabs[h]=m.readBytes(r,c,F);else if(h=="hIST"){const d=w.tabs.PLTE.length/3;for(w.tabs[h]=[],R=0;R<d;R++)w.tabs[h].push(A(r,c+2*R))}else if(h=="tRNS")w.ctype==3?w.tabs[h]=m.readBytes(r,c,F):w.ctype==0?w.tabs[h]=A(r,c):w.ctype==2&&(w.tabs[h]=[A(r,c),A(r,c+2),A(r,c+4)]);else if(h=="gAMA")w.tabs[h]=m.readUint(r,c)/1e5;else if(h=="sRGB")w.tabs[h]=r[c];else if(h=="bKGD")w.ctype==0||w.ctype==4?w.tabs[h]=[A(r,c)]:w.ctype==2||w.ctype==6?w.tabs[h]=[A(r,c),A(r,c+2),A(r,c+4)]:w.ctype==3&&(w.tabs[h]=r[c]);else if(h=="IEND")break;c+=F,m.readUint(r,c),c+=4}var b;return P!=0&&((b=w.frames[w.frames.length-1]).data=D(w,M.slice(0,P),b.rect.width,b.rect.height)),w.data=D(w,B,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(s){const r=s.width,c=s.height;if(s.tabs.acTL==null)return[T(s.data,r,c,s).buffer];const m=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const A=r*c*4,U=new Uint8Array(A),w=new Uint8Array(A),B=new Uint8Array(A);for(let _=0;_<s.frames.length;_++){const P=s.frames[_],y=P.rect.x,R=P.rect.y,u=P.rect.width,f=P.rect.height,p=T(P.data,u,f,s);if(_!=0)for(var M=0;M<A;M++)B[M]=U[M];if(P.blend==0?v(p,u,f,U,r,c,y,R,0):P.blend==1&&v(p,u,f,U,r,c,y,R,1),m.push(U.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)v(w,u,f,U,r,c,y,R,0);else if(P.dispose==2)for(M=0;M<A;M++)U[M]=B[M]}}return m},_paeth:l,_copyTile:v,_bin:g}}();(function(){const{_copyTile:g}=qe,{_bin:T}=qe,D=qe._paeth;var o={table:function(){const u=new Uint32Array(256);for(let f=0;f<256;f++){let p=f;for(let j=0;j<8;j++)1&p?p=3988292384^p>>>1:p>>>=1;u[f]=p}return u}(),update(u,f,p,j){for(let S=0;S<j;S++)u=o.table[255&(u^f[p+S])]^u>>>8;return u},crc:(u,f,p)=>4294967295^o.update(4294967295,u,f,p)};function e(u,f,p,j){f[p]+=u[0]*j>>4,f[p+1]+=u[1]*j>>4,f[p+2]+=u[2]*j>>4,f[p+3]+=u[3]*j>>4}function t(u){return Math.max(0,Math.min(255,u))}function a(u,f){const p=u[0]-f[0],j=u[1]-f[1],S=u[2]-f[2],C=u[3]-f[3];return p*p+j*j+S*S+C*C}function l(u,f,p,j,S,C,b){b==null&&(b=1);const F=j.length,h=[];for(var d=0;d<F;d++){const O=j[d];h.push([O>>>0&255,O>>>8&255,O>>>16&255,O>>>24&255])}for(d=0;d<F;d++){let O=4294967295;for(var E=0,I=0;I<F;I++){var N=a(h[d],h[I]);I!=d&&N<O&&(O=N,E=I)}}const $=new Uint32Array(S.buffer),H=new Int16Array(f*p*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(d=0;d<V.length;d++)V[d]=255*((V[d]+.5)/16-.5);for(let O=0;O<p;O++)for(let Y=0;Y<f;Y++){var L;d=4*(O*f+Y),b!=2?L=[t(u[d]+H[d]),t(u[d+1]+H[d+1]),t(u[d+2]+H[d+2]),t(u[d+3]+H[d+3])]:(N=V[4*(3&O)+(3&Y)],L=[t(u[d]+N),t(u[d+1]+N),t(u[d+2]+N),t(u[d+3]+N)]),E=0;let ne=16777215;for(I=0;I<F;I++){const ae=a(L,h[I]);ae<ne&&(ne=ae,E=I)}const K=h[E],J=[L[0]-K[0],L[1]-K[1],L[2]-K[2],L[3]-K[3]];b==1&&(Y!=f-1&&e(J,H,d+4,7),O!=p-1&&(Y!=0&&e(J,H,d+4*f-4,3),e(J,H,d+4*f,5),Y!=f-1&&e(J,H,d+4*f+4,1))),C[d>>2]=E,$[d>>2]=j[E]}}function x(u,f,p,j,S){S==null&&(S={});const{crc:C}=o,b=T.writeUint,F=T.writeUshort,h=T.writeASCII;let d=8;const E=u.frames.length>1;let I,N=!1,$=33+(E?20:0);if(S.sRGB!=null&&($+=13),S.pHYs!=null&&($+=21),S.iCCP!=null&&(I=pako.deflate(S.iCCP),$+=21+I.length+4),u.ctype==3){for(var H=u.plte.length,V=0;V<H;V++)u.plte[V]>>>24!=255&&(N=!0);$+=8+3*H+4+(N?8+1*H+4:0)}for(var L=0;L<u.frames.length;L++)E&&($+=38),$+=(K=u.frames[L]).cimg.length+12,L!=0&&($+=4);$+=12;const O=new Uint8Array($),Y=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)O[V]=Y[V];if(b(O,d,13),d+=4,h(O,d,"IHDR"),d+=4,b(O,d,f),d+=4,b(O,d,p),d+=4,O[d]=u.depth,d++,O[d]=u.ctype,d++,O[d]=0,d++,O[d]=0,d++,O[d]=0,d++,b(O,d,C(O,d-17,17)),d+=4,S.sRGB!=null&&(b(O,d,1),d+=4,h(O,d,"sRGB"),d+=4,O[d]=S.sRGB,d++,b(O,d,C(O,d-5,5)),d+=4),S.iCCP!=null){const J=13+I.length;b(O,d,J),d+=4,h(O,d,"iCCP"),d+=4,h(O,d,"ICC profile"),d+=11,d+=2,O.set(I,d),d+=I.length,b(O,d,C(O,d-(J+4),J+4)),d+=4}if(S.pHYs!=null&&(b(O,d,9),d+=4,h(O,d,"pHYs"),d+=4,b(O,d,S.pHYs[0]),d+=4,b(O,d,S.pHYs[1]),d+=4,O[d]=S.pHYs[2],d++,b(O,d,C(O,d-13,13)),d+=4),E&&(b(O,d,8),d+=4,h(O,d,"acTL"),d+=4,b(O,d,u.frames.length),d+=4,b(O,d,S.loop!=null?S.loop:0),d+=4,b(O,d,C(O,d-12,12)),d+=4),u.ctype==3){for(b(O,d,3*(H=u.plte.length)),d+=4,h(O,d,"PLTE"),d+=4,V=0;V<H;V++){const J=3*V,ae=u.plte[V],se=255&ae,fe=ae>>>8&255,Ne=ae>>>16&255;O[d+J+0]=se,O[d+J+1]=fe,O[d+J+2]=Ne}if(d+=3*H,b(O,d,C(O,d-3*H-4,3*H+4)),d+=4,N){for(b(O,d,H),d+=4,h(O,d,"tRNS"),d+=4,V=0;V<H;V++)O[d+V]=u.plte[V]>>>24&255;d+=H,b(O,d,C(O,d-H-4,H+4)),d+=4}}let ne=0;for(L=0;L<u.frames.length;L++){var K=u.frames[L];E&&(b(O,d,26),d+=4,h(O,d,"fcTL"),d+=4,b(O,d,ne++),d+=4,b(O,d,K.rect.width),d+=4,b(O,d,K.rect.height),d+=4,b(O,d,K.rect.x),d+=4,b(O,d,K.rect.y),d+=4,F(O,d,j[L]),d+=2,F(O,d,1e3),d+=2,O[d]=K.dispose,d++,O[d]=K.blend,d++,b(O,d,C(O,d-30,30)),d+=4);const J=K.cimg;b(O,d,(H=J.length)+(L==0?0:4)),d+=4;const ae=d;h(O,d,L==0?"IDAT":"fdAT"),d+=4,L!=0&&(b(O,d,ne++),d+=4),O.set(J,d),d+=H,b(O,d,C(O,ae,d-ae)),d+=4}return b(O,d,0),d+=4,h(O,d,"IEND"),d+=4,b(O,d,C(O,d-4,4)),d+=4,O.buffer}function v(u,f,p){for(let j=0;j<u.frames.length;j++){const S=u.frames[j];S.rect.width;const C=S.rect.height,b=new Uint8Array(C*S.bpl+C);S.cimg=c(S.img,C,S.bpp,S.bpl,b,f,p)}}function n(u,f,p,j,S){const C=S[0],b=S[1],F=S[2],h=S[3],d=S[4],E=S[5];let I=6,N=8,$=255;for(var H=0;H<u.length;H++){const xe=new Uint8Array(u[H]);for(var V=xe.length,L=0;L<V;L+=4)$&=xe[L+3]}const O=$!=255,Y=function(ge,le,pe,ye,me,Ue){const de=[];for(var ue=0;ue<ge.length;ue++){const Ae=new Uint8Array(ge[ue]),ie=new Uint32Array(Ae.buffer);var je;let Re=0,oe=0,De=le,Se=pe,Tt=ye?1:0;if(ue!=0){const nn=Ue||ye||ue==1||de[ue-2].dispose!=0?1:2;let Ft=0,Ht=1e9;for(let at=0;at<nn;at++){var Le=new Uint8Array(ge[ue-1-at]);const rn=new Uint32Array(ge[ue-1-at]);let We=le,Pe=pe,ze=-1,lt=-1;for(let Ze=0;Ze<pe;Ze++)for(let $e=0;$e<le;$e++)ie[we=Ze*le+$e]!=rn[we]&&($e<We&&(We=$e),$e>ze&&(ze=$e),Ze<Pe&&(Pe=Ze),Ze>lt&&(lt=Ze));ze==-1&&(We=Pe=ze=lt=0),me&&((1&We)==1&&We--,(1&Pe)==1&&Pe--);const Lt=(ze-We+1)*(lt-Pe+1);Lt<Ht&&(Ht=Lt,Ft=at,Re=We,oe=Pe,De=ze-We+1,Se=lt-Pe+1)}Le=new Uint8Array(ge[ue-1-Ft]),Ft==1&&(de[ue-1].dispose=2),je=new Uint8Array(De*Se*4),g(Le,le,pe,je,De,Se,-Re,-oe,0),Tt=g(Ae,le,pe,je,De,Se,-Re,-oe,3)?1:0,Tt==1?r(Ae,le,pe,je,{x:Re,y:oe,width:De,height:Se}):g(Ae,le,pe,je,De,Se,-Re,-oe,0)}else je=Ae.slice(0);de.push({rect:{x:Re,y:oe,width:De,height:Se},img:je,blend:Tt,dispose:0})}if(ye)for(ue=0;ue<de.length;ue++){if((ce=de[ue]).blend==1)continue;const Ae=ce.rect,ie=de[ue-1].rect,Re=Math.min(Ae.x,ie.x),oe=Math.min(Ae.y,ie.y),De={x:Re,y:oe,width:Math.max(Ae.x+Ae.width,ie.x+ie.width)-Re,height:Math.max(Ae.y+Ae.height,ie.y+ie.height)-oe};de[ue-1].dispose=1,ue-1!=0&&s(ge,le,pe,de,ue-1,De,me),s(ge,le,pe,de,ue,De,me)}let et=0;if(ge.length!=1)for(var we=0;we<de.length;we++){var ce;et+=(ce=de[we]).rect.width*ce.rect.height}return de}(u,f,p,C,b,F),ne={},K=[],J=[];if(j!=0){const xe=[];for(L=0;L<Y.length;L++)xe.push(Y[L].img.buffer);const ge=function(me){let Ue=0;for(var de=0;de<me.length;de++)Ue+=me[de].byteLength;const ue=new Uint8Array(Ue);let je=0;for(de=0;de<me.length;de++){const Le=new Uint8Array(me[de]),et=Le.length;for(let we=0;we<et;we+=4){let ce=Le[we],Ae=Le[we+1],ie=Le[we+2];const Re=Le[we+3];Re==0&&(ce=Ae=ie=0),ue[je+we]=ce,ue[je+we+1]=Ae,ue[je+we+2]=ie,ue[je+we+3]=Re}je+=et}return ue.buffer}(xe),le=A(ge,j);for(L=0;L<le.plte.length;L++)K.push(le.plte[L].est.rgba);let pe=0;for(L=0;L<Y.length;L++){const ye=(se=Y[L]).img.length;var ae=new Uint8Array(le.inds.buffer,pe>>2,ye>>2);J.push(ae);const me=new Uint8Array(le.abuf,pe,ye);E&&l(se.img,se.rect.width,se.rect.height,K,me,ae),se.img.set(me),pe+=ye}}else for(H=0;H<Y.length;H++){var se=Y[H];const xe=new Uint32Array(se.img.buffer);var fe=se.rect.width;for(V=xe.length,ae=new Uint8Array(V),J.push(ae),L=0;L<V;L++){const ge=xe[L];if(L!=0&&ge==xe[L-1])ae[L]=ae[L-1];else if(L>fe&&ge==xe[L-fe])ae[L]=ae[L-fe];else{let le=ne[ge];if(le==null&&(ne[ge]=le=K.length,K.push(ge),K.length>=300))break;ae[L]=le}}}const Ne=K.length;for(Ne<=256&&d==0&&(N=Ne<=2?1:Ne<=4?2:Ne<=16?4:8,N=Math.max(N,h)),H=0;H<Y.length;H++){(se=Y[H]).rect.x,se.rect.y,fe=se.rect.width;const xe=se.rect.height;let ge=se.img;new Uint32Array(ge.buffer);let le=4*fe,pe=4;if(Ne<=256&&d==0){le=Math.ceil(N*fe/8);var ke=new Uint8Array(le*xe);const ye=J[H];for(let me=0;me<xe;me++){L=me*le;const Ue=me*fe;if(N==8)for(var he=0;he<fe;he++)ke[L+he]=ye[Ue+he];else if(N==4)for(he=0;he<fe;he++)ke[L+(he>>1)]|=ye[Ue+he]<<4-4*(1&he);else if(N==2)for(he=0;he<fe;he++)ke[L+(he>>2)]|=ye[Ue+he]<<6-2*(3&he);else if(N==1)for(he=0;he<fe;he++)ke[L+(he>>3)]|=ye[Ue+he]<<7-1*(7&he)}ge=ke,I=3,pe=1}else if(O==0&&Y.length==1){ke=new Uint8Array(fe*xe*3);const ye=fe*xe;for(L=0;L<ye;L++){const me=3*L,Ue=4*L;ke[me]=ge[Ue],ke[me+1]=ge[Ue+1],ke[me+2]=ge[Ue+2]}ge=ke,I=2,pe=3,le=3*fe}se.img=ge,se.bpl=le,se.bpp=pe}return{ctype:I,depth:N,plte:K,frames:Y}}function s(u,f,p,j,S,C,b){const F=Uint8Array,h=Uint32Array,d=new F(u[S-1]),E=new h(u[S-1]),I=S+1<u.length?new F(u[S+1]):null,N=new F(u[S]),$=new h(N.buffer);let H=f,V=p,L=-1,O=-1;for(let ne=0;ne<C.height;ne++)for(let K=0;K<C.width;K++){const J=C.x+K,ae=C.y+ne,se=ae*f+J,fe=$[se];fe==0||j[S-1].dispose==0&&E[se]==fe&&(I==null||I[4*se+3]!=0)||(J<H&&(H=J),J>L&&(L=J),ae<V&&(V=ae),ae>O&&(O=ae))}L==-1&&(H=V=L=O=0),b&&((1&H)==1&&H--,(1&V)==1&&V--),C={x:H,y:V,width:L-H+1,height:O-V+1};const Y=j[S];Y.rect=C,Y.blend=1,Y.img=new Uint8Array(C.width*C.height*4),j[S-1].dispose==0?(g(d,f,p,Y.img,C.width,C.height,-C.x,-C.y,0),r(N,f,p,Y.img,C)):g(N,f,p,Y.img,C.width,C.height,-C.x,-C.y,0)}function r(u,f,p,j,S){g(u,f,p,j,S.width,S.height,-S.x,-S.y,2)}function c(u,f,p,j,S,C,b){const F=[];let h,d=[0,1,2,3,4];C!=-1?d=[C]:(f*j>5e5||p==1)&&(d=[0]),b&&(h={level:0});const E=ls;for(var I=0;I<d.length;I++){for(let H=0;H<f;H++)m(S,u,H,j,p,d[I]);F.push(E.deflate(S,h))}let N,$=1e9;for(I=0;I<F.length;I++)F[I].length<$&&(N=I,$=F[I].length);return F[N]}function m(u,f,p,j,S,C){const b=p*j;let F=b+p;if(u[F]=C,F++,C==0)if(j<500)for(var h=0;h<j;h++)u[F+h]=f[b+h];else u.set(new Uint8Array(f.buffer,b,j),F);else if(C==1){for(h=0;h<S;h++)u[F+h]=f[b+h];for(h=S;h<j;h++)u[F+h]=f[b+h]-f[b+h-S]+256&255}else if(p==0){for(h=0;h<S;h++)u[F+h]=f[b+h];if(C==2)for(h=S;h<j;h++)u[F+h]=f[b+h];if(C==3)for(h=S;h<j;h++)u[F+h]=f[b+h]-(f[b+h-S]>>1)+256&255;if(C==4)for(h=S;h<j;h++)u[F+h]=f[b+h]-D(f[b+h-S],0,0)+256&255}else{if(C==2)for(h=0;h<j;h++)u[F+h]=f[b+h]+256-f[b+h-j]&255;if(C==3){for(h=0;h<S;h++)u[F+h]=f[b+h]+256-(f[b+h-j]>>1)&255;for(h=S;h<j;h++)u[F+h]=f[b+h]+256-(f[b+h-j]+f[b+h-S]>>1)&255}if(C==4){for(h=0;h<S;h++)u[F+h]=f[b+h]+256-D(0,f[b+h-j],0)&255;for(h=S;h<j;h++)u[F+h]=f[b+h]+256-D(f[b+h-S],f[b+h-j],f[b+h-S-j])&255}}}function A(u,f){const p=new Uint8Array(u),j=p.slice(0),S=new Uint32Array(j.buffer),C=U(j,f),b=C[0],F=C[1],h=p.length,d=new Uint8Array(h>>2);let E;if(p.length<2e7)for(var I=0;I<h;I+=4)E=w(b,N=p[I]*(1/255),$=p[I+1]*(1/255),H=p[I+2]*(1/255),V=p[I+3]*(1/255)),d[I>>2]=E.ind,S[I>>2]=E.est.rgba;else for(I=0;I<h;I+=4){var N=p[I]*.00392156862745098,$=p[I+1]*(1/255),H=p[I+2]*(1/255),V=p[I+3]*(1/255);for(E=b;E.left;)E=B(E.est,N,$,H,V)<=0?E.left:E.right;d[I>>2]=E.ind,S[I>>2]=E.est.rgba}return{abuf:j.buffer,inds:d,plte:F}}function U(u,f,p){p==null&&(p=1e-4);const j=new Uint32Array(u.buffer),S={i0:0,i1:u.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=P(u,S.i0,S.i1),S.est=y(S.bst);const C=[S];for(;C.length<f;){let F=0,h=0;for(var b=0;b<C.length;b++)C[b].est.L>F&&(F=C[b].est.L,h=b);if(F<p)break;const d=C[h],E=M(u,j,d.i0,d.i1,d.est.e,d.est.eMq255);if(d.i0>=E||d.i1<=E){d.est.L=0;continue}const I={i0:d.i0,i1:E,bst:null,est:null,tdst:0,left:null,right:null};I.bst=P(u,I.i0,I.i1),I.est=y(I.bst);const N={i0:E,i1:d.i1,bst:null,est:null,tdst:0,left:null,right:null};for(N.bst={R:[],m:[],N:d.bst.N-I.bst.N},b=0;b<16;b++)N.bst.R[b]=d.bst.R[b]-I.bst.R[b];for(b=0;b<4;b++)N.bst.m[b]=d.bst.m[b]-I.bst.m[b];N.est=y(N.bst),d.left=I,d.right=N,C[h]=I,C.push(N)}for(C.sort((F,h)=>h.bst.N-F.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[S,C]}function w(u,f,p,j,S){if(u.left==null)return u.tdst=function(I,N,$,H,V){const L=N-I[0],O=$-I[1],Y=H-I[2],ne=V-I[3];return L*L+O*O+Y*Y+ne*ne}(u.est.q,f,p,j,S),u;const C=B(u.est,f,p,j,S);let b=u.left,F=u.right;C>0&&(b=u.right,F=u.left);const h=w(b,f,p,j,S);if(h.tdst<=C*C)return h;const d=w(F,f,p,j,S);return d.tdst<h.tdst?d:h}function B(u,f,p,j,S){const{e:C}=u;return C[0]*f+C[1]*p+C[2]*j+C[3]*S-u.eMq}function M(u,f,p,j,S,C){for(j-=4;p<j;){for(;_(u,p,S)<=C;)p+=4;for(;_(u,j,S)>C;)j-=4;if(p>=j)break;const b=f[p>>2];f[p>>2]=f[j>>2],f[j>>2]=b,p+=4,j-=4}for(;_(u,p,S)>C;)p-=4;return p+4}function _(u,f,p){return u[f]*p[0]+u[f+1]*p[1]+u[f+2]*p[2]+u[f+3]*p[3]}function P(u,f,p){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],C=p-f>>2;for(let b=f;b<p;b+=4){const F=u[b]*.00392156862745098,h=u[b+1]*(1/255),d=u[b+2]*(1/255),E=u[b+3]*(1/255);S[0]+=F,S[1]+=h,S[2]+=d,S[3]+=E,j[0]+=F*F,j[1]+=F*h,j[2]+=F*d,j[3]+=F*E,j[5]+=h*h,j[6]+=h*d,j[7]+=h*E,j[10]+=d*d,j[11]+=d*E,j[15]+=E*E}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:S,N:C}}function y(u){const{R:f}=u,{m:p}=u,{N:j}=u,S=p[0],C=p[1],b=p[2],F=p[3],h=j==0?0:1/j,d=[f[0]-S*S*h,f[1]-S*C*h,f[2]-S*b*h,f[3]-S*F*h,f[4]-C*S*h,f[5]-C*C*h,f[6]-C*b*h,f[7]-C*F*h,f[8]-b*S*h,f[9]-b*C*h,f[10]-b*b*h,f[11]-b*F*h,f[12]-F*S*h,f[13]-F*C*h,f[14]-F*b*h,f[15]-F*F*h],E=d,I=R;let N=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,H=0;if(j!=0)for(let L=0;L<16&&(N=I.multVec(E,N),H=Math.sqrt(I.dot(N,N)),N=I.sml(1/H,N),!(L!=0&&Math.abs(H-$)<1e-9));L++)$=H;const V=[S*h,C*h,b*h,F*h];return{Cov:d,q:V,e:N,L:$,eMq255:I.dot(I.sml(255,V),N),eMq:I.dot(N,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var R={multVec:(u,f)=>[u[0]*f[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3],u[4]*f[0]+u[5]*f[1]+u[6]*f[2]+u[7]*f[3],u[8]*f[0]+u[9]*f[1]+u[10]*f[2]+u[11]*f[3],u[12]*f[0]+u[13]*f[1]+u[14]*f[2]+u[15]*f[3]],dot:(u,f)=>u[0]*f[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3],sml:(u,f)=>[u*f[0],u*f[1],u*f[2],u*f[3]]};qe.encode=function(f,p,j,S,C,b,F){S==null&&(S=0),F==null&&(F=!1);const h=n(f,p,j,S,[!1,!1,!1,0,F,!1]);return v(h,-1),x(h,p,j,C,b)},qe.encodeLL=function(f,p,j,S,C,b,F,h){const d={ctype:0+(S==1?0:2)+(C==0?0:4),depth:b,frames:[]},E=(S+C)*b,I=E*p;for(let N=0;N<f.length;N++)d.frames.push({rect:{x:0,y:0,width:p,height:j},img:new Uint8Array(f[N]),blend:0,dispose:1,bpp:Math.ceil(E/8),bpl:Math.ceil(I/8)});return v(d,0,!0),x(d,p,j,F,h)},qe.encode.compress=n,qe.encode.dither=l,qe.quantize=A,qe.quantize.getKDtree=U,qe.quantize.getNearest=w})();const xr={toArrayBuffer(g,T){const D=g.width,o=g.height,e=D<<2,t=g.getContext("2d").getImageData(0,0,D,o),a=new Uint32Array(t.data.buffer),l=(32*D+31)/32<<2,x=l*o,v=122+x,n=new ArrayBuffer(v),s=new DataView(n),r=1<<20;let c,m,A,U,w=r,B=0,M=0,_=0;function P(u){s.setUint16(M,u,!0),M+=2}function y(u){s.setUint32(M,u,!0),M+=4}function R(u){M+=u}P(19778),y(v),R(4),y(122),y(108),y(D),y(-o>>>0),P(1),P(32),y(3),y(x),y(2835),y(2835),R(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),function u(){for(;B<o&&w>0;){for(U=122+B*l,c=0;c<e;)w--,m=a[_++],A=m>>>24,s.setUint32(U+c,m<<8|A),c+=4;B++}_<a.length?(w=r,setTimeout(u,xr._dly)):T(n)}()},toBlob(g,T){this.toArrayBuffer(g,D=>{T(new Blob([D],{type:"image/bmp"}))})},_dly:9};var Me={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},ds={[Me.CHROME]:16384,[Me.FIREFOX]:11180,[Me.DESKTOP_SAFARI]:16384,[Me.IE]:8192,[Me.IOS]:4096,[Me.ETC]:8192};const _n=typeof window<"u",vr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Xt=_n&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),cs=(_n||vr)&&(Xt&&Xt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),yr=(_n||vr)&&(Xt&&Xt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Rn(g,T,D=Date.now()){return new Promise(o=>{const e=g.split(","),t=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let l=a.length;const x=new Uint8Array(l);for(;l--;)x[l]=a.charCodeAt(l);const v=new Blob([x],{type:t});v.name=T,v.lastModified=D,o(v)})}function jr(g){return new Promise((T,D)=>{const o=new yr;o.onload=()=>T(o.result),o.onerror=e=>D(e),o.readAsDataURL(g)})}function wr(g){return new Promise((T,D)=>{const o=new Image;o.onload=()=>T(o),o.onerror=e=>D(e),o.src=g})}function dt(){if(dt.cachedResult!==void 0)return dt.cachedResult;let g=Me.ETC;const{userAgent:T}=navigator;return/Chrom(e|ium)/i.test(T)?g=Me.CHROME:/iP(ad|od|hone)/i.test(T)&&/WebKit/i.test(T)?g=Me.IOS:/Safari/i.test(T)?g=Me.DESKTOP_SAFARI:/Firefox/i.test(T)?g=Me.FIREFOX:(/MSIE/i.test(T)||document.documentMode)&&(g=Me.IE),dt.cachedResult=g,dt.cachedResult}function Sr(g,T){const D=dt(),o=ds[D];let e=g,t=T,a=e*t;const l=e>t?t/e:e/t;for(;a>o*o;){const x=(o+e)/2,v=(o+t)/2;x<v?(t=v,e=v*l):(t=x*l,e=x),a=e*t}return{width:e,height:t}}function tn(g,T){let D,o;try{if(D=new OffscreenCanvas(g,T),o=D.getContext("2d"),o===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{D=document.createElement("canvas"),o=D.getContext("2d")}return D.width=g,D.height=T,[D,o]}function Cr(g,T){const{width:D,height:o}=Sr(g.width,g.height),[e,t]=tn(D,o);return T&&/jpe?g/.test(T)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(g,0,0,e.width,e.height),e}function Vt(){return Vt.cachedResult!==void 0||(Vt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Vt.cachedResult}function Jt(g,T={}){return new Promise(function(D,o){let e,t;var a=function(){try{return t=Cr(e,T.fileType||g.type),D([e,t])}catch(x){return o(x)}},l=function(x){try{var v=function(n){try{throw n}catch(s){return o(s)}};try{let n;return jr(g).then(function(s){try{return n=s,wr(n).then(function(r){try{return e=r,function(){try{return a()}catch(c){return o(c)}}()}catch(c){return v(c)}},v)}catch(r){return v(r)}},v)}catch(n){v(n)}}catch(n){return o(n)}};try{if(Vt()||[Me.DESKTOP_SAFARI,Me.MOBILE_SAFARI].includes(dt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(g).then(function(x){try{return e=x,a()}catch{return l()}},l)}catch{l()}})}function en(g,T,D,o,e=1){return new Promise(function(t,a){let l;if(T==="image/png"){let v,n,s;return v=g.getContext("2d"),{data:n}=v.getImageData(0,0,g.width,g.height),s=qe.encode([n.buffer],g.width,g.height,4096*e),l=new Blob([s],{type:T}),l.name=D,l.lastModified=o,x.call(this)}{let v=function(){return x.call(this)};if(T==="image/bmp")return new Promise(n=>xr.toBlob(g,n)).then((function(n){try{return l=n,l.name=D,l.lastModified=o,v.call(this)}catch(s){return a(s)}}).bind(this),a);{let n=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&g instanceof OffscreenCanvas)return g.convertToBlob({type:T,quality:e}).then((function(s){try{return l=s,l.name=D,l.lastModified=o,n.call(this)}catch(r){return a(r)}}).bind(this),a);{let s;return s=g.toDataURL(T,e),Rn(s,D,o).then((function(r){try{return l=r,n.call(this)}catch(c){return a(c)}}).bind(this),a)}}}function x(){return t(l)}})}function Ve(g){g.width=0,g.height=0}function xt(){return new Promise(function(g,T){let D,o,e,t;return xt.cachedResult!==void 0?g(xt.cachedResult):Rn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return D=a,Jt(D).then(function(l){try{return o=l[1],en(o,D.type,D.name,D.lastModified).then(function(x){try{return e=x,Ve(o),Jt(e).then(function(v){try{return t=v[0],xt.cachedResult=t.width===1&&t.height===2,g(xt.cachedResult)}catch(n){return T(n)}},T)}catch(v){return T(v)}},T)}catch(x){return T(x)}},T)}catch(l){return T(l)}},T)})}function Ar(g){return new Promise((T,D)=>{const o=new yr;o.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return T(-2);const a=t.byteLength;let l=2;for(;l<a;){if(t.getUint16(l+2,!1)<=8)return T(-1);const x=t.getUint16(l,!1);if(l+=2,x==65505){if(t.getUint32(l+=2,!1)!=1165519206)return T(-1);const v=t.getUint16(l+=6,!1)==18761;l+=t.getUint32(l+4,v);const n=t.getUint16(l,v);l+=2;for(let s=0;s<n;s++)if(t.getUint16(l+12*s,v)==274)return T(t.getUint16(l+12*s+8,v))}else{if((65280&x)!=65280)break;l+=t.getUint16(l,!1)}}return T(-1)},o.onerror=e=>D(e),o.readAsArrayBuffer(g)})}function Tr(g,T){const{width:D}=g,{height:o}=g,{maxWidthOrHeight:e}=T;let t,a=g;return isFinite(e)&&(D>e||o>e)&&([a,t]=tn(D,o),D>o?(a.width=e,a.height=o/D*e):(a.width=D/o*e,a.height=e),t.drawImage(g,0,0,a.width,a.height),Ve(g)),a}function Fr(g,T){const{width:D}=g,{height:o}=g,[e,t]=tn(D,o);switch(T>4&&T<9?(e.width=o,e.height=D):(e.width=D,e.height=o),T){case 2:t.transform(-1,0,0,1,D,0);break;case 3:t.transform(-1,0,0,-1,D,o);break;case 4:t.transform(1,0,0,-1,0,o);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,o,0);break;case 7:t.transform(0,-1,-1,0,o,D);break;case 8:t.transform(0,-1,1,0,0,D)}return t.drawImage(g,0,0,D,o),Ve(g),e}function zn(g,T,D=0){return new Promise(function(o,e){let t,a,l,x,v,n,s,r,c,m,A,U,w,B,M,_,P,y,R,u;function f(j=5){if(T.signal&&T.signal.aborted)throw T.signal.reason;t+=j,T.onProgress(Math.min(t,100))}function p(j){if(T.signal&&T.signal.aborted)throw T.signal.reason;t=Math.min(Math.max(j,t),100),T.onProgress(t)}return t=D,a=T.maxIteration||10,l=1024*T.maxSizeMB*1024,f(),Jt(g,T).then((function(j){try{return[,x]=j,f(),v=Tr(x,T),f(),new Promise(function(S,C){var b;if(!(b=T.exifOrientation))return Ar(g).then((function(h){try{return b=h,F.call(this)}catch(d){return C(d)}}).bind(this),C);function F(){return S(b)}return F.call(this)}).then((function(S){try{return n=S,f(),xt().then((function(C){try{return s=C?v:Fr(v,n),f(),r=T.initialQuality||1,c=T.fileType||g.type,en(s,c,g.name,g.lastModified,r).then((function(b){try{{let h=function(){if(a--&&(M>l||M>w)){let E,I;return E=u?.95*R.width:R.width,I=u?.95*R.height:R.height,[P,y]=tn(E,I),y.drawImage(R,0,0,E,I),r*=c==="image/png"?.85:.95,en(P,c,g.name,g.lastModified,r).then(function(N){try{return _=N,Ve(R),R=P,M=_.size,p(Math.min(99,Math.floor((B-M)/(B-l)*100))),h}catch($){return e($)}},e)}return[1]},d=function(){return Ve(R),Ve(P),Ve(v),Ve(s),Ve(x),p(100),o(_)};if(m=b,f(),A=m.size>l,U=m.size>g.size,!A&&!U)return p(100),o(m);var F;return w=g.size,B=m.size,M=B,R=s,u=!T.alwaysKeepResolution&&A,(F=(function(E){for(;E;){if(E.then)return void E.then(F,e);try{if(E.pop){if(E.length)return E.pop()?d.call(this):E;E=h}else E=E.call(this)}catch(I){return e(I)}}}).bind(this))(h)}}catch(h){return e(h)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)})}const us=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let fn;function fs(g,T){return new Promise((D,o)=>{fn||(fn=function(a){const l=[];return l.push(a),URL.createObjectURL(new Blob(l))}(us));const e=new Worker(fn);e.addEventListener("message",function(a){if(T.signal&&T.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return o(new Error(a.data.error)),void e.terminate();D(a.data.file),e.terminate()}else T.onProgress(a.data.progress)}),e.addEventListener("error",o),T.signal&&T.signal.addEventListener("abort",()=>{o(T.signal.reason),e.terminate()}),e.postMessage({file:g,imageCompressionLibUrl:T.libURL,options:{...T,onProgress:void 0,signal:void 0}})})}function Ie(g,T){return new Promise(function(D,o){let e,t,a,l,x,v;if(e={...T},a=0,{onProgress:l}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{a=c,typeof l=="function"&&l(a)},!(g instanceof Blob||g instanceof cs))return o(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(g.type))return o(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||v)return zn(g,e).then((function(c){try{return t=c,r.call(this)}catch(m){return o(m)}}).bind(this),o);var n=(function(){try{return r.call(this)}catch(c){return o(c)}}).bind(this),s=function(c){try{return zn(g,e).then(function(m){try{return t=m,n()}catch(A){return o(A)}},o)}catch(m){return o(m)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",fs(g,e).then(function(c){try{return t=c,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=g.name,t.lastModified=g.lastModified}catch{}try{e.preserveExif&&g.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===g.type)&&(t=br(g,t))}catch{}return D(t)}})}Ie.getDataUrlFromFile=jr,Ie.getFilefromDataUrl=Rn,Ie.loadImage=wr,Ie.drawImageInCanvas=Cr,Ie.drawFileInCanvas=Jt,Ie.canvasToFile=en,Ie.getExifOrientation=Ar,Ie.handleMaxWidthOrHeight=Tr,Ie.followExifOrientation=Fr,Ie.cleanupCanvasMemory=Ve,Ie.isAutoOrientationInBrowser=xt,Ie.approximateBelowMaximumCanvasSizeOfBrowser=Sr,Ie.copyExifWithoutOrientation=br,Ie.getBrowserName=dt,Ie.version="2.0.2";var hn,qn;function Ir(){if(qn)return hn;qn=1;function g(T){var D=typeof T;return T!=null&&(D=="object"||D=="function")}return hn=g,hn}var gn,Hn;function hs(){if(Hn)return gn;Hn=1;var g=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return gn=g,gn}var mn,Ln;function kr(){if(Ln)return mn;Ln=1;var g=hs(),T=typeof self=="object"&&self&&self.Object===Object&&self,D=g||T||Function("return this")();return mn=D,mn}var pn,Wn;function gs(){if(Wn)return pn;Wn=1;var g=kr(),T=function(){return g.Date.now()};return pn=T,pn}var bn,$n;function ms(){if($n)return bn;$n=1;var g=/\s/;function T(D){for(var o=D.length;o--&&g.test(D.charAt(o)););return o}return bn=T,bn}var xn,Vn;function ps(){if(Vn)return xn;Vn=1;var g=ms(),T=/^\s+/;function D(o){return o&&o.slice(0,g(o)+1).replace(T,"")}return xn=D,xn}var vn,Qn;function Ur(){if(Qn)return vn;Qn=1;var g=kr(),T=g.Symbol;return vn=T,vn}var yn,Gn;function bs(){if(Gn)return yn;Gn=1;var g=Ur(),T=Object.prototype,D=T.hasOwnProperty,o=T.toString,e=g?g.toStringTag:void 0;function t(a){var l=D.call(a,e),x=a[e];try{a[e]=void 0;var v=!0}catch{}var n=o.call(a);return v&&(l?a[e]=x:delete a[e]),n}return yn=t,yn}var jn,Zn;function xs(){if(Zn)return jn;Zn=1;var g=Object.prototype,T=g.toString;function D(o){return T.call(o)}return jn=D,jn}var wn,Yn;function vs(){if(Yn)return wn;Yn=1;var g=Ur(),T=bs(),D=xs(),o="[object Null]",e="[object Undefined]",t=g?g.toStringTag:void 0;function a(l){return l==null?l===void 0?e:o:t&&t in Object(l)?T(l):D(l)}return wn=a,wn}var Sn,Kn;function ys(){if(Kn)return Sn;Kn=1;function g(T){return T!=null&&typeof T=="object"}return Sn=g,Sn}var Cn,Xn;function js(){if(Xn)return Cn;Xn=1;var g=vs(),T=ys(),D="[object Symbol]";function o(e){return typeof e=="symbol"||T(e)&&g(e)==D}return Cn=o,Cn}var An,Jn;function ws(){if(Jn)return An;Jn=1;var g=ps(),T=Ir(),D=js(),o=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;function x(v){if(typeof v=="number")return v;if(D(v))return o;if(T(v)){var n=typeof v.valueOf=="function"?v.valueOf():v;v=T(n)?n+"":n}if(typeof v!="string")return v===0?v:+v;v=g(v);var s=t.test(v);return s||a.test(v)?l(v.slice(2),s?2:8):e.test(v)?o:+v}return An=x,An}var Tn,er;function Ss(){if(er)return Tn;er=1;var g=Ir(),T=gs(),D=ws(),o="Expected a function",e=Math.max,t=Math.min;function a(l,x,v){var n,s,r,c,m,A,U=0,w=!1,B=!1,M=!0;if(typeof l!="function")throw new TypeError(o);x=D(x)||0,g(v)&&(w=!!v.leading,B="maxWait"in v,r=B?e(D(v.maxWait)||0,x):r,M="trailing"in v?!!v.trailing:M);function _(C){var b=n,F=s;return n=s=void 0,U=C,c=l.apply(F,b),c}function P(C){return U=C,m=setTimeout(u,x),w?_(C):c}function y(C){var b=C-A,F=C-U,h=x-b;return B?t(h,r-F):h}function R(C){var b=C-A,F=C-U;return A===void 0||b>=x||b<0||B&&F>=r}function u(){var C=T();if(R(C))return f(C);m=setTimeout(u,y(C))}function f(C){return m=void 0,M&&n?_(C):(n=s=void 0,c)}function p(){m!==void 0&&clearTimeout(m),U=0,n=A=s=m=void 0}function j(){return m===void 0?c:f(T())}function S(){var C=T(),b=R(C);if(n=arguments,s=this,A=C,b){if(m===void 0)return P(A);if(B)return clearTimeout(m),m=setTimeout(u,x),_(A)}return m===void 0&&(m=setTimeout(u,x)),c}return S.cancel=p,S.flush=j,S}return Tn=a,Tn}var Cs=Ss();const As=Je(Cs);var kt={},tr;function Ts(){if(tr)return kt;tr=1;var g=st();Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var T=g(ot()),D=it();return kt.default=(0,T.default)([(0,D.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,D.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),kt}var Fs=Ts();const Is=Je(Fs);var Ut={},nr;function ks(){if(nr)return Ut;nr=1;var g=st();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var T=g(ot()),D=it();return Ut.default=(0,T.default)((0,D.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),Ut}var Us=ks();const Ds=Je(Us);var Dt={},rr;function _s(){if(rr)return Dt;rr=1;var g=st();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var T=g(ot()),D=it();return Dt.default=(0,T.default)((0,D.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Dt}var Rs=_s();const Es=Je(Rs);var _t={},sr;function Ms(){if(sr)return _t;sr=1;var g=st();Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var T=g(ot()),D=it();return _t.default=(0,T.default)([(0,D.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,D.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),_t}var Os=Ms();const Ns=Je(Os),ct=q.forwardRef(({path:g,initialImages:T=[],onImagesUpdated:D,onDelete:o,isOwnDesign:e},t)=>{const[a,l]=q.useState(T.map(d=>({...d,deleted:!1}))),[x,v]=q.useState(!1),[n,s]=q.useState(0),[r,c]=q.useState(!1),[m,A]=q.useState(null),[U,w]=q.useState(1),[B,M]=q.useState(!1),[_,P]=q.useState(!1),[y,R]=q.useState(""),[u,f]=q.useState("info"),p=q.useRef(null);q.useEffect(()=>{console.log("Initial images received:",T),l(T.map(d=>({...d,deleted:!!d.deleted})))},[T]);const j=async d=>{const E=Array.from(d.target.files||[]);v(!0);const I={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},N=E.map(async($,H)=>{let V=$;$.size>1024*1024&&(V=await Ie($,I),R("Your image was compressed before uploading due to file size larger than 1 MB."),f("info"),P(!0));const O=`${new Date().getTime()}-${V.name}`,Y=yt(),ne=jt(Y,`${g}/${O}`),K=hr(ne,V);return new Promise((J,ae)=>{K.on("state_changed",se=>{const fe=se.bytesTransferred/se.totalBytes*100;s(fe)},se=>{console.error("Upload failed:",se),ae(se)},()=>{gr(K.snapshot.ref).then(se=>{J({url:se,path:ne.fullPath,title:""})})})})});Promise.all(N).then($=>{const H=[...a,...$];l(H),D&&D(H),R("Images uploaded successfully."),f("success"),P(!0),v(!1),s(0),p.current&&(p.current.value="")}).catch($=>{console.error("Error uploading images: ",$),R("Failed to upload images."),f("error"),P(!0),v(!1),s(0)})},S=d=>{l(E=>{const I=E.map((N,$)=>$===d?{...N,deleted:!0}:N);return D(I),I}),R("Image marked for deletion. Update to permanently delete."),f("info"),P(!0)},C=async()=>{const d=a.filter(E=>E.deleted);if(console.log("Attempting to delete images:",d),d.length>0){const E=d.map(I=>{const N=yt(),$=jt(N,I.path);return $t($)});try{await Promise.all(E),o(d),l(I=>I.filter(N=>!N.deleted)),R("Deleted images have been permanently removed."),f("success")}catch(I){console.error("Error committing deletions:",I),R("Failed to commit deletions."),f("error")}P(!0)}else console.log("No images marked for deletion.")},b=d=>{M(!B),A(d)};q.useEffect(()=>{const d=()=>{const E=!!document.fullscreenElement;M(E)};return document.addEventListener("fullscreenchange",d),()=>document.removeEventListener("fullscreenchange",d)},[]);const F=(d,E)=>{E!=="clickaway"&&P(!1)},h=q.useCallback(As((d,E)=>{setTimeout(()=>{l(I=>{const N=I.map(($,H)=>H===d?{...$,title:E}:$);return D&&D(N),N})},0)},30),[D]);return q.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Qt,{title:"Upload Images",children:i.jsxs(Fe,{variant:"outlined",component:"label",startIcon:i.jsx(Ns,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:x,ref:p,accept:"image/*"})]})}),x&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),a.filter(d=>!d.deleted).map((d,E)=>i.jsxs("div",{children:[i.jsx("img",{src:d.url,alt:`Uploaded design ${E}`,onClick:()=>{c(!0),A(E)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Be,{onClick:()=>S(E),children:i.jsx(Bt,{})}),i.jsx("textarea",{value:d.title,onChange:I=>h(E,I.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},E)),i.jsx(ut,{open:r,onClose:()=>c(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:m!==null&&i.jsxs(ft,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:a[m].url,alt:`Zoomed Design ${m}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${U})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Be,{onClick:()=>w(U*1.2),children:i.jsx(Is,{})}),i.jsx(Be,{onClick:()=>w(U/1.2),style:{marginLeft:"10px"},children:i.jsx(Ds,{})}),i.jsx(Be,{onClick:()=>b(m),style:{marginLeft:"10px"},children:i.jsx(Es,{})}),B&&i.jsx(Be,{onClick:()=>b(m),style:{position:"absolute",top:20,right:20},children:i.jsx(ns,{})})]})]})}),i.jsx(ht,{open:_,autoHideDuration:6e3,onClose:F,children:i.jsx(gt,{onClose:F,severity:u,sx:{width:"100%"},children:y})})]})});ct.displayName="ImageUpload";const Qe=({onChange:g,initialValue:T})=>{const[D,o]=q.useState(un.sanitize(T||"")),e=q.useRef(!1),t=q.useRef(null),[a,l]=q.useState("");q.useEffect(()=>{e.current?o(un.sanitize(T||"")):e.current=!0},[T]);const x=(A,U,w,B)=>{const M=un.sanitize(A);o(M),g(M)},v=A=>{if(!t.current){console.warn("Editor not initialized");return}const U=t.current.getEditor(),w=U.getSelection();if(w)U.insertText(w.index,A),U.setSelection(w.index+A.length);else{const B=U.getText().length;U.insertText(B,A),U.setSelection(B+A.length)}l(""),U.focus()},n=A=>{v(A.target.value)},s=["Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼","Î½","Î¾","Î¿","Ï€","Ï","Ïƒ","Ï„","Ï…","Ï†","Ï‡","Ïˆ","Ï‰"],r=["Â°","+","-","=","~","â‰¥","â‰¤","â‰ ",">","<","*","/","%"],c={toolbar:[[{header:[1,2,3,!1]}],["bold","italic"],[{list:"ordered"},{list:"bullet"}],["blockquote",{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},m=["header","bold","italic","list","blockquote","indent","link"];return i.jsxs("div",{children:[i.jsxs(Ge,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginBottom:2},children:[i.jsx(Zr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(Pn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Gt,{labelId:"math-operators-label",id:"math-operators",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(bt,{value:"",disabled:!0,children:"Math"}),r.map(A=>i.jsx(bt,{value:A,children:A},A))]})}),i.jsx(Pn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Gt,{labelId:"greek-letters-label",id:"greek-letters",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(bt,{value:"",disabled:!0,children:"Greek"}),s.map(A=>i.jsx(bt,{value:A,children:A},A))]})})]}),i.jsx(rs,{ref:t,value:D,onChange:x,modules:c,formats:m,theme:"snow",placeholder:"Start writing...",style:{backgroundColor:"white",borderRadius:"4px",minHeight:"200px"}})]})};var Rt={},ir;function Bs(){if(ir)return Rt;ir=1;var g=st();Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default=void 0;var T=g(ot()),D=it();return Rt.default=(0,T.default)((0,D.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Rt}var Ps=Bs();const kn=Je(Ps);var Et={},or;function zs(){if(or)return Et;or=1;var g=st();Object.defineProperty(Et,"__esModule",{value:!0}),Et.default=void 0;var T=g(ot()),D=it();return Et.default=(0,T.default)((0,D.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Et}var qs=zs();const Hs=Je(qs);var Mt={},ar;function Ls(){if(ar)return Mt;ar=1;var g=st();Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var T=g(ot()),D=it();return Mt.default=(0,T.default)((0,D.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Mt}var Ws=Ls();const $s=Je(Ws),St=({path:g,initialFiles:T,onFilesChange:D,isOwnDesign:o})=>{const[e,t]=q.useState(T.map(p=>({...p,deleted:!!p.deleted}))),[a,l]=q.useState(!1),[x,v]=q.useState(0),[n,s]=q.useState({}),[r,c]=q.useState(!1),[m,A]=q.useState(""),[U,w]=q.useState("info"),B=q.useRef(null);q.useEffect(()=>{console.log("Initial files received:",T),t(T.map(p=>({...p,deleted:!!p.deleted})))},[T]),q.useEffect(()=>()=>{s({})},[]);const M=p=>{console.log("Updating files with",p),D(p),t(p)},_=async p=>{if(!p.target.files)return;const S=Array.from(p.target.files).filter(b=>b.size>5242880?(A("File size should not exceed 5 MB"),w("error"),c(!0),!1):!0);l(!0);const C=S.map(b=>{const F=new Date().getTime(),h=`${F}-${b.name}`,d=yt(),E=jt(d,`${g}/${h}`),I=hr(E,b);return new Promise((N,$)=>{I.on("state_changed",H=>{const V=H.bytesTransferred/H.totalBytes*100;v(V)},H=>{console.error("Upload failed:",H),$(H)},()=>{gr(I.snapshot.ref).then(H=>{N({id:F.toString(),url:H,name:b.name,path:E.fullPath})})})})});Promise.all(C).then(b=>{const F=[...e.filter(h=>!h.deleted),...b];M(F),A("Files uploaded successfully."),w("success"),c(!0),l(!1),v(0),B.current&&(B.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),A("Failed to upload files."),w("error"),c(!0),l(!1),v(0)})},P=p=>{const j=e.map(S=>S.id===p?{...S,deleted:!0}:S);M(j),A("File marked for deletion. Update to permanently delete."),w("info"),c(!0)},y=p=>{s(j=>{var S;return{...j,[p]:((S=e.find(C=>C.id===p))==null?void 0:S.name)||""}}),console.log("editStates after handleEditClick:",n)},R=p=>{t(j=>{const S=j.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return D(S),S}),s(j=>{const S={...j};return delete S[p],S}),A("File name updated successfully."),w("info"),c(!0)},u=(p,j)=>{s(S=>({...S,[p]:j}))},f=(p,j)=>{j!=="clickaway"&&c(!1)};return i.jsxs("div",{children:[o&&i.jsx(Qt,{title:"Upload Files",children:i.jsxs(Fe,{variant:"outlined",component:"label",startIcon:i.jsx($s,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:_,disabled:a,ref:B})]})}),a&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(x),"%"]})}),i.jsx(Yr,{children:e.map(p=>i.jsxs(Kr,{style:{opacity:p.deleted?.5:1},children:[i.jsx(Xr,{children:i.jsx(Hs,{})}),typeof n[p.id]=="string"?i.jsx(Zt,{variant:"outlined",size:"small",value:n[p.id],onChange:j=>u(p.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&R(p.id),fullWidth:!0}):i.jsx(Jr,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),o&&(typeof n[p.id]=="string"?i.jsx(Be,{onClick:()=>R(p.id),edge:"end","aria-label":"save",children:i.jsx(kn,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Be,{onClick:()=>y(p.id),edge:"end","aria-label":"edit",children:i.jsx(mr,{})}),i.jsx(Be,{onClick:()=>P(p.id),edge:"end","aria-label":"delete",children:i.jsx(Bt,{})})]}))]},p.id))}),i.jsx(ht,{open:r,autoHideDuration:6e3,onClose:f,children:i.jsx(gt,{onClose:f,severity:U,sx:{width:"100%"},children:m})})]})},Vs=({designs:g,setDesigns:T,setIsAdding:D,getDesigns:o,onReturnToDashboard:e})=>{const{userDetails:t}=qt();console.log("Add Design loaded");const[a,l]=q.useState(""),[x,v]=q.useState(""),[n,s]=q.useState(""),[r,c]=q.useState([]),[m,A]=q.useState([]),U=q.useMemo(()=>r,[r]),[w,B]=q.useState(!1),[M,_]=q.useState(""),[P,y]=q.useState("info"),[R,u]=q.useState(!1),[f,p]=q.useState("");console.log("Adding New Design from user:",t);const j=q.useRef(null),S=()=>{u(!1)},C=(F,h)=>{h!=="clickaway"&&B(!1)};q.useEffect(()=>{if(t!=null&&t.classes){const F=Object.keys(t.classes)[0];v(F||"")}},[t==null?void 0:t.classes]);const b=async F=>{var I;if(F.preventDefault(),console.log("Files to be saved:",m),!t||!t.uid){console.error("User object is undefined or missing UID."),p("You must be signed in to add a design."),u(!0);return}if(!a){p("All fields are required."),u(!0);return}await((I=j.current)==null?void 0:I.commitDeletions());const h=r.filter(N=>!N.deleted),d=m.filter(N=>!N.deleted).map(N=>({id:N.id,url:N.url,name:N.name,path:N.path})),E={title:n,description:a,course:x,dateCreated:Pt(),dateModified:Pt(),images:h,files:d,userId:t.uid};try{const N=await Dn(Te(re,"designs"),E),$={...E,id:N.id};T([...g,$]),_(`${n} has been Added.`),y("success"),B(!0),s(""),l(""),c([]),A([]),setTimeout(()=>{D(!1),o()},1e3)}catch(N){console.log(N),p("There was an issue adding your design."),u(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx(Fe,{variant:"text",onClick:e,className:"profile-button",children:"â† All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:b,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsx("div",{style:{display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:F=>s(F.target.value),style:{width:"100%"}})]})}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Gt,{id:"course",value:x,onChange:F=>v(F.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([F,h])=>i.jsx(bt,{value:F,children:`${h.number} - ${h.title}`},F))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(Qe,{onChange:l,initialValue:a}),i.jsx(ct,{ref:j,path:"designs/images",initialImages:U,onImagesUpdated:c,onDelete:F=>c(r.filter(h=>!F.includes(h))),isOwnDesign:!0}),i.jsx(St,{path:"designs/files",initialFiles:m,onFilesChange:A,isOwnDesign:!0}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(Fe,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(Fe,{onClick:()=>D(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(ut,{open:R,onClose:S,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(Ct,{id:"alert-dialog-title",children:"Notification"}),i.jsx(ft,{children:i.jsx(zt,{id:"alert-dialog-description",children:f})}),i.jsx(At,{children:i.jsx(Fe,{onClick:S,autoFocus:!0,children:"Ok"})})]}),i.jsx(ht,{open:w,autoHideDuration:1e3,onClose:C,children:i.jsx(gt,{onClose:C,severity:P,sx:{width:"100%"},children:M})})]})},Qs=({designId:g,setIsAddingBuild:T,refreshBuilds:D})=>{const[o,e]=q.useState(""),[t,a]=q.useState(""),[l,x]=q.useState([]),[v,n]=q.useState([]),{userDetails:s}=qt(),r=j=>{x(j)},c=j=>{n(j)};console.log("AddBuild loaded");const[m,A]=q.useState(!1),[U,w]=q.useState(""),[B,M]=q.useState(!1),[_,P]=q.useState(""),[y,R]=q.useState("info");console.log("Adding New Build by user:",s);const u=()=>{A(!1)},f=(j,S)=>{S!=="clickaway"&&M(!1)},p=async j=>{if(j.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),w("You must be signed in to add a build."),A(!0);return}if(!t){w("Build description is required."),A(!0);return}const S=l.filter(b=>!b.deleted),C=v.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await Dn(Te(re,"builds"),{title:o,description:t,design_ID:g,dateCreated:Pt(),userId:s.uid,images:S,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",s),P("Your build has been successfully added."),R("success"),M(!0),setTimeout(()=>{e(""),a(""),x([]),n([]),T(!1),D()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let F=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(F="You do not have permission to perform this operation."),P(F),R("error"),M(!0)}else P("Failed to add the build. Please try again later."),R("error"),M(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:o,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(Qe,{onChange:a,initialValue:t})," ",i.jsx(ct,{path:`builds/${g}/images`,initialImages:l,onImagesUpdated:r,onDelete:j=>x(S=>S.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(St,{path:`builds/${g}/files`,initialFiles:v,onFilesChange:c,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>T(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(ut,{open:m,onClose:u,children:[i.jsx(Ct,{children:"Notification"}),i.jsx(ft,{children:i.jsx(zt,{children:U})}),i.jsx(At,{children:i.jsx(Fe,{onClick:u,children:"OK"})})]}),i.jsx(ht,{open:B,autoHideDuration:6e3,onClose:f,children:i.jsx(gt,{onClose:f,severity:y,sx:{width:"100%"},children:_})})]})},Gs=({designId:g,buildId:T,refreshTests:D,setAddingTestIdForBuild:o})=>{const[e,t]=q.useState(""),[a,l]=q.useState(""),[x,v]=q.useState(""),[n,s]=q.useState(""),[r,c]=q.useState([]),[m,A]=q.useState([]),{userDetails:U}=qt();console.log("AddTest loaded");const[w,B]=q.useState(!1),[M,_]=q.useState(""),[P,y]=q.useState(!1),[R,u]=q.useState(""),[f,p]=q.useState("info"),j=C=>{A(C)},S=async()=>{if(!a){_("Test description cannot be empty!"),B(!0);return}const C=r.filter(F=>!F.deleted),b=m.filter(F=>!F.deleted).map(F=>({id:F.id,url:F.url,name:F.name,path:F.path}));try{await Dn(Te(re,"tests"),{title:e,build_ID:T,design_ID:g,dateCreated:Pt(),description:a,results:x,conclusions:n,userId:U==null?void 0:U.uid,images:C,files:b}),setTimeout(()=>{D(T),t(""),l(""),v(""),s(""),c([]),A([]),o(!1)},1e3),u("Test added successfully"),p("success"),y(!0)}catch(F){console.error("Error adding test: ",F),u("Failed to add the test"),p("error"),y(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(Qe,{onChange:l,initialValue:a}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(Qe,{onChange:v,initialValue:x}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(Qe,{onChange:s,initialValue:n}),i.jsx(ct,{path:`tests/${T}/images`,initialImages:r,onImagesUpdated:C=>{c(C)},onDelete:C=>c(b=>b.filter(F=>!C.includes(F))),isOwnDesign:!0}),i.jsx(St,{path:`tests/${T}/files`,initialFiles:m,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:S,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>o(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(ut,{open:w,onClose:()=>B(!1),children:[i.jsx(Ct,{children:"Notification"}),i.jsx(ft,{children:i.jsx(zt,{children:M})}),i.jsx(At,{children:i.jsx(Fe,{onClick:()=>B(!1),children:"OK"})})]}),i.jsx(ht,{open:P,autoHideDuration:6e3,onClose:()=>y(!1),children:i.jsx(gt,{onClose:()=>y(!1),severity:f,sx:{width:"100%"},children:R})})]})};var Ot={},lr;function Zs(){if(lr)return Ot;lr=1;var g=st();Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var T=g(ot()),D=it();return Ot.default=(0,T.default)((0,D.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),Ot}var Ys=Zs();const Fn=Je(Ys),Nt=g=>g&&g instanceof Un?g.toDate().toLocaleString():"",Ks=({selectedDesign:g,setIsEditing:T,onReturnToDashboard:D})=>{const{userDetails:o,loading:e}=qt(),t=g.id,a=g.userId===(o==null?void 0:o.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",o);const[l,x]=q.useState(""),[v,n]=q.useState(g.description),[s,r]=q.useState(g.course||""),[c,m]=q.useState(Nt(g.dateCreated)),[A,U]=q.useState(Nt(g.dateModified)),[w,B]=q.useState([]),[M,_]=q.useState([]),P=q.useRef(null),[y,R]=q.useState(!1),[u,f]=q.useState([]),[p,j]=q.useState({}),[S,C]=q.useState({}),[b,F]=q.useState({}),h=q.useRef(null),[d,E]=q.useState({}),[I,N]=q.useState({}),[$,H]=q.useState({}),[V,L]=q.useState(!1),[O,Y]=q.useState({}),[ne,K]=q.useState({}),[J,ae]=q.useState({}),[se,fe]=q.useState({}),[Ne,ke]=q.useState({}),he=q.useRef(null),[xe,ge]=q.useState({}),[le,pe]=q.useState({}),[ye,me]=q.useState({}),[Ue,de]=q.useState(!1),[ue,je]=q.useState(""),[Le,et]=q.useState(()=>()=>{}),[we,ce]=q.useState(!1),[Ae,ie]=q.useState(""),[Re,oe]=q.useState("info"),[De,Se]=q.useState({design:!1,builds:!1,tests:!1}),Tt=async k=>{if(k.preventDefault(),!v){je("All fields are required."),de(!0);return}console.log("About to check image deletions",P.current),console.log(P.current),console.log(w.some(Q=>Q.deleted)),P.current&&w.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await P.current.commitDeletions());const W=w.filter(Q=>!Q.deleted);M.some(Q=>Q.deleted)&&await Ht();const z=M.filter(Q=>!Q.deleted),Z={title:l,description:v,course:s,dateModified:Pt(),images:W.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:z.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:o.uid};try{await nt(Ce(re,"designs",t),Z,{merge:!0}),ie("Your design has been updated."),oe("success"),ce(!0);const Q=Un.now();U(Nt(Q))}catch(Q){console.error("Error updating design:",Q),ie("There was an issue updating your design."),oe("error"),ce(!0)}Se(Q=>({...Q,design:!1}))};q.useEffect(()=>{g&&(n(g.description||""),x(g.title||""),r(g.course||""),(async()=>{const W=Ce(re,"designs",t),z=await ss(W);if(z.exists()){const Z=z.data();console.log("Fetched images:",Z.images),console.log("Fetched files:",Z.files),B(Z.images||[]),_(Z.files||[]),m(Nt(Z.dateCreated)),U(Nt(Z.dateModified))}})())},[g,t]);const nn=k=>{const W=w.filter(Z=>!k.some(Q=>Q.path===Z.path));console.log("Remaining images after deletion:",W),B(W);const z=W.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));nt(Ce(re,"designs",t),{images:z},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Z=>console.error("Failed to update Firestore:",Z))},Ft=k=>{JSON.stringify(w)!==JSON.stringify(k)&&(B(k),console.log("Updated images received:",k))},Ht=async()=>{const k=M.filter(W=>W.deleted);if(console.log("Files to delete:",k),k.length>0){const W=yt(),z=k.map(Z=>{const Q=jt(W,Z.path);return $t(Q)});try{await Promise.all(z),console.log("Files deleted successfully");const Z=M.filter(Q=>!Q.deleted);_(Z),await cn(Ce(re,"designs",g.id),{files:Z.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),ie("Deleted files have been permanently removed."),oe("success"),ce(!0)}catch(Z){console.error("Failed to delete files: ",Z),ie("Failed to delete files."),oe("error"),ce(!0)}}},at=async k=>{var Q,X;try{await Dr(k)}catch(G){console.error("Error deleting files:",G),ie("Failed to delete build files."),oe("error"),ce(!0)}const W=((Q=S[k])==null?void 0:Q.filter(G=>!G.deleted).map(({url:G,path:_e,title:Ye})=>({url:G,path:_e,title:Ye})))||[],z=((X=b[k])==null?void 0:X.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[],Z={};W.length>0&&(Z.images=W),z.length>0&&(Z.files=z),p[k]!==void 0&&(Z.description=p[k]);try{const G=Ce(re,"builds",k);await nt(G,Z,{merge:!0}),ie("Your build has been updated."),oe("success"),ce(!0),ze(),Se(_e=>({..._e,builds:!1}))}catch(G){console.error("Error updating build:",G),ie("Failed to update build."),oe("error"),ce(!0)}},rn=(k,W)=>{N(z=>({...z,[k]:W}))},We=(k,W)=>{j(z=>({...z,[k]:W})),Se(z=>({...z,builds:!0}))},Pe=async k=>{const W=I[k];try{const z=Ce(re,"builds",k);await nt(z,{title:W},{merge:!0}),N(Z=>{const Q={...Z};return delete Q[k],Q}),ze()}catch(z){console.error("Failed to save build title:",z)}},ze=async()=>{if(!o){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",o==null?void 0:o.uid),console.log("Selected design ID for query:",g==null?void 0:g.id);let k;o.isAdmin?k=Ee(Te(re,"builds"),be("design_ID","==",t),He("dateCreated")):k=Ee(Te(re,"builds"),be("design_ID","==",t),be("userId","==",o.uid),He("dateCreated")),console.log("Builds query details:",JSON.stringify(k,null,2));const W=await rt(k);console.log("Builds snapshot details:",JSON.stringify(W.docs.map(Z=>Z.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",W.docs.length);const z=W.docs.map(Z=>(console.log("Build doc path: ",Z.ref.path),{id:Z.id,...Z.data()}));f(z),console.log("New builds state after refresh:",z)}catch(k){console.error("Error refreshing builds:",k),k.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",k):console.error("An unexpected error occurred when trying to refresh builds:",k)}},lt=(k,W)=>{const z=Ce(re,"builds",k),Z=S[k].filter(X=>!W.some(G=>G.path===X.path));C(X=>({...X,[k]:Z}));const Q=Z.map(X=>({url:X.url,title:X.title,path:X.path}));nt(z,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ie("Build Image deletions updated."),oe("success")}).catch(X=>{console.error("Failed to update build images in Firestore:",X),ie("Failed to update build image deletions."),oe("error")}),ce(!0)},Lt=async k=>{const W=Ee(Te(re,"tests"),be("build_ID","==",k),be("userId","==",o.uid)),z=await rt(W);for(const Z of z.docs)await wt(Ce(re,"tests",Z.id));await wt(Ce(re,"builds",k)),await ze(),ie("Build and its tests (if any) deleted successfully."),oe("success"),ce(!0)},Ze=k=>{je("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),et(()=>()=>Lt(k)),de(!0)},$e=(k,W)=>{C(z=>({...z,[k]:W}))},En=(k,W)=>{F(z=>({...z,[k]:W}))},Dr=async k=>{var z;const W=((z=b[k])==null?void 0:z.filter(Z=>Z.deleted))||[];if(console.log("Build files to delete:",W),W.length>0){const Z=yt(),Q=W.map(X=>{const G=jt(Z,X.path);return $t(G)});try{await Promise.all(Q),console.log("Build files deleted successfully");const X=b[k].filter(G=>!G.deleted);F(G=>({...G,[k]:X})),await cn(Ce(re,"builds",k),{files:X.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),console.log("Firestore successfully updated to remove deleted files"),ie("Deleted build files have been permanently removed."),oe("success"),ce(!0)}catch(X){console.error("Failed to delete build files: ",X),ie("Failed to delete build files."),oe("error"),ce(!0)}}},_r=async(k,W)=>{var X;try{await Br(k)}catch(G){console.error("Error deleting files:",G),ie("Failed to delete build files."),oe("error"),ce(!0)}const z={},Z=se[k].filter(G=>!G.deleted).map(({url:G,path:_e,title:Ye})=>({url:G,path:_e,title:Ye})),Q=((X=Ne[k])==null?void 0:X.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[];O[k]!==void 0&&(z.description=O[k]),ne[k]!==void 0&&(z.results=ne[k]),J[k]!==void 0&&(z.conclusions=J[k]),z.images=Z,z.files=Q;try{const G=Ce(re,"tests",k);await nt(G,z,{merge:!0}),ie("Your test has been updated."),oe("success"),ce(!0),Wt(W)}catch(G){console.error(`Error updating test ID: ${k}:`,G),ie("There was an issue updating your test."),oe("error"),ce(!0)}},Rr=(k,W)=>{pe(z=>({...z,[k]:W}))},Mn=async(k,W)=>{const z=le[k],Z=Ce(re,"tests",k);await nt(Z,{title:z},{merge:!0}),pe(Q=>{const X={...Q};return delete X[k],X}),Wt(W)},Er=(k,W)=>{console.log(`Updating description for test ID ${k}:`,W),Y(z=>({...z,[k]:W})),Se(z=>({...z,tests:!0}))},Mr=(k,W)=>{console.log(`Updating results for test ID ${k}:`,W),K(z=>({...z,[k]:W})),Se(z=>({...z,tests:!0}))},Or=(k,W)=>{ae(z=>({...z,[k]:W})),Se(z=>({...z,tests:!0}))};q.useEffect(()=>{!e&&o&&(async()=>{if(!o)return;let W;o.isAdmin?W=Ee(Te(re,"builds"),be("design_ID","==",t),He("dateCreated")):W=Ee(Te(re,"builds"),be("design_ID","==",t),be("userId","==",o.uid),He("dateCreated"));const z=await rt(W),Z=[],Q={},X={};for(const G of z.docs){const _e=G.data(),Ye=G.id;Z.push({id:Ye,..._e,images:_e.images||[],files:_e.files||[]}),X[Ye]=!0;let sn;o.isAdmin?sn=Ee(Te(re,"tests"),be("build_ID","==",Ye),He("dateCreated")):sn=Ee(Te(re,"tests"),be("build_ID","==",Ye),be("userId","==",o.uid),He("dateCreated"));const Lr=await rt(sn),Bn=[],on={},an={};for(const tt of Lr.docs){const Ke=tt.data();Bn.push({id:tt.id,...Ke}),on[tt.id]=Ke.images||[],an[tt.id]=Ke.files||[]}Q[Ye]=Bn,fe(tt=>{const Ke={...tt};for(const It in on)Ke[It]=on[It];return Ke}),ke(tt=>{const Ke={...tt};for(const It in an)Ke[It]=an[It];return Ke})}f(Z),H(Q),me(X)})()},[e,o,g.id,t]);const Wt=async k=>{if(!o){console.log("User details not loaded yet");return}try{let W;o.isAdmin?W=Ee(Te(re,"tests"),be("build_ID","==",k),He("dateCreated")):W=Ee(Te(re,"tests"),be("build_ID","==",k),be("userId","==",o.uid),He("dateCreated"));const Z=(await rt(W)).docs.map(G=>{const _e=G.data();return{id:G.id,..._e,images:_e.images||[],files:_e.files||[]}});H(G=>({...G,[k]:Z}));const Q={},X={};Z.forEach(G=>{Q[G.id]=G.images,X[G.id]=G.files}),fe(Q),ke(X)}catch(W){console.error("Error fetching tests:",W)}},Nr=(k,W)=>{const z=Ce(re,"tests",k),Z=se[k].filter(X=>!W.includes(X));fe(X=>({...X,[k]:Z}));const Q=Z.map(({url:X,path:G,title:_e})=>({url:X,path:G,title:_e}));nt(z,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ie("Test Image deletions updated."),oe("success")}).catch(X=>{console.error("Failed to update test images in Firestore:",X),ie("Failed to update test image deletions."),oe("error")}),ce(!0)},On=(k,W)=>{fe(z=>({...z,[k]:W}))},Nn=(k,W)=>{ke(z=>({...z,[k]:W}))},Br=async k=>{var z;const W=((z=Ne[k])==null?void 0:z.filter(Z=>Z.deleted))||[];if(W.length>0){const Z=yt(),Q=W.map(X=>{const G=jt(Z,X.path);return $t(G)});try{await Promise.all(Q);const X=Ne[k].filter(G=>!G.deleted);ke(G=>({...G,[k]:X})),await cn(Ce(re,"tests",k),{files:X.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),ie("Deleted test files have been permanently removed."),oe("success"),ce(!0)}catch(X){console.error("Failed to delete test files: ",X),ie("Failed to delete test files."),oe("error"),ce(!0)}}},Pr=async(k,W)=>{await wt(Ce(re,"tests",k)),await Wt(W),ie("Test deleted successfully."),oe("success"),ce(!0)},zr=(k,W)=>{je("Are you sure you want to delete this test? This action cannot be undone."),et(()=>()=>Pr(k,W)),de(!0)},qr=k=>{me(W=>({...W,[k]:!W[k]}))},Hr=()=>{const k=Object.entries(De).filter(([z,Z])=>Z).map(([z])=>z).join(", ");if(!k.length){D();return}const W=`You have unsaved changes in the following sections: ${k}. Are you sure you want to leave?`;je(W),et(()=>()=>{Se({design:!1,builds:!1,tests:!1}),D()}),de(!0)};return q.useEffect(()=>{const k=W=>{Object.values(De).some(Z=>Z)&&(W.preventDefault(),W.returnValue="")};return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[De]),i.jsxs("div",{className:"small-container",children:[i.jsx(Fe,{variant:"text",onClick:()=>{Object.values(De).some(W=>W)?Hr():D()},className:"profile-button",children:"â† All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:Tt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:l,onChange:k=>{x(k.target.value),Se(W=>({...W,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:c||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:A||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Gt,{id:"course",value:s,onChange:k=>{r(k.target.value),Se(W=>({...W,design:!0}))},fullWidth:!0,children:(o!=null&&o.classes?Object.entries(o.classes):[]).map(([k,W])=>i.jsx(bt,{value:k,children:`${W.number} - ${W.title}`},k))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(Qe,{initialValue:v,onChange:k=>{n(k),Se(W=>({...W,design:!0}))}}),i.jsx(ct,{ref:P,path:`designs/${g.id}/images`,initialImages:w,onImagesUpdated:Ft,onDelete:nn,isOwnDesign:a}),i.jsx(St,{path:`designs/${g.id}/files`,initialFiles:M,onFilesChange:_,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>T(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{R(!0),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"âž•"})," Build"]})]}),u.map((k,W)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:I[k.id]!==void 0?i.jsx(Zt,{variant:"outlined",size:"small",fullWidth:!0,value:I[k.id],onChange:z=>rn(k.id,z.target.value),onBlur:()=>Pe(k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Be,{onClick:()=>Pe(k.id),size:"small",children:i.jsx(kn,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>N(z=>({...z,[k.id]:k.title||`Build ${W+1}`})),style:{cursor:"pointer"},children:k.title||`Build ${W+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>E(z=>({...z,[k.id]:!z[k.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:d[k.id]?i.jsx(Fn,{}):i.jsx(dn,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ze(k.id),children:i.jsx(Bt,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{L(k.id),setTimeout(()=>{he.current&&he.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"âž•"})," Test"]})]})]})]}),d[k.id]&&i.jsxs(i.Fragment,{children:[i.jsx(Qe,{initialValue:p[k.id]||k.description,onChange:z=>{We(k.id,z)}}),i.jsx(ct,{path:`builds/${k.id}/images`,initialImages:k.images,onImagesUpdated:z=>$e(k.id,z),onDelete:z=>lt(k.id,z),isOwnDesign:a}),i.jsx(St,{path:`builds/${k.id}/files`,initialFiles:k.files,onFilesChange:z=>En(k.id,z),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>at(k.id),children:"Update"})}),i.jsx("div",{children:$[k.id]&&$[k.id].length>0&&i.jsx("button",{onClick:()=>qr(k.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:ye[k.id]?i.jsxs(i.Fragment,{children:[i.jsx(dn,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(Fn,{style:{marginRight:"8px"}}),"Tests"]})})}),!ye[k.id]&&$[k.id]&&$[k.id].map((z,Z)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:le[z.id]!==void 0?i.jsx(Zt,{variant:"outlined",size:"small",fullWidth:!0,value:le[z.id],onChange:Q=>Rr(z.id,Q.target.value),onBlur:()=>Mn(z.id,k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Be,{onClick:()=>Mn(z.id,k.id),size:"small",children:i.jsx(kn,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>pe(Q=>({...Q,[z.id]:z.title||`Test ${Z+1}`})),style:{cursor:"pointer"},children:z.title||`Test ${Z+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>ge(Q=>({...Q,[z.id]:!Q[z.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:xe[z.id]?i.jsx(Fn,{}):i.jsx(dn,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>zr(z.id,k.id),children:i.jsx(Bt,{})})]})]}),xe[z.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(Qe,{initialValue:O[z.id]||z.description,onChange:Q=>{Er(z.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(Qe,{initialValue:ne[z.id]||z.results,onChange:Q=>{Mr(z.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(Qe,{initialValue:J[z.id]||z.conclusions,onChange:Q=>{Or(z.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(ct,{path:`tests/${z.id}/images`,initialImages:se[z.id]||[],onImagesUpdated:Q=>On(z.id,Q),onDelete:Q=>Nr(z.id,Q),isOwnDesign:a}),i.jsx(St,{path:`tests/${z.id}/files`,initialFiles:Ne[z.id]||[],onFilesChange:Q=>Nn(z.id,Q),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>_r(z.id,k.id),children:"Update"})})]})]},z.id))]}),V===k.id&&i.jsxs("div",{className:"new-test-record",ref:he,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Gs,{designId:g.id,buildId:k.id,refreshTests:()=>Wt(k.id),setAddingTestIdForBuild:L,onImagesUpdated:z=>On(k.id,z),onFilesChange:z=>Nn(k.id,z)})]})]},k.id)),i.jsx("div",{children:y&&i.jsxs("div",{className:"new-build-record",ref:h,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Qs,{designId:g.id,setIsAddingBuild:R,refreshBuilds:ze,onImagesUpdated:k=>$e("temp-build-id",k),onFilesChange:k=>En("temp-build-id",k)})]})})]}),i.jsxs(ut,{open:Ue,onClose:()=>de(!1),children:[i.jsx(Ct,{children:"Confirmation Required"}),i.jsx(ft,{children:i.jsx(zt,{children:ue})}),i.jsxs(At,{children:[i.jsx(Fe,{onClick:()=>de(!1),children:"Cancel"}),i.jsx(Fe,{onClick:()=>{Le(),de(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(ht,{open:we,autoHideDuration:6e3,onClose:()=>ce(!1),children:i.jsx(gt,{onClose:()=>ce(!1),severity:Re,sx:{width:"100%"},children:Ae})})]})},pt=(g,T,D)=>g[T]??D,Xs=()=>{const{userDetails:g,loading:T}=qt(),D=dr(),o=cr(D.breakpoints.down("md"));console.log("Dashboard loaded");const[e,t]=q.useState([]),[a,l]=q.useState([]),[x,v]=q.useState([]),[n,s]=q.useState(null),[r,c]=q.useState(!1),[m,A]=q.useState(!1),[U,w]=q.useState(!1),[B,M]=q.useState(""),[_,P]=q.useState(""),[y,R]=q.useState(!1),[u,f]=q.useState(null),[p,j]=q.useState(!1),[S,C]=q.useState(""),[b,F]=q.useState("info"),h=()=>{A(!1),c(!1),s(null),d()},d=q.useCallback(async()=>{if(!g)return;let H;const V=[],L=[],O=[];if(g.isSuperAdmin)H=Ee(Te(re,"designs"),He("dateCreated","desc"));else if(g.isAdmin){const ne=g.classes?Object.keys(g.classes):[];if(ne.length>0)H=Ee(Te(re,"designs"),be("course","in",ne),He("dateCreated","desc"));else{l([]),v([]);return}}else H=Ee(Te(re,"designs"),be("userId","==",g.uid),He("dateCreated","desc"));(await rt(H)).forEach(ne=>{const K=ne.data(),J={id:ne.id,title:pt(K,"title",""),description:pt(K,"description",""),course:pt(K,"course",""),dateCreated:K.dateCreated,dateModified:K.dateModified,userId:pt(K,"userId",""),images:pt(K,"images",[]),files:pt(K,"files",[])};g.isSuperAdmin?K.userId===g.uid?V.push(J):K.userId!==g.uid&&K.course&&K.isAdmin?L.push(J):K.userId!==g.uid&&!K.isAdmin&&O.push(J):g.isAdmin?K.userId===g.uid?L.push(J):O.push(J):K.userId===g.uid&&O.push(J)}),t(V),l(L),v(O)},[g]);q.useEffect(()=>{!T&&g&&d()},[g,T,d]);const E=H=>{const V=[...e,...a,...x].find(L=>L.id===H);s(V||null),A(!0)},I=H=>{f(H),M("Are you sure you want to delete this design? This action cannot be undone."),w(!0)},N=async()=>{if(u)if(_!==(g==null?void 0:g.uid))C("User ID confirmation failed. Enter the correct User ID."),F("error"),j(!0);else try{const H=Ee(Te(re,"builds"),be("design_ID","==",u),be("userId","==",g.uid)),V=await rt(H);for(const L of V.docs){const O=L.id,Y=Ee(Te(re,"tests"),be("build_ID","==",O),be("userId","==",g.uid)),ne=await rt(Y);for(const K of ne.docs)await wt(Ce(re,"tests",K.id));await wt(Ce(re,"builds",O))}await wt(Ce(re,"designs",u)),t(L=>L.filter(O=>O.id!==u)),l(L=>L.filter(O=>O.id!==u)),v(L=>L.filter(O=>O.id!==u)),C("Your design and its associated builds and tests have been deleted."),F("success"),j(!0)}catch(H){console.error("Error deleting design, builds, and tests: ",H),C("There was an issue deleting your design and its associated builds and tests."),F("error"),j(!0)}finally{P(""),R(!1),f(null)}},$=(H,V,L)=>i.jsx(Ge,{sx:{mb:ve[4],mt:ve[6]},children:i.jsx(ur,{sx:{p:o?ve[3]:ve[4],backgroundColor:ee.background.secondary,borderRadius:Yt.lg,border:`1px solid ${ee.neutral[200]}`,boxShadow:vt.sm},children:i.jsxs(Ge,{sx:{display:"flex",alignItems:"center",gap:ve[3],flexDirection:o?"column":"row",textAlign:o?"center":"left"},children:[i.jsx(Xe,{variant:"h4",sx:{fontFamily:te.fontFamily.display,fontSize:o?te.fontSize.xl:te.fontSize["2xl"],fontWeight:te.fontWeight.bold,color:ee.text.primary},children:H}),i.jsx(fr,{label:`${V} ${V===1?"Design":"Designs"}`,size:"small",sx:{backgroundColor:L,color:ee.text.inverse,fontFamily:te.fontFamily.secondary,fontWeight:te.fontWeight.semibold,fontSize:te.fontSize.sm}})]})})});return i.jsxs(Ge,{sx:{p:o?ve[3]:ve[6],backgroundColor:ee.background.primary,minHeight:"100vh"},children:[!r&&!m&&i.jsxs(i.Fragment,{children:[i.jsx(pr,{setIsAdding:c}),(g==null?void 0:g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[$("My Designs",e.length,ee.primary[500]),i.jsx(mt,{designs:e,handleEdit:E,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),$("Educator Designs",a.length,ee.secondary[500]),i.jsx(mt,{designs:a,handleEdit:E,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),$("Student Designs",x.length,ee.info),i.jsx(mt,{designs:x,handleEdit:E,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),(g==null?void 0:g.isAdmin)&&!g.isSuperAdmin&&i.jsxs(i.Fragment,{children:[$("My Educator Designs",a.length,ee.secondary[500]),i.jsx(mt,{designs:a,handleEdit:E,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),$("Student Designs",x.length,ee.info),i.jsx(mt,{designs:x,handleEdit:E,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),!(g!=null&&g.isAdmin)&&!(g!=null&&g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[$("My Designs",x.length,ee.primary[500]),i.jsx(mt,{designs:x,handleEdit:E,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!1})]})]}),r&&i.jsx(Vs,{designs:e.concat(a),setDesigns:l,setIsAdding:c,getDesigns:d,onReturnToDashboard:h}),m&&i.jsx(Ks,{designs:e.concat(a),selectedDesign:n,setDesigns:l,setIsEditing:A,getDesigns:d,onReturnToDashboard:h}),i.jsxs(ut,{open:U,onClose:()=>w(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ct,{children:"Confirm Deletion"}),i.jsx(ft,{children:i.jsx(zt,{children:B})}),i.jsxs(At,{children:[i.jsx(Fe,{onClick:()=>w(!1),children:"No, cancel"}),i.jsx(Fe,{onClick:()=>{R(!0),w(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(ut,{open:y,onClose:()=>R(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ct,{children:"Confirm Your User ID"}),i.jsx(ft,{children:i.jsx(Zt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:_,onChange:H=>P(H.target.value)})}),i.jsxs(At,{children:[i.jsx(Fe,{onClick:()=>R(!1),children:"No, cancel"}),i.jsx(Fe,{onClick:N,color:"primary",children:"Confirm"})]})]}),i.jsx(ht,{open:p,autoHideDuration:6e3,onClose:()=>j(!1),children:i.jsx(gt,{onClose:()=>j(!1),severity:b,sx:{width:"100%"},children:S})})]})},ii=es.memo(Xs);export{ii as default};
