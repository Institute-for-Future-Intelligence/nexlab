import{r as H,j as i,B as et,e as Se,b as gs,a7 as ms,o as ps,a8 as bs,a9 as xs,aa as zt,ab as ke,ac as ys,k as Dt,I as Oe,E as Mn,n as jt,aU as vs,D as st,g as rt,aV as js,aW as ws,aX as Cs,aY as Ss,S as it,d as at,a3 as As,a2 as jn,a4 as Et,W as dt,ah as Ts,z as Fs,F as Is,aZ as Us,ai as ks,J as Rt,H as Ds,K as un,f as mt,h as Ct,i as pt,a_ as $t,am as Qt,c as Es}from"./ui-BaKcPlQz.js";import{u as Rs,d as _s,C as Os,a as St,b as J}from"./index-DCoGJp-f.js";import{f as fn,g as ut,r as ft,v as Ut,w as Bn,e as Pn,p as hn,_ as Ce,G as wt,b as je,c as Ns,R as Ee,x as Pe,j as me,h as Ze,m as Ke,d as Gt,y as ht}from"./firebase-BTwATirQ.js";import{c as It,g as Ms}from"./vendor-DeqkGhWy.js";import Vt from"./purify.es-CQJ0hv7W.js";const Ln=H.memo(({setIsAdding:b})=>{console.log("Header loaded");const I=Rs(),E=()=>{I("/")};return i.jsxs(et,{className:"lab-notebook-container",children:[i.jsx(et,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Se,{variant:"text",onClick:E,className:"back-home-button",children:"â† Home Page"})}),i.jsx(et,{sx:{display:"flex",alignItems:"center",mb:2},children:i.jsx(gs,{className:"webpage_title",children:"My Laboratory Notebook"})}),i.jsx(et,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx(Se,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>b(!0),children:"+ Create New"})})]})});Ln.displayName="Header";const ot=({designs:b,handleEdit:I,handleDelete:E,userDetails:l,showUserIdColumn:e})=>{const t=a=>a?a instanceof fn?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx(ms,{component:ps,children:i.jsxs(bs,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[i.jsx(xs,{children:i.jsxs(zt,{sx:{height:"60px"},children:[i.jsx(ke,{sx:{fontWeight:"bold",width:e?"30%":"40%"},children:"Title"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),e&&i.jsx(ke,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),i.jsx(ys,{children:b&&b.length>0?b.map(a=>{const c=a.userId===(l==null?void 0:l.uid);return i.jsxs(zt,{sx:{height:"80px"},children:[i.jsx(ke,{children:i.jsx("button",{onClick:()=>I(a.id),className:"hyperlink-style",children:a.title})}),i.jsx(ke,{children:a.course&&(l!=null&&l.classes)&&l.classes[a.course]?`${l.classes[a.course].number} - ${l.classes[a.course].title}`:"N/A"}),e&&i.jsx(ke,{children:a.userId}),i.jsx(ke,{children:t(a.dateCreated)}),i.jsx(ke,{children:t(a.dateModified)}),i.jsx(ke,{children:i.jsx(Dt,{title:"Edit",children:i.jsx("span",{children:i.jsx(Oe,{onClick:()=>c&&I(a.id),color:"primary",disabled:!c,children:i.jsx(Mn,{})})})})}),i.jsx(ke,{children:i.jsx(Dt,{title:"Delete",children:i.jsx("span",{children:i.jsx(Oe,{onClick:()=>c&&E(a.id),color:"error",disabled:!c,children:i.jsx(jt,{})})})})})]},a.id)}):i.jsx(zt,{children:i.jsx(ke,{colSpan:e?6:5,children:"No Designs Found"})})})]})})};function Bs(b,I){return I.forEach(function(E){E&&typeof E!="string"&&!Array.isArray(E)&&Object.keys(E).forEach(function(l){if(l!=="default"&&!(l in b)){var e=Object.getOwnPropertyDescriptor(E,l);Object.defineProperty(b,l,e.get?e:{enumerable:!0,get:function(){return E[l]}})}})}),Object.freeze(b)}function Hn(b,I){return new Promise(function(E,l){let e;return Ps(b).then(function(t){try{return e=t,E(new Blob([I.slice(0,2),e,I.slice(2)],{type:"image/jpeg"}))}catch(a){return l(a)}},l)})}const Ps=b=>new Promise((I,E)=>{const l=new FileReader;l.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let a=0;if(t.getUint16(a)!==65496)return E("not a valid JPEG");for(a+=2;;){const c=t.getUint16(a);if(c===65498)break;const y=t.getUint16(a+2);if(c===65505&&t.getUint32(a+4)===1165519206){const x=a+10;let n;switch(t.getUint16(x)){case 18761:n=!0;break;case 19789:n=!1;break;default:return E("TIFF header contains invalid endian")}if(t.getUint16(x+2,n)!==42)return E("TIFF header contains invalid version");const r=t.getUint32(x+4,n),s=x+r+2+12*t.getUint16(x+r,n);for(let d=x+r+2;d<s;d+=12)if(t.getUint16(d,n)==274){if(t.getUint16(d+2,n)!==3)return E("Orientation data type is invalid");if(t.getUint32(d+4,n)!==1)return E("Orientation data count is invalid");t.setUint16(d+8,1,n);break}return I(e.slice(a,a+2+y))}a+=2+y}return I(new Blob)}),l.readAsArrayBuffer(b)});var _t={},Ls={get exports(){return _t},set exports(b){_t=b}};(function(b){var I,E,l={};Ls.exports=l,l.parse=function(e,t){for(var a=l.bin.readUshort,c=l.bin.readUint,y=0,x={},n=new Uint8Array(e),r=n.length-4;c(n,r)!=101010256;)r--;y=r,y+=4;var s=a(n,y+=4);a(n,y+=2);var d=c(n,y+=2),g=c(n,y+=4);y+=4,y=g;for(var T=0;T<s;T++){c(n,y),y+=4,y+=4,y+=4,c(n,y+=4),d=c(n,y+=4);var k=c(n,y+=4),S=a(n,y+=4),B=a(n,y+2),N=a(n,y+4);y+=6;var D=c(n,y+=8);y+=4,y+=S+B+N,l._readLocal(n,D,x,d,k,t)}return x},l._readLocal=function(e,t,a,c,y,x){var n=l.bin.readUshort,r=l.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var d=n(e,t+=8),g=n(e,t+=2);t+=2;var T=l.bin.readUTF8(e,t,d);if(t+=d,t+=g,x)a[T]={size:y,csize:c};else{var k=new Uint8Array(e.buffer,t);if(s==0)a[T]=new Uint8Array(k.buffer.slice(t,t+c));else{if(s!=8)throw"unknown compression method: "+s;var S=new Uint8Array(y);l.inflateRaw(k,S),a[T]=S}}},l.inflateRaw=function(e,t){return l.F.inflate(e,t)},l.inflate=function(e,t){return e[0],e[1],l.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},l.deflate=function(e,t){t==null&&(t={level:6});var a=0,c=new Uint8Array(50+Math.floor(1.1*e.length));c[a]=120,c[a+1]=156,a+=2,a=l.F.deflateRaw(e,c,a,t.level);var y=l.adler(e,0,e.length);return c[a+0]=y>>>24&255,c[a+1]=y>>>16&255,c[a+2]=y>>>8&255,c[a+3]=y>>>0&255,new Uint8Array(c.buffer,0,a+4)},l.deflateRaw=function(e,t){t==null&&(t={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),c=l.F.deflateRaw(e,a,c,t.level);return new Uint8Array(a.buffer,0,c)},l.encode=function(e,t){t==null&&(t=!1);var a=0,c=l.bin.writeUint,y=l.bin.writeUshort,x={};for(var n in e){var r=!l._noNeed(n)&&!t,s=e[n],d=l.crc.crc(s,0,s.length);x[n]={cpr:r,usize:s.length,crc:d,file:r?l.deflateRaw(s):s}}for(var n in x)a+=x[n].file.length+30+46+2*l.bin.sizeUTF8(n);a+=22;var g=new Uint8Array(a),T=0,k=[];for(var n in x){var S=x[n];k.push(T),T=l._writeHeader(g,T,n,S,0)}var B=0,N=T;for(var n in x)S=x[n],k.push(T),T=l._writeHeader(g,T,n,S,1,k[B++]);var D=T-N;return c(g,T,101010256),T+=4,y(g,T+=4,B),y(g,T+=2,B),c(g,T+=2,D),c(g,T+=4,N),T+=4,T+=2,g.buffer},l._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},l._writeHeader=function(e,t,a,c,y,x){var n=l.bin.writeUint,r=l.bin.writeUshort,s=c.file;return n(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,c.cpr?8:0),n(e,t+=2,0),n(e,t+=4,c.crc),n(e,t+=4,s.length),n(e,t+=4,c.usize),r(e,t+=4,l.bin.sizeUTF8(a)),r(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,n(e,t+=6,x),t+=4),t+=l.bin.writeUTF8(e,t,a),y==0&&(e.set(s,t),t+=s.length),t},l.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var a=t,c=0;c<8;c++)1&a?a=3988292384^a>>>1:a>>>=1;e[t]=a}return e}(),update:function(e,t,a,c){for(var y=0;y<c;y++)e=l.crc.table[255&(e^t[a+y])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^l.crc.update(4294967295,e,t,a)}},l.adler=function(e,t,a){for(var c=1,y=0,x=t,n=t+a;x<n;){for(var r=Math.min(x+5552,n);x<r;)y+=c+=e[x++];c%=65521,y%=65521}return y<<16|c},l.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255,e[t+2]=a>>16&255,e[t+3]=a>>24&255},readASCII:function(e,t,a){for(var c="",y=0;y<a;y++)c+=String.fromCharCode(e[t+y]);return c},writeASCII:function(e,t,a){for(var c=0;c<a.length;c++)e[t+c]=a.charCodeAt(c)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,a){for(var c,y="",x=0;x<a;x++)y+="%"+l.bin.pad(e[t+x].toString(16));try{c=decodeURIComponent(y)}catch{return l.bin.readASCII(e,t,a)}return c},writeUTF8:function(e,t,a){for(var c=a.length,y=0,x=0;x<c;x++){var n=a.charCodeAt(x);if((4294967168&n)==0)e[t+y]=n,y++;else if((4294965248&n)==0)e[t+y]=192|n>>6,e[t+y+1]=128|n>>0&63,y+=2;else if((4294901760&n)==0)e[t+y]=224|n>>12,e[t+y+1]=128|n>>6&63,e[t+y+2]=128|n>>0&63,y+=3;else{if((4292870144&n)!=0)throw"e";e[t+y]=240|n>>18,e[t+y+1]=128|n>>12&63,e[t+y+2]=128|n>>6&63,e[t+y+3]=128|n>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,a=0,c=0;c<t;c++){var y=e.charCodeAt(c);if((4294967168&y)==0)a++;else if((4294965248&y)==0)a+=2;else if((4294901760&y)==0)a+=3;else{if((4292870144&y)!=0)throw"e";a+=4}}return a}},l.F={},l.F.deflateRaw=function(e,t,a,c){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],x=l.F.U,n=l.F._goodIndex;l.F._hash;var r=l.F._putsE,s=0,d=a<<3,g=0,T=e.length;if(c==0){for(;s<T;)r(t,d,s+(j=Math.min(65535,T-s))==T?1:0),d=l.F._copyExact(e,s,j,t,d+8),s+=j;return d>>>3}var k=x.lits,S=x.strt,B=x.prev,N=0,D=0,P=0,v=0,_=0,h=0;for(T>2&&(S[h=l.F._hash(e,0)]=0),s=0;s<T;s++){if(_=h,s+1<T-2){h=l.F._hash(e,s+1);var u=s+1&32767;B[u]=S[h],S[h]=u}if(g<=s){(N>14e3||D>26697)&&T-s>100&&(g<s&&(k[N]=s-g,N+=2,g=s),d=l.F._writeBlock(s==T-1||g==T?1:0,k,N,v,e,P,s-P,t,d),N=D=v=0,P=s);var m=0;s<T-2&&(m=l.F._bestMatch(e,s,B,_,Math.min(y[2],T-s),y[3]));var j=m>>>16,w=65535&m;if(m!=0){w=65535&m;var C=n(j=m>>>16,x.of0);x.lhst[257+C]++;var p=n(w,x.df0);x.dhst[p]++,v+=x.exb[C]+x.dxb[p],k[N]=j<<23|s-g,k[N+1]=w<<16|C<<8|p,N+=2,g=s+j}else x.lhst[e[s]]++;D++}}for(P==s&&e.length!=0||(g<s&&(k[N]=s-g,N+=2,g=s),d=l.F._writeBlock(1,k,N,v,e,P,s-P,t,d),N=0,D=0,N=D=v=0,P=s);(7&d)!=0;)d++;return d>>>3},l.F._bestMatch=function(e,t,a,c,y,x){var n=32767&t,r=a[n],s=n-r+32768&32767;if(r==n||c!=l.F._hash(e,t-s))return 0;for(var d=0,g=0,T=Math.min(32767,t);s<=T&&--x!=0&&r!=n;){if(d==0||e[t+d]==e[t+d-s]){var k=l.F._howLong(e,t,s);if(k>d){if(g=s,(d=k)>=y)break;s+2<k&&(k=s+2);for(var S=0,B=0;B<k-2;B++){var N=t-s+B+32768&32767,D=N-a[N]+32768&32767;D>S&&(S=D,r=N)}}}s+=(n=r)-(r=a[n])+32768&32767}return d<<16|g},l.F._howLong=function(e,t,a){if(e[t]!=e[t-a]||e[t+1]!=e[t+1-a]||e[t+2]!=e[t+2-a])return 0;var c=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-a];)t++;return t-c},l.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},l.saved=0,l.F._writeBlock=function(e,t,a,c,y,x,n,r,s){var d,g,T,k,S,B,N,D,P,v=l.F.U,_=l.F._putsF,h=l.F._putsE;v.lhst[256]++,g=(d=l.F.getTrees())[0],T=d[1],k=d[2],S=d[3],B=d[4],N=d[5],D=d[6],P=d[7];var u=32+((s+3&7)==0?0:8-(s+3&7))+(n<<3),m=c+l.F.contSize(v.fltree,v.lhst)+l.F.contSize(v.fdtree,v.dhst),j=c+l.F.contSize(v.ltree,v.lhst)+l.F.contSize(v.dtree,v.dhst);j+=14+3*N+l.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var w=0;w<286;w++)v.lhst[w]=0;for(w=0;w<30;w++)v.dhst[w]=0;for(w=0;w<19;w++)v.ihst[w]=0;var C=u<m&&u<j?0:m<j?1:2;if(_(r,s,e),_(r,s+1,C),s+=3,C==0){for(;(7&s)!=0;)s++;s=l.F._copyExact(y,x,n,r,s)}else{var p,A;if(C==1&&(p=v.fltree,A=v.fdtree),C==2){l.F.makeCodes(v.ltree,g),l.F.revCodes(v.ltree,g),l.F.makeCodes(v.dtree,T),l.F.revCodes(v.dtree,T),l.F.makeCodes(v.itree,k),l.F.revCodes(v.itree,k),p=v.ltree,A=v.dtree,h(r,s,S-257),h(r,s+=5,B-1),h(r,s+=5,N-4),s+=4;for(var f=0;f<N;f++)h(r,s+3*f,v.itree[1+(v.ordr[f]<<1)]);s+=3*N,s=l.F._codeTiny(D,v.itree,r,s),s=l.F._codeTiny(P,v.itree,r,s)}for(var o=x,M=0;M<a;M+=2){for(var F=t[M],O=F>>>23,$=o+(8388607&F);o<$;)s=l.F._writeLit(y[o++],p,r,s);if(O!=0){var W=t[M+1],G=W>>16,q=W>>8&255,R=255&W;h(r,s=l.F._writeLit(257+q,p,r,s),O-v.of0[q]),s+=v.exb[q],_(r,s=l.F._writeLit(R,A,r,s),G-v.df0[R]),s+=v.dxb[R],o+=O}}s=l.F._writeLit(256,p,r,s)}return s},l.F._copyExact=function(e,t,a,c,y){var x=y>>>3;return c[x]=a,c[x+1]=a>>>8,c[x+2]=255-c[x],c[x+3]=255-c[x+1],x+=4,c.set(new Uint8Array(e.buffer,t,a),x),y+(a+4<<3)},l.F.getTrees=function(){for(var e=l.F.U,t=l.F._hufTree(e.lhst,e.ltree,15),a=l.F._hufTree(e.dhst,e.dtree,15),c=[],y=l.F._lenCodes(e.ltree,c),x=[],n=l.F._lenCodes(e.dtree,x),r=0;r<c.length;r+=2)e.ihst[c[r]]++;for(r=0;r<x.length;r+=2)e.ihst[x[r]]++;for(var s=l.F._hufTree(e.ihst,e.itree,7),d=19;d>4&&e.itree[1+(e.ordr[d-1]<<1)]==0;)d--;return[t,a,s,y,n,d,c,x]},l.F.getSecond=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(e[a+1]);return t},l.F.nonZero=function(e){for(var t="",a=0;a<e.length;a+=2)e[a+1]!=0&&(t+=(a>>1)+",");return t},l.F.contSize=function(e,t){for(var a=0,c=0;c<t.length;c++)a+=t[c]*e[1+(c<<1)];return a},l.F._codeTiny=function(e,t,a,c){for(var y=0;y<e.length;y+=2){var x=e[y],n=e[y+1];c=l.F._writeLit(x,t,a,c);var r=x==16?2:x==17?3:7;x>15&&(l.F._putsE(a,c,n,r),c+=r)}return c},l.F._lenCodes=function(e,t){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var c=0;c<a;c+=2){var y=e[c+1],x=c+3<a?e[c+3]:-1,n=c+5<a?e[c+5]:-1,r=c==0?-1:e[c-1];if(y==0&&x==y&&n==y){for(var s=c+5;s+2<a&&e[s+2]==y;)s+=2;(d=Math.min(s+1-c>>>1,138))<11?t.push(17,d-3):t.push(18,d-11),c+=2*d-2}else if(y==r&&x==y&&n==y){for(s=c+5;s+2<a&&e[s+2]==y;)s+=2;var d=Math.min(s+1-c>>>1,6);t.push(16,d-3),c+=2*d-2}else t.push(y,0)}return a>>>1},l.F._hufTree=function(e,t,a){var c=[],y=e.length,x=t.length,n=0;for(n=0;n<x;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<y;n++)e[n]!=0&&c.push({lit:n,f:e[n]});var r=c.length,s=c.slice(0);if(r==0)return 0;if(r==1){var d=c[0].lit;return s=d==0?1:0,t[1+(d<<1)]=1,t[1+(s<<1)]=1,1}c.sort(function(D,P){return D.f-P.f});var g=c[0],T=c[1],k=0,S=1,B=2;for(c[0]={lit:-1,f:g.f+T.f,l:g,r:T,d:0};S!=r-1;)g=k!=S&&(B==r||c[k].f<c[B].f)?c[k++]:c[B++],T=k!=S&&(B==r||c[k].f<c[B].f)?c[k++]:c[B++],c[S++]={lit:-1,f:g.f+T.f,l:g,r:T};var N=l.F.setDepth(c[S-1],0);for(N>a&&(l.F.restrictDepth(s,a,N),N=a),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return N},l.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(l.F.setDepth(e.l,t+1),l.F.setDepth(e.r,t+1))},l.F.restrictDepth=function(e,t,a){var c=0,y=1<<a-t,x=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),c=0;c<e.length&&e[c].d>t;c++){var n=e[c].d;e[c].d=t,x+=y-(1<<a-n)}for(x>>>=a-t;x>0;)(n=e[c].d)<t?(e[c].d++,x-=1<<t-n-1):c++;for(;c>=0;c--)e[c].d==t&&x<0&&(e[c].d--,x++);x!=0&&console.log("debt left")},l.F._goodIndex=function(e,t){var a=0;return t[16|a]<=e&&(a|=16),t[8|a]<=e&&(a|=8),t[4|a]<=e&&(a|=4),t[2|a]<=e&&(a|=2),t[1|a]<=e&&(a|=1),a},l.F._writeLit=function(e,t,a,c){return l.F._putsF(a,c,t[e<<1]),c+t[1+(e<<1)]},l.F.inflate=function(e,t){var a=Uint8Array;if(e[0]==3&&e[1]==0)return t||new a(0);var c=l.F,y=c._bitsF,x=c._bitsE,n=c._decodeTiny,r=c.makeCodes,s=c.codes2map,d=c._get17,g=c.U,T=t==null;T&&(t=new a(e.length>>>2<<3));for(var k,S,B=0,N=0,D=0,P=0,v=0,_=0,h=0,u=0,m=0;B==0;)if(B=y(e,m,1),N=y(e,m+1,2),m+=3,N!=0){if(T&&(t=l.F._check(t,u+(1<<17))),N==1&&(k=g.flmap,S=g.fdmap,_=511,h=31),N==2){D=x(e,m,5)+257,P=x(e,m+5,5)+1,v=x(e,m+10,4)+4,m+=14;for(var j=0;j<38;j+=2)g.itree[j]=0,g.itree[j+1]=0;var w=1;for(j=0;j<v;j++){var C=x(e,m+3*j,3);g.itree[1+(g.ordr[j]<<1)]=C,C>w&&(w=C)}m+=3*v,r(g.itree,w),s(g.itree,w,g.imap),k=g.lmap,S=g.dmap,m=n(g.imap,(1<<w)-1,D+P,e,m,g.ttree);var p=c._copyOut(g.ttree,0,D,g.ltree);_=(1<<p)-1;var A=c._copyOut(g.ttree,D,P,g.dtree);h=(1<<A)-1,r(g.ltree,p),s(g.ltree,p,k),r(g.dtree,A),s(g.dtree,A,S)}for(;;){var f=k[d(e,m)&_];m+=15&f;var o=f>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var M=u+o-254;if(o>264){var F=g.ldef[o-257];M=u+(F>>>3)+x(e,m,7&F),m+=7&F}var O=S[d(e,m)&h];m+=15&O;var $=O>>>4,W=g.ddef[$],G=(W>>>4)+y(e,m,15&W);for(m+=15&W,T&&(t=l.F._check(t,u+(1<<17)));u<M;)t[u]=t[u++-G],t[u]=t[u++-G],t[u]=t[u++-G],t[u]=t[u++-G];u=M}}}else{(7&m)!=0&&(m+=8-(7&m));var q=4+(m>>>3),R=e[q-4]|e[q-3]<<8;T&&(t=l.F._check(t,u+R)),t.set(new a(e.buffer,e.byteOffset+q,R),u),m=q+R<<3,u+=R}return t.length==u?t:t.slice(0,u)},l.F._check=function(e,t){var a=e.length;if(t<=a)return e;var c=new Uint8Array(Math.max(a<<1,t));return c.set(e,0),c},l.F._decodeTiny=function(e,t,a,c,y,x){for(var n=l.F._bitsE,r=l.F._get17,s=0;s<a;){var d=e[r(c,y)&t];y+=15&d;var g=d>>>4;if(g<=15)x[s]=g,s++;else{var T=0,k=0;g==16?(k=3+n(c,y,2),y+=2,T=x[s-1]):g==17?(k=3+n(c,y,3),y+=3):g==18&&(k=11+n(c,y,7),y+=7);for(var S=s+k;s<S;)x[s]=T,s++}}return y},l.F._copyOut=function(e,t,a,c){for(var y=0,x=0,n=c.length>>>1;x<a;){var r=e[x+t];c[x<<1]=0,c[1+(x<<1)]=r,r>y&&(y=r),x++}for(;x<n;)c[x<<1]=0,c[1+(x<<1)]=0,x++;return y},l.F.makeCodes=function(e,t){for(var a,c,y,x,n=l.F.U,r=e.length,s=n.bl_count,d=0;d<=t;d++)s[d]=0;for(d=1;d<r;d+=2)s[e[d]]++;var g=n.next_code;for(a=0,s[0]=0,c=1;c<=t;c++)a=a+s[c-1]<<1,g[c]=a;for(y=0;y<r;y+=2)(x=e[y+1])!=0&&(e[y]=g[x],g[x]++)},l.F.codes2map=function(e,t,a){for(var c=e.length,y=l.F.U.rev15,x=0;x<c;x+=2)if(e[x+1]!=0)for(var n=x>>1,r=e[x+1],s=n<<4|r,d=t-r,g=e[x]<<d,T=g+(1<<d);g!=T;)a[y[g]>>>15-t]=s,g++},l.F.revCodes=function(e,t){for(var a=l.F.U.rev15,c=15-t,y=0;y<e.length;y+=2){var x=e[y]<<t-e[y+1];e[y]=a[x]>>>c}},l.F._putsE=function(e,t,a){a<<=7&t;var c=t>>>3;e[c]|=a,e[c+1]|=a>>>8},l.F._putsF=function(e,t,a){a<<=7&t;var c=t>>>3;e[c]|=a,e[c+1]|=a>>>8,e[c+2]|=a>>>16},l.F._bitsE=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<a)-1},l.F._bitsF=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<a)-1},l.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},l.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},l.F.U=(I=Uint16Array,E=Uint32Array,{next_code:new I(16),bl_count:new I(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new I(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new E(32),flmap:new I(512),fltree:[],fdmap:new I(32),fdtree:[],lmap:new I(32768),ltree:[],ttree:[],dmap:new I(32768),dtree:[],imap:new I(512),itree:[],rev15:new I(32768),lhst:new E(286),dhst:new E(30),ihst:new E(19),lits:new E(15e3),strt:new I(65536),prev:new I(32768)}),function(){for(var e=l.F.U,t=0;t<32768;t++){var a=t;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[t]=(a>>>16|a<<16)>>>17}function c(y,x,n){for(;x--!=0;)y.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];c(e.fltree,144,8),c(e.fltree,112,9),c(e.fltree,24,7),c(e.fltree,8,8),l.F.makeCodes(e.fltree,9),l.F.codes2map(e.fltree,9,e.flmap),l.F.revCodes(e.fltree,9),c(e.fdtree,32,5),l.F.makeCodes(e.fdtree,5),l.F.codes2map(e.fdtree,5,e.fdmap),l.F.revCodes(e.fdtree,5),c(e.itree,19,0),c(e.ltree,286,0),c(e.dtree,30,0),c(e.ttree,320,0)}()})();var Hs=Bs({__proto__:null,default:_t},[_t]);const Be=function(){var b={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let d="";for(let g=0;g<s;g++)d+=String.fromCharCode(n[r+g]);return d},writeASCII(n,r,s){for(let d=0;d<s.length;d++)n[r+d]=s.charCodeAt(d)},readBytes(n,r,s){const d=[];for(let g=0;g<s;g++)d.push(n[r+g]);return d},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let d,g="";for(let T=0;T<s;T++)g+=`%${b.pad(n[r+T].toString(16))}`;try{d=decodeURIComponent(g)}catch{return b.readASCII(n,r,s)}return d}};function I(n,r,s,d){const g=r*s,T=t(d),k=Math.ceil(r*T/8),S=new Uint8Array(4*g),B=new Uint32Array(S.buffer),{ctype:N}=d,{depth:D}=d,P=b.readUshort;if(N==6){const F=g<<2;if(D==8)for(var v=0;v<F;v+=4)S[v]=n[v],S[v+1]=n[v+1],S[v+2]=n[v+2],S[v+3]=n[v+3];if(D==16)for(v=0;v<F;v++)S[v]=n[v<<1]}else if(N==2){const F=d.tabs.tRNS;if(F==null){if(D==8)for(v=0;v<g;v++){var _=3*v;B[v]=255<<24|n[_+2]<<16|n[_+1]<<8|n[_]}if(D==16)for(v=0;v<g;v++)_=6*v,B[v]=255<<24|n[_+4]<<16|n[_+2]<<8|n[_]}else{var h=F[0];const O=F[1],$=F[2];if(D==8)for(v=0;v<g;v++){var u=v<<2;_=3*v,B[v]=255<<24|n[_+2]<<16|n[_+1]<<8|n[_],n[_]==h&&n[_+1]==O&&n[_+2]==$&&(S[u+3]=0)}if(D==16)for(v=0;v<g;v++)u=v<<2,_=6*v,B[v]=255<<24|n[_+4]<<16|n[_+2]<<8|n[_],P(n,_)==h&&P(n,_+2)==O&&P(n,_+4)==$&&(S[u+3]=0)}}else if(N==3){const F=d.tabs.PLTE,O=d.tabs.tRNS,$=O?O.length:0;if(D==1)for(var m=0;m<s;m++){var j=m*k,w=m*r;for(v=0;v<r;v++){u=w+v<<2;var C=3*(p=n[j+(v>>3)]>>7-((7&v)<<0)&1);S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=p<$?O[p]:255}}if(D==2)for(m=0;m<s;m++)for(j=m*k,w=m*r,v=0;v<r;v++)u=w+v<<2,C=3*(p=n[j+(v>>2)]>>6-((3&v)<<1)&3),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=p<$?O[p]:255;if(D==4)for(m=0;m<s;m++)for(j=m*k,w=m*r,v=0;v<r;v++)u=w+v<<2,C=3*(p=n[j+(v>>1)]>>4-((1&v)<<2)&15),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=p<$?O[p]:255;if(D==8)for(v=0;v<g;v++){var p;u=v<<2,C=3*(p=n[v]),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=p<$?O[p]:255}}else if(N==4){if(D==8)for(v=0;v<g;v++){u=v<<2;var A=n[f=v<<1];S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+1]}if(D==16)for(v=0;v<g;v++){var f;u=v<<2,A=n[f=v<<2],S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+2]}}else if(N==0)for(h=d.tabs.tRNS?d.tabs.tRNS:-1,m=0;m<s;m++){const F=m*k,O=m*r;if(D==1)for(var o=0;o<r;o++){var M=(A=255*(n[F+(o>>>3)]>>>7-(7&o)&1))==255*h?0:255;B[O+o]=M<<24|A<<16|A<<8|A}else if(D==2)for(o=0;o<r;o++)M=(A=85*(n[F+(o>>>2)]>>>6-((3&o)<<1)&3))==85*h?0:255,B[O+o]=M<<24|A<<16|A<<8|A;else if(D==4)for(o=0;o<r;o++)M=(A=17*(n[F+(o>>>1)]>>>4-((1&o)<<2)&15))==17*h?0:255,B[O+o]=M<<24|A<<16|A<<8|A;else if(D==8)for(o=0;o<r;o++)M=(A=n[F+o])==h?0:255,B[O+o]=M<<24|A<<16|A<<8|A;else if(D==16)for(o=0;o<r;o++)A=n[F+(o<<1)],M=P(n,F+(o<<1))==h?0:255,B[O+o]=M<<24|A<<16|A<<8|A}return S}function E(n,r,s,d){const g=t(n),T=Math.ceil(s*g/8),k=new Uint8Array((T+1+n.interlace)*d);return r=n.tabs.CgBI?e(r,k):l(r,k),n.interlace==0?r=a(r,n,0,s,d):n.interlace==1&&(r=function(B,N){const D=N.width,P=N.height,v=t(N),_=v>>3,h=Math.ceil(D*v/8),u=new Uint8Array(P*h);let m=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const o=C[A],M=p[A];let F=0,O=0,$=j[A];for(;$<P;)$+=o,O++;let W=w[A];for(;W<D;)W+=M,F++;const G=Math.ceil(F*v/8);a(B,N,m,F,O);let q=0,R=j[A];for(;R<P;){let K=w[A],se=m+q*G<<3;for(;K<D;){var f;if(v==1&&(f=(f=B[se>>3])>>7-(7&se)&1,u[R*h+(K>>3)]|=f<<7-((7&K)<<0)),v==2&&(f=(f=B[se>>3])>>6-(7&se)&3,u[R*h+(K>>2)]|=f<<6-((3&K)<<1)),v==4&&(f=(f=B[se>>3])>>4-(7&se)&15,u[R*h+(K>>1)]|=f<<4-((1&K)<<2)),v>=8){const te=R*h+K*_;for(let X=0;X<_;X++)u[te+X]=B[(se>>3)+X]}se+=v,K+=M}q++,R+=o}F*O!=0&&(m+=O*(1+G)),A+=1}return u}(r,n)),r}function l(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const d=Uint8Array;let g,T,k=0,S=0,B=0,N=0,D=0,P=0,v=0,_=0,h=0;if(r[0]==3&&r[1]==0)return s||new d(0);const u=n.H,m=u.b,j=u.e,w=u.R,C=u.n,p=u.A,A=u.Z,f=u.m,o=s==null;for(o&&(s=new d(r.length>>>2<<5));k==0;)if(k=m(r,h,1),S=m(r,h+1,2),h+=3,S!=0){if(o&&(s=n.H.W(s,_+(1<<17))),S==1&&(g=f.J,T=f.h,P=511,v=31),S==2){B=j(r,h,5)+257,N=j(r,h+5,5)+1,D=j(r,h+10,4)+4,h+=14;let F=1;for(var M=0;M<38;M+=2)f.Q[M]=0,f.Q[M+1]=0;for(M=0;M<D;M++){const W=j(r,h+3*M,3);f.Q[1+(f.X[M]<<1)]=W,W>F&&(F=W)}h+=3*D,C(f.Q,F),p(f.Q,F,f.u),g=f.w,T=f.d,h=w(f.u,(1<<F)-1,B+N,r,h,f.v);const O=u.V(f.v,0,B,f.C);P=(1<<O)-1;const $=u.V(f.v,B,N,f.D);v=(1<<$)-1,C(f.C,O),p(f.C,O,g),C(f.D,$),p(f.D,$,T)}for(;;){const F=g[A(r,h)&P];h+=15&F;const O=F>>>4;if(!(O>>>8))s[_++]=O;else{if(O==256)break;{let $=_+O-254;if(O>264){const K=f.q[O-257];$=_+(K>>>3)+j(r,h,7&K),h+=7&K}const W=T[A(r,h)&v];h+=15&W;const G=W>>>4,q=f.c[G],R=(q>>>4)+m(r,h,15&q);for(h+=15&q;_<$;)s[_]=s[_++-R],s[_]=s[_++-R],s[_]=s[_++-R],s[_]=s[_++-R];_=$}}}}else{(7&h)!=0&&(h+=8-(7&h));const F=4+(h>>>3),O=r[F-4]|r[F-3]<<8;o&&(s=n.H.W(s,_+O)),s.set(new d(r.buffer,r.byteOffset+F,O),_),h=F+O<<3,_+=O}return s.length==_?s:s.slice(0,_)},n.H.W=function(r,s){const d=r.length;if(s<=d)return r;const g=new Uint8Array(d<<1);return g.set(r,0),g},n.H.R=function(r,s,d,g,T,k){const S=n.H.e,B=n.H.Z;let N=0;for(;N<d;){const D=r[B(g,T)&s];T+=15&D;const P=D>>>4;if(P<=15)k[N]=P,N++;else{let v=0,_=0;P==16?(_=3+S(g,T,2),T+=2,v=k[N-1]):P==17?(_=3+S(g,T,3),T+=3):P==18&&(_=11+S(g,T,7),T+=7);const h=N+_;for(;N<h;)k[N]=v,N++}}return T},n.H.V=function(r,s,d,g){let T=0,k=0;const S=g.length>>>1;for(;k<d;){const B=r[k+s];g[k<<1]=0,g[1+(k<<1)]=B,B>T&&(T=B),k++}for(;k<S;)g[k<<1]=0,g[1+(k<<1)]=0,k++;return T},n.H.n=function(r,s){const d=n.H.m,g=r.length;let T,k,S,B;const N=d.j;for(var D=0;D<=s;D++)N[D]=0;for(D=1;D<g;D+=2)N[r[D]]++;const P=d.K;for(T=0,N[0]=0,k=1;k<=s;k++)T=T+N[k-1]<<1,P[k]=T;for(S=0;S<g;S+=2)B=r[S+1],B!=0&&(r[S]=P[B],P[B]++)},n.H.A=function(r,s,d){const g=r.length,T=n.H.m.r;for(let k=0;k<g;k+=2)if(r[k+1]!=0){const S=k>>1,B=r[k+1],N=S<<4|B,D=s-B;let P=r[k]<<D;const v=P+(1<<D);for(;P!=v;)d[T[P]>>>15-s]=N,P++}},n.H.l=function(r,s){const d=n.H.m.r,g=15-s;for(let T=0;T<r.length;T+=2){const k=r[T]<<s-r[T+1];r[T]=d[k]>>>g}},n.H.M=function(r,s,d){d<<=7&s;const g=s>>>3;r[g]|=d,r[g+1]|=d>>>8},n.H.I=function(r,s,d){d<<=7&s;const g=s>>>3;r[g]|=d,r[g+1]|=d>>>8,r[g+2]|=d>>>16},n.H.e=function(r,s,d){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<d)-1},n.H.b=function(r,s,d){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<d)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let g=s;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,r.r[s]=(g>>>16|g<<16)>>>17}function d(g,T,k){for(;T--!=0;)g.push(0,k)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];d(r._,144,8),d(r._,112,9),d(r._,24,7),d(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),d(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),d(r.Q,19,0),d(r.C,286,0),d(r.D,30,0),d(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function a(n,r,s,d,g){let T=t(r);const k=Math.ceil(d*T/8);let S,B;T=Math.ceil(T/8);let N=n[s],D=0;if(N>1&&(n[s]=[0,0,1][N-2]),N==3)for(D=T;D<k;D++)n[D+1]=n[D+1]+(n[D+1-T]>>>1)&255;for(let P=0;P<g;P++)if(S=s+P*k,B=S+P+1,N=n[B-1],D=0,N==0)for(;D<k;D++)n[S+D]=n[B+D];else if(N==1){for(;D<T;D++)n[S+D]=n[B+D];for(;D<k;D++)n[S+D]=n[B+D]+n[S+D-T]}else if(N==2)for(;D<k;D++)n[S+D]=n[B+D]+n[S+D-k];else if(N==3){for(;D<T;D++)n[S+D]=n[B+D]+(n[S+D-k]>>>1);for(;D<k;D++)n[S+D]=n[B+D]+(n[S+D-k]+n[S+D-T]>>>1)}else{for(;D<T;D++)n[S+D]=n[B+D]+c(0,n[S+D-k],0);for(;D<k;D++)n[S+D]=n[B+D]+c(n[S+D-T],n[S+D-k],n[S+D-T-k])}return n}function c(n,r,s){const d=n+r-s,g=d-n,T=d-r,k=d-s;return g*g<=T*T&&g*g<=k*k?n:T*T<=k*k?r:s}function y(n,r,s){s.width=b.readUint(n,r),r+=4,s.height=b.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function x(n,r,s,d,g,T,k,S,B){const N=Math.min(r,g),D=Math.min(s,T);let P=0,v=0;for(let A=0;A<D;A++)for(let f=0;f<N;f++)if(k>=0&&S>=0?(P=A*r+f<<2,v=(S+A)*g+k+f<<2):(P=(-S+A)*r-k+f<<2,v=A*g+f<<2),B==0)d[v]=n[P],d[v+1]=n[P+1],d[v+2]=n[P+2],d[v+3]=n[P+3];else if(B==1){var _=n[P+3]*.00392156862745098,h=n[P]*_,u=n[P+1]*_,m=n[P+2]*_,j=d[v+3]*(1/255),w=d[v]*j,C=d[v+1]*j,p=d[v+2]*j;const o=1-_,M=_+j*o,F=M==0?0:1/M;d[v+3]=255*M,d[v+0]=(h+w*o)*F,d[v+1]=(u+C*o)*F,d[v+2]=(m+p*o)*F}else if(B==2)_=n[P+3],h=n[P],u=n[P+1],m=n[P+2],j=d[v+3],w=d[v],C=d[v+1],p=d[v+2],_==j&&h==w&&u==C&&m==p?(d[v]=0,d[v+1]=0,d[v+2]=0,d[v+3]=0):(d[v]=h,d[v+1]=u,d[v+2]=m,d[v+3]=_);else if(B==3){if(_=n[P+3],h=n[P],u=n[P+1],m=n[P+2],j=d[v+3],w=d[v],C=d[v+1],p=d[v+2],_==j&&h==w&&u==C&&m==p)continue;if(_<220&&j>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let d=8;const g=b,T=g.readUshort,k=g.readUint,S={tabs:{},frames:[]},B=new Uint8Array(s.length);let N,D=0,P=0;const v=[137,80,78,71,13,10,26,10];for(var _=0;_<8;_++)if(s[_]!=v[_])throw"The input is not a PNG file!";for(;d<s.length;){const A=g.readUint(s,d);d+=4;const f=g.readASCII(s,d,4);if(d+=4,f=="IHDR")y(s,d,S);else if(f=="iCCP"){for(var h=d;s[h]!=0;)h++;g.readASCII(s,d,h-d),s[h+1];const o=s.slice(h+2,d+A);let M=null;try{M=l(o)}catch{M=e(o)}S.tabs[f]=M}else if(f=="CgBI")S.tabs[f]=s.slice(d,d+4);else if(f=="IDAT"){for(_=0;_<A;_++)B[D+_]=s[d+_];D+=A}else if(f=="acTL")S.tabs[f]={num_frames:k(s,d),num_plays:k(s,d+4)},N=new Uint8Array(s.length);else if(f=="fcTL"){P!=0&&((p=S.frames[S.frames.length-1]).data=E(S,N.slice(0,P),p.rect.width,p.rect.height),P=0);const o={x:k(s,d+12),y:k(s,d+16),width:k(s,d+4),height:k(s,d+8)};let M=T(s,d+22);M=T(s,d+20)/(M==0?100:M);const F={rect:o,delay:Math.round(1e3*M),dispose:s[d+24],blend:s[d+25]};S.frames.push(F)}else if(f=="fdAT"){for(_=0;_<A-4;_++)N[P+_]=s[d+_+4];P+=A-4}else if(f=="pHYs")S.tabs[f]=[g.readUint(s,d),g.readUint(s,d+4),s[d+8]];else if(f=="cHRM")for(S.tabs[f]=[],_=0;_<8;_++)S.tabs[f].push(g.readUint(s,d+4*_));else if(f=="tEXt"||f=="zTXt"){S.tabs[f]==null&&(S.tabs[f]={});var u=g.nextZero(s,d),m=g.readASCII(s,d,u-d),j=d+A-u-1;if(f=="tEXt")C=g.readASCII(s,u+1,j);else{var w=l(s.slice(u+2,u+2+j));C=g.readUTF8(w,0,w.length)}S.tabs[f][m]=C}else if(f=="iTXt"){S.tabs[f]==null&&(S.tabs[f]={}),u=0,h=d,u=g.nextZero(s,h),m=g.readASCII(s,h,u-h);const o=s[h=u+1];var C;s[h+1],h+=2,u=g.nextZero(s,h),g.readASCII(s,h,u-h),h=u+1,u=g.nextZero(s,h),g.readUTF8(s,h,u-h),j=A-((h=u+1)-d),o==0?C=g.readUTF8(s,h,j):(w=l(s.slice(h,h+j)),C=g.readUTF8(w,0,w.length)),S.tabs[f][m]=C}else if(f=="PLTE")S.tabs[f]=g.readBytes(s,d,A);else if(f=="hIST"){const o=S.tabs.PLTE.length/3;for(S.tabs[f]=[],_=0;_<o;_++)S.tabs[f].push(T(s,d+2*_))}else if(f=="tRNS")S.ctype==3?S.tabs[f]=g.readBytes(s,d,A):S.ctype==0?S.tabs[f]=T(s,d):S.ctype==2&&(S.tabs[f]=[T(s,d),T(s,d+2),T(s,d+4)]);else if(f=="gAMA")S.tabs[f]=g.readUint(s,d)/1e5;else if(f=="sRGB")S.tabs[f]=s[d];else if(f=="bKGD")S.ctype==0||S.ctype==4?S.tabs[f]=[T(s,d)]:S.ctype==2||S.ctype==6?S.tabs[f]=[T(s,d),T(s,d+2),T(s,d+4)]:S.ctype==3&&(S.tabs[f]=s[d]);else if(f=="IEND")break;d+=A,g.readUint(s,d),d+=4}var p;return P!=0&&((p=S.frames[S.frames.length-1]).data=E(S,N.slice(0,P),p.rect.width,p.rect.height)),S.data=E(S,B,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(r){const s=r.width,d=r.height;if(r.tabs.acTL==null)return[I(r.data,s,d,r).buffer];const g=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const T=s*d*4,k=new Uint8Array(T),S=new Uint8Array(T),B=new Uint8Array(T);for(let D=0;D<r.frames.length;D++){const P=r.frames[D],v=P.rect.x,_=P.rect.y,h=P.rect.width,u=P.rect.height,m=I(P.data,h,u,r);if(D!=0)for(var N=0;N<T;N++)B[N]=k[N];if(P.blend==0?x(m,h,u,k,s,d,v,_,0):P.blend==1&&x(m,h,u,k,s,d,v,_,1),g.push(k.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)x(S,h,u,k,s,d,v,_,0);else if(P.dispose==2)for(N=0;N<T;N++)k[N]=B[N]}}return g},_paeth:c,_copyTile:x,_bin:b}}();(function(){const{_copyTile:b}=Be,{_bin:I}=Be,E=Be._paeth;var l={table:function(){const h=new Uint32Array(256);for(let u=0;u<256;u++){let m=u;for(let j=0;j<8;j++)1&m?m=3988292384^m>>>1:m>>>=1;h[u]=m}return h}(),update(h,u,m,j){for(let w=0;w<j;w++)h=l.table[255&(h^u[m+w])]^h>>>8;return h},crc:(h,u,m)=>4294967295^l.update(4294967295,h,u,m)};function e(h,u,m,j){u[m]+=h[0]*j>>4,u[m+1]+=h[1]*j>>4,u[m+2]+=h[2]*j>>4,u[m+3]+=h[3]*j>>4}function t(h){return Math.max(0,Math.min(255,h))}function a(h,u){const m=h[0]-u[0],j=h[1]-u[1],w=h[2]-u[2],C=h[3]-u[3];return m*m+j*j+w*w+C*C}function c(h,u,m,j,w,C,p){p==null&&(p=1);const A=j.length,f=[];for(var o=0;o<A;o++){const R=j[o];f.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(o=0;o<A;o++){let R=4294967295;for(var M=0,F=0;F<A;F++){var O=a(f[o],f[F]);F!=o&&O<R&&(R=O,M=F)}}const $=new Uint32Array(w.buffer),W=new Int16Array(u*m*4),G=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<G.length;o++)G[o]=255*((G[o]+.5)/16-.5);for(let R=0;R<m;R++)for(let K=0;K<u;K++){var q;o=4*(R*u+K),p!=2?q=[t(h[o]+W[o]),t(h[o+1]+W[o+1]),t(h[o+2]+W[o+2]),t(h[o+3]+W[o+3])]:(O=G[4*(3&R)+(3&K)],q=[t(h[o]+O),t(h[o+1]+O),t(h[o+2]+O),t(h[o+3]+O)]),M=0;let se=16777215;for(F=0;F<A;F++){const ie=a(q,f[F]);ie<se&&(se=ie,M=F)}const te=f[M],X=[q[0]-te[0],q[1]-te[1],q[2]-te[2],q[3]-te[3]];p==1&&(K!=u-1&&e(X,W,o+4,7),R!=m-1&&(K!=0&&e(X,W,o+4*u-4,3),e(X,W,o+4*u,5),K!=u-1&&e(X,W,o+4*u+4,1))),C[o>>2]=M,$[o>>2]=j[M]}}function y(h,u,m,j,w){w==null&&(w={});const{crc:C}=l,p=I.writeUint,A=I.writeUshort,f=I.writeASCII;let o=8;const M=h.frames.length>1;let F,O=!1,$=33+(M?20:0);if(w.sRGB!=null&&($+=13),w.pHYs!=null&&($+=21),w.iCCP!=null&&(F=pako.deflate(w.iCCP),$+=21+F.length+4),h.ctype==3){for(var W=h.plte.length,G=0;G<W;G++)h.plte[G]>>>24!=255&&(O=!0);$+=8+3*W+4+(O?8+1*W+4:0)}for(var q=0;q<h.frames.length;q++)M&&($+=38),$+=(te=h.frames[q]).cimg.length+12,q!=0&&($+=4);$+=12;const R=new Uint8Array($),K=[137,80,78,71,13,10,26,10];for(G=0;G<8;G++)R[G]=K[G];if(p(R,o,13),o+=4,f(R,o,"IHDR"),o+=4,p(R,o,u),o+=4,p(R,o,m),o+=4,R[o]=h.depth,o++,R[o]=h.ctype,o++,R[o]=0,o++,R[o]=0,o++,R[o]=0,o++,p(R,o,C(R,o-17,17)),o+=4,w.sRGB!=null&&(p(R,o,1),o+=4,f(R,o,"sRGB"),o+=4,R[o]=w.sRGB,o++,p(R,o,C(R,o-5,5)),o+=4),w.iCCP!=null){const X=13+F.length;p(R,o,X),o+=4,f(R,o,"iCCP"),o+=4,f(R,o,"ICC profile"),o+=11,o+=2,R.set(F,o),o+=F.length,p(R,o,C(R,o-(X+4),X+4)),o+=4}if(w.pHYs!=null&&(p(R,o,9),o+=4,f(R,o,"pHYs"),o+=4,p(R,o,w.pHYs[0]),o+=4,p(R,o,w.pHYs[1]),o+=4,R[o]=w.pHYs[2],o++,p(R,o,C(R,o-13,13)),o+=4),M&&(p(R,o,8),o+=4,f(R,o,"acTL"),o+=4,p(R,o,h.frames.length),o+=4,p(R,o,w.loop!=null?w.loop:0),o+=4,p(R,o,C(R,o-12,12)),o+=4),h.ctype==3){for(p(R,o,3*(W=h.plte.length)),o+=4,f(R,o,"PLTE"),o+=4,G=0;G<W;G++){const X=3*G,ie=h.plte[G],ee=255&ie,ce=ie>>>8&255,_e=ie>>>16&255;R[o+X+0]=ee,R[o+X+1]=ce,R[o+X+2]=_e}if(o+=3*W,p(R,o,C(R,o-3*W-4,3*W+4)),o+=4,O){for(p(R,o,W),o+=4,f(R,o,"tRNS"),o+=4,G=0;G<W;G++)R[o+G]=h.plte[G]>>>24&255;o+=W,p(R,o,C(R,o-W-4,W+4)),o+=4}}let se=0;for(q=0;q<h.frames.length;q++){var te=h.frames[q];M&&(p(R,o,26),o+=4,f(R,o,"fcTL"),o+=4,p(R,o,se++),o+=4,p(R,o,te.rect.width),o+=4,p(R,o,te.rect.height),o+=4,p(R,o,te.rect.x),o+=4,p(R,o,te.rect.y),o+=4,A(R,o,j[q]),o+=2,A(R,o,1e3),o+=2,R[o]=te.dispose,o++,R[o]=te.blend,o++,p(R,o,C(R,o-30,30)),o+=4);const X=te.cimg;p(R,o,(W=X.length)+(q==0?0:4)),o+=4;const ie=o;f(R,o,q==0?"IDAT":"fdAT"),o+=4,q!=0&&(p(R,o,se++),o+=4),R.set(X,o),o+=W,p(R,o,C(R,ie,o-ie)),o+=4}return p(R,o,0),o+=4,f(R,o,"IEND"),o+=4,p(R,o,C(R,o-4,4)),o+=4,R.buffer}function x(h,u,m){for(let j=0;j<h.frames.length;j++){const w=h.frames[j];w.rect.width;const C=w.rect.height,p=new Uint8Array(C*w.bpl+C);w.cimg=d(w.img,C,w.bpp,w.bpl,p,u,m)}}function n(h,u,m,j,w){const C=w[0],p=w[1],A=w[2],f=w[3],o=w[4],M=w[5];let F=6,O=8,$=255;for(var W=0;W<h.length;W++){const pe=new Uint8Array(h[W]);for(var G=pe.length,q=0;q<G;q+=4)$&=pe[q+3]}const R=$!=255,K=function(fe,ae,ge,be,he,Fe){const oe=[];for(var de=0;de<fe.length;de++){const we=new Uint8Array(fe[de]),ne=new Uint32Array(we.buffer);var xe;let De=0,re=0,Ie=ae,ve=ge,bt=be?1:0;if(de!=0){const Pt=Fe||be||de==1||oe[de-2].dispose!=0?1:2;let xt=0,At=1e9;for(let Xe=0;Xe<Pt;Xe++){var Le=new Uint8Array(fe[de-1-Xe]);const Lt=new Uint32Array(fe[de-1-Xe]);let He=ae,Ne=ge,Me=-1,Je=-1;for(let $e=0;$e<ge;$e++)for(let We=0;We<ae;We++)ne[ye=$e*ae+We]!=Lt[ye]&&(We<He&&(He=We),We>Me&&(Me=We),$e<Ne&&(Ne=$e),$e>Je&&(Je=$e));Me==-1&&(He=Ne=Me=Je=0),he&&((1&He)==1&&He--,(1&Ne)==1&&Ne--);const Tt=(Me-He+1)*(Je-Ne+1);Tt<At&&(At=Tt,xt=Xe,De=He,re=Ne,Ie=Me-He+1,ve=Je-Ne+1)}Le=new Uint8Array(fe[de-1-xt]),xt==1&&(oe[de-1].dispose=2),xe=new Uint8Array(Ie*ve*4),b(Le,ae,ge,xe,Ie,ve,-De,-re,0),bt=b(we,ae,ge,xe,Ie,ve,-De,-re,3)?1:0,bt==1?s(we,ae,ge,xe,{x:De,y:re,width:Ie,height:ve}):b(we,ae,ge,xe,Ie,ve,-De,-re,0)}else xe=we.slice(0);oe.push({rect:{x:De,y:re,width:Ie,height:ve},img:xe,blend:bt,dispose:0})}if(be)for(de=0;de<oe.length;de++){if((le=oe[de]).blend==1)continue;const we=le.rect,ne=oe[de-1].rect,De=Math.min(we.x,ne.x),re=Math.min(we.y,ne.y),Ie={x:De,y:re,width:Math.max(we.x+we.width,ne.x+ne.width)-De,height:Math.max(we.y+we.height,ne.y+ne.height)-re};oe[de-1].dispose=1,de-1!=0&&r(fe,ae,ge,oe,de-1,Ie,he),r(fe,ae,ge,oe,de,Ie,he)}let Ve=0;if(fe.length!=1)for(var ye=0;ye<oe.length;ye++){var le;Ve+=(le=oe[ye]).rect.width*le.rect.height}return oe}(h,u,m,C,p,A),se={},te=[],X=[];if(j!=0){const pe=[];for(q=0;q<K.length;q++)pe.push(K[q].img.buffer);const fe=function(he){let Fe=0;for(var oe=0;oe<he.length;oe++)Fe+=he[oe].byteLength;const de=new Uint8Array(Fe);let xe=0;for(oe=0;oe<he.length;oe++){const Le=new Uint8Array(he[oe]),Ve=Le.length;for(let ye=0;ye<Ve;ye+=4){let le=Le[ye],we=Le[ye+1],ne=Le[ye+2];const De=Le[ye+3];De==0&&(le=we=ne=0),de[xe+ye]=le,de[xe+ye+1]=we,de[xe+ye+2]=ne,de[xe+ye+3]=De}xe+=Ve}return de.buffer}(pe),ae=T(fe,j);for(q=0;q<ae.plte.length;q++)te.push(ae.plte[q].est.rgba);let ge=0;for(q=0;q<K.length;q++){const be=(ee=K[q]).img.length;var ie=new Uint8Array(ae.inds.buffer,ge>>2,be>>2);X.push(ie);const he=new Uint8Array(ae.abuf,ge,be);M&&c(ee.img,ee.rect.width,ee.rect.height,te,he,ie),ee.img.set(he),ge+=be}}else for(W=0;W<K.length;W++){var ee=K[W];const pe=new Uint32Array(ee.img.buffer);var ce=ee.rect.width;for(G=pe.length,ie=new Uint8Array(G),X.push(ie),q=0;q<G;q++){const fe=pe[q];if(q!=0&&fe==pe[q-1])ie[q]=ie[q-1];else if(q>ce&&fe==pe[q-ce])ie[q]=ie[q-ce];else{let ae=se[fe];if(ae==null&&(se[fe]=ae=te.length,te.push(fe),te.length>=300))break;ie[q]=ae}}}const _e=te.length;for(_e<=256&&o==0&&(O=_e<=2?1:_e<=4?2:_e<=16?4:8,O=Math.max(O,f)),W=0;W<K.length;W++){(ee=K[W]).rect.x,ee.rect.y,ce=ee.rect.width;const pe=ee.rect.height;let fe=ee.img;new Uint32Array(fe.buffer);let ae=4*ce,ge=4;if(_e<=256&&o==0){ae=Math.ceil(O*ce/8);var Te=new Uint8Array(ae*pe);const be=X[W];for(let he=0;he<pe;he++){q=he*ae;const Fe=he*ce;if(O==8)for(var ue=0;ue<ce;ue++)Te[q+ue]=be[Fe+ue];else if(O==4)for(ue=0;ue<ce;ue++)Te[q+(ue>>1)]|=be[Fe+ue]<<4-4*(1&ue);else if(O==2)for(ue=0;ue<ce;ue++)Te[q+(ue>>2)]|=be[Fe+ue]<<6-2*(3&ue);else if(O==1)for(ue=0;ue<ce;ue++)Te[q+(ue>>3)]|=be[Fe+ue]<<7-1*(7&ue)}fe=Te,F=3,ge=1}else if(R==0&&K.length==1){Te=new Uint8Array(ce*pe*3);const be=ce*pe;for(q=0;q<be;q++){const he=3*q,Fe=4*q;Te[he]=fe[Fe],Te[he+1]=fe[Fe+1],Te[he+2]=fe[Fe+2]}fe=Te,F=2,ge=3,ae=3*ce}ee.img=fe,ee.bpl=ae,ee.bpp=ge}return{ctype:F,depth:O,plte:te,frames:K}}function r(h,u,m,j,w,C,p){const A=Uint8Array,f=Uint32Array,o=new A(h[w-1]),M=new f(h[w-1]),F=w+1<h.length?new A(h[w+1]):null,O=new A(h[w]),$=new f(O.buffer);let W=u,G=m,q=-1,R=-1;for(let se=0;se<C.height;se++)for(let te=0;te<C.width;te++){const X=C.x+te,ie=C.y+se,ee=ie*u+X,ce=$[ee];ce==0||j[w-1].dispose==0&&M[ee]==ce&&(F==null||F[4*ee+3]!=0)||(X<W&&(W=X),X>q&&(q=X),ie<G&&(G=ie),ie>R&&(R=ie))}q==-1&&(W=G=q=R=0),p&&((1&W)==1&&W--,(1&G)==1&&G--),C={x:W,y:G,width:q-W+1,height:R-G+1};const K=j[w];K.rect=C,K.blend=1,K.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(b(o,u,m,K.img,C.width,C.height,-C.x,-C.y,0),s(O,u,m,K.img,C)):b(O,u,m,K.img,C.width,C.height,-C.x,-C.y,0)}function s(h,u,m,j,w){b(h,u,m,j,w.width,w.height,-w.x,-w.y,2)}function d(h,u,m,j,w,C,p){const A=[];let f,o=[0,1,2,3,4];C!=-1?o=[C]:(u*j>5e5||m==1)&&(o=[0]),p&&(f={level:0});const M=Hs;for(var F=0;F<o.length;F++){for(let W=0;W<u;W++)g(w,h,W,j,m,o[F]);A.push(M.deflate(w,f))}let O,$=1e9;for(F=0;F<A.length;F++)A[F].length<$&&(O=F,$=A[F].length);return A[O]}function g(h,u,m,j,w,C){const p=m*j;let A=p+m;if(h[A]=C,A++,C==0)if(j<500)for(var f=0;f<j;f++)h[A+f]=u[p+f];else h.set(new Uint8Array(u.buffer,p,j),A);else if(C==1){for(f=0;f<w;f++)h[A+f]=u[p+f];for(f=w;f<j;f++)h[A+f]=u[p+f]-u[p+f-w]+256&255}else if(m==0){for(f=0;f<w;f++)h[A+f]=u[p+f];if(C==2)for(f=w;f<j;f++)h[A+f]=u[p+f];if(C==3)for(f=w;f<j;f++)h[A+f]=u[p+f]-(u[p+f-w]>>1)+256&255;if(C==4)for(f=w;f<j;f++)h[A+f]=u[p+f]-E(u[p+f-w],0,0)+256&255}else{if(C==2)for(f=0;f<j;f++)h[A+f]=u[p+f]+256-u[p+f-j]&255;if(C==3){for(f=0;f<w;f++)h[A+f]=u[p+f]+256-(u[p+f-j]>>1)&255;for(f=w;f<j;f++)h[A+f]=u[p+f]+256-(u[p+f-j]+u[p+f-w]>>1)&255}if(C==4){for(f=0;f<w;f++)h[A+f]=u[p+f]+256-E(0,u[p+f-j],0)&255;for(f=w;f<j;f++)h[A+f]=u[p+f]+256-E(u[p+f-w],u[p+f-j],u[p+f-w-j])&255}}}function T(h,u){const m=new Uint8Array(h),j=m.slice(0),w=new Uint32Array(j.buffer),C=k(j,u),p=C[0],A=C[1],f=m.length,o=new Uint8Array(f>>2);let M;if(m.length<2e7)for(var F=0;F<f;F+=4)M=S(p,O=m[F]*(1/255),$=m[F+1]*(1/255),W=m[F+2]*(1/255),G=m[F+3]*(1/255)),o[F>>2]=M.ind,w[F>>2]=M.est.rgba;else for(F=0;F<f;F+=4){var O=m[F]*.00392156862745098,$=m[F+1]*(1/255),W=m[F+2]*(1/255),G=m[F+3]*(1/255);for(M=p;M.left;)M=B(M.est,O,$,W,G)<=0?M.left:M.right;o[F>>2]=M.ind,w[F>>2]=M.est.rgba}return{abuf:j.buffer,inds:o,plte:A}}function k(h,u,m){m==null&&(m=1e-4);const j=new Uint32Array(h.buffer),w={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=P(h,w.i0,w.i1),w.est=v(w.bst);const C=[w];for(;C.length<u;){let A=0,f=0;for(var p=0;p<C.length;p++)C[p].est.L>A&&(A=C[p].est.L,f=p);if(A<m)break;const o=C[f],M=N(h,j,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=M||o.i1<=M){o.est.L=0;continue}const F={i0:o.i0,i1:M,bst:null,est:null,tdst:0,left:null,right:null};F.bst=P(h,F.i0,F.i1),F.est=v(F.bst);const O={i0:M,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(O.bst={R:[],m:[],N:o.bst.N-F.bst.N},p=0;p<16;p++)O.bst.R[p]=o.bst.R[p]-F.bst.R[p];for(p=0;p<4;p++)O.bst.m[p]=o.bst.m[p]-F.bst.m[p];O.est=v(O.bst),o.left=F,o.right=O,C[f]=F,C.push(O)}for(C.sort((A,f)=>f.bst.N-A.bst.N),p=0;p<C.length;p++)C[p].ind=p;return[w,C]}function S(h,u,m,j,w){if(h.left==null)return h.tdst=function(F,O,$,W,G){const q=O-F[0],R=$-F[1],K=W-F[2],se=G-F[3];return q*q+R*R+K*K+se*se}(h.est.q,u,m,j,w),h;const C=B(h.est,u,m,j,w);let p=h.left,A=h.right;C>0&&(p=h.right,A=h.left);const f=S(p,u,m,j,w);if(f.tdst<=C*C)return f;const o=S(A,u,m,j,w);return o.tdst<f.tdst?o:f}function B(h,u,m,j,w){const{e:C}=h;return C[0]*u+C[1]*m+C[2]*j+C[3]*w-h.eMq}function N(h,u,m,j,w,C){for(j-=4;m<j;){for(;D(h,m,w)<=C;)m+=4;for(;D(h,j,w)>C;)j-=4;if(m>=j)break;const p=u[m>>2];u[m>>2]=u[j>>2],u[j>>2]=p,m+=4,j-=4}for(;D(h,m,w)>C;)m-=4;return m+4}function D(h,u,m){return h[u]*m[0]+h[u+1]*m[1]+h[u+2]*m[2]+h[u+3]*m[3]}function P(h,u,m){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=m-u>>2;for(let p=u;p<m;p+=4){const A=h[p]*.00392156862745098,f=h[p+1]*(1/255),o=h[p+2]*(1/255),M=h[p+3]*(1/255);w[0]+=A,w[1]+=f,w[2]+=o,w[3]+=M,j[0]+=A*A,j[1]+=A*f,j[2]+=A*o,j[3]+=A*M,j[5]+=f*f,j[6]+=f*o,j[7]+=f*M,j[10]+=o*o,j[11]+=o*M,j[15]+=M*M}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function v(h){const{R:u}=h,{m}=h,{N:j}=h,w=m[0],C=m[1],p=m[2],A=m[3],f=j==0?0:1/j,o=[u[0]-w*w*f,u[1]-w*C*f,u[2]-w*p*f,u[3]-w*A*f,u[4]-C*w*f,u[5]-C*C*f,u[6]-C*p*f,u[7]-C*A*f,u[8]-p*w*f,u[9]-p*C*f,u[10]-p*p*f,u[11]-p*A*f,u[12]-A*w*f,u[13]-A*C*f,u[14]-A*p*f,u[15]-A*A*f],M=o,F=_;let O=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,W=0;if(j!=0)for(let q=0;q<16&&(O=F.multVec(M,O),W=Math.sqrt(F.dot(O,O)),O=F.sml(1/W,O),!(q!=0&&Math.abs(W-$)<1e-9));q++)$=W;const G=[w*f,C*f,p*f,A*f];return{Cov:o,q:G,e:O,L:$,eMq255:F.dot(F.sml(255,G),O),eMq:F.dot(O,G),rgba:(Math.round(255*G[3])<<24|Math.round(255*G[2])<<16|Math.round(255*G[1])<<8|Math.round(255*G[0])<<0)>>>0}}var _={multVec:(h,u)=>[h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],h[4]*u[0]+h[5]*u[1]+h[6]*u[2]+h[7]*u[3],h[8]*u[0]+h[9]*u[1]+h[10]*u[2]+h[11]*u[3],h[12]*u[0]+h[13]*u[1]+h[14]*u[2]+h[15]*u[3]],dot:(h,u)=>h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],sml:(h,u)=>[h*u[0],h*u[1],h*u[2],h*u[3]]};Be.encode=function(u,m,j,w,C,p,A){w==null&&(w=0),A==null&&(A=!1);const f=n(u,m,j,w,[!1,!1,!1,0,A,!1]);return x(f,-1),y(f,m,j,C,p)},Be.encodeLL=function(u,m,j,w,C,p,A,f){const o={ctype:0+(w==1?0:2)+(C==0?0:4),depth:p,frames:[]},M=(w+C)*p,F=M*m;for(let O=0;O<u.length;O++)o.frames.push({rect:{x:0,y:0,width:m,height:j},img:new Uint8Array(u[O]),blend:0,dispose:1,bpp:Math.ceil(M/8),bpl:Math.ceil(F/8)});return x(o,0,!0),y(o,m,j,A,f)},Be.encode.compress=n,Be.encode.dither=c,Be.quantize=T,Be.quantize.getKDtree=k,Be.quantize.getNearest=S})();const Wn={toArrayBuffer(b,I){const E=b.width,l=b.height,e=E<<2,t=b.getContext("2d").getImageData(0,0,E,l),a=new Uint32Array(t.data.buffer),c=(32*E+31)/32<<2,y=c*l,x=122+y,n=new ArrayBuffer(x),r=new DataView(n),s=1<<20;let d,g,T,k,S=s,B=0,N=0,D=0;function P(h){r.setUint16(N,h,!0),N+=2}function v(h){r.setUint32(N,h,!0),N+=4}function _(h){N+=h}P(19778),v(x),_(4),v(122),v(108),v(E),v(-l>>>0),P(1),P(32),v(3),v(y),v(2835),v(2835),_(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),function h(){for(;B<l&&S>0;){for(k=122+B*c,d=0;d<e;)S--,g=a[D++],T=g>>>24,r.setUint32(k+d,g<<8|T),d+=4;B++}D<a.length?(S=s,setTimeout(h,Wn._dly)):I(n)}()},toBlob(b,I){this.toArrayBuffer(b,E=>{I(new Blob([E],{type:"image/bmp"}))})},_dly:9};var Re={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ws={[Re.CHROME]:16384,[Re.FIREFOX]:11180,[Re.DESKTOP_SAFARI]:16384,[Re.IE]:8192,[Re.IOS]:4096,[Re.ETC]:8192};const gn=typeof window<"u",qn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ot=gn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),qs=(gn||qn)&&(Ot&&Ot.getOriginalSymbol(window,"File")||typeof File<"u"&&File),zn=(gn||qn)&&(Ot&&Ot.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function mn(b,I,E=Date.now()){return new Promise(l=>{const e=b.split(","),t=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let c=a.length;const y=new Uint8Array(c);for(;c--;)y[c]=a.charCodeAt(c);const x=new Blob([y],{type:t});x.name=I,x.lastModified=E,l(x)})}function $n(b){return new Promise((I,E)=>{const l=new zn;l.onload=()=>I(l.result),l.onerror=e=>E(e),l.readAsDataURL(b)})}function Qn(b){return new Promise((I,E)=>{const l=new Image;l.onload=()=>I(l),l.onerror=e=>E(e),l.src=b})}function tt(){if(tt.cachedResult!==void 0)return tt.cachedResult;let b=Re.ETC;const{userAgent:I}=navigator;return/Chrom(e|ium)/i.test(I)?b=Re.CHROME:/iP(ad|od|hone)/i.test(I)&&/WebKit/i.test(I)?b=Re.IOS:/Safari/i.test(I)?b=Re.DESKTOP_SAFARI:/Firefox/i.test(I)?b=Re.FIREFOX:(/MSIE/i.test(I)||document.documentMode)&&(b=Re.IE),tt.cachedResult=b,tt.cachedResult}function Gn(b,I){const E=tt(),l=Ws[E];let e=b,t=I,a=e*t;const c=e>t?t/e:e/t;for(;a>l*l;){const y=(l+e)/2,x=(l+t)/2;y<x?(t=x,e=x*c):(t=y*c,e=y),a=e*t}return{width:e,height:t}}function Bt(b,I){let E,l;try{if(E=new OffscreenCanvas(b,I),l=E.getContext("2d"),l===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{E=document.createElement("canvas"),l=E.getContext("2d")}return E.width=b,E.height=I,[E,l]}function Vn(b,I){const{width:E,height:l}=Gn(b.width,b.height),[e,t]=Bt(E,l);return I&&/jpe?g/.test(I)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(b,0,0,e.width,e.height),e}function kt(){return kt.cachedResult!==void 0||(kt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),kt.cachedResult}function Nt(b,I={}){return new Promise(function(E,l){let e,t;var a=function(){try{return t=Vn(e,I.fileType||b.type),E([e,t])}catch(y){return l(y)}},c=function(y){try{var x=function(n){try{throw n}catch(r){return l(r)}};try{let n;return $n(b).then(function(r){try{return n=r,Qn(n).then(function(s){try{return e=s,function(){try{return a()}catch(d){return l(d)}}()}catch(d){return x(d)}},x)}catch(s){return x(s)}},x)}catch(n){x(n)}}catch(n){return l(n)}};try{if(kt()||[Re.DESKTOP_SAFARI,Re.MOBILE_SAFARI].includes(tt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(b).then(function(y){try{return e=y,a()}catch{return c()}},c)}catch{c()}})}function Mt(b,I,E,l,e=1){return new Promise(function(t,a){let c;if(I==="image/png"){let x,n,r;return x=b.getContext("2d"),{data:n}=x.getImageData(0,0,b.width,b.height),r=Be.encode([n.buffer],b.width,b.height,4096*e),c=new Blob([r],{type:I}),c.name=E,c.lastModified=l,y.call(this)}{let x=function(){return y.call(this)};if(I==="image/bmp")return new Promise(n=>Wn.toBlob(b,n)).then((function(n){try{return c=n,c.name=E,c.lastModified=l,x.call(this)}catch(r){return a(r)}}).bind(this),a);{let n=function(){return x.call(this)};if(typeof OffscreenCanvas=="function"&&b instanceof OffscreenCanvas)return b.convertToBlob({type:I,quality:e}).then((function(r){try{return c=r,c.name=E,c.lastModified=l,n.call(this)}catch(s){return a(s)}}).bind(this),a);{let r;return r=b.toDataURL(I,e),mn(r,E,l).then((function(s){try{return c=s,n.call(this)}catch(d){return a(d)}}).bind(this),a)}}}function y(){return t(c)}})}function qe(b){b.width=0,b.height=0}function ct(){return new Promise(function(b,I){let E,l,e,t;return ct.cachedResult!==void 0?b(ct.cachedResult):mn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return E=a,Nt(E).then(function(c){try{return l=c[1],Mt(l,E.type,E.name,E.lastModified).then(function(y){try{return e=y,qe(l),Nt(e).then(function(x){try{return t=x[0],ct.cachedResult=t.width===1&&t.height===2,b(ct.cachedResult)}catch(n){return I(n)}},I)}catch(x){return I(x)}},I)}catch(y){return I(y)}},I)}catch(c){return I(c)}},I)})}function Yn(b){return new Promise((I,E)=>{const l=new zn;l.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return I(-2);const a=t.byteLength;let c=2;for(;c<a;){if(t.getUint16(c+2,!1)<=8)return I(-1);const y=t.getUint16(c,!1);if(c+=2,y==65505){if(t.getUint32(c+=2,!1)!=1165519206)return I(-1);const x=t.getUint16(c+=6,!1)==18761;c+=t.getUint32(c+4,x);const n=t.getUint16(c,x);c+=2;for(let r=0;r<n;r++)if(t.getUint16(c+12*r,x)==274)return I(t.getUint16(c+12*r+8,x))}else{if((65280&y)!=65280)break;c+=t.getUint16(c,!1)}}return I(-1)},l.onerror=e=>E(e),l.readAsArrayBuffer(b)})}function Kn(b,I){const{width:E}=b,{height:l}=b,{maxWidthOrHeight:e}=I;let t,a=b;return isFinite(e)&&(E>e||l>e)&&([a,t]=Bt(E,l),E>l?(a.width=e,a.height=l/E*e):(a.width=E/l*e,a.height=e),t.drawImage(b,0,0,a.width,a.height),qe(b)),a}function Zn(b,I){const{width:E}=b,{height:l}=b,[e,t]=Bt(E,l);switch(I>4&&I<9?(e.width=l,e.height=E):(e.width=E,e.height=l),I){case 2:t.transform(-1,0,0,1,E,0);break;case 3:t.transform(-1,0,0,-1,E,l);break;case 4:t.transform(1,0,0,-1,0,l);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,l,0);break;case 7:t.transform(0,-1,-1,0,l,E);break;case 8:t.transform(0,-1,1,0,0,E)}return t.drawImage(b,0,0,E,l),qe(b),e}function wn(b,I,E=0){return new Promise(function(l,e){let t,a,c,y,x,n,r,s,d,g,T,k,S,B,N,D,P,v,_,h;function u(j=5){if(I.signal&&I.signal.aborted)throw I.signal.reason;t+=j,I.onProgress(Math.min(t,100))}function m(j){if(I.signal&&I.signal.aborted)throw I.signal.reason;t=Math.min(Math.max(j,t),100),I.onProgress(t)}return t=E,a=I.maxIteration||10,c=1024*I.maxSizeMB*1024,u(),Nt(b,I).then((function(j){try{return[,y]=j,u(),x=Kn(y,I),u(),new Promise(function(w,C){var p;if(!(p=I.exifOrientation))return Yn(b).then((function(f){try{return p=f,A.call(this)}catch(o){return C(o)}}).bind(this),C);function A(){return w(p)}return A.call(this)}).then((function(w){try{return n=w,u(),ct().then((function(C){try{return r=C?x:Zn(x,n),u(),s=I.initialQuality||1,d=I.fileType||b.type,Mt(r,d,b.name,b.lastModified,s).then((function(p){try{{let f=function(){if(a--&&(N>c||N>S)){let M,F;return M=h?.95*_.width:_.width,F=h?.95*_.height:_.height,[P,v]=Bt(M,F),v.drawImage(_,0,0,M,F),s*=d==="image/png"?.85:.95,Mt(P,d,b.name,b.lastModified,s).then(function(O){try{return D=O,qe(_),_=P,N=D.size,m(Math.min(99,Math.floor((B-N)/(B-c)*100))),f}catch($){return e($)}},e)}return[1]},o=function(){return qe(_),qe(P),qe(x),qe(r),qe(y),m(100),l(D)};if(g=p,u(),T=g.size>c,k=g.size>b.size,!T&&!k)return m(100),l(g);var A;return S=b.size,B=g.size,N=B,_=r,h=!I.alwaysKeepResolution&&T,(A=(function(M){for(;M;){if(M.then)return void M.then(A,e);try{if(M.pop){if(M.length)return M.pop()?o.call(this):M;M=f}else M=M.call(this)}catch(F){return e(F)}}}).bind(this))(f)}}catch(f){return e(f)}}).bind(this),e)}catch(p){return e(p)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const zs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Yt;function $s(b,I){return new Promise((E,l)=>{Yt||(Yt=function(a){const c=[];return c.push(a),URL.createObjectURL(new Blob(c))}(zs));const e=new Worker(Yt);e.addEventListener("message",function(a){if(I.signal&&I.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return l(new Error(a.data.error)),void e.terminate();E(a.data.file),e.terminate()}else I.onProgress(a.data.progress)}),e.addEventListener("error",l),I.signal&&I.signal.addEventListener("abort",()=>{l(I.signal.reason),e.terminate()}),e.postMessage({file:b,imageCompressionLibUrl:I.libURL,options:{...I,onProgress:void 0,signal:void 0}})})}function Ae(b,I){return new Promise(function(E,l){let e,t,a,c,y,x;if(e={...I},a=0,{onProgress:c}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=d=>{a=d,typeof c=="function"&&c(a)},!(b instanceof Blob||b instanceof qs))return l(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(b.type))return l(new Error("The file given is not an image"));if(x=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||x)return wn(b,e).then((function(d){try{return t=d,s.call(this)}catch(g){return l(g)}}).bind(this),l);var n=(function(){try{return s.call(this)}catch(d){return l(d)}}).bind(this),r=function(d){try{return wn(b,e).then(function(g){try{return t=g,n()}catch(T){return l(T)}},l)}catch(g){return l(g)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",$s(b,e).then(function(d){try{return t=d,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=b.name,t.lastModified=b.lastModified}catch{}try{e.preserveExif&&b.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===b.type)&&(t=Hn(b,t))}catch{}return E(t)}})}Ae.getDataUrlFromFile=$n,Ae.getFilefromDataUrl=mn,Ae.loadImage=Qn,Ae.drawImageInCanvas=Vn,Ae.drawFileInCanvas=Nt,Ae.canvasToFile=Mt,Ae.getExifOrientation=Yn,Ae.handleMaxWidthOrHeight=Kn,Ae.followExifOrientation=Zn,Ae.cleanupCanvasMemory=qe,Ae.isAutoOrientationInBrowser=ct,Ae.approximateBelowMaximumCanvasSizeOfBrowser=Gn,Ae.copyExifWithoutOrientation=Hn,Ae.getBrowserName=tt,Ae.version="2.0.2";var Kt,Cn;function Xn(){if(Cn)return Kt;Cn=1;function b(I){var E=typeof I;return I!=null&&(E=="object"||E=="function")}return Kt=b,Kt}var Zt,Sn;function Qs(){if(Sn)return Zt;Sn=1;var b=typeof It=="object"&&It&&It.Object===Object&&It;return Zt=b,Zt}var Xt,An;function Jn(){if(An)return Xt;An=1;var b=Qs(),I=typeof self=="object"&&self&&self.Object===Object&&self,E=b||I||Function("return this")();return Xt=E,Xt}var Jt,Tn;function Gs(){if(Tn)return Jt;Tn=1;var b=Jn(),I=function(){return b.Date.now()};return Jt=I,Jt}var en,Fn;function Vs(){if(Fn)return en;Fn=1;var b=/\s/;function I(E){for(var l=E.length;l--&&b.test(E.charAt(l)););return l}return en=I,en}var tn,In;function Ys(){if(In)return tn;In=1;var b=Vs(),I=/^\s+/;function E(l){return l&&l.slice(0,b(l)+1).replace(I,"")}return tn=E,tn}var nn,Un;function es(){if(Un)return nn;Un=1;var b=Jn(),I=b.Symbol;return nn=I,nn}var sn,kn;function Ks(){if(kn)return sn;kn=1;var b=es(),I=Object.prototype,E=I.hasOwnProperty,l=I.toString,e=b?b.toStringTag:void 0;function t(a){var c=E.call(a,e),y=a[e];try{a[e]=void 0;var x=!0}catch{}var n=l.call(a);return x&&(c?a[e]=y:delete a[e]),n}return sn=t,sn}var rn,Dn;function Zs(){if(Dn)return rn;Dn=1;var b=Object.prototype,I=b.toString;function E(l){return I.call(l)}return rn=E,rn}var an,En;function Xs(){if(En)return an;En=1;var b=es(),I=Ks(),E=Zs(),l="[object Null]",e="[object Undefined]",t=b?b.toStringTag:void 0;function a(c){return c==null?c===void 0?e:l:t&&t in Object(c)?I(c):E(c)}return an=a,an}var on,Rn;function Js(){if(Rn)return on;Rn=1;function b(I){return I!=null&&typeof I=="object"}return on=b,on}var ln,_n;function er(){if(_n)return ln;_n=1;var b=Xs(),I=Js(),E="[object Symbol]";function l(e){return typeof e=="symbol"||I(e)&&b(e)==E}return ln=l,ln}var dn,On;function tr(){if(On)return dn;On=1;var b=Ys(),I=Xn(),E=er(),l=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,a=/^0o[0-7]+$/i,c=parseInt;function y(x){if(typeof x=="number")return x;if(E(x))return l;if(I(x)){var n=typeof x.valueOf=="function"?x.valueOf():x;x=I(n)?n+"":n}if(typeof x!="string")return x===0?x:+x;x=b(x);var r=t.test(x);return r||a.test(x)?c(x.slice(2),r?2:8):e.test(x)?l:+x}return dn=y,dn}var cn,Nn;function nr(){if(Nn)return cn;Nn=1;var b=Xn(),I=Gs(),E=tr(),l="Expected a function",e=Math.max,t=Math.min;function a(c,y,x){var n,r,s,d,g,T,k=0,S=!1,B=!1,N=!0;if(typeof c!="function")throw new TypeError(l);y=E(y)||0,b(x)&&(S=!!x.leading,B="maxWait"in x,s=B?e(E(x.maxWait)||0,y):s,N="trailing"in x?!!x.trailing:N);function D(C){var p=n,A=r;return n=r=void 0,k=C,d=c.apply(A,p),d}function P(C){return k=C,g=setTimeout(h,y),S?D(C):d}function v(C){var p=C-T,A=C-k,f=y-p;return B?t(f,s-A):f}function _(C){var p=C-T,A=C-k;return T===void 0||p>=y||p<0||B&&A>=s}function h(){var C=I();if(_(C))return u(C);g=setTimeout(h,v(C))}function u(C){return g=void 0,N&&n?D(C):(n=r=void 0,d)}function m(){g!==void 0&&clearTimeout(g),k=0,n=T=r=g=void 0}function j(){return g===void 0?d:u(I())}function w(){var C=I(),p=_(C);if(n=arguments,r=this,T=C,p){if(g===void 0)return P(T);if(B)return clearTimeout(g),g=setTimeout(h,y),D(T)}return g===void 0&&(g=setTimeout(h,y)),d}return w.cancel=m,w.flush=j,w}return cn=a,cn}var sr=nr();const rr=Ms(sr),nt=H.forwardRef(({path:b,initialImages:I=[],onImagesUpdated:E,onDelete:l,isOwnDesign:e},t)=>{const[a,c]=H.useState(I.map(o=>({...o,deleted:!1}))),[y,x]=H.useState(!1),[n,r]=H.useState(0),[s,d]=H.useState(!1),[g,T]=H.useState(null),[k,S]=H.useState(1),[B,N]=H.useState(!1),[D,P]=H.useState(!1),[v,_]=H.useState(""),[h,u]=H.useState("info"),m=H.useRef(null);H.useEffect(()=>{console.log("Initial images received:",I),c(I.map(o=>({...o,deleted:!!o.deleted})))},[I]);const j=async o=>{const M=Array.from(o.target.files||[]);x(!0);const F={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},O=M.map(async($,W)=>{let G=$;$.size>1024*1024&&(G=await Ae($,F),_("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),P(!0));const R=`${new Date().getTime()}-${G.name}`,K=ut(),se=ft(K,`${b}/${R}`),te=Bn(se,G);return new Promise((X,ie)=>{te.on("state_changed",ee=>{const ce=ee.bytesTransferred/ee.totalBytes*100;r(ce)},ee=>{console.error("Upload failed:",ee),ie(ee)},()=>{Pn(te.snapshot.ref).then(ee=>{X({url:ee,path:se.fullPath,title:""})})})})});Promise.all(O).then($=>{const W=[...a,...$];c(W),E&&E(W),_("Images uploaded successfully."),u("success"),P(!0),x(!1),r(0),m.current&&(m.current.value="")}).catch($=>{console.error("Error uploading images: ",$),_("Failed to upload images."),u("error"),P(!0),x(!1),r(0)})},w=o=>{c(M=>{const F=M.map((O,$)=>$===o?{...O,deleted:!0}:O);return E(F),F}),_("Image marked for deletion. Update to permanently delete."),u("info"),P(!0)},C=async()=>{const o=a.filter(M=>M.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const M=o.map(F=>{const O=ut(),$=ft(O,F.path);return Ut($)});try{await Promise.all(M),l(o),c(F=>F.filter(O=>!O.deleted)),_("Deleted images have been permanently removed."),u("success")}catch(F){console.error("Error committing deletions:",F),_("Failed to commit deletions."),u("error")}P(!0)}else console.log("No images marked for deletion.")},p=o=>{N(!B),T(o)};H.useEffect(()=>{const o=()=>{const M=!!document.fullscreenElement;N(M)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const A=(o,M)=>{M!=="clickaway"&&P(!1)},f=H.useCallback(rr((o,M)=>{setTimeout(()=>{c(F=>{const O=F.map(($,W)=>W===o?{...$,title:M}:$);return E&&E(O),O})},0)},30),[E]);return H.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Dt,{title:"Upload Images",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(vs,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:y,ref:m,accept:"image/*"})]})}),y&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),a.filter(o=>!o.deleted).map((o,M)=>i.jsxs("div",{children:[i.jsx("img",{src:o.url,alt:`Uploaded design ${M}`,onClick:()=>{d(!0),T(M)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Oe,{onClick:()=>w(M),children:i.jsx(jt,{})}),i.jsx("textarea",{value:o.title,onChange:F=>f(M,F.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},M)),i.jsx(st,{open:s,onClose:()=>d(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:g!==null&&i.jsxs(rt,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:a[g].url,alt:`Zoomed Design ${g}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Oe,{onClick:()=>S(k*1.2),children:i.jsx(js,{})}),i.jsx(Oe,{onClick:()=>S(k/1.2),style:{marginLeft:"10px"},children:i.jsx(ws,{})}),i.jsx(Oe,{onClick:()=>p(g),style:{marginLeft:"10px"},children:i.jsx(Cs,{})}),B&&i.jsx(Oe,{onClick:()=>p(g),style:{position:"absolute",top:20,right:20},children:i.jsx(Ss,{})})]})]})}),i.jsx(it,{open:D,autoHideDuration:6e3,onClose:A,children:i.jsx(at,{onClose:A,severity:h,sx:{width:"100%"},children:v})})]})});nt.displayName="ImageUpload";const ze=({onChange:b,initialValue:I})=>{const[E,l]=H.useState(Vt.sanitize(I||"")),e=H.useRef(!1),t=H.useRef(null),[a,c]=H.useState("");H.useEffect(()=>{e.current?l(Vt.sanitize(I||"")):e.current=!0},[I]);const y=(d,g)=>{const T=g.getData(),k=Vt.sanitize(T);l(k),b(k)},x=d=>{if(!t.current){console.warn("Editor not initialized");return}const g=t.current;g.model.change(T=>{const k=g.model.document.selection.getFirstPosition();T.insertText(d,k)}),c("")},n=d=>{x(d.target.value)},r=["Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼","Î½","Î¾","Î¿","Ï€","Ï","Ïƒ","Ï„","Ï…","Ï†","Ï‡","Ïˆ","Ï‰"],s=["Â°","+","-","=","~","â‰¥","â‰¤","â‰ ",">","<","*","/","%"];return i.jsxs("div",{children:[i.jsxs(et,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[i.jsx(As,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(jn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Et,{labelId:"math-operators-label",id:"math-operators",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(dt,{value:"",disabled:!0,children:"Math"}),s.map(d=>i.jsx(dt,{value:d,children:d},d))]})}),i.jsx(jn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Et,{labelId:"greek-letters-label",id:"greek-letters",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(dt,{value:"",disabled:!0,children:"Greek"}),r.map(d=>i.jsx(dt,{value:d,children:d},d))]})})]}),i.jsx(_s.CKEditor,{editor:Os,data:E,onReady:d=>{t.current=d},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"]},onChange:y})]})},gt=({path:b,initialFiles:I,onFilesChange:E,isOwnDesign:l})=>{const[e,t]=H.useState(I.map(m=>({...m,deleted:!!m.deleted}))),[a,c]=H.useState(!1),[y,x]=H.useState(0),[n,r]=H.useState({}),[s,d]=H.useState(!1),[g,T]=H.useState(""),[k,S]=H.useState("info"),B=H.useRef(null);H.useEffect(()=>{console.log("Initial files received:",I),t(I.map(m=>({...m,deleted:!!m.deleted})))},[I]),H.useEffect(()=>()=>{r({})},[]);const N=m=>{console.log("Updating files with",m),E(m),t(m)},D=async m=>{if(!m.target.files)return;const w=Array.from(m.target.files).filter(p=>p.size>5242880?(T("File size should not exceed 5 MB"),S("error"),d(!0),!1):!0);c(!0);const C=w.map(p=>{const A=new Date().getTime(),f=`${A}-${p.name}`,o=ut(),M=ft(o,`${b}/${f}`),F=Bn(M,p);return new Promise((O,$)=>{F.on("state_changed",W=>{const G=W.bytesTransferred/W.totalBytes*100;x(G)},W=>{console.error("Upload failed:",W),$(W)},()=>{Pn(F.snapshot.ref).then(W=>{O({id:A.toString(),url:W,name:p.name,path:M.fullPath})})})})});Promise.all(C).then(p=>{const A=[...e.filter(f=>!f.deleted),...p];N(A),T("Files uploaded successfully."),S("success"),d(!0),c(!1),x(0),B.current&&(B.current.value="")}).catch(p=>{console.error("Error uploading files: ",p),T("Failed to upload files."),S("error"),d(!0),c(!1),x(0)})},P=m=>{const j=e.map(w=>w.id===m?{...w,deleted:!0}:w);N(j),T("File marked for deletion. Update to permanently delete."),S("info"),d(!0)},v=m=>{r(j=>{var w;return{...j,[m]:((w=e.find(C=>C.id===m))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},_=m=>{t(j=>{const w=j.map(C=>C.id===m&&n[m]!==void 0?{...C,name:n[m]}:C);return E(w),w}),r(j=>{const w={...j};return delete w[m],w}),T("File name updated successfully."),S("info"),d(!0)},h=(m,j)=>{r(w=>({...w,[m]:j}))},u=(m,j)=>{j!=="clickaway"&&d(!1)};return i.jsxs("div",{children:[l&&i.jsx(Dt,{title:"Upload Files",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(Ts,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:D,disabled:a,ref:B})]})}),a&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(y),"%"]})}),i.jsx(Fs,{children:e.map(m=>i.jsxs(Is,{style:{opacity:m.deleted?.5:1},children:[i.jsx(Us,{children:i.jsx(ks,{})}),typeof n[m.id]=="string"?i.jsx(Rt,{variant:"outlined",size:"small",value:n[m.id],onChange:j=>h(m.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&_(m.id),fullWidth:!0}):i.jsx(Ds,{primary:m.name,secondary:i.jsx("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),l&&(typeof n[m.id]=="string"?i.jsx(Oe,{onClick:()=>_(m.id),edge:"end","aria-label":"save",children:i.jsx(un,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{onClick:()=>v(m.id),edge:"end","aria-label":"edit",children:i.jsx(Mn,{})}),i.jsx(Oe,{onClick:()=>P(m.id),edge:"end","aria-label":"delete",children:i.jsx(jt,{})})]}))]},m.id))}),i.jsx(it,{open:s,autoHideDuration:6e3,onClose:u,children:i.jsx(at,{onClose:u,severity:k,sx:{width:"100%"},children:g})})]})},ir=({designs:b,setDesigns:I,setIsAdding:E,getDesigns:l,onReturnToDashboard:e})=>{const{userDetails:t}=St();console.log("Add Design loaded");const[a,c]=H.useState(""),[y,x]=H.useState(""),[n,r]=H.useState(""),[s,d]=H.useState([]),[g,T]=H.useState([]),k=H.useMemo(()=>s,[s]),[S,B]=H.useState(!1),[N,D]=H.useState(""),[P,v]=H.useState("info"),[_,h]=H.useState(!1),[u,m]=H.useState("");console.log("Adding New Design from user:",t);const j=H.useRef(null),w=()=>{h(!1)},C=(A,f)=>{f!=="clickaway"&&B(!1)};H.useEffect(()=>{if(t!=null&&t.classes){const A=Object.keys(t.classes)[0];x(A||"")}},[t==null?void 0:t.classes]);const p=async A=>{var F;if(A.preventDefault(),console.log("Files to be saved:",g),!t||!t.uid){console.error("User object is undefined or missing UID."),m("You must be signed in to add a design."),h(!0);return}if(!a){m("All fields are required."),h(!0);return}await((F=j.current)==null?void 0:F.commitDeletions());const f=s.filter(O=>!O.deleted),o=g.filter(O=>!O.deleted).map(O=>({id:O.id,url:O.url,name:O.name,path:O.path})),M={title:n,description:a,course:y,dateCreated:wt(),dateModified:wt(),images:f,files:o,userId:t.uid};try{const O=await hn(Ce(J,"designs"),M),$={...M,id:O.id};I([...b,$]),D(`${n} has been Added.`),v("success"),B(!0),r(""),c(""),d([]),T([]),setTimeout(()=>{E(!1),l()},1e3)}catch(O){console.log(O),m("There was an issue adding your design."),h(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:e,className:"profile-button",children:"â† All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:p,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsx("div",{style:{display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:A=>r(A.target.value),style:{width:"100%"}})]})}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Et,{id:"course",value:y,onChange:A=>x(A.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([A,f])=>i.jsx(dt,{value:A,children:`${f.number} - ${f.title}`},A))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(ze,{onChange:c,initialValue:a}),i.jsx(nt,{ref:j,path:"designs/images",initialImages:k,onImagesUpdated:d,onDelete:A=>d(s.filter(f=>!A.includes(f))),isOwnDesign:!0}),i.jsx(gt,{path:"designs/files",initialFiles:g,onFilesChange:T,isOwnDesign:!0}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(Se,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(Se,{onClick:()=>E(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(st,{open:_,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(mt,{id:"alert-dialog-title",children:"Notification"}),i.jsx(rt,{children:i.jsx(Ct,{id:"alert-dialog-description",children:u})}),i.jsx(pt,{children:i.jsx(Se,{onClick:w,autoFocus:!0,children:"Ok"})})]}),i.jsx(it,{open:S,autoHideDuration:1e3,onClose:C,children:i.jsx(at,{onClose:C,severity:P,sx:{width:"100%"},children:N})})]})},ar=({designId:b,setIsAddingBuild:I,refreshBuilds:E})=>{const[l,e]=H.useState(""),[t,a]=H.useState(""),[c,y]=H.useState([]),[x,n]=H.useState([]),{userDetails:r}=St(),s=j=>{y(j)},d=j=>{n(j)};console.log("AddBuild loaded");const[g,T]=H.useState(!1),[k,S]=H.useState(""),[B,N]=H.useState(!1),[D,P]=H.useState(""),[v,_]=H.useState("info");console.log("Adding New Build by user:",r);const h=()=>{T(!1)},u=(j,w)=>{w!=="clickaway"&&N(!1)},m=async j=>{if(j.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),T(!0);return}if(!t){S("Build description is required."),T(!0);return}const w=c.filter(p=>!p.deleted),C=x.filter(p=>!p.deleted).map(p=>({id:p.id,url:p.url,name:p.name,path:p.path}));try{const p=await hn(Ce(J,"builds"),{title:l,description:t,design_ID:b,dateCreated:wt(),userId:r.uid,images:w,files:C});console.log("Build added with ID: ",p.id),console.log("Added New Build by user:",r),P("Your build has been successfully added."),_("success"),N(!0),setTimeout(()=>{e(""),a(""),y([]),n([]),I(!1),E()},1e3)}catch(p){if(console.error("Error adding build: ",p),p instanceof Error){let A=`Failed to add the build. ${p.message}`;p.message==="permission-denied"&&(A="You do not have permission to perform this operation."),P(A),_("error"),N(!0)}else P("Failed to add the build. Please try again later."),_("error"),N(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:m,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:l,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(ze,{onChange:a,initialValue:t})," ",i.jsx(nt,{path:`builds/${b}/images`,initialImages:c,onImagesUpdated:s,onDelete:j=>y(w=>w.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(gt,{path:`builds/${b}/files`,initialFiles:x,onFilesChange:d,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>I(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(st,{open:g,onClose:h,children:[i.jsx(mt,{children:"Notification"}),i.jsx(rt,{children:i.jsx(Ct,{children:k})}),i.jsx(pt,{children:i.jsx(Se,{onClick:h,children:"OK"})})]}),i.jsx(it,{open:B,autoHideDuration:6e3,onClose:u,children:i.jsx(at,{onClose:u,severity:v,sx:{width:"100%"},children:D})})]})},or=({designId:b,buildId:I,refreshTests:E,setAddingTestIdForBuild:l})=>{const[e,t]=H.useState(""),[a,c]=H.useState(""),[y,x]=H.useState(""),[n,r]=H.useState(""),[s,d]=H.useState([]),[g,T]=H.useState([]),{userDetails:k}=St();console.log("AddTest loaded");const[S,B]=H.useState(!1),[N,D]=H.useState(""),[P,v]=H.useState(!1),[_,h]=H.useState(""),[u,m]=H.useState("info"),j=C=>{T(C)},w=async()=>{if(!a){D("Test description cannot be empty!"),B(!0);return}const C=s.filter(A=>!A.deleted),p=g.filter(A=>!A.deleted).map(A=>({id:A.id,url:A.url,name:A.name,path:A.path}));try{await hn(Ce(J,"tests"),{title:e,build_ID:I,design_ID:b,dateCreated:wt(),description:a,results:y,conclusions:n,userId:k==null?void 0:k.uid,images:C,files:p}),setTimeout(()=>{E(I),t(""),c(""),x(""),r(""),d([]),T([]),l(!1)},1e3),h("Test added successfully"),m("success"),v(!0)}catch(A){console.error("Error adding test: ",A),h("Failed to add the test"),m("error"),v(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(ze,{onChange:c,initialValue:a}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(ze,{onChange:x,initialValue:y}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(ze,{onChange:r,initialValue:n}),i.jsx(nt,{path:`tests/${I}/images`,initialImages:s,onImagesUpdated:C=>{d(C)},onDelete:C=>d(p=>p.filter(A=>!C.includes(A))),isOwnDesign:!0}),i.jsx(gt,{path:`tests/${I}/files`,initialFiles:g,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>l(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(st,{open:S,onClose:()=>B(!1),children:[i.jsx(mt,{children:"Notification"}),i.jsx(rt,{children:i.jsx(Ct,{children:N})}),i.jsx(pt,{children:i.jsx(Se,{onClick:()=>B(!1),children:"OK"})})]}),i.jsx(it,{open:P,autoHideDuration:6e3,onClose:()=>v(!1),children:i.jsx(at,{onClose:()=>v(!1),severity:u,sx:{width:"100%"},children:_})})]})},vt=b=>b&&b instanceof fn?b.toDate().toLocaleString():"",lr=({selectedDesign:b,setIsEditing:I,onReturnToDashboard:E})=>{const{userDetails:l,loading:e}=St(),t=b.id,a=b.userId===(l==null?void 0:l.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",l);const[c,y]=H.useState(""),[x,n]=H.useState(b.description),[r,s]=H.useState(b.course||""),[d,g]=H.useState(vt(b.dateCreated)),[T,k]=H.useState(vt(b.dateModified)),[S,B]=H.useState([]),[N,D]=H.useState([]),P=H.useRef(null),[v,_]=H.useState(!1),[h,u]=H.useState([]),[m,j]=H.useState({}),[w,C]=H.useState({}),[p,A]=H.useState({}),f=H.useRef(null),[o,M]=H.useState({}),[F,O]=H.useState({}),[$,W]=H.useState({}),[G,q]=H.useState(!1),[R,K]=H.useState({}),[se,te]=H.useState({}),[X,ie]=H.useState({}),[ee,ce]=H.useState({}),[_e,Te]=H.useState({}),ue=H.useRef(null),[pe,fe]=H.useState({}),[ae,ge]=H.useState({}),[be,he]=H.useState({}),[Fe,oe]=H.useState(!1),[de,xe]=H.useState(""),[Le,Ve]=H.useState(()=>()=>{}),[ye,le]=H.useState(!1),[we,ne]=H.useState(""),[De,re]=H.useState("info"),[Ie,ve]=H.useState({design:!1,builds:!1,tests:!1}),bt=async U=>{if(U.preventDefault(),!x){xe("All fields are required."),oe(!0);return}console.log("About to check image deletions",P.current),console.log(P.current),console.log(S.some(Q=>Q.deleted)),P.current&&S.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await P.current.commitDeletions());const z=S.filter(Q=>!Q.deleted);N.some(Q=>Q.deleted)&&await At();const L=N.filter(Q=>!Q.deleted),Y={title:c,description:x,course:r,dateModified:wt(),images:z.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:L.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:l.uid};try{await Ke(je(J,"designs",t),Y,{merge:!0}),ne("Your design has been updated."),re("success"),le(!0);const Q=fn.now();k(vt(Q))}catch(Q){console.error("Error updating design:",Q),ne("There was an issue updating your design."),re("error"),le(!0)}ve(Q=>({...Q,design:!1}))};H.useEffect(()=>{b&&(n(b.description||""),y(b.title||""),s(b.course||""),(async()=>{const z=je(J,"designs",t),L=await Ns(z);if(L.exists()){const Y=L.data();console.log("Fetched images:",Y.images),console.log("Fetched files:",Y.files),B(Y.images||[]),D(Y.files||[]),g(vt(Y.dateCreated)),k(vt(Y.dateModified))}})())},[b,t]);const Pt=U=>{const z=S.filter(Y=>!U.some(Q=>Q.path===Y.path));console.log("Remaining images after deletion:",z),B(z);const L=z.map(Y=>({url:Y.url,title:Y.title,path:Y.path}));Ke(je(J,"designs",t),{images:L},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Y=>console.error("Failed to update Firestore:",Y))},xt=U=>{JSON.stringify(S)!==JSON.stringify(U)&&(B(U),console.log("Updated images received:",U))},At=async()=>{const U=N.filter(z=>z.deleted);if(console.log("Files to delete:",U),U.length>0){const z=ut(),L=U.map(Y=>{const Q=ft(z,Y.path);return Ut(Q)});try{await Promise.all(L),console.log("Files deleted successfully");const Y=N.filter(Q=>!Q.deleted);D(Y),await Gt(je(J,"designs",b.id),{files:Y.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),ne("Deleted files have been permanently removed."),re("success"),le(!0)}catch(Y){console.error("Failed to delete files: ",Y),ne("Failed to delete files."),re("error"),le(!0)}}},Xe=async U=>{var Q,Z;try{await ts(U)}catch(V){console.error("Error deleting files:",V),ne("Failed to delete build files."),re("error"),le(!0)}const z=((Q=w[U])==null?void 0:Q.filter(V=>!V.deleted).map(({url:V,path:Ue,title:Qe})=>({url:V,path:Ue,title:Qe})))||[],L=((Z=p[U])==null?void 0:Z.filter(V=>!V.deleted).map(V=>({id:V.id,url:V.url,name:V.name,path:V.path})))||[],Y={};z.length>0&&(Y.images=z),L.length>0&&(Y.files=L),m[U]!==void 0&&(Y.description=m[U]);try{const V=je(J,"builds",U);await Ke(V,Y,{merge:!0}),ne("Your build has been updated."),re("success"),le(!0),Me(),ve(Ue=>({...Ue,builds:!1}))}catch(V){console.error("Error updating build:",V),ne("Failed to update build."),re("error"),le(!0)}},Lt=(U,z)=>{O(L=>({...L,[U]:z}))},He=(U,z)=>{j(L=>({...L,[U]:z})),ve(L=>({...L,builds:!0}))},Ne=async U=>{const z=F[U];try{const L=je(J,"builds",U);await Ke(L,{title:z},{merge:!0}),O(Y=>{const Q={...Y};return delete Q[U],Q}),Me()}catch(L){console.error("Failed to save build title:",L)}},Me=async()=>{if(!l){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",l==null?void 0:l.uid),console.log("Selected design ID for query:",b==null?void 0:b.id);let U;l.isAdmin?U=Ee(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):U=Ee(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",l.uid),Pe("dateCreated")),console.log("Builds query details:",JSON.stringify(U,null,2));const z=await Ze(U);console.log("Builds snapshot details:",JSON.stringify(z.docs.map(Y=>Y.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",z.docs.length);const L=z.docs.map(Y=>(console.log("Build doc path: ",Y.ref.path),{id:Y.id,...Y.data()}));u(L),console.log("New builds state after refresh:",L)}catch(U){console.error("Error refreshing builds:",U),U.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",U):console.error("An unexpected error occurred when trying to refresh builds:",U)}},Je=(U,z)=>{const L=je(J,"builds",U),Y=w[U].filter(Z=>!z.some(V=>V.path===Z.path));C(Z=>({...Z,[U]:Y}));const Q=Y.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));Ke(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ne("Build Image deletions updated."),re("success")}).catch(Z=>{console.error("Failed to update build images in Firestore:",Z),ne("Failed to update build image deletions."),re("error")}),le(!0)},Tt=async U=>{const z=Ee(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",l.uid)),L=await Ze(z);for(const Y of L.docs)await ht(je(J,"tests",Y.id));await ht(je(J,"builds",U)),await Me(),ne("Build and its tests (if any) deleted successfully."),re("success"),le(!0)},$e=U=>{xe("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ve(()=>()=>Tt(U)),oe(!0)},We=(U,z)=>{C(L=>({...L,[U]:z}))},pn=(U,z)=>{A(L=>({...L,[U]:z}))},ts=async U=>{var L;const z=((L=p[U])==null?void 0:L.filter(Y=>Y.deleted))||[];if(console.log("Build files to delete:",z),z.length>0){const Y=ut(),Q=z.map(Z=>{const V=ft(Y,Z.path);return Ut(V)});try{await Promise.all(Q),console.log("Build files deleted successfully");const Z=p[U].filter(V=>!V.deleted);A(V=>({...V,[U]:Z})),await Gt(je(J,"builds",U),{files:Z.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path}))}),console.log("Firestore successfully updated to remove deleted files"),ne("Deleted build files have been permanently removed."),re("success"),le(!0)}catch(Z){console.error("Failed to delete build files: ",Z),ne("Failed to delete build files."),re("error"),le(!0)}}},ns=async(U,z)=>{var Z;try{await ls(U)}catch(V){console.error("Error deleting files:",V),ne("Failed to delete build files."),re("error"),le(!0)}const L={},Y=ee[U].filter(V=>!V.deleted).map(({url:V,path:Ue,title:Qe})=>({url:V,path:Ue,title:Qe})),Q=((Z=_e[U])==null?void 0:Z.filter(V=>!V.deleted).map(V=>({id:V.id,url:V.url,name:V.name,path:V.path})))||[];R[U]!==void 0&&(L.description=R[U]),se[U]!==void 0&&(L.results=se[U]),X[U]!==void 0&&(L.conclusions=X[U]),L.images=Y,L.files=Q;try{const V=je(J,"tests",U);await Ke(V,L,{merge:!0}),ne("Your test has been updated."),re("success"),le(!0),Ft(z)}catch(V){console.error(`Error updating test ID: ${U}:`,V),ne("There was an issue updating your test."),re("error"),le(!0)}},ss=(U,z)=>{ge(L=>({...L,[U]:z}))},bn=async(U,z)=>{const L=ae[U],Y=je(J,"tests",U);await Ke(Y,{title:L},{merge:!0}),ge(Q=>{const Z={...Q};return delete Z[U],Z}),Ft(z)},rs=(U,z)=>{console.log(`Updating description for test ID ${U}:`,z),K(L=>({...L,[U]:z})),ve(L=>({...L,tests:!0}))},is=(U,z)=>{console.log(`Updating results for test ID ${U}:`,z),te(L=>({...L,[U]:z})),ve(L=>({...L,tests:!0}))},as=(U,z)=>{ie(L=>({...L,[U]:z})),ve(L=>({...L,tests:!0}))};H.useEffect(()=>{!e&&l&&(async()=>{if(!l)return;let z;l.isAdmin?z=Ee(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):z=Ee(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",l.uid),Pe("dateCreated"));const L=await Ze(z),Y=[],Q={},Z={};for(const V of L.docs){const Ue=V.data(),Qe=V.id;Y.push({id:Qe,...Ue,images:Ue.images||[],files:Ue.files||[]}),Z[Qe]=!0;let Ht;l.isAdmin?Ht=Ee(Ce(J,"tests"),me("build_ID","==",Qe),Pe("dateCreated")):Ht=Ee(Ce(J,"tests"),me("build_ID","==",Qe),me("userId","==",l.uid),Pe("dateCreated"));const hs=await Ze(Ht),vn=[],Wt={},qt={};for(const Ye of hs.docs){const Ge=Ye.data();vn.push({id:Ye.id,...Ge}),Wt[Ye.id]=Ge.images||[],qt[Ye.id]=Ge.files||[]}Q[Qe]=vn,ce(Ye=>{const Ge={...Ye};for(const yt in Wt)Ge[yt]=Wt[yt];return Ge}),Te(Ye=>{const Ge={...Ye};for(const yt in qt)Ge[yt]=qt[yt];return Ge})}u(Y),W(Q),he(Z)})()},[e,l,b.id,t]);const Ft=async U=>{if(!l){console.log("User details not loaded yet");return}try{let z;l.isAdmin?z=Ee(Ce(J,"tests"),me("build_ID","==",U),Pe("dateCreated")):z=Ee(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",l.uid),Pe("dateCreated"));const Y=(await Ze(z)).docs.map(V=>{const Ue=V.data();return{id:V.id,...Ue,images:Ue.images||[],files:Ue.files||[]}});W(V=>({...V,[U]:Y}));const Q={},Z={};Y.forEach(V=>{Q[V.id]=V.images,Z[V.id]=V.files}),ce(Q),Te(Z)}catch(z){console.error("Error fetching tests:",z)}},os=(U,z)=>{const L=je(J,"tests",U),Y=ee[U].filter(Z=>!z.includes(Z));ce(Z=>({...Z,[U]:Y}));const Q=Y.map(({url:Z,path:V,title:Ue})=>({url:Z,path:V,title:Ue}));Ke(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ne("Test Image deletions updated."),re("success")}).catch(Z=>{console.error("Failed to update test images in Firestore:",Z),ne("Failed to update test image deletions."),re("error")}),le(!0)},xn=(U,z)=>{ce(L=>({...L,[U]:z}))},yn=(U,z)=>{Te(L=>({...L,[U]:z}))},ls=async U=>{var L;const z=((L=_e[U])==null?void 0:L.filter(Y=>Y.deleted))||[];if(z.length>0){const Y=ut(),Q=z.map(Z=>{const V=ft(Y,Z.path);return Ut(V)});try{await Promise.all(Q);const Z=_e[U].filter(V=>!V.deleted);Te(V=>({...V,[U]:Z})),await Gt(je(J,"tests",U),{files:Z.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path}))}),ne("Deleted test files have been permanently removed."),re("success"),le(!0)}catch(Z){console.error("Failed to delete test files: ",Z),ne("Failed to delete test files."),re("error"),le(!0)}}},ds=async(U,z)=>{await ht(je(J,"tests",U)),await Ft(z),ne("Test deleted successfully."),re("success"),le(!0)},cs=(U,z)=>{xe("Are you sure you want to delete this test? This action cannot be undone."),Ve(()=>()=>ds(U,z)),oe(!0)},us=U=>{he(z=>({...z,[U]:!z[U]}))},fs=()=>{const U=Object.entries(Ie).filter(([L,Y])=>Y).map(([L])=>L).join(", ");if(!U.length){E();return}const z=`You have unsaved changes in the following sections: ${U}. Are you sure you want to leave?`;xe(z),Ve(()=>()=>{ve({design:!1,builds:!1,tests:!1}),E()}),oe(!0)};return H.useEffect(()=>{const U=z=>{Object.values(Ie).some(Y=>Y)&&(z.preventDefault(),z.returnValue="")};return window.addEventListener("beforeunload",U),()=>window.removeEventListener("beforeunload",U)},[Ie]),i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:()=>{Object.values(Ie).some(z=>z)?fs():E()},className:"profile-button",children:"â† All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:bt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:c,onChange:U=>{y(U.target.value),ve(z=>({...z,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:d||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:T||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Et,{id:"course",value:r,onChange:U=>{s(U.target.value),ve(z=>({...z,design:!0}))},fullWidth:!0,children:(l!=null&&l.classes?Object.entries(l.classes):[]).map(([U,z])=>i.jsx(dt,{value:U,children:`${z.number} - ${z.title}`},U))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(ze,{initialValue:x,onChange:U=>{n(U),ve(z=>({...z,design:!0}))}}),i.jsx(nt,{ref:P,path:`designs/${b.id}/images`,initialImages:S,onImagesUpdated:xt,onDelete:Pt,isOwnDesign:a}),i.jsx(gt,{path:`designs/${b.id}/files`,initialFiles:N,onFilesChange:D,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>I(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{_(!0),setTimeout(()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"âž•"})," Build"]})]}),h.map((U,z)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:F[U.id]!==void 0?i.jsx(Rt,{variant:"outlined",size:"small",fullWidth:!0,value:F[U.id],onChange:L=>Lt(U.id,L.target.value),onBlur:()=>Ne(U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Oe,{onClick:()=>Ne(U.id),size:"small",children:i.jsx(un,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>O(L=>({...L,[U.id]:U.title||`Build ${z+1}`})),style:{cursor:"pointer"},children:U.title||`Build ${z+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>M(L=>({...L,[U.id]:!L[U.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:o[U.id]?i.jsx($t,{}):i.jsx(Qt,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>$e(U.id),children:i.jsx(jt,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{q(U.id),setTimeout(()=>{ue.current&&ue.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"âž•"})," Test"]})]})]})]}),o[U.id]&&i.jsxs(i.Fragment,{children:[i.jsx(ze,{initialValue:m[U.id]||U.description,onChange:L=>{He(U.id,L)}}),i.jsx(nt,{path:`builds/${U.id}/images`,initialImages:U.images,onImagesUpdated:L=>We(U.id,L),onDelete:L=>Je(U.id,L),isOwnDesign:a}),i.jsx(gt,{path:`builds/${U.id}/files`,initialFiles:U.files,onFilesChange:L=>pn(U.id,L),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Xe(U.id),children:"Update"})}),i.jsx("div",{children:$[U.id]&&$[U.id].length>0&&i.jsx("button",{onClick:()=>us(U.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[U.id]?i.jsxs(i.Fragment,{children:[i.jsx(Qt,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx($t,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[U.id]&&$[U.id]&&$[U.id].map((L,Y)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:ae[L.id]!==void 0?i.jsx(Rt,{variant:"outlined",size:"small",fullWidth:!0,value:ae[L.id],onChange:Q=>ss(L.id,Q.target.value),onBlur:()=>bn(L.id,U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Oe,{onClick:()=>bn(L.id,U.id),size:"small",children:i.jsx(un,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>ge(Q=>({...Q,[L.id]:L.title||`Test ${Y+1}`})),style:{cursor:"pointer"},children:L.title||`Test ${Y+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>fe(Q=>({...Q,[L.id]:!Q[L.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:pe[L.id]?i.jsx($t,{}):i.jsx(Qt,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>cs(L.id,U.id),children:i.jsx(jt,{})})]})]}),pe[L.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(ze,{initialValue:R[L.id]||L.description,onChange:Q=>{rs(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(ze,{initialValue:se[L.id]||L.results,onChange:Q=>{is(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(ze,{initialValue:X[L.id]||L.conclusions,onChange:Q=>{as(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(nt,{path:`tests/${L.id}/images`,initialImages:ee[L.id]||[],onImagesUpdated:Q=>xn(L.id,Q),onDelete:Q=>os(L.id,Q),isOwnDesign:a}),i.jsx(gt,{path:`tests/${L.id}/files`,initialFiles:_e[L.id]||[],onFilesChange:Q=>yn(L.id,Q),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>ns(L.id,U.id),children:"Update"})})]})]},L.id))]}),G===U.id&&i.jsxs("div",{className:"new-test-record",ref:ue,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(or,{designId:b.id,buildId:U.id,refreshTests:()=>Ft(U.id),setAddingTestIdForBuild:q,onImagesUpdated:L=>xn(U.id,L),onFilesChange:L=>yn(U.id,L)})]})]},U.id)),i.jsx("div",{children:v&&i.jsxs("div",{className:"new-build-record",ref:f,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(ar,{designId:b.id,setIsAddingBuild:_,refreshBuilds:Me,onImagesUpdated:U=>We("temp-build-id",U),onFilesChange:U=>pn("temp-build-id",U)})]})})]}),i.jsxs(st,{open:Fe,onClose:()=>oe(!1),children:[i.jsx(mt,{children:"Confirmation Required"}),i.jsx(rt,{children:i.jsx(Ct,{children:de})}),i.jsxs(pt,{children:[i.jsx(Se,{onClick:()=>oe(!1),children:"Cancel"}),i.jsx(Se,{onClick:()=>{Le(),oe(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(it,{open:ye,autoHideDuration:6e3,onClose:()=>le(!1),children:i.jsx(at,{onClose:()=>le(!1),severity:De,sx:{width:"100%"},children:we})})]})},lt=(b,I,E)=>b[I]??E,dr=()=>{const{userDetails:b,loading:I}=St();console.log("Dashboard loaded");const[E,l]=H.useState([]),[e,t]=H.useState([]),[a,c]=H.useState([]),[y,x]=H.useState(null),[n,r]=H.useState(!1),[s,d]=H.useState(!1),[g,T]=H.useState(!1),[k,S]=H.useState(""),[B,N]=H.useState(""),[D,P]=H.useState(!1),[v,_]=H.useState(null),[h,u]=H.useState(!1),[m,j]=H.useState(""),[w,C]=H.useState("info"),p=()=>{d(!1),r(!1),x(null),A()},A=H.useCallback(async()=>{if(!b)return;let F;const O=[],$=[],W=[];if(b.isSuperAdmin)F=Ee(Ce(J,"designs"),Pe("dateCreated","desc"));else if(b.isAdmin){const q=b.classes?Object.keys(b.classes):[];if(q.length>0)F=Ee(Ce(J,"designs"),me("course","in",q),Pe("dateCreated","desc"));else{t([]),c([]);return}}else F=Ee(Ce(J,"designs"),me("userId","==",b.uid),Pe("dateCreated","desc"));(await Ze(F)).forEach(q=>{const R=q.data(),K={id:q.id,title:lt(R,"title",""),description:lt(R,"description",""),course:lt(R,"course",""),dateCreated:R.dateCreated,dateModified:R.dateModified,userId:lt(R,"userId",""),images:lt(R,"images",[]),files:lt(R,"files",[])};b.isSuperAdmin?R.userId===b.uid?O.push(K):R.userId!==b.uid&&R.course&&R.isAdmin?$.push(K):R.userId!==b.uid&&!R.isAdmin&&W.push(K):b.isAdmin?R.userId===b.uid?$.push(K):W.push(K):R.userId===b.uid&&W.push(K)}),l(O),t($),c(W)},[b]);H.useEffect(()=>{!I&&b&&A()},[b,I,A]);const f=F=>{const O=[...E,...e,...a].find($=>$.id===F);x(O||null),d(!0)},o=F=>{_(F),S("Are you sure you want to delete this design? This action cannot be undone."),T(!0)},M=async()=>{if(v)if(B!==(b==null?void 0:b.uid))j("User ID confirmation failed. Enter the correct User ID."),C("error"),u(!0);else try{const F=Ee(Ce(J,"builds"),me("design_ID","==",v),me("userId","==",b.uid)),O=await Ze(F);for(const $ of O.docs){const W=$.id,G=Ee(Ce(J,"tests"),me("build_ID","==",W),me("userId","==",b.uid)),q=await Ze(G);for(const R of q.docs)await ht(je(J,"tests",R.id));await ht(je(J,"builds",W))}await ht(je(J,"designs",v)),l($=>$.filter(W=>W.id!==v)),t($=>$.filter(W=>W.id!==v)),c($=>$.filter(W=>W.id!==v)),j("Your design and its associated builds and tests have been deleted."),C("success"),u(!0)}catch(F){console.error("Error deleting design, builds, and tests: ",F),j("There was an issue deleting your design and its associated builds and tests."),C("error"),u(!0)}finally{N(""),P(!1),_(null)}};return i.jsxs(et,{className:"profile-container",sx:{p:4},children:[" ",!n&&!s&&i.jsxs(i.Fragment,{children:[i.jsx(et,{sx:{mb:3},children:i.jsx(Ln,{setIsAdding:r})}),(b==null?void 0:b.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Super Admin Designs"}),i.jsx(ot,{designs:E,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:b,showUserIdColumn:!0}),i.jsx("h2",{children:"Educator Designs"}),i.jsx(ot,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:b,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(ot,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:b,showUserIdColumn:!0})]}),(b==null?void 0:b.isAdmin)&&!b.isSuperAdmin&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Educator Designs"}),i.jsx(ot,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:b,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(ot,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:b,showUserIdColumn:!0})]}),!(b!=null&&b.isAdmin)&&!(b!=null&&b.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Student Designs"}),i.jsx(ot,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:b,showUserIdColumn:!1})]})]}),n&&i.jsx(ir,{designs:E.concat(e),setDesigns:t,setIsAdding:r,getDesigns:A,onReturnToDashboard:p}),s&&i.jsx(lr,{designs:E.concat(e),selectedDesign:y,setDesigns:t,setIsEditing:d,getDesigns:A,onReturnToDashboard:p}),i.jsxs(st,{open:g,onClose:()=>T(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(mt,{children:"Confirm Deletion"}),i.jsx(rt,{children:i.jsx(Ct,{children:k})}),i.jsxs(pt,{children:[i.jsx(Se,{onClick:()=>T(!1),children:"No, cancel"}),i.jsx(Se,{onClick:()=>{P(!0),T(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(st,{open:D,onClose:()=>P(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(mt,{children:"Confirm Your User ID"}),i.jsx(rt,{children:i.jsx(Rt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:B,onChange:F=>N(F.target.value)})}),i.jsxs(pt,{children:[i.jsx(Se,{onClick:()=>P(!1),children:"No, cancel"}),i.jsx(Se,{onClick:M,color:"primary",children:"Confirm"})]})]}),i.jsx(it,{open:h,autoHideDuration:6e3,onClose:()=>u(!1),children:i.jsx(at,{onClose:()=>u(!1),severity:w,sx:{width:"100%"},children:m})})]})},mr=Es.memo(dr);export{mr as default};
