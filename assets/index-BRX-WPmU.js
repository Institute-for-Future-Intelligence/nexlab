import{p as q,q as Q,r as f,j as e,B as l,z as U,bu as se,bv as ie,a as R,$ as ne,T as m,i as oe,P as re,k as ae,l as le,m as Y,n as C,o as de,v as X,t as G,I as P,aH as ce,a8 as ue,bw as xe,b1 as J,A as L,D as $,C as H,a3 as K,V as he,bx as me,f as fe}from"./ui-D-CDl99o.js";import{u as B,s as o,C as V,c as t,b as E,a as M,t as i,f as ge,d as be,P as O}from"./index-BYgPW9iB.js";import{u,R as ye,C as pe,l as _,a as Z,I as ee,F as te}from"./FileUploadSection-DK1dH3Hr.js";import"./firebase-CTJJwFJC.js";import"./vendor-BFl3bqVE.js";import"./purify.es-CQJ0hv7W.js";const je=()=>{const a=q(),p=Q(a.breakpoints.down("md")),{userDetails:j}=B(),[b,k]=f.useState(""),S=u(r=>r.filters.searchQuery),I=u(r=>r.setSearchQuery),x=u(r=>r.filters.courseId),v=u(r=>r.setSelectedCourse);u(r=>r.viewMode),u(r=>r.setViewMode);const z=u(r=>r.setActivePanel);u(r=>r.fetchAllData),f.useEffect(()=>{k(S)},[]),f.useEffect(()=>{const r=setTimeout(()=>{b!==S&&I(b)},300);return()=>clearTimeout(r)},[b,S,I]);const W=Object.entries((j==null?void 0:j.classes)||{}).map(([r,h])=>({id:r,number:h.number,title:h.title,isCourseAdmin:h.isCourseAdmin})),w=()=>{z("create")};return e.jsxs(l,{sx:{display:"flex",flexDirection:p?"column":"row",gap:o[3],alignItems:p?"stretch":"center"},children:[e.jsx(l,{sx:{minWidth:p?"100%":300},children:e.jsx(V,{value:x||"",onChange:r=>v(r||null),courses:[{id:"",number:"All",title:"All Courses",isCourseAdmin:!1},...W],size:"medium",showAdminBadge:!1})}),e.jsx(l,{sx:{flex:1},children:e.jsx(U,{placeholder:"Search designs...",value:b,onChange:r=>k(r.target.value),size:"medium",fullWidth:!0,InputProps:{startAdornment:e.jsx(se,{position:"start",children:e.jsx(ie,{sx:{color:t.text.tertiary}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:E.lg,backgroundColor:t.background.secondary,"& fieldset":{borderColor:t.neutral[200]},"&:hover fieldset":{borderColor:t.neutral[300]},"&.Mui-focused fieldset":{borderColor:t.primary[500]}}}})}),e.jsx(l,{children:e.jsx(R,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:w,sx:{backgroundColor:t.primary[500],color:t.text.inverse,fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.semibold,fontSize:i.fontSize.base,padding:`${o[3]} ${o[6]}`,borderRadius:E.xl,textTransform:"none",boxShadow:M.sm,"&:hover":{backgroundColor:t.primary[600],boxShadow:M.md}},children:p?"New":"New Design"})})]})},Ce=({designs:a})=>{const p=ge(),j=q(),b=Q(j.breakpoints.down("md")),k=u(s=>s.builds),S=u(s=>s.tests),I=u(s=>s.fetchAllData),[x,v]=f.useState({open:!1,designId:null,designTitle:null,buildCount:0,testCount:0}),[z,W]=f.useState(!1),w=s=>{const c=k.filter(F=>F.design_ID===s),D=c.map(F=>F.id),T=S.filter(F=>D.includes(F.build_ID));return{buildCount:c.length,testCount:T.length}},r=s=>{if(!s)return"N/A";let c;s.toDate&&typeof s.toDate=="function"?c=s.toDate():s.seconds?c=new Date(s.seconds*1e3):c=new Date(s);const D=c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),T=c.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`${D}, ${T}`},h=s=>{p(`/laboratory-notebook/${s}`)},g=s=>{const c=w(s.id);v({open:!0,designId:s.id,designTitle:s.title,buildCount:c.buildCount,testCount:c.testCount})},A=()=>{v({open:!1,designId:null,designTitle:null,buildCount:0,testCount:0})},n=async()=>{if(x.designId){W(!0);try{const s=a.find(c=>c.id===x.designId);if(!s)return;await _.deleteDesign(x.designId,s.userId),await I(s.userId,!1,[]),A()}catch(s){console.error("Error deleting design:",s),alert("Failed to delete design. Please try again.")}finally{W(!1)}}};return a.length===0?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,p:o[6]},children:[e.jsx(m,{variant:"h5",sx:{fontFamily:i.fontFamily.display,color:t.text.secondary,mb:o[2]},children:"No Designs Yet"}),e.jsx(m,{variant:"body1",sx:{color:t.text.tertiary,textAlign:"center",maxWidth:500},children:"Start by creating your first design to visualize your experimental workflow."})]}):e.jsxs(oe,{component:re,sx:{borderRadius:E.xl,boxShadow:M.md,border:`1px solid ${t.neutral[200]}`},children:[e.jsxs(ae,{children:[e.jsx(le,{children:e.jsxs(Y,{sx:{backgroundColor:t.background.secondary},children:[e.jsx(C,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Title"}),!b&&e.jsx(C,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Description"}),e.jsx(C,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Builds"}),e.jsx(C,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Tests"}),!b&&e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Created"}),e.jsx(C,{sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Modified"})]}),e.jsx(C,{align:"center",sx:{fontFamily:i.fontFamily.secondary,fontWeight:i.fontWeight.bold,color:t.text.primary,fontSize:i.fontSize.sm},children:"Actions"})]})}),e.jsx(de,{children:a.map(s=>{const c=w(s.id);return e.jsxs(Y,{sx:{"&:hover":{backgroundColor:t.primary[50],cursor:"pointer"},transition:be.transitions.fast},onClick:()=>h(s.id),children:[e.jsx(C,{children:e.jsx(m,{variant:"body1",sx:{fontWeight:i.fontWeight.semibold,color:t.text.primary,fontFamily:i.fontFamily.secondary},children:s.title})}),!b&&e.jsx(C,{children:e.jsx(l,{sx:{maxWidth:400},children:e.jsx(ye,{content:s.description||"<p>No description</p>",maxLines:2})})}),e.jsx(C,{align:"center",children:e.jsx(X,{label:c.buildCount,size:"small",sx:{backgroundColor:c.buildCount>0?t.secondary[100]:t.neutral[100],color:c.buildCount>0?t.secondary[700]:t.text.tertiary,fontWeight:i.fontWeight.bold,minWidth:40}})}),e.jsx(C,{align:"center",children:e.jsx(X,{label:c.testCount,size:"small",sx:{backgroundColor:c.testCount>0?"#FFEDD5":t.neutral[100],color:c.testCount>0?"#C2410C":t.text.tertiary,fontWeight:i.fontWeight.bold,minWidth:40}})}),!b&&e.jsxs(e.Fragment,{children:[e.jsx(C,{children:e.jsx(m,{variant:"body2",sx:{color:t.text.tertiary,fontSize:i.fontSize.sm},children:r(s.dateCreated)})}),e.jsx(C,{children:e.jsx(m,{variant:"body2",sx:{color:t.text.tertiary,fontSize:i.fontSize.sm},children:r(s.dateModified)})})]}),e.jsx(C,{align:"center",children:e.jsxs(l,{sx:{display:"flex",gap:o[1],justifyContent:"center"},children:[e.jsx(G,{title:"View Diagram",children:e.jsx(P,{size:"small",onClick:D=>{D.stopPropagation(),h(s.id)},sx:{color:t.primary[500],"&:hover":{backgroundColor:t.primary[50]}},children:e.jsx(ce,{fontSize:"small"})})}),e.jsx(G,{title:"Delete Design",children:e.jsx(P,{size:"small",onClick:D=>{D.stopPropagation(),g(s)},sx:{color:t.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:e.jsx(ue,{fontSize:"small"})})})]})})]},s.id)})})]}),e.jsx(pe,{open:x.open,title:"Delete Design?",message:`Are you sure you want to delete "${x.designTitle}"? ${x.buildCount>0||x.testCount>0?`This will also delete ${x.buildCount} build${x.buildCount!==1?"s":""} and ${x.testCount} test${x.testCount!==1?"s":""}. `:""}This action cannot be undone.`,confirmLabel:z?"Deleting...":"Delete",cancelLabel:"Cancel",onConfirm:n,onCancel:A,isDestructive:!0})]})},Se=()=>{const{userDetails:a}=B(),p=u(d=>d.setActivePanel);u(d=>d.addDesign);const j=u(d=>d.fetchAllData),[b,k]=f.useState(""),[S,I]=f.useState(""),[x,v]=f.useState(""),[z,W]=f.useState([]),[w,r]=f.useState([]),[h,g]=f.useState(!1),[A,n]=f.useState(null),s=u(d=>d.setIsExpanded),c=Object.entries((a==null?void 0:a.classes)||{}).map(([d,y])=>({id:d,number:y.number,title:y.title,isCourseAdmin:y.isCourseAdmin})),D=()=>{p(null)},T=()=>{s(!0)},F=async d=>{if(d.preventDefault(),!b.trim()){n("Title is required");return}if(!S.trim()){n("Description is required");return}if(!x){n("Please select a course");return}if(!a){n("User not authenticated");return}g(!0),n(null);try{const y=await _.createDesign({title:b.trim(),description:S.trim(),course:x,userId:a.uid,images:z,files:w}),N=Object.keys(a.classes||{});await j(a.uid,a.isAdmin,N),p(null)}catch(y){console.error("Error creating design:",y),n(y instanceof Error?y.message:"Failed to create design")}finally{g(!1)}};return e.jsxs(l,{sx:{position:"fixed",right:0,top:0,height:"100vh",width:480,backgroundColor:t.background.primary,boxShadow:M["2xl"],zIndex:1300,display:"flex",flexDirection:"column",animation:"slideInRight 0.3s ease-out","@keyframes slideInRight":{from:{transform:"translateX(100%)"},to:{transform:"translateX(0)"}}},children:[e.jsx(l,{sx:{p:o[4],borderBottom:`1px solid ${t.neutral[200]}`,backgroundColor:t.primary[50]},children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:t.text.primary},children:"Create New Design"}),e.jsxs(l,{sx:{display:"flex",gap:o[1]},children:[e.jsx(P,{size:"small",onClick:T,disabled:h,children:e.jsx(xe,{})}),e.jsx(P,{size:"small",onClick:D,disabled:h,children:e.jsx(J,{})})]})]})}),e.jsxs(l,{component:"form",onSubmit:F,sx:{flex:1,overflowY:"auto",p:o[4],display:"flex",flexDirection:"column",gap:o[4]},children:[A&&e.jsx(L,{severity:"error",onClose:()=>n(null),children:A}),e.jsx(U,{label:"Title",value:b,onChange:d=>k(d.target.value),required:!0,fullWidth:!0,disabled:h,placeholder:"Enter design title",sx:{"& .MuiOutlinedInput-root":{borderRadius:E.lg}}}),e.jsxs(l,{children:[e.jsx(m,{variant:"body2",sx:{mb:o[1],color:t.text.secondary,fontWeight:i.fontWeight.medium},children:"Description *"}),e.jsx(Z,{value:S,onChange:I,placeholder:"Describe your design, its purpose, and goals...",minHeight:200,disabled:h})]}),e.jsx(l,{children:e.jsx(V,{value:x,onChange:d=>v(d||""),courses:c,disabled:h,size:"medium",showAdminBadge:!1})}),e.jsx($,{sx:{my:o[2]}}),e.jsx(ee,{images:z,onImagesChange:W,storagePath:"",disabled:h}),e.jsx($,{sx:{my:o[2]}}),e.jsx(te,{files:w,onFilesChange:r,storagePath:"",disabled:h,maxFileSize:10}),e.jsx(L,{severity:"info",sx:{borderRadius:E.lg},children:e.jsx(m,{variant:"body2",children:"After creating your design, you can add builds and tests to it from the graph view."})})]}),e.jsxs(l,{sx:{p:o[4],borderTop:`1px solid ${t.neutral[200]}`,display:"flex",gap:o[2]},children:[e.jsx(R,{variant:"outlined",onClick:D,fullWidth:!0,disabled:h,children:"Cancel"}),e.jsx(R,{type:"submit",variant:"contained",onClick:F,fullWidth:!0,disabled:h,startIcon:h?e.jsx(H,{size:20}):e.jsx(K,{}),sx:{backgroundColor:t.primary[500],"&:hover":{backgroundColor:t.primary[600]}},children:h?"Creating...":"Create Design"})]})]})},ve=()=>{const{userDetails:a}=B(),p=u(d=>d.setActivePanel),j=u(d=>d.setIsExpanded),b=u(d=>d.fetchAllData),[k,S]=f.useState(""),[I,x]=f.useState(""),[v,z]=f.useState(""),[W,w]=f.useState([]),[r,h]=f.useState([]),[g,A]=f.useState(!1),[n,s]=f.useState(null),c=Object.entries((a==null?void 0:a.classes)||{}).map(([d,y])=>({id:d,number:y.number,title:y.title,isCourseAdmin:y.isCourseAdmin})),D=()=>{j(!1)},T=()=>{j(!1),p(null)},F=async d=>{if(d.preventDefault(),!k.trim()){s("Title is required");return}if(!I.trim()){s("Description is required");return}if(!v){s("Please select a course");return}if(!a){s("User not authenticated");return}A(!0),s(null);try{const y=await _.createDesign({title:k.trim(),description:I.trim(),course:v,userId:a.uid,images:W,files:r}),N=Object.keys(a.classes||{});await b(a.uid,a.isAdmin,N),j(!1),p(null)}catch(y){console.error("Error creating design:",y),s(y instanceof Error?y.message:"Failed to create design")}finally{A(!1)}};return e.jsxs(he,{open:!0,onClose:T,fullScreen:!0,sx:{"& .MuiDialog-paper":{backgroundColor:t.background.primary}},children:[e.jsx(l,{sx:{position:"sticky",top:0,zIndex:1100,p:o[4],borderBottom:`1px solid ${t.neutral[200]}`,backgroundColor:t.primary[50]},children:e.jsx(l,{sx:{maxWidth:1200,mx:"auto",width:"100%"},children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:o[2]},children:[e.jsx(P,{size:"small",onClick:D,disabled:g,children:e.jsx(me,{})}),e.jsx(m,{variant:"h3",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:t.text.primary},children:"Create New Design"})]}),e.jsx(P,{size:"small",onClick:T,disabled:g,children:e.jsx(J,{})})]})})}),e.jsx(l,{component:"form",onSubmit:F,sx:{flex:1,overflowY:"auto",p:o[6]},children:e.jsxs(l,{sx:{maxWidth:1200,mx:"auto",width:"100%",display:"flex",flexDirection:"column",gap:o[4]},children:[n&&e.jsx(L,{severity:"error",onClose:()=>s(null),children:n}),e.jsx(U,{label:"Title",value:k,onChange:d=>S(d.target.value),required:!0,fullWidth:!0,disabled:g,placeholder:"Enter design title",sx:{"& .MuiOutlinedInput-root":{borderRadius:E.lg,fontSize:i.fontSize.xl}}}),e.jsxs(l,{children:[e.jsx(m,{variant:"body1",sx:{mb:o[2],color:t.text.secondary,fontWeight:i.fontWeight.medium,fontSize:i.fontSize.lg},children:"Description *"}),e.jsx(Z,{value:I,onChange:x,placeholder:"Describe your design, its purpose, and goals...",minHeight:400,disabled:g})]}),e.jsxs(l,{children:[e.jsx(m,{variant:"body1",sx:{mb:o[2],color:t.text.secondary,fontWeight:i.fontWeight.medium,fontSize:i.fontSize.lg},children:"Course *"}),e.jsx(V,{value:v,onChange:d=>z(d||""),courses:c,disabled:g,size:"medium",showAdminBadge:!1})]}),e.jsx($,{sx:{my:o[3]}}),e.jsx(ee,{images:W,onImagesChange:w,storagePath:"",disabled:g}),e.jsx($,{sx:{my:o[3]}}),e.jsx(te,{files:r,onFilesChange:h,storagePath:"",disabled:g,maxFileSize:10}),e.jsx(L,{severity:"info",sx:{borderRadius:E.lg},children:e.jsx(m,{variant:"body2",children:"After creating your design, you can add builds and tests to it from the graph view."})})]})}),e.jsx(l,{sx:{position:"sticky",bottom:0,p:o[4],backgroundColor:t.background.primary,borderTop:`1px solid ${t.neutral[200]}`,boxShadow:"0 -4px 6px -1px rgba(0, 0, 0, 0.1)"},children:e.jsxs(l,{sx:{maxWidth:1200,mx:"auto",width:"100%",display:"flex",gap:o[2]},children:[e.jsx(R,{variant:"outlined",onClick:D,fullWidth:!0,size:"large",disabled:g,children:"Cancel"}),e.jsx(R,{type:"submit",variant:"contained",onClick:F,fullWidth:!0,size:"large",disabled:g,startIcon:g?e.jsx(H,{size:20}):e.jsx(K,{}),sx:{backgroundColor:t.primary[500],"&:hover":{backgroundColor:t.primary[600]}},children:g?"Creating...":"Create Design"})]})})]})},Fe=()=>{const{userDetails:a,loading:p}=B(),[j,b]=f.useState(!1),k=q(),S=Q(k.breakpoints.down("md")),I=u(n=>n.isLoading),x=u(n=>n.error),v=u(n=>n.fetchAllData),z=u(n=>n.designs),W=u(n=>n.activePanel),w=u(n=>n.isExpanded),r=u(n=>n.filters.searchQuery),h=u(n=>n.filters.courseId),g=fe.useMemo(()=>{let n=z;if(h&&(n=n.filter(s=>s.course===h)),r){const s=r.toLowerCase();n=n.filter(c=>c.title.toLowerCase().includes(s)||c.description.toLowerCase().includes(s))}return n},[z,r,h]);if(f.useEffect(()=>{if(!p&&a&&!j){const n=Object.keys(a.classes||{});v(a.uid,a.isAdmin,n),b(!0)}},[a,p,v,j]),p||I&&!j)return e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"80vh",gap:o[4]},children:[e.jsx(H,{size:60,sx:{color:t.primary[500]}}),e.jsx(m,{variant:"h6",sx:{fontFamily:i.fontFamily.display,color:t.text.secondary},children:"Loading your laboratory notebook..."})]});if(x){const n=x.includes("permission")||x.includes("rules");return e.jsxs(l,{sx:{p:o[6]},children:[e.jsx(O,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(L,{severity:"error",sx:{mt:o[4],borderRadius:"12px"},children:[e.jsx(m,{variant:"h6",sx:{mb:1},children:"Error Loading Data"}),e.jsx(m,{variant:"body2",sx:{mb:n?2:0},children:x}),n&&e.jsxs(l,{sx:{mt:2},children:[e.jsx(m,{variant:"body2",sx:{fontWeight:600,mb:1},children:"To fix this issue:"}),e.jsxs(m,{variant:"body2",component:"ul",sx:{pl:2,mb:0},children:[e.jsxs("li",{children:["Deploy Firebase security rules using: ",e.jsx("code",{children:"firebase deploy --only firestore:rules"})]}),e.jsx("li",{children:"Or manually update rules in Firebase Console"}),e.jsxs("li",{children:["See ",e.jsx("code",{children:"docs/FIREBASE_RULES_SETUP.md"})," for detailed instructions"]})]})]})]})]})}return a&&(a.isAdmin||a.isSuperAdmin||a.classes&&Object.keys(a.classes).length>0)?e.jsxs(l,{sx:{p:S?o[3]:o[6],backgroundColor:t.background.primary,minHeight:"100vh"},children:[e.jsx(O,{title:"Laboratory Notebook",subtitle:"Manage your experimental designs, builds, and tests"}),e.jsx(l,{sx:{mb:o[6]},children:e.jsx(je,{})}),j&&e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{display:"flex",gap:o[4],mb:o[4],flexWrap:"wrap"},children:e.jsxs(l,{sx:{flex:1,minWidth:200,p:o[4],backgroundColor:t.primary[50],borderRadius:E.xl,border:`1px solid ${t.primary[200]}`},children:[e.jsx(m,{variant:"h3",sx:{fontFamily:i.fontFamily.display,fontWeight:i.fontWeight.bold,color:t.primary[700],mb:o[1]},children:g.length}),e.jsx(m,{variant:"body2",sx:{color:t.text.secondary,fontWeight:i.fontWeight.medium},children:"Total Designs"})]})}),e.jsx(Ce,{designs:g})]}),W==="create"&&(w?e.jsx(ve,{}):e.jsx(Se,{}))]}):e.jsxs(l,{sx:{p:o[6]},children:[e.jsx(O,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(L,{severity:"info",sx:{mt:o[4],borderRadius:"12px"},children:[e.jsx(m,{variant:"h6",sx:{mb:1},children:"Course Enrollment Required"}),e.jsx(m,{variant:"body2",children:"The Laboratory Notebook is accessible to users enrolled in an academic course. Please enroll in a course via 'My Account' by following the instructions provided by your academic instructor."})]})]})};export{Fe as default};
