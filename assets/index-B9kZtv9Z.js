import{r as H,p as Rn,q as _n,j as i,B as Ae,a as ke,i as Lr,P as Nt,k as $r,l as Vr,m as cn,n as Be,o as Qr,T as Ve,t as Kt,I as Pe,c as ot,d as at,F as ht,J as gt,a4 as mt,A as pt,as as fr,ar as Dn,at as Xt,a8 as yt,V as Gr,W as Yr,b9 as Zr,Y as qt,X as Kr,U as Xr,H as Ft,K as Lt,N as At,f as Jr,v as es}from"./ui-J3wtD2gz.js";import{P as ts,a as $e,c as K,d as Pt,b as Me,s as ne,t as G,C as ns,f as rs,g as Ht,r as lt,h as ss,R as is,u as $t,i as se,V as un}from"./index-DDTG-xaV.js";import{l as En,k as jt,r as St,p as Yt,z as hr,n as gr,q as Mn,_ as Te,h as Wt,e as Ce,f as os,R as Oe,x as Le,v as xe,t as it,m as st,i as fn,y as wt}from"./firebase-CTJJwFJC.js";import{E as mr}from"./Edit-B6mkqjbR.js";import{g as tt}from"./vendor-BFl3bqVE.js";import hn from"./purify.es-CQJ0hv7W.js";const pr=H.memo(({setIsAdding:g})=>{console.log("Header loaded");const A=Rn(),U=_n(A.breakpoints.down("md"));return i.jsxs(Ae,{children:[i.jsx(ts,{title:"Laboratory Notebook",subtitle:"Manage your lab experiments, designs, and research projects"}),i.jsx(Ae,{sx:{display:"flex",justifyContent:"flex-start"},children:i.jsx(ke,{variant:"contained",onClick:()=>g(!0),sx:{fontFamily:G.fontFamily.display,fontSize:U?G.fontSize.lg:G.fontSize.xl,fontWeight:G.fontWeight.semibold,textTransform:"none",px:U?ne[4]:ne[6],py:ne[3],backgroundColor:K.primary[500],borderRadius:Me.xl,boxShadow:$e.md,transition:Pt.transitions.fast,"&:hover":{backgroundColor:K.primary[600],boxShadow:$e.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"}},children:"+ Create New Design"})})]})});pr.displayName="Header";const bt=({designs:g,handleEdit:A,handleDelete:U,userDetails:d,showUserIdColumn:e})=>{const t=l=>l?l instanceof En?l.toDate().toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):l instanceof Date?l.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A":"N/A";return i.jsx(Lr,{component:Nt,sx:{borderRadius:Me["2xl"],boxShadow:$e.lg,border:`1px solid ${K.neutral[200]}`,overflow:"hidden"},children:i.jsxs($r,{sx:{"& .MuiTableCell-root":{fontSize:G.fontSize.base,fontFamily:G.fontFamily.primary,borderBottom:`1px solid ${K.neutral[200]}`},"& .MuiTableCell-head":{fontSize:G.fontSize.lg,fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.semibold,backgroundColor:K.primary[500],color:K.text.inverse,textTransform:"uppercase",letterSpacing:"0.5px"},"& .MuiTableRow-root:hover":{backgroundColor:K.primary[25]}},children:[i.jsx(Vr,{children:i.jsxs(cn,{sx:{height:"64px"},children:[i.jsx(Be,{sx:{width:e?"30%":"35%"},children:"Title"}),i.jsx(Be,{sx:{width:"20%"},children:"Course"}),e&&i.jsx(Be,{sx:{width:"15%"},children:"User"}),i.jsx(Be,{sx:{width:"15%"},children:"Created"}),i.jsx(Be,{sx:{width:"15%"},children:"Modified"}),i.jsx(Be,{sx:{width:"15%",textAlign:"center"},children:"Actions"})]})}),i.jsx(Qr,{children:g&&g.length>0?g.map(l=>{const a=l.userId===(d==null?void 0:d.uid),b=l.course&&(d!=null&&d.classes)&&d.classes[l.course]?d.classes[l.course]:null;return i.jsxs(cn,{sx:{height:"72px",transition:Pt.transitions.fast,"&:hover":{backgroundColor:K.primary[25],transform:"translateY(-1px)",boxShadow:$e.sm}},children:[i.jsx(Be,{children:i.jsx(Ae,{onClick:()=>A(l.id),sx:{display:"inline-flex",alignItems:"center",backgroundColor:K.primary[100],border:`1px solid ${K.primary[200]}`,borderRadius:Me.lg,padding:`${ne[2]} ${ne[3]}`,cursor:"pointer",transition:"all 0.2s ease",maxWidth:"100%","&:hover":{backgroundColor:K.primary[200],borderColor:K.primary[300],transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},"&:active":{transform:"translateY(0)"}},children:i.jsx(Ve,{variant:"body1",sx:{fontFamily:G.fontFamily.secondary,fontSize:G.fontSize.base,fontWeight:G.fontWeight.semibold,color:K.primary[700],textDecoration:"none",userSelect:"none","&:hover":{textDecoration:"underline"}},children:l.title})})}),i.jsx(Be,{children:b?i.jsx(ns,{courseId:l.course,courseNumber:b.number,courseTitle:b.title,variant:"link",maxTitleLength:30}):i.jsx(Ve,{variant:"body2",sx:{color:K.text.disabled,fontStyle:"italic"},children:"No Course"})}),e&&i.jsx(Be,{children:i.jsx(rs,{userId:l.userId,userType:"student"})}),i.jsx(Be,{children:i.jsx(Ve,{variant:"body2",sx:{color:K.text.secondary,fontSize:G.fontSize.sm},children:t(l.dateCreated)})}),i.jsx(Be,{children:i.jsx(Ve,{variant:"body2",sx:{color:K.text.secondary,fontSize:G.fontSize.sm},children:t(l.dateModified)})}),i.jsx(Be,{sx:{textAlign:"center"},children:i.jsxs(Ae,{sx:{display:"flex",justifyContent:"center",gap:ne[1]},children:[i.jsx(Kt,{title:a?"Edit Design":"Cannot edit others' designs",children:i.jsx("span",{children:i.jsx(Pe,{size:"small",onClick:()=>a&&A(l.id),disabled:!a,sx:{color:a?K.primary[600]:K.text.disabled,"&:hover":{backgroundColor:a?K.primary[100]:"transparent"}},children:i.jsx(mr,{fontSize:"small"})})})}),i.jsx(Kt,{title:a?"Delete Design":"Cannot delete others' designs",children:i.jsx("span",{children:i.jsx(Pe,{size:"small",onClick:()=>a&&U(l.id),disabled:!a,sx:{color:a?K.error:K.text.disabled,"&:hover":{backgroundColor:a?K.error+"20":"transparent"}},children:i.jsx(Ht,{fontSize:"small"})})})})]})})]},l.id)}):i.jsx(cn,{children:i.jsx(Be,{colSpan:e?6:5,sx:{textAlign:"center",py:ne[8],color:K.text.secondary,fontStyle:"italic"},children:i.jsx(Ve,{variant:"body1",sx:{fontFamily:G.fontFamily.secondary,fontSize:G.fontSize.base,fontWeight:G.fontWeight.medium},children:"No designs found. Create your first design to get started!"})})})})]})})};function as(g,A){return A.forEach(function(U){U&&typeof U!="string"&&!Array.isArray(U)&&Object.keys(U).forEach(function(d){if(d!=="default"&&!(d in g)){var e=Object.getOwnPropertyDescriptor(U,d);Object.defineProperty(g,d,e.get?e:{enumerable:!0,get:function(){return U[d]}})}})}),Object.freeze(g)}function br(g,A){return new Promise(function(U,d){let e;return ls(g).then(function(t){try{return e=t,U(new Blob([A.slice(0,2),e,A.slice(2)],{type:"image/jpeg"}))}catch(l){return d(l)}},d)})}const ls=g=>new Promise((A,U)=>{const d=new FileReader;d.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let l=0;if(t.getUint16(l)!==65496)return U("not a valid JPEG");for(l+=2;;){const a=t.getUint16(l);if(a===65498)break;const b=t.getUint16(l+2);if(a===65505&&t.getUint32(l+4)===1165519206){const y=l+10;let n;switch(t.getUint16(y)){case 18761:n=!0;break;case 19789:n=!1;break;default:return U("TIFF header contains invalid endian")}if(t.getUint16(y+2,n)!==42)return U("TIFF header contains invalid version");const s=t.getUint32(y+4,n),r=y+s+2+12*t.getUint16(y+s,n);for(let c=y+s+2;c<r;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return U("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return U("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return A(e.slice(l,l+2+b))}l+=2+b}return A(new Blob)}),d.readAsArrayBuffer(g)});var Jt={},ds={get exports(){return Jt},set exports(g){Jt=g}};(function(g){var A,U,d={};ds.exports=d,d.parse=function(e,t){for(var l=d.bin.readUshort,a=d.bin.readUint,b=0,y={},n=new Uint8Array(e),s=n.length-4;a(n,s)!=101010256;)s--;b=s,b+=4;var r=l(n,b+=4);l(n,b+=2);var c=a(n,b+=2),m=a(n,b+=4);b+=4,b=m;for(var F=0;F<r;F++){a(n,b),b+=4,b+=4,b+=4,a(n,b+=4),c=a(n,b+=4);var D=a(n,b+=4),S=l(n,b+=4),z=l(n,b+2),M=l(n,b+4);b+=6;var R=a(n,b+=8);b+=4,b+=S+z+M,d._readLocal(n,R,y,c,D,t)}return y},d._readLocal=function(e,t,l,a,b,y){var n=d.bin.readUshort,s=d.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var c=n(e,t+=8),m=n(e,t+=2);t+=2;var F=d.bin.readUTF8(e,t,c);if(t+=c,t+=m,y)l[F]={size:b,csize:a};else{var D=new Uint8Array(e.buffer,t);if(r==0)l[F]=new Uint8Array(D.buffer.slice(t,t+a));else{if(r!=8)throw"unknown compression method: "+r;var S=new Uint8Array(b);d.inflateRaw(D,S),l[F]=S}}},d.inflateRaw=function(e,t){return d.F.inflate(e,t)},d.inflate=function(e,t){return e[0],e[1],d.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},d.deflate=function(e,t){t==null&&(t={level:6});var l=0,a=new Uint8Array(50+Math.floor(1.1*e.length));a[l]=120,a[l+1]=156,l+=2,l=d.F.deflateRaw(e,a,l,t.level);var b=d.adler(e,0,e.length);return a[l+0]=b>>>24&255,a[l+1]=b>>>16&255,a[l+2]=b>>>8&255,a[l+3]=b>>>0&255,new Uint8Array(a.buffer,0,l+4)},d.deflateRaw=function(e,t){t==null&&(t={level:6});var l=new Uint8Array(50+Math.floor(1.1*e.length)),a=d.F.deflateRaw(e,l,a,t.level);return new Uint8Array(l.buffer,0,a)},d.encode=function(e,t){t==null&&(t=!1);var l=0,a=d.bin.writeUint,b=d.bin.writeUshort,y={};for(var n in e){var s=!d._noNeed(n)&&!t,r=e[n],c=d.crc.crc(r,0,r.length);y[n]={cpr:s,usize:r.length,crc:c,file:s?d.deflateRaw(r):r}}for(var n in y)l+=y[n].file.length+30+46+2*d.bin.sizeUTF8(n);l+=22;var m=new Uint8Array(l),F=0,D=[];for(var n in y){var S=y[n];D.push(F),F=d._writeHeader(m,F,n,S,0)}var z=0,M=F;for(var n in y)S=y[n],D.push(F),F=d._writeHeader(m,F,n,S,1,D[z++]);var R=F-M;return a(m,F,101010256),F+=4,b(m,F+=4,z),b(m,F+=2,z),a(m,F+=2,R),a(m,F+=4,M),F+=4,F+=2,m.buffer},d._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},d._writeHeader=function(e,t,l,a,b,y){var n=d.bin.writeUint,s=d.bin.writeUshort,r=a.file;return n(e,t,b==0?67324752:33639248),t+=4,b==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,a.cpr?8:0),n(e,t+=2,0),n(e,t+=4,a.crc),n(e,t+=4,r.length),n(e,t+=4,a.usize),s(e,t+=4,d.bin.sizeUTF8(l)),s(e,t+=2,0),t+=2,b==1&&(t+=2,t+=2,n(e,t+=6,y),t+=4),t+=d.bin.writeUTF8(e,t,l),b==0&&(e.set(r,t),t+=r.length),t},d.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var l=t,a=0;a<8;a++)1&l?l=3988292384^l>>>1:l>>>=1;e[t]=l}return e}(),update:function(e,t,l,a){for(var b=0;b<a;b++)e=d.crc.table[255&(e^t[l+b])]^e>>>8;return e},crc:function(e,t,l){return 4294967295^d.crc.update(4294967295,e,t,l)}},d.adler=function(e,t,l){for(var a=1,b=0,y=t,n=t+l;y<n;){for(var s=Math.min(y+5552,n);y<s;)b+=a+=e[y++];a%=65521,b%=65521}return b<<16|a},d.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255,e[t+2]=l>>16&255,e[t+3]=l>>24&255},readASCII:function(e,t,l){for(var a="",b=0;b<l;b++)a+=String.fromCharCode(e[t+b]);return a},writeASCII:function(e,t,l){for(var a=0;a<l.length;a++)e[t+a]=l.charCodeAt(a)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,l){for(var a,b="",y=0;y<l;y++)b+="%"+d.bin.pad(e[t+y].toString(16));try{a=decodeURIComponent(b)}catch{return d.bin.readASCII(e,t,l)}return a},writeUTF8:function(e,t,l){for(var a=l.length,b=0,y=0;y<a;y++){var n=l.charCodeAt(y);if((4294967168&n)==0)e[t+b]=n,b++;else if((4294965248&n)==0)e[t+b]=192|n>>6,e[t+b+1]=128|n>>0&63,b+=2;else if((4294901760&n)==0)e[t+b]=224|n>>12,e[t+b+1]=128|n>>6&63,e[t+b+2]=128|n>>0&63,b+=3;else{if((4292870144&n)!=0)throw"e";e[t+b]=240|n>>18,e[t+b+1]=128|n>>12&63,e[t+b+2]=128|n>>6&63,e[t+b+3]=128|n>>0&63,b+=4}}return b},sizeUTF8:function(e){for(var t=e.length,l=0,a=0;a<t;a++){var b=e.charCodeAt(a);if((4294967168&b)==0)l++;else if((4294965248&b)==0)l+=2;else if((4294901760&b)==0)l+=3;else{if((4292870144&b)!=0)throw"e";l+=4}}return l}},d.F={},d.F.deflateRaw=function(e,t,l,a){var b=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],y=d.F.U,n=d.F._goodIndex;d.F._hash;var s=d.F._putsE,r=0,c=l<<3,m=0,F=e.length;if(a==0){for(;r<F;)s(t,c,r+(j=Math.min(65535,F-r))==F?1:0),c=d.F._copyExact(e,r,j,t,c+8),r+=j;return c>>>3}var D=y.lits,S=y.strt,z=y.prev,M=0,R=0,B=0,v=0,E=0,f=0;for(F>2&&(S[f=d.F._hash(e,0)]=0),r=0;r<F;r++){if(E=f,r+1<F-2){f=d.F._hash(e,r+1);var u=r+1&32767;z[u]=S[f],S[f]=u}if(m<=r){(M>14e3||R>26697)&&F-r>100&&(m<r&&(D[M]=r-m,M+=2,m=r),c=d.F._writeBlock(r==F-1||m==F?1:0,D,M,v,e,B,r-B,t,c),M=R=v=0,B=r);var p=0;r<F-2&&(p=d.F._bestMatch(e,r,z,E,Math.min(b[2],F-r),b[3]));var j=p>>>16,w=65535&p;if(p!=0){w=65535&p;var C=n(j=p>>>16,y.of0);y.lhst[257+C]++;var x=n(w,y.df0);y.dhst[x]++,v+=y.exb[C]+y.dxb[x],D[M]=j<<23|r-m,D[M+1]=w<<16|C<<8|x,M+=2,m=r+j}else y.lhst[e[r]]++;R++}}for(B==r&&e.length!=0||(m<r&&(D[M]=r-m,M+=2,m=r),c=d.F._writeBlock(1,D,M,v,e,B,r-B,t,c),M=0,R=0,M=R=v=0,B=r);(7&c)!=0;)c++;return c>>>3},d.F._bestMatch=function(e,t,l,a,b,y){var n=32767&t,s=l[n],r=n-s+32768&32767;if(s==n||a!=d.F._hash(e,t-r))return 0;for(var c=0,m=0,F=Math.min(32767,t);r<=F&&--y!=0&&s!=n;){if(c==0||e[t+c]==e[t+c-r]){var D=d.F._howLong(e,t,r);if(D>c){if(m=r,(c=D)>=b)break;r+2<D&&(D=r+2);for(var S=0,z=0;z<D-2;z++){var M=t-r+z+32768&32767,R=M-l[M]+32768&32767;R>S&&(S=R,s=M)}}}r+=(n=s)-(s=l[n])+32768&32767}return c<<16|m},d.F._howLong=function(e,t,l){if(e[t]!=e[t-l]||e[t+1]!=e[t+1-l]||e[t+2]!=e[t+2-l])return 0;var a=t,b=Math.min(e.length,t+258);for(t+=3;t<b&&e[t]==e[t-l];)t++;return t-a},d.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},d.saved=0,d.F._writeBlock=function(e,t,l,a,b,y,n,s,r){var c,m,F,D,S,z,M,R,B,v=d.F.U,E=d.F._putsF,f=d.F._putsE;v.lhst[256]++,m=(c=d.F.getTrees())[0],F=c[1],D=c[2],S=c[3],z=c[4],M=c[5],R=c[6],B=c[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),p=a+d.F.contSize(v.fltree,v.lhst)+d.F.contSize(v.fdtree,v.dhst),j=a+d.F.contSize(v.ltree,v.lhst)+d.F.contSize(v.dtree,v.dhst);j+=14+3*M+d.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var w=0;w<286;w++)v.lhst[w]=0;for(w=0;w<30;w++)v.dhst[w]=0;for(w=0;w<19;w++)v.ihst[w]=0;var C=u<p&&u<j?0:p<j?1:2;if(E(s,r,e),E(s,r+1,C),r+=3,C==0){for(;(7&r)!=0;)r++;r=d.F._copyExact(b,y,n,s,r)}else{var x,T;if(C==1&&(x=v.fltree,T=v.fdtree),C==2){d.F.makeCodes(v.ltree,m),d.F.revCodes(v.ltree,m),d.F.makeCodes(v.dtree,F),d.F.revCodes(v.dtree,F),d.F.makeCodes(v.itree,D),d.F.revCodes(v.itree,D),x=v.ltree,T=v.dtree,f(s,r,S-257),f(s,r+=5,z-1),f(s,r+=5,M-4),r+=4;for(var h=0;h<M;h++)f(s,r+3*h,v.itree[1+(v.ordr[h]<<1)]);r+=3*M,r=d.F._codeTiny(R,v.itree,s,r),r=d.F._codeTiny(B,v.itree,s,r)}for(var o=y,_=0;_<l;_+=2){for(var I=t[_],P=I>>>23,$=o+(8388607&I);o<$;)r=d.F._writeLit(b[o++],x,s,r);if(P!=0){var q=t[_+1],V=q>>16,W=q>>8&255,O=255&q;f(s,r=d.F._writeLit(257+W,x,s,r),P-v.of0[W]),r+=v.exb[W],E(s,r=d.F._writeLit(O,T,s,r),V-v.df0[O]),r+=v.dxb[O],o+=P}}r=d.F._writeLit(256,x,s,r)}return r},d.F._copyExact=function(e,t,l,a,b){var y=b>>>3;return a[y]=l,a[y+1]=l>>>8,a[y+2]=255-a[y],a[y+3]=255-a[y+1],y+=4,a.set(new Uint8Array(e.buffer,t,l),y),b+(l+4<<3)},d.F.getTrees=function(){for(var e=d.F.U,t=d.F._hufTree(e.lhst,e.ltree,15),l=d.F._hufTree(e.dhst,e.dtree,15),a=[],b=d.F._lenCodes(e.ltree,a),y=[],n=d.F._lenCodes(e.dtree,y),s=0;s<a.length;s+=2)e.ihst[a[s]]++;for(s=0;s<y.length;s+=2)e.ihst[y[s]]++;for(var r=d.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,l,r,b,n,c,a,y]},d.F.getSecond=function(e){for(var t=[],l=0;l<e.length;l+=2)t.push(e[l+1]);return t},d.F.nonZero=function(e){for(var t="",l=0;l<e.length;l+=2)e[l+1]!=0&&(t+=(l>>1)+",");return t},d.F.contSize=function(e,t){for(var l=0,a=0;a<t.length;a++)l+=t[a]*e[1+(a<<1)];return l},d.F._codeTiny=function(e,t,l,a){for(var b=0;b<e.length;b+=2){var y=e[b],n=e[b+1];a=d.F._writeLit(y,t,l,a);var s=y==16?2:y==17?3:7;y>15&&(d.F._putsE(l,a,n,s),a+=s)}return a},d.F._lenCodes=function(e,t){for(var l=e.length;l!=2&&e[l-1]==0;)l-=2;for(var a=0;a<l;a+=2){var b=e[a+1],y=a+3<l?e[a+3]:-1,n=a+5<l?e[a+5]:-1,s=a==0?-1:e[a-1];if(b==0&&y==b&&n==b){for(var r=a+5;r+2<l&&e[r+2]==b;)r+=2;(c=Math.min(r+1-a>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),a+=2*c-2}else if(b==s&&y==b&&n==b){for(r=a+5;r+2<l&&e[r+2]==b;)r+=2;var c=Math.min(r+1-a>>>1,6);t.push(16,c-3),a+=2*c-2}else t.push(b,0)}return l>>>1},d.F._hufTree=function(e,t,l){var a=[],b=e.length,y=t.length,n=0;for(n=0;n<y;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<b;n++)e[n]!=0&&a.push({lit:n,f:e[n]});var s=a.length,r=a.slice(0);if(s==0)return 0;if(s==1){var c=a[0].lit;return r=c==0?1:0,t[1+(c<<1)]=1,t[1+(r<<1)]=1,1}a.sort(function(R,B){return R.f-B.f});var m=a[0],F=a[1],D=0,S=1,z=2;for(a[0]={lit:-1,f:m.f+F.f,l:m,r:F,d:0};S!=s-1;)m=D!=S&&(z==s||a[D].f<a[z].f)?a[D++]:a[z++],F=D!=S&&(z==s||a[D].f<a[z].f)?a[D++]:a[z++],a[S++]={lit:-1,f:m.f+F.f,l:m,r:F};var M=d.F.setDepth(a[S-1],0);for(M>l&&(d.F.restrictDepth(r,l,M),M=l),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return M},d.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(d.F.setDepth(e.l,t+1),d.F.setDepth(e.r,t+1))},d.F.restrictDepth=function(e,t,l){var a=0,b=1<<l-t,y=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),a=0;a<e.length&&e[a].d>t;a++){var n=e[a].d;e[a].d=t,y+=b-(1<<l-n)}for(y>>>=l-t;y>0;)(n=e[a].d)<t?(e[a].d++,y-=1<<t-n-1):a++;for(;a>=0;a--)e[a].d==t&&y<0&&(e[a].d--,y++);y!=0&&console.log("debt left")},d.F._goodIndex=function(e,t){var l=0;return t[16|l]<=e&&(l|=16),t[8|l]<=e&&(l|=8),t[4|l]<=e&&(l|=4),t[2|l]<=e&&(l|=2),t[1|l]<=e&&(l|=1),l},d.F._writeLit=function(e,t,l,a){return d.F._putsF(l,a,t[e<<1]),a+t[1+(e<<1)]},d.F.inflate=function(e,t){var l=Uint8Array;if(e[0]==3&&e[1]==0)return t||new l(0);var a=d.F,b=a._bitsF,y=a._bitsE,n=a._decodeTiny,s=a.makeCodes,r=a.codes2map,c=a._get17,m=a.U,F=t==null;F&&(t=new l(e.length>>>2<<3));for(var D,S,z=0,M=0,R=0,B=0,v=0,E=0,f=0,u=0,p=0;z==0;)if(z=b(e,p,1),M=b(e,p+1,2),p+=3,M!=0){if(F&&(t=d.F._check(t,u+(1<<17))),M==1&&(D=m.flmap,S=m.fdmap,E=511,f=31),M==2){R=y(e,p,5)+257,B=y(e,p+5,5)+1,v=y(e,p+10,4)+4,p+=14;for(var j=0;j<38;j+=2)m.itree[j]=0,m.itree[j+1]=0;var w=1;for(j=0;j<v;j++){var C=y(e,p+3*j,3);m.itree[1+(m.ordr[j]<<1)]=C,C>w&&(w=C)}p+=3*v,s(m.itree,w),r(m.itree,w,m.imap),D=m.lmap,S=m.dmap,p=n(m.imap,(1<<w)-1,R+B,e,p,m.ttree);var x=a._copyOut(m.ttree,0,R,m.ltree);E=(1<<x)-1;var T=a._copyOut(m.ttree,R,B,m.dtree);f=(1<<T)-1,s(m.ltree,x),r(m.ltree,x,D),s(m.dtree,T),r(m.dtree,T,S)}for(;;){var h=D[c(e,p)&E];p+=15&h;var o=h>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var _=u+o-254;if(o>264){var I=m.ldef[o-257];_=u+(I>>>3)+y(e,p,7&I),p+=7&I}var P=S[c(e,p)&f];p+=15&P;var $=P>>>4,q=m.ddef[$],V=(q>>>4)+b(e,p,15&q);for(p+=15&q,F&&(t=d.F._check(t,u+(1<<17)));u<_;)t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V];u=_}}}else{(7&p)!=0&&(p+=8-(7&p));var W=4+(p>>>3),O=e[W-4]|e[W-3]<<8;F&&(t=d.F._check(t,u+O)),t.set(new l(e.buffer,e.byteOffset+W,O),u),p=W+O<<3,u+=O}return t.length==u?t:t.slice(0,u)},d.F._check=function(e,t){var l=e.length;if(t<=l)return e;var a=new Uint8Array(Math.max(l<<1,t));return a.set(e,0),a},d.F._decodeTiny=function(e,t,l,a,b,y){for(var n=d.F._bitsE,s=d.F._get17,r=0;r<l;){var c=e[s(a,b)&t];b+=15&c;var m=c>>>4;if(m<=15)y[r]=m,r++;else{var F=0,D=0;m==16?(D=3+n(a,b,2),b+=2,F=y[r-1]):m==17?(D=3+n(a,b,3),b+=3):m==18&&(D=11+n(a,b,7),b+=7);for(var S=r+D;r<S;)y[r]=F,r++}}return b},d.F._copyOut=function(e,t,l,a){for(var b=0,y=0,n=a.length>>>1;y<l;){var s=e[y+t];a[y<<1]=0,a[1+(y<<1)]=s,s>b&&(b=s),y++}for(;y<n;)a[y<<1]=0,a[1+(y<<1)]=0,y++;return b},d.F.makeCodes=function(e,t){for(var l,a,b,y,n=d.F.U,s=e.length,r=n.bl_count,c=0;c<=t;c++)r[c]=0;for(c=1;c<s;c+=2)r[e[c]]++;var m=n.next_code;for(l=0,r[0]=0,a=1;a<=t;a++)l=l+r[a-1]<<1,m[a]=l;for(b=0;b<s;b+=2)(y=e[b+1])!=0&&(e[b]=m[y],m[y]++)},d.F.codes2map=function(e,t,l){for(var a=e.length,b=d.F.U.rev15,y=0;y<a;y+=2)if(e[y+1]!=0)for(var n=y>>1,s=e[y+1],r=n<<4|s,c=t-s,m=e[y]<<c,F=m+(1<<c);m!=F;)l[b[m]>>>15-t]=r,m++},d.F.revCodes=function(e,t){for(var l=d.F.U.rev15,a=15-t,b=0;b<e.length;b+=2){var y=e[b]<<t-e[b+1];e[b]=l[y]>>>a}},d.F._putsE=function(e,t,l){l<<=7&t;var a=t>>>3;e[a]|=l,e[a+1]|=l>>>8},d.F._putsF=function(e,t,l){l<<=7&t;var a=t>>>3;e[a]|=l,e[a+1]|=l>>>8,e[a+2]|=l>>>16},d.F._bitsE=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<l)-1},d.F._bitsF=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<l)-1},d.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},d.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},d.F.U=(A=Uint16Array,U=Uint32Array,{next_code:new A(16),bl_count:new A(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new A(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new U(32),flmap:new A(512),fltree:[],fdmap:new A(32),fdtree:[],lmap:new A(32768),ltree:[],ttree:[],dmap:new A(32768),dtree:[],imap:new A(512),itree:[],rev15:new A(32768),lhst:new U(286),dhst:new U(30),ihst:new U(19),lits:new U(15e3),strt:new A(65536),prev:new A(32768)}),function(){for(var e=d.F.U,t=0;t<32768;t++){var l=t;l=(4278255360&(l=(4042322160&(l=(3435973836&(l=(2863311530&l)>>>1|(1431655765&l)<<1))>>>2|(858993459&l)<<2))>>>4|(252645135&l)<<4))>>>8|(16711935&l)<<8,e.rev15[t]=(l>>>16|l<<16)>>>17}function a(b,y,n){for(;y--!=0;)b.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];a(e.fltree,144,8),a(e.fltree,112,9),a(e.fltree,24,7),a(e.fltree,8,8),d.F.makeCodes(e.fltree,9),d.F.codes2map(e.fltree,9,e.flmap),d.F.revCodes(e.fltree,9),a(e.fdtree,32,5),d.F.makeCodes(e.fdtree,5),d.F.codes2map(e.fdtree,5,e.fdmap),d.F.revCodes(e.fdtree,5),a(e.itree,19,0),a(e.ltree,286,0),a(e.dtree,30,0),a(e.ttree,320,0)}()})();var cs=as({__proto__:null,default:Jt},[Jt]);const We=function(){var g={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let c="";for(let m=0;m<r;m++)c+=String.fromCharCode(n[s+m]);return c},writeASCII(n,s,r){for(let c=0;c<r.length;c++)n[s+c]=r.charCodeAt(c)},readBytes(n,s,r){const c=[];for(let m=0;m<r;m++)c.push(n[s+m]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let c,m="";for(let F=0;F<r;F++)m+=`%${g.pad(n[s+F].toString(16))}`;try{c=decodeURIComponent(m)}catch{return g.readASCII(n,s,r)}return c}};function A(n,s,r,c){const m=s*r,F=t(c),D=Math.ceil(s*F/8),S=new Uint8Array(4*m),z=new Uint32Array(S.buffer),{ctype:M}=c,{depth:R}=c,B=g.readUshort;if(M==6){const I=m<<2;if(R==8)for(var v=0;v<I;v+=4)S[v]=n[v],S[v+1]=n[v+1],S[v+2]=n[v+2],S[v+3]=n[v+3];if(R==16)for(v=0;v<I;v++)S[v]=n[v<<1]}else if(M==2){const I=c.tabs.tRNS;if(I==null){if(R==8)for(v=0;v<m;v++){var E=3*v;z[v]=255<<24|n[E+2]<<16|n[E+1]<<8|n[E]}if(R==16)for(v=0;v<m;v++)E=6*v,z[v]=255<<24|n[E+4]<<16|n[E+2]<<8|n[E]}else{var f=I[0];const P=I[1],$=I[2];if(R==8)for(v=0;v<m;v++){var u=v<<2;E=3*v,z[v]=255<<24|n[E+2]<<16|n[E+1]<<8|n[E],n[E]==f&&n[E+1]==P&&n[E+2]==$&&(S[u+3]=0)}if(R==16)for(v=0;v<m;v++)u=v<<2,E=6*v,z[v]=255<<24|n[E+4]<<16|n[E+2]<<8|n[E],B(n,E)==f&&B(n,E+2)==P&&B(n,E+4)==$&&(S[u+3]=0)}}else if(M==3){const I=c.tabs.PLTE,P=c.tabs.tRNS,$=P?P.length:0;if(R==1)for(var p=0;p<r;p++){var j=p*D,w=p*s;for(v=0;v<s;v++){u=w+v<<2;var C=3*(x=n[j+(v>>3)]>>7-((7&v)<<0)&1);S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=x<$?P[x]:255}}if(R==2)for(p=0;p<r;p++)for(j=p*D,w=p*s,v=0;v<s;v++)u=w+v<<2,C=3*(x=n[j+(v>>2)]>>6-((3&v)<<1)&3),S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=x<$?P[x]:255;if(R==4)for(p=0;p<r;p++)for(j=p*D,w=p*s,v=0;v<s;v++)u=w+v<<2,C=3*(x=n[j+(v>>1)]>>4-((1&v)<<2)&15),S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=x<$?P[x]:255;if(R==8)for(v=0;v<m;v++){var x;u=v<<2,C=3*(x=n[v]),S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=x<$?P[x]:255}}else if(M==4){if(R==8)for(v=0;v<m;v++){u=v<<2;var T=n[h=v<<1];S[u]=T,S[u+1]=T,S[u+2]=T,S[u+3]=n[h+1]}if(R==16)for(v=0;v<m;v++){var h;u=v<<2,T=n[h=v<<2],S[u]=T,S[u+1]=T,S[u+2]=T,S[u+3]=n[h+2]}}else if(M==0)for(f=c.tabs.tRNS?c.tabs.tRNS:-1,p=0;p<r;p++){const I=p*D,P=p*s;if(R==1)for(var o=0;o<s;o++){var _=(T=255*(n[I+(o>>>3)]>>>7-(7&o)&1))==255*f?0:255;z[P+o]=_<<24|T<<16|T<<8|T}else if(R==2)for(o=0;o<s;o++)_=(T=85*(n[I+(o>>>2)]>>>6-((3&o)<<1)&3))==85*f?0:255,z[P+o]=_<<24|T<<16|T<<8|T;else if(R==4)for(o=0;o<s;o++)_=(T=17*(n[I+(o>>>1)]>>>4-((1&o)<<2)&15))==17*f?0:255,z[P+o]=_<<24|T<<16|T<<8|T;else if(R==8)for(o=0;o<s;o++)_=(T=n[I+o])==f?0:255,z[P+o]=_<<24|T<<16|T<<8|T;else if(R==16)for(o=0;o<s;o++)T=n[I+(o<<1)],_=B(n,I+(o<<1))==f?0:255,z[P+o]=_<<24|T<<16|T<<8|T}return S}function U(n,s,r,c){const m=t(n),F=Math.ceil(r*m/8),D=new Uint8Array((F+1+n.interlace)*c);return s=n.tabs.CgBI?e(s,D):d(s,D),n.interlace==0?s=l(s,n,0,r,c):n.interlace==1&&(s=function(z,M){const R=M.width,B=M.height,v=t(M),E=v>>3,f=Math.ceil(R*v/8),u=new Uint8Array(B*f);let p=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let T=0;for(;T<7;){const o=C[T],_=x[T];let I=0,P=0,$=j[T];for(;$<B;)$+=o,P++;let q=w[T];for(;q<R;)q+=_,I++;const V=Math.ceil(I*v/8);l(z,M,p,I,P);let W=0,O=j[T];for(;O<B;){let X=w[T],re=p+W*V<<3;for(;X<R;){var h;if(v==1&&(h=(h=z[re>>3])>>7-(7&re)&1,u[O*f+(X>>3)]|=h<<7-((7&X)<<0)),v==2&&(h=(h=z[re>>3])>>6-(7&re)&3,u[O*f+(X>>2)]|=h<<6-((3&X)<<1)),v==4&&(h=(h=z[re>>3])>>4-(7&re)&15,u[O*f+(X>>1)]|=h<<4-((1&X)<<2)),v>=8){const J=O*f+X*E;for(let te=0;te<E;te++)u[J+te]=z[(re>>3)+te]}re+=v,X+=_}W++,O+=o}I*P!=0&&(p+=P*(1+V)),T+=1}return u}(s,n)),s}function d(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const c=Uint8Array;let m,F,D=0,S=0,z=0,M=0,R=0,B=0,v=0,E=0,f=0;if(s[0]==3&&s[1]==0)return r||new c(0);const u=n.H,p=u.b,j=u.e,w=u.R,C=u.n,x=u.A,T=u.Z,h=u.m,o=r==null;for(o&&(r=new c(s.length>>>2<<5));D==0;)if(D=p(s,f,1),S=p(s,f+1,2),f+=3,S!=0){if(o&&(r=n.H.W(r,E+(1<<17))),S==1&&(m=h.J,F=h.h,B=511,v=31),S==2){z=j(s,f,5)+257,M=j(s,f+5,5)+1,R=j(s,f+10,4)+4,f+=14;let I=1;for(var _=0;_<38;_+=2)h.Q[_]=0,h.Q[_+1]=0;for(_=0;_<R;_++){const q=j(s,f+3*_,3);h.Q[1+(h.X[_]<<1)]=q,q>I&&(I=q)}f+=3*R,C(h.Q,I),x(h.Q,I,h.u),m=h.w,F=h.d,f=w(h.u,(1<<I)-1,z+M,s,f,h.v);const P=u.V(h.v,0,z,h.C);B=(1<<P)-1;const $=u.V(h.v,z,M,h.D);v=(1<<$)-1,C(h.C,P),x(h.C,P,m),C(h.D,$),x(h.D,$,F)}for(;;){const I=m[T(s,f)&B];f+=15&I;const P=I>>>4;if(!(P>>>8))r[E++]=P;else{if(P==256)break;{let $=E+P-254;if(P>264){const X=h.q[P-257];$=E+(X>>>3)+j(s,f,7&X),f+=7&X}const q=F[T(s,f)&v];f+=15&q;const V=q>>>4,W=h.c[V],O=(W>>>4)+p(s,f,15&W);for(f+=15&W;E<$;)r[E]=r[E++-O],r[E]=r[E++-O],r[E]=r[E++-O],r[E]=r[E++-O];E=$}}}}else{(7&f)!=0&&(f+=8-(7&f));const I=4+(f>>>3),P=s[I-4]|s[I-3]<<8;o&&(r=n.H.W(r,E+P)),r.set(new c(s.buffer,s.byteOffset+I,P),E),f=I+P<<3,E+=P}return r.length==E?r:r.slice(0,E)},n.H.W=function(s,r){const c=s.length;if(r<=c)return s;const m=new Uint8Array(c<<1);return m.set(s,0),m},n.H.R=function(s,r,c,m,F,D){const S=n.H.e,z=n.H.Z;let M=0;for(;M<c;){const R=s[z(m,F)&r];F+=15&R;const B=R>>>4;if(B<=15)D[M]=B,M++;else{let v=0,E=0;B==16?(E=3+S(m,F,2),F+=2,v=D[M-1]):B==17?(E=3+S(m,F,3),F+=3):B==18&&(E=11+S(m,F,7),F+=7);const f=M+E;for(;M<f;)D[M]=v,M++}}return F},n.H.V=function(s,r,c,m){let F=0,D=0;const S=m.length>>>1;for(;D<c;){const z=s[D+r];m[D<<1]=0,m[1+(D<<1)]=z,z>F&&(F=z),D++}for(;D<S;)m[D<<1]=0,m[1+(D<<1)]=0,D++;return F},n.H.n=function(s,r){const c=n.H.m,m=s.length;let F,D,S,z;const M=c.j;for(var R=0;R<=r;R++)M[R]=0;for(R=1;R<m;R+=2)M[s[R]]++;const B=c.K;for(F=0,M[0]=0,D=1;D<=r;D++)F=F+M[D-1]<<1,B[D]=F;for(S=0;S<m;S+=2)z=s[S+1],z!=0&&(s[S]=B[z],B[z]++)},n.H.A=function(s,r,c){const m=s.length,F=n.H.m.r;for(let D=0;D<m;D+=2)if(s[D+1]!=0){const S=D>>1,z=s[D+1],M=S<<4|z,R=r-z;let B=s[D]<<R;const v=B+(1<<R);for(;B!=v;)c[F[B]>>>15-r]=M,B++}},n.H.l=function(s,r){const c=n.H.m.r,m=15-r;for(let F=0;F<s.length;F+=2){const D=s[F]<<r-s[F+1];s[F]=c[D]>>>m}},n.H.M=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8},n.H.I=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8,s[m+2]|=c>>>16},n.H.e=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<c)-1},n.H.b=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<c)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let m=r;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,s.r[r]=(m>>>16|m<<16)>>>17}function c(m,F,D){for(;F--!=0;)m.push(0,D)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];c(s._,144,8),c(s._,112,9),c(s._,24,7),c(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),c(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),c(s.Q,19,0),c(s.C,286,0),c(s.D,30,0),c(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function l(n,s,r,c,m){let F=t(s);const D=Math.ceil(c*F/8);let S,z;F=Math.ceil(F/8);let M=n[r],R=0;if(M>1&&(n[r]=[0,0,1][M-2]),M==3)for(R=F;R<D;R++)n[R+1]=n[R+1]+(n[R+1-F]>>>1)&255;for(let B=0;B<m;B++)if(S=r+B*D,z=S+B+1,M=n[z-1],R=0,M==0)for(;R<D;R++)n[S+R]=n[z+R];else if(M==1){for(;R<F;R++)n[S+R]=n[z+R];for(;R<D;R++)n[S+R]=n[z+R]+n[S+R-F]}else if(M==2)for(;R<D;R++)n[S+R]=n[z+R]+n[S+R-D];else if(M==3){for(;R<F;R++)n[S+R]=n[z+R]+(n[S+R-D]>>>1);for(;R<D;R++)n[S+R]=n[z+R]+(n[S+R-D]+n[S+R-F]>>>1)}else{for(;R<F;R++)n[S+R]=n[z+R]+a(0,n[S+R-D],0);for(;R<D;R++)n[S+R]=n[z+R]+a(n[S+R-F],n[S+R-D],n[S+R-F-D])}return n}function a(n,s,r){const c=n+s-r,m=c-n,F=c-s,D=c-r;return m*m<=F*F&&m*m<=D*D?n:F*F<=D*D?s:r}function b(n,s,r){r.width=g.readUint(n,s),s+=4,r.height=g.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function y(n,s,r,c,m,F,D,S,z){const M=Math.min(s,m),R=Math.min(r,F);let B=0,v=0;for(let T=0;T<R;T++)for(let h=0;h<M;h++)if(D>=0&&S>=0?(B=T*s+h<<2,v=(S+T)*m+D+h<<2):(B=(-S+T)*s-D+h<<2,v=T*m+h<<2),z==0)c[v]=n[B],c[v+1]=n[B+1],c[v+2]=n[B+2],c[v+3]=n[B+3];else if(z==1){var E=n[B+3]*.00392156862745098,f=n[B]*E,u=n[B+1]*E,p=n[B+2]*E,j=c[v+3]*(1/255),w=c[v]*j,C=c[v+1]*j,x=c[v+2]*j;const o=1-E,_=E+j*o,I=_==0?0:1/_;c[v+3]=255*_,c[v+0]=(f+w*o)*I,c[v+1]=(u+C*o)*I,c[v+2]=(p+x*o)*I}else if(z==2)E=n[B+3],f=n[B],u=n[B+1],p=n[B+2],j=c[v+3],w=c[v],C=c[v+1],x=c[v+2],E==j&&f==w&&u==C&&p==x?(c[v]=0,c[v+1]=0,c[v+2]=0,c[v+3]=0):(c[v]=f,c[v+1]=u,c[v+2]=p,c[v+3]=E);else if(z==3){if(E=n[B+3],f=n[B],u=n[B+1],p=n[B+2],j=c[v+3],w=c[v],C=c[v+1],x=c[v+2],E==j&&f==w&&u==C&&p==x)continue;if(E<220&&j>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let c=8;const m=g,F=m.readUshort,D=m.readUint,S={tabs:{},frames:[]},z=new Uint8Array(r.length);let M,R=0,B=0;const v=[137,80,78,71,13,10,26,10];for(var E=0;E<8;E++)if(r[E]!=v[E])throw"The input is not a PNG file!";for(;c<r.length;){const T=m.readUint(r,c);c+=4;const h=m.readASCII(r,c,4);if(c+=4,h=="IHDR")b(r,c,S);else if(h=="iCCP"){for(var f=c;r[f]!=0;)f++;m.readASCII(r,c,f-c),r[f+1];const o=r.slice(f+2,c+T);let _=null;try{_=d(o)}catch{_=e(o)}S.tabs[h]=_}else if(h=="CgBI")S.tabs[h]=r.slice(c,c+4);else if(h=="IDAT"){for(E=0;E<T;E++)z[R+E]=r[c+E];R+=T}else if(h=="acTL")S.tabs[h]={num_frames:D(r,c),num_plays:D(r,c+4)},M=new Uint8Array(r.length);else if(h=="fcTL"){B!=0&&((x=S.frames[S.frames.length-1]).data=U(S,M.slice(0,B),x.rect.width,x.rect.height),B=0);const o={x:D(r,c+12),y:D(r,c+16),width:D(r,c+4),height:D(r,c+8)};let _=F(r,c+22);_=F(r,c+20)/(_==0?100:_);const I={rect:o,delay:Math.round(1e3*_),dispose:r[c+24],blend:r[c+25]};S.frames.push(I)}else if(h=="fdAT"){for(E=0;E<T-4;E++)M[B+E]=r[c+E+4];B+=T-4}else if(h=="pHYs")S.tabs[h]=[m.readUint(r,c),m.readUint(r,c+4),r[c+8]];else if(h=="cHRM")for(S.tabs[h]=[],E=0;E<8;E++)S.tabs[h].push(m.readUint(r,c+4*E));else if(h=="tEXt"||h=="zTXt"){S.tabs[h]==null&&(S.tabs[h]={});var u=m.nextZero(r,c),p=m.readASCII(r,c,u-c),j=c+T-u-1;if(h=="tEXt")C=m.readASCII(r,u+1,j);else{var w=d(r.slice(u+2,u+2+j));C=m.readUTF8(w,0,w.length)}S.tabs[h][p]=C}else if(h=="iTXt"){S.tabs[h]==null&&(S.tabs[h]={}),u=0,f=c,u=m.nextZero(r,f),p=m.readASCII(r,f,u-f);const o=r[f=u+1];var C;r[f+1],f+=2,u=m.nextZero(r,f),m.readASCII(r,f,u-f),f=u+1,u=m.nextZero(r,f),m.readUTF8(r,f,u-f),j=T-((f=u+1)-c),o==0?C=m.readUTF8(r,f,j):(w=d(r.slice(f,f+j)),C=m.readUTF8(w,0,w.length)),S.tabs[h][p]=C}else if(h=="PLTE")S.tabs[h]=m.readBytes(r,c,T);else if(h=="hIST"){const o=S.tabs.PLTE.length/3;for(S.tabs[h]=[],E=0;E<o;E++)S.tabs[h].push(F(r,c+2*E))}else if(h=="tRNS")S.ctype==3?S.tabs[h]=m.readBytes(r,c,T):S.ctype==0?S.tabs[h]=F(r,c):S.ctype==2&&(S.tabs[h]=[F(r,c),F(r,c+2),F(r,c+4)]);else if(h=="gAMA")S.tabs[h]=m.readUint(r,c)/1e5;else if(h=="sRGB")S.tabs[h]=r[c];else if(h=="bKGD")S.ctype==0||S.ctype==4?S.tabs[h]=[F(r,c)]:S.ctype==2||S.ctype==6?S.tabs[h]=[F(r,c),F(r,c+2),F(r,c+4)]:S.ctype==3&&(S.tabs[h]=r[c]);else if(h=="IEND")break;c+=T,m.readUint(r,c),c+=4}var x;return B!=0&&((x=S.frames[S.frames.length-1]).data=U(S,M.slice(0,B),x.rect.width,x.rect.height)),S.data=U(S,z,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(s){const r=s.width,c=s.height;if(s.tabs.acTL==null)return[A(s.data,r,c,s).buffer];const m=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const F=r*c*4,D=new Uint8Array(F),S=new Uint8Array(F),z=new Uint8Array(F);for(let R=0;R<s.frames.length;R++){const B=s.frames[R],v=B.rect.x,E=B.rect.y,f=B.rect.width,u=B.rect.height,p=A(B.data,f,u,s);if(R!=0)for(var M=0;M<F;M++)z[M]=D[M];if(B.blend==0?y(p,f,u,D,r,c,v,E,0):B.blend==1&&y(p,f,u,D,r,c,v,E,1),m.push(D.buffer.slice(0)),B.dispose!=0){if(B.dispose==1)y(S,f,u,D,r,c,v,E,0);else if(B.dispose==2)for(M=0;M<F;M++)D[M]=z[M]}}return m},_paeth:a,_copyTile:y,_bin:g}}();(function(){const{_copyTile:g}=We,{_bin:A}=We,U=We._paeth;var d={table:function(){const f=new Uint32Array(256);for(let u=0;u<256;u++){let p=u;for(let j=0;j<8;j++)1&p?p=3988292384^p>>>1:p>>>=1;f[u]=p}return f}(),update(f,u,p,j){for(let w=0;w<j;w++)f=d.table[255&(f^u[p+w])]^f>>>8;return f},crc:(f,u,p)=>4294967295^d.update(4294967295,f,u,p)};function e(f,u,p,j){u[p]+=f[0]*j>>4,u[p+1]+=f[1]*j>>4,u[p+2]+=f[2]*j>>4,u[p+3]+=f[3]*j>>4}function t(f){return Math.max(0,Math.min(255,f))}function l(f,u){const p=f[0]-u[0],j=f[1]-u[1],w=f[2]-u[2],C=f[3]-u[3];return p*p+j*j+w*w+C*C}function a(f,u,p,j,w,C,x){x==null&&(x=1);const T=j.length,h=[];for(var o=0;o<T;o++){const O=j[o];h.push([O>>>0&255,O>>>8&255,O>>>16&255,O>>>24&255])}for(o=0;o<T;o++){let O=4294967295;for(var _=0,I=0;I<T;I++){var P=l(h[o],h[I]);I!=o&&P<O&&(O=P,_=I)}}const $=new Uint32Array(w.buffer),q=new Int16Array(u*p*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<V.length;o++)V[o]=255*((V[o]+.5)/16-.5);for(let O=0;O<p;O++)for(let X=0;X<u;X++){var W;o=4*(O*u+X),x!=2?W=[t(f[o]+q[o]),t(f[o+1]+q[o+1]),t(f[o+2]+q[o+2]),t(f[o+3]+q[o+3])]:(P=V[4*(3&O)+(3&X)],W=[t(f[o]+P),t(f[o+1]+P),t(f[o+2]+P),t(f[o+3]+P)]),_=0;let re=16777215;for(I=0;I<T;I++){const le=l(W,h[I]);le<re&&(re=le,_=I)}const J=h[_],te=[W[0]-J[0],W[1]-J[1],W[2]-J[2],W[3]-J[3]];x==1&&(X!=u-1&&e(te,q,o+4,7),O!=p-1&&(X!=0&&e(te,q,o+4*u-4,3),e(te,q,o+4*u,5),X!=u-1&&e(te,q,o+4*u+4,1))),C[o>>2]=_,$[o>>2]=j[_]}}function b(f,u,p,j,w){w==null&&(w={});const{crc:C}=d,x=A.writeUint,T=A.writeUshort,h=A.writeASCII;let o=8;const _=f.frames.length>1;let I,P=!1,$=33+(_?20:0);if(w.sRGB!=null&&($+=13),w.pHYs!=null&&($+=21),w.iCCP!=null&&(I=pako.deflate(w.iCCP),$+=21+I.length+4),f.ctype==3){for(var q=f.plte.length,V=0;V<q;V++)f.plte[V]>>>24!=255&&(P=!0);$+=8+3*q+4+(P?8+1*q+4:0)}for(var W=0;W<f.frames.length;W++)_&&($+=38),$+=(J=f.frames[W]).cimg.length+12,W!=0&&($+=4);$+=12;const O=new Uint8Array($),X=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)O[V]=X[V];if(x(O,o,13),o+=4,h(O,o,"IHDR"),o+=4,x(O,o,u),o+=4,x(O,o,p),o+=4,O[o]=f.depth,o++,O[o]=f.ctype,o++,O[o]=0,o++,O[o]=0,o++,O[o]=0,o++,x(O,o,C(O,o-17,17)),o+=4,w.sRGB!=null&&(x(O,o,1),o+=4,h(O,o,"sRGB"),o+=4,O[o]=w.sRGB,o++,x(O,o,C(O,o-5,5)),o+=4),w.iCCP!=null){const te=13+I.length;x(O,o,te),o+=4,h(O,o,"iCCP"),o+=4,h(O,o,"ICC profile"),o+=11,o+=2,O.set(I,o),o+=I.length,x(O,o,C(O,o-(te+4),te+4)),o+=4}if(w.pHYs!=null&&(x(O,o,9),o+=4,h(O,o,"pHYs"),o+=4,x(O,o,w.pHYs[0]),o+=4,x(O,o,w.pHYs[1]),o+=4,O[o]=w.pHYs[2],o++,x(O,o,C(O,o-13,13)),o+=4),_&&(x(O,o,8),o+=4,h(O,o,"acTL"),o+=4,x(O,o,f.frames.length),o+=4,x(O,o,w.loop!=null?w.loop:0),o+=4,x(O,o,C(O,o-12,12)),o+=4),f.ctype==3){for(x(O,o,3*(q=f.plte.length)),o+=4,h(O,o,"PLTE"),o+=4,V=0;V<q;V++){const te=3*V,le=f.plte[V],ie=255&le,he=le>>>8&255,Ne=le>>>16&255;O[o+te+0]=ie,O[o+te+1]=he,O[o+te+2]=Ne}if(o+=3*q,x(O,o,C(O,o-3*q-4,3*q+4)),o+=4,P){for(x(O,o,q),o+=4,h(O,o,"tRNS"),o+=4,V=0;V<q;V++)O[o+V]=f.plte[V]>>>24&255;o+=q,x(O,o,C(O,o-q-4,q+4)),o+=4}}let re=0;for(W=0;W<f.frames.length;W++){var J=f.frames[W];_&&(x(O,o,26),o+=4,h(O,o,"fcTL"),o+=4,x(O,o,re++),o+=4,x(O,o,J.rect.width),o+=4,x(O,o,J.rect.height),o+=4,x(O,o,J.rect.x),o+=4,x(O,o,J.rect.y),o+=4,T(O,o,j[W]),o+=2,T(O,o,1e3),o+=2,O[o]=J.dispose,o++,O[o]=J.blend,o++,x(O,o,C(O,o-30,30)),o+=4);const te=J.cimg;x(O,o,(q=te.length)+(W==0?0:4)),o+=4;const le=o;h(O,o,W==0?"IDAT":"fdAT"),o+=4,W!=0&&(x(O,o,re++),o+=4),O.set(te,o),o+=q,x(O,o,C(O,le,o-le)),o+=4}return x(O,o,0),o+=4,h(O,o,"IEND"),o+=4,x(O,o,C(O,o-4,4)),o+=4,O.buffer}function y(f,u,p){for(let j=0;j<f.frames.length;j++){const w=f.frames[j];w.rect.width;const C=w.rect.height,x=new Uint8Array(C*w.bpl+C);w.cimg=c(w.img,C,w.bpp,w.bpl,x,u,p)}}function n(f,u,p,j,w){const C=w[0],x=w[1],T=w[2],h=w[3],o=w[4],_=w[5];let I=6,P=8,$=255;for(var q=0;q<f.length;q++){const ye=new Uint8Array(f[q]);for(var V=ye.length,W=0;W<V;W+=4)$&=ye[W+3]}const O=$!=255,X=function(me,de,be,ve,pe,Ue){const ce=[];for(var fe=0;fe<me.length;fe++){const Fe=new Uint8Array(me[fe]),oe=new Uint32Array(Fe.buffer);var je;let Ee=0,ae=0,Re=de,we=be,Tt=ve?1:0;if(fe!=0){const sn=Ue||ve||fe==1||ce[fe-2].dispose!=0?1:2;let It=0,Vt=1e9;for(let dt=0;dt<sn;dt++){var Qe=new Uint8Array(me[fe-1-dt]);const on=new Uint32Array(me[fe-1-dt]);let Ge=de,qe=be,He=-1,ct=-1;for(let Xe=0;Xe<be;Xe++)for(let Ye=0;Ye<de;Ye++)oe[Se=Xe*de+Ye]!=on[Se]&&(Ye<Ge&&(Ge=Ye),Ye>He&&(He=Ye),Xe<qe&&(qe=Xe),Xe>ct&&(ct=Xe));He==-1&&(Ge=qe=He=ct=0),pe&&((1&Ge)==1&&Ge--,(1&qe)==1&&qe--);const Qt=(He-Ge+1)*(ct-qe+1);Qt<Vt&&(Vt=Qt,It=dt,Ee=Ge,ae=qe,Re=He-Ge+1,we=ct-qe+1)}Qe=new Uint8Array(me[fe-1-It]),It==1&&(ce[fe-1].dispose=2),je=new Uint8Array(Re*we*4),g(Qe,de,be,je,Re,we,-Ee,-ae,0),Tt=g(Fe,de,be,je,Re,we,-Ee,-ae,3)?1:0,Tt==1?r(Fe,de,be,je,{x:Ee,y:ae,width:Re,height:we}):g(Fe,de,be,je,Re,we,-Ee,-ae,0)}else je=Fe.slice(0);ce.push({rect:{x:Ee,y:ae,width:Re,height:we},img:je,blend:Tt,dispose:0})}if(ve)for(fe=0;fe<ce.length;fe++){if((ue=ce[fe]).blend==1)continue;const Fe=ue.rect,oe=ce[fe-1].rect,Ee=Math.min(Fe.x,oe.x),ae=Math.min(Fe.y,oe.y),Re={x:Ee,y:ae,width:Math.max(Fe.x+Fe.width,oe.x+oe.width)-Ee,height:Math.max(Fe.y+Fe.height,oe.y+oe.height)-ae};ce[fe-1].dispose=1,fe-1!=0&&s(me,de,be,ce,fe-1,Re,pe),s(me,de,be,ce,fe,Re,pe)}let nt=0;if(me.length!=1)for(var Se=0;Se<ce.length;Se++){var ue;nt+=(ue=ce[Se]).rect.width*ue.rect.height}return ce}(f,u,p,C,x,T),re={},J=[],te=[];if(j!=0){const ye=[];for(W=0;W<X.length;W++)ye.push(X[W].img.buffer);const me=function(pe){let Ue=0;for(var ce=0;ce<pe.length;ce++)Ue+=pe[ce].byteLength;const fe=new Uint8Array(Ue);let je=0;for(ce=0;ce<pe.length;ce++){const Qe=new Uint8Array(pe[ce]),nt=Qe.length;for(let Se=0;Se<nt;Se+=4){let ue=Qe[Se],Fe=Qe[Se+1],oe=Qe[Se+2];const Ee=Qe[Se+3];Ee==0&&(ue=Fe=oe=0),fe[je+Se]=ue,fe[je+Se+1]=Fe,fe[je+Se+2]=oe,fe[je+Se+3]=Ee}je+=nt}return fe.buffer}(ye),de=F(me,j);for(W=0;W<de.plte.length;W++)J.push(de.plte[W].est.rgba);let be=0;for(W=0;W<X.length;W++){const ve=(ie=X[W]).img.length;var le=new Uint8Array(de.inds.buffer,be>>2,ve>>2);te.push(le);const pe=new Uint8Array(de.abuf,be,ve);_&&a(ie.img,ie.rect.width,ie.rect.height,J,pe,le),ie.img.set(pe),be+=ve}}else for(q=0;q<X.length;q++){var ie=X[q];const ye=new Uint32Array(ie.img.buffer);var he=ie.rect.width;for(V=ye.length,le=new Uint8Array(V),te.push(le),W=0;W<V;W++){const me=ye[W];if(W!=0&&me==ye[W-1])le[W]=le[W-1];else if(W>he&&me==ye[W-he])le[W]=le[W-he];else{let de=re[me];if(de==null&&(re[me]=de=J.length,J.push(me),J.length>=300))break;le[W]=de}}}const Ne=J.length;for(Ne<=256&&o==0&&(P=Ne<=2?1:Ne<=4?2:Ne<=16?4:8,P=Math.max(P,h)),q=0;q<X.length;q++){(ie=X[q]).rect.x,ie.rect.y,he=ie.rect.width;const ye=ie.rect.height;let me=ie.img;new Uint32Array(me.buffer);let de=4*he,be=4;if(Ne<=256&&o==0){de=Math.ceil(P*he/8);var De=new Uint8Array(de*ye);const ve=te[q];for(let pe=0;pe<ye;pe++){W=pe*de;const Ue=pe*he;if(P==8)for(var ge=0;ge<he;ge++)De[W+ge]=ve[Ue+ge];else if(P==4)for(ge=0;ge<he;ge++)De[W+(ge>>1)]|=ve[Ue+ge]<<4-4*(1&ge);else if(P==2)for(ge=0;ge<he;ge++)De[W+(ge>>2)]|=ve[Ue+ge]<<6-2*(3&ge);else if(P==1)for(ge=0;ge<he;ge++)De[W+(ge>>3)]|=ve[Ue+ge]<<7-1*(7&ge)}me=De,I=3,be=1}else if(O==0&&X.length==1){De=new Uint8Array(he*ye*3);const ve=he*ye;for(W=0;W<ve;W++){const pe=3*W,Ue=4*W;De[pe]=me[Ue],De[pe+1]=me[Ue+1],De[pe+2]=me[Ue+2]}me=De,I=2,be=3,de=3*he}ie.img=me,ie.bpl=de,ie.bpp=be}return{ctype:I,depth:P,plte:J,frames:X}}function s(f,u,p,j,w,C,x){const T=Uint8Array,h=Uint32Array,o=new T(f[w-1]),_=new h(f[w-1]),I=w+1<f.length?new T(f[w+1]):null,P=new T(f[w]),$=new h(P.buffer);let q=u,V=p,W=-1,O=-1;for(let re=0;re<C.height;re++)for(let J=0;J<C.width;J++){const te=C.x+J,le=C.y+re,ie=le*u+te,he=$[ie];he==0||j[w-1].dispose==0&&_[ie]==he&&(I==null||I[4*ie+3]!=0)||(te<q&&(q=te),te>W&&(W=te),le<V&&(V=le),le>O&&(O=le))}W==-1&&(q=V=W=O=0),x&&((1&q)==1&&q--,(1&V)==1&&V--),C={x:q,y:V,width:W-q+1,height:O-V+1};const X=j[w];X.rect=C,X.blend=1,X.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(g(o,u,p,X.img,C.width,C.height,-C.x,-C.y,0),r(P,u,p,X.img,C)):g(P,u,p,X.img,C.width,C.height,-C.x,-C.y,0)}function r(f,u,p,j,w){g(f,u,p,j,w.width,w.height,-w.x,-w.y,2)}function c(f,u,p,j,w,C,x){const T=[];let h,o=[0,1,2,3,4];C!=-1?o=[C]:(u*j>5e5||p==1)&&(o=[0]),x&&(h={level:0});const _=cs;for(var I=0;I<o.length;I++){for(let q=0;q<u;q++)m(w,f,q,j,p,o[I]);T.push(_.deflate(w,h))}let P,$=1e9;for(I=0;I<T.length;I++)T[I].length<$&&(P=I,$=T[I].length);return T[P]}function m(f,u,p,j,w,C){const x=p*j;let T=x+p;if(f[T]=C,T++,C==0)if(j<500)for(var h=0;h<j;h++)f[T+h]=u[x+h];else f.set(new Uint8Array(u.buffer,x,j),T);else if(C==1){for(h=0;h<w;h++)f[T+h]=u[x+h];for(h=w;h<j;h++)f[T+h]=u[x+h]-u[x+h-w]+256&255}else if(p==0){for(h=0;h<w;h++)f[T+h]=u[x+h];if(C==2)for(h=w;h<j;h++)f[T+h]=u[x+h];if(C==3)for(h=w;h<j;h++)f[T+h]=u[x+h]-(u[x+h-w]>>1)+256&255;if(C==4)for(h=w;h<j;h++)f[T+h]=u[x+h]-U(u[x+h-w],0,0)+256&255}else{if(C==2)for(h=0;h<j;h++)f[T+h]=u[x+h]+256-u[x+h-j]&255;if(C==3){for(h=0;h<w;h++)f[T+h]=u[x+h]+256-(u[x+h-j]>>1)&255;for(h=w;h<j;h++)f[T+h]=u[x+h]+256-(u[x+h-j]+u[x+h-w]>>1)&255}if(C==4){for(h=0;h<w;h++)f[T+h]=u[x+h]+256-U(0,u[x+h-j],0)&255;for(h=w;h<j;h++)f[T+h]=u[x+h]+256-U(u[x+h-w],u[x+h-j],u[x+h-w-j])&255}}}function F(f,u){const p=new Uint8Array(f),j=p.slice(0),w=new Uint32Array(j.buffer),C=D(j,u),x=C[0],T=C[1],h=p.length,o=new Uint8Array(h>>2);let _;if(p.length<2e7)for(var I=0;I<h;I+=4)_=S(x,P=p[I]*(1/255),$=p[I+1]*(1/255),q=p[I+2]*(1/255),V=p[I+3]*(1/255)),o[I>>2]=_.ind,w[I>>2]=_.est.rgba;else for(I=0;I<h;I+=4){var P=p[I]*.00392156862745098,$=p[I+1]*(1/255),q=p[I+2]*(1/255),V=p[I+3]*(1/255);for(_=x;_.left;)_=z(_.est,P,$,q,V)<=0?_.left:_.right;o[I>>2]=_.ind,w[I>>2]=_.est.rgba}return{abuf:j.buffer,inds:o,plte:T}}function D(f,u,p){p==null&&(p=1e-4);const j=new Uint32Array(f.buffer),w={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=B(f,w.i0,w.i1),w.est=v(w.bst);const C=[w];for(;C.length<u;){let T=0,h=0;for(var x=0;x<C.length;x++)C[x].est.L>T&&(T=C[x].est.L,h=x);if(T<p)break;const o=C[h],_=M(f,j,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=_||o.i1<=_){o.est.L=0;continue}const I={i0:o.i0,i1:_,bst:null,est:null,tdst:0,left:null,right:null};I.bst=B(f,I.i0,I.i1),I.est=v(I.bst);const P={i0:_,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:o.bst.N-I.bst.N},x=0;x<16;x++)P.bst.R[x]=o.bst.R[x]-I.bst.R[x];for(x=0;x<4;x++)P.bst.m[x]=o.bst.m[x]-I.bst.m[x];P.est=v(P.bst),o.left=I,o.right=P,C[h]=I,C.push(P)}for(C.sort((T,h)=>h.bst.N-T.bst.N),x=0;x<C.length;x++)C[x].ind=x;return[w,C]}function S(f,u,p,j,w){if(f.left==null)return f.tdst=function(I,P,$,q,V){const W=P-I[0],O=$-I[1],X=q-I[2],re=V-I[3];return W*W+O*O+X*X+re*re}(f.est.q,u,p,j,w),f;const C=z(f.est,u,p,j,w);let x=f.left,T=f.right;C>0&&(x=f.right,T=f.left);const h=S(x,u,p,j,w);if(h.tdst<=C*C)return h;const o=S(T,u,p,j,w);return o.tdst<h.tdst?o:h}function z(f,u,p,j,w){const{e:C}=f;return C[0]*u+C[1]*p+C[2]*j+C[3]*w-f.eMq}function M(f,u,p,j,w,C){for(j-=4;p<j;){for(;R(f,p,w)<=C;)p+=4;for(;R(f,j,w)>C;)j-=4;if(p>=j)break;const x=u[p>>2];u[p>>2]=u[j>>2],u[j>>2]=x,p+=4,j-=4}for(;R(f,p,w)>C;)p-=4;return p+4}function R(f,u,p){return f[u]*p[0]+f[u+1]*p[1]+f[u+2]*p[2]+f[u+3]*p[3]}function B(f,u,p){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=p-u>>2;for(let x=u;x<p;x+=4){const T=f[x]*.00392156862745098,h=f[x+1]*(1/255),o=f[x+2]*(1/255),_=f[x+3]*(1/255);w[0]+=T,w[1]+=h,w[2]+=o,w[3]+=_,j[0]+=T*T,j[1]+=T*h,j[2]+=T*o,j[3]+=T*_,j[5]+=h*h,j[6]+=h*o,j[7]+=h*_,j[10]+=o*o,j[11]+=o*_,j[15]+=_*_}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function v(f){const{R:u}=f,{m:p}=f,{N:j}=f,w=p[0],C=p[1],x=p[2],T=p[3],h=j==0?0:1/j,o=[u[0]-w*w*h,u[1]-w*C*h,u[2]-w*x*h,u[3]-w*T*h,u[4]-C*w*h,u[5]-C*C*h,u[6]-C*x*h,u[7]-C*T*h,u[8]-x*w*h,u[9]-x*C*h,u[10]-x*x*h,u[11]-x*T*h,u[12]-T*w*h,u[13]-T*C*h,u[14]-T*x*h,u[15]-T*T*h],_=o,I=E;let P=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,q=0;if(j!=0)for(let W=0;W<16&&(P=I.multVec(_,P),q=Math.sqrt(I.dot(P,P)),P=I.sml(1/q,P),!(W!=0&&Math.abs(q-$)<1e-9));W++)$=q;const V=[w*h,C*h,x*h,T*h];return{Cov:o,q:V,e:P,L:$,eMq255:I.dot(I.sml(255,V),P),eMq:I.dot(P,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var E={multVec:(f,u)=>[f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],f[4]*u[0]+f[5]*u[1]+f[6]*u[2]+f[7]*u[3],f[8]*u[0]+f[9]*u[1]+f[10]*u[2]+f[11]*u[3],f[12]*u[0]+f[13]*u[1]+f[14]*u[2]+f[15]*u[3]],dot:(f,u)=>f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],sml:(f,u)=>[f*u[0],f*u[1],f*u[2],f*u[3]]};We.encode=function(u,p,j,w,C,x,T){w==null&&(w=0),T==null&&(T=!1);const h=n(u,p,j,w,[!1,!1,!1,0,T,!1]);return y(h,-1),b(h,p,j,C,x)},We.encodeLL=function(u,p,j,w,C,x,T,h){const o={ctype:0+(w==1?0:2)+(C==0?0:4),depth:x,frames:[]},_=(w+C)*x,I=_*p;for(let P=0;P<u.length;P++)o.frames.push({rect:{x:0,y:0,width:p,height:j},img:new Uint8Array(u[P]),blend:0,dispose:1,bpp:Math.ceil(_/8),bpl:Math.ceil(I/8)});return y(o,0,!0),b(o,p,j,T,h)},We.encode.compress=n,We.encode.dither=a,We.quantize=F,We.quantize.getKDtree=D,We.quantize.getNearest=S})();const xr={toArrayBuffer(g,A){const U=g.width,d=g.height,e=U<<2,t=g.getContext("2d").getImageData(0,0,U,d),l=new Uint32Array(t.data.buffer),a=(32*U+31)/32<<2,b=a*d,y=122+b,n=new ArrayBuffer(y),s=new DataView(n),r=1<<20;let c,m,F,D,S=r,z=0,M=0,R=0;function B(f){s.setUint16(M,f,!0),M+=2}function v(f){s.setUint32(M,f,!0),M+=4}function E(f){M+=f}B(19778),v(y),E(4),v(122),v(108),v(U),v(-d>>>0),B(1),B(32),v(3),v(b),v(2835),v(2835),E(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),function f(){for(;z<d&&S>0;){for(D=122+z*a,c=0;c<e;)S--,m=l[R++],F=m>>>24,s.setUint32(D+c,m<<8|F),c+=4;z++}R<l.length?(S=r,setTimeout(f,xr._dly)):A(n)}()},toBlob(g,A){this.toArrayBuffer(g,U=>{A(new Blob([U],{type:"image/bmp"}))})},_dly:9};var ze={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},us={[ze.CHROME]:16384,[ze.FIREFOX]:11180,[ze.DESKTOP_SAFARI]:16384,[ze.IE]:8192,[ze.IOS]:4096,[ze.ETC]:8192};const On=typeof window<"u",yr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,en=On&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),fs=(On||yr)&&(en&&en.getOriginalSymbol(window,"File")||typeof File<"u"&&File),vr=(On||yr)&&(en&&en.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function zn(g,A,U=Date.now()){return new Promise(d=>{const e=g.split(","),t=e[0].match(/:(.*?);/)[1],l=globalThis.atob(e[1]);let a=l.length;const b=new Uint8Array(a);for(;a--;)b[a]=l.charCodeAt(a);const y=new Blob([b],{type:t});y.name=A,y.lastModified=U,d(y)})}function jr(g){return new Promise((A,U)=>{const d=new vr;d.onload=()=>A(d.result),d.onerror=e=>U(e),d.readAsDataURL(g)})}function Sr(g){return new Promise((A,U)=>{const d=new Image;d.onload=()=>A(d),d.onerror=e=>U(e),d.src=g})}function ut(){if(ut.cachedResult!==void 0)return ut.cachedResult;let g=ze.ETC;const{userAgent:A}=navigator;return/Chrom(e|ium)/i.test(A)?g=ze.CHROME:/iP(ad|od|hone)/i.test(A)&&/WebKit/i.test(A)?g=ze.IOS:/Safari/i.test(A)?g=ze.DESKTOP_SAFARI:/Firefox/i.test(A)?g=ze.FIREFOX:(/MSIE/i.test(A)||document.documentMode)&&(g=ze.IE),ut.cachedResult=g,ut.cachedResult}function wr(g,A){const U=ut(),d=us[U];let e=g,t=A,l=e*t;const a=e>t?t/e:e/t;for(;l>d*d;){const b=(d+e)/2,y=(d+t)/2;b<y?(t=y,e=y*a):(t=b*a,e=b),l=e*t}return{width:e,height:t}}function rn(g,A){let U,d;try{if(U=new OffscreenCanvas(g,A),d=U.getContext("2d"),d===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{U=document.createElement("canvas"),d=U.getContext("2d")}return U.width=g,U.height=A,[U,d]}function Cr(g,A){const{width:U,height:d}=wr(g.width,g.height),[e,t]=rn(U,d);return A&&/jpe?g/.test(A)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(g,0,0,e.width,e.height),e}function Zt(){return Zt.cachedResult!==void 0||(Zt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Zt.cachedResult}function tn(g,A={}){return new Promise(function(U,d){let e,t;var l=function(){try{return t=Cr(e,A.fileType||g.type),U([e,t])}catch(b){return d(b)}},a=function(b){try{var y=function(n){try{throw n}catch(s){return d(s)}};try{let n;return jr(g).then(function(s){try{return n=s,Sr(n).then(function(r){try{return e=r,function(){try{return l()}catch(c){return d(c)}}()}catch(c){return y(c)}},y)}catch(r){return y(r)}},y)}catch(n){y(n)}}catch(n){return d(n)}};try{if(Zt()||[ze.DESKTOP_SAFARI,ze.MOBILE_SAFARI].includes(ut()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(g).then(function(b){try{return e=b,l()}catch{return a()}},a)}catch{a()}})}function nn(g,A,U,d,e=1){return new Promise(function(t,l){let a;if(A==="image/png"){let y,n,s;return y=g.getContext("2d"),{data:n}=y.getImageData(0,0,g.width,g.height),s=We.encode([n.buffer],g.width,g.height,4096*e),a=new Blob([s],{type:A}),a.name=U,a.lastModified=d,b.call(this)}{let y=function(){return b.call(this)};if(A==="image/bmp")return new Promise(n=>xr.toBlob(g,n)).then((function(n){try{return a=n,a.name=U,a.lastModified=d,y.call(this)}catch(s){return l(s)}}).bind(this),l);{let n=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&g instanceof OffscreenCanvas)return g.convertToBlob({type:A,quality:e}).then((function(s){try{return a=s,a.name=U,a.lastModified=d,n.call(this)}catch(r){return l(r)}}).bind(this),l);{let s;return s=g.toDataURL(A,e),zn(s,U,d).then((function(r){try{return a=r,n.call(this)}catch(c){return l(c)}}).bind(this),l)}}}function b(){return t(a)}})}function Ze(g){g.width=0,g.height=0}function vt(){return new Promise(function(g,A){let U,d,e,t;return vt.cachedResult!==void 0?g(vt.cachedResult):zn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(l){try{return U=l,tn(U).then(function(a){try{return d=a[1],nn(d,U.type,U.name,U.lastModified).then(function(b){try{return e=b,Ze(d),tn(e).then(function(y){try{return t=y[0],vt.cachedResult=t.width===1&&t.height===2,g(vt.cachedResult)}catch(n){return A(n)}},A)}catch(y){return A(y)}},A)}catch(b){return A(b)}},A)}catch(a){return A(a)}},A)})}function Fr(g){return new Promise((A,U)=>{const d=new vr;d.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return A(-2);const l=t.byteLength;let a=2;for(;a<l;){if(t.getUint16(a+2,!1)<=8)return A(-1);const b=t.getUint16(a,!1);if(a+=2,b==65505){if(t.getUint32(a+=2,!1)!=1165519206)return A(-1);const y=t.getUint16(a+=6,!1)==18761;a+=t.getUint32(a+4,y);const n=t.getUint16(a,y);a+=2;for(let s=0;s<n;s++)if(t.getUint16(a+12*s,y)==274)return A(t.getUint16(a+12*s+8,y))}else{if((65280&b)!=65280)break;a+=t.getUint16(a,!1)}}return A(-1)},d.onerror=e=>U(e),d.readAsArrayBuffer(g)})}function Ar(g,A){const{width:U}=g,{height:d}=g,{maxWidthOrHeight:e}=A;let t,l=g;return isFinite(e)&&(U>e||d>e)&&([l,t]=rn(U,d),U>d?(l.width=e,l.height=d/U*e):(l.width=U/d*e,l.height=e),t.drawImage(g,0,0,l.width,l.height),Ze(g)),l}function Tr(g,A){const{width:U}=g,{height:d}=g,[e,t]=rn(U,d);switch(A>4&&A<9?(e.width=d,e.height=U):(e.width=U,e.height=d),A){case 2:t.transform(-1,0,0,1,U,0);break;case 3:t.transform(-1,0,0,-1,U,d);break;case 4:t.transform(1,0,0,-1,0,d);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,d,0);break;case 7:t.transform(0,-1,-1,0,d,U);break;case 8:t.transform(0,-1,1,0,0,U)}return t.drawImage(g,0,0,U,d),Ze(g),e}function Wn(g,A,U=0){return new Promise(function(d,e){let t,l,a,b,y,n,s,r,c,m,F,D,S,z,M,R,B,v,E,f;function u(j=5){if(A.signal&&A.signal.aborted)throw A.signal.reason;t+=j,A.onProgress(Math.min(t,100))}function p(j){if(A.signal&&A.signal.aborted)throw A.signal.reason;t=Math.min(Math.max(j,t),100),A.onProgress(t)}return t=U,l=A.maxIteration||10,a=1024*A.maxSizeMB*1024,u(),tn(g,A).then((function(j){try{return[,b]=j,u(),y=Ar(b,A),u(),new Promise(function(w,C){var x;if(!(x=A.exifOrientation))return Fr(g).then((function(h){try{return x=h,T.call(this)}catch(o){return C(o)}}).bind(this),C);function T(){return w(x)}return T.call(this)}).then((function(w){try{return n=w,u(),vt().then((function(C){try{return s=C?y:Tr(y,n),u(),r=A.initialQuality||1,c=A.fileType||g.type,nn(s,c,g.name,g.lastModified,r).then((function(x){try{{let h=function(){if(l--&&(M>a||M>S)){let _,I;return _=f?.95*E.width:E.width,I=f?.95*E.height:E.height,[B,v]=rn(_,I),v.drawImage(E,0,0,_,I),r*=c==="image/png"?.85:.95,nn(B,c,g.name,g.lastModified,r).then(function(P){try{return R=P,Ze(E),E=B,M=R.size,p(Math.min(99,Math.floor((z-M)/(z-a)*100))),h}catch($){return e($)}},e)}return[1]},o=function(){return Ze(E),Ze(B),Ze(y),Ze(s),Ze(b),p(100),d(R)};if(m=x,u(),F=m.size>a,D=m.size>g.size,!F&&!D)return p(100),d(m);var T;return S=g.size,z=m.size,M=z,E=s,f=!A.alwaysKeepResolution&&F,(T=(function(_){for(;_;){if(_.then)return void _.then(T,e);try{if(_.pop){if(_.length)return _.pop()?o.call(this):_;_=h}else _=_.call(this)}catch(I){return e(I)}}}).bind(this))(h)}}catch(h){return e(h)}}).bind(this),e)}catch(x){return e(x)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const hs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let gn;function gs(g,A){return new Promise((U,d)=>{gn||(gn=function(l){const a=[];return a.push(l),URL.createObjectURL(new Blob(a))}(hs));const e=new Worker(gn);e.addEventListener("message",function(l){if(A.signal&&A.signal.aborted)e.terminate();else if(l.data.progress===void 0){if(l.data.error)return d(new Error(l.data.error)),void e.terminate();U(l.data.file),e.terminate()}else A.onProgress(l.data.progress)}),e.addEventListener("error",d),A.signal&&A.signal.addEventListener("abort",()=>{d(A.signal.reason),e.terminate()}),e.postMessage({file:g,imageCompressionLibUrl:A.libURL,options:{...A,onProgress:void 0,signal:void 0}})})}function Ie(g,A){return new Promise(function(U,d){let e,t,l,a,b,y;if(e={...A},l=0,{onProgress:a}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,b=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{l=c,typeof a=="function"&&a(l)},!(g instanceof Blob||g instanceof fs))return d(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(g.type))return d(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!b||typeof Worker!="function"||y)return Wn(g,e).then((function(c){try{return t=c,r.call(this)}catch(m){return d(m)}}).bind(this),d);var n=(function(){try{return r.call(this)}catch(c){return d(c)}}).bind(this),s=function(c){try{return Wn(g,e).then(function(m){try{return t=m,n()}catch(F){return d(F)}},d)}catch(m){return d(m)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",gs(g,e).then(function(c){try{return t=c,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=g.name,t.lastModified=g.lastModified}catch{}try{e.preserveExif&&g.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===g.type)&&(t=br(g,t))}catch{}return U(t)}})}Ie.getDataUrlFromFile=jr,Ie.getFilefromDataUrl=zn,Ie.loadImage=Sr,Ie.drawImageInCanvas=Cr,Ie.drawFileInCanvas=tn,Ie.canvasToFile=nn,Ie.getExifOrientation=Fr,Ie.handleMaxWidthOrHeight=Ar,Ie.followExifOrientation=Tr,Ie.cleanupCanvasMemory=Ze,Ie.isAutoOrientationInBrowser=vt,Ie.approximateBelowMaximumCanvasSizeOfBrowser=wr,Ie.copyExifWithoutOrientation=br,Ie.getBrowserName=ut,Ie.version="2.0.2";var mn,Ln;function Ir(){if(Ln)return mn;Ln=1;function g(A){var U=typeof A;return A!=null&&(U=="object"||U=="function")}return mn=g,mn}var pn,$n;function ms(){if($n)return pn;$n=1;var g=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return pn=g,pn}var bn,Vn;function kr(){if(Vn)return bn;Vn=1;var g=ms(),A=typeof self=="object"&&self&&self.Object===Object&&self,U=g||A||Function("return this")();return bn=U,bn}var xn,Qn;function ps(){if(Qn)return xn;Qn=1;var g=kr(),A=function(){return g.Date.now()};return xn=A,xn}var yn,Gn;function bs(){if(Gn)return yn;Gn=1;var g=/\s/;function A(U){for(var d=U.length;d--&&g.test(U.charAt(d)););return d}return yn=A,yn}var vn,Yn;function xs(){if(Yn)return vn;Yn=1;var g=bs(),A=/^\s+/;function U(d){return d&&d.slice(0,g(d)+1).replace(A,"")}return vn=U,vn}var jn,Zn;function Dr(){if(Zn)return jn;Zn=1;var g=kr(),A=g.Symbol;return jn=A,jn}var Sn,Kn;function ys(){if(Kn)return Sn;Kn=1;var g=Dr(),A=Object.prototype,U=A.hasOwnProperty,d=A.toString,e=g?g.toStringTag:void 0;function t(l){var a=U.call(l,e),b=l[e];try{l[e]=void 0;var y=!0}catch{}var n=d.call(l);return y&&(a?l[e]=b:delete l[e]),n}return Sn=t,Sn}var wn,Xn;function vs(){if(Xn)return wn;Xn=1;var g=Object.prototype,A=g.toString;function U(d){return A.call(d)}return wn=U,wn}var Cn,Jn;function js(){if(Jn)return Cn;Jn=1;var g=Dr(),A=ys(),U=vs(),d="[object Null]",e="[object Undefined]",t=g?g.toStringTag:void 0;function l(a){return a==null?a===void 0?e:d:t&&t in Object(a)?A(a):U(a)}return Cn=l,Cn}var Fn,er;function Ss(){if(er)return Fn;er=1;function g(A){return A!=null&&typeof A=="object"}return Fn=g,Fn}var An,tr;function ws(){if(tr)return An;tr=1;var g=js(),A=Ss(),U="[object Symbol]";function d(e){return typeof e=="symbol"||A(e)&&g(e)==U}return An=d,An}var Tn,nr;function Cs(){if(nr)return Tn;nr=1;var g=xs(),A=Ir(),U=ws(),d=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,l=/^0o[0-7]+$/i,a=parseInt;function b(y){if(typeof y=="number")return y;if(U(y))return d;if(A(y)){var n=typeof y.valueOf=="function"?y.valueOf():y;y=A(n)?n+"":n}if(typeof y!="string")return y===0?y:+y;y=g(y);var s=t.test(y);return s||l.test(y)?a(y.slice(2),s?2:8):e.test(y)?d:+y}return Tn=b,Tn}var In,rr;function Fs(){if(rr)return In;rr=1;var g=Ir(),A=ps(),U=Cs(),d="Expected a function",e=Math.max,t=Math.min;function l(a,b,y){var n,s,r,c,m,F,D=0,S=!1,z=!1,M=!0;if(typeof a!="function")throw new TypeError(d);b=U(b)||0,g(y)&&(S=!!y.leading,z="maxWait"in y,r=z?e(U(y.maxWait)||0,b):r,M="trailing"in y?!!y.trailing:M);function R(C){var x=n,T=s;return n=s=void 0,D=C,c=a.apply(T,x),c}function B(C){return D=C,m=setTimeout(f,b),S?R(C):c}function v(C){var x=C-F,T=C-D,h=b-x;return z?t(h,r-T):h}function E(C){var x=C-F,T=C-D;return F===void 0||x>=b||x<0||z&&T>=r}function f(){var C=A();if(E(C))return u(C);m=setTimeout(f,v(C))}function u(C){return m=void 0,M&&n?R(C):(n=s=void 0,c)}function p(){m!==void 0&&clearTimeout(m),D=0,n=F=s=m=void 0}function j(){return m===void 0?c:u(A())}function w(){var C=A(),x=E(C);if(n=arguments,s=this,F=C,x){if(m===void 0)return B(F);if(z)return clearTimeout(m),m=setTimeout(f,b),R(F)}return m===void 0&&(m=setTimeout(f,b)),c}return w.cancel=p,w.flush=j,w}return In=l,In}var As=Fs();const Ts=tt(As);var Dt={},sr;function Is(){if(sr)return Dt;sr=1;var g=ot();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var A=g(lt()),U=at();return Dt.default=(0,A.default)([(0,U.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,U.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),Dt}var ks=Is();const Ds=tt(ks);var Ut={},ir;function Us(){if(ir)return Ut;ir=1;var g=ot();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var A=g(lt()),U=at();return Ut.default=(0,A.default)((0,U.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),Ut}var Rs=Us();const _s=tt(Rs);var Rt={},or;function Es(){if(or)return Rt;or=1;var g=ot();Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default=void 0;var A=g(lt()),U=at();return Rt.default=(0,A.default)((0,U.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Rt}var Ms=Es();const Os=tt(Ms);var _t={},ar;function zs(){if(ar)return _t;ar=1;var g=ot();Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var A=g(lt()),U=at();return _t.default=(0,A.default)([(0,U.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,U.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),_t}var Bs=zs();const Ns=tt(Bs),ft=H.forwardRef(({path:g,initialImages:A=[],onImagesUpdated:U,onDelete:d,isOwnDesign:e},t)=>{const[l,a]=H.useState(A.map(o=>({...o,deleted:!1}))),[b,y]=H.useState(!1),[n,s]=H.useState(0),[r,c]=H.useState(!1),[m,F]=H.useState(null),[D,S]=H.useState(1),[z,M]=H.useState(!1),[R,B]=H.useState(!1),[v,E]=H.useState(""),[f,u]=H.useState("info"),p=H.useRef(null);H.useEffect(()=>{console.log("Initial images received:",A),a(A.map(o=>({...o,deleted:!!o.deleted})))},[A]);const j=async o=>{const _=Array.from(o.target.files||[]);y(!0);const I={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},P=_.map(async($,q)=>{let V=$;$.size>1024*1024&&(V=await Ie($,I),E("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),B(!0));const O=`${new Date().getTime()}-${V.name}`,X=jt(),re=St(X,`${g}/${O}`),J=hr(re,V);return new Promise((te,le)=>{J.on("state_changed",ie=>{const he=ie.bytesTransferred/ie.totalBytes*100;s(he)},ie=>{console.error("Upload failed:",ie),le(ie)},()=>{gr(J.snapshot.ref).then(ie=>{te({url:ie,path:re.fullPath,title:""})})})})});Promise.all(P).then($=>{const q=[...l,...$];a(q),U&&U(q),E("Images uploaded successfully."),u("success"),B(!0),y(!1),s(0),p.current&&(p.current.value="")}).catch($=>{console.error("Error uploading images: ",$),E("Failed to upload images."),u("error"),B(!0),y(!1),s(0)})},w=o=>{a(_=>{const I=_.map((P,$)=>$===o?{...P,deleted:!0}:P);return U(I),I}),E("Image marked for deletion. Update to permanently delete."),u("info"),B(!0)},C=async()=>{const o=l.filter(_=>_.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const _=o.map(I=>{const P=jt(),$=St(P,I.path);return Yt($)});try{await Promise.all(_),d(o),a(I=>I.filter(P=>!P.deleted)),E("Deleted images have been permanently removed."),u("success")}catch(I){console.error("Error committing deletions:",I),E("Failed to commit deletions."),u("error")}B(!0)}else console.log("No images marked for deletion.")},x=o=>{M(!z),F(o)};H.useEffect(()=>{const o=()=>{const _=!!document.fullscreenElement;M(_)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const T=(o,_)=>{_!=="clickaway"&&B(!1)},h=H.useCallback(Ts((o,_)=>{setTimeout(()=>{a(I=>{const P=I.map(($,q)=>q===o?{...$,title:_}:$);return U&&U(P),P})},0)},30),[U]);return H.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Kt,{title:"Upload Images",children:i.jsxs(ke,{variant:"outlined",component:"label",startIcon:i.jsx(Ns,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:b,ref:p,accept:"image/*"})]})}),b&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),l.filter(o=>!o.deleted).map((o,_)=>i.jsxs("div",{children:[i.jsx("img",{src:o.url,alt:`Uploaded design ${_}`,onClick:()=>{c(!0),F(_)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Pe,{onClick:()=>w(_),children:i.jsx(Ht,{})}),i.jsx("textarea",{value:o.title,onChange:I=>h(_,I.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},_)),i.jsx(ht,{open:r,onClose:()=>c(!1),fullScreen:z,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:z?"none":void 0,maxHeight:z?"none":void 0,height:z?"100%":void 0,width:z?"100%":void 0,overflowY:"auto"}},children:m!==null&&i.jsxs(gt,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:l[m].url,alt:`Zoomed Design ${m}`,style:{maxWidth:"100%",maxHeight:z?"100vh":void 0,transform:`scale(${D})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Pe,{onClick:()=>S(D*1.2),children:i.jsx(Ds,{})}),i.jsx(Pe,{onClick:()=>S(D/1.2),style:{marginLeft:"10px"},children:i.jsx(_s,{})}),i.jsx(Pe,{onClick:()=>x(m),style:{marginLeft:"10px"},children:i.jsx(Os,{})}),z&&i.jsx(Pe,{onClick:()=>x(m),style:{position:"absolute",top:20,right:20},children:i.jsx(ss,{})})]})]})}),i.jsx(mt,{open:R,autoHideDuration:6e3,onClose:T,children:i.jsx(pt,{onClose:T,severity:f,sx:{width:"100%"},children:v})})]})});ft.displayName="ImageUpload";const Ke=({onChange:g,initialValue:A})=>{const[U,d]=H.useState(hn.sanitize(A||"")),e=H.useRef(!1),t=H.useRef(null),[l,a]=H.useState("");H.useEffect(()=>{e.current?d(hn.sanitize(A||"")):e.current=!0},[A]);const b=(F,D,S,z)=>{const M=hn.sanitize(F);d(M),g(M)},y=F=>{if(!t.current){console.warn("Editor not initialized");return}const D=t.current.getEditor(),S=D.getSelection();if(S)D.insertText(S.index,F),D.setSelection(S.index+F.length);else{const z=D.getText().length;D.insertText(z,F),D.setSelection(z+F.length)}a(""),D.focus()},n=F=>{y(F.target.value)},s=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],r=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"],c={toolbar:[[{header:[1,2,3,!1]}],["bold","italic"],[{list:"ordered"},{list:"bullet"}],["blockquote",{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},m=["header","bold","italic","list","blockquote","indent","link"];return i.jsxs("div",{children:[i.jsxs(Ae,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginBottom:2},children:[i.jsx(fr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(Dn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Xt,{labelId:"math-operators-label",id:"math-operators",value:l,onChange:n,displayEmpty:!0,children:[i.jsx(yt,{value:"",disabled:!0,children:"Math"}),r.map(F=>i.jsx(yt,{value:F,children:F},F))]})}),i.jsx(Dn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Xt,{labelId:"greek-letters-label",id:"greek-letters",value:l,onChange:n,displayEmpty:!0,children:[i.jsx(yt,{value:"",disabled:!0,children:"Greek"}),s.map(F=>i.jsx(yt,{value:F,children:F},F))]})})]}),i.jsx(is,{ref:t,value:U,onChange:b,modules:c,formats:m,theme:"snow",placeholder:"Start writing...",style:{backgroundColor:"white",borderRadius:"4px",minHeight:"200px"}})]})};var Et={},lr;function Ps(){if(lr)return Et;lr=1;var g=ot();Object.defineProperty(Et,"__esModule",{value:!0}),Et.default=void 0;var A=g(lt()),U=at();return Et.default=(0,A.default)((0,U.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Et}var qs=Ps();const Un=tt(qs);var Mt={},dr;function Hs(){if(dr)return Mt;dr=1;var g=ot();Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var A=g(lt()),U=at();return Mt.default=(0,A.default)((0,U.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Mt}var Ws=Hs();const Ls=tt(Ws);var Ot={},cr;function $s(){if(cr)return Ot;cr=1;var g=ot();Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var A=g(lt()),U=at();return Ot.default=(0,A.default)((0,U.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Ot}var Vs=$s();const Qs=tt(Vs),Ct=({path:g,initialFiles:A,onFilesChange:U,isOwnDesign:d})=>{const[e,t]=H.useState(A.map(p=>({...p,deleted:!!p.deleted}))),[l,a]=H.useState(!1),[b,y]=H.useState(0),[n,s]=H.useState({}),[r,c]=H.useState(!1),[m,F]=H.useState(""),[D,S]=H.useState("info"),z=H.useRef(null);H.useEffect(()=>{console.log("Initial files received:",A),t(A.map(p=>({...p,deleted:!!p.deleted})))},[A]),H.useEffect(()=>()=>{s({})},[]);const M=p=>{console.log("Updating files with",p),U(p),t(p)},R=async p=>{if(!p.target.files)return;const w=Array.from(p.target.files).filter(x=>x.size>5242880?(F("File size should not exceed 5 MB"),S("error"),c(!0),!1):!0);a(!0);const C=w.map(x=>{const T=new Date().getTime(),h=`${T}-${x.name}`,o=jt(),_=St(o,`${g}/${h}`),I=hr(_,x);return new Promise((P,$)=>{I.on("state_changed",q=>{const V=q.bytesTransferred/q.totalBytes*100;y(V)},q=>{console.error("Upload failed:",q),$(q)},()=>{gr(I.snapshot.ref).then(q=>{P({id:T.toString(),url:q,name:x.name,path:_.fullPath})})})})});Promise.all(C).then(x=>{const T=[...e.filter(h=>!h.deleted),...x];M(T),F("Files uploaded successfully."),S("success"),c(!0),a(!1),y(0),z.current&&(z.current.value="")}).catch(x=>{console.error("Error uploading files: ",x),F("Failed to upload files."),S("error"),c(!0),a(!1),y(0)})},B=p=>{const j=e.map(w=>w.id===p?{...w,deleted:!0}:w);M(j),F("File marked for deletion. Update to permanently delete."),S("info"),c(!0)},v=p=>{s(j=>{var w;return{...j,[p]:((w=e.find(C=>C.id===p))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},E=p=>{t(j=>{const w=j.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return U(w),w}),s(j=>{const w={...j};return delete w[p],w}),F("File name updated successfully."),S("info"),c(!0)},f=(p,j)=>{s(w=>({...w,[p]:j}))},u=(p,j)=>{j!=="clickaway"&&c(!1)};return i.jsxs("div",{children:[d&&i.jsx(Kt,{title:"Upload Files",children:i.jsxs(ke,{variant:"outlined",component:"label",startIcon:i.jsx(Qs,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:R,disabled:l,ref:z})]})}),l&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(b),"%"]})}),i.jsx(Gr,{children:e.map(p=>i.jsxs(Yr,{style:{opacity:p.deleted?.5:1},children:[i.jsx(Zr,{children:i.jsx(Ls,{})}),typeof n[p.id]=="string"?i.jsx(qt,{variant:"outlined",size:"small",value:n[p.id],onChange:j=>f(p.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&E(p.id),fullWidth:!0}):i.jsx(Kr,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),d&&(typeof n[p.id]=="string"?i.jsx(Pe,{onClick:()=>E(p.id),edge:"end","aria-label":"save",children:i.jsx(Un,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Pe,{onClick:()=>v(p.id),edge:"end","aria-label":"edit",children:i.jsx(mr,{})}),i.jsx(Pe,{onClick:()=>B(p.id),edge:"end","aria-label":"delete",children:i.jsx(Ht,{})})]}))]},p.id))}),i.jsx(mt,{open:r,autoHideDuration:6e3,onClose:u,children:i.jsx(pt,{onClose:u,severity:D,sx:{width:"100%"},children:m})})]})},Gs=({designs:g,setDesigns:A,setIsAdding:U,getDesigns:d,onReturnToDashboard:e})=>{const{userDetails:t}=$t(),l=Rn(),a=_n(l.breakpoints.down("md"));console.log("Add Design loaded");const[b,y]=H.useState(""),[n,s]=H.useState(""),[r,c]=H.useState(""),[m,F]=H.useState([]),[D,S]=H.useState([]),z=H.useMemo(()=>m,[m]),[M,R]=H.useState(!1),[B,v]=H.useState(""),[E,f]=H.useState("info"),[u,p]=H.useState(!1),[j,w]=H.useState("");console.log("Adding New Design from user:",t);const C=H.useRef(null),x=()=>{p(!1)},T=(o,_)=>{_!=="clickaway"&&R(!1)};H.useEffect(()=>{if(t!=null&&t.classes){const o=Object.keys(t.classes)[0];s(o||"")}},[t==null?void 0:t.classes]);const h=async o=>{var $;if(o.preventDefault(),console.log("Files to be saved:",D),!t||!t.uid){console.error("User object is undefined or missing UID."),w("You must be signed in to add a design."),p(!0);return}if(!b){w("All fields are required."),p(!0);return}await(($=C.current)==null?void 0:$.commitDeletions());const _=m.filter(q=>!q.deleted),I=D.filter(q=>!q.deleted).map(q=>({id:q.id,url:q.url,name:q.name,path:q.path})),P={title:r,description:b,course:n,dateCreated:Wt(),dateModified:Wt(),images:_,files:I,userId:t.uid};try{const q=await Mn(Te(se,"designs"),P),V={...P,id:q.id};A([...g,V]),v(`${r} has been Added.`),f("success"),R(!0),c(""),y(""),F([]),S([]),setTimeout(()=>{U(!1),d()},1e3)}catch(q){console.log(q),w("There was an issue adding your design."),p(!0)}};return i.jsxs(Ae,{sx:{p:a?ne[3]:ne[6],backgroundColor:K.background.primary,minHeight:"100vh"},children:[i.jsxs(Ae,{sx:{mb:ne[6]},children:[i.jsx(ke,{variant:"text",onClick:e,sx:{fontFamily:G.fontFamily.secondary,fontSize:a?G.fontSize.base:G.fontSize.lg,color:K.primary[600],textTransform:"none",fontWeight:G.fontWeight.medium,mb:ne[4],"&:hover":{backgroundColor:K.primary[100],color:K.primary[700]},transition:Pt.transitions.fast},children:"← All Designs"}),i.jsxs(Nt,{sx:{p:a?ne[4]:ne[6],backgroundColor:K.primary[50],borderRadius:Me["2xl"],border:`1px solid ${K.primary[200]}`,boxShadow:$e.sm},children:[i.jsx(Ve,{variant:"h2",sx:{fontFamily:G.fontFamily.display,fontSize:a?G.fontSize["3xl"]:G.fontSize["5xl"],fontWeight:G.fontWeight.bold,color:K.primary[700],lineHeight:G.lineHeight.tight,mb:ne[2]},children:"Create New Design"}),i.jsx(Ve,{variant:"body1",sx:{fontFamily:G.fontFamily.primary,fontSize:a?G.fontSize.base:G.fontSize.lg,color:K.text.secondary,lineHeight:G.lineHeight.relaxed},children:"Design and document your laboratory experiments and research projects"})]})]}),i.jsx(Nt,{sx:{p:a?ne[4]:ne[6],backgroundColor:K.background.elevated,borderRadius:Me["2xl"],border:`1px solid ${K.neutral[200]}`,boxShadow:$e.lg},children:i.jsxs("form",{onSubmit:h,children:[i.jsx(Ae,{sx:{mb:ne[5]},children:i.jsx(qt,{id:"title",label:"Design Title",value:r,onChange:o=>c(o.target.value),fullWidth:!0,required:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:Me.lg,fontFamily:G.fontFamily.primary,fontSize:G.fontSize.base},"& .MuiInputLabel-root":{fontFamily:G.fontFamily.secondary,fontSize:G.fontSize.base,fontWeight:G.fontWeight.medium}}})}),i.jsx(Ae,{sx:{mb:ne[5]},children:i.jsxs(Dn,{fullWidth:!0,required:!0,children:[i.jsx(fr,{sx:{fontFamily:G.fontFamily.secondary,fontSize:G.fontSize.base,fontWeight:G.fontWeight.medium},children:"Course"}),i.jsx(Xt,{id:"course",value:n,onChange:o=>s(o.target.value),disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,sx:{borderRadius:Me.lg,fontFamily:G.fontFamily.primary,fontSize:G.fontSize.base},children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([o,_])=>i.jsx(yt,{value:o,children:`${_.number} - ${_.title}`},o))})]})}),i.jsxs(Ae,{sx:{mb:ne[5]},children:[i.jsx(Ve,{variant:"h5",sx:{fontFamily:G.fontFamily.display,fontSize:G.fontSize.xl,fontWeight:G.fontWeight.semibold,color:K.text.primary,mb:ne[3]},children:"Design Description"}),i.jsxs(Nt,{sx:{p:ne[4],backgroundColor:K.background.secondary,borderRadius:Me.lg,border:`1px solid ${K.neutral[200]}`,mb:ne[3]},children:[i.jsx(Ve,{variant:"body2",sx:{fontFamily:G.fontFamily.primary,fontSize:G.fontSize.sm,color:K.text.secondary,mb:ne[2],fontWeight:G.fontWeight.medium},children:"Please include the following elements in your description:"}),i.jsxs(Ae,{component:"ul",sx:{pl:ne[4],m:0,"& li":{fontFamily:G.fontFamily.primary,fontSize:G.fontSize.sm,color:K.text.secondary,mb:ne[1]}},children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]})]}),i.jsx(Ke,{onChange:y,initialValue:b})]}),i.jsx(Xr,{sx:{my:ne[5]}}),i.jsxs(Ae,{sx:{mb:ne[5]},children:[i.jsx(Ve,{variant:"h5",sx:{fontFamily:G.fontFamily.display,fontSize:G.fontSize.xl,fontWeight:G.fontWeight.semibold,color:K.text.primary,mb:ne[3]},children:"Attachments"}),i.jsx(ft,{ref:C,path:"designs/images",initialImages:z,onImagesUpdated:F,onDelete:o=>F(m.filter(_=>!o.includes(_))),isOwnDesign:!0}),i.jsx(Ae,{sx:{mt:ne[4]},children:i.jsx(Ct,{path:"designs/files",initialFiles:D,onFilesChange:S,isOwnDesign:!0})})]}),i.jsxs(Ae,{sx:{display:"flex",justifyContent:"flex-end",gap:ne[3],mt:ne[6],flexDirection:a?"column":"row"},children:[i.jsx(ke,{onClick:()=>U(!1),variant:"outlined",sx:{fontFamily:G.fontFamily.display,fontSize:G.fontSize.lg,fontWeight:G.fontWeight.semibold,textTransform:"none",px:ne[6],py:ne[3],borderRadius:Me.xl,borderColor:K.error,color:K.error,"&:hover":{borderColor:K.error,backgroundColor:K.error+"10",boxShadow:$e.md},transition:Pt.transitions.fast},children:"Cancel"}),i.jsx(ke,{type:"submit",variant:"contained",sx:{fontFamily:G.fontFamily.display,fontSize:G.fontSize.lg,fontWeight:G.fontWeight.semibold,textTransform:"none",px:ne[6],py:ne[3],backgroundColor:K.primary[500],borderRadius:Me.xl,boxShadow:$e.md,"&:hover":{backgroundColor:K.primary[600],boxShadow:$e.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"},transition:Pt.transitions.fast},children:"Create Design"})]})]})}),i.jsxs(ht,{open:u,onClose:x,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",PaperProps:{sx:{borderRadius:Me["2xl"],boxShadow:$e.xl}},children:[i.jsx(Ft,{id:"alert-dialog-title",sx:{fontFamily:G.fontFamily.display,fontSize:G.fontSize.xl,fontWeight:G.fontWeight.semibold,color:K.text.primary},children:"Notification"}),i.jsx(gt,{children:i.jsx(Lt,{id:"alert-dialog-description",sx:{fontFamily:G.fontFamily.primary,fontSize:G.fontSize.base,color:K.text.secondary},children:j})}),i.jsx(At,{children:i.jsx(ke,{onClick:x,autoFocus:!0,sx:{fontFamily:G.fontFamily.display,fontSize:G.fontSize.base,fontWeight:G.fontWeight.medium,textTransform:"none",borderRadius:Me.lg},children:"Ok"})})]}),i.jsx(mt,{open:M,autoHideDuration:1e3,onClose:T,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:i.jsx(pt,{onClose:T,severity:E,sx:{width:"100%",borderRadius:Me.lg,fontFamily:G.fontFamily.primary,fontSize:G.fontSize.base},children:B})})]})},Ys=({designId:g,setIsAddingBuild:A,refreshBuilds:U})=>{const[d,e]=H.useState(""),[t,l]=H.useState(""),[a,b]=H.useState([]),[y,n]=H.useState([]),{userDetails:s}=$t(),r=j=>{b(j)},c=j=>{n(j)};console.log("AddBuild loaded");const[m,F]=H.useState(!1),[D,S]=H.useState(""),[z,M]=H.useState(!1),[R,B]=H.useState(""),[v,E]=H.useState("info");console.log("Adding New Build by user:",s);const f=()=>{F(!1)},u=(j,w)=>{w!=="clickaway"&&M(!1)},p=async j=>{if(j.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),F(!0);return}if(!t){S("Build description is required."),F(!0);return}const w=a.filter(x=>!x.deleted),C=y.filter(x=>!x.deleted).map(x=>({id:x.id,url:x.url,name:x.name,path:x.path}));try{const x=await Mn(Te(se,"builds"),{title:d,description:t,design_ID:g,dateCreated:Wt(),userId:s.uid,images:w,files:C});console.log("Build added with ID: ",x.id),console.log("Added New Build by user:",s),B("Your build has been successfully added."),E("success"),M(!0),setTimeout(()=>{e(""),l(""),b([]),n([]),A(!1),U()},1e3)}catch(x){if(console.error("Error adding build: ",x),x instanceof Error){let T=`Failed to add the build. ${x.message}`;x.message==="permission-denied"&&(T="You do not have permission to perform this operation."),B(T),E("error"),M(!0)}else B("Failed to add the build. Please try again later."),E("error"),M(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:d,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(Ke,{onChange:l,initialValue:t})," ",i.jsx(ft,{path:`builds/${g}/images`,initialImages:a,onImagesUpdated:r,onDelete:j=>b(w=>w.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(Ct,{path:`builds/${g}/files`,initialFiles:y,onFilesChange:c,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>A(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(ht,{open:m,onClose:f,children:[i.jsx(Ft,{children:"Notification"}),i.jsx(gt,{children:i.jsx(Lt,{children:D})}),i.jsx(At,{children:i.jsx(ke,{onClick:f,children:"OK"})})]}),i.jsx(mt,{open:z,autoHideDuration:6e3,onClose:u,children:i.jsx(pt,{onClose:u,severity:v,sx:{width:"100%"},children:R})})]})},Zs=({designId:g,buildId:A,refreshTests:U,setAddingTestIdForBuild:d})=>{const[e,t]=H.useState(""),[l,a]=H.useState(""),[b,y]=H.useState(""),[n,s]=H.useState(""),[r,c]=H.useState([]),[m,F]=H.useState([]),{userDetails:D}=$t();console.log("AddTest loaded");const[S,z]=H.useState(!1),[M,R]=H.useState(""),[B,v]=H.useState(!1),[E,f]=H.useState(""),[u,p]=H.useState("info"),j=C=>{F(C)},w=async()=>{if(!l){R("Test description cannot be empty!"),z(!0);return}const C=r.filter(T=>!T.deleted),x=m.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{await Mn(Te(se,"tests"),{title:e,build_ID:A,design_ID:g,dateCreated:Wt(),description:l,results:b,conclusions:n,userId:D==null?void 0:D.uid,images:C,files:x}),setTimeout(()=>{U(A),t(""),a(""),y(""),s(""),c([]),F([]),d(!1)},1e3),f("Test added successfully"),p("success"),v(!0)}catch(T){console.error("Error adding test: ",T),f("Failed to add the test"),p("error"),v(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(Ke,{onChange:a,initialValue:l}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(Ke,{onChange:y,initialValue:b}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(Ke,{onChange:s,initialValue:n}),i.jsx(ft,{path:`tests/${A}/images`,initialImages:r,onImagesUpdated:C=>{c(C)},onDelete:C=>c(x=>x.filter(T=>!C.includes(T))),isOwnDesign:!0}),i.jsx(Ct,{path:`tests/${A}/files`,initialFiles:m,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>d(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(ht,{open:S,onClose:()=>z(!1),children:[i.jsx(Ft,{children:"Notification"}),i.jsx(gt,{children:i.jsx(Lt,{children:M})}),i.jsx(At,{children:i.jsx(ke,{onClick:()=>z(!1),children:"OK"})})]}),i.jsx(mt,{open:B,autoHideDuration:6e3,onClose:()=>v(!1),children:i.jsx(pt,{onClose:()=>v(!1),severity:u,sx:{width:"100%"},children:E})})]})};var zt={},ur;function Ks(){if(ur)return zt;ur=1;var g=ot();Object.defineProperty(zt,"__esModule",{value:!0}),zt.default=void 0;var A=g(lt()),U=at();return zt.default=(0,A.default)((0,U.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),zt}var Xs=Ks();const kn=tt(Xs),Bt=g=>g&&g instanceof En?g.toDate().toLocaleString():"",Js=({selectedDesign:g,setIsEditing:A,onReturnToDashboard:U})=>{const{userDetails:d,loading:e}=$t(),t=g.id,l=g.userId===(d==null?void 0:d.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",d);const[a,b]=H.useState(""),[y,n]=H.useState(g.description),[s,r]=H.useState(g.course||""),[c,m]=H.useState(Bt(g.dateCreated)),[F,D]=H.useState(Bt(g.dateModified)),[S,z]=H.useState([]),[M,R]=H.useState([]),B=H.useRef(null),[v,E]=H.useState(!1),[f,u]=H.useState([]),[p,j]=H.useState({}),[w,C]=H.useState({}),[x,T]=H.useState({}),h=H.useRef(null),[o,_]=H.useState({}),[I,P]=H.useState({}),[$,q]=H.useState({}),[V,W]=H.useState(!1),[O,X]=H.useState({}),[re,J]=H.useState({}),[te,le]=H.useState({}),[ie,he]=H.useState({}),[Ne,De]=H.useState({}),ge=H.useRef(null),[ye,me]=H.useState({}),[de,be]=H.useState({}),[ve,pe]=H.useState({}),[Ue,ce]=H.useState(!1),[fe,je]=H.useState(""),[Qe,nt]=H.useState(()=>()=>{}),[Se,ue]=H.useState(!1),[Fe,oe]=H.useState(""),[Ee,ae]=H.useState("info"),[Re,we]=H.useState({design:!1,builds:!1,tests:!1}),Tt=async k=>{if(k.preventDefault(),!y){je("All fields are required."),ce(!0);return}console.log("About to check image deletions",B.current),console.log(B.current),console.log(S.some(Q=>Q.deleted)),B.current&&S.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await B.current.commitDeletions());const L=S.filter(Q=>!Q.deleted);M.some(Q=>Q.deleted)&&await Vt();const N=M.filter(Q=>!Q.deleted),Z={title:a,description:y,course:s,dateModified:Wt(),images:L.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:N.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:d.uid};try{await st(Ce(se,"designs",t),Z,{merge:!0}),oe("Your design has been updated."),ae("success"),ue(!0);const Q=En.now();D(Bt(Q))}catch(Q){console.error("Error updating design:",Q),oe("There was an issue updating your design."),ae("error"),ue(!0)}we(Q=>({...Q,design:!1}))};H.useEffect(()=>{g&&(n(g.description||""),b(g.title||""),r(g.course||""),(async()=>{const L=Ce(se,"designs",t),N=await os(L);if(N.exists()){const Z=N.data();console.log("Fetched images:",Z.images),console.log("Fetched files:",Z.files),z(Z.images||[]),R(Z.files||[]),m(Bt(Z.dateCreated)),D(Bt(Z.dateModified))}})())},[g,t]);const sn=k=>{const L=S.filter(Z=>!k.some(Q=>Q.path===Z.path));console.log("Remaining images after deletion:",L),z(L);const N=L.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));st(Ce(se,"designs",t),{images:N},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Z=>console.error("Failed to update Firestore:",Z))},It=k=>{JSON.stringify(S)!==JSON.stringify(k)&&(z(k),console.log("Updated images received:",k))},Vt=async()=>{const k=M.filter(L=>L.deleted);if(console.log("Files to delete:",k),k.length>0){const L=jt(),N=k.map(Z=>{const Q=St(L,Z.path);return Yt(Q)});try{await Promise.all(N),console.log("Files deleted successfully");const Z=M.filter(Q=>!Q.deleted);R(Z),await fn(Ce(se,"designs",g.id),{files:Z.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),oe("Deleted files have been permanently removed."),ae("success"),ue(!0)}catch(Z){console.error("Failed to delete files: ",Z),oe("Failed to delete files."),ae("error"),ue(!0)}}},dt=async k=>{var Q,ee;try{await Ur(k)}catch(Y){console.error("Error deleting files:",Y),oe("Failed to delete build files."),ae("error"),ue(!0)}const L=((Q=w[k])==null?void 0:Q.filter(Y=>!Y.deleted).map(({url:Y,path:_e,title:Je})=>({url:Y,path:_e,title:Je})))||[],N=((ee=x[k])==null?void 0:ee.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[],Z={};L.length>0&&(Z.images=L),N.length>0&&(Z.files=N),p[k]!==void 0&&(Z.description=p[k]);try{const Y=Ce(se,"builds",k);await st(Y,Z,{merge:!0}),oe("Your build has been updated."),ae("success"),ue(!0),He(),we(_e=>({..._e,builds:!1}))}catch(Y){console.error("Error updating build:",Y),oe("Failed to update build."),ae("error"),ue(!0)}},on=(k,L)=>{P(N=>({...N,[k]:L}))},Ge=(k,L)=>{j(N=>({...N,[k]:L})),we(N=>({...N,builds:!0}))},qe=async k=>{const L=I[k];try{const N=Ce(se,"builds",k);await st(N,{title:L},{merge:!0}),P(Z=>{const Q={...Z};return delete Q[k],Q}),He()}catch(N){console.error("Failed to save build title:",N)}},He=async()=>{if(!d){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",d==null?void 0:d.uid),console.log("Selected design ID for query:",g==null?void 0:g.id);let k;d.isAdmin?k=Oe(Te(se,"builds"),xe("design_ID","==",t),Le("dateCreated")):k=Oe(Te(se,"builds"),xe("design_ID","==",t),xe("userId","==",d.uid),Le("dateCreated")),console.log("Builds query details:",JSON.stringify(k,null,2));const L=await it(k);console.log("Builds snapshot details:",JSON.stringify(L.docs.map(Z=>Z.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",L.docs.length);const N=L.docs.map(Z=>(console.log("Build doc path: ",Z.ref.path),{id:Z.id,...Z.data()}));u(N),console.log("New builds state after refresh:",N)}catch(k){console.error("Error refreshing builds:",k),k.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",k):console.error("An unexpected error occurred when trying to refresh builds:",k)}},ct=(k,L)=>{const N=Ce(se,"builds",k),Z=w[k].filter(ee=>!L.some(Y=>Y.path===ee.path));C(ee=>({...ee,[k]:Z}));const Q=Z.map(ee=>({url:ee.url,title:ee.title,path:ee.path}));st(N,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),oe("Build Image deletions updated."),ae("success")}).catch(ee=>{console.error("Failed to update build images in Firestore:",ee),oe("Failed to update build image deletions."),ae("error")}),ue(!0)},Qt=async k=>{const L=Oe(Te(se,"tests"),xe("build_ID","==",k),xe("userId","==",d.uid)),N=await it(L);for(const Z of N.docs)await wt(Ce(se,"tests",Z.id));await wt(Ce(se,"builds",k)),await He(),oe("Build and its tests (if any) deleted successfully."),ae("success"),ue(!0)},Xe=k=>{je("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),nt(()=>()=>Qt(k)),ce(!0)},Ye=(k,L)=>{C(N=>({...N,[k]:L}))},Bn=(k,L)=>{T(N=>({...N,[k]:L}))},Ur=async k=>{var N;const L=((N=x[k])==null?void 0:N.filter(Z=>Z.deleted))||[];if(console.log("Build files to delete:",L),L.length>0){const Z=jt(),Q=L.map(ee=>{const Y=St(Z,ee.path);return Yt(Y)});try{await Promise.all(Q),console.log("Build files deleted successfully");const ee=x[k].filter(Y=>!Y.deleted);T(Y=>({...Y,[k]:ee})),await fn(Ce(se,"builds",k),{files:ee.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),console.log("Firestore successfully updated to remove deleted files"),oe("Deleted build files have been permanently removed."),ae("success"),ue(!0)}catch(ee){console.error("Failed to delete build files: ",ee),oe("Failed to delete build files."),ae("error"),ue(!0)}}},Rr=async(k,L)=>{var ee;try{await Br(k)}catch(Y){console.error("Error deleting files:",Y),oe("Failed to delete build files."),ae("error"),ue(!0)}const N={},Z=ie[k].filter(Y=>!Y.deleted).map(({url:Y,path:_e,title:Je})=>({url:Y,path:_e,title:Je})),Q=((ee=Ne[k])==null?void 0:ee.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[];O[k]!==void 0&&(N.description=O[k]),re[k]!==void 0&&(N.results=re[k]),te[k]!==void 0&&(N.conclusions=te[k]),N.images=Z,N.files=Q;try{const Y=Ce(se,"tests",k);await st(Y,N,{merge:!0}),oe("Your test has been updated."),ae("success"),ue(!0),Gt(L)}catch(Y){console.error(`Error updating test ID: ${k}:`,Y),oe("There was an issue updating your test."),ae("error"),ue(!0)}},_r=(k,L)=>{be(N=>({...N,[k]:L}))},Nn=async(k,L)=>{const N=de[k],Z=Ce(se,"tests",k);await st(Z,{title:N},{merge:!0}),be(Q=>{const ee={...Q};return delete ee[k],ee}),Gt(L)},Er=(k,L)=>{console.log(`Updating description for test ID ${k}:`,L),X(N=>({...N,[k]:L})),we(N=>({...N,tests:!0}))},Mr=(k,L)=>{console.log(`Updating results for test ID ${k}:`,L),J(N=>({...N,[k]:L})),we(N=>({...N,tests:!0}))},Or=(k,L)=>{le(N=>({...N,[k]:L})),we(N=>({...N,tests:!0}))};H.useEffect(()=>{!e&&d&&(async()=>{if(!d)return;let L;d.isAdmin?L=Oe(Te(se,"builds"),xe("design_ID","==",t),Le("dateCreated")):L=Oe(Te(se,"builds"),xe("design_ID","==",t),xe("userId","==",d.uid),Le("dateCreated"));const N=await it(L),Z=[],Q={},ee={};for(const Y of N.docs){const _e=Y.data(),Je=Y.id;Z.push({id:Je,..._e,images:_e.images||[],files:_e.files||[]}),ee[Je]=!0;let an;d.isAdmin?an=Oe(Te(se,"tests"),xe("build_ID","==",Je),Le("dateCreated")):an=Oe(Te(se,"tests"),xe("build_ID","==",Je),xe("userId","==",d.uid),Le("dateCreated"));const Wr=await it(an),Hn=[],ln={},dn={};for(const rt of Wr.docs){const et=rt.data();Hn.push({id:rt.id,...et}),ln[rt.id]=et.images||[],dn[rt.id]=et.files||[]}Q[Je]=Hn,he(rt=>{const et={...rt};for(const kt in ln)et[kt]=ln[kt];return et}),De(rt=>{const et={...rt};for(const kt in dn)et[kt]=dn[kt];return et})}u(Z),q(Q),pe(ee)})()},[e,d,g.id,t]);const Gt=async k=>{if(!d){console.log("User details not loaded yet");return}try{let L;d.isAdmin?L=Oe(Te(se,"tests"),xe("build_ID","==",k),Le("dateCreated")):L=Oe(Te(se,"tests"),xe("build_ID","==",k),xe("userId","==",d.uid),Le("dateCreated"));const Z=(await it(L)).docs.map(Y=>{const _e=Y.data();return{id:Y.id,..._e,images:_e.images||[],files:_e.files||[]}});q(Y=>({...Y,[k]:Z}));const Q={},ee={};Z.forEach(Y=>{Q[Y.id]=Y.images,ee[Y.id]=Y.files}),he(Q),De(ee)}catch(L){console.error("Error fetching tests:",L)}},zr=(k,L)=>{const N=Ce(se,"tests",k),Z=ie[k].filter(ee=>!L.includes(ee));he(ee=>({...ee,[k]:Z}));const Q=Z.map(({url:ee,path:Y,title:_e})=>({url:ee,path:Y,title:_e}));st(N,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),oe("Test Image deletions updated."),ae("success")}).catch(ee=>{console.error("Failed to update test images in Firestore:",ee),oe("Failed to update test image deletions."),ae("error")}),ue(!0)},Pn=(k,L)=>{he(N=>({...N,[k]:L}))},qn=(k,L)=>{De(N=>({...N,[k]:L}))},Br=async k=>{var N;const L=((N=Ne[k])==null?void 0:N.filter(Z=>Z.deleted))||[];if(L.length>0){const Z=jt(),Q=L.map(ee=>{const Y=St(Z,ee.path);return Yt(Y)});try{await Promise.all(Q);const ee=Ne[k].filter(Y=>!Y.deleted);De(Y=>({...Y,[k]:ee})),await fn(Ce(se,"tests",k),{files:ee.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),oe("Deleted test files have been permanently removed."),ae("success"),ue(!0)}catch(ee){console.error("Failed to delete test files: ",ee),oe("Failed to delete test files."),ae("error"),ue(!0)}}},Nr=async(k,L)=>{await wt(Ce(se,"tests",k)),await Gt(L),oe("Test deleted successfully."),ae("success"),ue(!0)},Pr=(k,L)=>{je("Are you sure you want to delete this test? This action cannot be undone."),nt(()=>()=>Nr(k,L)),ce(!0)},qr=k=>{pe(L=>({...L,[k]:!L[k]}))},Hr=()=>{const k=Object.entries(Re).filter(([N,Z])=>Z).map(([N])=>N).join(", ");if(!k.length){U();return}const L=`You have unsaved changes in the following sections: ${k}. Are you sure you want to leave?`;je(L),nt(()=>()=>{we({design:!1,builds:!1,tests:!1}),U()}),ce(!0)};return H.useEffect(()=>{const k=L=>{Object.values(Re).some(Z=>Z)&&(L.preventDefault(),L.returnValue="")};return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[Re]),i.jsxs("div",{className:"small-container",children:[i.jsx(ke,{variant:"text",onClick:()=>{Object.values(Re).some(L=>L)?Hr():U()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:Tt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:a,onChange:k=>{b(k.target.value),we(L=>({...L,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:c||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:F||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Xt,{id:"course",value:s,onChange:k=>{r(k.target.value),we(L=>({...L,design:!0}))},fullWidth:!0,children:(d!=null&&d.classes?Object.entries(d.classes):[]).map(([k,L])=>i.jsx(yt,{value:k,children:`${L.number} - ${L.title}`},k))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(Ke,{initialValue:y,onChange:k=>{n(k),we(L=>({...L,design:!0}))}}),i.jsx(ft,{ref:B,path:`designs/${g.id}/images`,initialImages:S,onImagesUpdated:It,onDelete:sn,isOwnDesign:l}),i.jsx(Ct,{path:`designs/${g.id}/files`,initialFiles:M,onFilesChange:R,isOwnDesign:l}),l&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>A(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),l&&i.jsxs("button",{className:"button muted-button",onClick:()=>{E(!0),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),f.map((k,L)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:I[k.id]!==void 0?i.jsx(qt,{variant:"outlined",size:"small",fullWidth:!0,value:I[k.id],onChange:N=>on(k.id,N.target.value),onBlur:()=>qe(k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Pe,{onClick:()=>qe(k.id),size:"small",children:i.jsx(Un,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>P(N=>({...N,[k.id]:k.title||`Build ${L+1}`})),style:{cursor:"pointer"},children:k.title||`Build ${L+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>_(N=>({...N,[k.id]:!N[k.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:o[k.id]?i.jsx(kn,{}):i.jsx(un,{})}),l&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Xe(k.id),children:i.jsx(Ht,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{W(k.id),setTimeout(()=>{ge.current&&ge.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),o[k.id]&&i.jsxs(i.Fragment,{children:[i.jsx(Ke,{initialValue:p[k.id]||k.description,onChange:N=>{Ge(k.id,N)}}),i.jsx(ft,{path:`builds/${k.id}/images`,initialImages:k.images,onImagesUpdated:N=>Ye(k.id,N),onDelete:N=>ct(k.id,N),isOwnDesign:l}),i.jsx(Ct,{path:`builds/${k.id}/files`,initialFiles:k.files,onFilesChange:N=>Bn(k.id,N),isOwnDesign:l}),l&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>dt(k.id),children:"Update"})}),i.jsx("div",{children:$[k.id]&&$[k.id].length>0&&i.jsx("button",{onClick:()=>qr(k.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:ve[k.id]?i.jsxs(i.Fragment,{children:[i.jsx(un,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(kn,{style:{marginRight:"8px"}}),"Tests"]})})}),!ve[k.id]&&$[k.id]&&$[k.id].map((N,Z)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:de[N.id]!==void 0?i.jsx(qt,{variant:"outlined",size:"small",fullWidth:!0,value:de[N.id],onChange:Q=>_r(N.id,Q.target.value),onBlur:()=>Nn(N.id,k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Pe,{onClick:()=>Nn(N.id,k.id),size:"small",children:i.jsx(Un,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>be(Q=>({...Q,[N.id]:N.title||`Test ${Z+1}`})),style:{cursor:"pointer"},children:N.title||`Test ${Z+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>me(Q=>({...Q,[N.id]:!Q[N.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:ye[N.id]?i.jsx(kn,{}):i.jsx(un,{})}),l&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Pr(N.id,k.id),children:i.jsx(Ht,{})})]})]}),ye[N.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(Ke,{initialValue:O[N.id]||N.description,onChange:Q=>{Er(N.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(Ke,{initialValue:re[N.id]||N.results,onChange:Q=>{Mr(N.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(Ke,{initialValue:te[N.id]||N.conclusions,onChange:Q=>{Or(N.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(ft,{path:`tests/${N.id}/images`,initialImages:ie[N.id]||[],onImagesUpdated:Q=>Pn(N.id,Q),onDelete:Q=>zr(N.id,Q),isOwnDesign:l}),i.jsx(Ct,{path:`tests/${N.id}/files`,initialFiles:Ne[N.id]||[],onFilesChange:Q=>qn(N.id,Q),isOwnDesign:l})]}),l&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Rr(N.id,k.id),children:"Update"})})]})]},N.id))]}),V===k.id&&i.jsxs("div",{className:"new-test-record",ref:ge,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Zs,{designId:g.id,buildId:k.id,refreshTests:()=>Gt(k.id),setAddingTestIdForBuild:W,onImagesUpdated:N=>Pn(k.id,N),onFilesChange:N=>qn(k.id,N)})]})]},k.id)),i.jsx("div",{children:v&&i.jsxs("div",{className:"new-build-record",ref:h,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Ys,{designId:g.id,setIsAddingBuild:E,refreshBuilds:He,onImagesUpdated:k=>Ye("temp-build-id",k),onFilesChange:k=>Bn("temp-build-id",k)})]})})]}),i.jsxs(ht,{open:Ue,onClose:()=>ce(!1),children:[i.jsx(Ft,{children:"Confirmation Required"}),i.jsx(gt,{children:i.jsx(Lt,{children:fe})}),i.jsxs(At,{children:[i.jsx(ke,{onClick:()=>ce(!1),children:"Cancel"}),i.jsx(ke,{onClick:()=>{Qe(),ce(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(mt,{open:Se,autoHideDuration:6e3,onClose:()=>ue(!1),children:i.jsx(pt,{onClose:()=>ue(!1),severity:Ee,sx:{width:"100%"},children:Fe})})]})},xt=(g,A,U)=>g[A]??U,ei=()=>{const{userDetails:g,loading:A}=$t(),U=Rn(),d=_n(U.breakpoints.down("md"));console.log("Dashboard loaded");const[e,t]=H.useState([]),[l,a]=H.useState([]),[b,y]=H.useState([]),[n,s]=H.useState(null),[r,c]=H.useState(!1),[m,F]=H.useState(!1),[D,S]=H.useState(!1),[z,M]=H.useState(""),[R,B]=H.useState(""),[v,E]=H.useState(!1),[f,u]=H.useState(null),[p,j]=H.useState(!1),[w,C]=H.useState(""),[x,T]=H.useState("info"),h=()=>{F(!1),c(!1),s(null),o()},o=H.useCallback(async()=>{if(!g)return;let q;const V=[],W=[],O=[];if(g.isSuperAdmin)q=Oe(Te(se,"designs"),Le("dateCreated","desc"));else if(g.isAdmin){const re=g.classes?Object.keys(g.classes):[];if(re.length>0)q=Oe(Te(se,"designs"),xe("course","in",re),Le("dateCreated","desc"));else{a([]),y([]);return}}else q=Oe(Te(se,"designs"),xe("userId","==",g.uid),Le("dateCreated","desc"));(await it(q)).forEach(re=>{const J=re.data(),te={id:re.id,title:xt(J,"title",""),description:xt(J,"description",""),course:xt(J,"course",""),dateCreated:J.dateCreated,dateModified:J.dateModified,userId:xt(J,"userId",""),images:xt(J,"images",[]),files:xt(J,"files",[])};g.isSuperAdmin?J.userId===g.uid?V.push(te):J.userId!==g.uid&&J.course&&J.isAdmin?W.push(te):J.userId!==g.uid&&!J.isAdmin&&O.push(te):g.isAdmin?J.userId===g.uid?W.push(te):O.push(te):J.userId===g.uid&&O.push(te)}),t(V),a(W),y(O)},[g]);H.useEffect(()=>{!A&&g&&o()},[g,A,o]);const _=q=>{const V=[...e,...l,...b].find(W=>W.id===q);s(V||null),F(!0)},I=q=>{u(q),M("Are you sure you want to delete this design? This action cannot be undone."),S(!0)},P=async()=>{if(f)if(R!==(g==null?void 0:g.uid))C("User ID confirmation failed. Enter the correct User ID."),T("error"),j(!0);else try{const q=Oe(Te(se,"builds"),xe("design_ID","==",f),xe("userId","==",g.uid)),V=await it(q);for(const W of V.docs){const O=W.id,X=Oe(Te(se,"tests"),xe("build_ID","==",O),xe("userId","==",g.uid)),re=await it(X);for(const J of re.docs)await wt(Ce(se,"tests",J.id));await wt(Ce(se,"builds",O))}await wt(Ce(se,"designs",f)),t(W=>W.filter(O=>O.id!==f)),a(W=>W.filter(O=>O.id!==f)),y(W=>W.filter(O=>O.id!==f)),C("Your design and its associated builds and tests have been deleted."),T("success"),j(!0)}catch(q){console.error("Error deleting design, builds, and tests: ",q),C("There was an issue deleting your design and its associated builds and tests."),T("error"),j(!0)}finally{B(""),E(!1),u(null)}},$=(q,V,W)=>i.jsx(Ae,{sx:{mb:ne[4],mt:ne[6]},children:i.jsx(Nt,{sx:{p:d?ne[3]:ne[4],backgroundColor:K.background.secondary,borderRadius:Me.lg,border:`1px solid ${K.neutral[200]}`,boxShadow:$e.sm},children:i.jsxs(Ae,{sx:{display:"flex",alignItems:"center",gap:ne[3],flexDirection:d?"column":"row",textAlign:d?"center":"left"},children:[i.jsx(Ve,{variant:"h4",sx:{fontFamily:G.fontFamily.display,fontSize:d?G.fontSize.xl:G.fontSize["2xl"],fontWeight:G.fontWeight.bold,color:K.text.primary},children:q}),i.jsx(es,{label:`${V} ${V===1?"Design":"Designs"}`,size:"small",sx:{backgroundColor:W,color:K.text.inverse,fontFamily:G.fontFamily.secondary,fontWeight:G.fontWeight.semibold,fontSize:G.fontSize.sm}})]})})});return i.jsxs(Ae,{sx:{p:d?ne[3]:ne[6],backgroundColor:K.background.primary,minHeight:"100vh"},children:[!r&&!m&&i.jsxs(i.Fragment,{children:[i.jsx(pr,{setIsAdding:c}),(g==null?void 0:g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[$("My Designs",e.length,K.primary[500]),i.jsx(bt,{designs:e,handleEdit:_,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),$("Educator Designs",l.length,K.secondary[500]),i.jsx(bt,{designs:l,handleEdit:_,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),$("Student Designs",b.length,K.info),i.jsx(bt,{designs:b,handleEdit:_,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),(g==null?void 0:g.isAdmin)&&!g.isSuperAdmin&&i.jsxs(i.Fragment,{children:[$("My Educator Designs",l.length,K.secondary[500]),i.jsx(bt,{designs:l,handleEdit:_,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),$("Student Designs",b.length,K.info),i.jsx(bt,{designs:b,handleEdit:_,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),!(g!=null&&g.isAdmin)&&!(g!=null&&g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[$("My Designs",b.length,K.primary[500]),i.jsx(bt,{designs:b,handleEdit:_,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!1})]})]}),r&&i.jsx(Gs,{designs:e.concat(l),setDesigns:a,setIsAdding:c,getDesigns:o,onReturnToDashboard:h}),m&&i.jsx(Js,{designs:e.concat(l),selectedDesign:n,setDesigns:a,setIsEditing:F,getDesigns:o,onReturnToDashboard:h}),i.jsxs(ht,{open:D,onClose:()=>S(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ft,{children:"Confirm Deletion"}),i.jsx(gt,{children:i.jsx(Lt,{children:z})}),i.jsxs(At,{children:[i.jsx(ke,{onClick:()=>S(!1),children:"No, cancel"}),i.jsx(ke,{onClick:()=>{E(!0),S(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(ht,{open:v,onClose:()=>E(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ft,{children:"Confirm Your User ID"}),i.jsx(gt,{children:i.jsx(qt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:R,onChange:q=>B(q.target.value)})}),i.jsxs(At,{children:[i.jsx(ke,{onClick:()=>E(!1),children:"No, cancel"}),i.jsx(ke,{onClick:P,color:"primary",children:"Confirm"})]})]}),i.jsx(mt,{open:p,autoHideDuration:6e3,onClose:()=>j(!1),children:i.jsx(pt,{onClose:()=>j(!1),severity:x,sx:{width:"100%"},children:w})})]})},ai=Jr.memo(ei);export{ai as default};
