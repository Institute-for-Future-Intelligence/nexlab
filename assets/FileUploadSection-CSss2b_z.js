const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dmye7Bf4.js","assets/ui-D-CDl99o.js","assets/vendor-BFl3bqVE.js","assets/firebase-CTJJwFJC.js","assets/index-BA2bQjcR.css"])))=>i.map(i=>d[i]);
var Jt=Object.defineProperty;var er=(y,g,p)=>g in y?Jt(y,g,{enumerable:!0,configurable:!0,writable:!0,value:p}):y[g]=p;var wt=(y,g,p)=>er(y,typeof g!="symbol"?g+"":g,p);import{h as tr,i as rr,p as nr,_ as at,b as re,s as $,c as W,t as Q,R as ir,a as It,v as pt}from"./index-Dmye7Bf4.js";import{l as or,P as sr,q as lt,h as Se,_ as Ee,e as xe,i as dt,R as Ge,v as ke,t as Qe,y as Pe,f as ct,x as At,k as Ze,r as Xe,z as Et,n as kt,p as Rt}from"./firebase-CTJJwFJC.js";import{j as B,V as jt,W as ar,B as oe,bF as lr,T as ae,X as Tt,Z as dr,a as Ye,r as le,t as Je,I as Ne,bG as cr,bH as Ct,bI as _t,a7 as St,aJ as Mt,al as zt,A as Bt,G as Dt,E as fr,by as ur,H as hr,z as gr,ac as pr,bw as br,a8 as Lt,b1 as mr,aK as bt,a0 as yr,a1 as xr,b9 as vr,a2 as wr,bz as Ir,v as Ar,bA as Cr,bB as _r,at as Ft,bC as Sr,bD as Dr}from"./ui-D-CDl99o.js";import Ve from"./purify.es-CQJ0hv7W.js";const Oe=y=>y?y instanceof or||y.toDate&&typeof y.toDate=="function"?y.toDate():y.seconds?new Date(y.seconds*1e3):new Date:new Date,ft={courseId:null,searchQuery:"",dateRange:{start:null,end:null},nodeTypes:{designs:!0,builds:!0,tests:!0}},ut={x:0,y:0,zoom:1},Gr=tr()(rr(nr((y,g)=>({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,layoutType:"horizontal",viewMode:"graph",isExpanded:!1,deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null},filters:ft,viewport:ut,fetchAllData:async(p,i=!1,e=[])=>{y({isLoading:!0,error:null});try{const{collection:t,query:l,where:s,getDocs:m,orderBy:v}=await at(async()=>{const{collection:R,query:F,where:_,getDocs:T,orderBy:h}=await import("./firebase-CTJJwFJC.js").then(U=>U.B);return{collection:R,query:F,where:_,getDocs:T,orderBy:h}},[]),{db:n}=await at(async()=>{const{db:R}=await import("./index-Dmye7Bf4.js").then(F=>F.G);return{db:R}},__vite__mapDeps([0,1,2,3,4]));let o;i&&e.length>0?o=l(t(n,"designs"),s("course","in",e),v("dateCreated","desc")):o=l(t(n,"designs"),s("userId","==",p),v("dateCreated","desc"));const a=(await m(o)).docs.map(R=>{const F=R.data();return{id:R.id,title:F.title||"",description:F.description||"",course:F.course||"",dateCreated:F.dateCreated,dateModified:F.dateModified,userId:F.userId||"",images:F.images||[],files:F.files||[]}}),b=a.map(R=>R.id);let S=[];if(b.length>0){const R=[];for(let _=0;_<b.length;_+=10){const T=b.slice(_,_+10),h=l(t(n,"builds"),s("design_ID","in",T));R.push(m(h))}S=(await Promise.all(R)).flatMap(_=>_.docs.map(T=>{const h=T.data();return{id:T.id,title:h.title||"",description:h.description||"",design_ID:h.design_ID||"",dateCreated:h.dateCreated,userId:h.userId||"",images:h.images||[],files:h.files||[]}}))}const E=S.map(R=>R.id);let x=[];if(E.length>0){const R=[];for(let _=0;_<E.length;_+=10){const T=E.slice(_,_+10),h=l(t(n,"tests"),s("build_ID","in",T));R.push(m(h))}x=(await Promise.all(R)).flatMap(_=>_.docs.map(T=>{const h=T.data();return{id:T.id,title:h.title||"",description:h.description||"",results:h.results||"",conclusions:h.conclusions||"",build_ID:h.build_ID||"",design_ID:h.design_ID||"",dateCreated:h.dateCreated,userId:h.userId||"",images:h.images||[],files:h.files||[]}}))}y({designs:a,builds:S,tests:x,isLoading:!1}),g().buildGraph()}catch(t){console.error("Error fetching lab notebook data:",t);const l=t instanceof Error?t.message:String(t),s=l.includes("permission")||l.includes("insufficient")||l.includes("PERMISSION_DENIED");y({error:s?"Database permissions not configured. Please contact your administrator or deploy Firebase security rules. See docs/FIREBASE_RULES_SETUP.md for instructions.":t instanceof Error?t.message:"Failed to fetch data",isLoading:!1})}},setDesigns:p=>{y({designs:p}),g().buildGraph()},addDesign:p=>{y(i=>({designs:[...i.designs,p]})),g().buildGraph()},updateDesignLocal:(p,i)=>{y(e=>({designs:e.designs.map(t=>t.id===p?{...t,...i}:t)})),g().buildGraph()},removeDesign:p=>{y(i=>({designs:i.designs.filter(e=>e.id!==p),builds:i.builds.filter(e=>e.design_ID!==p),tests:i.tests.filter(e=>e.design_ID!==p)})),g().buildGraph()},setBuilds:p=>{y({builds:p}),g().buildGraph()},addBuild:p=>{y(i=>({builds:[...i.builds,p]})),g().buildGraph()},updateBuildLocal:(p,i)=>{y(e=>({builds:e.builds.map(t=>t.id===p?{...t,...i}:t)})),g().buildGraph()},removeBuild:p=>{y(i=>({builds:i.builds.filter(e=>e.id!==p),tests:i.tests.filter(e=>e.build_ID!==p)})),g().buildGraph()},setTests:p=>{y({tests:p}),g().buildGraph()},addTest:p=>{y(i=>({tests:[...i.tests,p]})),g().buildGraph()},updateTestLocal:(p,i)=>{y(e=>({tests:e.tests.map(t=>t.id===p?{...t,...i}:t)})),g().buildGraph()},removeTest:p=>{y(i=>({tests:i.tests.filter(e=>e.id!==p)})),g().buildGraph()},buildGraph:()=>{const p=g(),{designs:i,builds:e,tests:t,filters:l}=p;let s=i,m=e,v=t;if(l.courseId){s=s.filter(b=>b.course===l.courseId);const r=s.map(b=>b.id);m=m.filter(b=>r.includes(b.design_ID));const a=m.map(b=>b.id);v=v.filter(b=>a.includes(b.build_ID))}if(l.searchQuery){const r=l.searchQuery.toLowerCase();s=s.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r)),m=m.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r)),v=v.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r))}l.nodeTypes.designs||(s=[]),l.nodeTypes.builds||(m=[]),l.nodeTypes.tests||(v=[]);const n=[],o=[];s.forEach((r,a)=>{const b=m.filter(E=>E.design_ID===r.id).length,S=v.filter(E=>E.design_ID===r.id).length;n.push({id:`design-${r.id}`,type:"designNode",position:{x:0,y:a*200},data:{type:"design",designId:r.id,label:r.title,title:r.title,description:r.description,dateCreated:Oe(r.dateCreated),dateModified:Oe(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],course:r.course,buildCount:b,testCount:S}})}),m.forEach((r,a)=>{const b=v.filter(S=>S.build_ID===r.id).length;n.push({id:`build-${r.id}`,type:"buildNode",position:{x:400,y:a*180},data:{type:"build",buildId:r.id,designId:r.design_ID,label:r.title,title:r.title,description:r.description,dateCreated:Oe(r.dateCreated),dateModified:Oe(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],testCount:b}}),o.push({id:`edge-design-${r.design_ID}-build-${r.id}`,source:`design-${r.design_ID}`,target:`build-${r.id}`,type:"smoothstep",animated:!1})}),v.forEach((r,a)=>{n.push({id:`test-${r.id}`,type:"testNode",position:{x:800,y:a*180},data:{type:"test",testId:r.id,buildId:r.build_ID,designId:r.design_ID,label:r.title,title:r.title,description:r.description,results:r.results,conclusions:r.conclusions,dateCreated:Oe(r.dateCreated),dateModified:Oe(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[]}}),o.push({id:`edge-build-${r.build_ID}-test-${r.id}`,source:`build-${r.build_ID}`,target:`test-${r.id}`,type:"smoothstep",animated:!1})}),y({nodes:n,edges:o})},selectNode:p=>{y({selectedNodeId:p}),p&&y({activePanel:"detail"})},setHoveredNode:p=>{y({hoveredNodeId:p})},updateNodePosition:(p,i)=>{y(e=>({nodes:e.nodes.map(t=>t.id===p?{...t,position:i}:t)}))},resetGraph:()=>{y({nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null})},setLoading:p=>y({isLoading:p}),setError:p=>y({error:p}),setActivePanel:p=>y({activePanel:p}),setLayoutType:p=>y({layoutType:p}),setViewMode:p=>y({viewMode:p}),setIsExpanded:p=>y({isExpanded:p}),openDeleteDialog:(p,i,e)=>y({deleteDialog:{open:!0,nodeId:p,nodeType:i,nodeName:e}}),closeDeleteDialog:()=>y({deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null}}),confirmDelete:async()=>{const p=g(),{nodeId:i,nodeType:e}=p.deleteDialog;if(!(!i||!e))try{const{labNotebookService:t}=await at(async()=>{const{labNotebookService:m}=await Promise.resolve().then(()=>Er);return{labNotebookService:m}},void 0),l=p.nodes.find(m=>m.id.includes(i));if(!l)return;const s=l.data.userId;e==="build"?(await t.deleteBuild(i,s),g().removeBuild(i)):e==="test"&&(await t.deleteTest(i,s),g().removeTest(i)),g().closeDeleteDialog(),g().selectNode(null),g().setActivePanel(null),await g().fetchAllData(s,!1,[])}catch(t){console.error("Error deleting:",t),y({error:t instanceof Error?t.message:"Failed to delete"})}},setSelectedCourse:p=>{y(i=>({filters:{...i.filters,courseId:p}})),g().buildGraph()},setSearchQuery:p=>{y(i=>({filters:{...i.filters,searchQuery:p}})),g().buildGraph()},setDateRange:(p,i)=>{y(e=>({filters:{...e.filters,dateRange:{start:p,end:i}}})),g().buildGraph()},toggleNodeTypeFilter:p=>{y(i=>({filters:{...i.filters,nodeTypes:{...i.filters.nodeTypes,[p]:!i.filters.nodeTypes[p]}}})),g().buildGraph()},resetFilters:()=>{y({filters:ft}),g().buildGraph()},setViewport:p=>y({viewport:p}),resetViewport:()=>y({viewport:ut}),getGraphMetrics:()=>{const p=g();return{designCount:p.designs.length,buildCount:p.builds.length,testCount:p.tests.length,totalNodes:p.nodes.length,totalEdges:p.edges.length}},getNodeById:p=>g().nodes.find(i=>i.id===p),getDesignById:p=>g().designs.find(i=>i.id===p),getBuildById:p=>g().builds.find(i=>i.id===p),getTestById:p=>g().tests.find(i=>i.id===p),getBuildsByDesignId:p=>g().builds.filter(i=>i.design_ID===p),getTestsByBuildId:p=>g().tests.filter(i=>i.build_ID===p),reset:()=>{y({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,filters:ft,viewport:ut})}}),{name:"lab-notebook-storage",partialize:y=>({layoutType:y.layoutType,viewMode:y.viewMode,viewport:y.viewport})}),{name:"LabNotebookStore"}));class Fr{constructor(){wt(this,"db",null)}initialize(){this.db||(this.db=sr())}async createDesign(g){this.initialize();const p={title:g.title,description:g.description,course:g.course,userId:g.userId,dateCreated:Se(),dateModified:Se(),images:g.images||[],files:g.files||[]},i=await lt(Ee(this.db,"designs"),p);return console.log("Design created with ID:",i.id),i.id}async updateDesign(g){this.initialize();const p={dateModified:Se()};g.title!==void 0&&(p.title=g.title),g.description!==void 0&&(p.description=g.description),g.course!==void 0&&(p.course=g.course),g.images!==void 0&&(p.images=g.images),g.files!==void 0&&(p.files=g.files);const i=xe(this.db,"designs",g.id);await dt(i,p),console.log("Design updated:",g.id)}async deleteDesign(g,p){this.initialize();const i=Ge(Ee(this.db,"builds"),ke("design_ID","==",g),ke("userId","==",p)),e=await Qe(i);for(const t of e.docs){const l=t.id,s=Ge(Ee(this.db,"tests"),ke("build_ID","==",l),ke("userId","==",p)),m=await Qe(s);for(const v of m.docs)await Pe(xe(this.db,"tests",v.id)),console.log("Test deleted:",v.id);await Pe(xe(this.db,"builds",l)),console.log("Build deleted:",l)}await Pe(xe(this.db,"designs",g)),console.log("Design deleted:",g)}async getDesign(g){this.initialize();const p=xe(this.db,"designs",g),i=await ct(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",course:e.course||"",dateCreated:e.dateCreated,dateModified:e.dateModified,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async createBuild(g){this.initialize();const p={title:g.title,description:g.description,design_ID:g.designId,userId:g.userId,dateCreated:Se(),dateModified:Se(),images:g.images||[],files:g.files||[]},i=await lt(Ee(this.db,"builds"),p);return console.log("Build created with ID:",i.id),i.id}async updateBuild(g){this.initialize();const p={dateModified:Se()};g.title!==void 0&&(p.title=g.title),g.description!==void 0&&(p.description=g.description),g.images!==void 0&&(p.images=g.images),g.files!==void 0&&(p.files=g.files);const i=xe(this.db,"builds",g.id);await dt(i,p),console.log("Build updated:",g.id)}async deleteBuild(g,p){this.initialize();const i=Ge(Ee(this.db,"tests"),ke("build_ID","==",g),ke("userId","==",p)),e=await Qe(i);for(const t of e.docs)await Pe(xe(this.db,"tests",t.id)),console.log("Test deleted:",t.id);await Pe(xe(this.db,"builds",g)),console.log("Build deleted:",g)}async getBuild(g){this.initialize();const p=xe(this.db,"builds",g),i=await ct(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",design_ID:e.design_ID||"",dateCreated:e.dateCreated,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async getBuildsByDesign(g){this.initialize();const p=Ge(Ee(this.db,"builds"),ke("design_ID","==",g),At("dateCreated","desc"));return(await Qe(p)).docs.map(e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}})}async createTest(g){this.initialize();const p={title:g.title,description:g.description,results:g.results,conclusions:g.conclusions,build_ID:g.buildId,design_ID:g.designId,userId:g.userId,dateCreated:Se(),dateModified:Se(),images:g.images||[],files:g.files||[]},i=await lt(Ee(this.db,"tests"),p);return console.log("Test created with ID:",i.id),i.id}async updateTest(g){this.initialize();const p={dateModified:Se()};g.title!==void 0&&(p.title=g.title),g.description!==void 0&&(p.description=g.description),g.results!==void 0&&(p.results=g.results),g.conclusions!==void 0&&(p.conclusions=g.conclusions),g.images!==void 0&&(p.images=g.images),g.files!==void 0&&(p.files=g.files);const i=xe(this.db,"tests",g.id);await dt(i,p),console.log("Test updated:",g.id)}async deleteTest(g,p){this.initialize(),await Pe(xe(this.db,"tests",g)),console.log("Test deleted:",g)}async getTest(g){this.initialize();const p=xe(this.db,"tests",g),i=await ct(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",results:e.results||"",conclusions:e.conclusions||"",build_ID:e.build_ID||"",design_ID:e.design_ID||"",dateCreated:e.dateCreated,dateModified:e.dateModified,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async getTestsByBuild(g){this.initialize();const p=Ge(Ee(this.db,"tests"),ke("build_ID","==",g),At("dateCreated","desc"));return(await Qe(p)).docs.map(e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",results:t.results||"",conclusions:t.conclusions||"",build_ID:t.build_ID||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}})}}let ht=null;const Pt=()=>(ht||(ht=new Fr),ht),Ur=Pt(),Er=Object.freeze(Object.defineProperty({__proto__:null,getLabNotebookService:Pt,labNotebookService:Ur},Symbol.toStringTag,{value:"Module"})),Qr=({open:y,title:g,message:p,confirmLabel:i="Confirm",cancelLabel:e="Cancel",onConfirm:t,onCancel:l,isDestructive:s=!1})=>B.jsxs(jt,{open:y,onClose:l,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:re.xl}},children:[B.jsx(ar,{children:B.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:$[2]},children:[s&&B.jsx(lr,{sx:{color:W.error,fontSize:28}}),B.jsx(ae,{variant:"h5",sx:{fontFamily:Q.fontFamily.display,fontWeight:Q.fontWeight.bold,color:W.text.primary},children:g})]})}),B.jsx(Tt,{children:B.jsx(ae,{variant:"body1",sx:{color:W.text.secondary,lineHeight:Q.lineHeight.relaxed},children:p})}),B.jsxs(dr,{sx:{p:$[3],gap:$[2]},children:[B.jsx(Ye,{onClick:l,variant:"outlined",sx:{borderRadius:re.md,textTransform:"none",fontWeight:Q.fontWeight.medium},children:e}),B.jsx(Ye,{onClick:t,variant:"contained",sx:{borderRadius:re.md,textTransform:"none",fontWeight:Q.fontWeight.medium,backgroundColor:s?W.error:W.primary[500],"&:hover":{backgroundColor:s?"#C62828":W.primary[600]}},children:i})]})]}),qr=({content:y,maxLines:g})=>{const p=Ve.sanitize(y||"");return B.jsx(oe,{sx:{"& p":{margin:0,marginBottom:$[2],color:W.text.primary,fontSize:Q.fontSize.base,fontFamily:Q.fontFamily.secondary,lineHeight:1.6},"& p:last-child":{marginBottom:0},"& h1, & h2, & h3":{fontFamily:Q.fontFamily.display,fontWeight:Q.fontWeight.bold,color:W.text.primary,marginTop:$[3],marginBottom:$[2]},"& h1":{fontSize:Q.fontSize["2xl"]},"& h2":{fontSize:Q.fontSize.xl},"& h3":{fontSize:Q.fontSize.lg},"& strong":{fontWeight:Q.fontWeight.semibold},"& em":{fontStyle:"italic"},"& u":{textDecoration:"underline"},"& s":{textDecoration:"line-through"},"& a":{color:W.primary[500],textDecoration:"none","&:hover":{textDecoration:"underline"}},"& ul, & ol":{paddingLeft:$[6],marginBottom:$[2],fontFamily:Q.fontFamily.secondary},"& li":{marginBottom:$[1],fontFamily:Q.fontFamily.secondary},"& blockquote":{borderLeft:`4px solid ${W.primary[500]}`,paddingLeft:$[4],marginLeft:0,marginBottom:$[2],fontStyle:"italic",color:W.text.secondary,fontFamily:Q.fontFamily.secondary},"& code":{backgroundColor:W.background.secondary,padding:`${$[.5]} ${$[1.5]}`,borderRadius:"4px",fontSize:Q.fontSize.sm,fontFamily:"monospace"},"& pre":{backgroundColor:W.background.secondary,padding:$[3],borderRadius:"8px",overflow:"auto",marginBottom:$[2],"& code":{backgroundColor:"transparent",padding:0}},...g&&{display:"-webkit-box",WebkitLineClamp:g,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"}},dangerouslySetInnerHTML:{__html:p}})},Vr=({value:y,onChange:g,placeholder:p="Start writing...",minHeight:i=200,disabled:e=!1})=>{const[t,l]=le.useState(Ve.sanitize(y||"")),[s,m]=le.useState(null),[v,n]=le.useState(null),o=le.useRef(null),r=le.useRef(!1);le.useEffect(()=>{if(r.current){const h=Ve.sanitize(y||"");h!==t&&l(h)}else r.current=!0},[y]);const a=h=>{const U=Ve.sanitize(h);l(U),g(U)},b=h=>{if(!o.current){console.warn("Editor not initialized");return}const U=o.current.getEditor(),c=U.getSelection();if(c)U.insertText(c.index,h),U.setSelection(c.index+h.length);else{const f=U.getText().length;U.insertText(f,h),U.setSelection(f+h.length)}m(null),n(null),U.focus()},S=h=>{m(h.currentTarget),n(null)},E=h=>{n(h.currentTarget),m(null)},x=()=>{m(null),n(null)},R=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],F=["+","−","×","÷","±","=","≈","≠","≤","≥","<",">","°","∞","√","∑","∫","π","Δ","∂","∇","∈","∉","⊂","⊃","∩","∪","∅"],_={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],["blockquote","code-block"],["link"],["clean"]]},T=["header","bold","italic","underline","strike","list","script","indent","blockquote","code-block","link"];return B.jsxs(oe,{children:[B.jsxs(oe,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:$[1],mb:$[2]},children:[B.jsx(ae,{variant:"body2",sx:{color:W.text.secondary,fontSize:Q.fontSize.sm,fontWeight:Q.fontWeight.medium,mr:$[1]},children:"Insert:"}),B.jsx(Je,{title:"Math Symbols",placement:"top",children:B.jsx(Ne,{onClick:S,disabled:e,size:"small",sx:{border:`1px solid ${W.neutral[300]}`,borderRadius:re.md,backgroundColor:s?W.primary[50]:W.background.primary,"&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400]}},children:B.jsx(cr,{sx:{fontSize:18,color:W.primary[600]}})})}),B.jsx(Je,{title:"Greek Letters",placement:"top",children:B.jsx(Ne,{onClick:E,disabled:e,size:"small",sx:{border:`1px solid ${W.neutral[300]}`,borderRadius:re.md,backgroundColor:v?W.primary[50]:W.background.primary,fontWeight:Q.fontWeight.bold,fontSize:Q.fontSize.lg,color:W.primary[600],"&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400]}},children:"Ω"})})]}),B.jsx(Ct,{open:!!s,anchorEl:s,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:re.lg,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",mt:$[1]}},children:B.jsxs(oe,{sx:{p:$[2],maxWidth:320},children:[B.jsx(ae,{variant:"subtitle2",sx:{fontWeight:Q.fontWeight.semibold,color:W.text.primary,mb:$[2]},children:"Math Symbols"}),B.jsx(oe,{sx:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",gap:$[1]},children:F.map(h=>B.jsx(_t,{onClick:()=>b(h),sx:{width:32,height:32,borderRadius:re.md,border:`1px solid ${W.neutral[200]}`,backgroundColor:W.background.primary,fontSize:Q.fontSize.lg,fontWeight:Q.fontWeight.medium,color:W.text.primary,transition:"all 0.2s","&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400],transform:"scale(1.1)"}},children:h},h))})]})}),B.jsx(Ct,{open:!!v,anchorEl:v,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:re.lg,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",mt:$[1]}},children:B.jsxs(oe,{sx:{p:$[2],maxWidth:360},children:[B.jsx(ae,{variant:"subtitle2",sx:{fontWeight:Q.fontWeight.semibold,color:W.text.primary,mb:$[2]},children:"Greek Letters"}),B.jsx(oe,{sx:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:$[1]},children:R.map(h=>B.jsx(_t,{onClick:()=>b(h),sx:{width:28,height:28,borderRadius:re.md,border:`1px solid ${W.neutral[200]}`,backgroundColor:W.background.primary,fontSize:Q.fontSize.base,fontWeight:Q.fontWeight.medium,color:W.text.primary,transition:"all 0.2s","&:hover":{backgroundColor:W.primary[50],borderColor:W.primary[400],transform:"scale(1.15)"}},children:h},h))})]})}),B.jsx(oe,{sx:{"& .quill":{borderRadius:re.lg,border:`1px solid ${W.neutral[300]}`,backgroundColor:W.background.primary},"& .ql-toolbar":{borderTopLeftRadius:re.lg,borderTopRightRadius:re.lg,borderBottom:`1px solid ${W.neutral[200]}`,backgroundColor:W.background.secondary},"& .ql-container":{borderBottomLeftRadius:re.lg,borderBottomRightRadius:re.lg,minHeight:`${i}px`,fontSize:Q.fontSize.base,fontFamily:Q.fontFamily.body},"& .ql-editor":{minHeight:`${i}px`,color:W.text.primary},"& .ql-editor.ql-blank::before":{color:W.text.tertiary,fontStyle:"normal"}},children:B.jsx(ir,{ref:o,value:t,onChange:a,modules:_,formats:T,theme:"snow",placeholder:p,readOnly:e})})]})};function kr(y,g){return g.forEach(function(p){p&&typeof p!="string"&&!Array.isArray(p)&&Object.keys(p).forEach(function(i){if(i!=="default"&&!(i in y)){var e=Object.getOwnPropertyDescriptor(p,i);Object.defineProperty(y,i,e.get?e:{enumerable:!0,get:function(){return p[i]}})}})}),Object.freeze(y)}function Ot(y,g){return new Promise(function(p,i){let e;return Rr(y).then(function(t){try{return e=t,p(new Blob([g.slice(0,2),e,g.slice(2)],{type:"image/jpeg"}))}catch(l){return i(l)}},i)})}const Rr=y=>new Promise((g,p)=>{const i=new FileReader;i.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let l=0;if(t.getUint16(l)!==65496)return p("not a valid JPEG");for(l+=2;;){const s=t.getUint16(l);if(s===65498)break;const m=t.getUint16(l+2);if(s===65505&&t.getUint32(l+4)===1165519206){const v=l+10;let n;switch(t.getUint16(v)){case 18761:n=!0;break;case 19789:n=!1;break;default:return p("TIFF header contains invalid endian")}if(t.getUint16(v+2,n)!==42)return p("TIFF header contains invalid version");const o=t.getUint32(v+4,n),r=v+o+2+12*t.getUint16(v+o,n);for(let a=v+o+2;a<r;a+=12)if(t.getUint16(a,n)==274){if(t.getUint16(a+2,n)!==3)return p("Orientation data type is invalid");if(t.getUint32(a+4,n)!==1)return p("Orientation data count is invalid");t.setUint16(a+8,1,n);break}return g(e.slice(l,l+2+m))}l+=2+m}return g(new Blob)}),i.readAsArrayBuffer(y)});var et={},jr={get exports(){return et},set exports(y){et=y}};(function(y){var g,p,i={};jr.exports=i,i.parse=function(e,t){for(var l=i.bin.readUshort,s=i.bin.readUint,m=0,v={},n=new Uint8Array(e),o=n.length-4;s(n,o)!=101010256;)o--;m=o,m+=4;var r=l(n,m+=4);l(n,m+=2);var a=s(n,m+=2),b=s(n,m+=4);m+=4,m=b;for(var S=0;S<r;S++){s(n,m),m+=4,m+=4,m+=4,s(n,m+=4),a=s(n,m+=4);var E=s(n,m+=4),x=l(n,m+=4),R=l(n,m+2),F=l(n,m+4);m+=6;var _=s(n,m+=8);m+=4,m+=x+R+F,i._readLocal(n,_,v,a,E,t)}return v},i._readLocal=function(e,t,l,s,m,v){var n=i.bin.readUshort,o=i.bin.readUint;o(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);o(e,t+=2),o(e,t+=4),t+=4;var a=n(e,t+=8),b=n(e,t+=2);t+=2;var S=i.bin.readUTF8(e,t,a);if(t+=a,t+=b,v)l[S]={size:m,csize:s};else{var E=new Uint8Array(e.buffer,t);if(r==0)l[S]=new Uint8Array(E.buffer.slice(t,t+s));else{if(r!=8)throw"unknown compression method: "+r;var x=new Uint8Array(m);i.inflateRaw(E,x),l[S]=x}}},i.inflateRaw=function(e,t){return i.F.inflate(e,t)},i.inflate=function(e,t){return e[0],e[1],i.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},i.deflate=function(e,t){t==null&&(t={level:6});var l=0,s=new Uint8Array(50+Math.floor(1.1*e.length));s[l]=120,s[l+1]=156,l+=2,l=i.F.deflateRaw(e,s,l,t.level);var m=i.adler(e,0,e.length);return s[l+0]=m>>>24&255,s[l+1]=m>>>16&255,s[l+2]=m>>>8&255,s[l+3]=m>>>0&255,new Uint8Array(s.buffer,0,l+4)},i.deflateRaw=function(e,t){t==null&&(t={level:6});var l=new Uint8Array(50+Math.floor(1.1*e.length)),s=i.F.deflateRaw(e,l,s,t.level);return new Uint8Array(l.buffer,0,s)},i.encode=function(e,t){t==null&&(t=!1);var l=0,s=i.bin.writeUint,m=i.bin.writeUshort,v={};for(var n in e){var o=!i._noNeed(n)&&!t,r=e[n],a=i.crc.crc(r,0,r.length);v[n]={cpr:o,usize:r.length,crc:a,file:o?i.deflateRaw(r):r}}for(var n in v)l+=v[n].file.length+30+46+2*i.bin.sizeUTF8(n);l+=22;var b=new Uint8Array(l),S=0,E=[];for(var n in v){var x=v[n];E.push(S),S=i._writeHeader(b,S,n,x,0)}var R=0,F=S;for(var n in v)x=v[n],E.push(S),S=i._writeHeader(b,S,n,x,1,E[R++]);var _=S-F;return s(b,S,101010256),S+=4,m(b,S+=4,R),m(b,S+=2,R),s(b,S+=2,_),s(b,S+=4,F),S+=4,S+=2,b.buffer},i._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},i._writeHeader=function(e,t,l,s,m,v){var n=i.bin.writeUint,o=i.bin.writeUshort,r=s.file;return n(e,t,m==0?67324752:33639248),t+=4,m==1&&(t+=2),o(e,t,20),o(e,t+=2,0),o(e,t+=2,s.cpr?8:0),n(e,t+=2,0),n(e,t+=4,s.crc),n(e,t+=4,r.length),n(e,t+=4,s.usize),o(e,t+=4,i.bin.sizeUTF8(l)),o(e,t+=2,0),t+=2,m==1&&(t+=2,t+=2,n(e,t+=6,v),t+=4),t+=i.bin.writeUTF8(e,t,l),m==0&&(e.set(r,t),t+=r.length),t},i.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var l=t,s=0;s<8;s++)1&l?l=3988292384^l>>>1:l>>>=1;e[t]=l}return e}(),update:function(e,t,l,s){for(var m=0;m<s;m++)e=i.crc.table[255&(e^t[l+m])]^e>>>8;return e},crc:function(e,t,l){return 4294967295^i.crc.update(4294967295,e,t,l)}},i.adler=function(e,t,l){for(var s=1,m=0,v=t,n=t+l;v<n;){for(var o=Math.min(v+5552,n);v<o;)m+=s+=e[v++];s%=65521,m%=65521}return m<<16|s},i.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255,e[t+2]=l>>16&255,e[t+3]=l>>24&255},readASCII:function(e,t,l){for(var s="",m=0;m<l;m++)s+=String.fromCharCode(e[t+m]);return s},writeASCII:function(e,t,l){for(var s=0;s<l.length;s++)e[t+s]=l.charCodeAt(s)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,l){for(var s,m="",v=0;v<l;v++)m+="%"+i.bin.pad(e[t+v].toString(16));try{s=decodeURIComponent(m)}catch{return i.bin.readASCII(e,t,l)}return s},writeUTF8:function(e,t,l){for(var s=l.length,m=0,v=0;v<s;v++){var n=l.charCodeAt(v);if((4294967168&n)==0)e[t+m]=n,m++;else if((4294965248&n)==0)e[t+m]=192|n>>6,e[t+m+1]=128|n>>0&63,m+=2;else if((4294901760&n)==0)e[t+m]=224|n>>12,e[t+m+1]=128|n>>6&63,e[t+m+2]=128|n>>0&63,m+=3;else{if((4292870144&n)!=0)throw"e";e[t+m]=240|n>>18,e[t+m+1]=128|n>>12&63,e[t+m+2]=128|n>>6&63,e[t+m+3]=128|n>>0&63,m+=4}}return m},sizeUTF8:function(e){for(var t=e.length,l=0,s=0;s<t;s++){var m=e.charCodeAt(s);if((4294967168&m)==0)l++;else if((4294965248&m)==0)l+=2;else if((4294901760&m)==0)l+=3;else{if((4292870144&m)!=0)throw"e";l+=4}}return l}},i.F={},i.F.deflateRaw=function(e,t,l,s){var m=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][s],v=i.F.U,n=i.F._goodIndex;i.F._hash;var o=i.F._putsE,r=0,a=l<<3,b=0,S=e.length;if(s==0){for(;r<S;)o(t,a,r+(C=Math.min(65535,S-r))==S?1:0),a=i.F._copyExact(e,r,C,t,a+8),r+=C;return a>>>3}var E=v.lits,x=v.strt,R=v.prev,F=0,_=0,T=0,h=0,U=0,c=0;for(S>2&&(x[c=i.F._hash(e,0)]=0),r=0;r<S;r++){if(U=c,r+1<S-2){c=i.F._hash(e,r+1);var f=r+1&32767;R[f]=x[c],x[c]=f}if(b<=r){(F>14e3||_>26697)&&S-r>100&&(b<r&&(E[F]=r-b,F+=2,b=r),a=i.F._writeBlock(r==S-1||b==S?1:0,E,F,h,e,T,r-T,t,a),F=_=h=0,T=r);var I=0;r<S-2&&(I=i.F._bestMatch(e,r,R,U,Math.min(m[2],S-r),m[3]));var C=I>>>16,A=65535&I;if(I!=0){A=65535&I;var D=n(C=I>>>16,v.of0);v.lhst[257+D]++;var w=n(A,v.df0);v.dhst[w]++,h+=v.exb[D]+v.dxb[w],E[F]=C<<23|r-b,E[F+1]=A<<16|D<<8|w,F+=2,b=r+C}else v.lhst[e[r]]++;_++}}for(T==r&&e.length!=0||(b<r&&(E[F]=r-b,F+=2,b=r),a=i.F._writeBlock(1,E,F,h,e,T,r-T,t,a),F=0,_=0,F=_=h=0,T=r);(7&a)!=0;)a++;return a>>>3},i.F._bestMatch=function(e,t,l,s,m,v){var n=32767&t,o=l[n],r=n-o+32768&32767;if(o==n||s!=i.F._hash(e,t-r))return 0;for(var a=0,b=0,S=Math.min(32767,t);r<=S&&--v!=0&&o!=n;){if(a==0||e[t+a]==e[t+a-r]){var E=i.F._howLong(e,t,r);if(E>a){if(b=r,(a=E)>=m)break;r+2<E&&(E=r+2);for(var x=0,R=0;R<E-2;R++){var F=t-r+R+32768&32767,_=F-l[F]+32768&32767;_>x&&(x=_,o=F)}}}r+=(n=o)-(o=l[n])+32768&32767}return a<<16|b},i.F._howLong=function(e,t,l){if(e[t]!=e[t-l]||e[t+1]!=e[t+1-l]||e[t+2]!=e[t+2-l])return 0;var s=t,m=Math.min(e.length,t+258);for(t+=3;t<m&&e[t]==e[t-l];)t++;return t-s},i.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},i.saved=0,i.F._writeBlock=function(e,t,l,s,m,v,n,o,r){var a,b,S,E,x,R,F,_,T,h=i.F.U,U=i.F._putsF,c=i.F._putsE;h.lhst[256]++,b=(a=i.F.getTrees())[0],S=a[1],E=a[2],x=a[3],R=a[4],F=a[5],_=a[6],T=a[7];var f=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),I=s+i.F.contSize(h.fltree,h.lhst)+i.F.contSize(h.fdtree,h.dhst),C=s+i.F.contSize(h.ltree,h.lhst)+i.F.contSize(h.dtree,h.dhst);C+=14+3*F+i.F.contSize(h.itree,h.ihst)+(2*h.ihst[16]+3*h.ihst[17]+7*h.ihst[18]);for(var A=0;A<286;A++)h.lhst[A]=0;for(A=0;A<30;A++)h.dhst[A]=0;for(A=0;A<19;A++)h.ihst[A]=0;var D=f<I&&f<C?0:I<C?1:2;if(U(o,r,e),U(o,r+1,D),r+=3,D==0){for(;(7&r)!=0;)r++;r=i.F._copyExact(m,v,n,o,r)}else{var w,k;if(D==1&&(w=h.fltree,k=h.fdtree),D==2){i.F.makeCodes(h.ltree,b),i.F.revCodes(h.ltree,b),i.F.makeCodes(h.dtree,S),i.F.revCodes(h.dtree,S),i.F.makeCodes(h.itree,E),i.F.revCodes(h.itree,E),w=h.ltree,k=h.dtree,c(o,r,x-257),c(o,r+=5,R-1),c(o,r+=5,F-4),r+=4;for(var u=0;u<F;u++)c(o,r+3*u,h.itree[1+(h.ordr[u]<<1)]);r+=3*F,r=i.F._codeTiny(_,h.itree,o,r),r=i.F._codeTiny(T,h.itree,o,r)}for(var d=v,z=0;z<l;z+=2){for(var j=t[z],L=j>>>23,H=d+(8388607&j);d<H;)r=i.F._writeLit(m[d++],w,o,r);if(L!=0){var O=t[z+1],N=O>>16,P=O>>8&255,M=255&O;c(o,r=i.F._writeLit(257+P,w,o,r),L-h.of0[P]),r+=h.exb[P],U(o,r=i.F._writeLit(M,k,o,r),N-h.df0[M]),r+=h.dxb[M],d+=L}}r=i.F._writeLit(256,w,o,r)}return r},i.F._copyExact=function(e,t,l,s,m){var v=m>>>3;return s[v]=l,s[v+1]=l>>>8,s[v+2]=255-s[v],s[v+3]=255-s[v+1],v+=4,s.set(new Uint8Array(e.buffer,t,l),v),m+(l+4<<3)},i.F.getTrees=function(){for(var e=i.F.U,t=i.F._hufTree(e.lhst,e.ltree,15),l=i.F._hufTree(e.dhst,e.dtree,15),s=[],m=i.F._lenCodes(e.ltree,s),v=[],n=i.F._lenCodes(e.dtree,v),o=0;o<s.length;o+=2)e.ihst[s[o]]++;for(o=0;o<v.length;o+=2)e.ihst[v[o]]++;for(var r=i.F._hufTree(e.ihst,e.itree,7),a=19;a>4&&e.itree[1+(e.ordr[a-1]<<1)]==0;)a--;return[t,l,r,m,n,a,s,v]},i.F.getSecond=function(e){for(var t=[],l=0;l<e.length;l+=2)t.push(e[l+1]);return t},i.F.nonZero=function(e){for(var t="",l=0;l<e.length;l+=2)e[l+1]!=0&&(t+=(l>>1)+",");return t},i.F.contSize=function(e,t){for(var l=0,s=0;s<t.length;s++)l+=t[s]*e[1+(s<<1)];return l},i.F._codeTiny=function(e,t,l,s){for(var m=0;m<e.length;m+=2){var v=e[m],n=e[m+1];s=i.F._writeLit(v,t,l,s);var o=v==16?2:v==17?3:7;v>15&&(i.F._putsE(l,s,n,o),s+=o)}return s},i.F._lenCodes=function(e,t){for(var l=e.length;l!=2&&e[l-1]==0;)l-=2;for(var s=0;s<l;s+=2){var m=e[s+1],v=s+3<l?e[s+3]:-1,n=s+5<l?e[s+5]:-1,o=s==0?-1:e[s-1];if(m==0&&v==m&&n==m){for(var r=s+5;r+2<l&&e[r+2]==m;)r+=2;(a=Math.min(r+1-s>>>1,138))<11?t.push(17,a-3):t.push(18,a-11),s+=2*a-2}else if(m==o&&v==m&&n==m){for(r=s+5;r+2<l&&e[r+2]==m;)r+=2;var a=Math.min(r+1-s>>>1,6);t.push(16,a-3),s+=2*a-2}else t.push(m,0)}return l>>>1},i.F._hufTree=function(e,t,l){var s=[],m=e.length,v=t.length,n=0;for(n=0;n<v;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<m;n++)e[n]!=0&&s.push({lit:n,f:e[n]});var o=s.length,r=s.slice(0);if(o==0)return 0;if(o==1){var a=s[0].lit;return r=a==0?1:0,t[1+(a<<1)]=1,t[1+(r<<1)]=1,1}s.sort(function(_,T){return _.f-T.f});var b=s[0],S=s[1],E=0,x=1,R=2;for(s[0]={lit:-1,f:b.f+S.f,l:b,r:S,d:0};x!=o-1;)b=E!=x&&(R==o||s[E].f<s[R].f)?s[E++]:s[R++],S=E!=x&&(R==o||s[E].f<s[R].f)?s[E++]:s[R++],s[x++]={lit:-1,f:b.f+S.f,l:b,r:S};var F=i.F.setDepth(s[x-1],0);for(F>l&&(i.F.restrictDepth(r,l,F),F=l),n=0;n<o;n++)t[1+(r[n].lit<<1)]=r[n].d;return F},i.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(i.F.setDepth(e.l,t+1),i.F.setDepth(e.r,t+1))},i.F.restrictDepth=function(e,t,l){var s=0,m=1<<l-t,v=0;for(e.sort(function(o,r){return r.d==o.d?o.f-r.f:r.d-o.d}),s=0;s<e.length&&e[s].d>t;s++){var n=e[s].d;e[s].d=t,v+=m-(1<<l-n)}for(v>>>=l-t;v>0;)(n=e[s].d)<t?(e[s].d++,v-=1<<t-n-1):s++;for(;s>=0;s--)e[s].d==t&&v<0&&(e[s].d--,v++);v!=0&&console.log("debt left")},i.F._goodIndex=function(e,t){var l=0;return t[16|l]<=e&&(l|=16),t[8|l]<=e&&(l|=8),t[4|l]<=e&&(l|=4),t[2|l]<=e&&(l|=2),t[1|l]<=e&&(l|=1),l},i.F._writeLit=function(e,t,l,s){return i.F._putsF(l,s,t[e<<1]),s+t[1+(e<<1)]},i.F.inflate=function(e,t){var l=Uint8Array;if(e[0]==3&&e[1]==0)return t||new l(0);var s=i.F,m=s._bitsF,v=s._bitsE,n=s._decodeTiny,o=s.makeCodes,r=s.codes2map,a=s._get17,b=s.U,S=t==null;S&&(t=new l(e.length>>>2<<3));for(var E,x,R=0,F=0,_=0,T=0,h=0,U=0,c=0,f=0,I=0;R==0;)if(R=m(e,I,1),F=m(e,I+1,2),I+=3,F!=0){if(S&&(t=i.F._check(t,f+(1<<17))),F==1&&(E=b.flmap,x=b.fdmap,U=511,c=31),F==2){_=v(e,I,5)+257,T=v(e,I+5,5)+1,h=v(e,I+10,4)+4,I+=14;for(var C=0;C<38;C+=2)b.itree[C]=0,b.itree[C+1]=0;var A=1;for(C=0;C<h;C++){var D=v(e,I+3*C,3);b.itree[1+(b.ordr[C]<<1)]=D,D>A&&(A=D)}I+=3*h,o(b.itree,A),r(b.itree,A,b.imap),E=b.lmap,x=b.dmap,I=n(b.imap,(1<<A)-1,_+T,e,I,b.ttree);var w=s._copyOut(b.ttree,0,_,b.ltree);U=(1<<w)-1;var k=s._copyOut(b.ttree,_,T,b.dtree);c=(1<<k)-1,o(b.ltree,w),r(b.ltree,w,E),o(b.dtree,k),r(b.dtree,k,x)}for(;;){var u=E[a(e,I)&U];I+=15&u;var d=u>>>4;if(!(d>>>8))t[f++]=d;else{if(d==256)break;var z=f+d-254;if(d>264){var j=b.ldef[d-257];z=f+(j>>>3)+v(e,I,7&j),I+=7&j}var L=x[a(e,I)&c];I+=15&L;var H=L>>>4,O=b.ddef[H],N=(O>>>4)+m(e,I,15&O);for(I+=15&O,S&&(t=i.F._check(t,f+(1<<17)));f<z;)t[f]=t[f++-N],t[f]=t[f++-N],t[f]=t[f++-N],t[f]=t[f++-N];f=z}}}else{(7&I)!=0&&(I+=8-(7&I));var P=4+(I>>>3),M=e[P-4]|e[P-3]<<8;S&&(t=i.F._check(t,f+M)),t.set(new l(e.buffer,e.byteOffset+P,M),f),I=P+M<<3,f+=M}return t.length==f?t:t.slice(0,f)},i.F._check=function(e,t){var l=e.length;if(t<=l)return e;var s=new Uint8Array(Math.max(l<<1,t));return s.set(e,0),s},i.F._decodeTiny=function(e,t,l,s,m,v){for(var n=i.F._bitsE,o=i.F._get17,r=0;r<l;){var a=e[o(s,m)&t];m+=15&a;var b=a>>>4;if(b<=15)v[r]=b,r++;else{var S=0,E=0;b==16?(E=3+n(s,m,2),m+=2,S=v[r-1]):b==17?(E=3+n(s,m,3),m+=3):b==18&&(E=11+n(s,m,7),m+=7);for(var x=r+E;r<x;)v[r]=S,r++}}return m},i.F._copyOut=function(e,t,l,s){for(var m=0,v=0,n=s.length>>>1;v<l;){var o=e[v+t];s[v<<1]=0,s[1+(v<<1)]=o,o>m&&(m=o),v++}for(;v<n;)s[v<<1]=0,s[1+(v<<1)]=0,v++;return m},i.F.makeCodes=function(e,t){for(var l,s,m,v,n=i.F.U,o=e.length,r=n.bl_count,a=0;a<=t;a++)r[a]=0;for(a=1;a<o;a+=2)r[e[a]]++;var b=n.next_code;for(l=0,r[0]=0,s=1;s<=t;s++)l=l+r[s-1]<<1,b[s]=l;for(m=0;m<o;m+=2)(v=e[m+1])!=0&&(e[m]=b[v],b[v]++)},i.F.codes2map=function(e,t,l){for(var s=e.length,m=i.F.U.rev15,v=0;v<s;v+=2)if(e[v+1]!=0)for(var n=v>>1,o=e[v+1],r=n<<4|o,a=t-o,b=e[v]<<a,S=b+(1<<a);b!=S;)l[m[b]>>>15-t]=r,b++},i.F.revCodes=function(e,t){for(var l=i.F.U.rev15,s=15-t,m=0;m<e.length;m+=2){var v=e[m]<<t-e[m+1];e[m]=l[v]>>>s}},i.F._putsE=function(e,t,l){l<<=7&t;var s=t>>>3;e[s]|=l,e[s+1]|=l>>>8},i.F._putsF=function(e,t,l){l<<=7&t;var s=t>>>3;e[s]|=l,e[s+1]|=l>>>8,e[s+2]|=l>>>16},i.F._bitsE=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<l)-1},i.F._bitsF=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<l)-1},i.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},i.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},i.F.U=(g=Uint16Array,p=Uint32Array,{next_code:new g(16),bl_count:new g(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new g(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new p(32),flmap:new g(512),fltree:[],fdmap:new g(32),fdtree:[],lmap:new g(32768),ltree:[],ttree:[],dmap:new g(32768),dtree:[],imap:new g(512),itree:[],rev15:new g(32768),lhst:new p(286),dhst:new p(30),ihst:new p(19),lits:new p(15e3),strt:new g(65536),prev:new g(32768)}),function(){for(var e=i.F.U,t=0;t<32768;t++){var l=t;l=(4278255360&(l=(4042322160&(l=(3435973836&(l=(2863311530&l)>>>1|(1431655765&l)<<1))>>>2|(858993459&l)<<2))>>>4|(252645135&l)<<4))>>>8|(16711935&l)<<8,e.rev15[t]=(l>>>16|l<<16)>>>17}function s(m,v,n){for(;v--!=0;)m.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];s(e.fltree,144,8),s(e.fltree,112,9),s(e.fltree,24,7),s(e.fltree,8,8),i.F.makeCodes(e.fltree,9),i.F.codes2map(e.fltree,9,e.flmap),i.F.revCodes(e.fltree,9),s(e.fdtree,32,5),i.F.makeCodes(e.fdtree,5),i.F.codes2map(e.fdtree,5,e.fdmap),i.F.revCodes(e.fdtree,5),s(e.itree,19,0),s(e.ltree,286,0),s(e.dtree,30,0),s(e.ttree,320,0)}()})();var Tr=kr({__proto__:null,default:et},[et]);const we=function(){var y={nextZero(n,o){for(;n[o]!=0;)o++;return o},readUshort:(n,o)=>n[o]<<8|n[o+1],writeUshort(n,o,r){n[o]=r>>8&255,n[o+1]=255&r},readUint:(n,o)=>16777216*n[o]+(n[o+1]<<16|n[o+2]<<8|n[o+3]),writeUint(n,o,r){n[o]=r>>24&255,n[o+1]=r>>16&255,n[o+2]=r>>8&255,n[o+3]=255&r},readASCII(n,o,r){let a="";for(let b=0;b<r;b++)a+=String.fromCharCode(n[o+b]);return a},writeASCII(n,o,r){for(let a=0;a<r.length;a++)n[o+a]=r.charCodeAt(a)},readBytes(n,o,r){const a=[];for(let b=0;b<r;b++)a.push(n[o+b]);return a},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,o,r){let a,b="";for(let S=0;S<r;S++)b+=`%${y.pad(n[o+S].toString(16))}`;try{a=decodeURIComponent(b)}catch{return y.readASCII(n,o,r)}return a}};function g(n,o,r,a){const b=o*r,S=t(a),E=Math.ceil(o*S/8),x=new Uint8Array(4*b),R=new Uint32Array(x.buffer),{ctype:F}=a,{depth:_}=a,T=y.readUshort;if(F==6){const j=b<<2;if(_==8)for(var h=0;h<j;h+=4)x[h]=n[h],x[h+1]=n[h+1],x[h+2]=n[h+2],x[h+3]=n[h+3];if(_==16)for(h=0;h<j;h++)x[h]=n[h<<1]}else if(F==2){const j=a.tabs.tRNS;if(j==null){if(_==8)for(h=0;h<b;h++){var U=3*h;R[h]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U]}if(_==16)for(h=0;h<b;h++)U=6*h,R[h]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U]}else{var c=j[0];const L=j[1],H=j[2];if(_==8)for(h=0;h<b;h++){var f=h<<2;U=3*h,R[h]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U],n[U]==c&&n[U+1]==L&&n[U+2]==H&&(x[f+3]=0)}if(_==16)for(h=0;h<b;h++)f=h<<2,U=6*h,R[h]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U],T(n,U)==c&&T(n,U+2)==L&&T(n,U+4)==H&&(x[f+3]=0)}}else if(F==3){const j=a.tabs.PLTE,L=a.tabs.tRNS,H=L?L.length:0;if(_==1)for(var I=0;I<r;I++){var C=I*E,A=I*o;for(h=0;h<o;h++){f=A+h<<2;var D=3*(w=n[C+(h>>3)]>>7-((7&h)<<0)&1);x[f]=j[D],x[f+1]=j[D+1],x[f+2]=j[D+2],x[f+3]=w<H?L[w]:255}}if(_==2)for(I=0;I<r;I++)for(C=I*E,A=I*o,h=0;h<o;h++)f=A+h<<2,D=3*(w=n[C+(h>>2)]>>6-((3&h)<<1)&3),x[f]=j[D],x[f+1]=j[D+1],x[f+2]=j[D+2],x[f+3]=w<H?L[w]:255;if(_==4)for(I=0;I<r;I++)for(C=I*E,A=I*o,h=0;h<o;h++)f=A+h<<2,D=3*(w=n[C+(h>>1)]>>4-((1&h)<<2)&15),x[f]=j[D],x[f+1]=j[D+1],x[f+2]=j[D+2],x[f+3]=w<H?L[w]:255;if(_==8)for(h=0;h<b;h++){var w;f=h<<2,D=3*(w=n[h]),x[f]=j[D],x[f+1]=j[D+1],x[f+2]=j[D+2],x[f+3]=w<H?L[w]:255}}else if(F==4){if(_==8)for(h=0;h<b;h++){f=h<<2;var k=n[u=h<<1];x[f]=k,x[f+1]=k,x[f+2]=k,x[f+3]=n[u+1]}if(_==16)for(h=0;h<b;h++){var u;f=h<<2,k=n[u=h<<2],x[f]=k,x[f+1]=k,x[f+2]=k,x[f+3]=n[u+2]}}else if(F==0)for(c=a.tabs.tRNS?a.tabs.tRNS:-1,I=0;I<r;I++){const j=I*E,L=I*o;if(_==1)for(var d=0;d<o;d++){var z=(k=255*(n[j+(d>>>3)]>>>7-(7&d)&1))==255*c?0:255;R[L+d]=z<<24|k<<16|k<<8|k}else if(_==2)for(d=0;d<o;d++)z=(k=85*(n[j+(d>>>2)]>>>6-((3&d)<<1)&3))==85*c?0:255,R[L+d]=z<<24|k<<16|k<<8|k;else if(_==4)for(d=0;d<o;d++)z=(k=17*(n[j+(d>>>1)]>>>4-((1&d)<<2)&15))==17*c?0:255,R[L+d]=z<<24|k<<16|k<<8|k;else if(_==8)for(d=0;d<o;d++)z=(k=n[j+d])==c?0:255,R[L+d]=z<<24|k<<16|k<<8|k;else if(_==16)for(d=0;d<o;d++)k=n[j+(d<<1)],z=T(n,j+(d<<1))==c?0:255,R[L+d]=z<<24|k<<16|k<<8|k}return x}function p(n,o,r,a){const b=t(n),S=Math.ceil(r*b/8),E=new Uint8Array((S+1+n.interlace)*a);return o=n.tabs.CgBI?e(o,E):i(o,E),n.interlace==0?o=l(o,n,0,r,a):n.interlace==1&&(o=function(R,F){const _=F.width,T=F.height,h=t(F),U=h>>3,c=Math.ceil(_*h/8),f=new Uint8Array(T*c);let I=0;const C=[0,0,4,0,2,0,1],A=[0,4,0,2,0,1,0],D=[8,8,8,4,4,2,2],w=[8,8,4,4,2,2,1];let k=0;for(;k<7;){const d=D[k],z=w[k];let j=0,L=0,H=C[k];for(;H<T;)H+=d,L++;let O=A[k];for(;O<_;)O+=z,j++;const N=Math.ceil(j*h/8);l(R,F,I,j,L);let P=0,M=C[k];for(;M<T;){let G=A[k],Y=I+P*N<<3;for(;G<_;){var u;if(h==1&&(u=(u=R[Y>>3])>>7-(7&Y)&1,f[M*c+(G>>3)]|=u<<7-((7&G)<<0)),h==2&&(u=(u=R[Y>>3])>>6-(7&Y)&3,f[M*c+(G>>2)]|=u<<6-((3&G)<<1)),h==4&&(u=(u=R[Y>>3])>>4-(7&Y)&15,f[M*c+(G>>1)]|=u<<4-((1&G)<<2)),h>=8){const V=M*c+G*U;for(let q=0;q<U;q++)f[V+q]=R[(Y>>3)+q]}Y+=h,G+=z}P++,M+=d}j*L!=0&&(I+=L*(1+N)),k+=1}return f}(o,n)),o}function i(n,o){return e(new Uint8Array(n.buffer,2,n.length-6),o)}var e=function(){const n={H:{}};return n.H.N=function(o,r){const a=Uint8Array;let b,S,E=0,x=0,R=0,F=0,_=0,T=0,h=0,U=0,c=0;if(o[0]==3&&o[1]==0)return r||new a(0);const f=n.H,I=f.b,C=f.e,A=f.R,D=f.n,w=f.A,k=f.Z,u=f.m,d=r==null;for(d&&(r=new a(o.length>>>2<<5));E==0;)if(E=I(o,c,1),x=I(o,c+1,2),c+=3,x!=0){if(d&&(r=n.H.W(r,U+(1<<17))),x==1&&(b=u.J,S=u.h,T=511,h=31),x==2){R=C(o,c,5)+257,F=C(o,c+5,5)+1,_=C(o,c+10,4)+4,c+=14;let j=1;for(var z=0;z<38;z+=2)u.Q[z]=0,u.Q[z+1]=0;for(z=0;z<_;z++){const O=C(o,c+3*z,3);u.Q[1+(u.X[z]<<1)]=O,O>j&&(j=O)}c+=3*_,D(u.Q,j),w(u.Q,j,u.u),b=u.w,S=u.d,c=A(u.u,(1<<j)-1,R+F,o,c,u.v);const L=f.V(u.v,0,R,u.C);T=(1<<L)-1;const H=f.V(u.v,R,F,u.D);h=(1<<H)-1,D(u.C,L),w(u.C,L,b),D(u.D,H),w(u.D,H,S)}for(;;){const j=b[k(o,c)&T];c+=15&j;const L=j>>>4;if(!(L>>>8))r[U++]=L;else{if(L==256)break;{let H=U+L-254;if(L>264){const G=u.q[L-257];H=U+(G>>>3)+C(o,c,7&G),c+=7&G}const O=S[k(o,c)&h];c+=15&O;const N=O>>>4,P=u.c[N],M=(P>>>4)+I(o,c,15&P);for(c+=15&P;U<H;)r[U]=r[U++-M],r[U]=r[U++-M],r[U]=r[U++-M],r[U]=r[U++-M];U=H}}}}else{(7&c)!=0&&(c+=8-(7&c));const j=4+(c>>>3),L=o[j-4]|o[j-3]<<8;d&&(r=n.H.W(r,U+L)),r.set(new a(o.buffer,o.byteOffset+j,L),U),c=j+L<<3,U+=L}return r.length==U?r:r.slice(0,U)},n.H.W=function(o,r){const a=o.length;if(r<=a)return o;const b=new Uint8Array(a<<1);return b.set(o,0),b},n.H.R=function(o,r,a,b,S,E){const x=n.H.e,R=n.H.Z;let F=0;for(;F<a;){const _=o[R(b,S)&r];S+=15&_;const T=_>>>4;if(T<=15)E[F]=T,F++;else{let h=0,U=0;T==16?(U=3+x(b,S,2),S+=2,h=E[F-1]):T==17?(U=3+x(b,S,3),S+=3):T==18&&(U=11+x(b,S,7),S+=7);const c=F+U;for(;F<c;)E[F]=h,F++}}return S},n.H.V=function(o,r,a,b){let S=0,E=0;const x=b.length>>>1;for(;E<a;){const R=o[E+r];b[E<<1]=0,b[1+(E<<1)]=R,R>S&&(S=R),E++}for(;E<x;)b[E<<1]=0,b[1+(E<<1)]=0,E++;return S},n.H.n=function(o,r){const a=n.H.m,b=o.length;let S,E,x,R;const F=a.j;for(var _=0;_<=r;_++)F[_]=0;for(_=1;_<b;_+=2)F[o[_]]++;const T=a.K;for(S=0,F[0]=0,E=1;E<=r;E++)S=S+F[E-1]<<1,T[E]=S;for(x=0;x<b;x+=2)R=o[x+1],R!=0&&(o[x]=T[R],T[R]++)},n.H.A=function(o,r,a){const b=o.length,S=n.H.m.r;for(let E=0;E<b;E+=2)if(o[E+1]!=0){const x=E>>1,R=o[E+1],F=x<<4|R,_=r-R;let T=o[E]<<_;const h=T+(1<<_);for(;T!=h;)a[S[T]>>>15-r]=F,T++}},n.H.l=function(o,r){const a=n.H.m.r,b=15-r;for(let S=0;S<o.length;S+=2){const E=o[S]<<r-o[S+1];o[S]=a[E]>>>b}},n.H.M=function(o,r,a){a<<=7&r;const b=r>>>3;o[b]|=a,o[b+1]|=a>>>8},n.H.I=function(o,r,a){a<<=7&r;const b=r>>>3;o[b]|=a,o[b+1]|=a>>>8,o[b+2]|=a>>>16},n.H.e=function(o,r,a){return(o[r>>>3]|o[1+(r>>>3)]<<8)>>>(7&r)&(1<<a)-1},n.H.b=function(o,r,a){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16)>>>(7&r)&(1<<a)-1},n.H.Z=function(o,r){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(o,r){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16|o[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const o=Uint16Array,r=Uint32Array;return{K:new o(16),j:new o(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new o(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new o(512),_:[],h:new o(32),$:[],w:new o(32768),C:[],v:[],d:new o(32768),D:[],u:new o(512),Q:[],r:new o(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new o(65536),g:new o(32768)}}(),function(){const o=n.H.m;for(var r=0;r<32768;r++){let b=r;b=(2863311530&b)>>>1|(1431655765&b)<<1,b=(3435973836&b)>>>2|(858993459&b)<<2,b=(4042322160&b)>>>4|(252645135&b)<<4,b=(4278255360&b)>>>8|(16711935&b)<<8,o.r[r]=(b>>>16|b<<16)>>>17}function a(b,S,E){for(;S--!=0;)b.push(0,E)}for(r=0;r<32;r++)o.q[r]=o.S[r]<<3|o.T[r],o.c[r]=o.p[r]<<4|o.z[r];a(o._,144,8),a(o._,112,9),a(o._,24,7),a(o._,8,8),n.H.n(o._,9),n.H.A(o._,9,o.J),n.H.l(o._,9),a(o.$,32,5),n.H.n(o.$,5),n.H.A(o.$,5,o.h),n.H.l(o.$,5),a(o.Q,19,0),a(o.C,286,0),a(o.D,30,0),a(o.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function l(n,o,r,a,b){let S=t(o);const E=Math.ceil(a*S/8);let x,R;S=Math.ceil(S/8);let F=n[r],_=0;if(F>1&&(n[r]=[0,0,1][F-2]),F==3)for(_=S;_<E;_++)n[_+1]=n[_+1]+(n[_+1-S]>>>1)&255;for(let T=0;T<b;T++)if(x=r+T*E,R=x+T+1,F=n[R-1],_=0,F==0)for(;_<E;_++)n[x+_]=n[R+_];else if(F==1){for(;_<S;_++)n[x+_]=n[R+_];for(;_<E;_++)n[x+_]=n[R+_]+n[x+_-S]}else if(F==2)for(;_<E;_++)n[x+_]=n[R+_]+n[x+_-E];else if(F==3){for(;_<S;_++)n[x+_]=n[R+_]+(n[x+_-E]>>>1);for(;_<E;_++)n[x+_]=n[R+_]+(n[x+_-E]+n[x+_-S]>>>1)}else{for(;_<S;_++)n[x+_]=n[R+_]+s(0,n[x+_-E],0);for(;_<E;_++)n[x+_]=n[R+_]+s(n[x+_-S],n[x+_-E],n[x+_-S-E])}return n}function s(n,o,r){const a=n+o-r,b=a-n,S=a-o,E=a-r;return b*b<=S*S&&b*b<=E*E?n:S*S<=E*E?o:r}function m(n,o,r){r.width=y.readUint(n,o),o+=4,r.height=y.readUint(n,o),o+=4,r.depth=n[o],o++,r.ctype=n[o],o++,r.compress=n[o],o++,r.filter=n[o],o++,r.interlace=n[o],o++}function v(n,o,r,a,b,S,E,x,R){const F=Math.min(o,b),_=Math.min(r,S);let T=0,h=0;for(let k=0;k<_;k++)for(let u=0;u<F;u++)if(E>=0&&x>=0?(T=k*o+u<<2,h=(x+k)*b+E+u<<2):(T=(-x+k)*o-E+u<<2,h=k*b+u<<2),R==0)a[h]=n[T],a[h+1]=n[T+1],a[h+2]=n[T+2],a[h+3]=n[T+3];else if(R==1){var U=n[T+3]*.00392156862745098,c=n[T]*U,f=n[T+1]*U,I=n[T+2]*U,C=a[h+3]*(1/255),A=a[h]*C,D=a[h+1]*C,w=a[h+2]*C;const d=1-U,z=U+C*d,j=z==0?0:1/z;a[h+3]=255*z,a[h+0]=(c+A*d)*j,a[h+1]=(f+D*d)*j,a[h+2]=(I+w*d)*j}else if(R==2)U=n[T+3],c=n[T],f=n[T+1],I=n[T+2],C=a[h+3],A=a[h],D=a[h+1],w=a[h+2],U==C&&c==A&&f==D&&I==w?(a[h]=0,a[h+1]=0,a[h+2]=0,a[h+3]=0):(a[h]=c,a[h+1]=f,a[h+2]=I,a[h+3]=U);else if(R==3){if(U=n[T+3],c=n[T],f=n[T+1],I=n[T+2],C=a[h+3],A=a[h],D=a[h+1],w=a[h+2],U==C&&c==A&&f==D&&I==w)continue;if(U<220&&C>20)return!1}return!0}return{decode:function(o){const r=new Uint8Array(o);let a=8;const b=y,S=b.readUshort,E=b.readUint,x={tabs:{},frames:[]},R=new Uint8Array(r.length);let F,_=0,T=0;const h=[137,80,78,71,13,10,26,10];for(var U=0;U<8;U++)if(r[U]!=h[U])throw"The input is not a PNG file!";for(;a<r.length;){const k=b.readUint(r,a);a+=4;const u=b.readASCII(r,a,4);if(a+=4,u=="IHDR")m(r,a,x);else if(u=="iCCP"){for(var c=a;r[c]!=0;)c++;b.readASCII(r,a,c-a),r[c+1];const d=r.slice(c+2,a+k);let z=null;try{z=i(d)}catch{z=e(d)}x.tabs[u]=z}else if(u=="CgBI")x.tabs[u]=r.slice(a,a+4);else if(u=="IDAT"){for(U=0;U<k;U++)R[_+U]=r[a+U];_+=k}else if(u=="acTL")x.tabs[u]={num_frames:E(r,a),num_plays:E(r,a+4)},F=new Uint8Array(r.length);else if(u=="fcTL"){T!=0&&((w=x.frames[x.frames.length-1]).data=p(x,F.slice(0,T),w.rect.width,w.rect.height),T=0);const d={x:E(r,a+12),y:E(r,a+16),width:E(r,a+4),height:E(r,a+8)};let z=S(r,a+22);z=S(r,a+20)/(z==0?100:z);const j={rect:d,delay:Math.round(1e3*z),dispose:r[a+24],blend:r[a+25]};x.frames.push(j)}else if(u=="fdAT"){for(U=0;U<k-4;U++)F[T+U]=r[a+U+4];T+=k-4}else if(u=="pHYs")x.tabs[u]=[b.readUint(r,a),b.readUint(r,a+4),r[a+8]];else if(u=="cHRM")for(x.tabs[u]=[],U=0;U<8;U++)x.tabs[u].push(b.readUint(r,a+4*U));else if(u=="tEXt"||u=="zTXt"){x.tabs[u]==null&&(x.tabs[u]={});var f=b.nextZero(r,a),I=b.readASCII(r,a,f-a),C=a+k-f-1;if(u=="tEXt")D=b.readASCII(r,f+1,C);else{var A=i(r.slice(f+2,f+2+C));D=b.readUTF8(A,0,A.length)}x.tabs[u][I]=D}else if(u=="iTXt"){x.tabs[u]==null&&(x.tabs[u]={}),f=0,c=a,f=b.nextZero(r,c),I=b.readASCII(r,c,f-c);const d=r[c=f+1];var D;r[c+1],c+=2,f=b.nextZero(r,c),b.readASCII(r,c,f-c),c=f+1,f=b.nextZero(r,c),b.readUTF8(r,c,f-c),C=k-((c=f+1)-a),d==0?D=b.readUTF8(r,c,C):(A=i(r.slice(c,c+C)),D=b.readUTF8(A,0,A.length)),x.tabs[u][I]=D}else if(u=="PLTE")x.tabs[u]=b.readBytes(r,a,k);else if(u=="hIST"){const d=x.tabs.PLTE.length/3;for(x.tabs[u]=[],U=0;U<d;U++)x.tabs[u].push(S(r,a+2*U))}else if(u=="tRNS")x.ctype==3?x.tabs[u]=b.readBytes(r,a,k):x.ctype==0?x.tabs[u]=S(r,a):x.ctype==2&&(x.tabs[u]=[S(r,a),S(r,a+2),S(r,a+4)]);else if(u=="gAMA")x.tabs[u]=b.readUint(r,a)/1e5;else if(u=="sRGB")x.tabs[u]=r[a];else if(u=="bKGD")x.ctype==0||x.ctype==4?x.tabs[u]=[S(r,a)]:x.ctype==2||x.ctype==6?x.tabs[u]=[S(r,a),S(r,a+2),S(r,a+4)]:x.ctype==3&&(x.tabs[u]=r[a]);else if(u=="IEND")break;a+=k,b.readUint(r,a),a+=4}var w;return T!=0&&((w=x.frames[x.frames.length-1]).data=p(x,F.slice(0,T),w.rect.width,w.rect.height)),x.data=p(x,R,x.width,x.height),delete x.compress,delete x.interlace,delete x.filter,x},toRGBA8:function(o){const r=o.width,a=o.height;if(o.tabs.acTL==null)return[g(o.data,r,a,o).buffer];const b=[];o.frames[0].data==null&&(o.frames[0].data=o.data);const S=r*a*4,E=new Uint8Array(S),x=new Uint8Array(S),R=new Uint8Array(S);for(let _=0;_<o.frames.length;_++){const T=o.frames[_],h=T.rect.x,U=T.rect.y,c=T.rect.width,f=T.rect.height,I=g(T.data,c,f,o);if(_!=0)for(var F=0;F<S;F++)R[F]=E[F];if(T.blend==0?v(I,c,f,E,r,a,h,U,0):T.blend==1&&v(I,c,f,E,r,a,h,U,1),b.push(E.buffer.slice(0)),T.dispose!=0){if(T.dispose==1)v(x,c,f,E,r,a,h,U,0);else if(T.dispose==2)for(F=0;F<S;F++)E[F]=R[F]}}return b},_paeth:s,_copyTile:v,_bin:y}}();(function(){const{_copyTile:y}=we,{_bin:g}=we,p=we._paeth;var i={table:function(){const c=new Uint32Array(256);for(let f=0;f<256;f++){let I=f;for(let C=0;C<8;C++)1&I?I=3988292384^I>>>1:I>>>=1;c[f]=I}return c}(),update(c,f,I,C){for(let A=0;A<C;A++)c=i.table[255&(c^f[I+A])]^c>>>8;return c},crc:(c,f,I)=>4294967295^i.update(4294967295,c,f,I)};function e(c,f,I,C){f[I]+=c[0]*C>>4,f[I+1]+=c[1]*C>>4,f[I+2]+=c[2]*C>>4,f[I+3]+=c[3]*C>>4}function t(c){return Math.max(0,Math.min(255,c))}function l(c,f){const I=c[0]-f[0],C=c[1]-f[1],A=c[2]-f[2],D=c[3]-f[3];return I*I+C*C+A*A+D*D}function s(c,f,I,C,A,D,w){w==null&&(w=1);const k=C.length,u=[];for(var d=0;d<k;d++){const M=C[d];u.push([M>>>0&255,M>>>8&255,M>>>16&255,M>>>24&255])}for(d=0;d<k;d++){let M=4294967295;for(var z=0,j=0;j<k;j++){var L=l(u[d],u[j]);j!=d&&L<M&&(M=L,z=j)}}const H=new Uint32Array(A.buffer),O=new Int16Array(f*I*4),N=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(d=0;d<N.length;d++)N[d]=255*((N[d]+.5)/16-.5);for(let M=0;M<I;M++)for(let G=0;G<f;G++){var P;d=4*(M*f+G),w!=2?P=[t(c[d]+O[d]),t(c[d+1]+O[d+1]),t(c[d+2]+O[d+2]),t(c[d+3]+O[d+3])]:(L=N[4*(3&M)+(3&G)],P=[t(c[d]+L),t(c[d+1]+L),t(c[d+2]+L),t(c[d+3]+L)]),z=0;let Y=16777215;for(j=0;j<k;j++){const K=l(P,u[j]);K<Y&&(Y=K,z=j)}const V=u[z],q=[P[0]-V[0],P[1]-V[1],P[2]-V[2],P[3]-V[3]];w==1&&(G!=f-1&&e(q,O,d+4,7),M!=I-1&&(G!=0&&e(q,O,d+4*f-4,3),e(q,O,d+4*f,5),G!=f-1&&e(q,O,d+4*f+4,1))),D[d>>2]=z,H[d>>2]=C[z]}}function m(c,f,I,C,A){A==null&&(A={});const{crc:D}=i,w=g.writeUint,k=g.writeUshort,u=g.writeASCII;let d=8;const z=c.frames.length>1;let j,L=!1,H=33+(z?20:0);if(A.sRGB!=null&&(H+=13),A.pHYs!=null&&(H+=21),A.iCCP!=null&&(j=pako.deflate(A.iCCP),H+=21+j.length+4),c.ctype==3){for(var O=c.plte.length,N=0;N<O;N++)c.plte[N]>>>24!=255&&(L=!0);H+=8+3*O+4+(L?8+1*O+4:0)}for(var P=0;P<c.frames.length;P++)z&&(H+=38),H+=(V=c.frames[P]).cimg.length+12,P!=0&&(H+=4);H+=12;const M=new Uint8Array(H),G=[137,80,78,71,13,10,26,10];for(N=0;N<8;N++)M[N]=G[N];if(w(M,d,13),d+=4,u(M,d,"IHDR"),d+=4,w(M,d,f),d+=4,w(M,d,I),d+=4,M[d]=c.depth,d++,M[d]=c.ctype,d++,M[d]=0,d++,M[d]=0,d++,M[d]=0,d++,w(M,d,D(M,d-17,17)),d+=4,A.sRGB!=null&&(w(M,d,1),d+=4,u(M,d,"sRGB"),d+=4,M[d]=A.sRGB,d++,w(M,d,D(M,d-5,5)),d+=4),A.iCCP!=null){const q=13+j.length;w(M,d,q),d+=4,u(M,d,"iCCP"),d+=4,u(M,d,"ICC profile"),d+=11,d+=2,M.set(j,d),d+=j.length,w(M,d,D(M,d-(q+4),q+4)),d+=4}if(A.pHYs!=null&&(w(M,d,9),d+=4,u(M,d,"pHYs"),d+=4,w(M,d,A.pHYs[0]),d+=4,w(M,d,A.pHYs[1]),d+=4,M[d]=A.pHYs[2],d++,w(M,d,D(M,d-13,13)),d+=4),z&&(w(M,d,8),d+=4,u(M,d,"acTL"),d+=4,w(M,d,c.frames.length),d+=4,w(M,d,A.loop!=null?A.loop:0),d+=4,w(M,d,D(M,d-12,12)),d+=4),c.ctype==3){for(w(M,d,3*(O=c.plte.length)),d+=4,u(M,d,"PLTE"),d+=4,N=0;N<O;N++){const q=3*N,K=c.plte[N],te=255&K,se=K>>>8&255,Re=K>>>16&255;M[d+q+0]=te,M[d+q+1]=se,M[d+q+2]=Re}if(d+=3*O,w(M,d,D(M,d-3*O-4,3*O+4)),d+=4,L){for(w(M,d,O),d+=4,u(M,d,"tRNS"),d+=4,N=0;N<O;N++)M[d+N]=c.plte[N]>>>24&255;d+=O,w(M,d,D(M,d-O-4,O+4)),d+=4}}let Y=0;for(P=0;P<c.frames.length;P++){var V=c.frames[P];z&&(w(M,d,26),d+=4,u(M,d,"fcTL"),d+=4,w(M,d,Y++),d+=4,w(M,d,V.rect.width),d+=4,w(M,d,V.rect.height),d+=4,w(M,d,V.rect.x),d+=4,w(M,d,V.rect.y),d+=4,k(M,d,C[P]),d+=2,k(M,d,1e3),d+=2,M[d]=V.dispose,d++,M[d]=V.blend,d++,w(M,d,D(M,d-30,30)),d+=4);const q=V.cimg;w(M,d,(O=q.length)+(P==0?0:4)),d+=4;const K=d;u(M,d,P==0?"IDAT":"fdAT"),d+=4,P!=0&&(w(M,d,Y++),d+=4),M.set(q,d),d+=O,w(M,d,D(M,K,d-K)),d+=4}return w(M,d,0),d+=4,u(M,d,"IEND"),d+=4,w(M,d,D(M,d-4,4)),d+=4,M.buffer}function v(c,f,I){for(let C=0;C<c.frames.length;C++){const A=c.frames[C];A.rect.width;const D=A.rect.height,w=new Uint8Array(D*A.bpl+D);A.cimg=a(A.img,D,A.bpp,A.bpl,w,f,I)}}function n(c,f,I,C,A){const D=A[0],w=A[1],k=A[2],u=A[3],d=A[4],z=A[5];let j=6,L=8,H=255;for(var O=0;O<c.length;O++){const ce=new Uint8Array(c[O]);for(var N=ce.length,P=0;P<N;P+=4)H&=ce[P+3]}const M=H!=255,G=function(J,Z,de,he,ne,be){const ie=[];for(var X=0;X<J.length;X++){const ge=new Uint8Array(J[X]),ve=new Uint32Array(ge.buffer);var me;let ye=0,_e=0,Ae=Z,Te=de,ot=he?1:0;if(X!=0){const Xt=be||he||X==1||ie[X-2].dispose!=0?1:2;let st=0,xt=1e9;for(let He=0;He<Xt;He++){var De=new Uint8Array(J[X-1-He]);const Yt=new Uint32Array(J[X-1-He]);let Fe=Z,Ue=de,Le=-1,$e=-1;for(let Me=0;Me<de;Me++)for(let ze=0;ze<Z;ze++)ve[fe=Me*Z+ze]!=Yt[fe]&&(ze<Fe&&(Fe=ze),ze>Le&&(Le=ze),Me<Ue&&(Ue=Me),Me>$e&&($e=Me));Le==-1&&(Fe=Ue=Le=$e=0),ne&&((1&Fe)==1&&Fe--,(1&Ue)==1&&Ue--);const vt=(Le-Fe+1)*($e-Ue+1);vt<xt&&(xt=vt,st=He,ye=Fe,_e=Ue,Ae=Le-Fe+1,Te=$e-Ue+1)}De=new Uint8Array(J[X-1-st]),st==1&&(ie[X-1].dispose=2),me=new Uint8Array(Ae*Te*4),y(De,Z,de,me,Ae,Te,-ye,-_e,0),ot=y(ge,Z,de,me,Ae,Te,-ye,-_e,3)?1:0,ot==1?r(ge,Z,de,me,{x:ye,y:_e,width:Ae,height:Te}):y(ge,Z,de,me,Ae,Te,-ye,-_e,0)}else me=ge.slice(0);ie.push({rect:{x:ye,y:_e,width:Ae,height:Te},img:me,blend:ot,dispose:0})}if(he)for(X=0;X<ie.length;X++){if((je=ie[X]).blend==1)continue;const ge=je.rect,ve=ie[X-1].rect,ye=Math.min(ge.x,ve.x),_e=Math.min(ge.y,ve.y),Ae={x:ye,y:_e,width:Math.max(ge.x+ge.width,ve.x+ve.width)-ye,height:Math.max(ge.y+ge.height,ve.y+ve.height)-_e};ie[X-1].dispose=1,X-1!=0&&o(J,Z,de,ie,X-1,Ae,ne),o(J,Z,de,ie,X,Ae,ne)}let qe=0;if(J.length!=1)for(var fe=0;fe<ie.length;fe++){var je;qe+=(je=ie[fe]).rect.width*je.rect.height}return ie}(c,f,I,D,w,k),Y={},V=[],q=[];if(C!=0){const ce=[];for(P=0;P<G.length;P++)ce.push(G[P].img.buffer);const J=function(ne){let be=0;for(var ie=0;ie<ne.length;ie++)be+=ne[ie].byteLength;const X=new Uint8Array(be);let me=0;for(ie=0;ie<ne.length;ie++){const De=new Uint8Array(ne[ie]),qe=De.length;for(let fe=0;fe<qe;fe+=4){let je=De[fe],ge=De[fe+1],ve=De[fe+2];const ye=De[fe+3];ye==0&&(je=ge=ve=0),X[me+fe]=je,X[me+fe+1]=ge,X[me+fe+2]=ve,X[me+fe+3]=ye}me+=qe}return X.buffer}(ce),Z=S(J,C);for(P=0;P<Z.plte.length;P++)V.push(Z.plte[P].est.rgba);let de=0;for(P=0;P<G.length;P++){const he=(te=G[P]).img.length;var K=new Uint8Array(Z.inds.buffer,de>>2,he>>2);q.push(K);const ne=new Uint8Array(Z.abuf,de,he);z&&s(te.img,te.rect.width,te.rect.height,V,ne,K),te.img.set(ne),de+=he}}else for(O=0;O<G.length;O++){var te=G[O];const ce=new Uint32Array(te.img.buffer);var se=te.rect.width;for(N=ce.length,K=new Uint8Array(N),q.push(K),P=0;P<N;P++){const J=ce[P];if(P!=0&&J==ce[P-1])K[P]=K[P-1];else if(P>se&&J==ce[P-se])K[P]=K[P-se];else{let Z=Y[J];if(Z==null&&(Y[J]=Z=V.length,V.push(J),V.length>=300))break;K[P]=Z}}}const Re=V.length;for(Re<=256&&d==0&&(L=Re<=2?1:Re<=4?2:Re<=16?4:8,L=Math.max(L,u)),O=0;O<G.length;O++){(te=G[O]).rect.x,te.rect.y,se=te.rect.width;const ce=te.rect.height;let J=te.img;new Uint32Array(J.buffer);let Z=4*se,de=4;if(Re<=256&&d==0){Z=Math.ceil(L*se/8);var Ie=new Uint8Array(Z*ce);const he=q[O];for(let ne=0;ne<ce;ne++){P=ne*Z;const be=ne*se;if(L==8)for(var ee=0;ee<se;ee++)Ie[P+ee]=he[be+ee];else if(L==4)for(ee=0;ee<se;ee++)Ie[P+(ee>>1)]|=he[be+ee]<<4-4*(1&ee);else if(L==2)for(ee=0;ee<se;ee++)Ie[P+(ee>>2)]|=he[be+ee]<<6-2*(3&ee);else if(L==1)for(ee=0;ee<se;ee++)Ie[P+(ee>>3)]|=he[be+ee]<<7-1*(7&ee)}J=Ie,j=3,de=1}else if(M==0&&G.length==1){Ie=new Uint8Array(se*ce*3);const he=se*ce;for(P=0;P<he;P++){const ne=3*P,be=4*P;Ie[ne]=J[be],Ie[ne+1]=J[be+1],Ie[ne+2]=J[be+2]}J=Ie,j=2,de=3,Z=3*se}te.img=J,te.bpl=Z,te.bpp=de}return{ctype:j,depth:L,plte:V,frames:G}}function o(c,f,I,C,A,D,w){const k=Uint8Array,u=Uint32Array,d=new k(c[A-1]),z=new u(c[A-1]),j=A+1<c.length?new k(c[A+1]):null,L=new k(c[A]),H=new u(L.buffer);let O=f,N=I,P=-1,M=-1;for(let Y=0;Y<D.height;Y++)for(let V=0;V<D.width;V++){const q=D.x+V,K=D.y+Y,te=K*f+q,se=H[te];se==0||C[A-1].dispose==0&&z[te]==se&&(j==null||j[4*te+3]!=0)||(q<O&&(O=q),q>P&&(P=q),K<N&&(N=K),K>M&&(M=K))}P==-1&&(O=N=P=M=0),w&&((1&O)==1&&O--,(1&N)==1&&N--),D={x:O,y:N,width:P-O+1,height:M-N+1};const G=C[A];G.rect=D,G.blend=1,G.img=new Uint8Array(D.width*D.height*4),C[A-1].dispose==0?(y(d,f,I,G.img,D.width,D.height,-D.x,-D.y,0),r(L,f,I,G.img,D)):y(L,f,I,G.img,D.width,D.height,-D.x,-D.y,0)}function r(c,f,I,C,A){y(c,f,I,C,A.width,A.height,-A.x,-A.y,2)}function a(c,f,I,C,A,D,w){const k=[];let u,d=[0,1,2,3,4];D!=-1?d=[D]:(f*C>5e5||I==1)&&(d=[0]),w&&(u={level:0});const z=Tr;for(var j=0;j<d.length;j++){for(let O=0;O<f;O++)b(A,c,O,C,I,d[j]);k.push(z.deflate(A,u))}let L,H=1e9;for(j=0;j<k.length;j++)k[j].length<H&&(L=j,H=k[j].length);return k[L]}function b(c,f,I,C,A,D){const w=I*C;let k=w+I;if(c[k]=D,k++,D==0)if(C<500)for(var u=0;u<C;u++)c[k+u]=f[w+u];else c.set(new Uint8Array(f.buffer,w,C),k);else if(D==1){for(u=0;u<A;u++)c[k+u]=f[w+u];for(u=A;u<C;u++)c[k+u]=f[w+u]-f[w+u-A]+256&255}else if(I==0){for(u=0;u<A;u++)c[k+u]=f[w+u];if(D==2)for(u=A;u<C;u++)c[k+u]=f[w+u];if(D==3)for(u=A;u<C;u++)c[k+u]=f[w+u]-(f[w+u-A]>>1)+256&255;if(D==4)for(u=A;u<C;u++)c[k+u]=f[w+u]-p(f[w+u-A],0,0)+256&255}else{if(D==2)for(u=0;u<C;u++)c[k+u]=f[w+u]+256-f[w+u-C]&255;if(D==3){for(u=0;u<A;u++)c[k+u]=f[w+u]+256-(f[w+u-C]>>1)&255;for(u=A;u<C;u++)c[k+u]=f[w+u]+256-(f[w+u-C]+f[w+u-A]>>1)&255}if(D==4){for(u=0;u<A;u++)c[k+u]=f[w+u]+256-p(0,f[w+u-C],0)&255;for(u=A;u<C;u++)c[k+u]=f[w+u]+256-p(f[w+u-A],f[w+u-C],f[w+u-A-C])&255}}}function S(c,f){const I=new Uint8Array(c),C=I.slice(0),A=new Uint32Array(C.buffer),D=E(C,f),w=D[0],k=D[1],u=I.length,d=new Uint8Array(u>>2);let z;if(I.length<2e7)for(var j=0;j<u;j+=4)z=x(w,L=I[j]*(1/255),H=I[j+1]*(1/255),O=I[j+2]*(1/255),N=I[j+3]*(1/255)),d[j>>2]=z.ind,A[j>>2]=z.est.rgba;else for(j=0;j<u;j+=4){var L=I[j]*.00392156862745098,H=I[j+1]*(1/255),O=I[j+2]*(1/255),N=I[j+3]*(1/255);for(z=w;z.left;)z=R(z.est,L,H,O,N)<=0?z.left:z.right;d[j>>2]=z.ind,A[j>>2]=z.est.rgba}return{abuf:C.buffer,inds:d,plte:k}}function E(c,f,I){I==null&&(I=1e-4);const C=new Uint32Array(c.buffer),A={i0:0,i1:c.length,bst:null,est:null,tdst:0,left:null,right:null};A.bst=T(c,A.i0,A.i1),A.est=h(A.bst);const D=[A];for(;D.length<f;){let k=0,u=0;for(var w=0;w<D.length;w++)D[w].est.L>k&&(k=D[w].est.L,u=w);if(k<I)break;const d=D[u],z=F(c,C,d.i0,d.i1,d.est.e,d.est.eMq255);if(d.i0>=z||d.i1<=z){d.est.L=0;continue}const j={i0:d.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};j.bst=T(c,j.i0,j.i1),j.est=h(j.bst);const L={i0:z,i1:d.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:d.bst.N-j.bst.N},w=0;w<16;w++)L.bst.R[w]=d.bst.R[w]-j.bst.R[w];for(w=0;w<4;w++)L.bst.m[w]=d.bst.m[w]-j.bst.m[w];L.est=h(L.bst),d.left=j,d.right=L,D[u]=j,D.push(L)}for(D.sort((k,u)=>u.bst.N-k.bst.N),w=0;w<D.length;w++)D[w].ind=w;return[A,D]}function x(c,f,I,C,A){if(c.left==null)return c.tdst=function(j,L,H,O,N){const P=L-j[0],M=H-j[1],G=O-j[2],Y=N-j[3];return P*P+M*M+G*G+Y*Y}(c.est.q,f,I,C,A),c;const D=R(c.est,f,I,C,A);let w=c.left,k=c.right;D>0&&(w=c.right,k=c.left);const u=x(w,f,I,C,A);if(u.tdst<=D*D)return u;const d=x(k,f,I,C,A);return d.tdst<u.tdst?d:u}function R(c,f,I,C,A){const{e:D}=c;return D[0]*f+D[1]*I+D[2]*C+D[3]*A-c.eMq}function F(c,f,I,C,A,D){for(C-=4;I<C;){for(;_(c,I,A)<=D;)I+=4;for(;_(c,C,A)>D;)C-=4;if(I>=C)break;const w=f[I>>2];f[I>>2]=f[C>>2],f[C>>2]=w,I+=4,C-=4}for(;_(c,I,A)>D;)I-=4;return I+4}function _(c,f,I){return c[f]*I[0]+c[f+1]*I[1]+c[f+2]*I[2]+c[f+3]*I[3]}function T(c,f,I){const C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],A=[0,0,0,0],D=I-f>>2;for(let w=f;w<I;w+=4){const k=c[w]*.00392156862745098,u=c[w+1]*(1/255),d=c[w+2]*(1/255),z=c[w+3]*(1/255);A[0]+=k,A[1]+=u,A[2]+=d,A[3]+=z,C[0]+=k*k,C[1]+=k*u,C[2]+=k*d,C[3]+=k*z,C[5]+=u*u,C[6]+=u*d,C[7]+=u*z,C[10]+=d*d,C[11]+=d*z,C[15]+=z*z}return C[4]=C[1],C[8]=C[2],C[9]=C[6],C[12]=C[3],C[13]=C[7],C[14]=C[11],{R:C,m:A,N:D}}function h(c){const{R:f}=c,{m:I}=c,{N:C}=c,A=I[0],D=I[1],w=I[2],k=I[3],u=C==0?0:1/C,d=[f[0]-A*A*u,f[1]-A*D*u,f[2]-A*w*u,f[3]-A*k*u,f[4]-D*A*u,f[5]-D*D*u,f[6]-D*w*u,f[7]-D*k*u,f[8]-w*A*u,f[9]-w*D*u,f[10]-w*w*u,f[11]-w*k*u,f[12]-k*A*u,f[13]-k*D*u,f[14]-k*w*u,f[15]-k*k*u],z=d,j=U;let L=[Math.random(),Math.random(),Math.random(),Math.random()],H=0,O=0;if(C!=0)for(let P=0;P<16&&(L=j.multVec(z,L),O=Math.sqrt(j.dot(L,L)),L=j.sml(1/O,L),!(P!=0&&Math.abs(O-H)<1e-9));P++)H=O;const N=[A*u,D*u,w*u,k*u];return{Cov:d,q:N,e:L,L:H,eMq255:j.dot(j.sml(255,N),L),eMq:j.dot(L,N),rgba:(Math.round(255*N[3])<<24|Math.round(255*N[2])<<16|Math.round(255*N[1])<<8|Math.round(255*N[0])<<0)>>>0}}var U={multVec:(c,f)=>[c[0]*f[0]+c[1]*f[1]+c[2]*f[2]+c[3]*f[3],c[4]*f[0]+c[5]*f[1]+c[6]*f[2]+c[7]*f[3],c[8]*f[0]+c[9]*f[1]+c[10]*f[2]+c[11]*f[3],c[12]*f[0]+c[13]*f[1]+c[14]*f[2]+c[15]*f[3]],dot:(c,f)=>c[0]*f[0]+c[1]*f[1]+c[2]*f[2]+c[3]*f[3],sml:(c,f)=>[c*f[0],c*f[1],c*f[2],c*f[3]]};we.encode=function(f,I,C,A,D,w,k){A==null&&(A=0),k==null&&(k=!1);const u=n(f,I,C,A,[!1,!1,!1,0,k,!1]);return v(u,-1),m(u,I,C,D,w)},we.encodeLL=function(f,I,C,A,D,w,k,u){const d={ctype:0+(A==1?0:2)+(D==0?0:4),depth:w,frames:[]},z=(A+D)*w,j=z*I;for(let L=0;L<f.length;L++)d.frames.push({rect:{x:0,y:0,width:I,height:C},img:new Uint8Array(f[L]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(j/8)});return v(d,0,!0),m(d,I,C,k,u)},we.encode.compress=n,we.encode.dither=s,we.quantize=S,we.quantize.getKDtree=E,we.quantize.getNearest=x})();const Wt={toArrayBuffer(y,g){const p=y.width,i=y.height,e=p<<2,t=y.getContext("2d").getImageData(0,0,p,i),l=new Uint32Array(t.data.buffer),s=(32*p+31)/32<<2,m=s*i,v=122+m,n=new ArrayBuffer(v),o=new DataView(n),r=1<<20;let a,b,S,E,x=r,R=0,F=0,_=0;function T(c){o.setUint16(F,c,!0),F+=2}function h(c){o.setUint32(F,c,!0),F+=4}function U(c){F+=c}T(19778),h(v),U(4),h(122),h(108),h(p),h(-i>>>0),T(1),T(32),h(3),h(m),h(2835),h(2835),U(8),h(16711680),h(65280),h(255),h(4278190080),h(1466527264),function c(){for(;R<i&&x>0;){for(E=122+R*s,a=0;a<e;)x--,b=l[_++],S=b>>>24,o.setUint32(E+a,b<<8|S),a+=4;R++}_<l.length?(x=r,setTimeout(c,Wt._dly)):g(n)}()},toBlob(y,g){this.toArrayBuffer(y,p=>{g(new Blob([p],{type:"image/bmp"}))})},_dly:9};var pe={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Mr={[pe.CHROME]:16384,[pe.FIREFOX]:11180,[pe.DESKTOP_SAFARI]:16384,[pe.IE]:8192,[pe.IOS]:4096,[pe.ETC]:8192};const mt=typeof window<"u",Nt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,tt=mt&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),zr=(mt||Nt)&&(tt&&tt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Ht=(mt||Nt)&&(tt&&tt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function yt(y,g,p=Date.now()){return new Promise(i=>{const e=y.split(","),t=e[0].match(/:(.*?);/)[1],l=globalThis.atob(e[1]);let s=l.length;const m=new Uint8Array(s);for(;s--;)m[s]=l.charCodeAt(s);const v=new Blob([m],{type:t});v.name=g,v.lastModified=p,i(v)})}function $t(y){return new Promise((g,p)=>{const i=new Ht;i.onload=()=>g(i.result),i.onerror=e=>p(e),i.readAsDataURL(y)})}function Gt(y){return new Promise((g,p)=>{const i=new Image;i.onload=()=>g(i),i.onerror=e=>p(e),i.src=y})}function Be(){if(Be.cachedResult!==void 0)return Be.cachedResult;let y=pe.ETC;const{userAgent:g}=navigator;return/Chrom(e|ium)/i.test(g)?y=pe.CHROME:/iP(ad|od|hone)/i.test(g)&&/WebKit/i.test(g)?y=pe.IOS:/Safari/i.test(g)?y=pe.DESKTOP_SAFARI:/Firefox/i.test(g)?y=pe.FIREFOX:(/MSIE/i.test(g)||document.documentMode)&&(y=pe.IE),Be.cachedResult=y,Be.cachedResult}function Qt(y,g){const p=Be(),i=Mr[p];let e=y,t=g,l=e*t;const s=e>t?t/e:e/t;for(;l>i*i;){const m=(i+e)/2,v=(i+t)/2;m<v?(t=v,e=v*s):(t=m*s,e=m),l=e*t}return{width:e,height:t}}function it(y,g){let p,i;try{if(p=new OffscreenCanvas(y,g),i=p.getContext("2d"),i===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{p=document.createElement("canvas"),i=p.getContext("2d")}return p.width=y,p.height=g,[p,i]}function qt(y,g){const{width:p,height:i}=Qt(y.width,y.height),[e,t]=it(p,i);return g&&/jpe?g/.test(g)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(y,0,0,e.width,e.height),e}function Ke(){return Ke.cachedResult!==void 0||(Ke.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ke.cachedResult}function rt(y,g={}){return new Promise(function(p,i){let e,t;var l=function(){try{return t=qt(e,g.fileType||y.type),p([e,t])}catch(m){return i(m)}},s=function(m){try{var v=function(n){try{throw n}catch(o){return i(o)}};try{let n;return $t(y).then(function(o){try{return n=o,Gt(n).then(function(r){try{return e=r,function(){try{return l()}catch(a){return i(a)}}()}catch(a){return v(a)}},v)}catch(r){return v(r)}},v)}catch(n){v(n)}}catch(n){return i(n)}};try{if(Ke()||[pe.DESKTOP_SAFARI,pe.MOBILE_SAFARI].includes(Be()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(y).then(function(m){try{return e=m,l()}catch{return s()}},s)}catch{s()}})}function nt(y,g,p,i,e=1){return new Promise(function(t,l){let s;if(g==="image/png"){let v,n,o;return v=y.getContext("2d"),{data:n}=v.getImageData(0,0,y.width,y.height),o=we.encode([n.buffer],y.width,y.height,4096*e),s=new Blob([o],{type:g}),s.name=p,s.lastModified=i,m.call(this)}{let v=function(){return m.call(this)};if(g==="image/bmp")return new Promise(n=>Wt.toBlob(y,n)).then((function(n){try{return s=n,s.name=p,s.lastModified=i,v.call(this)}catch(o){return l(o)}}).bind(this),l);{let n=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&y instanceof OffscreenCanvas)return y.convertToBlob({type:g,quality:e}).then((function(o){try{return s=o,s.name=p,s.lastModified=i,n.call(this)}catch(r){return l(r)}}).bind(this),l);{let o;return o=y.toDataURL(g,e),yt(o,p,i).then((function(r){try{return s=r,n.call(this)}catch(a){return l(a)}}).bind(this),l)}}}function m(){return t(s)}})}function Ce(y){y.width=0,y.height=0}function We(){return new Promise(function(y,g){let p,i,e,t;return We.cachedResult!==void 0?y(We.cachedResult):yt("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(l){try{return p=l,rt(p).then(function(s){try{return i=s[1],nt(i,p.type,p.name,p.lastModified).then(function(m){try{return e=m,Ce(i),rt(e).then(function(v){try{return t=v[0],We.cachedResult=t.width===1&&t.height===2,y(We.cachedResult)}catch(n){return g(n)}},g)}catch(v){return g(v)}},g)}catch(m){return g(m)}},g)}catch(s){return g(s)}},g)})}function Vt(y){return new Promise((g,p)=>{const i=new Ht;i.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return g(-2);const l=t.byteLength;let s=2;for(;s<l;){if(t.getUint16(s+2,!1)<=8)return g(-1);const m=t.getUint16(s,!1);if(s+=2,m==65505){if(t.getUint32(s+=2,!1)!=1165519206)return g(-1);const v=t.getUint16(s+=6,!1)==18761;s+=t.getUint32(s+4,v);const n=t.getUint16(s,v);s+=2;for(let o=0;o<n;o++)if(t.getUint16(s+12*o,v)==274)return g(t.getUint16(s+12*o+8,v))}else{if((65280&m)!=65280)break;s+=t.getUint16(s,!1)}}return g(-1)},i.onerror=e=>p(e),i.readAsArrayBuffer(y)})}function Kt(y,g){const{width:p}=y,{height:i}=y,{maxWidthOrHeight:e}=g;let t,l=y;return isFinite(e)&&(p>e||i>e)&&([l,t]=it(p,i),p>i?(l.width=e,l.height=i/p*e):(l.width=p/i*e,l.height=e),t.drawImage(y,0,0,l.width,l.height),Ce(y)),l}function Zt(y,g){const{width:p}=y,{height:i}=y,[e,t]=it(p,i);switch(g>4&&g<9?(e.width=i,e.height=p):(e.width=p,e.height=i),g){case 2:t.transform(-1,0,0,1,p,0);break;case 3:t.transform(-1,0,0,-1,p,i);break;case 4:t.transform(1,0,0,-1,0,i);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,i,0);break;case 7:t.transform(0,-1,-1,0,i,p);break;case 8:t.transform(0,-1,1,0,0,p)}return t.drawImage(y,0,0,p,i),Ce(y),e}function Ut(y,g,p=0){return new Promise(function(i,e){let t,l,s,m,v,n,o,r,a,b,S,E,x,R,F,_,T,h,U,c;function f(C=5){if(g.signal&&g.signal.aborted)throw g.signal.reason;t+=C,g.onProgress(Math.min(t,100))}function I(C){if(g.signal&&g.signal.aborted)throw g.signal.reason;t=Math.min(Math.max(C,t),100),g.onProgress(t)}return t=p,l=g.maxIteration||10,s=1024*g.maxSizeMB*1024,f(),rt(y,g).then((function(C){try{return[,m]=C,f(),v=Kt(m,g),f(),new Promise(function(A,D){var w;if(!(w=g.exifOrientation))return Vt(y).then((function(u){try{return w=u,k.call(this)}catch(d){return D(d)}}).bind(this),D);function k(){return A(w)}return k.call(this)}).then((function(A){try{return n=A,f(),We().then((function(D){try{return o=D?v:Zt(v,n),f(),r=g.initialQuality||1,a=g.fileType||y.type,nt(o,a,y.name,y.lastModified,r).then((function(w){try{{let u=function(){if(l--&&(F>s||F>x)){let z,j;return z=c?.95*U.width:U.width,j=c?.95*U.height:U.height,[T,h]=it(z,j),h.drawImage(U,0,0,z,j),r*=a==="image/png"?.85:.95,nt(T,a,y.name,y.lastModified,r).then(function(L){try{return _=L,Ce(U),U=T,F=_.size,I(Math.min(99,Math.floor((R-F)/(R-s)*100))),u}catch(H){return e(H)}},e)}return[1]},d=function(){return Ce(U),Ce(T),Ce(v),Ce(o),Ce(m),I(100),i(_)};if(b=w,f(),S=b.size>s,E=b.size>y.size,!S&&!E)return I(100),i(b);var k;return x=y.size,R=b.size,F=R,U=o,c=!g.alwaysKeepResolution&&S,(k=(function(z){for(;z;){if(z.then)return void z.then(k,e);try{if(z.pop){if(z.length)return z.pop()?d.call(this):z;z=u}else z=z.call(this)}catch(j){return e(j)}}}).bind(this))(u)}}catch(u){return e(u)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)}catch(D){return e(D)}}).bind(this),e)}catch(A){return e(A)}}).bind(this),e)})}const Br=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let gt;function Lr(y,g){return new Promise((p,i)=>{gt||(gt=function(l){const s=[];return s.push(l),URL.createObjectURL(new Blob(s))}(Br));const e=new Worker(gt);e.addEventListener("message",function(l){if(g.signal&&g.signal.aborted)e.terminate();else if(l.data.progress===void 0){if(l.data.error)return i(new Error(l.data.error)),void e.terminate();p(l.data.file),e.terminate()}else g.onProgress(l.data.progress)}),e.addEventListener("error",i),g.signal&&g.signal.addEventListener("abort",()=>{i(g.signal.reason),e.terminate()}),e.postMessage({file:y,imageCompressionLibUrl:g.libURL,options:{...g,onProgress:void 0,signal:void 0}})})}function ue(y,g){return new Promise(function(p,i){let e,t,l,s,m,v;if(e={...g},l=0,{onProgress:s}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,m=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=a=>{l=a,typeof s=="function"&&s(l)},!(y instanceof Blob||y instanceof zr))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(y.type))return i(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!m||typeof Worker!="function"||v)return Ut(y,e).then((function(a){try{return t=a,r.call(this)}catch(b){return i(b)}}).bind(this),i);var n=(function(){try{return r.call(this)}catch(a){return i(a)}}).bind(this),o=function(a){try{return Ut(y,e).then(function(b){try{return t=b,n()}catch(S){return i(S)}},i)}catch(b){return i(b)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Lr(y,e).then(function(a){try{return t=a,n()}catch{return o()}},o)}catch{o()}function r(){try{t.name=y.name,t.lastModified=y.lastModified}catch{}try{e.preserveExif&&y.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===y.type)&&(t=Ot(y,t))}catch{}return p(t)}})}ue.getDataUrlFromFile=$t,ue.getFilefromDataUrl=yt,ue.loadImage=Gt,ue.drawImageInCanvas=qt,ue.drawFileInCanvas=rt,ue.canvasToFile=nt,ue.getExifOrientation=Vt,ue.handleMaxWidthOrHeight=Kt,ue.followExifOrientation=Zt,ue.cleanupCanvasMemory=Ce,ue.isAutoOrientationInBrowser=We,ue.approximateBelowMaximumCanvasSizeOfBrowser=Qt,ue.copyExifWithoutOrientation=Ot,ue.getBrowserName=Be,ue.version="2.0.2";const Kr=({images:y,onImagesChange:g,storagePath:p,disabled:i=!1})=>{const[e,t]=le.useState(!1),[l,s]=le.useState(0),[m,v]=le.useState(null),[n,o]=le.useState(null),r=le.useRef(null),a=async x=>{const R=Array.from(x.target.files||[]);if(R.length!==0){t(!0),o(null),s(0);try{const F=Ze(),_=[];for(let T=0;T<R.length;T++){const h=R[T];let U=h;h.size>1024*1024&&(U=await ue(h,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}));const c=`${Date.now()}_${pt()}.${U.type.split("/")[1]}`,f=`${p}/${c}`,I=Xe(F,f),C=Et(I,U);await new Promise((A,D)=>{C.on("state_changed",w=>{const k=(T+w.bytesTransferred/w.totalBytes)/R.length*100;s(k)},w=>{console.error("Upload error:",w),D(w)},async()=>{const w=await kt(C.snapshot.ref);_.push({url:w,path:f,title:h.name.replace(/\.[^/.]+$/,"")}),A()})})}g([...y,..._])}catch(F){console.error("Error uploading images:",F),o("Failed to upload images. Please try again.")}finally{t(!1),s(0),r.current&&(r.current.value="")}}},b=async x=>{const R=y[x];try{const F=Ze(),_=Xe(F,R.path);await Rt(_);const T=y.filter((h,U)=>U!==x);g(T)}catch(F){console.error("Error deleting image:",F),o("Failed to delete image. It may have been already deleted.");const _=y.filter((T,h)=>h!==x);g(_)}},S=le.useCallback((x,R)=>{const F=[...y];F[x]={...F[x],title:R},g(F)},[y,g]),E=x=>{v(x)};return B.jsxs(oe,{children:[B.jsxs(oe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:$[3]},children:[B.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:$[2]},children:[B.jsx(St,{sx:{color:W.text.tertiary}}),B.jsx(ae,{variant:"h6",sx:{fontFamily:Q.fontFamily.display,fontWeight:Q.fontWeight.semibold,color:W.text.primary},children:"Images"}),B.jsxs(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:Q.fontSize.sm},children:[y.length," ",y.length===1?"image":"images"]})]}),B.jsx(Ye,{variant:"outlined",startIcon:B.jsx(Mt,{}),onClick:()=>{var x;return(x=r.current)==null?void 0:x.click()},disabled:i||e,sx:{borderRadius:re.md,textTransform:"none",fontWeight:Q.fontWeight.medium},children:"Upload Images"}),B.jsx("input",{ref:r,type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:a,disabled:i})]}),e&&B.jsxs(oe,{sx:{mb:$[3]},children:[B.jsx(zt,{variant:"determinate",value:l}),B.jsxs(ae,{variant:"caption",sx:{color:W.text.tertiary,mt:$[1],display:"block"},children:["Uploading... ",Math.round(l),"%"]})]}),n&&B.jsx(Bt,{severity:"error",onClose:()=>o(null),sx:{mb:$[3]},children:n}),y.length>0?B.jsx(Dt,{container:!0,spacing:$[2],children:y.map((x,R)=>B.jsx(Dt,{item:!0,xs:12,sm:6,md:4,children:B.jsxs(fr,{sx:{borderRadius:re.lg,boxShadow:It.sm,transition:"all 0.2s","&:hover":{boxShadow:It.md}},children:[B.jsx(ur,{component:"img",height:"160",image:x.url,alt:x.title,sx:{objectFit:"cover",cursor:"pointer"},onClick:()=>E(x)}),B.jsx(hr,{sx:{p:$[2]},children:B.jsx(gr,{fullWidth:!0,size:"small",placeholder:"Image title...",value:x.title,onChange:F=>S(R,F.target.value),disabled:i,sx:{"& .MuiInputBase-root":{fontSize:Q.fontSize.sm}}})}),B.jsxs(pr,{sx:{px:$[2],pb:$[2],pt:0,justifyContent:"space-between"},children:[B.jsx(Je,{title:"View fullscreen",children:B.jsx(Ne,{size:"small",onClick:()=>E(x),children:B.jsx(br,{fontSize:"small"})})}),B.jsx(Je,{title:"Delete image",children:B.jsx(Ne,{size:"small",onClick:()=>b(R),disabled:i,sx:{color:W.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:B.jsx(Lt,{fontSize:"small"})})})]})]})},R))}):B.jsxs(oe,{sx:{border:`2px dashed ${W.neutral[300]}`,borderRadius:re.lg,p:$[6],textAlign:"center",backgroundColor:W.background.secondary},children:[B.jsx(St,{sx:{fontSize:48,color:W.text.tertiary,mb:$[2]}}),B.jsx(ae,{variant:"body1",sx:{color:W.text.secondary,mb:$[1]},children:"No images yet"}),B.jsxs(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:Q.fontSize.sm},children:['Click "Upload Images" to add images to this ',p.includes("design")?"design":p.includes("build")?"build":"test"]})]}),B.jsx(jt,{open:!!m,onClose:()=>v(null),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{backgroundColor:W.background.primary,borderRadius:re.xl}},children:B.jsx(Tt,{sx:{p:0,position:"relative"},children:m&&B.jsxs(B.Fragment,{children:[B.jsx(Ne,{onClick:()=>v(null),sx:{position:"absolute",top:$[2],right:$[2],backgroundColor:"rgba(0, 0, 0, 0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"},zIndex:1},children:B.jsx(mr,{})}),B.jsx("img",{src:m.url,alt:m.title,style:{width:"100%",height:"auto",display:"block"}}),m.title&&B.jsx(oe,{sx:{p:$[3],backgroundColor:W.background.secondary},children:B.jsx(ae,{variant:"h6",sx:{fontFamily:Q.fontFamily.display,color:W.text.primary},children:m.title})})]})})})]})},Pr=y=>{var p;switch((p=y.split(".").pop())==null?void 0:p.toLowerCase()){case"pdf":return B.jsx(Dr,{sx:{color:"#D32F2F"}});case"doc":case"docx":return B.jsx(Ft,{sx:{color:"#1976D2"}});case"xls":case"xlsx":case"csv":return B.jsx(Sr,{sx:{color:"#2E7D32"}});case"txt":case"md":return B.jsx(Ft,{sx:{color:W.text.secondary}});case"json":case"xml":case"html":case"css":case"js":case"ts":return B.jsx(_r,{sx:{color:"#F57C00"}});case"zip":case"rar":case"7z":return B.jsx(Cr,{sx:{color:"#5E35B1"}});default:return B.jsx(bt,{sx:{color:W.text.tertiary}})}},Zr=({files:y,onFilesChange:g,storagePath:p,disabled:i=!1,maxFileSize:e=10,allowedTypes:t=[]})=>{const[l,s]=le.useState(!1),[m,v]=le.useState(0),[n,o]=le.useState(""),[r,a]=le.useState(null),b=le.useRef(null),S=le.useCallback(R=>{var _;const F=e*1024*1024;if(R.size>F)return`File size exceeds ${e}MB limit`;if(t.length>0){const T=`.${(_=R.name.split(".").pop())==null?void 0:_.toLowerCase()}`;if(!t.some(U=>U.startsWith(".")?U.toLowerCase()===T:R.type===U))return`File type not allowed. Allowed types: ${t.join(", ")}`}return null},[e,t]),E=async R=>{const F=Array.from(R.target.files||[]);if(F.length!==0){s(!0),a(null),v(0);try{const _=Ze(),T=[];for(let h=0;h<F.length;h++){const U=F[h];o(U.name);const c=S(U);if(c){a(c);continue}const f=U.name.split(".").pop(),I=`${Date.now()}_${pt()}.${f}`,C=`${p}/files/${I}`,A=Xe(_,C),D=Et(A,U);await new Promise((w,k)=>{D.on("state_changed",u=>{const d=(h+u.bytesTransferred/u.totalBytes)/F.length*100;v(d)},u=>{console.error("Upload error:",u),k(u)},async()=>{const u=await kt(D.snapshot.ref);T.push({id:pt(),url:u,name:U.name,path:C}),w()})})}g([...y,...T])}catch(_){console.error("Error uploading files:",_),a("Failed to upload files. Please try again.")}finally{s(!1),v(0),o(""),b.current&&(b.current.value="")}}},x=async R=>{const F=y[R];try{const _=Ze(),T=Xe(_,F.path);await Rt(T);const h=y.filter((U,c)=>c!==R);g(h)}catch(_){console.error("Error deleting file:",_),a("Failed to delete file. It may have been already deleted.");const T=y.filter((h,U)=>U!==R);g(T)}};return B.jsxs(oe,{children:[B.jsxs(oe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:$[3]},children:[B.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:$[2]},children:[B.jsx(bt,{sx:{color:W.text.tertiary}}),B.jsx(ae,{variant:"h6",sx:{fontFamily:Q.fontFamily.display,fontWeight:Q.fontWeight.semibold,color:W.text.primary},children:"Files"}),B.jsxs(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:Q.fontSize.sm},children:[y.length," ",y.length===1?"file":"files"]})]}),B.jsx(Ye,{variant:"outlined",startIcon:B.jsx(Mt,{}),onClick:()=>{var R;return(R=b.current)==null?void 0:R.click()},disabled:i||l,sx:{borderRadius:re.md,textTransform:"none",fontWeight:Q.fontWeight.medium},children:"Upload Files"}),B.jsx("input",{ref:b,type:"file",multiple:!0,style:{display:"none"},onChange:E,disabled:i,accept:t.length>0?t.join(","):void 0})]}),l&&B.jsxs(oe,{sx:{mb:$[3]},children:[B.jsxs(ae,{variant:"caption",sx:{color:W.text.secondary,mb:$[1],display:"block"},children:["Uploading ",n,"..."]}),B.jsx(zt,{variant:"determinate",value:m}),B.jsxs(ae,{variant:"caption",sx:{color:W.text.tertiary,mt:$[1],display:"block"},children:[Math.round(m),"%"]})]}),r&&B.jsx(Bt,{severity:"error",onClose:()=>a(null),sx:{mb:$[3]},children:r}),y.length>0?B.jsx(yr,{sx:{border:`1px solid ${W.neutral[200]}`,borderRadius:re.lg,backgroundColor:W.background.secondary,overflow:"hidden"},children:y.map((R,F)=>{var _;return B.jsxs(xr,{sx:{borderBottom:F<y.length-1?`1px solid ${W.neutral[200]}`:"none","&:hover":{backgroundColor:W.neutral[50]}},children:[B.jsx(vr,{children:Pr(R.name)}),B.jsx(wr,{primary:B.jsx(ae,{variant:"body2",sx:{fontWeight:Q.fontWeight.medium,color:W.text.primary},children:R.name}),secondary:B.jsxs(ae,{variant:"caption",sx:{color:W.text.tertiary},children:[(_=R.name.split(".").pop())==null?void 0:_.toUpperCase()," file"]})}),B.jsx(Ir,{children:B.jsx(Ne,{edge:"end",onClick:()=>x(F),disabled:i,sx:{color:W.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:B.jsx(Lt,{})})})]},R.id)})}):B.jsxs(oe,{sx:{border:`2px dashed ${W.neutral[300]}`,borderRadius:re.lg,p:$[6],textAlign:"center",backgroundColor:W.background.secondary},children:[B.jsx(bt,{sx:{fontSize:48,color:W.text.tertiary,mb:$[2]}}),B.jsx(ae,{variant:"body1",sx:{color:W.text.secondary,mb:$[1]},children:"No files attached"}),B.jsx(ae,{variant:"body2",sx:{color:W.text.tertiary,fontSize:Q.fontSize.sm},children:'Click "Upload Files" to attach documents, data files, or other resources'}),e&&B.jsx(Ar,{label:`Max file size: ${e}MB`,size:"small",sx:{mt:$[2]}})]})]})};export{Qr as C,Zr as F,Kr as I,qr as R,Vr as a,Ur as l,Gr as u};
