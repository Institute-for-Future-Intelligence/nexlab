import{r as i,p as Zt,q as Qt,j as e,B as ae,a as de,i as pn,P as rt,k as xn,l as bn,m as It,n as he,o as yn,T as je,t as yt,I as pe,c as De,d as Re,V as Be,X as Ee,aa as Ne,A as Me,w as jn,F as ds,S as Yt,M as it,a0 as vn,a1 as Sn,b9 as Cn,z as at,a2 as Tn,D as Fn,W as Ve,Y as ct,Z as Ye,f as wn,v as kn}from"./ui-D_FIyQ7E.js";import{P as In,a as ye,c as p,d as ot,b as me,s as k,t as h,C as Dn,f as Rn,g as lt,r as Oe,h as On,R as zn,u as ut,i as _n,j as q,V as Dt}from"./index-DwVItUg0.js";import{l as Jt,k as Pe,r as $e,p as bt,z as zs,n as _s,q as Kt,_ as le,h as dt,e as oe,f as Bn,R as fe,x as be,v as se,t as Ie,m as ke,i as Rt,y as Le}from"./firebase-CTJJwFJC.js";import{E as Bs}from"./Edit-D5U7H6-4.js";import{i as En}from"./browser-image-compression-BgY3rL5_.js";import{g as Fe}from"./vendor-BFl3bqVE.js";import Ot from"./purify.es-CQJ0hv7W.js";const Es=i.memo(({setIsAdding:s})=>{console.log("Header loaded");const o=Zt(),c=Qt(o.breakpoints.down("md"));return e.jsxs(ae,{children:[e.jsx(In,{title:"Laboratory Notebook",subtitle:"Manage your lab experiments, designs, and research projects"}),e.jsx(ae,{sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(de,{variant:"contained",onClick:()=>s(!0),sx:{fontFamily:h.fontFamily.display,fontSize:c?h.fontSize.lg:h.fontSize.xl,fontWeight:h.fontWeight.semibold,textTransform:"none",px:c?k[4]:k[6],py:k[3],backgroundColor:p.primary[500],borderRadius:me.xl,boxShadow:ye.md,transition:ot.transitions.fast,"&:hover":{backgroundColor:p.primary[600],boxShadow:ye.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"}},children:"+ Create New Design"})})]})});Es.displayName="Header";const Ue=({designs:s,handleEdit:o,handleDelete:c,userDetails:a,showUserIdColumn:S})=>{const m=d=>d?d instanceof Jt?d.toDate().toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):d instanceof Date?d.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A":"N/A";return e.jsx(pn,{component:rt,sx:{borderRadius:me["2xl"],boxShadow:ye.lg,border:`1px solid ${p.neutral[200]}`,overflow:"hidden"},children:e.jsxs(xn,{sx:{"& .MuiTableCell-root":{fontSize:h.fontSize.base,fontFamily:h.fontFamily.primary,borderBottom:`1px solid ${p.neutral[200]}`},"& .MuiTableCell-head":{fontSize:h.fontSize.lg,fontFamily:h.fontFamily.display,fontWeight:h.fontWeight.semibold,backgroundColor:p.primary[500],color:p.text.inverse,textTransform:"uppercase",letterSpacing:"0.5px"},"& .MuiTableRow-root:hover":{backgroundColor:p.primary[25]}},children:[e.jsx(bn,{children:e.jsxs(It,{sx:{height:"64px"},children:[e.jsx(he,{sx:{width:S?"30%":"35%"},children:"Title"}),e.jsx(he,{sx:{width:"20%"},children:"Course"}),S&&e.jsx(he,{sx:{width:"15%"},children:"User"}),e.jsx(he,{sx:{width:"15%"},children:"Created"}),e.jsx(he,{sx:{width:"15%"},children:"Modified"}),e.jsx(he,{sx:{width:"15%",textAlign:"center"},children:"Actions"})]})}),e.jsx(yn,{children:s&&s.length>0?s.map(d=>{const g=d.userId===(a==null?void 0:a.uid),F=d.course&&(a!=null&&a.classes)&&a.classes[d.course]?a.classes[d.course]:null;return e.jsxs(It,{sx:{height:"72px",transition:ot.transitions.fast,"&:hover":{backgroundColor:p.primary[25],transform:"translateY(-1px)",boxShadow:ye.sm}},children:[e.jsx(he,{children:e.jsx(ae,{onClick:()=>o(d.id),sx:{display:"inline-flex",alignItems:"center",backgroundColor:p.primary[100],border:`1px solid ${p.primary[200]}`,borderRadius:me.lg,padding:`${k[2]} ${k[3]}`,cursor:"pointer",transition:"all 0.2s ease",maxWidth:"100%","&:hover":{backgroundColor:p.primary[200],borderColor:p.primary[300],transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},"&:active":{transform:"translateY(0)"}},children:e.jsx(je,{variant:"body1",sx:{fontFamily:h.fontFamily.secondary,fontSize:h.fontSize.base,fontWeight:h.fontWeight.semibold,color:p.primary[700],textDecoration:"none",userSelect:"none","&:hover":{textDecoration:"underline"}},children:d.title})})}),e.jsx(he,{children:F?e.jsx(Dn,{courseId:d.course,courseNumber:F.number,courseTitle:F.title,variant:"link",maxTitleLength:30}):e.jsx(je,{variant:"body2",sx:{color:p.text.disabled,fontStyle:"italic"},children:"No Course"})}),S&&e.jsx(he,{children:e.jsx(Rn,{userId:d.userId,userType:"student"})}),e.jsx(he,{children:e.jsx(je,{variant:"body2",sx:{color:p.text.secondary,fontSize:h.fontSize.sm},children:m(d.dateCreated)})}),e.jsx(he,{children:e.jsx(je,{variant:"body2",sx:{color:p.text.secondary,fontSize:h.fontSize.sm},children:m(d.dateModified)})}),e.jsx(he,{sx:{textAlign:"center"},children:e.jsxs(ae,{sx:{display:"flex",justifyContent:"center",gap:k[1]},children:[e.jsx(yt,{title:g?"Edit Design":"Cannot edit others' designs",children:e.jsx("span",{children:e.jsx(pe,{size:"small",onClick:()=>g&&o(d.id),disabled:!g,sx:{color:g?p.primary[600]:p.text.disabled,"&:hover":{backgroundColor:g?p.primary[100]:"transparent"}},children:e.jsx(Bs,{fontSize:"small"})})})}),e.jsx(yt,{title:g?"Delete Design":"Cannot delete others' designs",children:e.jsx("span",{children:e.jsx(pe,{size:"small",onClick:()=>g&&c(d.id),disabled:!g,sx:{color:g?p.error:p.text.disabled,"&:hover":{backgroundColor:g?p.error+"20":"transparent"}},children:e.jsx(lt,{fontSize:"small"})})})})]})})]},d.id)}):e.jsx(It,{children:e.jsx(he,{colSpan:S?6:5,sx:{textAlign:"center",py:k[8],color:p.text.secondary,fontStyle:"italic"},children:e.jsx(je,{variant:"body1",sx:{fontFamily:h.fontFamily.secondary,fontSize:h.fontSize.base,fontWeight:h.fontWeight.medium},children:"No designs found. Create your first design to get started!"})})})})]})})};var zt,cs;function Ns(){if(cs)return zt;cs=1;function s(o){var c=typeof o;return o!=null&&(c=="object"||c=="function")}return zt=s,zt}var _t,us;function Nn(){if(us)return _t;us=1;var s=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return _t=s,_t}var Bt,fs;function Ms(){if(fs)return Bt;fs=1;var s=Nn(),o=typeof self=="object"&&self&&self.Object===Object&&self,c=s||o||Function("return this")();return Bt=c,Bt}var Et,hs;function Mn(){if(hs)return Et;hs=1;var s=Ms(),o=function(){return s.Date.now()};return Et=o,Et}var Nt,ms;function An(){if(ms)return Nt;ms=1;var s=/\s/;function o(c){for(var a=c.length;a--&&s.test(c.charAt(a)););return a}return Nt=o,Nt}var Mt,gs;function qn(){if(gs)return Mt;gs=1;var s=An(),o=/^\s+/;function c(a){return a&&a.slice(0,s(a)+1).replace(o,"")}return Mt=c,Mt}var At,ps;function As(){if(ps)return At;ps=1;var s=Ms(),o=s.Symbol;return At=o,At}var qt,xs;function Un(){if(xs)return qt;xs=1;var s=As(),o=Object.prototype,c=o.hasOwnProperty,a=o.toString,S=s?s.toStringTag:void 0;function m(d){var g=c.call(d,S),F=d[S];try{d[S]=void 0;var b=!0}catch{}var I=a.call(d);return b&&(g?d[S]=F:delete d[S]),I}return qt=m,qt}var Ut,bs;function Wn(){if(bs)return Ut;bs=1;var s=Object.prototype,o=s.toString;function c(a){return o.call(a)}return Ut=c,Ut}var Wt,ys;function Pn(){if(ys)return Wt;ys=1;var s=As(),o=Un(),c=Wn(),a="[object Null]",S="[object Undefined]",m=s?s.toStringTag:void 0;function d(g){return g==null?g===void 0?S:a:m&&m in Object(g)?o(g):c(g)}return Wt=d,Wt}var Pt,js;function $n(){if(js)return Pt;js=1;function s(o){return o!=null&&typeof o=="object"}return Pt=s,Pt}var $t,vs;function Ln(){if(vs)return $t;vs=1;var s=Pn(),o=$n(),c="[object Symbol]";function a(S){return typeof S=="symbol"||o(S)&&s(S)==c}return $t=a,$t}var Lt,Ss;function Hn(){if(Ss)return Lt;Ss=1;var s=qn(),o=Ns(),c=Ln(),a=NaN,S=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,d=/^0o[0-7]+$/i,g=parseInt;function F(b){if(typeof b=="number")return b;if(c(b))return a;if(o(b)){var I=typeof b.valueOf=="function"?b.valueOf():b;b=o(I)?I+"":I}if(typeof b!="string")return b===0?b:+b;b=s(b);var O=m.test(b);return O||d.test(b)?g(b.slice(2),O?2:8):S.test(b)?a:+b}return Lt=F,Lt}var Ht,Cs;function Vn(){if(Cs)return Ht;Cs=1;var s=Ns(),o=Mn(),c=Hn(),a="Expected a function",S=Math.max,m=Math.min;function d(g,F,b){var I,O,G,U,M,j,A=0,_=!1,B=!1,$=!0;if(typeof g!="function")throw new TypeError(a);F=c(F)||0,s(b)&&(_=!!b.leading,B="maxWait"in b,G=B?S(c(b.maxWait)||0,F):G,$="trailing"in b?!!b.trailing:$);function K(y){var v=I,D=O;return I=O=void 0,A=y,U=g.apply(D,v),U}function L(y){return A=y,M=setTimeout(V,F),_?K(y):U}function ie(y){var v=y-j,D=y-A,re=F-v;return B?m(re,G-D):re}function H(y){var v=y-j,D=y-A;return j===void 0||v>=F||v<0||B&&D>=G}function V(){var y=o();if(H(y))return Y(y);M=setTimeout(V,ie(y))}function Y(y){return M=void 0,$&&I?K(y):(I=O=void 0,U)}function x(){M!==void 0&&clearTimeout(M),A=0,I=j=O=M=void 0}function C(){return M===void 0?U:Y(o())}function E(){var y=o(),v=H(y);if(I=arguments,O=this,j=y,v){if(M===void 0)return L(j);if(B)return clearTimeout(M),M=setTimeout(V,F),K(j)}return M===void 0&&(M=setTimeout(V,F)),U}return E.cancel=x,E.flush=C,E}return Ht=d,Ht}var Yn=Vn();const Gn=Fe(Yn);var Ze={},Ts;function Zn(){if(Ts)return Ze;Ts=1;var s=De();Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.default=void 0;var o=s(Oe()),c=Re();return Ze.default=(0,o.default)([(0,c.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,c.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),Ze}var Qn=Zn();const Jn=Fe(Qn);var Qe={},Fs;function Kn(){if(Fs)return Qe;Fs=1;var s=De();Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.default=void 0;var o=s(Oe()),c=Re();return Qe.default=(0,o.default)((0,c.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),Qe}var Xn=Kn();const ei=Fe(Xn);var Je={},ws;function ti(){if(ws)return Je;ws=1;var s=De();Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var o=s(Oe()),c=Re();return Je.default=(0,o.default)((0,c.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Je}var si=ti();const ni=Fe(si);var Ke={},ks;function ii(){if(ks)return Ke;ks=1;var s=De();Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var o=s(Oe()),c=Re();return Ke.default=(0,o.default)([(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,c.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Ke}var ri=ii();const oi=Fe(ri),_e=i.forwardRef(({path:s,initialImages:o=[],onImagesUpdated:c,onDelete:a,isOwnDesign:S},m)=>{const[d,g]=i.useState(o.map(R=>({...R,deleted:!1}))),[F,b]=i.useState(!1),[I,O]=i.useState(0),[G,U]=i.useState(!1),[M,j]=i.useState(null),[A,_]=i.useState(1),[B,$]=i.useState(!1),[K,L]=i.useState(!1),[ie,H]=i.useState(""),[V,Y]=i.useState("info"),x=i.useRef(null);i.useEffect(()=>{console.log("Initial images received:",o),g(o.map(R=>({...R,deleted:!!R.deleted})))},[o]);const C=async R=>{const w=Array.from(R.target.files||[]);b(!0);const z={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},Q=w.map(async(W,N)=>{let P=W;W.size>1024*1024&&(P=await En(W,z),H("Your image was compressed before uploading due to file size larger than 1 MB."),Y("info"),L(!0));const ne=`${new Date().getTime()}-${P.name}`,Ae=Pe(),ue=$e(Ae,`${s}/${ne}`),Z=zs(ue,P);return new Promise((ge,jt)=>{Z.on("state_changed",xe=>{const qe=xe.bytesTransferred/xe.totalBytes*100;O(qe)},xe=>{console.error("Upload failed:",xe),jt(xe)},()=>{_s(Z.snapshot.ref).then(xe=>{ge({url:xe,path:ue.fullPath,title:""})})})})});Promise.all(Q).then(W=>{const N=[...d,...W];g(N),c&&c(N),H("Images uploaded successfully."),Y("success"),L(!0),b(!1),O(0),x.current&&(x.current.value="")}).catch(W=>{console.error("Error uploading images: ",W),H("Failed to upload images."),Y("error"),L(!0),b(!1),O(0)})},E=R=>{g(w=>{const z=w.map((Q,W)=>W===R?{...Q,deleted:!0}:Q);return c(z),z}),H("Image marked for deletion. Update to permanently delete."),Y("info"),L(!0)},y=async()=>{const R=d.filter(w=>w.deleted);if(console.log("Attempting to delete images:",R),R.length>0){const w=R.map(z=>{const Q=Pe(),W=$e(Q,z.path);return bt(W)});try{await Promise.all(w),a(R),g(z=>z.filter(Q=>!Q.deleted)),H("Deleted images have been permanently removed."),Y("success")}catch(z){console.error("Error committing deletions:",z),H("Failed to commit deletions."),Y("error")}L(!0)}else console.log("No images marked for deletion.")},v=R=>{$(!B),j(R)};i.useEffect(()=>{const R=()=>{const w=!!document.fullscreenElement;$(w)};return document.addEventListener("fullscreenchange",R),()=>document.removeEventListener("fullscreenchange",R)},[]);const D=(R,w)=>{w!=="clickaway"&&L(!1)},re=i.useCallback(Gn((R,w)=>{setTimeout(()=>{g(z=>{const Q=z.map((W,N)=>N===R?{...W,title:w}:W);return c&&c(Q),Q})},0)},30),[c]);return i.useImperativeHandle(m,()=>({commitDeletions:y})),e.jsxs("div",{children:[S&&e.jsx(yt,{title:"Upload Images",children:e.jsxs(de,{variant:"outlined",component:"label",startIcon:e.jsx(oi,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",e.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:C,disabled:F,ref:x,accept:"image/*"})]})}),F&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Uploading... ",Math.round(I),"%"]}),e.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:e.jsx("div",{style:{height:"20px",width:`${I}%`,backgroundColor:"green"}})})]}),d.filter(R=>!R.deleted).map((R,w)=>e.jsxs("div",{children:[e.jsx("img",{src:R.url,alt:`Uploaded design ${w}`,onClick:()=>{U(!0),j(w)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),S&&e.jsx(pe,{onClick:()=>E(w),children:e.jsx(lt,{})}),e.jsx("textarea",{value:R.title,onChange:z=>re(w,z.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},w)),e.jsx(Be,{open:G,onClose:()=>U(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:M!==null&&e.jsxs(Ee,{children:[e.jsx("div",{style:{textAlign:"center"},children:e.jsx("img",{src:d[M].url,alt:`Zoomed Design ${M}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${A})`,transition:"transform 0.2s ease-out"}})}),e.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[e.jsx(pe,{onClick:()=>_(A*1.2),children:e.jsx(Jn,{})}),e.jsx(pe,{onClick:()=>_(A/1.2),style:{marginLeft:"10px"},children:e.jsx(ei,{})}),e.jsx(pe,{onClick:()=>v(M),style:{marginLeft:"10px"},children:e.jsx(ni,{})}),B&&e.jsx(pe,{onClick:()=>v(M),style:{position:"absolute",top:20,right:20},children:e.jsx(On,{})})]})]})}),e.jsx(Ne,{open:K,autoHideDuration:6e3,onClose:D,children:e.jsx(Me,{onClose:D,severity:V,sx:{width:"100%"},children:ie})})]})});_e.displayName="ImageUpload";const Se=({onChange:s,initialValue:o})=>{const[c,a]=i.useState(Ot.sanitize(o||"")),S=i.useRef(!1),m=i.useRef(null),[d,g]=i.useState("");i.useEffect(()=>{S.current?a(Ot.sanitize(o||"")):S.current=!0},[o]);const F=(j,A,_,B)=>{const $=Ot.sanitize(j);a($),s($)},b=j=>{if(!m.current){console.warn("Editor not initialized");return}const A=m.current.getEditor(),_=A.getSelection();if(_)A.insertText(_.index,j),A.setSelection(_.index+j.length);else{const B=A.getText().length;A.insertText(B,j),A.setSelection(B+j.length)}g(""),A.focus()},I=j=>{b(j.target.value)},O=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],G=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"],U={toolbar:[[{header:[1,2,3,!1]}],["bold","italic"],[{list:"ordered"},{list:"bullet"}],["blockquote",{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},M=["header","bold","italic","list","blockquote","indent","link"];return e.jsxs("div",{children:[e.jsxs(ae,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginBottom:2},children:[e.jsx(jn,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),e.jsx(ds,{variant:"standard",sx:{m:1,minWidth:40},children:e.jsxs(Yt,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:I,displayEmpty:!0,children:[e.jsx(it,{value:"",disabled:!0,children:"Math"}),G.map(j=>e.jsx(it,{value:j,children:j},j))]})}),e.jsx(ds,{variant:"standard",sx:{m:1,minWidth:40},children:e.jsxs(Yt,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:I,displayEmpty:!0,children:[e.jsx(it,{value:"",disabled:!0,children:"Greek"}),O.map(j=>e.jsx(it,{value:j,children:j},j))]})})]}),e.jsx(zn,{ref:m,value:c,onChange:F,modules:U,formats:M,theme:"snow",placeholder:"Start writing...",style:{backgroundColor:"white",borderRadius:"4px",minHeight:"200px"}})]})};var Xe={},Is;function ai(){if(Is)return Xe;Is=1;var s=De();Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.default=void 0;var o=s(Oe()),c=Re();return Xe.default=(0,o.default)((0,c.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Xe}var li=ai();const Gt=Fe(li);var et={},Ds;function di(){if(Ds)return et;Ds=1;var s=De();Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var o=s(Oe()),c=Re();return et.default=(0,o.default)((0,c.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),et}var ci=di();const ui=Fe(ci);var tt={},Rs;function fi(){if(Rs)return tt;Rs=1;var s=De();Object.defineProperty(tt,"__esModule",{value:!0}),tt.default=void 0;var o=s(Oe()),c=Re();return tt.default=(0,o.default)((0,c.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),tt}var hi=fi();const mi=Fe(hi),He=({path:s,initialFiles:o,onFilesChange:c,isOwnDesign:a})=>{const[S,m]=i.useState(o.map(x=>({...x,deleted:!!x.deleted}))),[d,g]=i.useState(!1),[F,b]=i.useState(0),[I,O]=i.useState({}),[G,U]=i.useState(!1),[M,j]=i.useState(""),[A,_]=i.useState("info"),B=i.useRef(null);i.useEffect(()=>{console.log("Initial files received:",o),m(o.map(x=>({...x,deleted:!!x.deleted})))},[o]),i.useEffect(()=>()=>{O({})},[]);const $=x=>{console.log("Updating files with",x),c(x),m(x)},K=async x=>{if(!x.target.files)return;const E=Array.from(x.target.files).filter(v=>v.size>5242880?(j("File size should not exceed 5 MB"),_("error"),U(!0),!1):!0);g(!0);const y=E.map(v=>{const D=new Date().getTime(),re=`${D}-${v.name}`,R=Pe(),w=$e(R,`${s}/${re}`),z=zs(w,v);return new Promise((Q,W)=>{z.on("state_changed",N=>{const P=N.bytesTransferred/N.totalBytes*100;b(P)},N=>{console.error("Upload failed:",N),W(N)},()=>{_s(z.snapshot.ref).then(N=>{Q({id:D.toString(),url:N,name:v.name,path:w.fullPath})})})})});Promise.all(y).then(v=>{const D=[...S.filter(re=>!re.deleted),...v];$(D),j("Files uploaded successfully."),_("success"),U(!0),g(!1),b(0),B.current&&(B.current.value="")}).catch(v=>{console.error("Error uploading files: ",v),j("Failed to upload files."),_("error"),U(!0),g(!1),b(0)})},L=x=>{const C=S.map(E=>E.id===x?{...E,deleted:!0}:E);$(C),j("File marked for deletion. Update to permanently delete."),_("info"),U(!0)},ie=x=>{O(C=>{var E;return{...C,[x]:((E=S.find(y=>y.id===x))==null?void 0:E.name)||""}}),console.log("editStates after handleEditClick:",I)},H=x=>{m(C=>{const E=C.map(y=>y.id===x&&I[x]!==void 0?{...y,name:I[x]}:y);return c(E),E}),O(C=>{const E={...C};return delete E[x],E}),j("File name updated successfully."),_("info"),U(!0)},V=(x,C)=>{O(E=>({...E,[x]:C}))},Y=(x,C)=>{C!=="clickaway"&&U(!1)};return e.jsxs("div",{children:[a&&e.jsx(yt,{title:"Upload Files",children:e.jsxs(de,{variant:"outlined",component:"label",startIcon:e.jsx(mi,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",e.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:K,disabled:d,ref:B})]})}),d&&e.jsx("div",{children:e.jsxs("p",{children:["Uploading... ",Math.round(F),"%"]})}),e.jsx(vn,{children:S.map(x=>e.jsxs(Sn,{style:{opacity:x.deleted?.5:1},children:[e.jsx(Cn,{children:e.jsx(ui,{})}),typeof I[x.id]=="string"?e.jsx(at,{variant:"outlined",size:"small",value:I[x.id],onChange:C=>V(x.id,C.target.value),onKeyPress:C=>C.key==="Enter"&&H(x.id),fullWidth:!0}):e.jsx(Tn,{primary:x.name,secondary:e.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),a&&(typeof I[x.id]=="string"?e.jsx(pe,{onClick:()=>H(x.id),edge:"end","aria-label":"save",children:e.jsx(Gt,{})}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{onClick:()=>ie(x.id),edge:"end","aria-label":"edit",children:e.jsx(Bs,{})}),e.jsx(pe,{onClick:()=>L(x.id),edge:"end","aria-label":"delete",children:e.jsx(lt,{})})]}))]},x.id))}),e.jsx(Ne,{open:G,autoHideDuration:6e3,onClose:Y,children:e.jsx(Me,{onClose:Y,severity:A,sx:{width:"100%"},children:M})})]})},gi=({designs:s,setDesigns:o,setIsAdding:c,getDesigns:a,onReturnToDashboard:S})=>{const{userDetails:m}=ut(),d=Zt(),g=Qt(d.breakpoints.down("md")),F=Object.entries((m==null?void 0:m.classes)||{}).map(([w,z])=>({id:w,number:z.number,title:z.title,isCourseAdmin:z.isCourseAdmin}));console.log("Add Design loaded");const[b,I]=i.useState(""),[O,G]=i.useState(""),[U,M]=i.useState(""),[j,A]=i.useState([]),[_,B]=i.useState([]),$=i.useMemo(()=>j,[j]),[K,L]=i.useState(!1),[ie,H]=i.useState(""),[V,Y]=i.useState("info"),[x,C]=i.useState(!1),[E,y]=i.useState("");console.log("Adding New Design from user:",m);const v=i.useRef(null),D=()=>{C(!1)},re=(w,z)=>{z!=="clickaway"&&L(!1)};i.useEffect(()=>{if(m!=null&&m.classes){const w=Object.keys(m.classes)[0];G(w||"")}},[m==null?void 0:m.classes]);const R=async w=>{var N;if(w.preventDefault(),console.log("Files to be saved:",_),!m||!m.uid){console.error("User object is undefined or missing UID."),y("You must be signed in to add a design."),C(!0);return}if(!b){y("All fields are required."),C(!0);return}await((N=v.current)==null?void 0:N.commitDeletions());const z=j.filter(P=>!P.deleted),Q=_.filter(P=>!P.deleted).map(P=>({id:P.id,url:P.url,name:P.name,path:P.path})),W={title:U,description:b,course:O,dateCreated:dt(),dateModified:dt(),images:z,files:Q,userId:m.uid};try{const P=await Kt(le(q,"designs"),W),J={...W,id:P.id};o([...s,J]),H(`${U} has been Added.`),Y("success"),L(!0),M(""),I(""),A([]),B([]),setTimeout(()=>{c(!1),a()},1e3)}catch(P){console.log(P),y("There was an issue adding your design."),C(!0)}};return e.jsxs(ae,{sx:{p:g?k[3]:k[6],backgroundColor:p.background.primary,minHeight:"100vh"},children:[e.jsxs(ae,{sx:{mb:k[6]},children:[e.jsx(de,{variant:"text",onClick:S,sx:{fontFamily:h.fontFamily.secondary,fontSize:g?h.fontSize.base:h.fontSize.lg,color:p.primary[600],textTransform:"none",fontWeight:h.fontWeight.medium,mb:k[4],"&:hover":{backgroundColor:p.primary[100],color:p.primary[700]},transition:ot.transitions.fast},children:"← All Designs"}),e.jsxs(rt,{sx:{p:g?k[4]:k[6],backgroundColor:p.primary[50],borderRadius:me["2xl"],border:`1px solid ${p.primary[200]}`,boxShadow:ye.sm},children:[e.jsx(je,{variant:"h2",sx:{fontFamily:h.fontFamily.display,fontSize:g?h.fontSize["3xl"]:h.fontSize["5xl"],fontWeight:h.fontWeight.bold,color:p.primary[700],lineHeight:h.lineHeight.tight,mb:k[2]},children:"Create New Design"}),e.jsx(je,{variant:"body1",sx:{fontFamily:h.fontFamily.primary,fontSize:g?h.fontSize.base:h.fontSize.lg,color:p.text.secondary,lineHeight:h.lineHeight.relaxed},children:"Design and document your laboratory experiments and research projects"})]})]}),e.jsx(rt,{sx:{p:g?k[4]:k[6],backgroundColor:p.background.elevated,borderRadius:me["2xl"],border:`1px solid ${p.neutral[200]}`,boxShadow:ye.lg},children:e.jsxs("form",{onSubmit:R,children:[e.jsx(ae,{sx:{mb:k[5]},children:e.jsx(at,{id:"title",label:"Design Title",value:U,onChange:w=>M(w.target.value),fullWidth:!0,required:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:me.lg,fontFamily:h.fontFamily.primary,fontSize:h.fontSize.base},"& .MuiInputLabel-root":{fontFamily:h.fontFamily.secondary,fontSize:h.fontSize.base,fontWeight:h.fontWeight.medium}}})}),e.jsx(ae,{sx:{mb:k[5]},children:e.jsx(_n,{value:O,onChange:G,courses:F,label:"Course",placeholder:"Select a course",helperText:"Choose the course this design belongs to",required:!0,disabled:!(m!=null&&m.classes)||Object.keys(m.classes).length===0,showNumber:!0,showTitle:!0,showAdminBadge:!1})}),e.jsxs(ae,{sx:{mb:k[5]},children:[e.jsx(je,{variant:"h5",sx:{fontFamily:h.fontFamily.display,fontSize:h.fontSize.xl,fontWeight:h.fontWeight.semibold,color:p.text.primary,mb:k[3]},children:"Design Description"}),e.jsxs(rt,{sx:{p:k[4],backgroundColor:p.background.secondary,borderRadius:me.lg,border:`1px solid ${p.neutral[200]}`,mb:k[3]},children:[e.jsx(je,{variant:"body2",sx:{fontFamily:h.fontFamily.primary,fontSize:h.fontSize.sm,color:p.text.secondary,mb:k[2],fontWeight:h.fontWeight.medium},children:"Please include the following elements in your description:"}),e.jsxs(ae,{component:"ul",sx:{pl:k[4],m:0,"& li":{fontFamily:h.fontFamily.primary,fontSize:h.fontSize.sm,color:p.text.secondary,mb:k[1]}},children:[e.jsx("li",{children:"Objective: What is the goal for this design?"}),e.jsx("li",{children:"Rationale: Why is this new design being done?"}),e.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),e.jsx("li",{children:"Functional Modification: What is being done to this target?"}),e.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]})]}),e.jsx(Se,{onChange:I,initialValue:b})]}),e.jsx(Fn,{sx:{my:k[5]}}),e.jsxs(ae,{sx:{mb:k[5]},children:[e.jsx(je,{variant:"h5",sx:{fontFamily:h.fontFamily.display,fontSize:h.fontSize.xl,fontWeight:h.fontWeight.semibold,color:p.text.primary,mb:k[3]},children:"Attachments"}),e.jsx(_e,{ref:v,path:"designs/images",initialImages:$,onImagesUpdated:A,onDelete:w=>A(j.filter(z=>!w.includes(z))),isOwnDesign:!0}),e.jsx(ae,{sx:{mt:k[4]},children:e.jsx(He,{path:"designs/files",initialFiles:_,onFilesChange:B,isOwnDesign:!0})})]}),e.jsxs(ae,{sx:{display:"flex",justifyContent:"flex-end",gap:k[3],mt:k[6],flexDirection:g?"column":"row"},children:[e.jsx(de,{onClick:()=>c(!1),variant:"outlined",sx:{fontFamily:h.fontFamily.display,fontSize:h.fontSize.lg,fontWeight:h.fontWeight.semibold,textTransform:"none",px:k[6],py:k[3],borderRadius:me.xl,borderColor:p.error,color:p.error,"&:hover":{borderColor:p.error,backgroundColor:p.error+"10",boxShadow:ye.md},transition:ot.transitions.fast},children:"Cancel"}),e.jsx(de,{type:"submit",variant:"contained",sx:{fontFamily:h.fontFamily.display,fontSize:h.fontSize.lg,fontWeight:h.fontWeight.semibold,textTransform:"none",px:k[6],py:k[3],backgroundColor:p.primary[500],borderRadius:me.xl,boxShadow:ye.md,"&:hover":{backgroundColor:p.primary[600],boxShadow:ye.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"},transition:ot.transitions.fast},children:"Create Design"})]})]})}),e.jsxs(Be,{open:x,onClose:D,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",PaperProps:{sx:{borderRadius:me["2xl"],boxShadow:ye.xl}},children:[e.jsx(Ve,{id:"alert-dialog-title",sx:{fontFamily:h.fontFamily.display,fontSize:h.fontSize.xl,fontWeight:h.fontWeight.semibold,color:p.text.primary},children:"Notification"}),e.jsx(Ee,{children:e.jsx(ct,{id:"alert-dialog-description",sx:{fontFamily:h.fontFamily.primary,fontSize:h.fontSize.base,color:p.text.secondary},children:E})}),e.jsx(Ye,{children:e.jsx(de,{onClick:D,autoFocus:!0,sx:{fontFamily:h.fontFamily.display,fontSize:h.fontSize.base,fontWeight:h.fontWeight.medium,textTransform:"none",borderRadius:me.lg},children:"Ok"})})]}),e.jsx(Ne,{open:K,autoHideDuration:1e3,onClose:re,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Me,{onClose:re,severity:V,sx:{width:"100%",borderRadius:me.lg,fontFamily:h.fontFamily.primary,fontSize:h.fontSize.base},children:ie})})]})},pi=({designId:s,setIsAddingBuild:o,refreshBuilds:c})=>{const[a,S]=i.useState(""),[m,d]=i.useState(""),[g,F]=i.useState([]),[b,I]=i.useState([]),{userDetails:O}=ut(),G=C=>{F(C)},U=C=>{I(C)};console.log("AddBuild loaded");const[M,j]=i.useState(!1),[A,_]=i.useState(""),[B,$]=i.useState(!1),[K,L]=i.useState(""),[ie,H]=i.useState("info");console.log("Adding New Build by user:",O);const V=()=>{j(!1)},Y=(C,E)=>{E!=="clickaway"&&$(!1)},x=async C=>{if(C.preventDefault(),!O||!O.uid){console.error("UserDetails object is undefined or missing UID."),_("You must be signed in to add a build."),j(!0);return}if(!m){_("Build description is required."),j(!0);return}const E=g.filter(v=>!v.deleted),y=b.filter(v=>!v.deleted).map(v=>({id:v.id,url:v.url,name:v.name,path:v.path}));try{const v=await Kt(le(q,"builds"),{title:a,description:m,design_ID:s,dateCreated:dt(),userId:O.uid,images:E,files:y});console.log("Build added with ID: ",v.id),console.log("Added New Build by user:",O),L("Your build has been successfully added."),H("success"),$(!0),setTimeout(()=>{S(""),d(""),F([]),I([]),o(!1),c()},1e3)}catch(v){if(console.error("Error adding build: ",v),v instanceof Error){let D=`Failed to add the build. ${v.message}`;v.message==="permission-denied"&&(D="You do not have permission to perform this operation."),L(D),H("error"),$(!0)}else L("Failed to add the build. Please try again later."),H("error"),$(!0)}};return e.jsxs("div",{className:"small-container",children:[e.jsxs("form",{onSubmit:x,children:[e.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),e.jsx("input",{id:"buildTitle",type:"text",value:a,onChange:C=>S(C.target.value),style:{width:"100%",marginBottom:"20px"}}),e.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),e.jsx(Se,{onChange:d,initialValue:m})," ",e.jsx(_e,{path:`builds/${s}/images`,initialImages:g,onImagesUpdated:G,onDelete:C=>F(E=>E.filter(y=>!C.includes(y))),isOwnDesign:!0}),e.jsx(He,{path:`builds/${s}/files`,initialFiles:b,onFilesChange:U,isOwnDesign:!0}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx("input",{type:"submit",value:"Save"}),e.jsx("button",{style:{marginLeft:"12px"},onClick:()=>o(!1),className:"button muted-button",children:"Cancel"})]})]}),e.jsxs(Be,{open:M,onClose:V,children:[e.jsx(Ve,{children:"Notification"}),e.jsx(Ee,{children:e.jsx(ct,{children:A})}),e.jsx(Ye,{children:e.jsx(de,{onClick:V,children:"OK"})})]}),e.jsx(Ne,{open:B,autoHideDuration:6e3,onClose:Y,children:e.jsx(Me,{onClose:Y,severity:ie,sx:{width:"100%"},children:K})})]})},xi=({designId:s,buildId:o,refreshTests:c,setAddingTestIdForBuild:a})=>{const[S,m]=i.useState(""),[d,g]=i.useState(""),[F,b]=i.useState(""),[I,O]=i.useState(""),[G,U]=i.useState([]),[M,j]=i.useState([]),{userDetails:A}=ut();console.log("AddTest loaded");const[_,B]=i.useState(!1),[$,K]=i.useState(""),[L,ie]=i.useState(!1),[H,V]=i.useState(""),[Y,x]=i.useState("info"),C=y=>{j(y)},E=async()=>{if(!d){K("Test description cannot be empty!"),B(!0);return}const y=G.filter(D=>!D.deleted),v=M.filter(D=>!D.deleted).map(D=>({id:D.id,url:D.url,name:D.name,path:D.path}));try{await Kt(le(q,"tests"),{title:S,build_ID:o,design_ID:s,dateCreated:dt(),description:d,results:F,conclusions:I,userId:A==null?void 0:A.uid,images:y,files:v}),setTimeout(()=>{c(o),m(""),g(""),b(""),O(""),U([]),j([]),a(!1)},1e3),V("Test added successfully"),x("success"),ie(!0)}catch(D){console.error("Error adding test: ",D),V("Failed to add the test"),x("error"),ie(!0)}};return e.jsxs("div",{children:[e.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),e.jsx("input",{id:"testTitle",type:"text",value:S,onChange:y=>m(y.target.value),style:{width:"100%",marginBottom:"20px"}}),e.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),e.jsx(Se,{onChange:g,initialValue:d}),e.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),e.jsx(Se,{onChange:b,initialValue:F}),e.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),e.jsx(Se,{onChange:O,initialValue:I}),e.jsx(_e,{path:`tests/${o}/images`,initialImages:G,onImagesUpdated:y=>{U(y)},onDelete:y=>U(v=>v.filter(D=>!y.includes(D))),isOwnDesign:!0}),e.jsx(He,{path:`tests/${o}/files`,initialFiles:M,onFilesChange:C,isOwnDesign:!0}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:E,children:"Save"}),e.jsx("button",{style:{marginLeft:"12px"},onClick:()=>a(!1),className:"button muted-button",children:"Cancel"})]}),e.jsxs(Be,{open:_,onClose:()=>B(!1),children:[e.jsx(Ve,{children:"Notification"}),e.jsx(Ee,{children:e.jsx(ct,{children:$})}),e.jsx(Ye,{children:e.jsx(de,{onClick:()=>B(!1),children:"OK"})})]}),e.jsx(Ne,{open:L,autoHideDuration:6e3,onClose:()=>ie(!1),children:e.jsx(Me,{onClose:()=>ie(!1),severity:Y,sx:{width:"100%"},children:H})})]})};var st={},Os;function bi(){if(Os)return st;Os=1;var s=De();Object.defineProperty(st,"__esModule",{value:!0}),st.default=void 0;var o=s(Oe()),c=Re();return st.default=(0,o.default)((0,c.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),st}var yi=bi();const Vt=Fe(yi),nt=s=>s&&s instanceof Jt?s.toDate().toLocaleString():"",ji=({selectedDesign:s,setIsEditing:o,onReturnToDashboard:c})=>{const{userDetails:a,loading:S}=ut(),m=s.id,d=s.userId===(a==null?void 0:a.uid);console.log("Edit page loaded"),console.log("Design ID:",m),console.log("Editing Design by user:",a);const[g,F]=i.useState(""),[b,I]=i.useState(s.description),[O,G]=i.useState(s.course||""),[U,M]=i.useState(nt(s.dateCreated)),[j,A]=i.useState(nt(s.dateModified)),[_,B]=i.useState([]),[$,K]=i.useState([]),L=i.useRef(null),[ie,H]=i.useState(!1),[V,Y]=i.useState([]),[x,C]=i.useState({}),[E,y]=i.useState({}),[v,D]=i.useState({}),re=i.useRef(null),[R,w]=i.useState({}),[z,Q]=i.useState({}),[W,N]=i.useState({}),[P,J]=i.useState(!1),[ne,Ae]=i.useState({}),[ue,Z]=i.useState({}),[ge,jt]=i.useState({}),[xe,qe]=i.useState({}),[ft,ht]=i.useState({}),vt=i.useRef(null),[Xt,qs]=i.useState({}),[St,Ct]=i.useState({}),[es,ts]=i.useState({}),[Us,ze]=i.useState(!1),[Ws,mt]=i.useState(""),[Ps,Tt]=i.useState(()=>()=>{}),[$s,X]=i.useState(!1),[Ls,ee]=i.useState(""),[Hs,te]=i.useState("info"),[gt,ve]=i.useState({design:!1,builds:!1,tests:!1}),Vs=async t=>{if(t.preventDefault(),!b){mt("All fields are required."),ze(!0);return}console.log("About to check image deletions",L.current),console.log(L.current),console.log(_.some(l=>l.deleted)),L.current&&_.some(l=>l.deleted)&&(console.log("Committing deletions"),await L.current.commitDeletions());const r=_.filter(l=>!l.deleted);$.some(l=>l.deleted)&&await Zs();const n=$.filter(l=>!l.deleted),f={title:g,description:b,course:O,dateModified:dt(),images:r.map(l=>({url:l.url,title:l.title,path:l.path})),files:n.map(l=>({id:l.id,url:l.url,name:l.name,path:l.path})),userId:a.uid};try{await ke(oe(q,"designs",m),f,{merge:!0}),ee("Your design has been updated."),te("success"),X(!0);const l=Jt.now();A(nt(l))}catch(l){console.error("Error updating design:",l),ee("There was an issue updating your design."),te("error"),X(!0)}ve(l=>({...l,design:!1}))};i.useEffect(()=>{s&&(I(s.description||""),F(s.title||""),G(s.course||""),(async()=>{const r=oe(q,"designs",m),n=await Bn(r);if(n.exists()){const f=n.data();console.log("Fetched images:",f.images),console.log("Fetched files:",f.files),B(f.images||[]),K(f.files||[]),M(nt(f.dateCreated)),A(nt(f.dateModified))}})())},[s,m]);const Ys=t=>{const r=_.filter(f=>!t.some(l=>l.path===f.path));console.log("Remaining images after deletion:",r),B(r);const n=r.map(f=>({url:f.url,title:f.title,path:f.path}));ke(oe(q,"designs",m),{images:n},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(f=>console.error("Failed to update Firestore:",f))},Gs=t=>{JSON.stringify(_)!==JSON.stringify(t)&&(B(t),console.log("Updated images received:",t))},Zs=async()=>{const t=$.filter(r=>r.deleted);if(console.log("Files to delete:",t),t.length>0){const r=Pe(),n=t.map(f=>{const l=$e(r,f.path);return bt(l)});try{await Promise.all(n),console.log("Files deleted successfully");const f=$.filter(l=>!l.deleted);K(f),await Rt(oe(q,"designs",s.id),{files:f.map(l=>({id:l.id,url:l.url,name:l.name,path:l.path}))}),ee("Deleted files have been permanently removed."),te("success"),X(!0)}catch(f){console.error("Failed to delete files: ",f),ee("Failed to delete files."),te("error"),X(!0)}}},Qs=async t=>{var l,T;try{await sn(t)}catch(u){console.error("Error deleting files:",u),ee("Failed to delete build files."),te("error"),X(!0)}const r=((l=E[t])==null?void 0:l.filter(u=>!u.deleted).map(({url:u,path:ce,title:Ce})=>({url:u,path:ce,title:Ce})))||[],n=((T=v[t])==null?void 0:T.filter(u=>!u.deleted).map(u=>({id:u.id,url:u.url,name:u.name,path:u.path})))||[],f={};r.length>0&&(f.images=r),n.length>0&&(f.files=n),x[t]!==void 0&&(f.description=x[t]);try{const u=oe(q,"builds",t);await ke(u,f,{merge:!0}),ee("Your build has been updated."),te("success"),X(!0),pt(),ve(ce=>({...ce,builds:!1}))}catch(u){console.error("Error updating build:",u),ee("Failed to update build."),te("error"),X(!0)}},Js=(t,r)=>{Q(n=>({...n,[t]:r}))},Ks=(t,r)=>{C(n=>({...n,[t]:r})),ve(n=>({...n,builds:!0}))},ss=async t=>{const r=z[t];try{const n=oe(q,"builds",t);await ke(n,{title:r},{merge:!0}),Q(f=>{const l={...f};return delete l[t],l}),pt()}catch(n){console.error("Failed to save build title:",n)}},pt=async()=>{if(!a){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",a==null?void 0:a.uid),console.log("Selected design ID for query:",s==null?void 0:s.id);let t;a.isAdmin?t=fe(le(q,"builds"),se("design_ID","==",m),be("dateCreated")):t=fe(le(q,"builds"),se("design_ID","==",m),se("userId","==",a.uid),be("dateCreated")),console.log("Builds query details:",JSON.stringify(t,null,2));const r=await Ie(t);console.log("Builds snapshot details:",JSON.stringify(r.docs.map(f=>f.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",r.docs.length);const n=r.docs.map(f=>(console.log("Build doc path: ",f.ref.path),{id:f.id,...f.data()}));Y(n),console.log("New builds state after refresh:",n)}catch(t){console.error("Error refreshing builds:",t),t.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",t):console.error("An unexpected error occurred when trying to refresh builds:",t)}},Xs=(t,r)=>{const n=oe(q,"builds",t),f=E[t].filter(T=>!r.some(u=>u.path===T.path));y(T=>({...T,[t]:f}));const l=f.map(T=>({url:T.url,title:T.title,path:T.path}));ke(n,{images:l},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ee("Build Image deletions updated."),te("success")}).catch(T=>{console.error("Failed to update build images in Firestore:",T),ee("Failed to update build image deletions."),te("error")}),X(!0)},en=async t=>{const r=fe(le(q,"tests"),se("build_ID","==",t),se("userId","==",a.uid)),n=await Ie(r);for(const f of n.docs)await Le(oe(q,"tests",f.id));await Le(oe(q,"builds",t)),await pt(),ee("Build and its tests (if any) deleted successfully."),te("success"),X(!0)},tn=t=>{mt("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Tt(()=>()=>en(t)),ze(!0)},ns=(t,r)=>{y(n=>({...n,[t]:r}))},is=(t,r)=>{D(n=>({...n,[t]:r}))},sn=async t=>{var n;const r=((n=v[t])==null?void 0:n.filter(f=>f.deleted))||[];if(console.log("Build files to delete:",r),r.length>0){const f=Pe(),l=r.map(T=>{const u=$e(f,T.path);return bt(u)});try{await Promise.all(l),console.log("Build files deleted successfully");const T=v[t].filter(u=>!u.deleted);D(u=>({...u,[t]:T})),await Rt(oe(q,"builds",t),{files:T.map(u=>({id:u.id,url:u.url,name:u.name,path:u.path}))}),console.log("Firestore successfully updated to remove deleted files"),ee("Deleted build files have been permanently removed."),te("success"),X(!0)}catch(T){console.error("Failed to delete build files: ",T),ee("Failed to delete build files."),te("error"),X(!0)}}},nn=async(t,r)=>{var T;try{await cn(t)}catch(u){console.error("Error deleting files:",u),ee("Failed to delete build files."),te("error"),X(!0)}const n={},f=xe[t].filter(u=>!u.deleted).map(({url:u,path:ce,title:Ce})=>({url:u,path:ce,title:Ce})),l=((T=ft[t])==null?void 0:T.filter(u=>!u.deleted).map(u=>({id:u.id,url:u.url,name:u.name,path:u.path})))||[];ne[t]!==void 0&&(n.description=ne[t]),ue[t]!==void 0&&(n.results=ue[t]),ge[t]!==void 0&&(n.conclusions=ge[t]),n.images=f,n.files=l;try{const u=oe(q,"tests",t);await ke(u,n,{merge:!0}),ee("Your test has been updated."),te("success"),X(!0),xt(r)}catch(u){console.error(`Error updating test ID: ${t}:`,u),ee("There was an issue updating your test."),te("error"),X(!0)}},rn=(t,r)=>{Ct(n=>({...n,[t]:r}))},rs=async(t,r)=>{const n=St[t],f=oe(q,"tests",t);await ke(f,{title:n},{merge:!0}),Ct(l=>{const T={...l};return delete T[t],T}),xt(r)},on=(t,r)=>{console.log(`Updating description for test ID ${t}:`,r),Ae(n=>({...n,[t]:r})),ve(n=>({...n,tests:!0}))},an=(t,r)=>{console.log(`Updating results for test ID ${t}:`,r),Z(n=>({...n,[t]:r})),ve(n=>({...n,tests:!0}))},ln=(t,r)=>{jt(n=>({...n,[t]:r})),ve(n=>({...n,tests:!0}))};i.useEffect(()=>{!S&&a&&(async()=>{if(!a)return;let r;a.isAdmin?r=fe(le(q,"builds"),se("design_ID","==",m),be("dateCreated")):r=fe(le(q,"builds"),se("design_ID","==",m),se("userId","==",a.uid),be("dateCreated"));const n=await Ie(r),f=[],l={},T={};for(const u of n.docs){const ce=u.data(),Ce=u.id;f.push({id:Ce,...ce,images:ce.images||[],files:ce.files||[]}),T[Ce]=!0;let Ft;a.isAdmin?Ft=fe(le(q,"tests"),se("build_ID","==",Ce),be("dateCreated")):Ft=fe(le(q,"tests"),se("build_ID","==",Ce),se("userId","==",a.uid),be("dateCreated"));const gn=await Ie(Ft),ls=[],wt={},kt={};for(const we of gn.docs){const Te=we.data();ls.push({id:we.id,...Te}),wt[we.id]=Te.images||[],kt[we.id]=Te.files||[]}l[Ce]=ls,qe(we=>{const Te={...we};for(const Ge in wt)Te[Ge]=wt[Ge];return Te}),ht(we=>{const Te={...we};for(const Ge in kt)Te[Ge]=kt[Ge];return Te})}Y(f),N(l),ts(T)})()},[S,a,s.id,m]);const xt=async t=>{if(!a){console.log("User details not loaded yet");return}try{let r;a.isAdmin?r=fe(le(q,"tests"),se("build_ID","==",t),be("dateCreated")):r=fe(le(q,"tests"),se("build_ID","==",t),se("userId","==",a.uid),be("dateCreated"));const f=(await Ie(r)).docs.map(u=>{const ce=u.data();return{id:u.id,...ce,images:ce.images||[],files:ce.files||[]}});N(u=>({...u,[t]:f}));const l={},T={};f.forEach(u=>{l[u.id]=u.images,T[u.id]=u.files}),qe(l),ht(T)}catch(r){console.error("Error fetching tests:",r)}},dn=(t,r)=>{const n=oe(q,"tests",t),f=xe[t].filter(T=>!r.includes(T));qe(T=>({...T,[t]:f}));const l=f.map(({url:T,path:u,title:ce})=>({url:T,path:u,title:ce}));ke(n,{images:l},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ee("Test Image deletions updated."),te("success")}).catch(T=>{console.error("Failed to update test images in Firestore:",T),ee("Failed to update test image deletions."),te("error")}),X(!0)},os=(t,r)=>{qe(n=>({...n,[t]:r}))},as=(t,r)=>{ht(n=>({...n,[t]:r}))},cn=async t=>{var n;const r=((n=ft[t])==null?void 0:n.filter(f=>f.deleted))||[];if(r.length>0){const f=Pe(),l=r.map(T=>{const u=$e(f,T.path);return bt(u)});try{await Promise.all(l);const T=ft[t].filter(u=>!u.deleted);ht(u=>({...u,[t]:T})),await Rt(oe(q,"tests",t),{files:T.map(u=>({id:u.id,url:u.url,name:u.name,path:u.path}))}),ee("Deleted test files have been permanently removed."),te("success"),X(!0)}catch(T){console.error("Failed to delete test files: ",T),ee("Failed to delete test files."),te("error"),X(!0)}}},un=async(t,r)=>{await Le(oe(q,"tests",t)),await xt(r),ee("Test deleted successfully."),te("success"),X(!0)},fn=(t,r)=>{mt("Are you sure you want to delete this test? This action cannot be undone."),Tt(()=>()=>un(t,r)),ze(!0)},hn=t=>{ts(r=>({...r,[t]:!r[t]}))},mn=()=>{const t=Object.entries(gt).filter(([n,f])=>f).map(([n])=>n).join(", ");if(!t.length){c();return}const r=`You have unsaved changes in the following sections: ${t}. Are you sure you want to leave?`;mt(r),Tt(()=>()=>{ve({design:!1,builds:!1,tests:!1}),c()}),ze(!0)};return i.useEffect(()=>{const t=r=>{Object.values(gt).some(f=>f)&&(r.preventDefault(),r.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[gt]),e.jsxs("div",{className:"small-container",children:[e.jsx(de,{variant:"text",onClick:()=>{Object.values(gt).some(r=>r)?mn():c()},className:"profile-button",children:"← All Designs"}),e.jsx("div",{className:"design-record",children:e.jsxs("form",{onSubmit:Vs,children:[e.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[e.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),e.jsx("input",{id:"title",type:"text",name:"title",value:g,onChange:t=>{F(t.target.value),ve(r=>({...r,design:!0}))},style:{width:"100%"}})]}),e.jsxs("div",{style:{flexGrow:2},children:[e.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),e.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:U||"",readOnly:!0,style:{width:"100%"}})]}),e.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[e.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),e.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:j||"",readOnly:!0,style:{width:"100%"}})]})]}),e.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),e.jsx(Yt,{id:"course",value:O,onChange:t=>{G(t.target.value),ve(r=>({...r,design:!0}))},fullWidth:!0,children:(a!=null&&a.classes?Object.entries(a.classes):[]).map(([t,r])=>e.jsx(it,{value:t,children:`${r.number} - ${r.title}`},t))}),e.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Objective: What is the goal for this design?"}),e.jsx("li",{children:"Rationale: Why is this new design being done?"}),e.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),e.jsx("li",{children:"Functional Modification: What is being done to this target?"}),e.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),e.jsx(Se,{initialValue:b,onChange:t=>{I(t),ve(r=>({...r,design:!0}))}}),e.jsx(_e,{ref:L,path:`designs/${s.id}/images`,initialImages:_,onImagesUpdated:Gs,onDelete:Ys,isOwnDesign:d}),e.jsx(He,{path:`designs/${s.id}/files`,initialFiles:$,onFilesChange:K,isOwnDesign:d}),d&&e.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[e.jsx("input",{type:"submit",value:"Update"}),e.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>o(!1),children:"Cancel"})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex-space-between",children:[e.jsx("h2",{className:"buildsHeader",children:"Builds"}),d&&e.jsxs("button",{className:"button muted-button",onClick:()=>{H(!0),setTimeout(()=>{re.current&&re.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[e.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),V.map((t,r)=>e.jsxs("div",{className:"build-record",children:[e.jsxs("div",{className:"flex-space-between align-items-center",children:[e.jsx("div",{children:z[t.id]!==void 0?e.jsx(at,{variant:"outlined",size:"small",fullWidth:!0,value:z[t.id],onChange:n=>Js(t.id,n.target.value),onBlur:()=>ss(t.id),autoFocus:!0,InputProps:{endAdornment:e.jsx(pe,{onClick:()=>ss(t.id),size:"small",children:e.jsx(Gt,{})})}}):e.jsx("div",{className:"buildTitle",onClick:()=>Q(n=>({...n,[t.id]:t.title||`Build ${r+1}`})),style:{cursor:"pointer"},children:t.title||`Build ${r+1}`})}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>w(n=>({...n,[t.id]:!n[t.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:R[t.id]?e.jsx(Vt,{}):e.jsx(Dt,{})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>tn(t.id),children:e.jsx(lt,{})}),e.jsxs("button",{className:"button muted-button",onClick:()=>{J(t.id),setTimeout(()=>{vt.current&&vt.current.scrollIntoView({behavior:"smooth"})},100)},children:[e.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),R[t.id]&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{initialValue:x[t.id]||t.description,onChange:n=>{Ks(t.id,n)}}),e.jsx(_e,{path:`builds/${t.id}/images`,initialImages:t.images,onImagesUpdated:n=>ns(t.id,n),onDelete:n=>Xs(t.id,n),isOwnDesign:d}),e.jsx(He,{path:`builds/${t.id}/files`,initialFiles:t.files,onFilesChange:n=>is(t.id,n),isOwnDesign:d}),d&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>Qs(t.id),children:"Update"})}),e.jsx("div",{children:W[t.id]&&W[t.id].length>0&&e.jsx("button",{onClick:()=>hn(t.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:es[t.id]?e.jsxs(e.Fragment,{children:[e.jsx(Dt,{style:{marginRight:"8px"}}),"Tests"]}):e.jsxs(e.Fragment,{children:[e.jsx(Vt,{style:{marginRight:"8px"}}),"Tests"]})})}),!es[t.id]&&W[t.id]&&W[t.id].map((n,f)=>e.jsxs("div",{className:"test-record",children:[e.jsxs("div",{className:"flex-space-between align-items-center",children:[e.jsx("div",{children:St[n.id]!==void 0?e.jsx(at,{variant:"outlined",size:"small",fullWidth:!0,value:St[n.id],onChange:l=>rn(n.id,l.target.value),onBlur:()=>rs(n.id,t.id),autoFocus:!0,InputProps:{endAdornment:e.jsx(pe,{onClick:()=>rs(n.id,t.id),size:"small",children:e.jsx(Gt,{})})}}):e.jsx("div",{className:"testTitle",onClick:()=>Ct(l=>({...l,[n.id]:n.title||`Test ${f+1}`})),style:{cursor:"pointer"},children:n.title||`Test ${f+1}`})}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>qs(l=>({...l,[n.id]:!l[n.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:Xt[n.id]?e.jsx(Vt,{}):e.jsx(Dt,{})}),d&&e.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>fn(n.id,t.id),children:e.jsx(lt,{})})]})]}),Xt[n.id]&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"testTitles",children:"Description"}),e.jsx(Se,{initialValue:ne[n.id]||n.description,onChange:l=>{on(n.id,l)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"testTitles",children:"Results"}),e.jsx(Se,{initialValue:ue[n.id]||n.results,onChange:l=>{an(n.id,l)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"testTitles",children:"Conclusions"}),e.jsx(Se,{initialValue:ge[n.id]||n.conclusions,onChange:l=>{ln(n.id,l)}})]}),e.jsxs("div",{children:[e.jsx(_e,{path:`tests/${n.id}/images`,initialImages:xe[n.id]||[],onImagesUpdated:l=>os(n.id,l),onDelete:l=>dn(n.id,l),isOwnDesign:d}),e.jsx(He,{path:`tests/${n.id}/files`,initialFiles:ft[n.id]||[],onFilesChange:l=>as(n.id,l),isOwnDesign:d})]}),d&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>nn(n.id,t.id),children:"Update"})})]})]},n.id))]}),P===t.id&&e.jsxs("div",{className:"new-test-record",ref:vt,children:[e.jsx("h3",{className:"newTestHeader",children:"New Test"}),e.jsx(xi,{designId:s.id,buildId:t.id,refreshTests:()=>xt(t.id),setAddingTestIdForBuild:J,onImagesUpdated:n=>os(t.id,n),onFilesChange:n=>as(t.id,n)})]})]},t.id)),e.jsx("div",{children:ie&&e.jsxs("div",{className:"new-build-record",ref:re,children:[e.jsx("h3",{className:"newBuildHeader",children:"New Build"}),e.jsx(pi,{designId:s.id,setIsAddingBuild:H,refreshBuilds:pt,onImagesUpdated:t=>ns("temp-build-id",t),onFilesChange:t=>is("temp-build-id",t)})]})})]}),e.jsxs(Be,{open:Us,onClose:()=>ze(!1),children:[e.jsx(Ve,{children:"Confirmation Required"}),e.jsx(Ee,{children:e.jsx(ct,{children:Ws})}),e.jsxs(Ye,{children:[e.jsx(de,{onClick:()=>ze(!1),children:"Cancel"}),e.jsx(de,{onClick:()=>{Ps(),ze(!1)},autoFocus:!0,children:"Confirm"})]})]}),e.jsx(Ne,{open:$s,autoHideDuration:6e3,onClose:()=>X(!1),children:e.jsx(Me,{onClose:()=>X(!1),severity:Hs,sx:{width:"100%"},children:Ls})})]})},We=(s,o,c)=>s[o]??c,vi=()=>{const{userDetails:s,loading:o}=ut(),c=Zt(),a=Qt(c.breakpoints.down("md"));console.log("Dashboard loaded");const[S,m]=i.useState([]),[d,g]=i.useState([]),[F,b]=i.useState([]),[I,O]=i.useState(null),[G,U]=i.useState(!1),[M,j]=i.useState(!1),[A,_]=i.useState(!1),[B,$]=i.useState(""),[K,L]=i.useState(""),[ie,H]=i.useState(!1),[V,Y]=i.useState(null),[x,C]=i.useState(!1),[E,y]=i.useState(""),[v,D]=i.useState("info"),re=()=>{j(!1),U(!1),O(null),R()},R=i.useCallback(async()=>{if(!s)return;let N;const P=[],J=[],ne=[];if(s.isSuperAdmin)N=fe(le(q,"designs"),be("dateCreated","desc"));else if(s.isAdmin){const ue=s.classes?Object.keys(s.classes):[];if(ue.length>0)N=fe(le(q,"designs"),se("course","in",ue),be("dateCreated","desc"));else{g([]),b([]);return}}else N=fe(le(q,"designs"),se("userId","==",s.uid),be("dateCreated","desc"));(await Ie(N)).forEach(ue=>{const Z=ue.data(),ge={id:ue.id,title:We(Z,"title",""),description:We(Z,"description",""),course:We(Z,"course",""),dateCreated:Z.dateCreated,dateModified:Z.dateModified,userId:We(Z,"userId",""),images:We(Z,"images",[]),files:We(Z,"files",[])};s.isSuperAdmin?Z.userId===s.uid?P.push(ge):Z.userId!==s.uid&&Z.course&&Z.isAdmin?J.push(ge):Z.userId!==s.uid&&!Z.isAdmin&&ne.push(ge):s.isAdmin?Z.userId===s.uid?J.push(ge):ne.push(ge):Z.userId===s.uid&&ne.push(ge)}),m(P),g(J),b(ne)},[s]);i.useEffect(()=>{!o&&s&&R()},[s,o,R]);const w=N=>{const P=[...S,...d,...F].find(J=>J.id===N);O(P||null),j(!0)},z=N=>{Y(N),$("Are you sure you want to delete this design? This action cannot be undone."),_(!0)},Q=async()=>{if(V)if(K!==(s==null?void 0:s.uid))y("User ID confirmation failed. Enter the correct User ID."),D("error"),C(!0);else try{const N=fe(le(q,"builds"),se("design_ID","==",V),se("userId","==",s.uid)),P=await Ie(N);for(const J of P.docs){const ne=J.id,Ae=fe(le(q,"tests"),se("build_ID","==",ne),se("userId","==",s.uid)),ue=await Ie(Ae);for(const Z of ue.docs)await Le(oe(q,"tests",Z.id));await Le(oe(q,"builds",ne))}await Le(oe(q,"designs",V)),m(J=>J.filter(ne=>ne.id!==V)),g(J=>J.filter(ne=>ne.id!==V)),b(J=>J.filter(ne=>ne.id!==V)),y("Your design and its associated builds and tests have been deleted."),D("success"),C(!0)}catch(N){console.error("Error deleting design, builds, and tests: ",N),y("There was an issue deleting your design and its associated builds and tests."),D("error"),C(!0)}finally{L(""),H(!1),Y(null)}},W=(N,P,J)=>e.jsx(ae,{sx:{mb:k[4],mt:k[6]},children:e.jsx(rt,{sx:{p:a?k[3]:k[4],backgroundColor:p.background.secondary,borderRadius:me.lg,border:`1px solid ${p.neutral[200]}`,boxShadow:ye.sm},children:e.jsxs(ae,{sx:{display:"flex",alignItems:"center",gap:k[3],flexDirection:a?"column":"row",textAlign:a?"center":"left"},children:[e.jsx(je,{variant:"h4",sx:{fontFamily:h.fontFamily.display,fontSize:a?h.fontSize.xl:h.fontSize["2xl"],fontWeight:h.fontWeight.bold,color:p.text.primary},children:N}),e.jsx(kn,{label:`${P} ${P===1?"Design":"Designs"}`,size:"small",sx:{backgroundColor:J,color:p.text.inverse,fontFamily:h.fontFamily.secondary,fontWeight:h.fontWeight.semibold,fontSize:h.fontSize.sm}})]})})});return e.jsxs(ae,{sx:{p:a?k[3]:k[6],backgroundColor:p.background.primary,minHeight:"100vh"},children:[!G&&!M&&e.jsxs(e.Fragment,{children:[e.jsx(Es,{setIsAdding:U}),(s==null?void 0:s.isSuperAdmin)&&e.jsxs(e.Fragment,{children:[W("My Designs",S.length,p.primary[500]),e.jsx(Ue,{designs:S,handleEdit:w,handleDelete:z,isAdmin:!0,userDetails:s,showUserIdColumn:!0}),W("Educator Designs",d.length,p.secondary[500]),e.jsx(Ue,{designs:d,handleEdit:w,handleDelete:z,isAdmin:!0,userDetails:s,showUserIdColumn:!0}),W("Student Designs",F.length,p.info),e.jsx(Ue,{designs:F,handleEdit:w,handleDelete:z,isAdmin:!1,userDetails:s,showUserIdColumn:!0})]}),(s==null?void 0:s.isAdmin)&&!s.isSuperAdmin&&e.jsxs(e.Fragment,{children:[W("My Educator Designs",d.length,p.secondary[500]),e.jsx(Ue,{designs:d,handleEdit:w,handleDelete:z,isAdmin:!0,userDetails:s,showUserIdColumn:!0}),W("Student Designs",F.length,p.info),e.jsx(Ue,{designs:F,handleEdit:w,handleDelete:z,isAdmin:!1,userDetails:s,showUserIdColumn:!0})]}),!(s!=null&&s.isAdmin)&&!(s!=null&&s.isSuperAdmin)&&e.jsxs(e.Fragment,{children:[W("My Designs",F.length,p.primary[500]),e.jsx(Ue,{designs:F,handleEdit:w,handleDelete:z,isAdmin:!1,userDetails:s,showUserIdColumn:!1})]})]}),G&&e.jsx(gi,{designs:S.concat(d),setDesigns:g,setIsAdding:U,getDesigns:R,onReturnToDashboard:re}),M&&e.jsx(ji,{designs:S.concat(d),selectedDesign:I,setDesigns:g,setIsEditing:j,getDesigns:R,onReturnToDashboard:re}),e.jsxs(Be,{open:A,onClose:()=>_(!1),PaperProps:{style:{minWidth:500}},children:[e.jsx(Ve,{children:"Confirm Deletion"}),e.jsx(Ee,{children:e.jsx(ct,{children:B})}),e.jsxs(Ye,{children:[e.jsx(de,{onClick:()=>_(!1),children:"No, cancel"}),e.jsx(de,{onClick:()=>{H(!0),_(!1)},color:"primary",children:"Yes, delete it"})]})]}),e.jsxs(Be,{open:ie,onClose:()=>H(!1),PaperProps:{style:{minWidth:500}},children:[e.jsx(Ve,{children:"Confirm Your User ID"}),e.jsx(Ee,{children:e.jsx(at,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:K,onChange:N=>L(N.target.value)})}),e.jsxs(Ye,{children:[e.jsx(de,{onClick:()=>H(!1),children:"No, cancel"}),e.jsx(de,{onClick:Q,color:"primary",children:"Confirm"})]})]}),e.jsx(Ne,{open:x,autoHideDuration:6e3,onClose:()=>C(!1),children:e.jsx(Me,{onClose:()=>C(!1),severity:v,sx:{width:"100%"},children:E})})]})},Di=wn.memo(vi);export{Di as default};
