var l=Object.defineProperty;var d=(a,o,t)=>o in a?l(a,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[o]=t;var n=(a,o,t)=>d(a,typeof o!="symbol"?o+"":o,t);import{r as p,j as r,P as h,B as i,aO as u,T as s,A as g,aA as m,aB as y,bS as x,a6 as I,aD as f,a as c,b as E}from"./ui-CvbxGYbq.js";import"./vendor-BFl3bqVE.js";class S extends p.Component{constructor(t){super(t);n(this,"logErrorToService",(t,e)=>{this.state.errorId,t.message,t.stack,e.componentStack,new Date().toISOString()});n(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:""}),this.props.onReset&&this.props.onReset()});n(this,"getErrorSeverity",t=>{const e=t.message.toLowerCase();return e.includes("network")||e.includes("api key")||e.includes("rate limit")?"warning":"error"});n(this,"getErrorSuggestion",t=>{const e=t.message.toLowerCase();return e.includes("leaked")||e.includes("reported as leaked")?"Your API key has been reported as leaked by Google. Generate a new key from Google AI Studio (https://ai.google.dev), update your environment variables, and restart your development server. See docs/API_KEY_SECURITY.md for long-term security solutions.":e.includes("403")||e.includes("access denied")?"API access denied. Your API key may be invalid, expired, or restricted. Get a new key from https://ai.google.dev and update your VITE_GEMINI_MATERIAL_API_KEY or VITE_GEMINI_API_KEY environment variable.":e.includes("api key")||e.includes("api_key_invalid")?"Invalid API key configuration. Please check that VITE_GEMINI_MATERIAL_API_KEY or VITE_GEMINI_API_KEY is correctly set in your .env file. Get a valid key from https://ai.google.dev":e.includes("network")||e.includes("fetch")?"Please check your internet connection and try again.":e.includes("rate limit")||e.includes("quota")?"You have exceeded the API rate limit or quota. Please wait a few minutes before trying again, or consider using a separate API key for material imports.":e.includes("file")||e.includes("upload")?"Please try uploading a different file or check that your file is not corrupted.":"Please try refreshing the page or contact support if the issue persists."});this.state={hasError:!1,error:null,errorInfo:null,errorId:""}}static getDerivedStateFromError(t){const e=`MI_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return{hasError:!0,error:t,errorId:e}}componentDidCatch(t,e){console.error("Material Import Error Boundary caught an error:",t,e),this.setState({errorInfo:e}),this.props.onError&&this.props.onError(t,e),this.logErrorToService(t,e)}render(){if(this.state.hasError&&this.state.error){if(this.props.fallback)return this.props.fallback;const t=this.getErrorSeverity(this.state.error),e=this.getErrorSuggestion(this.state.error);return r.jsxs(h,{elevation:3,sx:{p:3,m:2,bgcolor:"error.50",border:"1px solid",borderColor:"error.200"},children:[r.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[r.jsx(u,{color:"error",sx:{fontSize:32}}),r.jsxs(i,{children:[r.jsx(s,{variant:"h6",color:"error.main",children:"Material Import Error"}),r.jsx(s,{variant:"body2",color:"text.secondary",children:"Something went wrong while processing your material"})]})]}),r.jsxs(g,{severity:t,sx:{mb:2},children:[r.jsxs(s,{variant:"body2",children:[r.jsx("strong",{children:"Error:"})," ",this.state.error.message]}),r.jsxs(s,{variant:"body2",sx:{mt:1},children:[r.jsx("strong",{children:"Suggestion:"})," ",e]})]}),r.jsxs(m,{sx:{mb:2},children:[r.jsx(y,{expandIcon:r.jsx(I,{}),children:r.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(x,{fontSize:"small"}),r.jsxs(s,{variant:"body2",children:["Technical Details (Error ID: ",this.state.errorId,")"]})]})}),r.jsxs(f,{children:[r.jsx(s,{variant:"caption",component:"pre",sx:{bgcolor:"grey.100",p:1,borderRadius:1,overflow:"auto",whiteSpace:"pre-wrap",fontFamily:"monospace"},children:this.state.error.stack}),this.state.errorInfo&&r.jsxs(s,{variant:"caption",component:"pre",sx:{bgcolor:"grey.100",p:1,mt:1,borderRadius:1,overflow:"auto",whiteSpace:"pre-wrap",fontFamily:"monospace"},children:["Component Stack:",this.state.errorInfo.componentStack]})]})]}),r.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[r.jsx(c,{variant:"contained",onClick:this.handleRetry,startIcon:r.jsx(E,{}),color:"primary",children:"Try Again"}),r.jsx(c,{variant:"outlined",onClick:()=>window.location.reload(),color:"secondary",children:"Reload Page"})]}),r.jsxs(s,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"center",mt:2},children:["If this error persists, please take a screenshot and contact support with Error ID: ",this.state.errorId]})]})}return this.props.children}}export{S as default};
