import{r as q,p as Un,q as Rn,j as i,B as Fe,a as ke,i as Lr,P as Nt,k as Wr,l as $r,m as dn,n as ze,o as Vr,T as Ve,t as Kt,I as Pe,c as ot,d as at,V as ht,X as gt,aa as mt,A as pt,w as Qr,F as Hn,S as kn,M as Bt,a0 as Gr,a1 as Yr,b8 as Zr,y as qt,a2 as Kr,D as Xr,W as Ct,Y as Wt,Z as At,f as Jr,v as es}from"./ui-CHyTFYZQ.js";import{P as ts,a as $e,c as K,d as Pt,b as Be,s as ne,t as Z,C as ns,f as rs,g as Ht,r as lt,h as ss,R as is,u as $t,i as os,j as se,V as cn}from"./index-DLDjD9cF.js";import{l as _n,k as vt,r as jt,p as Yt,z as fr,n as hr,q as En,_ as Te,h as Lt,e as Ce,f as as,R as Me,x as We,v as xe,t as it,m as st,i as un,y as St}from"./firebase-CTJJwFJC.js";import{E as gr}from"./Edit-xeKUPSem.js";import{g as tt}from"./vendor-BFl3bqVE.js";import fn from"./purify.es-CQJ0hv7W.js";const mr=q.memo(({setIsAdding:g})=>{console.log("Header loaded");const F=Un(),U=Rn(F.breakpoints.down("md"));return i.jsxs(Fe,{children:[i.jsx(ts,{title:"Laboratory Notebook",subtitle:"Manage your lab experiments, designs, and research projects"}),i.jsx(Fe,{sx:{display:"flex",justifyContent:"flex-start"},children:i.jsx(ke,{variant:"contained",onClick:()=>g(!0),sx:{fontFamily:Z.fontFamily.display,fontSize:U?Z.fontSize.lg:Z.fontSize.xl,fontWeight:Z.fontWeight.semibold,textTransform:"none",px:U?ne[4]:ne[6],py:ne[3],backgroundColor:K.primary[500],borderRadius:Be.xl,boxShadow:$e.md,transition:Pt.transitions.fast,"&:hover":{backgroundColor:K.primary[600],boxShadow:$e.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"}},children:"+ Create New Design"})})]})});mr.displayName="Header";const bt=({designs:g,handleEdit:F,handleDelete:U,userDetails:l,showUserIdColumn:e})=>{const t=a=>a?a instanceof _n?a.toDate().toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):a instanceof Date?a.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A":"N/A";return i.jsx(Lr,{component:Nt,sx:{borderRadius:Be["2xl"],boxShadow:$e.lg,border:`1px solid ${K.neutral[200]}`,overflow:"hidden"},children:i.jsxs(Wr,{sx:{"& .MuiTableCell-root":{fontSize:Z.fontSize.base,fontFamily:Z.fontFamily.primary,borderBottom:`1px solid ${K.neutral[200]}`},"& .MuiTableCell-head":{fontSize:Z.fontSize.lg,fontFamily:Z.fontFamily.display,fontWeight:Z.fontWeight.semibold,backgroundColor:K.primary[500],color:K.text.inverse,textTransform:"uppercase",letterSpacing:"0.5px"},"& .MuiTableRow-root:hover":{backgroundColor:K.primary[25]}},children:[i.jsx($r,{children:i.jsxs(dn,{sx:{height:"64px"},children:[i.jsx(ze,{sx:{width:e?"30%":"35%"},children:"Title"}),i.jsx(ze,{sx:{width:"20%"},children:"Course"}),e&&i.jsx(ze,{sx:{width:"15%"},children:"User"}),i.jsx(ze,{sx:{width:"15%"},children:"Created"}),i.jsx(ze,{sx:{width:"15%"},children:"Modified"}),i.jsx(ze,{sx:{width:"15%",textAlign:"center"},children:"Actions"})]})}),i.jsx(Vr,{children:g&&g.length>0?g.map(a=>{const o=a.userId===(l==null?void 0:l.uid),x=a.course&&(l!=null&&l.classes)&&l.classes[a.course]?l.classes[a.course]:null;return i.jsxs(dn,{sx:{height:"72px",transition:Pt.transitions.fast,"&:hover":{backgroundColor:K.primary[25],transform:"translateY(-1px)",boxShadow:$e.sm}},children:[i.jsx(ze,{children:i.jsx(Fe,{onClick:()=>F(a.id),sx:{display:"inline-flex",alignItems:"center",backgroundColor:K.primary[100],border:`1px solid ${K.primary[200]}`,borderRadius:Be.lg,padding:`${ne[2]} ${ne[3]}`,cursor:"pointer",transition:"all 0.2s ease",maxWidth:"100%","&:hover":{backgroundColor:K.primary[200],borderColor:K.primary[300],transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},"&:active":{transform:"translateY(0)"}},children:i.jsx(Ve,{variant:"body1",sx:{fontFamily:Z.fontFamily.secondary,fontSize:Z.fontSize.base,fontWeight:Z.fontWeight.semibold,color:K.primary[700],textDecoration:"none",userSelect:"none","&:hover":{textDecoration:"underline"}},children:a.title})})}),i.jsx(ze,{children:x?i.jsx(ns,{courseId:a.course,courseNumber:x.number,courseTitle:x.title,variant:"link",maxTitleLength:30}):i.jsx(Ve,{variant:"body2",sx:{color:K.text.disabled,fontStyle:"italic"},children:"No Course"})}),e&&i.jsx(ze,{children:i.jsx(rs,{userId:a.userId,userType:"student"})}),i.jsx(ze,{children:i.jsx(Ve,{variant:"body2",sx:{color:K.text.secondary,fontSize:Z.fontSize.sm},children:t(a.dateCreated)})}),i.jsx(ze,{children:i.jsx(Ve,{variant:"body2",sx:{color:K.text.secondary,fontSize:Z.fontSize.sm},children:t(a.dateModified)})}),i.jsx(ze,{sx:{textAlign:"center"},children:i.jsxs(Fe,{sx:{display:"flex",justifyContent:"center",gap:ne[1]},children:[i.jsx(Kt,{title:o?"Edit Design":"Cannot edit others' designs",children:i.jsx("span",{children:i.jsx(Pe,{size:"small",onClick:()=>o&&F(a.id),disabled:!o,sx:{color:o?K.primary[600]:K.text.disabled,"&:hover":{backgroundColor:o?K.primary[100]:"transparent"}},children:i.jsx(gr,{fontSize:"small"})})})}),i.jsx(Kt,{title:o?"Delete Design":"Cannot delete others' designs",children:i.jsx("span",{children:i.jsx(Pe,{size:"small",onClick:()=>o&&U(a.id),disabled:!o,sx:{color:o?K.error:K.text.disabled,"&:hover":{backgroundColor:o?K.error+"20":"transparent"}},children:i.jsx(Ht,{fontSize:"small"})})})})]})})]},a.id)}):i.jsx(dn,{children:i.jsx(ze,{colSpan:e?6:5,sx:{textAlign:"center",py:ne[8],color:K.text.secondary,fontStyle:"italic"},children:i.jsx(Ve,{variant:"body1",sx:{fontFamily:Z.fontFamily.secondary,fontSize:Z.fontSize.base,fontWeight:Z.fontWeight.medium},children:"No designs found. Create your first design to get started!"})})})})]})})};function ls(g,F){return F.forEach(function(U){U&&typeof U!="string"&&!Array.isArray(U)&&Object.keys(U).forEach(function(l){if(l!=="default"&&!(l in g)){var e=Object.getOwnPropertyDescriptor(U,l);Object.defineProperty(g,l,e.get?e:{enumerable:!0,get:function(){return U[l]}})}})}),Object.freeze(g)}function pr(g,F){return new Promise(function(U,l){let e;return ds(g).then(function(t){try{return e=t,U(new Blob([F.slice(0,2),e,F.slice(2)],{type:"image/jpeg"}))}catch(a){return l(a)}},l)})}const ds=g=>new Promise((F,U)=>{const l=new FileReader;l.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let a=0;if(t.getUint16(a)!==65496)return U("not a valid JPEG");for(a+=2;;){const o=t.getUint16(a);if(o===65498)break;const x=t.getUint16(a+2);if(o===65505&&t.getUint32(a+4)===1165519206){const y=a+10;let n;switch(t.getUint16(y)){case 18761:n=!0;break;case 19789:n=!1;break;default:return U("TIFF header contains invalid endian")}if(t.getUint16(y+2,n)!==42)return U("TIFF header contains invalid version");const s=t.getUint32(y+4,n),r=y+s+2+12*t.getUint16(y+s,n);for(let c=y+s+2;c<r;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return U("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return U("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return F(e.slice(a,a+2+x))}a+=2+x}return F(new Blob)}),l.readAsArrayBuffer(g)});var Xt={},cs={get exports(){return Xt},set exports(g){Xt=g}};(function(g){var F,U,l={};cs.exports=l,l.parse=function(e,t){for(var a=l.bin.readUshort,o=l.bin.readUint,x=0,y={},n=new Uint8Array(e),s=n.length-4;o(n,s)!=101010256;)s--;x=s,x+=4;var r=a(n,x+=4);a(n,x+=2);var c=o(n,x+=2),m=o(n,x+=4);x+=4,x=m;for(var A=0;A<r;A++){o(n,x),x+=4,x+=4,x+=4,o(n,x+=4),c=o(n,x+=4);var D=o(n,x+=4),S=a(n,x+=4),z=a(n,x+2),M=a(n,x+4);x+=6;var R=o(n,x+=8);x+=4,x+=S+z+M,l._readLocal(n,R,y,c,D,t)}return y},l._readLocal=function(e,t,a,o,x,y){var n=l.bin.readUshort,s=l.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var c=n(e,t+=8),m=n(e,t+=2);t+=2;var A=l.bin.readUTF8(e,t,c);if(t+=c,t+=m,y)a[A]={size:x,csize:o};else{var D=new Uint8Array(e.buffer,t);if(r==0)a[A]=new Uint8Array(D.buffer.slice(t,t+o));else{if(r!=8)throw"unknown compression method: "+r;var S=new Uint8Array(x);l.inflateRaw(D,S),a[A]=S}}},l.inflateRaw=function(e,t){return l.F.inflate(e,t)},l.inflate=function(e,t){return e[0],e[1],l.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},l.deflate=function(e,t){t==null&&(t={level:6});var a=0,o=new Uint8Array(50+Math.floor(1.1*e.length));o[a]=120,o[a+1]=156,a+=2,a=l.F.deflateRaw(e,o,a,t.level);var x=l.adler(e,0,e.length);return o[a+0]=x>>>24&255,o[a+1]=x>>>16&255,o[a+2]=x>>>8&255,o[a+3]=x>>>0&255,new Uint8Array(o.buffer,0,a+4)},l.deflateRaw=function(e,t){t==null&&(t={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),o=l.F.deflateRaw(e,a,o,t.level);return new Uint8Array(a.buffer,0,o)},l.encode=function(e,t){t==null&&(t=!1);var a=0,o=l.bin.writeUint,x=l.bin.writeUshort,y={};for(var n in e){var s=!l._noNeed(n)&&!t,r=e[n],c=l.crc.crc(r,0,r.length);y[n]={cpr:s,usize:r.length,crc:c,file:s?l.deflateRaw(r):r}}for(var n in y)a+=y[n].file.length+30+46+2*l.bin.sizeUTF8(n);a+=22;var m=new Uint8Array(a),A=0,D=[];for(var n in y){var S=y[n];D.push(A),A=l._writeHeader(m,A,n,S,0)}var z=0,M=A;for(var n in y)S=y[n],D.push(A),A=l._writeHeader(m,A,n,S,1,D[z++]);var R=A-M;return o(m,A,101010256),A+=4,x(m,A+=4,z),x(m,A+=2,z),o(m,A+=2,R),o(m,A+=4,M),A+=4,A+=2,m.buffer},l._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},l._writeHeader=function(e,t,a,o,x,y){var n=l.bin.writeUint,s=l.bin.writeUshort,r=o.file;return n(e,t,x==0?67324752:33639248),t+=4,x==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,o.cpr?8:0),n(e,t+=2,0),n(e,t+=4,o.crc),n(e,t+=4,r.length),n(e,t+=4,o.usize),s(e,t+=4,l.bin.sizeUTF8(a)),s(e,t+=2,0),t+=2,x==1&&(t+=2,t+=2,n(e,t+=6,y),t+=4),t+=l.bin.writeUTF8(e,t,a),x==0&&(e.set(r,t),t+=r.length),t},l.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var a=t,o=0;o<8;o++)1&a?a=3988292384^a>>>1:a>>>=1;e[t]=a}return e}(),update:function(e,t,a,o){for(var x=0;x<o;x++)e=l.crc.table[255&(e^t[a+x])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^l.crc.update(4294967295,e,t,a)}},l.adler=function(e,t,a){for(var o=1,x=0,y=t,n=t+a;y<n;){for(var s=Math.min(y+5552,n);y<s;)x+=o+=e[y++];o%=65521,x%=65521}return x<<16|o},l.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255,e[t+2]=a>>16&255,e[t+3]=a>>24&255},readASCII:function(e,t,a){for(var o="",x=0;x<a;x++)o+=String.fromCharCode(e[t+x]);return o},writeASCII:function(e,t,a){for(var o=0;o<a.length;o++)e[t+o]=a.charCodeAt(o)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,a){for(var o,x="",y=0;y<a;y++)x+="%"+l.bin.pad(e[t+y].toString(16));try{o=decodeURIComponent(x)}catch{return l.bin.readASCII(e,t,a)}return o},writeUTF8:function(e,t,a){for(var o=a.length,x=0,y=0;y<o;y++){var n=a.charCodeAt(y);if((4294967168&n)==0)e[t+x]=n,x++;else if((4294965248&n)==0)e[t+x]=192|n>>6,e[t+x+1]=128|n>>0&63,x+=2;else if((4294901760&n)==0)e[t+x]=224|n>>12,e[t+x+1]=128|n>>6&63,e[t+x+2]=128|n>>0&63,x+=3;else{if((4292870144&n)!=0)throw"e";e[t+x]=240|n>>18,e[t+x+1]=128|n>>12&63,e[t+x+2]=128|n>>6&63,e[t+x+3]=128|n>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var t=e.length,a=0,o=0;o<t;o++){var x=e.charCodeAt(o);if((4294967168&x)==0)a++;else if((4294965248&x)==0)a+=2;else if((4294901760&x)==0)a+=3;else{if((4292870144&x)!=0)throw"e";a+=4}}return a}},l.F={},l.F.deflateRaw=function(e,t,a,o){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],y=l.F.U,n=l.F._goodIndex;l.F._hash;var s=l.F._putsE,r=0,c=a<<3,m=0,A=e.length;if(o==0){for(;r<A;)s(t,c,r+(v=Math.min(65535,A-r))==A?1:0),c=l.F._copyExact(e,r,v,t,c+8),r+=v;return c>>>3}var D=y.lits,S=y.strt,z=y.prev,M=0,R=0,B=0,j=0,E=0,f=0;for(A>2&&(S[f=l.F._hash(e,0)]=0),r=0;r<A;r++){if(E=f,r+1<A-2){f=l.F._hash(e,r+1);var u=r+1&32767;z[u]=S[f],S[f]=u}if(m<=r){(M>14e3||R>26697)&&A-r>100&&(m<r&&(D[M]=r-m,M+=2,m=r),c=l.F._writeBlock(r==A-1||m==A?1:0,D,M,j,e,B,r-B,t,c),M=R=j=0,B=r);var p=0;r<A-2&&(p=l.F._bestMatch(e,r,z,E,Math.min(x[2],A-r),x[3]));var v=p>>>16,w=65535&p;if(p!=0){w=65535&p;var C=n(v=p>>>16,y.of0);y.lhst[257+C]++;var b=n(w,y.df0);y.dhst[b]++,j+=y.exb[C]+y.dxb[b],D[M]=v<<23|r-m,D[M+1]=w<<16|C<<8|b,M+=2,m=r+v}else y.lhst[e[r]]++;R++}}for(B==r&&e.length!=0||(m<r&&(D[M]=r-m,M+=2,m=r),c=l.F._writeBlock(1,D,M,j,e,B,r-B,t,c),M=0,R=0,M=R=j=0,B=r);(7&c)!=0;)c++;return c>>>3},l.F._bestMatch=function(e,t,a,o,x,y){var n=32767&t,s=a[n],r=n-s+32768&32767;if(s==n||o!=l.F._hash(e,t-r))return 0;for(var c=0,m=0,A=Math.min(32767,t);r<=A&&--y!=0&&s!=n;){if(c==0||e[t+c]==e[t+c-r]){var D=l.F._howLong(e,t,r);if(D>c){if(m=r,(c=D)>=x)break;r+2<D&&(D=r+2);for(var S=0,z=0;z<D-2;z++){var M=t-r+z+32768&32767,R=M-a[M]+32768&32767;R>S&&(S=R,s=M)}}}r+=(n=s)-(s=a[n])+32768&32767}return c<<16|m},l.F._howLong=function(e,t,a){if(e[t]!=e[t-a]||e[t+1]!=e[t+1-a]||e[t+2]!=e[t+2-a])return 0;var o=t,x=Math.min(e.length,t+258);for(t+=3;t<x&&e[t]==e[t-a];)t++;return t-o},l.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},l.saved=0,l.F._writeBlock=function(e,t,a,o,x,y,n,s,r){var c,m,A,D,S,z,M,R,B,j=l.F.U,E=l.F._putsF,f=l.F._putsE;j.lhst[256]++,m=(c=l.F.getTrees())[0],A=c[1],D=c[2],S=c[3],z=c[4],M=c[5],R=c[6],B=c[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),p=o+l.F.contSize(j.fltree,j.lhst)+l.F.contSize(j.fdtree,j.dhst),v=o+l.F.contSize(j.ltree,j.lhst)+l.F.contSize(j.dtree,j.dhst);v+=14+3*M+l.F.contSize(j.itree,j.ihst)+(2*j.ihst[16]+3*j.ihst[17]+7*j.ihst[18]);for(var w=0;w<286;w++)j.lhst[w]=0;for(w=0;w<30;w++)j.dhst[w]=0;for(w=0;w<19;w++)j.ihst[w]=0;var C=u<p&&u<v?0:p<v?1:2;if(E(s,r,e),E(s,r+1,C),r+=3,C==0){for(;(7&r)!=0;)r++;r=l.F._copyExact(x,y,n,s,r)}else{var b,I;if(C==1&&(b=j.fltree,I=j.fdtree),C==2){l.F.makeCodes(j.ltree,m),l.F.revCodes(j.ltree,m),l.F.makeCodes(j.dtree,A),l.F.revCodes(j.dtree,A),l.F.makeCodes(j.itree,D),l.F.revCodes(j.itree,D),b=j.ltree,I=j.dtree,f(s,r,S-257),f(s,r+=5,z-1),f(s,r+=5,M-4),r+=4;for(var h=0;h<M;h++)f(s,r+3*h,j.itree[1+(j.ordr[h]<<1)]);r+=3*M,r=l.F._codeTiny(R,j.itree,s,r),r=l.F._codeTiny(B,j.itree,s,r)}for(var d=y,_=0;_<a;_+=2){for(var T=t[_],P=T>>>23,V=d+(8388607&T);d<V;)r=l.F._writeLit(x[d++],b,s,r);if(P!=0){var H=t[_+1],$=H>>16,L=H>>8&255,O=255&H;f(s,r=l.F._writeLit(257+L,b,s,r),P-j.of0[L]),r+=j.exb[L],E(s,r=l.F._writeLit(O,I,s,r),$-j.df0[O]),r+=j.dxb[O],d+=P}}r=l.F._writeLit(256,b,s,r)}return r},l.F._copyExact=function(e,t,a,o,x){var y=x>>>3;return o[y]=a,o[y+1]=a>>>8,o[y+2]=255-o[y],o[y+3]=255-o[y+1],y+=4,o.set(new Uint8Array(e.buffer,t,a),y),x+(a+4<<3)},l.F.getTrees=function(){for(var e=l.F.U,t=l.F._hufTree(e.lhst,e.ltree,15),a=l.F._hufTree(e.dhst,e.dtree,15),o=[],x=l.F._lenCodes(e.ltree,o),y=[],n=l.F._lenCodes(e.dtree,y),s=0;s<o.length;s+=2)e.ihst[o[s]]++;for(s=0;s<y.length;s+=2)e.ihst[y[s]]++;for(var r=l.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,a,r,x,n,c,o,y]},l.F.getSecond=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(e[a+1]);return t},l.F.nonZero=function(e){for(var t="",a=0;a<e.length;a+=2)e[a+1]!=0&&(t+=(a>>1)+",");return t},l.F.contSize=function(e,t){for(var a=0,o=0;o<t.length;o++)a+=t[o]*e[1+(o<<1)];return a},l.F._codeTiny=function(e,t,a,o){for(var x=0;x<e.length;x+=2){var y=e[x],n=e[x+1];o=l.F._writeLit(y,t,a,o);var s=y==16?2:y==17?3:7;y>15&&(l.F._putsE(a,o,n,s),o+=s)}return o},l.F._lenCodes=function(e,t){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var o=0;o<a;o+=2){var x=e[o+1],y=o+3<a?e[o+3]:-1,n=o+5<a?e[o+5]:-1,s=o==0?-1:e[o-1];if(x==0&&y==x&&n==x){for(var r=o+5;r+2<a&&e[r+2]==x;)r+=2;(c=Math.min(r+1-o>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),o+=2*c-2}else if(x==s&&y==x&&n==x){for(r=o+5;r+2<a&&e[r+2]==x;)r+=2;var c=Math.min(r+1-o>>>1,6);t.push(16,c-3),o+=2*c-2}else t.push(x,0)}return a>>>1},l.F._hufTree=function(e,t,a){var o=[],x=e.length,y=t.length,n=0;for(n=0;n<y;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<x;n++)e[n]!=0&&o.push({lit:n,f:e[n]});var s=o.length,r=o.slice(0);if(s==0)return 0;if(s==1){var c=o[0].lit;return r=c==0?1:0,t[1+(c<<1)]=1,t[1+(r<<1)]=1,1}o.sort(function(R,B){return R.f-B.f});var m=o[0],A=o[1],D=0,S=1,z=2;for(o[0]={lit:-1,f:m.f+A.f,l:m,r:A,d:0};S!=s-1;)m=D!=S&&(z==s||o[D].f<o[z].f)?o[D++]:o[z++],A=D!=S&&(z==s||o[D].f<o[z].f)?o[D++]:o[z++],o[S++]={lit:-1,f:m.f+A.f,l:m,r:A};var M=l.F.setDepth(o[S-1],0);for(M>a&&(l.F.restrictDepth(r,a,M),M=a),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return M},l.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(l.F.setDepth(e.l,t+1),l.F.setDepth(e.r,t+1))},l.F.restrictDepth=function(e,t,a){var o=0,x=1<<a-t,y=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),o=0;o<e.length&&e[o].d>t;o++){var n=e[o].d;e[o].d=t,y+=x-(1<<a-n)}for(y>>>=a-t;y>0;)(n=e[o].d)<t?(e[o].d++,y-=1<<t-n-1):o++;for(;o>=0;o--)e[o].d==t&&y<0&&(e[o].d--,y++);y!=0&&console.log("debt left")},l.F._goodIndex=function(e,t){var a=0;return t[16|a]<=e&&(a|=16),t[8|a]<=e&&(a|=8),t[4|a]<=e&&(a|=4),t[2|a]<=e&&(a|=2),t[1|a]<=e&&(a|=1),a},l.F._writeLit=function(e,t,a,o){return l.F._putsF(a,o,t[e<<1]),o+t[1+(e<<1)]},l.F.inflate=function(e,t){var a=Uint8Array;if(e[0]==3&&e[1]==0)return t||new a(0);var o=l.F,x=o._bitsF,y=o._bitsE,n=o._decodeTiny,s=o.makeCodes,r=o.codes2map,c=o._get17,m=o.U,A=t==null;A&&(t=new a(e.length>>>2<<3));for(var D,S,z=0,M=0,R=0,B=0,j=0,E=0,f=0,u=0,p=0;z==0;)if(z=x(e,p,1),M=x(e,p+1,2),p+=3,M!=0){if(A&&(t=l.F._check(t,u+(1<<17))),M==1&&(D=m.flmap,S=m.fdmap,E=511,f=31),M==2){R=y(e,p,5)+257,B=y(e,p+5,5)+1,j=y(e,p+10,4)+4,p+=14;for(var v=0;v<38;v+=2)m.itree[v]=0,m.itree[v+1]=0;var w=1;for(v=0;v<j;v++){var C=y(e,p+3*v,3);m.itree[1+(m.ordr[v]<<1)]=C,C>w&&(w=C)}p+=3*j,s(m.itree,w),r(m.itree,w,m.imap),D=m.lmap,S=m.dmap,p=n(m.imap,(1<<w)-1,R+B,e,p,m.ttree);var b=o._copyOut(m.ttree,0,R,m.ltree);E=(1<<b)-1;var I=o._copyOut(m.ttree,R,B,m.dtree);f=(1<<I)-1,s(m.ltree,b),r(m.ltree,b,D),s(m.dtree,I),r(m.dtree,I,S)}for(;;){var h=D[c(e,p)&E];p+=15&h;var d=h>>>4;if(!(d>>>8))t[u++]=d;else{if(d==256)break;var _=u+d-254;if(d>264){var T=m.ldef[d-257];_=u+(T>>>3)+y(e,p,7&T),p+=7&T}var P=S[c(e,p)&f];p+=15&P;var V=P>>>4,H=m.ddef[V],$=(H>>>4)+x(e,p,15&H);for(p+=15&H,A&&(t=l.F._check(t,u+(1<<17)));u<_;)t[u]=t[u++-$],t[u]=t[u++-$],t[u]=t[u++-$],t[u]=t[u++-$];u=_}}}else{(7&p)!=0&&(p+=8-(7&p));var L=4+(p>>>3),O=e[L-4]|e[L-3]<<8;A&&(t=l.F._check(t,u+O)),t.set(new a(e.buffer,e.byteOffset+L,O),u),p=L+O<<3,u+=O}return t.length==u?t:t.slice(0,u)},l.F._check=function(e,t){var a=e.length;if(t<=a)return e;var o=new Uint8Array(Math.max(a<<1,t));return o.set(e,0),o},l.F._decodeTiny=function(e,t,a,o,x,y){for(var n=l.F._bitsE,s=l.F._get17,r=0;r<a;){var c=e[s(o,x)&t];x+=15&c;var m=c>>>4;if(m<=15)y[r]=m,r++;else{var A=0,D=0;m==16?(D=3+n(o,x,2),x+=2,A=y[r-1]):m==17?(D=3+n(o,x,3),x+=3):m==18&&(D=11+n(o,x,7),x+=7);for(var S=r+D;r<S;)y[r]=A,r++}}return x},l.F._copyOut=function(e,t,a,o){for(var x=0,y=0,n=o.length>>>1;y<a;){var s=e[y+t];o[y<<1]=0,o[1+(y<<1)]=s,s>x&&(x=s),y++}for(;y<n;)o[y<<1]=0,o[1+(y<<1)]=0,y++;return x},l.F.makeCodes=function(e,t){for(var a,o,x,y,n=l.F.U,s=e.length,r=n.bl_count,c=0;c<=t;c++)r[c]=0;for(c=1;c<s;c+=2)r[e[c]]++;var m=n.next_code;for(a=0,r[0]=0,o=1;o<=t;o++)a=a+r[o-1]<<1,m[o]=a;for(x=0;x<s;x+=2)(y=e[x+1])!=0&&(e[x]=m[y],m[y]++)},l.F.codes2map=function(e,t,a){for(var o=e.length,x=l.F.U.rev15,y=0;y<o;y+=2)if(e[y+1]!=0)for(var n=y>>1,s=e[y+1],r=n<<4|s,c=t-s,m=e[y]<<c,A=m+(1<<c);m!=A;)a[x[m]>>>15-t]=r,m++},l.F.revCodes=function(e,t){for(var a=l.F.U.rev15,o=15-t,x=0;x<e.length;x+=2){var y=e[x]<<t-e[x+1];e[x]=a[y]>>>o}},l.F._putsE=function(e,t,a){a<<=7&t;var o=t>>>3;e[o]|=a,e[o+1]|=a>>>8},l.F._putsF=function(e,t,a){a<<=7&t;var o=t>>>3;e[o]|=a,e[o+1]|=a>>>8,e[o+2]|=a>>>16},l.F._bitsE=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<a)-1},l.F._bitsF=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<a)-1},l.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},l.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},l.F.U=(F=Uint16Array,U=Uint32Array,{next_code:new F(16),bl_count:new F(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new F(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new U(32),flmap:new F(512),fltree:[],fdmap:new F(32),fdtree:[],lmap:new F(32768),ltree:[],ttree:[],dmap:new F(32768),dtree:[],imap:new F(512),itree:[],rev15:new F(32768),lhst:new U(286),dhst:new U(30),ihst:new U(19),lits:new U(15e3),strt:new F(65536),prev:new F(32768)}),function(){for(var e=l.F.U,t=0;t<32768;t++){var a=t;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[t]=(a>>>16|a<<16)>>>17}function o(x,y,n){for(;y--!=0;)x.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];o(e.fltree,144,8),o(e.fltree,112,9),o(e.fltree,24,7),o(e.fltree,8,8),l.F.makeCodes(e.fltree,9),l.F.codes2map(e.fltree,9,e.flmap),l.F.revCodes(e.fltree,9),o(e.fdtree,32,5),l.F.makeCodes(e.fdtree,5),l.F.codes2map(e.fdtree,5,e.fdmap),l.F.revCodes(e.fdtree,5),o(e.itree,19,0),o(e.ltree,286,0),o(e.dtree,30,0),o(e.ttree,320,0)}()})();var us=ls({__proto__:null,default:Xt},[Xt]);const Le=function(){var g={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let c="";for(let m=0;m<r;m++)c+=String.fromCharCode(n[s+m]);return c},writeASCII(n,s,r){for(let c=0;c<r.length;c++)n[s+c]=r.charCodeAt(c)},readBytes(n,s,r){const c=[];for(let m=0;m<r;m++)c.push(n[s+m]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let c,m="";for(let A=0;A<r;A++)m+=`%${g.pad(n[s+A].toString(16))}`;try{c=decodeURIComponent(m)}catch{return g.readASCII(n,s,r)}return c}};function F(n,s,r,c){const m=s*r,A=t(c),D=Math.ceil(s*A/8),S=new Uint8Array(4*m),z=new Uint32Array(S.buffer),{ctype:M}=c,{depth:R}=c,B=g.readUshort;if(M==6){const T=m<<2;if(R==8)for(var j=0;j<T;j+=4)S[j]=n[j],S[j+1]=n[j+1],S[j+2]=n[j+2],S[j+3]=n[j+3];if(R==16)for(j=0;j<T;j++)S[j]=n[j<<1]}else if(M==2){const T=c.tabs.tRNS;if(T==null){if(R==8)for(j=0;j<m;j++){var E=3*j;z[j]=255<<24|n[E+2]<<16|n[E+1]<<8|n[E]}if(R==16)for(j=0;j<m;j++)E=6*j,z[j]=255<<24|n[E+4]<<16|n[E+2]<<8|n[E]}else{var f=T[0];const P=T[1],V=T[2];if(R==8)for(j=0;j<m;j++){var u=j<<2;E=3*j,z[j]=255<<24|n[E+2]<<16|n[E+1]<<8|n[E],n[E]==f&&n[E+1]==P&&n[E+2]==V&&(S[u+3]=0)}if(R==16)for(j=0;j<m;j++)u=j<<2,E=6*j,z[j]=255<<24|n[E+4]<<16|n[E+2]<<8|n[E],B(n,E)==f&&B(n,E+2)==P&&B(n,E+4)==V&&(S[u+3]=0)}}else if(M==3){const T=c.tabs.PLTE,P=c.tabs.tRNS,V=P?P.length:0;if(R==1)for(var p=0;p<r;p++){var v=p*D,w=p*s;for(j=0;j<s;j++){u=w+j<<2;var C=3*(b=n[v+(j>>3)]>>7-((7&j)<<0)&1);S[u]=T[C],S[u+1]=T[C+1],S[u+2]=T[C+2],S[u+3]=b<V?P[b]:255}}if(R==2)for(p=0;p<r;p++)for(v=p*D,w=p*s,j=0;j<s;j++)u=w+j<<2,C=3*(b=n[v+(j>>2)]>>6-((3&j)<<1)&3),S[u]=T[C],S[u+1]=T[C+1],S[u+2]=T[C+2],S[u+3]=b<V?P[b]:255;if(R==4)for(p=0;p<r;p++)for(v=p*D,w=p*s,j=0;j<s;j++)u=w+j<<2,C=3*(b=n[v+(j>>1)]>>4-((1&j)<<2)&15),S[u]=T[C],S[u+1]=T[C+1],S[u+2]=T[C+2],S[u+3]=b<V?P[b]:255;if(R==8)for(j=0;j<m;j++){var b;u=j<<2,C=3*(b=n[j]),S[u]=T[C],S[u+1]=T[C+1],S[u+2]=T[C+2],S[u+3]=b<V?P[b]:255}}else if(M==4){if(R==8)for(j=0;j<m;j++){u=j<<2;var I=n[h=j<<1];S[u]=I,S[u+1]=I,S[u+2]=I,S[u+3]=n[h+1]}if(R==16)for(j=0;j<m;j++){var h;u=j<<2,I=n[h=j<<2],S[u]=I,S[u+1]=I,S[u+2]=I,S[u+3]=n[h+2]}}else if(M==0)for(f=c.tabs.tRNS?c.tabs.tRNS:-1,p=0;p<r;p++){const T=p*D,P=p*s;if(R==1)for(var d=0;d<s;d++){var _=(I=255*(n[T+(d>>>3)]>>>7-(7&d)&1))==255*f?0:255;z[P+d]=_<<24|I<<16|I<<8|I}else if(R==2)for(d=0;d<s;d++)_=(I=85*(n[T+(d>>>2)]>>>6-((3&d)<<1)&3))==85*f?0:255,z[P+d]=_<<24|I<<16|I<<8|I;else if(R==4)for(d=0;d<s;d++)_=(I=17*(n[T+(d>>>1)]>>>4-((1&d)<<2)&15))==17*f?0:255,z[P+d]=_<<24|I<<16|I<<8|I;else if(R==8)for(d=0;d<s;d++)_=(I=n[T+d])==f?0:255,z[P+d]=_<<24|I<<16|I<<8|I;else if(R==16)for(d=0;d<s;d++)I=n[T+(d<<1)],_=B(n,T+(d<<1))==f?0:255,z[P+d]=_<<24|I<<16|I<<8|I}return S}function U(n,s,r,c){const m=t(n),A=Math.ceil(r*m/8),D=new Uint8Array((A+1+n.interlace)*c);return s=n.tabs.CgBI?e(s,D):l(s,D),n.interlace==0?s=a(s,n,0,r,c):n.interlace==1&&(s=function(z,M){const R=M.width,B=M.height,j=t(M),E=j>>3,f=Math.ceil(R*j/8),u=new Uint8Array(B*f);let p=0;const v=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let I=0;for(;I<7;){const d=C[I],_=b[I];let T=0,P=0,V=v[I];for(;V<B;)V+=d,P++;let H=w[I];for(;H<R;)H+=_,T++;const $=Math.ceil(T*j/8);a(z,M,p,T,P);let L=0,O=v[I];for(;O<B;){let X=w[I],re=p+L*$<<3;for(;X<R;){var h;if(j==1&&(h=(h=z[re>>3])>>7-(7&re)&1,u[O*f+(X>>3)]|=h<<7-((7&X)<<0)),j==2&&(h=(h=z[re>>3])>>6-(7&re)&3,u[O*f+(X>>2)]|=h<<6-((3&X)<<1)),j==4&&(h=(h=z[re>>3])>>4-(7&re)&15,u[O*f+(X>>1)]|=h<<4-((1&X)<<2)),j>=8){const J=O*f+X*E;for(let te=0;te<E;te++)u[J+te]=z[(re>>3)+te]}re+=j,X+=_}L++,O+=d}T*P!=0&&(p+=P*(1+$)),I+=1}return u}(s,n)),s}function l(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const c=Uint8Array;let m,A,D=0,S=0,z=0,M=0,R=0,B=0,j=0,E=0,f=0;if(s[0]==3&&s[1]==0)return r||new c(0);const u=n.H,p=u.b,v=u.e,w=u.R,C=u.n,b=u.A,I=u.Z,h=u.m,d=r==null;for(d&&(r=new c(s.length>>>2<<5));D==0;)if(D=p(s,f,1),S=p(s,f+1,2),f+=3,S!=0){if(d&&(r=n.H.W(r,E+(1<<17))),S==1&&(m=h.J,A=h.h,B=511,j=31),S==2){z=v(s,f,5)+257,M=v(s,f+5,5)+1,R=v(s,f+10,4)+4,f+=14;let T=1;for(var _=0;_<38;_+=2)h.Q[_]=0,h.Q[_+1]=0;for(_=0;_<R;_++){const H=v(s,f+3*_,3);h.Q[1+(h.X[_]<<1)]=H,H>T&&(T=H)}f+=3*R,C(h.Q,T),b(h.Q,T,h.u),m=h.w,A=h.d,f=w(h.u,(1<<T)-1,z+M,s,f,h.v);const P=u.V(h.v,0,z,h.C);B=(1<<P)-1;const V=u.V(h.v,z,M,h.D);j=(1<<V)-1,C(h.C,P),b(h.C,P,m),C(h.D,V),b(h.D,V,A)}for(;;){const T=m[I(s,f)&B];f+=15&T;const P=T>>>4;if(!(P>>>8))r[E++]=P;else{if(P==256)break;{let V=E+P-254;if(P>264){const X=h.q[P-257];V=E+(X>>>3)+v(s,f,7&X),f+=7&X}const H=A[I(s,f)&j];f+=15&H;const $=H>>>4,L=h.c[$],O=(L>>>4)+p(s,f,15&L);for(f+=15&L;E<V;)r[E]=r[E++-O],r[E]=r[E++-O],r[E]=r[E++-O],r[E]=r[E++-O];E=V}}}}else{(7&f)!=0&&(f+=8-(7&f));const T=4+(f>>>3),P=s[T-4]|s[T-3]<<8;d&&(r=n.H.W(r,E+P)),r.set(new c(s.buffer,s.byteOffset+T,P),E),f=T+P<<3,E+=P}return r.length==E?r:r.slice(0,E)},n.H.W=function(s,r){const c=s.length;if(r<=c)return s;const m=new Uint8Array(c<<1);return m.set(s,0),m},n.H.R=function(s,r,c,m,A,D){const S=n.H.e,z=n.H.Z;let M=0;for(;M<c;){const R=s[z(m,A)&r];A+=15&R;const B=R>>>4;if(B<=15)D[M]=B,M++;else{let j=0,E=0;B==16?(E=3+S(m,A,2),A+=2,j=D[M-1]):B==17?(E=3+S(m,A,3),A+=3):B==18&&(E=11+S(m,A,7),A+=7);const f=M+E;for(;M<f;)D[M]=j,M++}}return A},n.H.V=function(s,r,c,m){let A=0,D=0;const S=m.length>>>1;for(;D<c;){const z=s[D+r];m[D<<1]=0,m[1+(D<<1)]=z,z>A&&(A=z),D++}for(;D<S;)m[D<<1]=0,m[1+(D<<1)]=0,D++;return A},n.H.n=function(s,r){const c=n.H.m,m=s.length;let A,D,S,z;const M=c.j;for(var R=0;R<=r;R++)M[R]=0;for(R=1;R<m;R+=2)M[s[R]]++;const B=c.K;for(A=0,M[0]=0,D=1;D<=r;D++)A=A+M[D-1]<<1,B[D]=A;for(S=0;S<m;S+=2)z=s[S+1],z!=0&&(s[S]=B[z],B[z]++)},n.H.A=function(s,r,c){const m=s.length,A=n.H.m.r;for(let D=0;D<m;D+=2)if(s[D+1]!=0){const S=D>>1,z=s[D+1],M=S<<4|z,R=r-z;let B=s[D]<<R;const j=B+(1<<R);for(;B!=j;)c[A[B]>>>15-r]=M,B++}},n.H.l=function(s,r){const c=n.H.m.r,m=15-r;for(let A=0;A<s.length;A+=2){const D=s[A]<<r-s[A+1];s[A]=c[D]>>>m}},n.H.M=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8},n.H.I=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8,s[m+2]|=c>>>16},n.H.e=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<c)-1},n.H.b=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<c)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let m=r;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,s.r[r]=(m>>>16|m<<16)>>>17}function c(m,A,D){for(;A--!=0;)m.push(0,D)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];c(s._,144,8),c(s._,112,9),c(s._,24,7),c(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),c(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),c(s.Q,19,0),c(s.C,286,0),c(s.D,30,0),c(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function a(n,s,r,c,m){let A=t(s);const D=Math.ceil(c*A/8);let S,z;A=Math.ceil(A/8);let M=n[r],R=0;if(M>1&&(n[r]=[0,0,1][M-2]),M==3)for(R=A;R<D;R++)n[R+1]=n[R+1]+(n[R+1-A]>>>1)&255;for(let B=0;B<m;B++)if(S=r+B*D,z=S+B+1,M=n[z-1],R=0,M==0)for(;R<D;R++)n[S+R]=n[z+R];else if(M==1){for(;R<A;R++)n[S+R]=n[z+R];for(;R<D;R++)n[S+R]=n[z+R]+n[S+R-A]}else if(M==2)for(;R<D;R++)n[S+R]=n[z+R]+n[S+R-D];else if(M==3){for(;R<A;R++)n[S+R]=n[z+R]+(n[S+R-D]>>>1);for(;R<D;R++)n[S+R]=n[z+R]+(n[S+R-D]+n[S+R-A]>>>1)}else{for(;R<A;R++)n[S+R]=n[z+R]+o(0,n[S+R-D],0);for(;R<D;R++)n[S+R]=n[z+R]+o(n[S+R-A],n[S+R-D],n[S+R-A-D])}return n}function o(n,s,r){const c=n+s-r,m=c-n,A=c-s,D=c-r;return m*m<=A*A&&m*m<=D*D?n:A*A<=D*D?s:r}function x(n,s,r){r.width=g.readUint(n,s),s+=4,r.height=g.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function y(n,s,r,c,m,A,D,S,z){const M=Math.min(s,m),R=Math.min(r,A);let B=0,j=0;for(let I=0;I<R;I++)for(let h=0;h<M;h++)if(D>=0&&S>=0?(B=I*s+h<<2,j=(S+I)*m+D+h<<2):(B=(-S+I)*s-D+h<<2,j=I*m+h<<2),z==0)c[j]=n[B],c[j+1]=n[B+1],c[j+2]=n[B+2],c[j+3]=n[B+3];else if(z==1){var E=n[B+3]*.00392156862745098,f=n[B]*E,u=n[B+1]*E,p=n[B+2]*E,v=c[j+3]*(1/255),w=c[j]*v,C=c[j+1]*v,b=c[j+2]*v;const d=1-E,_=E+v*d,T=_==0?0:1/_;c[j+3]=255*_,c[j+0]=(f+w*d)*T,c[j+1]=(u+C*d)*T,c[j+2]=(p+b*d)*T}else if(z==2)E=n[B+3],f=n[B],u=n[B+1],p=n[B+2],v=c[j+3],w=c[j],C=c[j+1],b=c[j+2],E==v&&f==w&&u==C&&p==b?(c[j]=0,c[j+1]=0,c[j+2]=0,c[j+3]=0):(c[j]=f,c[j+1]=u,c[j+2]=p,c[j+3]=E);else if(z==3){if(E=n[B+3],f=n[B],u=n[B+1],p=n[B+2],v=c[j+3],w=c[j],C=c[j+1],b=c[j+2],E==v&&f==w&&u==C&&p==b)continue;if(E<220&&v>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let c=8;const m=g,A=m.readUshort,D=m.readUint,S={tabs:{},frames:[]},z=new Uint8Array(r.length);let M,R=0,B=0;const j=[137,80,78,71,13,10,26,10];for(var E=0;E<8;E++)if(r[E]!=j[E])throw"The input is not a PNG file!";for(;c<r.length;){const I=m.readUint(r,c);c+=4;const h=m.readASCII(r,c,4);if(c+=4,h=="IHDR")x(r,c,S);else if(h=="iCCP"){for(var f=c;r[f]!=0;)f++;m.readASCII(r,c,f-c),r[f+1];const d=r.slice(f+2,c+I);let _=null;try{_=l(d)}catch{_=e(d)}S.tabs[h]=_}else if(h=="CgBI")S.tabs[h]=r.slice(c,c+4);else if(h=="IDAT"){for(E=0;E<I;E++)z[R+E]=r[c+E];R+=I}else if(h=="acTL")S.tabs[h]={num_frames:D(r,c),num_plays:D(r,c+4)},M=new Uint8Array(r.length);else if(h=="fcTL"){B!=0&&((b=S.frames[S.frames.length-1]).data=U(S,M.slice(0,B),b.rect.width,b.rect.height),B=0);const d={x:D(r,c+12),y:D(r,c+16),width:D(r,c+4),height:D(r,c+8)};let _=A(r,c+22);_=A(r,c+20)/(_==0?100:_);const T={rect:d,delay:Math.round(1e3*_),dispose:r[c+24],blend:r[c+25]};S.frames.push(T)}else if(h=="fdAT"){for(E=0;E<I-4;E++)M[B+E]=r[c+E+4];B+=I-4}else if(h=="pHYs")S.tabs[h]=[m.readUint(r,c),m.readUint(r,c+4),r[c+8]];else if(h=="cHRM")for(S.tabs[h]=[],E=0;E<8;E++)S.tabs[h].push(m.readUint(r,c+4*E));else if(h=="tEXt"||h=="zTXt"){S.tabs[h]==null&&(S.tabs[h]={});var u=m.nextZero(r,c),p=m.readASCII(r,c,u-c),v=c+I-u-1;if(h=="tEXt")C=m.readASCII(r,u+1,v);else{var w=l(r.slice(u+2,u+2+v));C=m.readUTF8(w,0,w.length)}S.tabs[h][p]=C}else if(h=="iTXt"){S.tabs[h]==null&&(S.tabs[h]={}),u=0,f=c,u=m.nextZero(r,f),p=m.readASCII(r,f,u-f);const d=r[f=u+1];var C;r[f+1],f+=2,u=m.nextZero(r,f),m.readASCII(r,f,u-f),f=u+1,u=m.nextZero(r,f),m.readUTF8(r,f,u-f),v=I-((f=u+1)-c),d==0?C=m.readUTF8(r,f,v):(w=l(r.slice(f,f+v)),C=m.readUTF8(w,0,w.length)),S.tabs[h][p]=C}else if(h=="PLTE")S.tabs[h]=m.readBytes(r,c,I);else if(h=="hIST"){const d=S.tabs.PLTE.length/3;for(S.tabs[h]=[],E=0;E<d;E++)S.tabs[h].push(A(r,c+2*E))}else if(h=="tRNS")S.ctype==3?S.tabs[h]=m.readBytes(r,c,I):S.ctype==0?S.tabs[h]=A(r,c):S.ctype==2&&(S.tabs[h]=[A(r,c),A(r,c+2),A(r,c+4)]);else if(h=="gAMA")S.tabs[h]=m.readUint(r,c)/1e5;else if(h=="sRGB")S.tabs[h]=r[c];else if(h=="bKGD")S.ctype==0||S.ctype==4?S.tabs[h]=[A(r,c)]:S.ctype==2||S.ctype==6?S.tabs[h]=[A(r,c),A(r,c+2),A(r,c+4)]:S.ctype==3&&(S.tabs[h]=r[c]);else if(h=="IEND")break;c+=I,m.readUint(r,c),c+=4}var b;return B!=0&&((b=S.frames[S.frames.length-1]).data=U(S,M.slice(0,B),b.rect.width,b.rect.height)),S.data=U(S,z,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(s){const r=s.width,c=s.height;if(s.tabs.acTL==null)return[F(s.data,r,c,s).buffer];const m=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const A=r*c*4,D=new Uint8Array(A),S=new Uint8Array(A),z=new Uint8Array(A);for(let R=0;R<s.frames.length;R++){const B=s.frames[R],j=B.rect.x,E=B.rect.y,f=B.rect.width,u=B.rect.height,p=F(B.data,f,u,s);if(R!=0)for(var M=0;M<A;M++)z[M]=D[M];if(B.blend==0?y(p,f,u,D,r,c,j,E,0):B.blend==1&&y(p,f,u,D,r,c,j,E,1),m.push(D.buffer.slice(0)),B.dispose!=0){if(B.dispose==1)y(S,f,u,D,r,c,j,E,0);else if(B.dispose==2)for(M=0;M<A;M++)D[M]=z[M]}}return m},_paeth:o,_copyTile:y,_bin:g}}();(function(){const{_copyTile:g}=Le,{_bin:F}=Le,U=Le._paeth;var l={table:function(){const f=new Uint32Array(256);for(let u=0;u<256;u++){let p=u;for(let v=0;v<8;v++)1&p?p=3988292384^p>>>1:p>>>=1;f[u]=p}return f}(),update(f,u,p,v){for(let w=0;w<v;w++)f=l.table[255&(f^u[p+w])]^f>>>8;return f},crc:(f,u,p)=>4294967295^l.update(4294967295,f,u,p)};function e(f,u,p,v){u[p]+=f[0]*v>>4,u[p+1]+=f[1]*v>>4,u[p+2]+=f[2]*v>>4,u[p+3]+=f[3]*v>>4}function t(f){return Math.max(0,Math.min(255,f))}function a(f,u){const p=f[0]-u[0],v=f[1]-u[1],w=f[2]-u[2],C=f[3]-u[3];return p*p+v*v+w*w+C*C}function o(f,u,p,v,w,C,b){b==null&&(b=1);const I=v.length,h=[];for(var d=0;d<I;d++){const O=v[d];h.push([O>>>0&255,O>>>8&255,O>>>16&255,O>>>24&255])}for(d=0;d<I;d++){let O=4294967295;for(var _=0,T=0;T<I;T++){var P=a(h[d],h[T]);T!=d&&P<O&&(O=P,_=T)}}const V=new Uint32Array(w.buffer),H=new Int16Array(u*p*4),$=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(d=0;d<$.length;d++)$[d]=255*(($[d]+.5)/16-.5);for(let O=0;O<p;O++)for(let X=0;X<u;X++){var L;d=4*(O*u+X),b!=2?L=[t(f[d]+H[d]),t(f[d+1]+H[d+1]),t(f[d+2]+H[d+2]),t(f[d+3]+H[d+3])]:(P=$[4*(3&O)+(3&X)],L=[t(f[d]+P),t(f[d+1]+P),t(f[d+2]+P),t(f[d+3]+P)]),_=0;let re=16777215;for(T=0;T<I;T++){const le=a(L,h[T]);le<re&&(re=le,_=T)}const J=h[_],te=[L[0]-J[0],L[1]-J[1],L[2]-J[2],L[3]-J[3]];b==1&&(X!=u-1&&e(te,H,d+4,7),O!=p-1&&(X!=0&&e(te,H,d+4*u-4,3),e(te,H,d+4*u,5),X!=u-1&&e(te,H,d+4*u+4,1))),C[d>>2]=_,V[d>>2]=v[_]}}function x(f,u,p,v,w){w==null&&(w={});const{crc:C}=l,b=F.writeUint,I=F.writeUshort,h=F.writeASCII;let d=8;const _=f.frames.length>1;let T,P=!1,V=33+(_?20:0);if(w.sRGB!=null&&(V+=13),w.pHYs!=null&&(V+=21),w.iCCP!=null&&(T=pako.deflate(w.iCCP),V+=21+T.length+4),f.ctype==3){for(var H=f.plte.length,$=0;$<H;$++)f.plte[$]>>>24!=255&&(P=!0);V+=8+3*H+4+(P?8+1*H+4:0)}for(var L=0;L<f.frames.length;L++)_&&(V+=38),V+=(J=f.frames[L]).cimg.length+12,L!=0&&(V+=4);V+=12;const O=new Uint8Array(V),X=[137,80,78,71,13,10,26,10];for($=0;$<8;$++)O[$]=X[$];if(b(O,d,13),d+=4,h(O,d,"IHDR"),d+=4,b(O,d,u),d+=4,b(O,d,p),d+=4,O[d]=f.depth,d++,O[d]=f.ctype,d++,O[d]=0,d++,O[d]=0,d++,O[d]=0,d++,b(O,d,C(O,d-17,17)),d+=4,w.sRGB!=null&&(b(O,d,1),d+=4,h(O,d,"sRGB"),d+=4,O[d]=w.sRGB,d++,b(O,d,C(O,d-5,5)),d+=4),w.iCCP!=null){const te=13+T.length;b(O,d,te),d+=4,h(O,d,"iCCP"),d+=4,h(O,d,"ICC profile"),d+=11,d+=2,O.set(T,d),d+=T.length,b(O,d,C(O,d-(te+4),te+4)),d+=4}if(w.pHYs!=null&&(b(O,d,9),d+=4,h(O,d,"pHYs"),d+=4,b(O,d,w.pHYs[0]),d+=4,b(O,d,w.pHYs[1]),d+=4,O[d]=w.pHYs[2],d++,b(O,d,C(O,d-13,13)),d+=4),_&&(b(O,d,8),d+=4,h(O,d,"acTL"),d+=4,b(O,d,f.frames.length),d+=4,b(O,d,w.loop!=null?w.loop:0),d+=4,b(O,d,C(O,d-12,12)),d+=4),f.ctype==3){for(b(O,d,3*(H=f.plte.length)),d+=4,h(O,d,"PLTE"),d+=4,$=0;$<H;$++){const te=3*$,le=f.plte[$],ie=255&le,he=le>>>8&255,Ne=le>>>16&255;O[d+te+0]=ie,O[d+te+1]=he,O[d+te+2]=Ne}if(d+=3*H,b(O,d,C(O,d-3*H-4,3*H+4)),d+=4,P){for(b(O,d,H),d+=4,h(O,d,"tRNS"),d+=4,$=0;$<H;$++)O[d+$]=f.plte[$]>>>24&255;d+=H,b(O,d,C(O,d-H-4,H+4)),d+=4}}let re=0;for(L=0;L<f.frames.length;L++){var J=f.frames[L];_&&(b(O,d,26),d+=4,h(O,d,"fcTL"),d+=4,b(O,d,re++),d+=4,b(O,d,J.rect.width),d+=4,b(O,d,J.rect.height),d+=4,b(O,d,J.rect.x),d+=4,b(O,d,J.rect.y),d+=4,I(O,d,v[L]),d+=2,I(O,d,1e3),d+=2,O[d]=J.dispose,d++,O[d]=J.blend,d++,b(O,d,C(O,d-30,30)),d+=4);const te=J.cimg;b(O,d,(H=te.length)+(L==0?0:4)),d+=4;const le=d;h(O,d,L==0?"IDAT":"fdAT"),d+=4,L!=0&&(b(O,d,re++),d+=4),O.set(te,d),d+=H,b(O,d,C(O,le,d-le)),d+=4}return b(O,d,0),d+=4,h(O,d,"IEND"),d+=4,b(O,d,C(O,d-4,4)),d+=4,O.buffer}function y(f,u,p){for(let v=0;v<f.frames.length;v++){const w=f.frames[v];w.rect.width;const C=w.rect.height,b=new Uint8Array(C*w.bpl+C);w.cimg=c(w.img,C,w.bpp,w.bpl,b,u,p)}}function n(f,u,p,v,w){const C=w[0],b=w[1],I=w[2],h=w[3],d=w[4],_=w[5];let T=6,P=8,V=255;for(var H=0;H<f.length;H++){const ye=new Uint8Array(f[H]);for(var $=ye.length,L=0;L<$;L+=4)V&=ye[L+3]}const O=V!=255,X=function(me,de,be,ve,pe,Ue){const ce=[];for(var fe=0;fe<me.length;fe++){const Ae=new Uint8Array(me[fe]),oe=new Uint32Array(Ae.buffer);var je;let Ee=0,ae=0,Re=de,we=be,Ft=ve?1:0;if(fe!=0){const rn=Ue||ve||fe==1||ce[fe-2].dispose!=0?1:2;let Tt=0,Vt=1e9;for(let dt=0;dt<rn;dt++){var Qe=new Uint8Array(me[fe-1-dt]);const sn=new Uint32Array(me[fe-1-dt]);let Ge=de,qe=be,He=-1,ct=-1;for(let Xe=0;Xe<be;Xe++)for(let Ye=0;Ye<de;Ye++)oe[Se=Xe*de+Ye]!=sn[Se]&&(Ye<Ge&&(Ge=Ye),Ye>He&&(He=Ye),Xe<qe&&(qe=Xe),Xe>ct&&(ct=Xe));He==-1&&(Ge=qe=He=ct=0),pe&&((1&Ge)==1&&Ge--,(1&qe)==1&&qe--);const Qt=(He-Ge+1)*(ct-qe+1);Qt<Vt&&(Vt=Qt,Tt=dt,Ee=Ge,ae=qe,Re=He-Ge+1,we=ct-qe+1)}Qe=new Uint8Array(me[fe-1-Tt]),Tt==1&&(ce[fe-1].dispose=2),je=new Uint8Array(Re*we*4),g(Qe,de,be,je,Re,we,-Ee,-ae,0),Ft=g(Ae,de,be,je,Re,we,-Ee,-ae,3)?1:0,Ft==1?r(Ae,de,be,je,{x:Ee,y:ae,width:Re,height:we}):g(Ae,de,be,je,Re,we,-Ee,-ae,0)}else je=Ae.slice(0);ce.push({rect:{x:Ee,y:ae,width:Re,height:we},img:je,blend:Ft,dispose:0})}if(ve)for(fe=0;fe<ce.length;fe++){if((ue=ce[fe]).blend==1)continue;const Ae=ue.rect,oe=ce[fe-1].rect,Ee=Math.min(Ae.x,oe.x),ae=Math.min(Ae.y,oe.y),Re={x:Ee,y:ae,width:Math.max(Ae.x+Ae.width,oe.x+oe.width)-Ee,height:Math.max(Ae.y+Ae.height,oe.y+oe.height)-ae};ce[fe-1].dispose=1,fe-1!=0&&s(me,de,be,ce,fe-1,Re,pe),s(me,de,be,ce,fe,Re,pe)}let nt=0;if(me.length!=1)for(var Se=0;Se<ce.length;Se++){var ue;nt+=(ue=ce[Se]).rect.width*ue.rect.height}return ce}(f,u,p,C,b,I),re={},J=[],te=[];if(v!=0){const ye=[];for(L=0;L<X.length;L++)ye.push(X[L].img.buffer);const me=function(pe){let Ue=0;for(var ce=0;ce<pe.length;ce++)Ue+=pe[ce].byteLength;const fe=new Uint8Array(Ue);let je=0;for(ce=0;ce<pe.length;ce++){const Qe=new Uint8Array(pe[ce]),nt=Qe.length;for(let Se=0;Se<nt;Se+=4){let ue=Qe[Se],Ae=Qe[Se+1],oe=Qe[Se+2];const Ee=Qe[Se+3];Ee==0&&(ue=Ae=oe=0),fe[je+Se]=ue,fe[je+Se+1]=Ae,fe[je+Se+2]=oe,fe[je+Se+3]=Ee}je+=nt}return fe.buffer}(ye),de=A(me,v);for(L=0;L<de.plte.length;L++)J.push(de.plte[L].est.rgba);let be=0;for(L=0;L<X.length;L++){const ve=(ie=X[L]).img.length;var le=new Uint8Array(de.inds.buffer,be>>2,ve>>2);te.push(le);const pe=new Uint8Array(de.abuf,be,ve);_&&o(ie.img,ie.rect.width,ie.rect.height,J,pe,le),ie.img.set(pe),be+=ve}}else for(H=0;H<X.length;H++){var ie=X[H];const ye=new Uint32Array(ie.img.buffer);var he=ie.rect.width;for($=ye.length,le=new Uint8Array($),te.push(le),L=0;L<$;L++){const me=ye[L];if(L!=0&&me==ye[L-1])le[L]=le[L-1];else if(L>he&&me==ye[L-he])le[L]=le[L-he];else{let de=re[me];if(de==null&&(re[me]=de=J.length,J.push(me),J.length>=300))break;le[L]=de}}}const Ne=J.length;for(Ne<=256&&d==0&&(P=Ne<=2?1:Ne<=4?2:Ne<=16?4:8,P=Math.max(P,h)),H=0;H<X.length;H++){(ie=X[H]).rect.x,ie.rect.y,he=ie.rect.width;const ye=ie.rect.height;let me=ie.img;new Uint32Array(me.buffer);let de=4*he,be=4;if(Ne<=256&&d==0){de=Math.ceil(P*he/8);var De=new Uint8Array(de*ye);const ve=te[H];for(let pe=0;pe<ye;pe++){L=pe*de;const Ue=pe*he;if(P==8)for(var ge=0;ge<he;ge++)De[L+ge]=ve[Ue+ge];else if(P==4)for(ge=0;ge<he;ge++)De[L+(ge>>1)]|=ve[Ue+ge]<<4-4*(1&ge);else if(P==2)for(ge=0;ge<he;ge++)De[L+(ge>>2)]|=ve[Ue+ge]<<6-2*(3&ge);else if(P==1)for(ge=0;ge<he;ge++)De[L+(ge>>3)]|=ve[Ue+ge]<<7-1*(7&ge)}me=De,T=3,be=1}else if(O==0&&X.length==1){De=new Uint8Array(he*ye*3);const ve=he*ye;for(L=0;L<ve;L++){const pe=3*L,Ue=4*L;De[pe]=me[Ue],De[pe+1]=me[Ue+1],De[pe+2]=me[Ue+2]}me=De,T=2,be=3,de=3*he}ie.img=me,ie.bpl=de,ie.bpp=be}return{ctype:T,depth:P,plte:J,frames:X}}function s(f,u,p,v,w,C,b){const I=Uint8Array,h=Uint32Array,d=new I(f[w-1]),_=new h(f[w-1]),T=w+1<f.length?new I(f[w+1]):null,P=new I(f[w]),V=new h(P.buffer);let H=u,$=p,L=-1,O=-1;for(let re=0;re<C.height;re++)for(let J=0;J<C.width;J++){const te=C.x+J,le=C.y+re,ie=le*u+te,he=V[ie];he==0||v[w-1].dispose==0&&_[ie]==he&&(T==null||T[4*ie+3]!=0)||(te<H&&(H=te),te>L&&(L=te),le<$&&($=le),le>O&&(O=le))}L==-1&&(H=$=L=O=0),b&&((1&H)==1&&H--,(1&$)==1&&$--),C={x:H,y:$,width:L-H+1,height:O-$+1};const X=v[w];X.rect=C,X.blend=1,X.img=new Uint8Array(C.width*C.height*4),v[w-1].dispose==0?(g(d,u,p,X.img,C.width,C.height,-C.x,-C.y,0),r(P,u,p,X.img,C)):g(P,u,p,X.img,C.width,C.height,-C.x,-C.y,0)}function r(f,u,p,v,w){g(f,u,p,v,w.width,w.height,-w.x,-w.y,2)}function c(f,u,p,v,w,C,b){const I=[];let h,d=[0,1,2,3,4];C!=-1?d=[C]:(u*v>5e5||p==1)&&(d=[0]),b&&(h={level:0});const _=us;for(var T=0;T<d.length;T++){for(let H=0;H<u;H++)m(w,f,H,v,p,d[T]);I.push(_.deflate(w,h))}let P,V=1e9;for(T=0;T<I.length;T++)I[T].length<V&&(P=T,V=I[T].length);return I[P]}function m(f,u,p,v,w,C){const b=p*v;let I=b+p;if(f[I]=C,I++,C==0)if(v<500)for(var h=0;h<v;h++)f[I+h]=u[b+h];else f.set(new Uint8Array(u.buffer,b,v),I);else if(C==1){for(h=0;h<w;h++)f[I+h]=u[b+h];for(h=w;h<v;h++)f[I+h]=u[b+h]-u[b+h-w]+256&255}else if(p==0){for(h=0;h<w;h++)f[I+h]=u[b+h];if(C==2)for(h=w;h<v;h++)f[I+h]=u[b+h];if(C==3)for(h=w;h<v;h++)f[I+h]=u[b+h]-(u[b+h-w]>>1)+256&255;if(C==4)for(h=w;h<v;h++)f[I+h]=u[b+h]-U(u[b+h-w],0,0)+256&255}else{if(C==2)for(h=0;h<v;h++)f[I+h]=u[b+h]+256-u[b+h-v]&255;if(C==3){for(h=0;h<w;h++)f[I+h]=u[b+h]+256-(u[b+h-v]>>1)&255;for(h=w;h<v;h++)f[I+h]=u[b+h]+256-(u[b+h-v]+u[b+h-w]>>1)&255}if(C==4){for(h=0;h<w;h++)f[I+h]=u[b+h]+256-U(0,u[b+h-v],0)&255;for(h=w;h<v;h++)f[I+h]=u[b+h]+256-U(u[b+h-w],u[b+h-v],u[b+h-w-v])&255}}}function A(f,u){const p=new Uint8Array(f),v=p.slice(0),w=new Uint32Array(v.buffer),C=D(v,u),b=C[0],I=C[1],h=p.length,d=new Uint8Array(h>>2);let _;if(p.length<2e7)for(var T=0;T<h;T+=4)_=S(b,P=p[T]*(1/255),V=p[T+1]*(1/255),H=p[T+2]*(1/255),$=p[T+3]*(1/255)),d[T>>2]=_.ind,w[T>>2]=_.est.rgba;else for(T=0;T<h;T+=4){var P=p[T]*.00392156862745098,V=p[T+1]*(1/255),H=p[T+2]*(1/255),$=p[T+3]*(1/255);for(_=b;_.left;)_=z(_.est,P,V,H,$)<=0?_.left:_.right;d[T>>2]=_.ind,w[T>>2]=_.est.rgba}return{abuf:v.buffer,inds:d,plte:I}}function D(f,u,p){p==null&&(p=1e-4);const v=new Uint32Array(f.buffer),w={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=B(f,w.i0,w.i1),w.est=j(w.bst);const C=[w];for(;C.length<u;){let I=0,h=0;for(var b=0;b<C.length;b++)C[b].est.L>I&&(I=C[b].est.L,h=b);if(I<p)break;const d=C[h],_=M(f,v,d.i0,d.i1,d.est.e,d.est.eMq255);if(d.i0>=_||d.i1<=_){d.est.L=0;continue}const T={i0:d.i0,i1:_,bst:null,est:null,tdst:0,left:null,right:null};T.bst=B(f,T.i0,T.i1),T.est=j(T.bst);const P={i0:_,i1:d.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:d.bst.N-T.bst.N},b=0;b<16;b++)P.bst.R[b]=d.bst.R[b]-T.bst.R[b];for(b=0;b<4;b++)P.bst.m[b]=d.bst.m[b]-T.bst.m[b];P.est=j(P.bst),d.left=T,d.right=P,C[h]=T,C.push(P)}for(C.sort((I,h)=>h.bst.N-I.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[w,C]}function S(f,u,p,v,w){if(f.left==null)return f.tdst=function(T,P,V,H,$){const L=P-T[0],O=V-T[1],X=H-T[2],re=$-T[3];return L*L+O*O+X*X+re*re}(f.est.q,u,p,v,w),f;const C=z(f.est,u,p,v,w);let b=f.left,I=f.right;C>0&&(b=f.right,I=f.left);const h=S(b,u,p,v,w);if(h.tdst<=C*C)return h;const d=S(I,u,p,v,w);return d.tdst<h.tdst?d:h}function z(f,u,p,v,w){const{e:C}=f;return C[0]*u+C[1]*p+C[2]*v+C[3]*w-f.eMq}function M(f,u,p,v,w,C){for(v-=4;p<v;){for(;R(f,p,w)<=C;)p+=4;for(;R(f,v,w)>C;)v-=4;if(p>=v)break;const b=u[p>>2];u[p>>2]=u[v>>2],u[v>>2]=b,p+=4,v-=4}for(;R(f,p,w)>C;)p-=4;return p+4}function R(f,u,p){return f[u]*p[0]+f[u+1]*p[1]+f[u+2]*p[2]+f[u+3]*p[3]}function B(f,u,p){const v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=p-u>>2;for(let b=u;b<p;b+=4){const I=f[b]*.00392156862745098,h=f[b+1]*(1/255),d=f[b+2]*(1/255),_=f[b+3]*(1/255);w[0]+=I,w[1]+=h,w[2]+=d,w[3]+=_,v[0]+=I*I,v[1]+=I*h,v[2]+=I*d,v[3]+=I*_,v[5]+=h*h,v[6]+=h*d,v[7]+=h*_,v[10]+=d*d,v[11]+=d*_,v[15]+=_*_}return v[4]=v[1],v[8]=v[2],v[9]=v[6],v[12]=v[3],v[13]=v[7],v[14]=v[11],{R:v,m:w,N:C}}function j(f){const{R:u}=f,{m:p}=f,{N:v}=f,w=p[0],C=p[1],b=p[2],I=p[3],h=v==0?0:1/v,d=[u[0]-w*w*h,u[1]-w*C*h,u[2]-w*b*h,u[3]-w*I*h,u[4]-C*w*h,u[5]-C*C*h,u[6]-C*b*h,u[7]-C*I*h,u[8]-b*w*h,u[9]-b*C*h,u[10]-b*b*h,u[11]-b*I*h,u[12]-I*w*h,u[13]-I*C*h,u[14]-I*b*h,u[15]-I*I*h],_=d,T=E;let P=[Math.random(),Math.random(),Math.random(),Math.random()],V=0,H=0;if(v!=0)for(let L=0;L<16&&(P=T.multVec(_,P),H=Math.sqrt(T.dot(P,P)),P=T.sml(1/H,P),!(L!=0&&Math.abs(H-V)<1e-9));L++)V=H;const $=[w*h,C*h,b*h,I*h];return{Cov:d,q:$,e:P,L:V,eMq255:T.dot(T.sml(255,$),P),eMq:T.dot(P,$),rgba:(Math.round(255*$[3])<<24|Math.round(255*$[2])<<16|Math.round(255*$[1])<<8|Math.round(255*$[0])<<0)>>>0}}var E={multVec:(f,u)=>[f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],f[4]*u[0]+f[5]*u[1]+f[6]*u[2]+f[7]*u[3],f[8]*u[0]+f[9]*u[1]+f[10]*u[2]+f[11]*u[3],f[12]*u[0]+f[13]*u[1]+f[14]*u[2]+f[15]*u[3]],dot:(f,u)=>f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],sml:(f,u)=>[f*u[0],f*u[1],f*u[2],f*u[3]]};Le.encode=function(u,p,v,w,C,b,I){w==null&&(w=0),I==null&&(I=!1);const h=n(u,p,v,w,[!1,!1,!1,0,I,!1]);return y(h,-1),x(h,p,v,C,b)},Le.encodeLL=function(u,p,v,w,C,b,I,h){const d={ctype:0+(w==1?0:2)+(C==0?0:4),depth:b,frames:[]},_=(w+C)*b,T=_*p;for(let P=0;P<u.length;P++)d.frames.push({rect:{x:0,y:0,width:p,height:v},img:new Uint8Array(u[P]),blend:0,dispose:1,bpp:Math.ceil(_/8),bpl:Math.ceil(T/8)});return y(d,0,!0),x(d,p,v,I,h)},Le.encode.compress=n,Le.encode.dither=o,Le.quantize=A,Le.quantize.getKDtree=D,Le.quantize.getNearest=S})();const br={toArrayBuffer(g,F){const U=g.width,l=g.height,e=U<<2,t=g.getContext("2d").getImageData(0,0,U,l),a=new Uint32Array(t.data.buffer),o=(32*U+31)/32<<2,x=o*l,y=122+x,n=new ArrayBuffer(y),s=new DataView(n),r=1<<20;let c,m,A,D,S=r,z=0,M=0,R=0;function B(f){s.setUint16(M,f,!0),M+=2}function j(f){s.setUint32(M,f,!0),M+=4}function E(f){M+=f}B(19778),j(y),E(4),j(122),j(108),j(U),j(-l>>>0),B(1),B(32),j(3),j(x),j(2835),j(2835),E(8),j(16711680),j(65280),j(255),j(4278190080),j(1466527264),function f(){for(;z<l&&S>0;){for(D=122+z*o,c=0;c<e;)S--,m=a[R++],A=m>>>24,s.setUint32(D+c,m<<8|A),c+=4;z++}R<a.length?(S=r,setTimeout(f,br._dly)):F(n)}()},toBlob(g,F){this.toArrayBuffer(g,U=>{F(new Blob([U],{type:"image/bmp"}))})},_dly:9};var Oe={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},fs={[Oe.CHROME]:16384,[Oe.FIREFOX]:11180,[Oe.DESKTOP_SAFARI]:16384,[Oe.IE]:8192,[Oe.IOS]:4096,[Oe.ETC]:8192};const Mn=typeof window<"u",xr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Jt=Mn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),hs=(Mn||xr)&&(Jt&&Jt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),yr=(Mn||xr)&&(Jt&&Jt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function On(g,F,U=Date.now()){return new Promise(l=>{const e=g.split(","),t=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let o=a.length;const x=new Uint8Array(o);for(;o--;)x[o]=a.charCodeAt(o);const y=new Blob([x],{type:t});y.name=F,y.lastModified=U,l(y)})}function vr(g){return new Promise((F,U)=>{const l=new yr;l.onload=()=>F(l.result),l.onerror=e=>U(e),l.readAsDataURL(g)})}function jr(g){return new Promise((F,U)=>{const l=new Image;l.onload=()=>F(l),l.onerror=e=>U(e),l.src=g})}function ut(){if(ut.cachedResult!==void 0)return ut.cachedResult;let g=Oe.ETC;const{userAgent:F}=navigator;return/Chrom(e|ium)/i.test(F)?g=Oe.CHROME:/iP(ad|od|hone)/i.test(F)&&/WebKit/i.test(F)?g=Oe.IOS:/Safari/i.test(F)?g=Oe.DESKTOP_SAFARI:/Firefox/i.test(F)?g=Oe.FIREFOX:(/MSIE/i.test(F)||document.documentMode)&&(g=Oe.IE),ut.cachedResult=g,ut.cachedResult}function Sr(g,F){const U=ut(),l=fs[U];let e=g,t=F,a=e*t;const o=e>t?t/e:e/t;for(;a>l*l;){const x=(l+e)/2,y=(l+t)/2;x<y?(t=y,e=y*o):(t=x*o,e=x),a=e*t}return{width:e,height:t}}function nn(g,F){let U,l;try{if(U=new OffscreenCanvas(g,F),l=U.getContext("2d"),l===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{U=document.createElement("canvas"),l=U.getContext("2d")}return U.width=g,U.height=F,[U,l]}function wr(g,F){const{width:U,height:l}=Sr(g.width,g.height),[e,t]=nn(U,l);return F&&/jpe?g/.test(F)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(g,0,0,e.width,e.height),e}function Zt(){return Zt.cachedResult!==void 0||(Zt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Zt.cachedResult}function en(g,F={}){return new Promise(function(U,l){let e,t;var a=function(){try{return t=wr(e,F.fileType||g.type),U([e,t])}catch(x){return l(x)}},o=function(x){try{var y=function(n){try{throw n}catch(s){return l(s)}};try{let n;return vr(g).then(function(s){try{return n=s,jr(n).then(function(r){try{return e=r,function(){try{return a()}catch(c){return l(c)}}()}catch(c){return y(c)}},y)}catch(r){return y(r)}},y)}catch(n){y(n)}}catch(n){return l(n)}};try{if(Zt()||[Oe.DESKTOP_SAFARI,Oe.MOBILE_SAFARI].includes(ut()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(g).then(function(x){try{return e=x,a()}catch{return o()}},o)}catch{o()}})}function tn(g,F,U,l,e=1){return new Promise(function(t,a){let o;if(F==="image/png"){let y,n,s;return y=g.getContext("2d"),{data:n}=y.getImageData(0,0,g.width,g.height),s=Le.encode([n.buffer],g.width,g.height,4096*e),o=new Blob([s],{type:F}),o.name=U,o.lastModified=l,x.call(this)}{let y=function(){return x.call(this)};if(F==="image/bmp")return new Promise(n=>br.toBlob(g,n)).then((function(n){try{return o=n,o.name=U,o.lastModified=l,y.call(this)}catch(s){return a(s)}}).bind(this),a);{let n=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&g instanceof OffscreenCanvas)return g.convertToBlob({type:F,quality:e}).then((function(s){try{return o=s,o.name=U,o.lastModified=l,n.call(this)}catch(r){return a(r)}}).bind(this),a);{let s;return s=g.toDataURL(F,e),On(s,U,l).then((function(r){try{return o=r,n.call(this)}catch(c){return a(c)}}).bind(this),a)}}}function x(){return t(o)}})}function Ze(g){g.width=0,g.height=0}function yt(){return new Promise(function(g,F){let U,l,e,t;return yt.cachedResult!==void 0?g(yt.cachedResult):On("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return U=a,en(U).then(function(o){try{return l=o[1],tn(l,U.type,U.name,U.lastModified).then(function(x){try{return e=x,Ze(l),en(e).then(function(y){try{return t=y[0],yt.cachedResult=t.width===1&&t.height===2,g(yt.cachedResult)}catch(n){return F(n)}},F)}catch(y){return F(y)}},F)}catch(x){return F(x)}},F)}catch(o){return F(o)}},F)})}function Cr(g){return new Promise((F,U)=>{const l=new yr;l.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return F(-2);const a=t.byteLength;let o=2;for(;o<a;){if(t.getUint16(o+2,!1)<=8)return F(-1);const x=t.getUint16(o,!1);if(o+=2,x==65505){if(t.getUint32(o+=2,!1)!=1165519206)return F(-1);const y=t.getUint16(o+=6,!1)==18761;o+=t.getUint32(o+4,y);const n=t.getUint16(o,y);o+=2;for(let s=0;s<n;s++)if(t.getUint16(o+12*s,y)==274)return F(t.getUint16(o+12*s+8,y))}else{if((65280&x)!=65280)break;o+=t.getUint16(o,!1)}}return F(-1)},l.onerror=e=>U(e),l.readAsArrayBuffer(g)})}function Ar(g,F){const{width:U}=g,{height:l}=g,{maxWidthOrHeight:e}=F;let t,a=g;return isFinite(e)&&(U>e||l>e)&&([a,t]=nn(U,l),U>l?(a.width=e,a.height=l/U*e):(a.width=U/l*e,a.height=e),t.drawImage(g,0,0,a.width,a.height),Ze(g)),a}function Fr(g,F){const{width:U}=g,{height:l}=g,[e,t]=nn(U,l);switch(F>4&&F<9?(e.width=l,e.height=U):(e.width=U,e.height=l),F){case 2:t.transform(-1,0,0,1,U,0);break;case 3:t.transform(-1,0,0,-1,U,l);break;case 4:t.transform(1,0,0,-1,0,l);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,l,0);break;case 7:t.transform(0,-1,-1,0,l,U);break;case 8:t.transform(0,-1,1,0,0,U)}return t.drawImage(g,0,0,U,l),Ze(g),e}function Ln(g,F,U=0){return new Promise(function(l,e){let t,a,o,x,y,n,s,r,c,m,A,D,S,z,M,R,B,j,E,f;function u(v=5){if(F.signal&&F.signal.aborted)throw F.signal.reason;t+=v,F.onProgress(Math.min(t,100))}function p(v){if(F.signal&&F.signal.aborted)throw F.signal.reason;t=Math.min(Math.max(v,t),100),F.onProgress(t)}return t=U,a=F.maxIteration||10,o=1024*F.maxSizeMB*1024,u(),en(g,F).then((function(v){try{return[,x]=v,u(),y=Ar(x,F),u(),new Promise(function(w,C){var b;if(!(b=F.exifOrientation))return Cr(g).then((function(h){try{return b=h,I.call(this)}catch(d){return C(d)}}).bind(this),C);function I(){return w(b)}return I.call(this)}).then((function(w){try{return n=w,u(),yt().then((function(C){try{return s=C?y:Fr(y,n),u(),r=F.initialQuality||1,c=F.fileType||g.type,tn(s,c,g.name,g.lastModified,r).then((function(b){try{{let h=function(){if(a--&&(M>o||M>S)){let _,T;return _=f?.95*E.width:E.width,T=f?.95*E.height:E.height,[B,j]=nn(_,T),j.drawImage(E,0,0,_,T),r*=c==="image/png"?.85:.95,tn(B,c,g.name,g.lastModified,r).then(function(P){try{return R=P,Ze(E),E=B,M=R.size,p(Math.min(99,Math.floor((z-M)/(z-o)*100))),h}catch(V){return e(V)}},e)}return[1]},d=function(){return Ze(E),Ze(B),Ze(y),Ze(s),Ze(x),p(100),l(R)};if(m=b,u(),A=m.size>o,D=m.size>g.size,!A&&!D)return p(100),l(m);var I;return S=g.size,z=m.size,M=z,E=s,f=!F.alwaysKeepResolution&&A,(I=(function(_){for(;_;){if(_.then)return void _.then(I,e);try{if(_.pop){if(_.length)return _.pop()?d.call(this):_;_=h}else _=_.call(this)}catch(T){return e(T)}}}).bind(this))(h)}}catch(h){return e(h)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const gs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let hn;function ms(g,F){return new Promise((U,l)=>{hn||(hn=function(a){const o=[];return o.push(a),URL.createObjectURL(new Blob(o))}(gs));const e=new Worker(hn);e.addEventListener("message",function(a){if(F.signal&&F.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return l(new Error(a.data.error)),void e.terminate();U(a.data.file),e.terminate()}else F.onProgress(a.data.progress)}),e.addEventListener("error",l),F.signal&&F.signal.addEventListener("abort",()=>{l(F.signal.reason),e.terminate()}),e.postMessage({file:g,imageCompressionLibUrl:F.libURL,options:{...F,onProgress:void 0,signal:void 0}})})}function Ie(g,F){return new Promise(function(U,l){let e,t,a,o,x,y;if(e={...F},a=0,{onProgress:o}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{a=c,typeof o=="function"&&o(a)},!(g instanceof Blob||g instanceof hs))return l(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(g.type))return l(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||y)return Ln(g,e).then((function(c){try{return t=c,r.call(this)}catch(m){return l(m)}}).bind(this),l);var n=(function(){try{return r.call(this)}catch(c){return l(c)}}).bind(this),s=function(c){try{return Ln(g,e).then(function(m){try{return t=m,n()}catch(A){return l(A)}},l)}catch(m){return l(m)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",ms(g,e).then(function(c){try{return t=c,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=g.name,t.lastModified=g.lastModified}catch{}try{e.preserveExif&&g.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===g.type)&&(t=pr(g,t))}catch{}return U(t)}})}Ie.getDataUrlFromFile=vr,Ie.getFilefromDataUrl=On,Ie.loadImage=jr,Ie.drawImageInCanvas=wr,Ie.drawFileInCanvas=en,Ie.canvasToFile=tn,Ie.getExifOrientation=Cr,Ie.handleMaxWidthOrHeight=Ar,Ie.followExifOrientation=Fr,Ie.cleanupCanvasMemory=Ze,Ie.isAutoOrientationInBrowser=yt,Ie.approximateBelowMaximumCanvasSizeOfBrowser=Sr,Ie.copyExifWithoutOrientation=pr,Ie.getBrowserName=ut,Ie.version="2.0.2";var gn,Wn;function Tr(){if(Wn)return gn;Wn=1;function g(F){var U=typeof F;return F!=null&&(U=="object"||U=="function")}return gn=g,gn}var mn,$n;function ps(){if($n)return mn;$n=1;var g=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return mn=g,mn}var pn,Vn;function Ir(){if(Vn)return pn;Vn=1;var g=ps(),F=typeof self=="object"&&self&&self.Object===Object&&self,U=g||F||Function("return this")();return pn=U,pn}var bn,Qn;function bs(){if(Qn)return bn;Qn=1;var g=Ir(),F=function(){return g.Date.now()};return bn=F,bn}var xn,Gn;function xs(){if(Gn)return xn;Gn=1;var g=/\s/;function F(U){for(var l=U.length;l--&&g.test(U.charAt(l)););return l}return xn=F,xn}var yn,Yn;function ys(){if(Yn)return yn;Yn=1;var g=xs(),F=/^\s+/;function U(l){return l&&l.slice(0,g(l)+1).replace(F,"")}return yn=U,yn}var vn,Zn;function kr(){if(Zn)return vn;Zn=1;var g=Ir(),F=g.Symbol;return vn=F,vn}var jn,Kn;function vs(){if(Kn)return jn;Kn=1;var g=kr(),F=Object.prototype,U=F.hasOwnProperty,l=F.toString,e=g?g.toStringTag:void 0;function t(a){var o=U.call(a,e),x=a[e];try{a[e]=void 0;var y=!0}catch{}var n=l.call(a);return y&&(o?a[e]=x:delete a[e]),n}return jn=t,jn}var Sn,Xn;function js(){if(Xn)return Sn;Xn=1;var g=Object.prototype,F=g.toString;function U(l){return F.call(l)}return Sn=U,Sn}var wn,Jn;function Ss(){if(Jn)return wn;Jn=1;var g=kr(),F=vs(),U=js(),l="[object Null]",e="[object Undefined]",t=g?g.toStringTag:void 0;function a(o){return o==null?o===void 0?e:l:t&&t in Object(o)?F(o):U(o)}return wn=a,wn}var Cn,er;function ws(){if(er)return Cn;er=1;function g(F){return F!=null&&typeof F=="object"}return Cn=g,Cn}var An,tr;function Cs(){if(tr)return An;tr=1;var g=Ss(),F=ws(),U="[object Symbol]";function l(e){return typeof e=="symbol"||F(e)&&g(e)==U}return An=l,An}var Fn,nr;function As(){if(nr)return Fn;nr=1;var g=ys(),F=Tr(),U=Cs(),l=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt;function x(y){if(typeof y=="number")return y;if(U(y))return l;if(F(y)){var n=typeof y.valueOf=="function"?y.valueOf():y;y=F(n)?n+"":n}if(typeof y!="string")return y===0?y:+y;y=g(y);var s=t.test(y);return s||a.test(y)?o(y.slice(2),s?2:8):e.test(y)?l:+y}return Fn=x,Fn}var Tn,rr;function Fs(){if(rr)return Tn;rr=1;var g=Tr(),F=bs(),U=As(),l="Expected a function",e=Math.max,t=Math.min;function a(o,x,y){var n,s,r,c,m,A,D=0,S=!1,z=!1,M=!0;if(typeof o!="function")throw new TypeError(l);x=U(x)||0,g(y)&&(S=!!y.leading,z="maxWait"in y,r=z?e(U(y.maxWait)||0,x):r,M="trailing"in y?!!y.trailing:M);function R(C){var b=n,I=s;return n=s=void 0,D=C,c=o.apply(I,b),c}function B(C){return D=C,m=setTimeout(f,x),S?R(C):c}function j(C){var b=C-A,I=C-D,h=x-b;return z?t(h,r-I):h}function E(C){var b=C-A,I=C-D;return A===void 0||b>=x||b<0||z&&I>=r}function f(){var C=F();if(E(C))return u(C);m=setTimeout(f,j(C))}function u(C){return m=void 0,M&&n?R(C):(n=s=void 0,c)}function p(){m!==void 0&&clearTimeout(m),D=0,n=A=s=m=void 0}function v(){return m===void 0?c:u(F())}function w(){var C=F(),b=E(C);if(n=arguments,s=this,A=C,b){if(m===void 0)return B(A);if(z)return clearTimeout(m),m=setTimeout(f,x),R(A)}return m===void 0&&(m=setTimeout(f,x)),c}return w.cancel=p,w.flush=v,w}return Tn=a,Tn}var Ts=Fs();const Is=tt(Ts);var kt={},sr;function ks(){if(sr)return kt;sr=1;var g=ot();Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var F=g(lt()),U=at();return kt.default=(0,F.default)([(0,U.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,U.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),kt}var Ds=ks();const Us=tt(Ds);var Dt={},ir;function Rs(){if(ir)return Dt;ir=1;var g=ot();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var F=g(lt()),U=at();return Dt.default=(0,F.default)((0,U.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),Dt}var _s=Rs();const Es=tt(_s);var Ut={},or;function Ms(){if(or)return Ut;or=1;var g=ot();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var F=g(lt()),U=at();return Ut.default=(0,F.default)((0,U.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Ut}var Os=Ms();const zs=tt(Os);var Rt={},ar;function Bs(){if(ar)return Rt;ar=1;var g=ot();Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default=void 0;var F=g(lt()),U=at();return Rt.default=(0,F.default)([(0,U.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,U.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Rt}var Ns=Bs();const Ps=tt(Ns),ft=q.forwardRef(({path:g,initialImages:F=[],onImagesUpdated:U,onDelete:l,isOwnDesign:e},t)=>{const[a,o]=q.useState(F.map(d=>({...d,deleted:!1}))),[x,y]=q.useState(!1),[n,s]=q.useState(0),[r,c]=q.useState(!1),[m,A]=q.useState(null),[D,S]=q.useState(1),[z,M]=q.useState(!1),[R,B]=q.useState(!1),[j,E]=q.useState(""),[f,u]=q.useState("info"),p=q.useRef(null);q.useEffect(()=>{console.log("Initial images received:",F),o(F.map(d=>({...d,deleted:!!d.deleted})))},[F]);const v=async d=>{const _=Array.from(d.target.files||[]);y(!0);const T={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},P=_.map(async(V,H)=>{let $=V;V.size>1024*1024&&($=await Ie(V,T),E("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),B(!0));const O=`${new Date().getTime()}-${$.name}`,X=vt(),re=jt(X,`${g}/${O}`),J=fr(re,$);return new Promise((te,le)=>{J.on("state_changed",ie=>{const he=ie.bytesTransferred/ie.totalBytes*100;s(he)},ie=>{console.error("Upload failed:",ie),le(ie)},()=>{hr(J.snapshot.ref).then(ie=>{te({url:ie,path:re.fullPath,title:""})})})})});Promise.all(P).then(V=>{const H=[...a,...V];o(H),U&&U(H),E("Images uploaded successfully."),u("success"),B(!0),y(!1),s(0),p.current&&(p.current.value="")}).catch(V=>{console.error("Error uploading images: ",V),E("Failed to upload images."),u("error"),B(!0),y(!1),s(0)})},w=d=>{o(_=>{const T=_.map((P,V)=>V===d?{...P,deleted:!0}:P);return U(T),T}),E("Image marked for deletion. Update to permanently delete."),u("info"),B(!0)},C=async()=>{const d=a.filter(_=>_.deleted);if(console.log("Attempting to delete images:",d),d.length>0){const _=d.map(T=>{const P=vt(),V=jt(P,T.path);return Yt(V)});try{await Promise.all(_),l(d),o(T=>T.filter(P=>!P.deleted)),E("Deleted images have been permanently removed."),u("success")}catch(T){console.error("Error committing deletions:",T),E("Failed to commit deletions."),u("error")}B(!0)}else console.log("No images marked for deletion.")},b=d=>{M(!z),A(d)};q.useEffect(()=>{const d=()=>{const _=!!document.fullscreenElement;M(_)};return document.addEventListener("fullscreenchange",d),()=>document.removeEventListener("fullscreenchange",d)},[]);const I=(d,_)=>{_!=="clickaway"&&B(!1)},h=q.useCallback(Is((d,_)=>{setTimeout(()=>{o(T=>{const P=T.map((V,H)=>H===d?{...V,title:_}:V);return U&&U(P),P})},0)},30),[U]);return q.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Kt,{title:"Upload Images",children:i.jsxs(ke,{variant:"outlined",component:"label",startIcon:i.jsx(Ps,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:v,disabled:x,ref:p,accept:"image/*"})]})}),x&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),a.filter(d=>!d.deleted).map((d,_)=>i.jsxs("div",{children:[i.jsx("img",{src:d.url,alt:`Uploaded design ${_}`,onClick:()=>{c(!0),A(_)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Pe,{onClick:()=>w(_),children:i.jsx(Ht,{})}),i.jsx("textarea",{value:d.title,onChange:T=>h(_,T.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},_)),i.jsx(ht,{open:r,onClose:()=>c(!1),fullScreen:z,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:z?"none":void 0,maxHeight:z?"none":void 0,height:z?"100%":void 0,width:z?"100%":void 0,overflowY:"auto"}},children:m!==null&&i.jsxs(gt,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:a[m].url,alt:`Zoomed Design ${m}`,style:{maxWidth:"100%",maxHeight:z?"100vh":void 0,transform:`scale(${D})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Pe,{onClick:()=>S(D*1.2),children:i.jsx(Us,{})}),i.jsx(Pe,{onClick:()=>S(D/1.2),style:{marginLeft:"10px"},children:i.jsx(Es,{})}),i.jsx(Pe,{onClick:()=>b(m),style:{marginLeft:"10px"},children:i.jsx(zs,{})}),z&&i.jsx(Pe,{onClick:()=>b(m),style:{position:"absolute",top:20,right:20},children:i.jsx(ss,{})})]})]})}),i.jsx(mt,{open:R,autoHideDuration:6e3,onClose:I,children:i.jsx(pt,{onClose:I,severity:f,sx:{width:"100%"},children:j})})]})});ft.displayName="ImageUpload";const Ke=({onChange:g,initialValue:F})=>{const[U,l]=q.useState(fn.sanitize(F||"")),e=q.useRef(!1),t=q.useRef(null),[a,o]=q.useState("");q.useEffect(()=>{e.current?l(fn.sanitize(F||"")):e.current=!0},[F]);const x=(A,D,S,z)=>{const M=fn.sanitize(A);l(M),g(M)},y=A=>{if(!t.current){console.warn("Editor not initialized");return}const D=t.current.getEditor(),S=D.getSelection();if(S)D.insertText(S.index,A),D.setSelection(S.index+A.length);else{const z=D.getText().length;D.insertText(z,A),D.setSelection(z+A.length)}o(""),D.focus()},n=A=>{y(A.target.value)},s=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],r=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"],c={toolbar:[[{header:[1,2,3,!1]}],["bold","italic"],[{list:"ordered"},{list:"bullet"}],["blockquote",{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},m=["header","bold","italic","list","blockquote","indent","link"];return i.jsxs("div",{children:[i.jsxs(Fe,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginBottom:2},children:[i.jsx(Qr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(Hn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(kn,{labelId:"math-operators-label",id:"math-operators",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(Bt,{value:"",disabled:!0,children:"Math"}),r.map(A=>i.jsx(Bt,{value:A,children:A},A))]})}),i.jsx(Hn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(kn,{labelId:"greek-letters-label",id:"greek-letters",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(Bt,{value:"",disabled:!0,children:"Greek"}),s.map(A=>i.jsx(Bt,{value:A,children:A},A))]})})]}),i.jsx(is,{ref:t,value:U,onChange:x,modules:c,formats:m,theme:"snow",placeholder:"Start writing...",style:{backgroundColor:"white",borderRadius:"4px",minHeight:"200px"}})]})};var _t={},lr;function qs(){if(lr)return _t;lr=1;var g=ot();Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var F=g(lt()),U=at();return _t.default=(0,F.default)((0,U.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),_t}var Hs=qs();const Dn=tt(Hs);var Et={},dr;function Ls(){if(dr)return Et;dr=1;var g=ot();Object.defineProperty(Et,"__esModule",{value:!0}),Et.default=void 0;var F=g(lt()),U=at();return Et.default=(0,F.default)((0,U.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Et}var Ws=Ls();const $s=tt(Ws);var Mt={},cr;function Vs(){if(cr)return Mt;cr=1;var g=ot();Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var F=g(lt()),U=at();return Mt.default=(0,F.default)((0,U.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Mt}var Qs=Vs();const Gs=tt(Qs),wt=({path:g,initialFiles:F,onFilesChange:U,isOwnDesign:l})=>{const[e,t]=q.useState(F.map(p=>({...p,deleted:!!p.deleted}))),[a,o]=q.useState(!1),[x,y]=q.useState(0),[n,s]=q.useState({}),[r,c]=q.useState(!1),[m,A]=q.useState(""),[D,S]=q.useState("info"),z=q.useRef(null);q.useEffect(()=>{console.log("Initial files received:",F),t(F.map(p=>({...p,deleted:!!p.deleted})))},[F]),q.useEffect(()=>()=>{s({})},[]);const M=p=>{console.log("Updating files with",p),U(p),t(p)},R=async p=>{if(!p.target.files)return;const w=Array.from(p.target.files).filter(b=>b.size>5242880?(A("File size should not exceed 5 MB"),S("error"),c(!0),!1):!0);o(!0);const C=w.map(b=>{const I=new Date().getTime(),h=`${I}-${b.name}`,d=vt(),_=jt(d,`${g}/${h}`),T=fr(_,b);return new Promise((P,V)=>{T.on("state_changed",H=>{const $=H.bytesTransferred/H.totalBytes*100;y($)},H=>{console.error("Upload failed:",H),V(H)},()=>{hr(T.snapshot.ref).then(H=>{P({id:I.toString(),url:H,name:b.name,path:_.fullPath})})})})});Promise.all(C).then(b=>{const I=[...e.filter(h=>!h.deleted),...b];M(I),A("Files uploaded successfully."),S("success"),c(!0),o(!1),y(0),z.current&&(z.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),A("Failed to upload files."),S("error"),c(!0),o(!1),y(0)})},B=p=>{const v=e.map(w=>w.id===p?{...w,deleted:!0}:w);M(v),A("File marked for deletion. Update to permanently delete."),S("info"),c(!0)},j=p=>{s(v=>{var w;return{...v,[p]:((w=e.find(C=>C.id===p))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},E=p=>{t(v=>{const w=v.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return U(w),w}),s(v=>{const w={...v};return delete w[p],w}),A("File name updated successfully."),S("info"),c(!0)},f=(p,v)=>{s(w=>({...w,[p]:v}))},u=(p,v)=>{v!=="clickaway"&&c(!1)};return i.jsxs("div",{children:[l&&i.jsx(Kt,{title:"Upload Files",children:i.jsxs(ke,{variant:"outlined",component:"label",startIcon:i.jsx(Gs,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:R,disabled:a,ref:z})]})}),a&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(x),"%"]})}),i.jsx(Gr,{children:e.map(p=>i.jsxs(Yr,{style:{opacity:p.deleted?.5:1},children:[i.jsx(Zr,{children:i.jsx($s,{})}),typeof n[p.id]=="string"?i.jsx(qt,{variant:"outlined",size:"small",value:n[p.id],onChange:v=>f(p.id,v.target.value),onKeyPress:v=>v.key==="Enter"&&E(p.id),fullWidth:!0}):i.jsx(Kr,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),l&&(typeof n[p.id]=="string"?i.jsx(Pe,{onClick:()=>E(p.id),edge:"end","aria-label":"save",children:i.jsx(Dn,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Pe,{onClick:()=>j(p.id),edge:"end","aria-label":"edit",children:i.jsx(gr,{})}),i.jsx(Pe,{onClick:()=>B(p.id),edge:"end","aria-label":"delete",children:i.jsx(Ht,{})})]}))]},p.id))}),i.jsx(mt,{open:r,autoHideDuration:6e3,onClose:u,children:i.jsx(pt,{onClose:u,severity:D,sx:{width:"100%"},children:m})})]})},Ys=({designs:g,setDesigns:F,setIsAdding:U,getDesigns:l,onReturnToDashboard:e})=>{const{userDetails:t}=$t(),a=Un(),o=Rn(a.breakpoints.down("md")),x=Object.entries((t==null?void 0:t.classes)||{}).map(([_,T])=>({id:_,number:T.number,title:T.title,isCourseAdmin:T.isCourseAdmin}));console.log("Add Design loaded");const[y,n]=q.useState(""),[s,r]=q.useState(""),[c,m]=q.useState(""),[A,D]=q.useState([]),[S,z]=q.useState([]),M=q.useMemo(()=>A,[A]),[R,B]=q.useState(!1),[j,E]=q.useState(""),[f,u]=q.useState("info"),[p,v]=q.useState(!1),[w,C]=q.useState("");console.log("Adding New Design from user:",t);const b=q.useRef(null),I=()=>{v(!1)},h=(_,T)=>{T!=="clickaway"&&B(!1)};q.useEffect(()=>{if(t!=null&&t.classes){const _=Object.keys(t.classes)[0];r(_||"")}},[t==null?void 0:t.classes]);const d=async _=>{var H;if(_.preventDefault(),console.log("Files to be saved:",S),!t||!t.uid){console.error("User object is undefined or missing UID."),C("You must be signed in to add a design."),v(!0);return}if(!y){C("All fields are required."),v(!0);return}await((H=b.current)==null?void 0:H.commitDeletions());const T=A.filter($=>!$.deleted),P=S.filter($=>!$.deleted).map($=>({id:$.id,url:$.url,name:$.name,path:$.path})),V={title:c,description:y,course:s,dateCreated:Lt(),dateModified:Lt(),images:T,files:P,userId:t.uid};try{const $=await En(Te(se,"designs"),V),L={...V,id:$.id};F([...g,L]),E(`${c} has been Added.`),u("success"),B(!0),m(""),n(""),D([]),z([]),setTimeout(()=>{U(!1),l()},1e3)}catch($){console.log($),C("There was an issue adding your design."),v(!0)}};return i.jsxs(Fe,{sx:{p:o?ne[3]:ne[6],backgroundColor:K.background.primary,minHeight:"100vh"},children:[i.jsxs(Fe,{sx:{mb:ne[6]},children:[i.jsx(ke,{variant:"text",onClick:e,sx:{fontFamily:Z.fontFamily.secondary,fontSize:o?Z.fontSize.base:Z.fontSize.lg,color:K.primary[600],textTransform:"none",fontWeight:Z.fontWeight.medium,mb:ne[4],"&:hover":{backgroundColor:K.primary[100],color:K.primary[700]},transition:Pt.transitions.fast},children:"← All Designs"}),i.jsxs(Nt,{sx:{p:o?ne[4]:ne[6],backgroundColor:K.primary[50],borderRadius:Be["2xl"],border:`1px solid ${K.primary[200]}`,boxShadow:$e.sm},children:[i.jsx(Ve,{variant:"h2",sx:{fontFamily:Z.fontFamily.display,fontSize:o?Z.fontSize["3xl"]:Z.fontSize["5xl"],fontWeight:Z.fontWeight.bold,color:K.primary[700],lineHeight:Z.lineHeight.tight,mb:ne[2]},children:"Create New Design"}),i.jsx(Ve,{variant:"body1",sx:{fontFamily:Z.fontFamily.primary,fontSize:o?Z.fontSize.base:Z.fontSize.lg,color:K.text.secondary,lineHeight:Z.lineHeight.relaxed},children:"Design and document your laboratory experiments and research projects"})]})]}),i.jsx(Nt,{sx:{p:o?ne[4]:ne[6],backgroundColor:K.background.elevated,borderRadius:Be["2xl"],border:`1px solid ${K.neutral[200]}`,boxShadow:$e.lg},children:i.jsxs("form",{onSubmit:d,children:[i.jsx(Fe,{sx:{mb:ne[5]},children:i.jsx(qt,{id:"title",label:"Design Title",value:c,onChange:_=>m(_.target.value),fullWidth:!0,required:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:Be.lg,fontFamily:Z.fontFamily.primary,fontSize:Z.fontSize.base},"& .MuiInputLabel-root":{fontFamily:Z.fontFamily.secondary,fontSize:Z.fontSize.base,fontWeight:Z.fontWeight.medium}}})}),i.jsx(Fe,{sx:{mb:ne[5]},children:i.jsx(os,{value:s,onChange:r,courses:x,label:"Course",placeholder:"Select a course",helperText:"Choose the course this design belongs to",required:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,showNumber:!0,showTitle:!0,showAdminBadge:!1})}),i.jsxs(Fe,{sx:{mb:ne[5]},children:[i.jsx(Ve,{variant:"h5",sx:{fontFamily:Z.fontFamily.display,fontSize:Z.fontSize.xl,fontWeight:Z.fontWeight.semibold,color:K.text.primary,mb:ne[3]},children:"Design Description"}),i.jsxs(Nt,{sx:{p:ne[4],backgroundColor:K.background.secondary,borderRadius:Be.lg,border:`1px solid ${K.neutral[200]}`,mb:ne[3]},children:[i.jsx(Ve,{variant:"body2",sx:{fontFamily:Z.fontFamily.primary,fontSize:Z.fontSize.sm,color:K.text.secondary,mb:ne[2],fontWeight:Z.fontWeight.medium},children:"Please include the following elements in your description:"}),i.jsxs(Fe,{component:"ul",sx:{pl:ne[4],m:0,"& li":{fontFamily:Z.fontFamily.primary,fontSize:Z.fontSize.sm,color:K.text.secondary,mb:ne[1]}},children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]})]}),i.jsx(Ke,{onChange:n,initialValue:y})]}),i.jsx(Xr,{sx:{my:ne[5]}}),i.jsxs(Fe,{sx:{mb:ne[5]},children:[i.jsx(Ve,{variant:"h5",sx:{fontFamily:Z.fontFamily.display,fontSize:Z.fontSize.xl,fontWeight:Z.fontWeight.semibold,color:K.text.primary,mb:ne[3]},children:"Attachments"}),i.jsx(ft,{ref:b,path:"designs/images",initialImages:M,onImagesUpdated:D,onDelete:_=>D(A.filter(T=>!_.includes(T))),isOwnDesign:!0}),i.jsx(Fe,{sx:{mt:ne[4]},children:i.jsx(wt,{path:"designs/files",initialFiles:S,onFilesChange:z,isOwnDesign:!0})})]}),i.jsxs(Fe,{sx:{display:"flex",justifyContent:"flex-end",gap:ne[3],mt:ne[6],flexDirection:o?"column":"row"},children:[i.jsx(ke,{onClick:()=>U(!1),variant:"outlined",sx:{fontFamily:Z.fontFamily.display,fontSize:Z.fontSize.lg,fontWeight:Z.fontWeight.semibold,textTransform:"none",px:ne[6],py:ne[3],borderRadius:Be.xl,borderColor:K.error,color:K.error,"&:hover":{borderColor:K.error,backgroundColor:K.error+"10",boxShadow:$e.md},transition:Pt.transitions.fast},children:"Cancel"}),i.jsx(ke,{type:"submit",variant:"contained",sx:{fontFamily:Z.fontFamily.display,fontSize:Z.fontSize.lg,fontWeight:Z.fontWeight.semibold,textTransform:"none",px:ne[6],py:ne[3],backgroundColor:K.primary[500],borderRadius:Be.xl,boxShadow:$e.md,"&:hover":{backgroundColor:K.primary[600],boxShadow:$e.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"},transition:Pt.transitions.fast},children:"Create Design"})]})]})}),i.jsxs(ht,{open:p,onClose:I,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",PaperProps:{sx:{borderRadius:Be["2xl"],boxShadow:$e.xl}},children:[i.jsx(Ct,{id:"alert-dialog-title",sx:{fontFamily:Z.fontFamily.display,fontSize:Z.fontSize.xl,fontWeight:Z.fontWeight.semibold,color:K.text.primary},children:"Notification"}),i.jsx(gt,{children:i.jsx(Wt,{id:"alert-dialog-description",sx:{fontFamily:Z.fontFamily.primary,fontSize:Z.fontSize.base,color:K.text.secondary},children:w})}),i.jsx(At,{children:i.jsx(ke,{onClick:I,autoFocus:!0,sx:{fontFamily:Z.fontFamily.display,fontSize:Z.fontSize.base,fontWeight:Z.fontWeight.medium,textTransform:"none",borderRadius:Be.lg},children:"Ok"})})]}),i.jsx(mt,{open:R,autoHideDuration:1e3,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:i.jsx(pt,{onClose:h,severity:f,sx:{width:"100%",borderRadius:Be.lg,fontFamily:Z.fontFamily.primary,fontSize:Z.fontSize.base},children:j})})]})},Zs=({designId:g,setIsAddingBuild:F,refreshBuilds:U})=>{const[l,e]=q.useState(""),[t,a]=q.useState(""),[o,x]=q.useState([]),[y,n]=q.useState([]),{userDetails:s}=$t(),r=v=>{x(v)},c=v=>{n(v)};console.log("AddBuild loaded");const[m,A]=q.useState(!1),[D,S]=q.useState(""),[z,M]=q.useState(!1),[R,B]=q.useState(""),[j,E]=q.useState("info");console.log("Adding New Build by user:",s);const f=()=>{A(!1)},u=(v,w)=>{w!=="clickaway"&&M(!1)},p=async v=>{if(v.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),A(!0);return}if(!t){S("Build description is required."),A(!0);return}const w=o.filter(b=>!b.deleted),C=y.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await En(Te(se,"builds"),{title:l,description:t,design_ID:g,dateCreated:Lt(),userId:s.uid,images:w,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",s),B("Your build has been successfully added."),E("success"),M(!0),setTimeout(()=>{e(""),a(""),x([]),n([]),F(!1),U()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let I=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(I="You do not have permission to perform this operation."),B(I),E("error"),M(!0)}else B("Failed to add the build. Please try again later."),E("error"),M(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:l,onChange:v=>e(v.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(Ke,{onChange:a,initialValue:t})," ",i.jsx(ft,{path:`builds/${g}/images`,initialImages:o,onImagesUpdated:r,onDelete:v=>x(w=>w.filter(C=>!v.includes(C))),isOwnDesign:!0}),i.jsx(wt,{path:`builds/${g}/files`,initialFiles:y,onFilesChange:c,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>F(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(ht,{open:m,onClose:f,children:[i.jsx(Ct,{children:"Notification"}),i.jsx(gt,{children:i.jsx(Wt,{children:D})}),i.jsx(At,{children:i.jsx(ke,{onClick:f,children:"OK"})})]}),i.jsx(mt,{open:z,autoHideDuration:6e3,onClose:u,children:i.jsx(pt,{onClose:u,severity:j,sx:{width:"100%"},children:R})})]})},Ks=({designId:g,buildId:F,refreshTests:U,setAddingTestIdForBuild:l})=>{const[e,t]=q.useState(""),[a,o]=q.useState(""),[x,y]=q.useState(""),[n,s]=q.useState(""),[r,c]=q.useState([]),[m,A]=q.useState([]),{userDetails:D}=$t();console.log("AddTest loaded");const[S,z]=q.useState(!1),[M,R]=q.useState(""),[B,j]=q.useState(!1),[E,f]=q.useState(""),[u,p]=q.useState("info"),v=C=>{A(C)},w=async()=>{if(!a){R("Test description cannot be empty!"),z(!0);return}const C=r.filter(I=>!I.deleted),b=m.filter(I=>!I.deleted).map(I=>({id:I.id,url:I.url,name:I.name,path:I.path}));try{await En(Te(se,"tests"),{title:e,build_ID:F,design_ID:g,dateCreated:Lt(),description:a,results:x,conclusions:n,userId:D==null?void 0:D.uid,images:C,files:b}),setTimeout(()=>{U(F),t(""),o(""),y(""),s(""),c([]),A([]),l(!1)},1e3),f("Test added successfully"),p("success"),j(!0)}catch(I){console.error("Error adding test: ",I),f("Failed to add the test"),p("error"),j(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(Ke,{onChange:o,initialValue:a}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(Ke,{onChange:y,initialValue:x}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(Ke,{onChange:s,initialValue:n}),i.jsx(ft,{path:`tests/${F}/images`,initialImages:r,onImagesUpdated:C=>{c(C)},onDelete:C=>c(b=>b.filter(I=>!C.includes(I))),isOwnDesign:!0}),i.jsx(wt,{path:`tests/${F}/files`,initialFiles:m,onFilesChange:v,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>l(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(ht,{open:S,onClose:()=>z(!1),children:[i.jsx(Ct,{children:"Notification"}),i.jsx(gt,{children:i.jsx(Wt,{children:M})}),i.jsx(At,{children:i.jsx(ke,{onClick:()=>z(!1),children:"OK"})})]}),i.jsx(mt,{open:B,autoHideDuration:6e3,onClose:()=>j(!1),children:i.jsx(pt,{onClose:()=>j(!1),severity:u,sx:{width:"100%"},children:E})})]})};var Ot={},ur;function Xs(){if(ur)return Ot;ur=1;var g=ot();Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var F=g(lt()),U=at();return Ot.default=(0,F.default)((0,U.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),Ot}var Js=Xs();const In=tt(Js),zt=g=>g&&g instanceof _n?g.toDate().toLocaleString():"",ei=({selectedDesign:g,setIsEditing:F,onReturnToDashboard:U})=>{const{userDetails:l,loading:e}=$t(),t=g.id,a=g.userId===(l==null?void 0:l.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",l);const[o,x]=q.useState(""),[y,n]=q.useState(g.description),[s,r]=q.useState(g.course||""),[c,m]=q.useState(zt(g.dateCreated)),[A,D]=q.useState(zt(g.dateModified)),[S,z]=q.useState([]),[M,R]=q.useState([]),B=q.useRef(null),[j,E]=q.useState(!1),[f,u]=q.useState([]),[p,v]=q.useState({}),[w,C]=q.useState({}),[b,I]=q.useState({}),h=q.useRef(null),[d,_]=q.useState({}),[T,P]=q.useState({}),[V,H]=q.useState({}),[$,L]=q.useState(!1),[O,X]=q.useState({}),[re,J]=q.useState({}),[te,le]=q.useState({}),[ie,he]=q.useState({}),[Ne,De]=q.useState({}),ge=q.useRef(null),[ye,me]=q.useState({}),[de,be]=q.useState({}),[ve,pe]=q.useState({}),[Ue,ce]=q.useState(!1),[fe,je]=q.useState(""),[Qe,nt]=q.useState(()=>()=>{}),[Se,ue]=q.useState(!1),[Ae,oe]=q.useState(""),[Ee,ae]=q.useState("info"),[Re,we]=q.useState({design:!1,builds:!1,tests:!1}),Ft=async k=>{if(k.preventDefault(),!y){je("All fields are required."),ce(!0);return}console.log("About to check image deletions",B.current),console.log(B.current),console.log(S.some(Q=>Q.deleted)),B.current&&S.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await B.current.commitDeletions());const W=S.filter(Q=>!Q.deleted);M.some(Q=>Q.deleted)&&await Vt();const N=M.filter(Q=>!Q.deleted),Y={title:o,description:y,course:s,dateModified:Lt(),images:W.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:N.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:l.uid};try{await st(Ce(se,"designs",t),Y,{merge:!0}),oe("Your design has been updated."),ae("success"),ue(!0);const Q=_n.now();D(zt(Q))}catch(Q){console.error("Error updating design:",Q),oe("There was an issue updating your design."),ae("error"),ue(!0)}we(Q=>({...Q,design:!1}))};q.useEffect(()=>{g&&(n(g.description||""),x(g.title||""),r(g.course||""),(async()=>{const W=Ce(se,"designs",t),N=await as(W);if(N.exists()){const Y=N.data();console.log("Fetched images:",Y.images),console.log("Fetched files:",Y.files),z(Y.images||[]),R(Y.files||[]),m(zt(Y.dateCreated)),D(zt(Y.dateModified))}})())},[g,t]);const rn=k=>{const W=S.filter(Y=>!k.some(Q=>Q.path===Y.path));console.log("Remaining images after deletion:",W),z(W);const N=W.map(Y=>({url:Y.url,title:Y.title,path:Y.path}));st(Ce(se,"designs",t),{images:N},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Y=>console.error("Failed to update Firestore:",Y))},Tt=k=>{JSON.stringify(S)!==JSON.stringify(k)&&(z(k),console.log("Updated images received:",k))},Vt=async()=>{const k=M.filter(W=>W.deleted);if(console.log("Files to delete:",k),k.length>0){const W=vt(),N=k.map(Y=>{const Q=jt(W,Y.path);return Yt(Q)});try{await Promise.all(N),console.log("Files deleted successfully");const Y=M.filter(Q=>!Q.deleted);R(Y),await un(Ce(se,"designs",g.id),{files:Y.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),oe("Deleted files have been permanently removed."),ae("success"),ue(!0)}catch(Y){console.error("Failed to delete files: ",Y),oe("Failed to delete files."),ae("error"),ue(!0)}}},dt=async k=>{var Q,ee;try{await Dr(k)}catch(G){console.error("Error deleting files:",G),oe("Failed to delete build files."),ae("error"),ue(!0)}const W=((Q=w[k])==null?void 0:Q.filter(G=>!G.deleted).map(({url:G,path:_e,title:Je})=>({url:G,path:_e,title:Je})))||[],N=((ee=b[k])==null?void 0:ee.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[],Y={};W.length>0&&(Y.images=W),N.length>0&&(Y.files=N),p[k]!==void 0&&(Y.description=p[k]);try{const G=Ce(se,"builds",k);await st(G,Y,{merge:!0}),oe("Your build has been updated."),ae("success"),ue(!0),He(),we(_e=>({..._e,builds:!1}))}catch(G){console.error("Error updating build:",G),oe("Failed to update build."),ae("error"),ue(!0)}},sn=(k,W)=>{P(N=>({...N,[k]:W}))},Ge=(k,W)=>{v(N=>({...N,[k]:W})),we(N=>({...N,builds:!0}))},qe=async k=>{const W=T[k];try{const N=Ce(se,"builds",k);await st(N,{title:W},{merge:!0}),P(Y=>{const Q={...Y};return delete Q[k],Q}),He()}catch(N){console.error("Failed to save build title:",N)}},He=async()=>{if(!l){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",l==null?void 0:l.uid),console.log("Selected design ID for query:",g==null?void 0:g.id);let k;l.isAdmin?k=Me(Te(se,"builds"),xe("design_ID","==",t),We("dateCreated")):k=Me(Te(se,"builds"),xe("design_ID","==",t),xe("userId","==",l.uid),We("dateCreated")),console.log("Builds query details:",JSON.stringify(k,null,2));const W=await it(k);console.log("Builds snapshot details:",JSON.stringify(W.docs.map(Y=>Y.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",W.docs.length);const N=W.docs.map(Y=>(console.log("Build doc path: ",Y.ref.path),{id:Y.id,...Y.data()}));u(N),console.log("New builds state after refresh:",N)}catch(k){console.error("Error refreshing builds:",k),k.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",k):console.error("An unexpected error occurred when trying to refresh builds:",k)}},ct=(k,W)=>{const N=Ce(se,"builds",k),Y=w[k].filter(ee=>!W.some(G=>G.path===ee.path));C(ee=>({...ee,[k]:Y}));const Q=Y.map(ee=>({url:ee.url,title:ee.title,path:ee.path}));st(N,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),oe("Build Image deletions updated."),ae("success")}).catch(ee=>{console.error("Failed to update build images in Firestore:",ee),oe("Failed to update build image deletions."),ae("error")}),ue(!0)},Qt=async k=>{const W=Me(Te(se,"tests"),xe("build_ID","==",k),xe("userId","==",l.uid)),N=await it(W);for(const Y of N.docs)await St(Ce(se,"tests",Y.id));await St(Ce(se,"builds",k)),await He(),oe("Build and its tests (if any) deleted successfully."),ae("success"),ue(!0)},Xe=k=>{je("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),nt(()=>()=>Qt(k)),ce(!0)},Ye=(k,W)=>{C(N=>({...N,[k]:W}))},zn=(k,W)=>{I(N=>({...N,[k]:W}))},Dr=async k=>{var N;const W=((N=b[k])==null?void 0:N.filter(Y=>Y.deleted))||[];if(console.log("Build files to delete:",W),W.length>0){const Y=vt(),Q=W.map(ee=>{const G=jt(Y,ee.path);return Yt(G)});try{await Promise.all(Q),console.log("Build files deleted successfully");const ee=b[k].filter(G=>!G.deleted);I(G=>({...G,[k]:ee})),await un(Ce(se,"builds",k),{files:ee.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),console.log("Firestore successfully updated to remove deleted files"),oe("Deleted build files have been permanently removed."),ae("success"),ue(!0)}catch(ee){console.error("Failed to delete build files: ",ee),oe("Failed to delete build files."),ae("error"),ue(!0)}}},Ur=async(k,W)=>{var ee;try{await zr(k)}catch(G){console.error("Error deleting files:",G),oe("Failed to delete build files."),ae("error"),ue(!0)}const N={},Y=ie[k].filter(G=>!G.deleted).map(({url:G,path:_e,title:Je})=>({url:G,path:_e,title:Je})),Q=((ee=Ne[k])==null?void 0:ee.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[];O[k]!==void 0&&(N.description=O[k]),re[k]!==void 0&&(N.results=re[k]),te[k]!==void 0&&(N.conclusions=te[k]),N.images=Y,N.files=Q;try{const G=Ce(se,"tests",k);await st(G,N,{merge:!0}),oe("Your test has been updated."),ae("success"),ue(!0),Gt(W)}catch(G){console.error(`Error updating test ID: ${k}:`,G),oe("There was an issue updating your test."),ae("error"),ue(!0)}},Rr=(k,W)=>{be(N=>({...N,[k]:W}))},Bn=async(k,W)=>{const N=de[k],Y=Ce(se,"tests",k);await st(Y,{title:N},{merge:!0}),be(Q=>{const ee={...Q};return delete ee[k],ee}),Gt(W)},_r=(k,W)=>{console.log(`Updating description for test ID ${k}:`,W),X(N=>({...N,[k]:W})),we(N=>({...N,tests:!0}))},Er=(k,W)=>{console.log(`Updating results for test ID ${k}:`,W),J(N=>({...N,[k]:W})),we(N=>({...N,tests:!0}))},Mr=(k,W)=>{le(N=>({...N,[k]:W})),we(N=>({...N,tests:!0}))};q.useEffect(()=>{!e&&l&&(async()=>{if(!l)return;let W;l.isAdmin?W=Me(Te(se,"builds"),xe("design_ID","==",t),We("dateCreated")):W=Me(Te(se,"builds"),xe("design_ID","==",t),xe("userId","==",l.uid),We("dateCreated"));const N=await it(W),Y=[],Q={},ee={};for(const G of N.docs){const _e=G.data(),Je=G.id;Y.push({id:Je,..._e,images:_e.images||[],files:_e.files||[]}),ee[Je]=!0;let on;l.isAdmin?on=Me(Te(se,"tests"),xe("build_ID","==",Je),We("dateCreated")):on=Me(Te(se,"tests"),xe("build_ID","==",Je),xe("userId","==",l.uid),We("dateCreated"));const Hr=await it(on),qn=[],an={},ln={};for(const rt of Hr.docs){const et=rt.data();qn.push({id:rt.id,...et}),an[rt.id]=et.images||[],ln[rt.id]=et.files||[]}Q[Je]=qn,he(rt=>{const et={...rt};for(const It in an)et[It]=an[It];return et}),De(rt=>{const et={...rt};for(const It in ln)et[It]=ln[It];return et})}u(Y),H(Q),pe(ee)})()},[e,l,g.id,t]);const Gt=async k=>{if(!l){console.log("User details not loaded yet");return}try{let W;l.isAdmin?W=Me(Te(se,"tests"),xe("build_ID","==",k),We("dateCreated")):W=Me(Te(se,"tests"),xe("build_ID","==",k),xe("userId","==",l.uid),We("dateCreated"));const Y=(await it(W)).docs.map(G=>{const _e=G.data();return{id:G.id,..._e,images:_e.images||[],files:_e.files||[]}});H(G=>({...G,[k]:Y}));const Q={},ee={};Y.forEach(G=>{Q[G.id]=G.images,ee[G.id]=G.files}),he(Q),De(ee)}catch(W){console.error("Error fetching tests:",W)}},Or=(k,W)=>{const N=Ce(se,"tests",k),Y=ie[k].filter(ee=>!W.includes(ee));he(ee=>({...ee,[k]:Y}));const Q=Y.map(({url:ee,path:G,title:_e})=>({url:ee,path:G,title:_e}));st(N,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),oe("Test Image deletions updated."),ae("success")}).catch(ee=>{console.error("Failed to update test images in Firestore:",ee),oe("Failed to update test image deletions."),ae("error")}),ue(!0)},Nn=(k,W)=>{he(N=>({...N,[k]:W}))},Pn=(k,W)=>{De(N=>({...N,[k]:W}))},zr=async k=>{var N;const W=((N=Ne[k])==null?void 0:N.filter(Y=>Y.deleted))||[];if(W.length>0){const Y=vt(),Q=W.map(ee=>{const G=jt(Y,ee.path);return Yt(G)});try{await Promise.all(Q);const ee=Ne[k].filter(G=>!G.deleted);De(G=>({...G,[k]:ee})),await un(Ce(se,"tests",k),{files:ee.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),oe("Deleted test files have been permanently removed."),ae("success"),ue(!0)}catch(ee){console.error("Failed to delete test files: ",ee),oe("Failed to delete test files."),ae("error"),ue(!0)}}},Br=async(k,W)=>{await St(Ce(se,"tests",k)),await Gt(W),oe("Test deleted successfully."),ae("success"),ue(!0)},Nr=(k,W)=>{je("Are you sure you want to delete this test? This action cannot be undone."),nt(()=>()=>Br(k,W)),ce(!0)},Pr=k=>{pe(W=>({...W,[k]:!W[k]}))},qr=()=>{const k=Object.entries(Re).filter(([N,Y])=>Y).map(([N])=>N).join(", ");if(!k.length){U();return}const W=`You have unsaved changes in the following sections: ${k}. Are you sure you want to leave?`;je(W),nt(()=>()=>{we({design:!1,builds:!1,tests:!1}),U()}),ce(!0)};return q.useEffect(()=>{const k=W=>{Object.values(Re).some(Y=>Y)&&(W.preventDefault(),W.returnValue="")};return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[Re]),i.jsxs("div",{className:"small-container",children:[i.jsx(ke,{variant:"text",onClick:()=>{Object.values(Re).some(W=>W)?qr():U()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:Ft,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:o,onChange:k=>{x(k.target.value),we(W=>({...W,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:c||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:A||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(kn,{id:"course",value:s,onChange:k=>{r(k.target.value),we(W=>({...W,design:!0}))},fullWidth:!0,children:(l!=null&&l.classes?Object.entries(l.classes):[]).map(([k,W])=>i.jsx(Bt,{value:k,children:`${W.number} - ${W.title}`},k))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(Ke,{initialValue:y,onChange:k=>{n(k),we(W=>({...W,design:!0}))}}),i.jsx(ft,{ref:B,path:`designs/${g.id}/images`,initialImages:S,onImagesUpdated:Tt,onDelete:rn,isOwnDesign:a}),i.jsx(wt,{path:`designs/${g.id}/files`,initialFiles:M,onFilesChange:R,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>F(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{E(!0),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),f.map((k,W)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:T[k.id]!==void 0?i.jsx(qt,{variant:"outlined",size:"small",fullWidth:!0,value:T[k.id],onChange:N=>sn(k.id,N.target.value),onBlur:()=>qe(k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Pe,{onClick:()=>qe(k.id),size:"small",children:i.jsx(Dn,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>P(N=>({...N,[k.id]:k.title||`Build ${W+1}`})),style:{cursor:"pointer"},children:k.title||`Build ${W+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>_(N=>({...N,[k.id]:!N[k.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:d[k.id]?i.jsx(In,{}):i.jsx(cn,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Xe(k.id),children:i.jsx(Ht,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{L(k.id),setTimeout(()=>{ge.current&&ge.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),d[k.id]&&i.jsxs(i.Fragment,{children:[i.jsx(Ke,{initialValue:p[k.id]||k.description,onChange:N=>{Ge(k.id,N)}}),i.jsx(ft,{path:`builds/${k.id}/images`,initialImages:k.images,onImagesUpdated:N=>Ye(k.id,N),onDelete:N=>ct(k.id,N),isOwnDesign:a}),i.jsx(wt,{path:`builds/${k.id}/files`,initialFiles:k.files,onFilesChange:N=>zn(k.id,N),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>dt(k.id),children:"Update"})}),i.jsx("div",{children:V[k.id]&&V[k.id].length>0&&i.jsx("button",{onClick:()=>Pr(k.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:ve[k.id]?i.jsxs(i.Fragment,{children:[i.jsx(cn,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(In,{style:{marginRight:"8px"}}),"Tests"]})})}),!ve[k.id]&&V[k.id]&&V[k.id].map((N,Y)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:de[N.id]!==void 0?i.jsx(qt,{variant:"outlined",size:"small",fullWidth:!0,value:de[N.id],onChange:Q=>Rr(N.id,Q.target.value),onBlur:()=>Bn(N.id,k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Pe,{onClick:()=>Bn(N.id,k.id),size:"small",children:i.jsx(Dn,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>be(Q=>({...Q,[N.id]:N.title||`Test ${Y+1}`})),style:{cursor:"pointer"},children:N.title||`Test ${Y+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>me(Q=>({...Q,[N.id]:!Q[N.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:ye[N.id]?i.jsx(In,{}):i.jsx(cn,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Nr(N.id,k.id),children:i.jsx(Ht,{})})]})]}),ye[N.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(Ke,{initialValue:O[N.id]||N.description,onChange:Q=>{_r(N.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(Ke,{initialValue:re[N.id]||N.results,onChange:Q=>{Er(N.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(Ke,{initialValue:te[N.id]||N.conclusions,onChange:Q=>{Mr(N.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(ft,{path:`tests/${N.id}/images`,initialImages:ie[N.id]||[],onImagesUpdated:Q=>Nn(N.id,Q),onDelete:Q=>Or(N.id,Q),isOwnDesign:a}),i.jsx(wt,{path:`tests/${N.id}/files`,initialFiles:Ne[N.id]||[],onFilesChange:Q=>Pn(N.id,Q),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Ur(N.id,k.id),children:"Update"})})]})]},N.id))]}),$===k.id&&i.jsxs("div",{className:"new-test-record",ref:ge,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Ks,{designId:g.id,buildId:k.id,refreshTests:()=>Gt(k.id),setAddingTestIdForBuild:L,onImagesUpdated:N=>Nn(k.id,N),onFilesChange:N=>Pn(k.id,N)})]})]},k.id)),i.jsx("div",{children:j&&i.jsxs("div",{className:"new-build-record",ref:h,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Zs,{designId:g.id,setIsAddingBuild:E,refreshBuilds:He,onImagesUpdated:k=>Ye("temp-build-id",k),onFilesChange:k=>zn("temp-build-id",k)})]})})]}),i.jsxs(ht,{open:Ue,onClose:()=>ce(!1),children:[i.jsx(Ct,{children:"Confirmation Required"}),i.jsx(gt,{children:i.jsx(Wt,{children:fe})}),i.jsxs(At,{children:[i.jsx(ke,{onClick:()=>ce(!1),children:"Cancel"}),i.jsx(ke,{onClick:()=>{Qe(),ce(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(mt,{open:Se,autoHideDuration:6e3,onClose:()=>ue(!1),children:i.jsx(pt,{onClose:()=>ue(!1),severity:Ee,sx:{width:"100%"},children:Ae})})]})},xt=(g,F,U)=>g[F]??U,ti=()=>{const{userDetails:g,loading:F}=$t(),U=Un(),l=Rn(U.breakpoints.down("md"));console.log("Dashboard loaded");const[e,t]=q.useState([]),[a,o]=q.useState([]),[x,y]=q.useState([]),[n,s]=q.useState(null),[r,c]=q.useState(!1),[m,A]=q.useState(!1),[D,S]=q.useState(!1),[z,M]=q.useState(""),[R,B]=q.useState(""),[j,E]=q.useState(!1),[f,u]=q.useState(null),[p,v]=q.useState(!1),[w,C]=q.useState(""),[b,I]=q.useState("info"),h=()=>{A(!1),c(!1),s(null),d()},d=q.useCallback(async()=>{if(!g)return;let H;const $=[],L=[],O=[];if(g.isSuperAdmin)H=Me(Te(se,"designs"),We("dateCreated","desc"));else if(g.isAdmin){const re=g.classes?Object.keys(g.classes):[];if(re.length>0)H=Me(Te(se,"designs"),xe("course","in",re),We("dateCreated","desc"));else{o([]),y([]);return}}else H=Me(Te(se,"designs"),xe("userId","==",g.uid),We("dateCreated","desc"));(await it(H)).forEach(re=>{const J=re.data(),te={id:re.id,title:xt(J,"title",""),description:xt(J,"description",""),course:xt(J,"course",""),dateCreated:J.dateCreated,dateModified:J.dateModified,userId:xt(J,"userId",""),images:xt(J,"images",[]),files:xt(J,"files",[])};g.isSuperAdmin?J.userId===g.uid?$.push(te):J.userId!==g.uid&&J.course&&J.isAdmin?L.push(te):J.userId!==g.uid&&!J.isAdmin&&O.push(te):g.isAdmin?J.userId===g.uid?L.push(te):O.push(te):J.userId===g.uid&&O.push(te)}),t($),o(L),y(O)},[g]);q.useEffect(()=>{!F&&g&&d()},[g,F,d]);const _=H=>{const $=[...e,...a,...x].find(L=>L.id===H);s($||null),A(!0)},T=H=>{u(H),M("Are you sure you want to delete this design? This action cannot be undone."),S(!0)},P=async()=>{if(f)if(R!==(g==null?void 0:g.uid))C("User ID confirmation failed. Enter the correct User ID."),I("error"),v(!0);else try{const H=Me(Te(se,"builds"),xe("design_ID","==",f),xe("userId","==",g.uid)),$=await it(H);for(const L of $.docs){const O=L.id,X=Me(Te(se,"tests"),xe("build_ID","==",O),xe("userId","==",g.uid)),re=await it(X);for(const J of re.docs)await St(Ce(se,"tests",J.id));await St(Ce(se,"builds",O))}await St(Ce(se,"designs",f)),t(L=>L.filter(O=>O.id!==f)),o(L=>L.filter(O=>O.id!==f)),y(L=>L.filter(O=>O.id!==f)),C("Your design and its associated builds and tests have been deleted."),I("success"),v(!0)}catch(H){console.error("Error deleting design, builds, and tests: ",H),C("There was an issue deleting your design and its associated builds and tests."),I("error"),v(!0)}finally{B(""),E(!1),u(null)}},V=(H,$,L)=>i.jsx(Fe,{sx:{mb:ne[4],mt:ne[6]},children:i.jsx(Nt,{sx:{p:l?ne[3]:ne[4],backgroundColor:K.background.secondary,borderRadius:Be.lg,border:`1px solid ${K.neutral[200]}`,boxShadow:$e.sm},children:i.jsxs(Fe,{sx:{display:"flex",alignItems:"center",gap:ne[3],flexDirection:l?"column":"row",textAlign:l?"center":"left"},children:[i.jsx(Ve,{variant:"h4",sx:{fontFamily:Z.fontFamily.display,fontSize:l?Z.fontSize.xl:Z.fontSize["2xl"],fontWeight:Z.fontWeight.bold,color:K.text.primary},children:H}),i.jsx(es,{label:`${$} ${$===1?"Design":"Designs"}`,size:"small",sx:{backgroundColor:L,color:K.text.inverse,fontFamily:Z.fontFamily.secondary,fontWeight:Z.fontWeight.semibold,fontSize:Z.fontSize.sm}})]})})});return i.jsxs(Fe,{sx:{p:l?ne[3]:ne[6],backgroundColor:K.background.primary,minHeight:"100vh"},children:[!r&&!m&&i.jsxs(i.Fragment,{children:[i.jsx(mr,{setIsAdding:c}),(g==null?void 0:g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[V("My Designs",e.length,K.primary[500]),i.jsx(bt,{designs:e,handleEdit:_,handleDelete:T,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),V("Educator Designs",a.length,K.secondary[500]),i.jsx(bt,{designs:a,handleEdit:_,handleDelete:T,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),V("Student Designs",x.length,K.info),i.jsx(bt,{designs:x,handleEdit:_,handleDelete:T,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),(g==null?void 0:g.isAdmin)&&!g.isSuperAdmin&&i.jsxs(i.Fragment,{children:[V("My Educator Designs",a.length,K.secondary[500]),i.jsx(bt,{designs:a,handleEdit:_,handleDelete:T,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),V("Student Designs",x.length,K.info),i.jsx(bt,{designs:x,handleEdit:_,handleDelete:T,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),!(g!=null&&g.isAdmin)&&!(g!=null&&g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[V("My Designs",x.length,K.primary[500]),i.jsx(bt,{designs:x,handleEdit:_,handleDelete:T,isAdmin:!1,userDetails:g,showUserIdColumn:!1})]})]}),r&&i.jsx(Ys,{designs:e.concat(a),setDesigns:o,setIsAdding:c,getDesigns:d,onReturnToDashboard:h}),m&&i.jsx(ei,{designs:e.concat(a),selectedDesign:n,setDesigns:o,setIsEditing:A,getDesigns:d,onReturnToDashboard:h}),i.jsxs(ht,{open:D,onClose:()=>S(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ct,{children:"Confirm Deletion"}),i.jsx(gt,{children:i.jsx(Wt,{children:z})}),i.jsxs(At,{children:[i.jsx(ke,{onClick:()=>S(!1),children:"No, cancel"}),i.jsx(ke,{onClick:()=>{E(!0),S(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(ht,{open:j,onClose:()=>E(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ct,{children:"Confirm Your User ID"}),i.jsx(gt,{children:i.jsx(qt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:R,onChange:H=>B(H.target.value)})}),i.jsxs(At,{children:[i.jsx(ke,{onClick:()=>E(!1),children:"No, cancel"}),i.jsx(ke,{onClick:P,color:"primary",children:"Confirm"})]})]}),i.jsx(mt,{open:p,autoHideDuration:6e3,onClose:()=>v(!1),children:i.jsx(pt,{onClose:()=>v(!1),severity:b,sx:{width:"100%"},children:w})})]})},li=Jr.memo(ti);export{li as default};
