const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CuRe7JPk.js","assets/ui-J3wtD2gz.js","assets/vendor-BFl3bqVE.js","assets/firebase-CTJJwFJC.js","assets/index-BA2bQjcR.css"])))=>i.map(i=>d[i]);
var te=Object.defineProperty;var ie=(t,a,s)=>a in t?te(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var R=(t,a,s)=>ie(t,typeof a!="symbol"?a+"":a,s);import{r as f,c as w,d as F,j as e,I as O,F as re,H as oe,J as ce,K as le,N as de,a as I,B as c,P as T,T as d,w as B,ay as H,az as U,G as v,v as $,aB as K,L as G,C as ge,t as ue,bw as pe,O as he,a4 as xe,A as me}from"./ui-J3wtD2gz.js";import{_ as je,p as fe,q as be,v as ve,w as Me,x as ye,r as L,g as Ce,y as _,k as ee,u as Pe,P as Se}from"./index-CuRe7JPk.js";import{P as se,R as Ee,x as Ie,_ as Ne,I as _e,e as A,i as ke,y as ae}from"./firebase-CTJJwFJC.js";import{g as q}from"./vendor-BFl3bqVE.js";import{E as J}from"./Edit-CnasLcit.js";class Oe{constructor(){R(this,"db",null);R(this,"cacheKey","messages")}initialize(){this.db||(je(()=>import("./index-CuRe7JPk.js").then(a=>a.H),__vite__mapDeps([0,1,2,3,4])),this.db=se())}subscribeToMessages(a){this.initialize();const s=Ee(Ne(this.db,"messages"),Ie("postedOn","desc"));return _e(s,i=>{const o=i.docs.map(l=>({id:l.id,...l.data()}));a(o),this.setCachedMessages(o)},i=>{console.error("Error listening to messages:",i);const o=this.getCachedMessages();o&&a(o)})}getCachedMessages(){try{const a=sessionStorage.getItem(this.cacheKey);return a?JSON.parse(a):null}catch(a){return console.error("Error reading cached messages:",a),null}}setCachedMessages(a){try{sessionStorage.setItem(this.cacheKey,JSON.stringify(a))}catch(s){console.error("Error caching messages:",s)}}clearCache(){try{sessionStorage.removeItem(this.cacheKey)}catch(a){console.error("Error clearing message cache:",a)}}async togglePinMessage(a,s){this.initialize();try{const i=A(this.db,"messages",a);await ke(i,{isPinned:!s})}catch(i){throw console.error("Error toggling pin status:",i),i}}async deleteMessage(a){try{const s=A(this.db,"messages",a);await ae(s)}catch(s){throw console.error("Error deleting message:",s),s}}}const k=new Oe,Re=(t=!1)=>{const[a,s]=f.useState([]),[i,o]=f.useState(!t),[l,g]=f.useState(null),[u,m]=f.useState(!1),{handleError:b}=be(),{showError:M,showSuccess:y}=fe();return f.useEffect(()=>{if(t&&!u)return;const p=k.getCachedMessages();p&&(s(p),o(!1));const h=k.subscribeToMessages(x=>{s(x),g(null),p||o(!1)});return()=>{h()}},[t,u]),{messages:a,loading:i,error:l,deleteMessage:async p=>{try{await k.deleteMessage(p),y("Message deleted successfully")}catch(h){const x=b(h,{operation:"delete_message",messageId:p});g(x.message),M(x)}},togglePinMessage:async(p,h)=>{try{await k.togglePinMessage(p,h),y(`Message ${h?"unpinned":"pinned"} successfully`)}catch(x){const n=b(x,{operation:"toggle_pin_message",messageId:p,currentPinStatus:h});g(n.message),M(n)}},clearError:()=>{g(null)},initializeMessages:()=>{u||(m(!0),o(!0))}}};ve()(Me(ye((t,a)=>({globalLoading:!1,pageLoading:{},openDialogs:{},currentPage:"/",previousPage:null,navigationSections:{educatorExpanded:!1,superAdminExpanded:!1},sidebarCollapsed:!1,theme:"light",setGlobalLoading:s=>t({globalLoading:s}),setPageLoading:(s,i)=>t(o=>({pageLoading:{...o.pageLoading,[s]:i}})),openDialog:s=>t(i=>({openDialogs:{...i.openDialogs,[s]:!0}})),closeDialog:s=>t(i=>({openDialogs:{...i.openDialogs,[s]:!1}})),toggleDialog:s=>t(i=>({openDialogs:{...i.openDialogs,[s]:!i.openDialogs[s]}})),isDialogOpen:s=>!!a().openDialogs[s],setCurrentPage:s=>t(i=>({currentPage:s,previousPage:i.currentPage})),toggleEducatorSection:()=>t(s=>({navigationSections:{...s.navigationSections,educatorExpanded:!s.navigationSections.educatorExpanded}})),toggleSuperAdminSection:()=>t(s=>({navigationSections:{...s.navigationSections,superAdminExpanded:!s.navigationSections.superAdminExpanded}})),setEducatorSectionExpanded:s=>t(i=>({navigationSections:{...i.navigationSections,educatorExpanded:s}})),setSuperAdminSectionExpanded:s=>t(i=>({navigationSections:{...i.navigationSections,superAdminExpanded:s}})),setSidebarCollapsed:s=>t({sidebarCollapsed:s}),toggleSidebar:()=>t(s=>({sidebarCollapsed:!s.sidebarCollapsed})),setTheme:s=>t({theme:s}),toggleTheme:()=>t(s=>({theme:s.theme==="light"?"dark":"light"}))}),{name:"ui-preferences",partialize:t=>({sidebarCollapsed:t.sidebarCollapsed,theme:t.theme,navigationSections:t.navigationSections})})));var P={},V;function Ae(){if(V)return P;V=1;var t=w();Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var a=t(L()),s=F();return P.default=(0,a.default)((0,s.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline"),P}var we=Ae();const Fe=q(we),Q=({messageId:t,onDelete:a})=>{const[s,i]=f.useState(!1),o=se(),l=()=>{i(!0)},g=()=>{i(!1)},u=async()=>{try{await ae(A(o,"messages",t)),a(t),g()}catch(m){console.error("Error deleting message: ",m)}};return e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:l,children:e.jsx(Ce,{})}),e.jsxs(re,{open:s,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(oe,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(ce,{children:e.jsx(le,{id:"alert-dialog-description",children:"Are you sure you want to delete this message? This action cannot be undone."})}),e.jsxs(de,{children:[e.jsx(I,{onClick:g,color:"primary",children:"Cancel"}),e.jsx(I,{onClick:u,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})};var S={},W;function Le(){if(W)return S;W=1;var t=w();Object.defineProperty(S,"__esModule",{value:!0}),S.default=void 0;var a=t(L()),s=F();return S.default=(0,a.default)((0,s.jsx)("path",{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3"}),"PushPin"),S}var qe=Le();const ne=q(qe),X=({message:t,togglePinMessage:a})=>{const s=async()=>{try{await a(t.id,t.isPinned||!1)}catch(i){console.error("Error updating pin status: ",i)}};return e.jsx(O,{onClick:s,sx:{marginRight:1},children:e.jsx(ne,{color:t.isPinned?"primary":"inherit"})})};var E={},Y;function ze(){if(Y)return E;Y=1;var t=w();Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var a=t(L()),s=F();return E.default=(0,a.default)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),E}var De=ze();const Z=q(De),Te=({messages:t,userDetails:a,navigate:s,handleDeleteMessage:i,togglePinMessage:o})=>{const[l,g]=f.useState(0),u=3,m=t.filter(n=>(a==null?void 0:a.classes)&&n.course in a.classes),b=m.filter(n=>n.isPinned),M=m.filter(n=>!n.isPinned),y=(l+1)*u,C=y-u,N=M.slice(C,y),z=Math.ceil(M.length/u),D=()=>g(n=>n+1),p=()=>g(n=>n-1),h=n=>{var r,j;return!!(a!=null&&a.isSuperAdmin||(j=(r=a==null?void 0:a.classes)==null?void 0:r[n.course])!=null&&j.isCourseAdmin)},x=n=>{var j;const r=(j=a==null?void 0:a.classes)==null?void 0:j[n];return r?`${r.number}`:"Unknown Course"};return e.jsxs(c,{className:"messages-display-container",children:[" ",b.length>0&&e.jsxs(T,{elevation:3,sx:{mb:3,p:2,backgroundColor:"#FBFADA",borderRadius:"15px"},children:[e.jsxs(c,{className:"pinned-section",children:[e.jsx(ne,{color:"primary",sx:{mr:1}}),e.jsx(d,{variant:"h6",className:"pinned-title",children:"Pinned"})]}),b.map(n=>e.jsx(B,{className:"messages-card",children:e.jsxs(H,{children:[e.jsx(U,{expandIcon:e.jsx(Z,{}),"aria-controls":`panel-${n.id}-content`,id:`panel-${n.id}-header`,children:e.jsxs(v,{container:!0,justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(v,{item:!0,children:[e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx($,{label:x(n.course),color:"primary",variant:"outlined",className:"message-chip",sx:{marginRight:1}}),e.jsxs(d,{variant:"subtitle2",className:"message-posted-on",children:["Posted On: ",_(n.postedOn)," |"]}),n.lastUpdatedOn&&e.jsxs(d,{variant:"subtitle2",className:"message-updated-on",children:["| Last Updated: ",_(n.lastUpdatedOn)]})]}),e.jsxs(d,{variant:"h6",className:"message-title",children:["Subject: ",n.title]})]}),h(n)&&e.jsxs(v,{item:!0,children:[e.jsx(X,{message:n,togglePinMessage:o}),e.jsx(O,{onClick:()=>s(`/edit-message/${n.id}`),sx:{marginRight:1},children:e.jsx(J,{})}),e.jsx(Q,{messageId:n.id,onDelete:i})]})]})}),e.jsx(K,{children:e.jsxs(c,{sx:{border:"1px solid #e0e0e0",padding:"20px",borderRadius:"4px",backgroundColor:"#fafafa",marginBottom:"16px"},children:[e.jsx(d,{variant:"body1",className:"message-description",children:n.description}),n.links&&n.links.some(r=>r.title&&r.url)&&e.jsxs(c,{sx:{mt:1},children:[e.jsx(d,{variant:"subtitle2",className:"message-links-title",children:"Links:"}),n.links.map((r,j)=>r.title&&r.url&&e.jsxs(c,{sx:{mt:1},children:[e.jsxs(d,{variant:"body2",component:"span",className:"message-link",children:["ðŸ”— ",r.title,": "]}),e.jsx(G,{href:r.url,target:"_blank",rel:"noopener",children:r.url})]},j))]})]})})]})},n.id))]}),e.jsx(T,{elevation:3,sx:{mb:3,p:2,backgroundColor:"#f5f5f5",borderRadius:"15px"},children:N.map(n=>e.jsx(B,{className:"messages-card",children:e.jsxs(H,{children:[e.jsx(U,{expandIcon:e.jsx(Z,{}),"aria-controls":`panel-${n.id}-content`,id:`panel-${n.id}-header`,children:e.jsxs(v,{container:!0,justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(v,{item:!0,children:[e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx($,{label:x(n.course),color:"primary",variant:"outlined",className:"message-chip",sx:{marginRight:1}}),e.jsxs(d,{variant:"subtitle2",className:"message-posted-on",children:["Posted On: ",_(n.postedOn)]}),n.lastUpdatedOn&&e.jsxs(d,{variant:"subtitle2",className:"message-updated-on",children:["Last Updated: ",_(n.lastUpdatedOn)]})]}),e.jsxs(d,{variant:"h6",className:"message-title",children:["Subject: ",n.title]})]}),h(n)&&e.jsxs(v,{item:!0,children:[e.jsx(X,{message:n,togglePinMessage:o}),e.jsx(O,{onClick:()=>s(`/edit-message/${n.id}`),sx:{marginRight:1},children:e.jsx(J,{})}),e.jsx(Q,{messageId:n.id,onDelete:i})]})]})}),e.jsx(K,{children:e.jsxs(c,{sx:{border:"1px solid #e0e0e0",padding:"20px",borderRadius:"4px",backgroundColor:"#fafafa",marginBottom:"16px"},children:[e.jsx(d,{variant:"body1",className:"message-description",children:n.description}),n.links&&n.links.some(r=>r.title&&r.url)&&e.jsxs(c,{sx:{mt:1},children:[e.jsx(d,{variant:"subtitle2",className:"message-links-title",children:"Links:"}),n.links.map((r,j)=>r.title&&r.url&&e.jsxs(c,{sx:{mt:1},children:[e.jsxs(d,{variant:"body2",component:"span",className:"message-link",children:["ðŸ”— ",r.title,": "]}),e.jsx(G,{href:r.url,target:"_blank",rel:"noopener",children:r.url})]},j))]})]})})]})},n.id))}),e.jsxs(c,{className:"pagination-container",children:[" ",e.jsx(I,{onClick:p,disabled:l===0,className:"pagination-button",children:"Previous"}),e.jsx(I,{onClick:D,disabled:l>=z-1,className:"pagination-button",children:"Next"})]})]})},Be=({messages:t,loading:a,userDetails:s,handleDeleteMessage:i,togglePinMessage:o})=>{const l=ee();return e.jsxs(c,{className:"messages-container",children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1}}),e.jsx(d,{variant:"h5",component:"h4",className:"inbox-text",children:"Inbox"})]}),(s==null?void 0:s.isAdmin)&&e.jsx(I,{variant:"contained",onClick:()=>l("/add-message"),sx:{backgroundColor:"#CDDAFF",color:"#FFFFFF",fontFamily:"Staatliches, sans-serif",fontSize:"1.25rem","&:hover":{backgroundColor:"#0B53C0",border:"0px solid #0B53C0"}},children:"+ Add Message"})]}),a?e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px"},children:e.jsx(ge,{})}):e.jsx(Te,{messages:t,userDetails:s,navigate:l,handleDeleteMessage:i,togglePinMessage:o})]})},Ve=()=>{const{userDetails:t}=Pe(),a=ee(),[s,i]=f.useState(!1),{messages:o,loading:l,deleteMessage:g,togglePinMessage:u,initializeMessages:m}=Re(!0);f.useEffect(()=>{m()},[m]);const b=(C,N)=>{N!=="clickaway"&&i(!1)},M=C=>{g(C)},y=()=>{a("/add-message")};return e.jsxs(c,{sx:{flexGrow:1,padding:3},children:[e.jsx(Se,{title:"Messages"}),e.jsx(v,{container:!0,spacing:3,children:e.jsx(v,{item:!0,xs:12,children:e.jsx(Be,{messages:o,loading:l,userDetails:t,handleDeleteMessage:M,togglePinMessage:u})})}),e.jsx(ue,{title:"Add New Message",placement:"left",children:e.jsx(pe,{color:"primary","aria-label":"add message",onClick:y,sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},children:e.jsx(he,{})})}),e.jsx(xe,{open:s,autoHideDuration:6e3,onClose:b,children:e.jsx(me,{onClose:b,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})};export{Ve as default};
