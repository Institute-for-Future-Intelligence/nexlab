const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BFbkbQ5Y.js","assets/ui-DvOWEHrS.js","assets/vendor-BFl3bqVE.js","assets/firebase-CTJJwFJC.js","assets/index-BA2bQjcR.css"])))=>i.map(i=>d[i]);
var ie=Object.defineProperty;var oe=(n,a,s)=>a in n?ie(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s;var F=(n,a,s)=>oe(n,typeof a!="symbol"?a+"":a,s);import{c as A,d as w,r as j,j as e,I as O,V as le,W as ce,X as de,Y as ge,Z as ue,a as _,B as l,P as B,T as d,E as U,aA as $,aB as H,G as b,v as V,aD as G,L as K,C as pe,t as he,bL as xe,$ as me,aa as fe,A as je}from"./ui-DvOWEHrS.js";import{r as L,_ as ve,o as be,q as Me,h as ye,i as Ce,p as Pe,w as Ee,x as R,f as ae,u as Se,P as Ie}from"./index-BFbkbQ5Y.js";import{P as ne,R as _e,x as Ne,_ as Re,I as ke,e as D,i as Oe,y as te}from"./firebase-CTJJwFJC.js";import{g as q}from"./vendor-BFl3bqVE.js";var P={},J;function Ae(){if(J)return P;J=1;var n=A();Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var a=n(L()),s=w();return P.default=(0,a.default)((0,s.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),P}var we=Ae();const W=q(we);class Le{constructor(){F(this,"db",null);F(this,"cacheKey","messages")}initialize(){this.db||(ve(()=>import("./index-BFbkbQ5Y.js").then(a=>a.G),__vite__mapDeps([0,1,2,3,4])),this.db=ne())}subscribeToMessages(a){this.initialize();const s=_e(Re(this.db,"messages"),Ne("postedOn","desc"));return ke(s,r=>{const o=r.docs.map(c=>({id:c.id,...c.data()}));a(o),this.setCachedMessages(o)},r=>{console.error("Error listening to messages:",r);const o=this.getCachedMessages();o&&a(o)})}getCachedMessages(){try{const a=sessionStorage.getItem(this.cacheKey);return a?JSON.parse(a):null}catch(a){return console.error("Error reading cached messages:",a),null}}setCachedMessages(a){try{sessionStorage.setItem(this.cacheKey,JSON.stringify(a))}catch(s){console.error("Error caching messages:",s)}}clearCache(){try{sessionStorage.removeItem(this.cacheKey)}catch(a){console.error("Error clearing message cache:",a)}}async togglePinMessage(a,s){this.initialize();try{const r=D(this.db,"messages",a);await Oe(r,{isPinned:!s})}catch(r){throw console.error("Error toggling pin status:",r),r}}async deleteMessage(a){try{const s=D(this.db,"messages",a);await te(s)}catch(s){throw console.error("Error deleting message:",s),s}}}const k=new Le,qe=(n=!1)=>{const[a,s]=j.useState([]),[r,o]=j.useState(!n),[c,g]=j.useState(null),[u,m]=j.useState(!1),{handleError:v}=Me(),{showError:M,showSuccess:y}=be();return j.useEffect(()=>{if(n&&!u)return;const p=k.getCachedMessages();p&&(s(p),o(!1));const h=k.subscribeToMessages(x=>{s(x),g(null),p||o(!1)});return()=>{h()}},[n,u]),{messages:a,loading:r,error:c,deleteMessage:async p=>{try{await k.deleteMessage(p),y("Message deleted successfully")}catch(h){const x=v(h,{operation:"delete_message",messageId:p});g(x.message),M(x)}},togglePinMessage:async(p,h)=>{try{await k.togglePinMessage(p,h),y(`Message ${h?"unpinned":"pinned"} successfully`)}catch(x){const t=v(x,{operation:"toggle_pin_message",messageId:p,currentPinStatus:h});g(t.message),M(t)}},clearError:()=>{g(null)},initializeMessages:()=>{u||(m(!0),o(!0))}}};ye()(Ce(Pe((n,a)=>({globalLoading:!1,pageLoading:{},openDialogs:{},currentPage:"/",previousPage:null,navigationSections:{educatorExpanded:!1,superAdminExpanded:!1},sidebarCollapsed:!1,theme:"light",setGlobalLoading:s=>n({globalLoading:s}),setPageLoading:(s,r)=>n(o=>({pageLoading:{...o.pageLoading,[s]:r}})),openDialog:s=>n(r=>({openDialogs:{...r.openDialogs,[s]:!0}})),closeDialog:s=>n(r=>({openDialogs:{...r.openDialogs,[s]:!1}})),toggleDialog:s=>n(r=>({openDialogs:{...r.openDialogs,[s]:!r.openDialogs[s]}})),isDialogOpen:s=>!!a().openDialogs[s],setCurrentPage:s=>n(r=>({currentPage:s,previousPage:r.currentPage})),toggleEducatorSection:()=>n(s=>({navigationSections:{...s.navigationSections,educatorExpanded:!s.navigationSections.educatorExpanded}})),toggleSuperAdminSection:()=>n(s=>({navigationSections:{...s.navigationSections,superAdminExpanded:!s.navigationSections.superAdminExpanded}})),setEducatorSectionExpanded:s=>n(r=>({navigationSections:{...r.navigationSections,educatorExpanded:s}})),setSuperAdminSectionExpanded:s=>n(r=>({navigationSections:{...r.navigationSections,superAdminExpanded:s}})),setSidebarCollapsed:s=>n({sidebarCollapsed:s}),toggleSidebar:()=>n(s=>({sidebarCollapsed:!s.sidebarCollapsed})),setTheme:s=>n({theme:s}),toggleTheme:()=>n(s=>({theme:s.theme==="light"?"dark":"light"}))}),{name:"ui-preferences",partialize:n=>({sidebarCollapsed:n.sidebarCollapsed,theme:n.theme,navigationSections:n.navigationSections})})));var E={},X;function Fe(){if(X)return E;X=1;var n=A();Object.defineProperty(E,"__esModule",{value:!0}),E.default=void 0;var a=n(L()),s=w();return E.default=(0,a.default)((0,s.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline"),E}var De=Fe();const ze=q(De),Y=({messageId:n,onDelete:a})=>{const[s,r]=j.useState(!1),o=ne(),c=()=>{r(!0)},g=()=>{r(!1)},u=async()=>{try{await te(D(o,"messages",n)),a(n),g()}catch(m){console.error("Error deleting message: ",m)}};return e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:c,children:e.jsx(Ee,{})}),e.jsxs(le,{open:s,onClose:g,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ce,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(de,{children:e.jsx(ge,{id:"alert-dialog-description",children:"Are you sure you want to delete this message? This action cannot be undone."})}),e.jsxs(ue,{children:[e.jsx(_,{onClick:g,color:"primary",children:"Cancel"}),e.jsx(_,{onClick:u,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})};var S={},Z;function Te(){if(Z)return S;Z=1;var n=A();Object.defineProperty(S,"__esModule",{value:!0}),S.default=void 0;var a=n(L()),s=w();return S.default=(0,a.default)((0,s.jsx)("path",{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3"}),"PushPin"),S}var Be=Te();const re=q(Be),Q=({message:n,togglePinMessage:a})=>{const s=async()=>{try{await a(n.id,n.isPinned||!1)}catch(r){console.error("Error updating pin status: ",r)}};return e.jsx(O,{onClick:s,sx:{marginRight:1},children:e.jsx(re,{color:n.isPinned?"primary":"inherit"})})};var I={},ee;function Ue(){if(ee)return I;ee=1;var n=A();Object.defineProperty(I,"__esModule",{value:!0}),I.default=void 0;var a=n(L()),s=w();return I.default=(0,a.default)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),I}var $e=Ue();const se=q($e),He=({messages:n,userDetails:a,navigate:s,handleDeleteMessage:r,togglePinMessage:o})=>{const[c,g]=j.useState(0),u=3,m=n.filter(t=>(a==null?void 0:a.classes)&&t.course in a.classes),v=m.filter(t=>t.isPinned),M=m.filter(t=>!t.isPinned),y=(c+1)*u,C=y-u,N=M.slice(C,y),z=Math.ceil(M.length/u),T=()=>g(t=>t+1),p=()=>g(t=>t-1),h=t=>{var i,f;return!!(a!=null&&a.isSuperAdmin||(f=(i=a==null?void 0:a.classes)==null?void 0:i[t.course])!=null&&f.isCourseAdmin)},x=t=>{var f;const i=(f=a==null?void 0:a.classes)==null?void 0:f[t];return i?`${i.number}`:"Unknown Course"};return e.jsxs(l,{className:"messages-display-container",children:[" ",v.length>0&&e.jsxs(B,{elevation:3,sx:{mb:3,p:2,backgroundColor:"#FBFADA",borderRadius:"15px"},children:[e.jsxs(l,{className:"pinned-section",children:[e.jsx(re,{color:"primary",sx:{mr:1}}),e.jsx(d,{variant:"h6",className:"pinned-title",children:"Pinned"})]}),v.map(t=>e.jsx(U,{className:"messages-card",children:e.jsxs($,{children:[e.jsx(H,{expandIcon:e.jsx(se,{}),"aria-controls":`panel-${t.id}-content`,id:`panel-${t.id}-header`,children:e.jsxs(b,{container:!0,justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(b,{item:!0,children:[e.jsxs(l,{display:"flex",alignItems:"center",children:[e.jsx(V,{label:x(t.course),color:"primary",variant:"outlined",className:"message-chip",sx:{marginRight:1}}),e.jsxs(d,{variant:"subtitle2",className:"message-posted-on",children:["Posted On: ",R(t.postedOn)," |"]}),t.lastUpdatedOn&&e.jsxs(d,{variant:"subtitle2",className:"message-updated-on",children:["| Last Updated: ",R(t.lastUpdatedOn)]})]}),e.jsxs(d,{variant:"h6",className:"message-title",children:["Subject: ",t.title]})]}),h(t)&&e.jsxs(b,{item:!0,children:[e.jsx(Q,{message:t,togglePinMessage:o}),e.jsx(O,{onClick:()=>s(`/edit-message/${t.id}`),sx:{marginRight:1},children:e.jsx(W,{})}),e.jsx(Y,{messageId:t.id,onDelete:r})]})]})}),e.jsx(G,{children:e.jsxs(l,{sx:{border:"1px solid #e0e0e0",padding:"20px",borderRadius:"4px",backgroundColor:"#fafafa",marginBottom:"16px"},children:[e.jsx(d,{variant:"body1",className:"message-description",children:t.description}),t.links&&t.links.some(i=>i.title&&i.url)&&e.jsxs(l,{sx:{mt:1},children:[e.jsx(d,{variant:"subtitle2",className:"message-links-title",children:"Links:"}),t.links.map((i,f)=>i.title&&i.url&&e.jsxs(l,{sx:{mt:1},children:[e.jsxs(d,{variant:"body2",component:"span",className:"message-link",children:["ðŸ”— ",i.title,": "]}),e.jsx(K,{href:i.url,target:"_blank",rel:"noopener",children:i.url})]},f))]})]})})]})},t.id))]}),e.jsx(B,{elevation:3,sx:{mb:3,p:2,backgroundColor:"#f5f5f5",borderRadius:"15px"},children:N.map(t=>e.jsx(U,{className:"messages-card",children:e.jsxs($,{children:[e.jsx(H,{expandIcon:e.jsx(se,{}),"aria-controls":`panel-${t.id}-content`,id:`panel-${t.id}-header`,children:e.jsxs(b,{container:!0,justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(b,{item:!0,children:[e.jsxs(l,{display:"flex",alignItems:"center",children:[e.jsx(V,{label:x(t.course),color:"primary",variant:"outlined",className:"message-chip",sx:{marginRight:1}}),e.jsxs(d,{variant:"subtitle2",className:"message-posted-on",children:["Posted On: ",R(t.postedOn)]}),t.lastUpdatedOn&&e.jsxs(d,{variant:"subtitle2",className:"message-updated-on",children:["Last Updated: ",R(t.lastUpdatedOn)]})]}),e.jsxs(d,{variant:"h6",className:"message-title",children:["Subject: ",t.title]})]}),h(t)&&e.jsxs(b,{item:!0,children:[e.jsx(Q,{message:t,togglePinMessage:o}),e.jsx(O,{onClick:()=>s(`/edit-message/${t.id}`),sx:{marginRight:1},children:e.jsx(W,{})}),e.jsx(Y,{messageId:t.id,onDelete:r})]})]})}),e.jsx(G,{children:e.jsxs(l,{sx:{border:"1px solid #e0e0e0",padding:"20px",borderRadius:"4px",backgroundColor:"#fafafa",marginBottom:"16px"},children:[e.jsx(d,{variant:"body1",className:"message-description",children:t.description}),t.links&&t.links.some(i=>i.title&&i.url)&&e.jsxs(l,{sx:{mt:1},children:[e.jsx(d,{variant:"subtitle2",className:"message-links-title",children:"Links:"}),t.links.map((i,f)=>i.title&&i.url&&e.jsxs(l,{sx:{mt:1},children:[e.jsxs(d,{variant:"body2",component:"span",className:"message-link",children:["ðŸ”— ",i.title,": "]}),e.jsx(K,{href:i.url,target:"_blank",rel:"noopener",children:i.url})]},f))]})]})})]})},t.id))}),e.jsxs(l,{className:"pagination-container",children:[" ",e.jsx(_,{onClick:p,disabled:c===0,className:"pagination-button",children:"Previous"}),e.jsx(_,{onClick:T,disabled:c>=z-1,className:"pagination-button",children:"Next"})]})]})},Ve=({messages:n,loading:a,userDetails:s,handleDeleteMessage:r,togglePinMessage:o})=>{const c=ae();return e.jsxs(l,{className:"messages-container",children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ze,{sx:{mr:1}}),e.jsx(d,{variant:"h5",component:"h4",className:"inbox-text",children:"Inbox"})]}),(s==null?void 0:s.isAdmin)&&e.jsx(_,{variant:"contained",onClick:()=>c("/add-message"),sx:{backgroundColor:"#CDDAFF",color:"#FFFFFF",fontFamily:"Staatliches, sans-serif",fontSize:"1.25rem","&:hover":{backgroundColor:"#0B53C0",border:"0px solid #0B53C0"}},children:"+ Add Message"})]}),a?e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px"},children:e.jsx(pe,{})}):e.jsx(He,{messages:n,userDetails:s,navigate:c,handleDeleteMessage:r,togglePinMessage:o})]})},Ye=()=>{const{userDetails:n}=Se(),a=ae(),[s,r]=j.useState(!1),{messages:o,loading:c,deleteMessage:g,togglePinMessage:u,initializeMessages:m}=qe(!0);j.useEffect(()=>{m()},[m]);const v=(C,N)=>{N!=="clickaway"&&r(!1)},M=C=>{g(C)},y=()=>{a("/add-message")};return e.jsxs(l,{sx:{flexGrow:1,padding:3},children:[e.jsx(Ie,{title:"Messages"}),e.jsx(b,{container:!0,spacing:3,children:e.jsx(b,{item:!0,xs:12,children:e.jsx(Ve,{messages:o,loading:c,userDetails:n,handleDeleteMessage:M,togglePinMessage:u})})}),e.jsx(he,{title:"Add New Message",placement:"left",children:e.jsx(xe,{color:"primary","aria-label":"add message",onClick:y,sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},children:e.jsx(me,{})})}),e.jsx(fe,{open:s,autoHideDuration:6e3,onClose:v,children:e.jsx(je,{onClose:v,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})};export{Ye as default};
