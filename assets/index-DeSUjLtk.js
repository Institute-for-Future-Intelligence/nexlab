import{r as L,j as i,B as st,a as Se,T as Er,am as Rr,P as Or,an as Mr,ao as Nr,ap as tn,aq as ke,ar as Br,z as Ht,I as Oe,c as Je,d as et,D as ot,m as lt,V as dt,W as ct,aj as Pr,ai as _n,ak as zt,_ as ht,t as qr,v as Lr,b8 as Hr,x as Wt,w as zr,l as xt,n as Ot,o as yt,k as Wr}from"./ui-ySD7tZ62.js";import{u as $r,f as Et,r as tt,C as Vr,R as Qr,g as Mt,h as J,V as nn}from"./index-CTPNa2rH.js";import{q as Cn,k as mt,r as pt,n as qt,z as nr,l as rr,p as Sn,_ as Ce,h as Rt,e as je,f as Gr,R as _e,x as Pe,v as me,t as Xe,m as Ke,i as rn,y as bt}from"./firebase-DpGenoA-.js";import{E as sr}from"./Edit-B4NsC2fr.js";import{g as Ge}from"./vendor-BFl3bqVE.js";import sn from"./purify.es-CQJ0hv7W.js";const ir=L.memo(({setIsAdding:g})=>{console.log("Header loaded");const I=$r(),k=()=>{I("/")};return i.jsxs(st,{className:"lab-notebook-container",children:[i.jsx(st,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Se,{variant:"text",onClick:k,className:"back-home-button",children:"← Home Page"})}),i.jsx(st,{sx:{display:"flex",alignItems:"center",mb:2},children:i.jsx(Er,{className:"webpage_title",children:"My Laboratory Notebook"})}),i.jsx(st,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx(Se,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>g(!0),children:"+ Create New"})})]})});ir.displayName="Header";const ut=({designs:g,handleEdit:I,handleDelete:k,userDetails:l,showUserIdColumn:e})=>{const t=a=>a?a instanceof Cn?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx(Rr,{component:Or,children:i.jsxs(Mr,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[i.jsx(Nr,{children:i.jsxs(tn,{sx:{height:"60px"},children:[i.jsx(ke,{sx:{fontWeight:"bold",width:e?"30%":"40%"},children:"Title"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),e&&i.jsx(ke,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),i.jsx(Br,{children:g&&g.length>0?g.map(a=>{const d=a.userId===(l==null?void 0:l.uid);return i.jsxs(tn,{sx:{height:"80px"},children:[i.jsx(ke,{children:i.jsx("button",{onClick:()=>I(a.id),className:"hyperlink-style",children:a.title})}),i.jsx(ke,{children:a.course&&(l!=null&&l.classes)&&l.classes[a.course]?`${l.classes[a.course].number} - ${l.classes[a.course].title}`:"N/A"}),e&&i.jsx(ke,{children:a.userId}),i.jsx(ke,{children:t(a.dateCreated)}),i.jsx(ke,{children:t(a.dateModified)}),i.jsx(ke,{children:i.jsx(Ht,{title:"Edit",children:i.jsx("span",{children:i.jsx(Oe,{onClick:()=>d&&I(a.id),color:"primary",disabled:!d,children:i.jsx(sr,{})})})})}),i.jsx(ke,{children:i.jsx(Ht,{title:"Delete",children:i.jsx("span",{children:i.jsx(Oe,{onClick:()=>d&&k(a.id),color:"error",disabled:!d,children:i.jsx(Et,{})})})})})]},a.id)}):i.jsx(tn,{children:i.jsx(ke,{colSpan:e?6:5,children:"No Designs Found"})})})]})})};function Zr(g,I){return I.forEach(function(k){k&&typeof k!="string"&&!Array.isArray(k)&&Object.keys(k).forEach(function(l){if(l!=="default"&&!(l in g)){var e=Object.getOwnPropertyDescriptor(k,l);Object.defineProperty(g,l,e.get?e:{enumerable:!0,get:function(){return k[l]}})}})}),Object.freeze(g)}function ar(g,I){return new Promise(function(k,l){let e;return Yr(g).then(function(t){try{return e=t,k(new Blob([I.slice(0,2),e,I.slice(2)],{type:"image/jpeg"}))}catch(a){return l(a)}},l)})}const Yr=g=>new Promise((I,k)=>{const l=new FileReader;l.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let a=0;if(t.getUint16(a)!==65496)return k("not a valid JPEG");for(a+=2;;){const d=t.getUint16(a);if(d===65498)break;const x=t.getUint16(a+2);if(d===65505&&t.getUint32(a+4)===1165519206){const v=a+10;let n;switch(t.getUint16(v)){case 18761:n=!0;break;case 19789:n=!1;break;default:return k("TIFF header contains invalid endian")}if(t.getUint16(v+2,n)!==42)return k("TIFF header contains invalid version");const s=t.getUint32(v+4,n),r=v+s+2+12*t.getUint16(v+s,n);for(let c=v+s+2;c<r;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return k("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return k("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return I(e.slice(a,a+2+x))}a+=2+x}return I(new Blob)}),l.readAsArrayBuffer(g)});var $t={},Kr={get exports(){return $t},set exports(g){$t=g}};(function(g){var I,k,l={};Kr.exports=l,l.parse=function(e,t){for(var a=l.bin.readUshort,d=l.bin.readUint,x=0,v={},n=new Uint8Array(e),s=n.length-4;d(n,s)!=101010256;)s--;x=s,x+=4;var r=a(n,x+=4);a(n,x+=2);var c=d(n,x+=2),m=d(n,x+=4);x+=4,x=m;for(var A=0;A<r;A++){d(n,x),x+=4,x+=4,x+=4,d(n,x+=4),c=d(n,x+=4);var D=d(n,x+=4),S=a(n,x+=4),B=a(n,x+2),O=a(n,x+4);x+=6;var _=d(n,x+=8);x+=4,x+=S+B+O,l._readLocal(n,_,v,c,D,t)}return v},l._readLocal=function(e,t,a,d,x,v){var n=l.bin.readUshort,s=l.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var c=n(e,t+=8),m=n(e,t+=2);t+=2;var A=l.bin.readUTF8(e,t,c);if(t+=c,t+=m,v)a[A]={size:x,csize:d};else{var D=new Uint8Array(e.buffer,t);if(r==0)a[A]=new Uint8Array(D.buffer.slice(t,t+d));else{if(r!=8)throw"unknown compression method: "+r;var S=new Uint8Array(x);l.inflateRaw(D,S),a[A]=S}}},l.inflateRaw=function(e,t){return l.F.inflate(e,t)},l.inflate=function(e,t){return e[0],e[1],l.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},l.deflate=function(e,t){t==null&&(t={level:6});var a=0,d=new Uint8Array(50+Math.floor(1.1*e.length));d[a]=120,d[a+1]=156,a+=2,a=l.F.deflateRaw(e,d,a,t.level);var x=l.adler(e,0,e.length);return d[a+0]=x>>>24&255,d[a+1]=x>>>16&255,d[a+2]=x>>>8&255,d[a+3]=x>>>0&255,new Uint8Array(d.buffer,0,a+4)},l.deflateRaw=function(e,t){t==null&&(t={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),d=l.F.deflateRaw(e,a,d,t.level);return new Uint8Array(a.buffer,0,d)},l.encode=function(e,t){t==null&&(t=!1);var a=0,d=l.bin.writeUint,x=l.bin.writeUshort,v={};for(var n in e){var s=!l._noNeed(n)&&!t,r=e[n],c=l.crc.crc(r,0,r.length);v[n]={cpr:s,usize:r.length,crc:c,file:s?l.deflateRaw(r):r}}for(var n in v)a+=v[n].file.length+30+46+2*l.bin.sizeUTF8(n);a+=22;var m=new Uint8Array(a),A=0,D=[];for(var n in v){var S=v[n];D.push(A),A=l._writeHeader(m,A,n,S,0)}var B=0,O=A;for(var n in v)S=v[n],D.push(A),A=l._writeHeader(m,A,n,S,1,D[B++]);var _=A-O;return d(m,A,101010256),A+=4,x(m,A+=4,B),x(m,A+=2,B),d(m,A+=2,_),d(m,A+=4,O),A+=4,A+=2,m.buffer},l._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},l._writeHeader=function(e,t,a,d,x,v){var n=l.bin.writeUint,s=l.bin.writeUshort,r=d.file;return n(e,t,x==0?67324752:33639248),t+=4,x==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,d.cpr?8:0),n(e,t+=2,0),n(e,t+=4,d.crc),n(e,t+=4,r.length),n(e,t+=4,d.usize),s(e,t+=4,l.bin.sizeUTF8(a)),s(e,t+=2,0),t+=2,x==1&&(t+=2,t+=2,n(e,t+=6,v),t+=4),t+=l.bin.writeUTF8(e,t,a),x==0&&(e.set(r,t),t+=r.length),t},l.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var a=t,d=0;d<8;d++)1&a?a=3988292384^a>>>1:a>>>=1;e[t]=a}return e}(),update:function(e,t,a,d){for(var x=0;x<d;x++)e=l.crc.table[255&(e^t[a+x])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^l.crc.update(4294967295,e,t,a)}},l.adler=function(e,t,a){for(var d=1,x=0,v=t,n=t+a;v<n;){for(var s=Math.min(v+5552,n);v<s;)x+=d+=e[v++];d%=65521,x%=65521}return x<<16|d},l.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255,e[t+2]=a>>16&255,e[t+3]=a>>24&255},readASCII:function(e,t,a){for(var d="",x=0;x<a;x++)d+=String.fromCharCode(e[t+x]);return d},writeASCII:function(e,t,a){for(var d=0;d<a.length;d++)e[t+d]=a.charCodeAt(d)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,a){for(var d,x="",v=0;v<a;v++)x+="%"+l.bin.pad(e[t+v].toString(16));try{d=decodeURIComponent(x)}catch{return l.bin.readASCII(e,t,a)}return d},writeUTF8:function(e,t,a){for(var d=a.length,x=0,v=0;v<d;v++){var n=a.charCodeAt(v);if((4294967168&n)==0)e[t+x]=n,x++;else if((4294965248&n)==0)e[t+x]=192|n>>6,e[t+x+1]=128|n>>0&63,x+=2;else if((4294901760&n)==0)e[t+x]=224|n>>12,e[t+x+1]=128|n>>6&63,e[t+x+2]=128|n>>0&63,x+=3;else{if((4292870144&n)!=0)throw"e";e[t+x]=240|n>>18,e[t+x+1]=128|n>>12&63,e[t+x+2]=128|n>>6&63,e[t+x+3]=128|n>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var t=e.length,a=0,d=0;d<t;d++){var x=e.charCodeAt(d);if((4294967168&x)==0)a++;else if((4294965248&x)==0)a+=2;else if((4294901760&x)==0)a+=3;else{if((4292870144&x)!=0)throw"e";a+=4}}return a}},l.F={},l.F.deflateRaw=function(e,t,a,d){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][d],v=l.F.U,n=l.F._goodIndex;l.F._hash;var s=l.F._putsE,r=0,c=a<<3,m=0,A=e.length;if(d==0){for(;r<A;)s(t,c,r+(j=Math.min(65535,A-r))==A?1:0),c=l.F._copyExact(e,r,j,t,c+8),r+=j;return c>>>3}var D=v.lits,S=v.strt,B=v.prev,O=0,_=0,P=0,y=0,R=0,h=0;for(A>2&&(S[h=l.F._hash(e,0)]=0),r=0;r<A;r++){if(R=h,r+1<A-2){h=l.F._hash(e,r+1);var u=r+1&32767;B[u]=S[h],S[h]=u}if(m<=r){(O>14e3||_>26697)&&A-r>100&&(m<r&&(D[O]=r-m,O+=2,m=r),c=l.F._writeBlock(r==A-1||m==A?1:0,D,O,y,e,P,r-P,t,c),O=_=y=0,P=r);var p=0;r<A-2&&(p=l.F._bestMatch(e,r,B,R,Math.min(x[2],A-r),x[3]));var j=p>>>16,w=65535&p;if(p!=0){w=65535&p;var C=n(j=p>>>16,v.of0);v.lhst[257+C]++;var b=n(w,v.df0);v.dhst[b]++,y+=v.exb[C]+v.dxb[b],D[O]=j<<23|r-m,D[O+1]=w<<16|C<<8|b,O+=2,m=r+j}else v.lhst[e[r]]++;_++}}for(P==r&&e.length!=0||(m<r&&(D[O]=r-m,O+=2,m=r),c=l.F._writeBlock(1,D,O,y,e,P,r-P,t,c),O=0,_=0,O=_=y=0,P=r);(7&c)!=0;)c++;return c>>>3},l.F._bestMatch=function(e,t,a,d,x,v){var n=32767&t,s=a[n],r=n-s+32768&32767;if(s==n||d!=l.F._hash(e,t-r))return 0;for(var c=0,m=0,A=Math.min(32767,t);r<=A&&--v!=0&&s!=n;){if(c==0||e[t+c]==e[t+c-r]){var D=l.F._howLong(e,t,r);if(D>c){if(m=r,(c=D)>=x)break;r+2<D&&(D=r+2);for(var S=0,B=0;B<D-2;B++){var O=t-r+B+32768&32767,_=O-a[O]+32768&32767;_>S&&(S=_,s=O)}}}r+=(n=s)-(s=a[n])+32768&32767}return c<<16|m},l.F._howLong=function(e,t,a){if(e[t]!=e[t-a]||e[t+1]!=e[t+1-a]||e[t+2]!=e[t+2-a])return 0;var d=t,x=Math.min(e.length,t+258);for(t+=3;t<x&&e[t]==e[t-a];)t++;return t-d},l.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},l.saved=0,l.F._writeBlock=function(e,t,a,d,x,v,n,s,r){var c,m,A,D,S,B,O,_,P,y=l.F.U,R=l.F._putsF,h=l.F._putsE;y.lhst[256]++,m=(c=l.F.getTrees())[0],A=c[1],D=c[2],S=c[3],B=c[4],O=c[5],_=c[6],P=c[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),p=d+l.F.contSize(y.fltree,y.lhst)+l.F.contSize(y.fdtree,y.dhst),j=d+l.F.contSize(y.ltree,y.lhst)+l.F.contSize(y.dtree,y.dhst);j+=14+3*O+l.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var w=0;w<286;w++)y.lhst[w]=0;for(w=0;w<30;w++)y.dhst[w]=0;for(w=0;w<19;w++)y.ihst[w]=0;var C=u<p&&u<j?0:p<j?1:2;if(R(s,r,e),R(s,r+1,C),r+=3,C==0){for(;(7&r)!=0;)r++;r=l.F._copyExact(x,v,n,s,r)}else{var b,T;if(C==1&&(b=y.fltree,T=y.fdtree),C==2){l.F.makeCodes(y.ltree,m),l.F.revCodes(y.ltree,m),l.F.makeCodes(y.dtree,A),l.F.revCodes(y.dtree,A),l.F.makeCodes(y.itree,D),l.F.revCodes(y.itree,D),b=y.ltree,T=y.dtree,h(s,r,S-257),h(s,r+=5,B-1),h(s,r+=5,O-4),r+=4;for(var f=0;f<O;f++)h(s,r+3*f,y.itree[1+(y.ordr[f]<<1)]);r+=3*O,r=l.F._codeTiny(_,y.itree,s,r),r=l.F._codeTiny(P,y.itree,s,r)}for(var o=v,N=0;N<a;N+=2){for(var F=t[N],M=F>>>23,$=o+(8388607&F);o<$;)r=l.F._writeLit(x[o++],b,s,r);if(M!=0){var H=t[N+1],Q=H>>16,z=H>>8&255,E=255&H;h(s,r=l.F._writeLit(257+z,b,s,r),M-y.of0[z]),r+=y.exb[z],R(s,r=l.F._writeLit(E,T,s,r),Q-y.df0[E]),r+=y.dxb[E],o+=M}}r=l.F._writeLit(256,b,s,r)}return r},l.F._copyExact=function(e,t,a,d,x){var v=x>>>3;return d[v]=a,d[v+1]=a>>>8,d[v+2]=255-d[v],d[v+3]=255-d[v+1],v+=4,d.set(new Uint8Array(e.buffer,t,a),v),x+(a+4<<3)},l.F.getTrees=function(){for(var e=l.F.U,t=l.F._hufTree(e.lhst,e.ltree,15),a=l.F._hufTree(e.dhst,e.dtree,15),d=[],x=l.F._lenCodes(e.ltree,d),v=[],n=l.F._lenCodes(e.dtree,v),s=0;s<d.length;s+=2)e.ihst[d[s]]++;for(s=0;s<v.length;s+=2)e.ihst[v[s]]++;for(var r=l.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,a,r,x,n,c,d,v]},l.F.getSecond=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(e[a+1]);return t},l.F.nonZero=function(e){for(var t="",a=0;a<e.length;a+=2)e[a+1]!=0&&(t+=(a>>1)+",");return t},l.F.contSize=function(e,t){for(var a=0,d=0;d<t.length;d++)a+=t[d]*e[1+(d<<1)];return a},l.F._codeTiny=function(e,t,a,d){for(var x=0;x<e.length;x+=2){var v=e[x],n=e[x+1];d=l.F._writeLit(v,t,a,d);var s=v==16?2:v==17?3:7;v>15&&(l.F._putsE(a,d,n,s),d+=s)}return d},l.F._lenCodes=function(e,t){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var d=0;d<a;d+=2){var x=e[d+1],v=d+3<a?e[d+3]:-1,n=d+5<a?e[d+5]:-1,s=d==0?-1:e[d-1];if(x==0&&v==x&&n==x){for(var r=d+5;r+2<a&&e[r+2]==x;)r+=2;(c=Math.min(r+1-d>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),d+=2*c-2}else if(x==s&&v==x&&n==x){for(r=d+5;r+2<a&&e[r+2]==x;)r+=2;var c=Math.min(r+1-d>>>1,6);t.push(16,c-3),d+=2*c-2}else t.push(x,0)}return a>>>1},l.F._hufTree=function(e,t,a){var d=[],x=e.length,v=t.length,n=0;for(n=0;n<v;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<x;n++)e[n]!=0&&d.push({lit:n,f:e[n]});var s=d.length,r=d.slice(0);if(s==0)return 0;if(s==1){var c=d[0].lit;return r=c==0?1:0,t[1+(c<<1)]=1,t[1+(r<<1)]=1,1}d.sort(function(_,P){return _.f-P.f});var m=d[0],A=d[1],D=0,S=1,B=2;for(d[0]={lit:-1,f:m.f+A.f,l:m,r:A,d:0};S!=s-1;)m=D!=S&&(B==s||d[D].f<d[B].f)?d[D++]:d[B++],A=D!=S&&(B==s||d[D].f<d[B].f)?d[D++]:d[B++],d[S++]={lit:-1,f:m.f+A.f,l:m,r:A};var O=l.F.setDepth(d[S-1],0);for(O>a&&(l.F.restrictDepth(r,a,O),O=a),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return O},l.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(l.F.setDepth(e.l,t+1),l.F.setDepth(e.r,t+1))},l.F.restrictDepth=function(e,t,a){var d=0,x=1<<a-t,v=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),d=0;d<e.length&&e[d].d>t;d++){var n=e[d].d;e[d].d=t,v+=x-(1<<a-n)}for(v>>>=a-t;v>0;)(n=e[d].d)<t?(e[d].d++,v-=1<<t-n-1):d++;for(;d>=0;d--)e[d].d==t&&v<0&&(e[d].d--,v++);v!=0&&console.log("debt left")},l.F._goodIndex=function(e,t){var a=0;return t[16|a]<=e&&(a|=16),t[8|a]<=e&&(a|=8),t[4|a]<=e&&(a|=4),t[2|a]<=e&&(a|=2),t[1|a]<=e&&(a|=1),a},l.F._writeLit=function(e,t,a,d){return l.F._putsF(a,d,t[e<<1]),d+t[1+(e<<1)]},l.F.inflate=function(e,t){var a=Uint8Array;if(e[0]==3&&e[1]==0)return t||new a(0);var d=l.F,x=d._bitsF,v=d._bitsE,n=d._decodeTiny,s=d.makeCodes,r=d.codes2map,c=d._get17,m=d.U,A=t==null;A&&(t=new a(e.length>>>2<<3));for(var D,S,B=0,O=0,_=0,P=0,y=0,R=0,h=0,u=0,p=0;B==0;)if(B=x(e,p,1),O=x(e,p+1,2),p+=3,O!=0){if(A&&(t=l.F._check(t,u+(1<<17))),O==1&&(D=m.flmap,S=m.fdmap,R=511,h=31),O==2){_=v(e,p,5)+257,P=v(e,p+5,5)+1,y=v(e,p+10,4)+4,p+=14;for(var j=0;j<38;j+=2)m.itree[j]=0,m.itree[j+1]=0;var w=1;for(j=0;j<y;j++){var C=v(e,p+3*j,3);m.itree[1+(m.ordr[j]<<1)]=C,C>w&&(w=C)}p+=3*y,s(m.itree,w),r(m.itree,w,m.imap),D=m.lmap,S=m.dmap,p=n(m.imap,(1<<w)-1,_+P,e,p,m.ttree);var b=d._copyOut(m.ttree,0,_,m.ltree);R=(1<<b)-1;var T=d._copyOut(m.ttree,_,P,m.dtree);h=(1<<T)-1,s(m.ltree,b),r(m.ltree,b,D),s(m.dtree,T),r(m.dtree,T,S)}for(;;){var f=D[c(e,p)&R];p+=15&f;var o=f>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var N=u+o-254;if(o>264){var F=m.ldef[o-257];N=u+(F>>>3)+v(e,p,7&F),p+=7&F}var M=S[c(e,p)&h];p+=15&M;var $=M>>>4,H=m.ddef[$],Q=(H>>>4)+x(e,p,15&H);for(p+=15&H,A&&(t=l.F._check(t,u+(1<<17)));u<N;)t[u]=t[u++-Q],t[u]=t[u++-Q],t[u]=t[u++-Q],t[u]=t[u++-Q];u=N}}}else{(7&p)!=0&&(p+=8-(7&p));var z=4+(p>>>3),E=e[z-4]|e[z-3]<<8;A&&(t=l.F._check(t,u+E)),t.set(new a(e.buffer,e.byteOffset+z,E),u),p=z+E<<3,u+=E}return t.length==u?t:t.slice(0,u)},l.F._check=function(e,t){var a=e.length;if(t<=a)return e;var d=new Uint8Array(Math.max(a<<1,t));return d.set(e,0),d},l.F._decodeTiny=function(e,t,a,d,x,v){for(var n=l.F._bitsE,s=l.F._get17,r=0;r<a;){var c=e[s(d,x)&t];x+=15&c;var m=c>>>4;if(m<=15)v[r]=m,r++;else{var A=0,D=0;m==16?(D=3+n(d,x,2),x+=2,A=v[r-1]):m==17?(D=3+n(d,x,3),x+=3):m==18&&(D=11+n(d,x,7),x+=7);for(var S=r+D;r<S;)v[r]=A,r++}}return x},l.F._copyOut=function(e,t,a,d){for(var x=0,v=0,n=d.length>>>1;v<a;){var s=e[v+t];d[v<<1]=0,d[1+(v<<1)]=s,s>x&&(x=s),v++}for(;v<n;)d[v<<1]=0,d[1+(v<<1)]=0,v++;return x},l.F.makeCodes=function(e,t){for(var a,d,x,v,n=l.F.U,s=e.length,r=n.bl_count,c=0;c<=t;c++)r[c]=0;for(c=1;c<s;c+=2)r[e[c]]++;var m=n.next_code;for(a=0,r[0]=0,d=1;d<=t;d++)a=a+r[d-1]<<1,m[d]=a;for(x=0;x<s;x+=2)(v=e[x+1])!=0&&(e[x]=m[v],m[v]++)},l.F.codes2map=function(e,t,a){for(var d=e.length,x=l.F.U.rev15,v=0;v<d;v+=2)if(e[v+1]!=0)for(var n=v>>1,s=e[v+1],r=n<<4|s,c=t-s,m=e[v]<<c,A=m+(1<<c);m!=A;)a[x[m]>>>15-t]=r,m++},l.F.revCodes=function(e,t){for(var a=l.F.U.rev15,d=15-t,x=0;x<e.length;x+=2){var v=e[x]<<t-e[x+1];e[x]=a[v]>>>d}},l.F._putsE=function(e,t,a){a<<=7&t;var d=t>>>3;e[d]|=a,e[d+1]|=a>>>8},l.F._putsF=function(e,t,a){a<<=7&t;var d=t>>>3;e[d]|=a,e[d+1]|=a>>>8,e[d+2]|=a>>>16},l.F._bitsE=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<a)-1},l.F._bitsF=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<a)-1},l.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},l.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},l.F.U=(I=Uint16Array,k=Uint32Array,{next_code:new I(16),bl_count:new I(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new I(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new k(32),flmap:new I(512),fltree:[],fdmap:new I(32),fdtree:[],lmap:new I(32768),ltree:[],ttree:[],dmap:new I(32768),dtree:[],imap:new I(512),itree:[],rev15:new I(32768),lhst:new k(286),dhst:new k(30),ihst:new k(19),lits:new k(15e3),strt:new I(65536),prev:new I(32768)}),function(){for(var e=l.F.U,t=0;t<32768;t++){var a=t;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[t]=(a>>>16|a<<16)>>>17}function d(x,v,n){for(;v--!=0;)x.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];d(e.fltree,144,8),d(e.fltree,112,9),d(e.fltree,24,7),d(e.fltree,8,8),l.F.makeCodes(e.fltree,9),l.F.codes2map(e.fltree,9,e.flmap),l.F.revCodes(e.fltree,9),d(e.fdtree,32,5),l.F.makeCodes(e.fdtree,5),l.F.codes2map(e.fdtree,5,e.fdmap),l.F.revCodes(e.fdtree,5),d(e.itree,19,0),d(e.ltree,286,0),d(e.dtree,30,0),d(e.ttree,320,0)}()})();var Xr=Zr({__proto__:null,default:$t},[$t]);const Be=function(){var g={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let c="";for(let m=0;m<r;m++)c+=String.fromCharCode(n[s+m]);return c},writeASCII(n,s,r){for(let c=0;c<r.length;c++)n[s+c]=r.charCodeAt(c)},readBytes(n,s,r){const c=[];for(let m=0;m<r;m++)c.push(n[s+m]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let c,m="";for(let A=0;A<r;A++)m+=`%${g.pad(n[s+A].toString(16))}`;try{c=decodeURIComponent(m)}catch{return g.readASCII(n,s,r)}return c}};function I(n,s,r,c){const m=s*r,A=t(c),D=Math.ceil(s*A/8),S=new Uint8Array(4*m),B=new Uint32Array(S.buffer),{ctype:O}=c,{depth:_}=c,P=g.readUshort;if(O==6){const F=m<<2;if(_==8)for(var y=0;y<F;y+=4)S[y]=n[y],S[y+1]=n[y+1],S[y+2]=n[y+2],S[y+3]=n[y+3];if(_==16)for(y=0;y<F;y++)S[y]=n[y<<1]}else if(O==2){const F=c.tabs.tRNS;if(F==null){if(_==8)for(y=0;y<m;y++){var R=3*y;B[y]=255<<24|n[R+2]<<16|n[R+1]<<8|n[R]}if(_==16)for(y=0;y<m;y++)R=6*y,B[y]=255<<24|n[R+4]<<16|n[R+2]<<8|n[R]}else{var h=F[0];const M=F[1],$=F[2];if(_==8)for(y=0;y<m;y++){var u=y<<2;R=3*y,B[y]=255<<24|n[R+2]<<16|n[R+1]<<8|n[R],n[R]==h&&n[R+1]==M&&n[R+2]==$&&(S[u+3]=0)}if(_==16)for(y=0;y<m;y++)u=y<<2,R=6*y,B[y]=255<<24|n[R+4]<<16|n[R+2]<<8|n[R],P(n,R)==h&&P(n,R+2)==M&&P(n,R+4)==$&&(S[u+3]=0)}}else if(O==3){const F=c.tabs.PLTE,M=c.tabs.tRNS,$=M?M.length:0;if(_==1)for(var p=0;p<r;p++){var j=p*D,w=p*s;for(y=0;y<s;y++){u=w+y<<2;var C=3*(b=n[j+(y>>3)]>>7-((7&y)<<0)&1);S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255}}if(_==2)for(p=0;p<r;p++)for(j=p*D,w=p*s,y=0;y<s;y++)u=w+y<<2,C=3*(b=n[j+(y>>2)]>>6-((3&y)<<1)&3),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255;if(_==4)for(p=0;p<r;p++)for(j=p*D,w=p*s,y=0;y<s;y++)u=w+y<<2,C=3*(b=n[j+(y>>1)]>>4-((1&y)<<2)&15),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255;if(_==8)for(y=0;y<m;y++){var b;u=y<<2,C=3*(b=n[y]),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255}}else if(O==4){if(_==8)for(y=0;y<m;y++){u=y<<2;var T=n[f=y<<1];S[u]=T,S[u+1]=T,S[u+2]=T,S[u+3]=n[f+1]}if(_==16)for(y=0;y<m;y++){var f;u=y<<2,T=n[f=y<<2],S[u]=T,S[u+1]=T,S[u+2]=T,S[u+3]=n[f+2]}}else if(O==0)for(h=c.tabs.tRNS?c.tabs.tRNS:-1,p=0;p<r;p++){const F=p*D,M=p*s;if(_==1)for(var o=0;o<s;o++){var N=(T=255*(n[F+(o>>>3)]>>>7-(7&o)&1))==255*h?0:255;B[M+o]=N<<24|T<<16|T<<8|T}else if(_==2)for(o=0;o<s;o++)N=(T=85*(n[F+(o>>>2)]>>>6-((3&o)<<1)&3))==85*h?0:255,B[M+o]=N<<24|T<<16|T<<8|T;else if(_==4)for(o=0;o<s;o++)N=(T=17*(n[F+(o>>>1)]>>>4-((1&o)<<2)&15))==17*h?0:255,B[M+o]=N<<24|T<<16|T<<8|T;else if(_==8)for(o=0;o<s;o++)N=(T=n[F+o])==h?0:255,B[M+o]=N<<24|T<<16|T<<8|T;else if(_==16)for(o=0;o<s;o++)T=n[F+(o<<1)],N=P(n,F+(o<<1))==h?0:255,B[M+o]=N<<24|T<<16|T<<8|T}return S}function k(n,s,r,c){const m=t(n),A=Math.ceil(r*m/8),D=new Uint8Array((A+1+n.interlace)*c);return s=n.tabs.CgBI?e(s,D):l(s,D),n.interlace==0?s=a(s,n,0,r,c):n.interlace==1&&(s=function(B,O){const _=O.width,P=O.height,y=t(O),R=y>>3,h=Math.ceil(_*y/8),u=new Uint8Array(P*h);let p=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let T=0;for(;T<7;){const o=C[T],N=b[T];let F=0,M=0,$=j[T];for(;$<P;)$+=o,M++;let H=w[T];for(;H<_;)H+=N,F++;const Q=Math.ceil(F*y/8);a(B,O,p,F,M);let z=0,E=j[T];for(;E<P;){let Y=w[T],re=p+z*Q<<3;for(;Y<_;){var f;if(y==1&&(f=(f=B[re>>3])>>7-(7&re)&1,u[E*h+(Y>>3)]|=f<<7-((7&Y)<<0)),y==2&&(f=(f=B[re>>3])>>6-(7&re)&3,u[E*h+(Y>>2)]|=f<<6-((3&Y)<<1)),y==4&&(f=(f=B[re>>3])>>4-(7&re)&15,u[E*h+(Y>>1)]|=f<<4-((1&Y)<<2)),y>=8){const te=E*h+Y*R;for(let X=0;X<R;X++)u[te+X]=B[(re>>3)+X]}re+=y,Y+=N}z++,E+=o}F*M!=0&&(p+=M*(1+Q)),T+=1}return u}(s,n)),s}function l(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const c=Uint8Array;let m,A,D=0,S=0,B=0,O=0,_=0,P=0,y=0,R=0,h=0;if(s[0]==3&&s[1]==0)return r||new c(0);const u=n.H,p=u.b,j=u.e,w=u.R,C=u.n,b=u.A,T=u.Z,f=u.m,o=r==null;for(o&&(r=new c(s.length>>>2<<5));D==0;)if(D=p(s,h,1),S=p(s,h+1,2),h+=3,S!=0){if(o&&(r=n.H.W(r,R+(1<<17))),S==1&&(m=f.J,A=f.h,P=511,y=31),S==2){B=j(s,h,5)+257,O=j(s,h+5,5)+1,_=j(s,h+10,4)+4,h+=14;let F=1;for(var N=0;N<38;N+=2)f.Q[N]=0,f.Q[N+1]=0;for(N=0;N<_;N++){const H=j(s,h+3*N,3);f.Q[1+(f.X[N]<<1)]=H,H>F&&(F=H)}h+=3*_,C(f.Q,F),b(f.Q,F,f.u),m=f.w,A=f.d,h=w(f.u,(1<<F)-1,B+O,s,h,f.v);const M=u.V(f.v,0,B,f.C);P=(1<<M)-1;const $=u.V(f.v,B,O,f.D);y=(1<<$)-1,C(f.C,M),b(f.C,M,m),C(f.D,$),b(f.D,$,A)}for(;;){const F=m[T(s,h)&P];h+=15&F;const M=F>>>4;if(!(M>>>8))r[R++]=M;else{if(M==256)break;{let $=R+M-254;if(M>264){const Y=f.q[M-257];$=R+(Y>>>3)+j(s,h,7&Y),h+=7&Y}const H=A[T(s,h)&y];h+=15&H;const Q=H>>>4,z=f.c[Q],E=(z>>>4)+p(s,h,15&z);for(h+=15&z;R<$;)r[R]=r[R++-E],r[R]=r[R++-E],r[R]=r[R++-E],r[R]=r[R++-E];R=$}}}}else{(7&h)!=0&&(h+=8-(7&h));const F=4+(h>>>3),M=s[F-4]|s[F-3]<<8;o&&(r=n.H.W(r,R+M)),r.set(new c(s.buffer,s.byteOffset+F,M),R),h=F+M<<3,R+=M}return r.length==R?r:r.slice(0,R)},n.H.W=function(s,r){const c=s.length;if(r<=c)return s;const m=new Uint8Array(c<<1);return m.set(s,0),m},n.H.R=function(s,r,c,m,A,D){const S=n.H.e,B=n.H.Z;let O=0;for(;O<c;){const _=s[B(m,A)&r];A+=15&_;const P=_>>>4;if(P<=15)D[O]=P,O++;else{let y=0,R=0;P==16?(R=3+S(m,A,2),A+=2,y=D[O-1]):P==17?(R=3+S(m,A,3),A+=3):P==18&&(R=11+S(m,A,7),A+=7);const h=O+R;for(;O<h;)D[O]=y,O++}}return A},n.H.V=function(s,r,c,m){let A=0,D=0;const S=m.length>>>1;for(;D<c;){const B=s[D+r];m[D<<1]=0,m[1+(D<<1)]=B,B>A&&(A=B),D++}for(;D<S;)m[D<<1]=0,m[1+(D<<1)]=0,D++;return A},n.H.n=function(s,r){const c=n.H.m,m=s.length;let A,D,S,B;const O=c.j;for(var _=0;_<=r;_++)O[_]=0;for(_=1;_<m;_+=2)O[s[_]]++;const P=c.K;for(A=0,O[0]=0,D=1;D<=r;D++)A=A+O[D-1]<<1,P[D]=A;for(S=0;S<m;S+=2)B=s[S+1],B!=0&&(s[S]=P[B],P[B]++)},n.H.A=function(s,r,c){const m=s.length,A=n.H.m.r;for(let D=0;D<m;D+=2)if(s[D+1]!=0){const S=D>>1,B=s[D+1],O=S<<4|B,_=r-B;let P=s[D]<<_;const y=P+(1<<_);for(;P!=y;)c[A[P]>>>15-r]=O,P++}},n.H.l=function(s,r){const c=n.H.m.r,m=15-r;for(let A=0;A<s.length;A+=2){const D=s[A]<<r-s[A+1];s[A]=c[D]>>>m}},n.H.M=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8},n.H.I=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8,s[m+2]|=c>>>16},n.H.e=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<c)-1},n.H.b=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<c)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let m=r;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,s.r[r]=(m>>>16|m<<16)>>>17}function c(m,A,D){for(;A--!=0;)m.push(0,D)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];c(s._,144,8),c(s._,112,9),c(s._,24,7),c(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),c(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),c(s.Q,19,0),c(s.C,286,0),c(s.D,30,0),c(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function a(n,s,r,c,m){let A=t(s);const D=Math.ceil(c*A/8);let S,B;A=Math.ceil(A/8);let O=n[r],_=0;if(O>1&&(n[r]=[0,0,1][O-2]),O==3)for(_=A;_<D;_++)n[_+1]=n[_+1]+(n[_+1-A]>>>1)&255;for(let P=0;P<m;P++)if(S=r+P*D,B=S+P+1,O=n[B-1],_=0,O==0)for(;_<D;_++)n[S+_]=n[B+_];else if(O==1){for(;_<A;_++)n[S+_]=n[B+_];for(;_<D;_++)n[S+_]=n[B+_]+n[S+_-A]}else if(O==2)for(;_<D;_++)n[S+_]=n[B+_]+n[S+_-D];else if(O==3){for(;_<A;_++)n[S+_]=n[B+_]+(n[S+_-D]>>>1);for(;_<D;_++)n[S+_]=n[B+_]+(n[S+_-D]+n[S+_-A]>>>1)}else{for(;_<A;_++)n[S+_]=n[B+_]+d(0,n[S+_-D],0);for(;_<D;_++)n[S+_]=n[B+_]+d(n[S+_-A],n[S+_-D],n[S+_-A-D])}return n}function d(n,s,r){const c=n+s-r,m=c-n,A=c-s,D=c-r;return m*m<=A*A&&m*m<=D*D?n:A*A<=D*D?s:r}function x(n,s,r){r.width=g.readUint(n,s),s+=4,r.height=g.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function v(n,s,r,c,m,A,D,S,B){const O=Math.min(s,m),_=Math.min(r,A);let P=0,y=0;for(let T=0;T<_;T++)for(let f=0;f<O;f++)if(D>=0&&S>=0?(P=T*s+f<<2,y=(S+T)*m+D+f<<2):(P=(-S+T)*s-D+f<<2,y=T*m+f<<2),B==0)c[y]=n[P],c[y+1]=n[P+1],c[y+2]=n[P+2],c[y+3]=n[P+3];else if(B==1){var R=n[P+3]*.00392156862745098,h=n[P]*R,u=n[P+1]*R,p=n[P+2]*R,j=c[y+3]*(1/255),w=c[y]*j,C=c[y+1]*j,b=c[y+2]*j;const o=1-R,N=R+j*o,F=N==0?0:1/N;c[y+3]=255*N,c[y+0]=(h+w*o)*F,c[y+1]=(u+C*o)*F,c[y+2]=(p+b*o)*F}else if(B==2)R=n[P+3],h=n[P],u=n[P+1],p=n[P+2],j=c[y+3],w=c[y],C=c[y+1],b=c[y+2],R==j&&h==w&&u==C&&p==b?(c[y]=0,c[y+1]=0,c[y+2]=0,c[y+3]=0):(c[y]=h,c[y+1]=u,c[y+2]=p,c[y+3]=R);else if(B==3){if(R=n[P+3],h=n[P],u=n[P+1],p=n[P+2],j=c[y+3],w=c[y],C=c[y+1],b=c[y+2],R==j&&h==w&&u==C&&p==b)continue;if(R<220&&j>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let c=8;const m=g,A=m.readUshort,D=m.readUint,S={tabs:{},frames:[]},B=new Uint8Array(r.length);let O,_=0,P=0;const y=[137,80,78,71,13,10,26,10];for(var R=0;R<8;R++)if(r[R]!=y[R])throw"The input is not a PNG file!";for(;c<r.length;){const T=m.readUint(r,c);c+=4;const f=m.readASCII(r,c,4);if(c+=4,f=="IHDR")x(r,c,S);else if(f=="iCCP"){for(var h=c;r[h]!=0;)h++;m.readASCII(r,c,h-c),r[h+1];const o=r.slice(h+2,c+T);let N=null;try{N=l(o)}catch{N=e(o)}S.tabs[f]=N}else if(f=="CgBI")S.tabs[f]=r.slice(c,c+4);else if(f=="IDAT"){for(R=0;R<T;R++)B[_+R]=r[c+R];_+=T}else if(f=="acTL")S.tabs[f]={num_frames:D(r,c),num_plays:D(r,c+4)},O=new Uint8Array(r.length);else if(f=="fcTL"){P!=0&&((b=S.frames[S.frames.length-1]).data=k(S,O.slice(0,P),b.rect.width,b.rect.height),P=0);const o={x:D(r,c+12),y:D(r,c+16),width:D(r,c+4),height:D(r,c+8)};let N=A(r,c+22);N=A(r,c+20)/(N==0?100:N);const F={rect:o,delay:Math.round(1e3*N),dispose:r[c+24],blend:r[c+25]};S.frames.push(F)}else if(f=="fdAT"){for(R=0;R<T-4;R++)O[P+R]=r[c+R+4];P+=T-4}else if(f=="pHYs")S.tabs[f]=[m.readUint(r,c),m.readUint(r,c+4),r[c+8]];else if(f=="cHRM")for(S.tabs[f]=[],R=0;R<8;R++)S.tabs[f].push(m.readUint(r,c+4*R));else if(f=="tEXt"||f=="zTXt"){S.tabs[f]==null&&(S.tabs[f]={});var u=m.nextZero(r,c),p=m.readASCII(r,c,u-c),j=c+T-u-1;if(f=="tEXt")C=m.readASCII(r,u+1,j);else{var w=l(r.slice(u+2,u+2+j));C=m.readUTF8(w,0,w.length)}S.tabs[f][p]=C}else if(f=="iTXt"){S.tabs[f]==null&&(S.tabs[f]={}),u=0,h=c,u=m.nextZero(r,h),p=m.readASCII(r,h,u-h);const o=r[h=u+1];var C;r[h+1],h+=2,u=m.nextZero(r,h),m.readASCII(r,h,u-h),h=u+1,u=m.nextZero(r,h),m.readUTF8(r,h,u-h),j=T-((h=u+1)-c),o==0?C=m.readUTF8(r,h,j):(w=l(r.slice(h,h+j)),C=m.readUTF8(w,0,w.length)),S.tabs[f][p]=C}else if(f=="PLTE")S.tabs[f]=m.readBytes(r,c,T);else if(f=="hIST"){const o=S.tabs.PLTE.length/3;for(S.tabs[f]=[],R=0;R<o;R++)S.tabs[f].push(A(r,c+2*R))}else if(f=="tRNS")S.ctype==3?S.tabs[f]=m.readBytes(r,c,T):S.ctype==0?S.tabs[f]=A(r,c):S.ctype==2&&(S.tabs[f]=[A(r,c),A(r,c+2),A(r,c+4)]);else if(f=="gAMA")S.tabs[f]=m.readUint(r,c)/1e5;else if(f=="sRGB")S.tabs[f]=r[c];else if(f=="bKGD")S.ctype==0||S.ctype==4?S.tabs[f]=[A(r,c)]:S.ctype==2||S.ctype==6?S.tabs[f]=[A(r,c),A(r,c+2),A(r,c+4)]:S.ctype==3&&(S.tabs[f]=r[c]);else if(f=="IEND")break;c+=T,m.readUint(r,c),c+=4}var b;return P!=0&&((b=S.frames[S.frames.length-1]).data=k(S,O.slice(0,P),b.rect.width,b.rect.height)),S.data=k(S,B,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(s){const r=s.width,c=s.height;if(s.tabs.acTL==null)return[I(s.data,r,c,s).buffer];const m=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const A=r*c*4,D=new Uint8Array(A),S=new Uint8Array(A),B=new Uint8Array(A);for(let _=0;_<s.frames.length;_++){const P=s.frames[_],y=P.rect.x,R=P.rect.y,h=P.rect.width,u=P.rect.height,p=I(P.data,h,u,s);if(_!=0)for(var O=0;O<A;O++)B[O]=D[O];if(P.blend==0?v(p,h,u,D,r,c,y,R,0):P.blend==1&&v(p,h,u,D,r,c,y,R,1),m.push(D.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)v(S,h,u,D,r,c,y,R,0);else if(P.dispose==2)for(O=0;O<A;O++)D[O]=B[O]}}return m},_paeth:d,_copyTile:v,_bin:g}}();(function(){const{_copyTile:g}=Be,{_bin:I}=Be,k=Be._paeth;var l={table:function(){const h=new Uint32Array(256);for(let u=0;u<256;u++){let p=u;for(let j=0;j<8;j++)1&p?p=3988292384^p>>>1:p>>>=1;h[u]=p}return h}(),update(h,u,p,j){for(let w=0;w<j;w++)h=l.table[255&(h^u[p+w])]^h>>>8;return h},crc:(h,u,p)=>4294967295^l.update(4294967295,h,u,p)};function e(h,u,p,j){u[p]+=h[0]*j>>4,u[p+1]+=h[1]*j>>4,u[p+2]+=h[2]*j>>4,u[p+3]+=h[3]*j>>4}function t(h){return Math.max(0,Math.min(255,h))}function a(h,u){const p=h[0]-u[0],j=h[1]-u[1],w=h[2]-u[2],C=h[3]-u[3];return p*p+j*j+w*w+C*C}function d(h,u,p,j,w,C,b){b==null&&(b=1);const T=j.length,f=[];for(var o=0;o<T;o++){const E=j[o];f.push([E>>>0&255,E>>>8&255,E>>>16&255,E>>>24&255])}for(o=0;o<T;o++){let E=4294967295;for(var N=0,F=0;F<T;F++){var M=a(f[o],f[F]);F!=o&&M<E&&(E=M,N=F)}}const $=new Uint32Array(w.buffer),H=new Int16Array(u*p*4),Q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<Q.length;o++)Q[o]=255*((Q[o]+.5)/16-.5);for(let E=0;E<p;E++)for(let Y=0;Y<u;Y++){var z;o=4*(E*u+Y),b!=2?z=[t(h[o]+H[o]),t(h[o+1]+H[o+1]),t(h[o+2]+H[o+2]),t(h[o+3]+H[o+3])]:(M=Q[4*(3&E)+(3&Y)],z=[t(h[o]+M),t(h[o+1]+M),t(h[o+2]+M),t(h[o+3]+M)]),N=0;let re=16777215;for(F=0;F<T;F++){const ie=a(z,f[F]);ie<re&&(re=ie,N=F)}const te=f[N],X=[z[0]-te[0],z[1]-te[1],z[2]-te[2],z[3]-te[3]];b==1&&(Y!=u-1&&e(X,H,o+4,7),E!=p-1&&(Y!=0&&e(X,H,o+4*u-4,3),e(X,H,o+4*u,5),Y!=u-1&&e(X,H,o+4*u+4,1))),C[o>>2]=N,$[o>>2]=j[N]}}function x(h,u,p,j,w){w==null&&(w={});const{crc:C}=l,b=I.writeUint,T=I.writeUshort,f=I.writeASCII;let o=8;const N=h.frames.length>1;let F,M=!1,$=33+(N?20:0);if(w.sRGB!=null&&($+=13),w.pHYs!=null&&($+=21),w.iCCP!=null&&(F=pako.deflate(w.iCCP),$+=21+F.length+4),h.ctype==3){for(var H=h.plte.length,Q=0;Q<H;Q++)h.plte[Q]>>>24!=255&&(M=!0);$+=8+3*H+4+(M?8+1*H+4:0)}for(var z=0;z<h.frames.length;z++)N&&($+=38),$+=(te=h.frames[z]).cimg.length+12,z!=0&&($+=4);$+=12;const E=new Uint8Array($),Y=[137,80,78,71,13,10,26,10];for(Q=0;Q<8;Q++)E[Q]=Y[Q];if(b(E,o,13),o+=4,f(E,o,"IHDR"),o+=4,b(E,o,u),o+=4,b(E,o,p),o+=4,E[o]=h.depth,o++,E[o]=h.ctype,o++,E[o]=0,o++,E[o]=0,o++,E[o]=0,o++,b(E,o,C(E,o-17,17)),o+=4,w.sRGB!=null&&(b(E,o,1),o+=4,f(E,o,"sRGB"),o+=4,E[o]=w.sRGB,o++,b(E,o,C(E,o-5,5)),o+=4),w.iCCP!=null){const X=13+F.length;b(E,o,X),o+=4,f(E,o,"iCCP"),o+=4,f(E,o,"ICC profile"),o+=11,o+=2,E.set(F,o),o+=F.length,b(E,o,C(E,o-(X+4),X+4)),o+=4}if(w.pHYs!=null&&(b(E,o,9),o+=4,f(E,o,"pHYs"),o+=4,b(E,o,w.pHYs[0]),o+=4,b(E,o,w.pHYs[1]),o+=4,E[o]=w.pHYs[2],o++,b(E,o,C(E,o-13,13)),o+=4),N&&(b(E,o,8),o+=4,f(E,o,"acTL"),o+=4,b(E,o,h.frames.length),o+=4,b(E,o,w.loop!=null?w.loop:0),o+=4,b(E,o,C(E,o-12,12)),o+=4),h.ctype==3){for(b(E,o,3*(H=h.plte.length)),o+=4,f(E,o,"PLTE"),o+=4,Q=0;Q<H;Q++){const X=3*Q,ie=h.plte[Q],ee=255&ie,ce=ie>>>8&255,Re=ie>>>16&255;E[o+X+0]=ee,E[o+X+1]=ce,E[o+X+2]=Re}if(o+=3*H,b(E,o,C(E,o-3*H-4,3*H+4)),o+=4,M){for(b(E,o,H),o+=4,f(E,o,"tRNS"),o+=4,Q=0;Q<H;Q++)E[o+Q]=h.plte[Q]>>>24&255;o+=H,b(E,o,C(E,o-H-4,H+4)),o+=4}}let re=0;for(z=0;z<h.frames.length;z++){var te=h.frames[z];N&&(b(E,o,26),o+=4,f(E,o,"fcTL"),o+=4,b(E,o,re++),o+=4,b(E,o,te.rect.width),o+=4,b(E,o,te.rect.height),o+=4,b(E,o,te.rect.x),o+=4,b(E,o,te.rect.y),o+=4,T(E,o,j[z]),o+=2,T(E,o,1e3),o+=2,E[o]=te.dispose,o++,E[o]=te.blend,o++,b(E,o,C(E,o-30,30)),o+=4);const X=te.cimg;b(E,o,(H=X.length)+(z==0?0:4)),o+=4;const ie=o;f(E,o,z==0?"IDAT":"fdAT"),o+=4,z!=0&&(b(E,o,re++),o+=4),E.set(X,o),o+=H,b(E,o,C(E,ie,o-ie)),o+=4}return b(E,o,0),o+=4,f(E,o,"IEND"),o+=4,b(E,o,C(E,o-4,4)),o+=4,E.buffer}function v(h,u,p){for(let j=0;j<h.frames.length;j++){const w=h.frames[j];w.rect.width;const C=w.rect.height,b=new Uint8Array(C*w.bpl+C);w.cimg=c(w.img,C,w.bpp,w.bpl,b,u,p)}}function n(h,u,p,j,w){const C=w[0],b=w[1],T=w[2],f=w[3],o=w[4],N=w[5];let F=6,M=8,$=255;for(var H=0;H<h.length;H++){const pe=new Uint8Array(h[H]);for(var Q=pe.length,z=0;z<Q;z+=4)$&=pe[z+3]}const E=$!=255,Y=function(fe,ae,ge,be,he,Ie){const oe=[];for(var de=0;de<fe.length;de++){const we=new Uint8Array(fe[de]),ne=new Uint32Array(we.buffer);var ve;let De=0,se=0,Fe=ae,ye=ge,jt=be?1:0;if(de!=0){const Yt=Ie||be||de==1||oe[de-2].dispose!=0?1:2;let wt=0,Nt=1e9;for(let nt=0;nt<Yt;nt++){var qe=new Uint8Array(fe[de-1-nt]);const Kt=new Uint32Array(fe[de-1-nt]);let Le=ae,Me=ge,Ne=-1,rt=-1;for(let $e=0;$e<ge;$e++)for(let He=0;He<ae;He++)ne[xe=$e*ae+He]!=Kt[xe]&&(He<Le&&(Le=He),He>Ne&&(Ne=He),$e<Me&&(Me=$e),$e>rt&&(rt=$e));Ne==-1&&(Le=Me=Ne=rt=0),he&&((1&Le)==1&&Le--,(1&Me)==1&&Me--);const Bt=(Ne-Le+1)*(rt-Me+1);Bt<Nt&&(Nt=Bt,wt=nt,De=Le,se=Me,Fe=Ne-Le+1,ye=rt-Me+1)}qe=new Uint8Array(fe[de-1-wt]),wt==1&&(oe[de-1].dispose=2),ve=new Uint8Array(Fe*ye*4),g(qe,ae,ge,ve,Fe,ye,-De,-se,0),jt=g(we,ae,ge,ve,Fe,ye,-De,-se,3)?1:0,jt==1?r(we,ae,ge,ve,{x:De,y:se,width:Fe,height:ye}):g(we,ae,ge,ve,Fe,ye,-De,-se,0)}else ve=we.slice(0);oe.push({rect:{x:De,y:se,width:Fe,height:ye},img:ve,blend:jt,dispose:0})}if(be)for(de=0;de<oe.length;de++){if((le=oe[de]).blend==1)continue;const we=le.rect,ne=oe[de-1].rect,De=Math.min(we.x,ne.x),se=Math.min(we.y,ne.y),Fe={x:De,y:se,width:Math.max(we.x+we.width,ne.x+ne.width)-De,height:Math.max(we.y+we.height,ne.y+ne.height)-se};oe[de-1].dispose=1,de-1!=0&&s(fe,ae,ge,oe,de-1,Fe,he),s(fe,ae,ge,oe,de,Fe,he)}let Ze=0;if(fe.length!=1)for(var xe=0;xe<oe.length;xe++){var le;Ze+=(le=oe[xe]).rect.width*le.rect.height}return oe}(h,u,p,C,b,T),re={},te=[],X=[];if(j!=0){const pe=[];for(z=0;z<Y.length;z++)pe.push(Y[z].img.buffer);const fe=function(he){let Ie=0;for(var oe=0;oe<he.length;oe++)Ie+=he[oe].byteLength;const de=new Uint8Array(Ie);let ve=0;for(oe=0;oe<he.length;oe++){const qe=new Uint8Array(he[oe]),Ze=qe.length;for(let xe=0;xe<Ze;xe+=4){let le=qe[xe],we=qe[xe+1],ne=qe[xe+2];const De=qe[xe+3];De==0&&(le=we=ne=0),de[ve+xe]=le,de[ve+xe+1]=we,de[ve+xe+2]=ne,de[ve+xe+3]=De}ve+=Ze}return de.buffer}(pe),ae=A(fe,j);for(z=0;z<ae.plte.length;z++)te.push(ae.plte[z].est.rgba);let ge=0;for(z=0;z<Y.length;z++){const be=(ee=Y[z]).img.length;var ie=new Uint8Array(ae.inds.buffer,ge>>2,be>>2);X.push(ie);const he=new Uint8Array(ae.abuf,ge,be);N&&d(ee.img,ee.rect.width,ee.rect.height,te,he,ie),ee.img.set(he),ge+=be}}else for(H=0;H<Y.length;H++){var ee=Y[H];const pe=new Uint32Array(ee.img.buffer);var ce=ee.rect.width;for(Q=pe.length,ie=new Uint8Array(Q),X.push(ie),z=0;z<Q;z++){const fe=pe[z];if(z!=0&&fe==pe[z-1])ie[z]=ie[z-1];else if(z>ce&&fe==pe[z-ce])ie[z]=ie[z-ce];else{let ae=re[fe];if(ae==null&&(re[fe]=ae=te.length,te.push(fe),te.length>=300))break;ie[z]=ae}}}const Re=te.length;for(Re<=256&&o==0&&(M=Re<=2?1:Re<=4?2:Re<=16?4:8,M=Math.max(M,f)),H=0;H<Y.length;H++){(ee=Y[H]).rect.x,ee.rect.y,ce=ee.rect.width;const pe=ee.rect.height;let fe=ee.img;new Uint32Array(fe.buffer);let ae=4*ce,ge=4;if(Re<=256&&o==0){ae=Math.ceil(M*ce/8);var Te=new Uint8Array(ae*pe);const be=X[H];for(let he=0;he<pe;he++){z=he*ae;const Ie=he*ce;if(M==8)for(var ue=0;ue<ce;ue++)Te[z+ue]=be[Ie+ue];else if(M==4)for(ue=0;ue<ce;ue++)Te[z+(ue>>1)]|=be[Ie+ue]<<4-4*(1&ue);else if(M==2)for(ue=0;ue<ce;ue++)Te[z+(ue>>2)]|=be[Ie+ue]<<6-2*(3&ue);else if(M==1)for(ue=0;ue<ce;ue++)Te[z+(ue>>3)]|=be[Ie+ue]<<7-1*(7&ue)}fe=Te,F=3,ge=1}else if(E==0&&Y.length==1){Te=new Uint8Array(ce*pe*3);const be=ce*pe;for(z=0;z<be;z++){const he=3*z,Ie=4*z;Te[he]=fe[Ie],Te[he+1]=fe[Ie+1],Te[he+2]=fe[Ie+2]}fe=Te,F=2,ge=3,ae=3*ce}ee.img=fe,ee.bpl=ae,ee.bpp=ge}return{ctype:F,depth:M,plte:te,frames:Y}}function s(h,u,p,j,w,C,b){const T=Uint8Array,f=Uint32Array,o=new T(h[w-1]),N=new f(h[w-1]),F=w+1<h.length?new T(h[w+1]):null,M=new T(h[w]),$=new f(M.buffer);let H=u,Q=p,z=-1,E=-1;for(let re=0;re<C.height;re++)for(let te=0;te<C.width;te++){const X=C.x+te,ie=C.y+re,ee=ie*u+X,ce=$[ee];ce==0||j[w-1].dispose==0&&N[ee]==ce&&(F==null||F[4*ee+3]!=0)||(X<H&&(H=X),X>z&&(z=X),ie<Q&&(Q=ie),ie>E&&(E=ie))}z==-1&&(H=Q=z=E=0),b&&((1&H)==1&&H--,(1&Q)==1&&Q--),C={x:H,y:Q,width:z-H+1,height:E-Q+1};const Y=j[w];Y.rect=C,Y.blend=1,Y.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(g(o,u,p,Y.img,C.width,C.height,-C.x,-C.y,0),r(M,u,p,Y.img,C)):g(M,u,p,Y.img,C.width,C.height,-C.x,-C.y,0)}function r(h,u,p,j,w){g(h,u,p,j,w.width,w.height,-w.x,-w.y,2)}function c(h,u,p,j,w,C,b){const T=[];let f,o=[0,1,2,3,4];C!=-1?o=[C]:(u*j>5e5||p==1)&&(o=[0]),b&&(f={level:0});const N=Xr;for(var F=0;F<o.length;F++){for(let H=0;H<u;H++)m(w,h,H,j,p,o[F]);T.push(N.deflate(w,f))}let M,$=1e9;for(F=0;F<T.length;F++)T[F].length<$&&(M=F,$=T[F].length);return T[M]}function m(h,u,p,j,w,C){const b=p*j;let T=b+p;if(h[T]=C,T++,C==0)if(j<500)for(var f=0;f<j;f++)h[T+f]=u[b+f];else h.set(new Uint8Array(u.buffer,b,j),T);else if(C==1){for(f=0;f<w;f++)h[T+f]=u[b+f];for(f=w;f<j;f++)h[T+f]=u[b+f]-u[b+f-w]+256&255}else if(p==0){for(f=0;f<w;f++)h[T+f]=u[b+f];if(C==2)for(f=w;f<j;f++)h[T+f]=u[b+f];if(C==3)for(f=w;f<j;f++)h[T+f]=u[b+f]-(u[b+f-w]>>1)+256&255;if(C==4)for(f=w;f<j;f++)h[T+f]=u[b+f]-k(u[b+f-w],0,0)+256&255}else{if(C==2)for(f=0;f<j;f++)h[T+f]=u[b+f]+256-u[b+f-j]&255;if(C==3){for(f=0;f<w;f++)h[T+f]=u[b+f]+256-(u[b+f-j]>>1)&255;for(f=w;f<j;f++)h[T+f]=u[b+f]+256-(u[b+f-j]+u[b+f-w]>>1)&255}if(C==4){for(f=0;f<w;f++)h[T+f]=u[b+f]+256-k(0,u[b+f-j],0)&255;for(f=w;f<j;f++)h[T+f]=u[b+f]+256-k(u[b+f-w],u[b+f-j],u[b+f-w-j])&255}}}function A(h,u){const p=new Uint8Array(h),j=p.slice(0),w=new Uint32Array(j.buffer),C=D(j,u),b=C[0],T=C[1],f=p.length,o=new Uint8Array(f>>2);let N;if(p.length<2e7)for(var F=0;F<f;F+=4)N=S(b,M=p[F]*(1/255),$=p[F+1]*(1/255),H=p[F+2]*(1/255),Q=p[F+3]*(1/255)),o[F>>2]=N.ind,w[F>>2]=N.est.rgba;else for(F=0;F<f;F+=4){var M=p[F]*.00392156862745098,$=p[F+1]*(1/255),H=p[F+2]*(1/255),Q=p[F+3]*(1/255);for(N=b;N.left;)N=B(N.est,M,$,H,Q)<=0?N.left:N.right;o[F>>2]=N.ind,w[F>>2]=N.est.rgba}return{abuf:j.buffer,inds:o,plte:T}}function D(h,u,p){p==null&&(p=1e-4);const j=new Uint32Array(h.buffer),w={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=P(h,w.i0,w.i1),w.est=y(w.bst);const C=[w];for(;C.length<u;){let T=0,f=0;for(var b=0;b<C.length;b++)C[b].est.L>T&&(T=C[b].est.L,f=b);if(T<p)break;const o=C[f],N=O(h,j,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=N||o.i1<=N){o.est.L=0;continue}const F={i0:o.i0,i1:N,bst:null,est:null,tdst:0,left:null,right:null};F.bst=P(h,F.i0,F.i1),F.est=y(F.bst);const M={i0:N,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(M.bst={R:[],m:[],N:o.bst.N-F.bst.N},b=0;b<16;b++)M.bst.R[b]=o.bst.R[b]-F.bst.R[b];for(b=0;b<4;b++)M.bst.m[b]=o.bst.m[b]-F.bst.m[b];M.est=y(M.bst),o.left=F,o.right=M,C[f]=F,C.push(M)}for(C.sort((T,f)=>f.bst.N-T.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[w,C]}function S(h,u,p,j,w){if(h.left==null)return h.tdst=function(F,M,$,H,Q){const z=M-F[0],E=$-F[1],Y=H-F[2],re=Q-F[3];return z*z+E*E+Y*Y+re*re}(h.est.q,u,p,j,w),h;const C=B(h.est,u,p,j,w);let b=h.left,T=h.right;C>0&&(b=h.right,T=h.left);const f=S(b,u,p,j,w);if(f.tdst<=C*C)return f;const o=S(T,u,p,j,w);return o.tdst<f.tdst?o:f}function B(h,u,p,j,w){const{e:C}=h;return C[0]*u+C[1]*p+C[2]*j+C[3]*w-h.eMq}function O(h,u,p,j,w,C){for(j-=4;p<j;){for(;_(h,p,w)<=C;)p+=4;for(;_(h,j,w)>C;)j-=4;if(p>=j)break;const b=u[p>>2];u[p>>2]=u[j>>2],u[j>>2]=b,p+=4,j-=4}for(;_(h,p,w)>C;)p-=4;return p+4}function _(h,u,p){return h[u]*p[0]+h[u+1]*p[1]+h[u+2]*p[2]+h[u+3]*p[3]}function P(h,u,p){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=p-u>>2;for(let b=u;b<p;b+=4){const T=h[b]*.00392156862745098,f=h[b+1]*(1/255),o=h[b+2]*(1/255),N=h[b+3]*(1/255);w[0]+=T,w[1]+=f,w[2]+=o,w[3]+=N,j[0]+=T*T,j[1]+=T*f,j[2]+=T*o,j[3]+=T*N,j[5]+=f*f,j[6]+=f*o,j[7]+=f*N,j[10]+=o*o,j[11]+=o*N,j[15]+=N*N}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function y(h){const{R:u}=h,{m:p}=h,{N:j}=h,w=p[0],C=p[1],b=p[2],T=p[3],f=j==0?0:1/j,o=[u[0]-w*w*f,u[1]-w*C*f,u[2]-w*b*f,u[3]-w*T*f,u[4]-C*w*f,u[5]-C*C*f,u[6]-C*b*f,u[7]-C*T*f,u[8]-b*w*f,u[9]-b*C*f,u[10]-b*b*f,u[11]-b*T*f,u[12]-T*w*f,u[13]-T*C*f,u[14]-T*b*f,u[15]-T*T*f],N=o,F=R;let M=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,H=0;if(j!=0)for(let z=0;z<16&&(M=F.multVec(N,M),H=Math.sqrt(F.dot(M,M)),M=F.sml(1/H,M),!(z!=0&&Math.abs(H-$)<1e-9));z++)$=H;const Q=[w*f,C*f,b*f,T*f];return{Cov:o,q:Q,e:M,L:$,eMq255:F.dot(F.sml(255,Q),M),eMq:F.dot(M,Q),rgba:(Math.round(255*Q[3])<<24|Math.round(255*Q[2])<<16|Math.round(255*Q[1])<<8|Math.round(255*Q[0])<<0)>>>0}}var R={multVec:(h,u)=>[h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],h[4]*u[0]+h[5]*u[1]+h[6]*u[2]+h[7]*u[3],h[8]*u[0]+h[9]*u[1]+h[10]*u[2]+h[11]*u[3],h[12]*u[0]+h[13]*u[1]+h[14]*u[2]+h[15]*u[3]],dot:(h,u)=>h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],sml:(h,u)=>[h*u[0],h*u[1],h*u[2],h*u[3]]};Be.encode=function(u,p,j,w,C,b,T){w==null&&(w=0),T==null&&(T=!1);const f=n(u,p,j,w,[!1,!1,!1,0,T,!1]);return v(f,-1),x(f,p,j,C,b)},Be.encodeLL=function(u,p,j,w,C,b,T,f){const o={ctype:0+(w==1?0:2)+(C==0?0:4),depth:b,frames:[]},N=(w+C)*b,F=N*p;for(let M=0;M<u.length;M++)o.frames.push({rect:{x:0,y:0,width:p,height:j},img:new Uint8Array(u[M]),blend:0,dispose:1,bpp:Math.ceil(N/8),bpl:Math.ceil(F/8)});return v(o,0,!0),x(o,p,j,T,f)},Be.encode.compress=n,Be.encode.dither=d,Be.quantize=A,Be.quantize.getKDtree=D,Be.quantize.getNearest=S})();const or={toArrayBuffer(g,I){const k=g.width,l=g.height,e=k<<2,t=g.getContext("2d").getImageData(0,0,k,l),a=new Uint32Array(t.data.buffer),d=(32*k+31)/32<<2,x=d*l,v=122+x,n=new ArrayBuffer(v),s=new DataView(n),r=1<<20;let c,m,A,D,S=r,B=0,O=0,_=0;function P(h){s.setUint16(O,h,!0),O+=2}function y(h){s.setUint32(O,h,!0),O+=4}function R(h){O+=h}P(19778),y(v),R(4),y(122),y(108),y(k),y(-l>>>0),P(1),P(32),y(3),y(x),y(2835),y(2835),R(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),function h(){for(;B<l&&S>0;){for(D=122+B*d,c=0;c<e;)S--,m=a[_++],A=m>>>24,s.setUint32(D+c,m<<8|A),c+=4;B++}_<a.length?(S=r,setTimeout(h,or._dly)):I(n)}()},toBlob(g,I){this.toArrayBuffer(g,k=>{I(new Blob([k],{type:"image/bmp"}))})},_dly:9};var Ee={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Jr={[Ee.CHROME]:16384,[Ee.FIREFOX]:11180,[Ee.DESKTOP_SAFARI]:16384,[Ee.IE]:8192,[Ee.IOS]:4096,[Ee.ETC]:8192};const An=typeof window<"u",lr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Vt=An&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),es=(An||lr)&&(Vt&&Vt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),dr=(An||lr)&&(Vt&&Vt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Tn(g,I,k=Date.now()){return new Promise(l=>{const e=g.split(","),t=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let d=a.length;const x=new Uint8Array(d);for(;d--;)x[d]=a.charCodeAt(d);const v=new Blob([x],{type:t});v.name=I,v.lastModified=k,l(v)})}function cr(g){return new Promise((I,k)=>{const l=new dr;l.onload=()=>I(l.result),l.onerror=e=>k(e),l.readAsDataURL(g)})}function ur(g){return new Promise((I,k)=>{const l=new Image;l.onload=()=>I(l),l.onerror=e=>k(e),l.src=g})}function it(){if(it.cachedResult!==void 0)return it.cachedResult;let g=Ee.ETC;const{userAgent:I}=navigator;return/Chrom(e|ium)/i.test(I)?g=Ee.CHROME:/iP(ad|od|hone)/i.test(I)&&/WebKit/i.test(I)?g=Ee.IOS:/Safari/i.test(I)?g=Ee.DESKTOP_SAFARI:/Firefox/i.test(I)?g=Ee.FIREFOX:(/MSIE/i.test(I)||document.documentMode)&&(g=Ee.IE),it.cachedResult=g,it.cachedResult}function fr(g,I){const k=it(),l=Jr[k];let e=g,t=I,a=e*t;const d=e>t?t/e:e/t;for(;a>l*l;){const x=(l+e)/2,v=(l+t)/2;x<v?(t=v,e=v*d):(t=x*d,e=x),a=e*t}return{width:e,height:t}}function Zt(g,I){let k,l;try{if(k=new OffscreenCanvas(g,I),l=k.getContext("2d"),l===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{k=document.createElement("canvas"),l=k.getContext("2d")}return k.width=g,k.height=I,[k,l]}function hr(g,I){const{width:k,height:l}=fr(g.width,g.height),[e,t]=Zt(k,l);return I&&/jpe?g/.test(I)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(g,0,0,e.width,e.height),e}function Lt(){return Lt.cachedResult!==void 0||(Lt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Lt.cachedResult}function Qt(g,I={}){return new Promise(function(k,l){let e,t;var a=function(){try{return t=hr(e,I.fileType||g.type),k([e,t])}catch(x){return l(x)}},d=function(x){try{var v=function(n){try{throw n}catch(s){return l(s)}};try{let n;return cr(g).then(function(s){try{return n=s,ur(n).then(function(r){try{return e=r,function(){try{return a()}catch(c){return l(c)}}()}catch(c){return v(c)}},v)}catch(r){return v(r)}},v)}catch(n){v(n)}}catch(n){return l(n)}};try{if(Lt()||[Ee.DESKTOP_SAFARI,Ee.MOBILE_SAFARI].includes(it()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(g).then(function(x){try{return e=x,a()}catch{return d()}},d)}catch{d()}})}function Gt(g,I,k,l,e=1){return new Promise(function(t,a){let d;if(I==="image/png"){let v,n,s;return v=g.getContext("2d"),{data:n}=v.getImageData(0,0,g.width,g.height),s=Be.encode([n.buffer],g.width,g.height,4096*e),d=new Blob([s],{type:I}),d.name=k,d.lastModified=l,x.call(this)}{let v=function(){return x.call(this)};if(I==="image/bmp")return new Promise(n=>or.toBlob(g,n)).then((function(n){try{return d=n,d.name=k,d.lastModified=l,v.call(this)}catch(s){return a(s)}}).bind(this),a);{let n=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&g instanceof OffscreenCanvas)return g.convertToBlob({type:I,quality:e}).then((function(s){try{return d=s,d.name=k,d.lastModified=l,n.call(this)}catch(r){return a(r)}}).bind(this),a);{let s;return s=g.toDataURL(I,e),Tn(s,k,l).then((function(r){try{return d=r,n.call(this)}catch(c){return a(c)}}).bind(this),a)}}}function x(){return t(d)}})}function ze(g){g.width=0,g.height=0}function gt(){return new Promise(function(g,I){let k,l,e,t;return gt.cachedResult!==void 0?g(gt.cachedResult):Tn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return k=a,Qt(k).then(function(d){try{return l=d[1],Gt(l,k.type,k.name,k.lastModified).then(function(x){try{return e=x,ze(l),Qt(e).then(function(v){try{return t=v[0],gt.cachedResult=t.width===1&&t.height===2,g(gt.cachedResult)}catch(n){return I(n)}},I)}catch(v){return I(v)}},I)}catch(x){return I(x)}},I)}catch(d){return I(d)}},I)})}function gr(g){return new Promise((I,k)=>{const l=new dr;l.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return I(-2);const a=t.byteLength;let d=2;for(;d<a;){if(t.getUint16(d+2,!1)<=8)return I(-1);const x=t.getUint16(d,!1);if(d+=2,x==65505){if(t.getUint32(d+=2,!1)!=1165519206)return I(-1);const v=t.getUint16(d+=6,!1)==18761;d+=t.getUint32(d+4,v);const n=t.getUint16(d,v);d+=2;for(let s=0;s<n;s++)if(t.getUint16(d+12*s,v)==274)return I(t.getUint16(d+12*s+8,v))}else{if((65280&x)!=65280)break;d+=t.getUint16(d,!1)}}return I(-1)},l.onerror=e=>k(e),l.readAsArrayBuffer(g)})}function mr(g,I){const{width:k}=g,{height:l}=g,{maxWidthOrHeight:e}=I;let t,a=g;return isFinite(e)&&(k>e||l>e)&&([a,t]=Zt(k,l),k>l?(a.width=e,a.height=l/k*e):(a.width=k/l*e,a.height=e),t.drawImage(g,0,0,a.width,a.height),ze(g)),a}function pr(g,I){const{width:k}=g,{height:l}=g,[e,t]=Zt(k,l);switch(I>4&&I<9?(e.width=l,e.height=k):(e.width=k,e.height=l),I){case 2:t.transform(-1,0,0,1,k,0);break;case 3:t.transform(-1,0,0,-1,k,l);break;case 4:t.transform(1,0,0,-1,0,l);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,l,0);break;case 7:t.transform(0,-1,-1,0,l,k);break;case 8:t.transform(0,-1,1,0,0,k)}return t.drawImage(g,0,0,k,l),ze(g),e}function En(g,I,k=0){return new Promise(function(l,e){let t,a,d,x,v,n,s,r,c,m,A,D,S,B,O,_,P,y,R,h;function u(j=5){if(I.signal&&I.signal.aborted)throw I.signal.reason;t+=j,I.onProgress(Math.min(t,100))}function p(j){if(I.signal&&I.signal.aborted)throw I.signal.reason;t=Math.min(Math.max(j,t),100),I.onProgress(t)}return t=k,a=I.maxIteration||10,d=1024*I.maxSizeMB*1024,u(),Qt(g,I).then((function(j){try{return[,x]=j,u(),v=mr(x,I),u(),new Promise(function(w,C){var b;if(!(b=I.exifOrientation))return gr(g).then((function(f){try{return b=f,T.call(this)}catch(o){return C(o)}}).bind(this),C);function T(){return w(b)}return T.call(this)}).then((function(w){try{return n=w,u(),gt().then((function(C){try{return s=C?v:pr(v,n),u(),r=I.initialQuality||1,c=I.fileType||g.type,Gt(s,c,g.name,g.lastModified,r).then((function(b){try{{let f=function(){if(a--&&(O>d||O>S)){let N,F;return N=h?.95*R.width:R.width,F=h?.95*R.height:R.height,[P,y]=Zt(N,F),y.drawImage(R,0,0,N,F),r*=c==="image/png"?.85:.95,Gt(P,c,g.name,g.lastModified,r).then(function(M){try{return _=M,ze(R),R=P,O=_.size,p(Math.min(99,Math.floor((B-O)/(B-d)*100))),f}catch($){return e($)}},e)}return[1]},o=function(){return ze(R),ze(P),ze(v),ze(s),ze(x),p(100),l(_)};if(m=b,u(),A=m.size>d,D=m.size>g.size,!A&&!D)return p(100),l(m);var T;return S=g.size,B=m.size,O=B,R=s,h=!I.alwaysKeepResolution&&A,(T=(function(N){for(;N;){if(N.then)return void N.then(T,e);try{if(N.pop){if(N.length)return N.pop()?o.call(this):N;N=f}else N=N.call(this)}catch(F){return e(F)}}}).bind(this))(f)}}catch(f){return e(f)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const ts=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let an;function ns(g,I){return new Promise((k,l)=>{an||(an=function(a){const d=[];return d.push(a),URL.createObjectURL(new Blob(d))}(ts));const e=new Worker(an);e.addEventListener("message",function(a){if(I.signal&&I.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return l(new Error(a.data.error)),void e.terminate();k(a.data.file),e.terminate()}else I.onProgress(a.data.progress)}),e.addEventListener("error",l),I.signal&&I.signal.addEventListener("abort",()=>{l(I.signal.reason),e.terminate()}),e.postMessage({file:g,imageCompressionLibUrl:I.libURL,options:{...I,onProgress:void 0,signal:void 0}})})}function Ae(g,I){return new Promise(function(k,l){let e,t,a,d,x,v;if(e={...I},a=0,{onProgress:d}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{a=c,typeof d=="function"&&d(a)},!(g instanceof Blob||g instanceof es))return l(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(g.type))return l(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||v)return En(g,e).then((function(c){try{return t=c,r.call(this)}catch(m){return l(m)}}).bind(this),l);var n=(function(){try{return r.call(this)}catch(c){return l(c)}}).bind(this),s=function(c){try{return En(g,e).then(function(m){try{return t=m,n()}catch(A){return l(A)}},l)}catch(m){return l(m)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",ns(g,e).then(function(c){try{return t=c,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=g.name,t.lastModified=g.lastModified}catch{}try{e.preserveExif&&g.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===g.type)&&(t=ar(g,t))}catch{}return k(t)}})}Ae.getDataUrlFromFile=cr,Ae.getFilefromDataUrl=Tn,Ae.loadImage=ur,Ae.drawImageInCanvas=hr,Ae.drawFileInCanvas=Qt,Ae.canvasToFile=Gt,Ae.getExifOrientation=gr,Ae.handleMaxWidthOrHeight=mr,Ae.followExifOrientation=pr,Ae.cleanupCanvasMemory=ze,Ae.isAutoOrientationInBrowser=gt,Ae.approximateBelowMaximumCanvasSizeOfBrowser=fr,Ae.copyExifWithoutOrientation=ar,Ae.getBrowserName=it,Ae.version="2.0.2";var on,Rn;function br(){if(Rn)return on;Rn=1;function g(I){var k=typeof I;return I!=null&&(k=="object"||k=="function")}return on=g,on}var ln,On;function rs(){if(On)return ln;On=1;var g=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return ln=g,ln}var dn,Mn;function vr(){if(Mn)return dn;Mn=1;var g=rs(),I=typeof self=="object"&&self&&self.Object===Object&&self,k=g||I||Function("return this")();return dn=k,dn}var cn,Nn;function ss(){if(Nn)return cn;Nn=1;var g=vr(),I=function(){return g.Date.now()};return cn=I,cn}var un,Bn;function is(){if(Bn)return un;Bn=1;var g=/\s/;function I(k){for(var l=k.length;l--&&g.test(k.charAt(l)););return l}return un=I,un}var fn,Pn;function as(){if(Pn)return fn;Pn=1;var g=is(),I=/^\s+/;function k(l){return l&&l.slice(0,g(l)+1).replace(I,"")}return fn=k,fn}var hn,qn;function xr(){if(qn)return hn;qn=1;var g=vr(),I=g.Symbol;return hn=I,hn}var gn,Ln;function os(){if(Ln)return gn;Ln=1;var g=xr(),I=Object.prototype,k=I.hasOwnProperty,l=I.toString,e=g?g.toStringTag:void 0;function t(a){var d=k.call(a,e),x=a[e];try{a[e]=void 0;var v=!0}catch{}var n=l.call(a);return v&&(d?a[e]=x:delete a[e]),n}return gn=t,gn}var mn,Hn;function ls(){if(Hn)return mn;Hn=1;var g=Object.prototype,I=g.toString;function k(l){return I.call(l)}return mn=k,mn}var pn,zn;function ds(){if(zn)return pn;zn=1;var g=xr(),I=os(),k=ls(),l="[object Null]",e="[object Undefined]",t=g?g.toStringTag:void 0;function a(d){return d==null?d===void 0?e:l:t&&t in Object(d)?I(d):k(d)}return pn=a,pn}var bn,Wn;function cs(){if(Wn)return bn;Wn=1;function g(I){return I!=null&&typeof I=="object"}return bn=g,bn}var vn,$n;function us(){if($n)return vn;$n=1;var g=ds(),I=cs(),k="[object Symbol]";function l(e){return typeof e=="symbol"||I(e)&&g(e)==k}return vn=l,vn}var xn,Vn;function fs(){if(Vn)return xn;Vn=1;var g=as(),I=br(),k=us(),l=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,a=/^0o[0-7]+$/i,d=parseInt;function x(v){if(typeof v=="number")return v;if(k(v))return l;if(I(v)){var n=typeof v.valueOf=="function"?v.valueOf():v;v=I(n)?n+"":n}if(typeof v!="string")return v===0?v:+v;v=g(v);var s=t.test(v);return s||a.test(v)?d(v.slice(2),s?2:8):e.test(v)?l:+v}return xn=x,xn}var yn,Qn;function hs(){if(Qn)return yn;Qn=1;var g=br(),I=ss(),k=fs(),l="Expected a function",e=Math.max,t=Math.min;function a(d,x,v){var n,s,r,c,m,A,D=0,S=!1,B=!1,O=!0;if(typeof d!="function")throw new TypeError(l);x=k(x)||0,g(v)&&(S=!!v.leading,B="maxWait"in v,r=B?e(k(v.maxWait)||0,x):r,O="trailing"in v?!!v.trailing:O);function _(C){var b=n,T=s;return n=s=void 0,D=C,c=d.apply(T,b),c}function P(C){return D=C,m=setTimeout(h,x),S?_(C):c}function y(C){var b=C-A,T=C-D,f=x-b;return B?t(f,r-T):f}function R(C){var b=C-A,T=C-D;return A===void 0||b>=x||b<0||B&&T>=r}function h(){var C=I();if(R(C))return u(C);m=setTimeout(h,y(C))}function u(C){return m=void 0,O&&n?_(C):(n=s=void 0,c)}function p(){m!==void 0&&clearTimeout(m),D=0,n=A=s=m=void 0}function j(){return m===void 0?c:u(I())}function w(){var C=I(),b=R(C);if(n=arguments,s=this,A=C,b){if(m===void 0)return P(A);if(B)return clearTimeout(m),m=setTimeout(h,x),_(A)}return m===void 0&&(m=setTimeout(h,x)),c}return w.cancel=p,w.flush=j,w}return yn=a,yn}var gs=hs();const ms=Ge(gs);var St={},Gn;function ps(){if(Gn)return St;Gn=1;var g=Je();Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;var I=g(tt()),k=et();return St.default=(0,I.default)([(0,k.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,k.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),St}var bs=ps();const vs=Ge(bs);var At={},Zn;function xs(){if(Zn)return At;Zn=1;var g=Je();Object.defineProperty(At,"__esModule",{value:!0}),At.default=void 0;var I=g(tt()),k=et();return At.default=(0,I.default)((0,k.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),At}var ys=xs();const js=Ge(ys);var Tt={},Yn;function ws(){if(Yn)return Tt;Yn=1;var g=Je();Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=void 0;var I=g(tt()),k=et();return Tt.default=(0,I.default)((0,k.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Tt}var Cs=ws();const Ss=Ge(Cs);var It={},Kn;function As(){if(Kn)return It;Kn=1;var g=Je();Object.defineProperty(It,"__esModule",{value:!0}),It.default=void 0;var I=g(tt()),k=et();return It.default=(0,I.default)([(0,k.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,k.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),It}var Ts=As();const Is=Ge(Ts),at=L.forwardRef(({path:g,initialImages:I=[],onImagesUpdated:k,onDelete:l,isOwnDesign:e},t)=>{const[a,d]=L.useState(I.map(o=>({...o,deleted:!1}))),[x,v]=L.useState(!1),[n,s]=L.useState(0),[r,c]=L.useState(!1),[m,A]=L.useState(null),[D,S]=L.useState(1),[B,O]=L.useState(!1),[_,P]=L.useState(!1),[y,R]=L.useState(""),[h,u]=L.useState("info"),p=L.useRef(null);L.useEffect(()=>{console.log("Initial images received:",I),d(I.map(o=>({...o,deleted:!!o.deleted})))},[I]);const j=async o=>{const N=Array.from(o.target.files||[]);v(!0);const F={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},M=N.map(async($,H)=>{let Q=$;$.size>1024*1024&&(Q=await Ae($,F),R("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),P(!0));const E=`${new Date().getTime()}-${Q.name}`,Y=mt(),re=pt(Y,`${g}/${E}`),te=nr(re,Q);return new Promise((X,ie)=>{te.on("state_changed",ee=>{const ce=ee.bytesTransferred/ee.totalBytes*100;s(ce)},ee=>{console.error("Upload failed:",ee),ie(ee)},()=>{rr(te.snapshot.ref).then(ee=>{X({url:ee,path:re.fullPath,title:""})})})})});Promise.all(M).then($=>{const H=[...a,...$];d(H),k&&k(H),R("Images uploaded successfully."),u("success"),P(!0),v(!1),s(0),p.current&&(p.current.value="")}).catch($=>{console.error("Error uploading images: ",$),R("Failed to upload images."),u("error"),P(!0),v(!1),s(0)})},w=o=>{d(N=>{const F=N.map((M,$)=>$===o?{...M,deleted:!0}:M);return k(F),F}),R("Image marked for deletion. Update to permanently delete."),u("info"),P(!0)},C=async()=>{const o=a.filter(N=>N.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const N=o.map(F=>{const M=mt(),$=pt(M,F.path);return qt($)});try{await Promise.all(N),l(o),d(F=>F.filter(M=>!M.deleted)),R("Deleted images have been permanently removed."),u("success")}catch(F){console.error("Error committing deletions:",F),R("Failed to commit deletions."),u("error")}P(!0)}else console.log("No images marked for deletion.")},b=o=>{O(!B),A(o)};L.useEffect(()=>{const o=()=>{const N=!!document.fullscreenElement;O(N)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const T=(o,N)=>{N!=="clickaway"&&P(!1)},f=L.useCallback(ms((o,N)=>{setTimeout(()=>{d(F=>{const M=F.map(($,H)=>H===o?{...$,title:N}:$);return k&&k(M),M})},0)},30),[k]);return L.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Ht,{title:"Upload Images",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(Is,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:x,ref:p,accept:"image/*"})]})}),x&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),a.filter(o=>!o.deleted).map((o,N)=>i.jsxs("div",{children:[i.jsx("img",{src:o.url,alt:`Uploaded design ${N}`,onClick:()=>{c(!0),A(N)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Oe,{onClick:()=>w(N),children:i.jsx(Et,{})}),i.jsx("textarea",{value:o.title,onChange:F=>f(N,F.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},N)),i.jsx(ot,{open:r,onClose:()=>c(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:m!==null&&i.jsxs(lt,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:a[m].url,alt:`Zoomed Design ${m}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${D})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Oe,{onClick:()=>S(D*1.2),children:i.jsx(vs,{})}),i.jsx(Oe,{onClick:()=>S(D/1.2),style:{marginLeft:"10px"},children:i.jsx(js,{})}),i.jsx(Oe,{onClick:()=>b(m),style:{marginLeft:"10px"},children:i.jsx(Ss,{})}),B&&i.jsx(Oe,{onClick:()=>b(m),style:{position:"absolute",top:20,right:20},children:i.jsx(Vr,{})})]})]})}),i.jsx(dt,{open:_,autoHideDuration:6e3,onClose:T,children:i.jsx(ct,{onClose:T,severity:h,sx:{width:"100%"},children:y})})]})});at.displayName="ImageUpload";const We=({onChange:g,initialValue:I})=>{const[k,l]=L.useState(sn.sanitize(I||"")),e=L.useRef(!1),t=L.useRef(null),[a,d]=L.useState("");L.useEffect(()=>{e.current?l(sn.sanitize(I||"")):e.current=!0},[I]);const x=(A,D,S,B)=>{const O=sn.sanitize(A);l(O),g(O)},v=A=>{if(!t.current){console.warn("Editor not initialized");return}const D=t.current.getEditor(),S=D.getSelection();if(S)D.insertText(S.index,A),D.setSelection(S.index+A.length);else{const B=D.getText().length;D.insertText(B,A),D.setSelection(B+A.length)}d(""),D.focus()},n=A=>{v(A.target.value)},s=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],r=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"],c={toolbar:[[{header:[1,2,3,!1]}],["bold","italic"],[{list:"ordered"},{list:"bullet"}],["blockquote",{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},m=["header","bold","italic","list","blockquote","indent","link"];return i.jsxs("div",{children:[i.jsxs(st,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginBottom:2},children:[i.jsx(Pr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(_n,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(zt,{labelId:"math-operators-label",id:"math-operators",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(ht,{value:"",disabled:!0,children:"Math"}),r.map(A=>i.jsx(ht,{value:A,children:A},A))]})}),i.jsx(_n,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(zt,{labelId:"greek-letters-label",id:"greek-letters",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(ht,{value:"",disabled:!0,children:"Greek"}),s.map(A=>i.jsx(ht,{value:A,children:A},A))]})})]}),i.jsx(Qr,{ref:t,value:k,onChange:x,modules:c,formats:m,theme:"snow",placeholder:"Start writing...",style:{backgroundColor:"white",borderRadius:"4px",minHeight:"200px"}})]})};var Ft={},Xn;function Fs(){if(Xn)return Ft;Xn=1;var g=Je();Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.default=void 0;var I=g(tt()),k=et();return Ft.default=(0,I.default)((0,k.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Ft}var Us=Fs();const wn=Ge(Us);var Ut={},Jn;function ks(){if(Jn)return Ut;Jn=1;var g=Je();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var I=g(tt()),k=et();return Ut.default=(0,I.default)((0,k.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Ut}var Ds=ks();const _s=Ge(Ds);var kt={},er;function Es(){if(er)return kt;er=1;var g=Je();Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var I=g(tt()),k=et();return kt.default=(0,I.default)((0,k.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),kt}var Rs=Es();const Os=Ge(Rs),vt=({path:g,initialFiles:I,onFilesChange:k,isOwnDesign:l})=>{const[e,t]=L.useState(I.map(p=>({...p,deleted:!!p.deleted}))),[a,d]=L.useState(!1),[x,v]=L.useState(0),[n,s]=L.useState({}),[r,c]=L.useState(!1),[m,A]=L.useState(""),[D,S]=L.useState("info"),B=L.useRef(null);L.useEffect(()=>{console.log("Initial files received:",I),t(I.map(p=>({...p,deleted:!!p.deleted})))},[I]),L.useEffect(()=>()=>{s({})},[]);const O=p=>{console.log("Updating files with",p),k(p),t(p)},_=async p=>{if(!p.target.files)return;const w=Array.from(p.target.files).filter(b=>b.size>5242880?(A("File size should not exceed 5 MB"),S("error"),c(!0),!1):!0);d(!0);const C=w.map(b=>{const T=new Date().getTime(),f=`${T}-${b.name}`,o=mt(),N=pt(o,`${g}/${f}`),F=nr(N,b);return new Promise((M,$)=>{F.on("state_changed",H=>{const Q=H.bytesTransferred/H.totalBytes*100;v(Q)},H=>{console.error("Upload failed:",H),$(H)},()=>{rr(F.snapshot.ref).then(H=>{M({id:T.toString(),url:H,name:b.name,path:N.fullPath})})})})});Promise.all(C).then(b=>{const T=[...e.filter(f=>!f.deleted),...b];O(T),A("Files uploaded successfully."),S("success"),c(!0),d(!1),v(0),B.current&&(B.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),A("Failed to upload files."),S("error"),c(!0),d(!1),v(0)})},P=p=>{const j=e.map(w=>w.id===p?{...w,deleted:!0}:w);O(j),A("File marked for deletion. Update to permanently delete."),S("info"),c(!0)},y=p=>{s(j=>{var w;return{...j,[p]:((w=e.find(C=>C.id===p))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},R=p=>{t(j=>{const w=j.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return k(w),w}),s(j=>{const w={...j};return delete w[p],w}),A("File name updated successfully."),S("info"),c(!0)},h=(p,j)=>{s(w=>({...w,[p]:j}))},u=(p,j)=>{j!=="clickaway"&&c(!1)};return i.jsxs("div",{children:[l&&i.jsx(Ht,{title:"Upload Files",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(Os,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:_,disabled:a,ref:B})]})}),a&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(x),"%"]})}),i.jsx(qr,{children:e.map(p=>i.jsxs(Lr,{style:{opacity:p.deleted?.5:1},children:[i.jsx(Hr,{children:i.jsx(_s,{})}),typeof n[p.id]=="string"?i.jsx(Wt,{variant:"outlined",size:"small",value:n[p.id],onChange:j=>h(p.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&R(p.id),fullWidth:!0}):i.jsx(zr,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),l&&(typeof n[p.id]=="string"?i.jsx(Oe,{onClick:()=>R(p.id),edge:"end","aria-label":"save",children:i.jsx(wn,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{onClick:()=>y(p.id),edge:"end","aria-label":"edit",children:i.jsx(sr,{})}),i.jsx(Oe,{onClick:()=>P(p.id),edge:"end","aria-label":"delete",children:i.jsx(Et,{})})]}))]},p.id))}),i.jsx(dt,{open:r,autoHideDuration:6e3,onClose:u,children:i.jsx(ct,{onClose:u,severity:D,sx:{width:"100%"},children:m})})]})},Ms=({designs:g,setDesigns:I,setIsAdding:k,getDesigns:l,onReturnToDashboard:e})=>{const{userDetails:t}=Mt();console.log("Add Design loaded");const[a,d]=L.useState(""),[x,v]=L.useState(""),[n,s]=L.useState(""),[r,c]=L.useState([]),[m,A]=L.useState([]),D=L.useMemo(()=>r,[r]),[S,B]=L.useState(!1),[O,_]=L.useState(""),[P,y]=L.useState("info"),[R,h]=L.useState(!1),[u,p]=L.useState("");console.log("Adding New Design from user:",t);const j=L.useRef(null),w=()=>{h(!1)},C=(T,f)=>{f!=="clickaway"&&B(!1)};L.useEffect(()=>{if(t!=null&&t.classes){const T=Object.keys(t.classes)[0];v(T||"")}},[t==null?void 0:t.classes]);const b=async T=>{var F;if(T.preventDefault(),console.log("Files to be saved:",m),!t||!t.uid){console.error("User object is undefined or missing UID."),p("You must be signed in to add a design."),h(!0);return}if(!a){p("All fields are required."),h(!0);return}await((F=j.current)==null?void 0:F.commitDeletions());const f=r.filter(M=>!M.deleted),o=m.filter(M=>!M.deleted).map(M=>({id:M.id,url:M.url,name:M.name,path:M.path})),N={title:n,description:a,course:x,dateCreated:Rt(),dateModified:Rt(),images:f,files:o,userId:t.uid};try{const M=await Sn(Ce(J,"designs"),N),$={...N,id:M.id};I([...g,$]),_(`${n} has been Added.`),y("success"),B(!0),s(""),d(""),c([]),A([]),setTimeout(()=>{k(!1),l()},1e3)}catch(M){console.log(M),p("There was an issue adding your design."),h(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:e,className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:b,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsx("div",{style:{display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:T=>s(T.target.value),style:{width:"100%"}})]})}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(zt,{id:"course",value:x,onChange:T=>v(T.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([T,f])=>i.jsx(ht,{value:T,children:`${f.number} - ${f.title}`},T))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(We,{onChange:d,initialValue:a}),i.jsx(at,{ref:j,path:"designs/images",initialImages:D,onImagesUpdated:c,onDelete:T=>c(r.filter(f=>!T.includes(f))),isOwnDesign:!0}),i.jsx(vt,{path:"designs/files",initialFiles:m,onFilesChange:A,isOwnDesign:!0}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(Se,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(Se,{onClick:()=>k(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(ot,{open:R,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(xt,{id:"alert-dialog-title",children:"Notification"}),i.jsx(lt,{children:i.jsx(Ot,{id:"alert-dialog-description",children:u})}),i.jsx(yt,{children:i.jsx(Se,{onClick:w,autoFocus:!0,children:"Ok"})})]}),i.jsx(dt,{open:S,autoHideDuration:1e3,onClose:C,children:i.jsx(ct,{onClose:C,severity:P,sx:{width:"100%"},children:O})})]})},Ns=({designId:g,setIsAddingBuild:I,refreshBuilds:k})=>{const[l,e]=L.useState(""),[t,a]=L.useState(""),[d,x]=L.useState([]),[v,n]=L.useState([]),{userDetails:s}=Mt(),r=j=>{x(j)},c=j=>{n(j)};console.log("AddBuild loaded");const[m,A]=L.useState(!1),[D,S]=L.useState(""),[B,O]=L.useState(!1),[_,P]=L.useState(""),[y,R]=L.useState("info");console.log("Adding New Build by user:",s);const h=()=>{A(!1)},u=(j,w)=>{w!=="clickaway"&&O(!1)},p=async j=>{if(j.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),A(!0);return}if(!t){S("Build description is required."),A(!0);return}const w=d.filter(b=>!b.deleted),C=v.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await Sn(Ce(J,"builds"),{title:l,description:t,design_ID:g,dateCreated:Rt(),userId:s.uid,images:w,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",s),P("Your build has been successfully added."),R("success"),O(!0),setTimeout(()=>{e(""),a(""),x([]),n([]),I(!1),k()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let T=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(T="You do not have permission to perform this operation."),P(T),R("error"),O(!0)}else P("Failed to add the build. Please try again later."),R("error"),O(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:l,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(We,{onChange:a,initialValue:t})," ",i.jsx(at,{path:`builds/${g}/images`,initialImages:d,onImagesUpdated:r,onDelete:j=>x(w=>w.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(vt,{path:`builds/${g}/files`,initialFiles:v,onFilesChange:c,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>I(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(ot,{open:m,onClose:h,children:[i.jsx(xt,{children:"Notification"}),i.jsx(lt,{children:i.jsx(Ot,{children:D})}),i.jsx(yt,{children:i.jsx(Se,{onClick:h,children:"OK"})})]}),i.jsx(dt,{open:B,autoHideDuration:6e3,onClose:u,children:i.jsx(ct,{onClose:u,severity:y,sx:{width:"100%"},children:_})})]})},Bs=({designId:g,buildId:I,refreshTests:k,setAddingTestIdForBuild:l})=>{const[e,t]=L.useState(""),[a,d]=L.useState(""),[x,v]=L.useState(""),[n,s]=L.useState(""),[r,c]=L.useState([]),[m,A]=L.useState([]),{userDetails:D}=Mt();console.log("AddTest loaded");const[S,B]=L.useState(!1),[O,_]=L.useState(""),[P,y]=L.useState(!1),[R,h]=L.useState(""),[u,p]=L.useState("info"),j=C=>{A(C)},w=async()=>{if(!a){_("Test description cannot be empty!"),B(!0);return}const C=r.filter(T=>!T.deleted),b=m.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{await Sn(Ce(J,"tests"),{title:e,build_ID:I,design_ID:g,dateCreated:Rt(),description:a,results:x,conclusions:n,userId:D==null?void 0:D.uid,images:C,files:b}),setTimeout(()=>{k(I),t(""),d(""),v(""),s(""),c([]),A([]),l(!1)},1e3),h("Test added successfully"),p("success"),y(!0)}catch(T){console.error("Error adding test: ",T),h("Failed to add the test"),p("error"),y(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(We,{onChange:d,initialValue:a}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(We,{onChange:v,initialValue:x}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(We,{onChange:s,initialValue:n}),i.jsx(at,{path:`tests/${I}/images`,initialImages:r,onImagesUpdated:C=>{c(C)},onDelete:C=>c(b=>b.filter(T=>!C.includes(T))),isOwnDesign:!0}),i.jsx(vt,{path:`tests/${I}/files`,initialFiles:m,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>l(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(ot,{open:S,onClose:()=>B(!1),children:[i.jsx(xt,{children:"Notification"}),i.jsx(lt,{children:i.jsx(Ot,{children:O})}),i.jsx(yt,{children:i.jsx(Se,{onClick:()=>B(!1),children:"OK"})})]}),i.jsx(dt,{open:P,autoHideDuration:6e3,onClose:()=>y(!1),children:i.jsx(ct,{onClose:()=>y(!1),severity:u,sx:{width:"100%"},children:R})})]})};var Dt={},tr;function Ps(){if(tr)return Dt;tr=1;var g=Je();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var I=g(tt()),k=et();return Dt.default=(0,I.default)((0,k.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),Dt}var qs=Ps();const jn=Ge(qs),_t=g=>g&&g instanceof Cn?g.toDate().toLocaleString():"",Ls=({selectedDesign:g,setIsEditing:I,onReturnToDashboard:k})=>{const{userDetails:l,loading:e}=Mt(),t=g.id,a=g.userId===(l==null?void 0:l.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",l);const[d,x]=L.useState(""),[v,n]=L.useState(g.description),[s,r]=L.useState(g.course||""),[c,m]=L.useState(_t(g.dateCreated)),[A,D]=L.useState(_t(g.dateModified)),[S,B]=L.useState([]),[O,_]=L.useState([]),P=L.useRef(null),[y,R]=L.useState(!1),[h,u]=L.useState([]),[p,j]=L.useState({}),[w,C]=L.useState({}),[b,T]=L.useState({}),f=L.useRef(null),[o,N]=L.useState({}),[F,M]=L.useState({}),[$,H]=L.useState({}),[Q,z]=L.useState(!1),[E,Y]=L.useState({}),[re,te]=L.useState({}),[X,ie]=L.useState({}),[ee,ce]=L.useState({}),[Re,Te]=L.useState({}),ue=L.useRef(null),[pe,fe]=L.useState({}),[ae,ge]=L.useState({}),[be,he]=L.useState({}),[Ie,oe]=L.useState(!1),[de,ve]=L.useState(""),[qe,Ze]=L.useState(()=>()=>{}),[xe,le]=L.useState(!1),[we,ne]=L.useState(""),[De,se]=L.useState("info"),[Fe,ye]=L.useState({design:!1,builds:!1,tests:!1}),jt=async U=>{if(U.preventDefault(),!v){ve("All fields are required."),oe(!0);return}console.log("About to check image deletions",P.current),console.log(P.current),console.log(S.some(V=>V.deleted)),P.current&&S.some(V=>V.deleted)&&(console.log("Committing deletions"),await P.current.commitDeletions());const W=S.filter(V=>!V.deleted);O.some(V=>V.deleted)&&await Nt();const q=O.filter(V=>!V.deleted),Z={title:d,description:v,course:s,dateModified:Rt(),images:W.map(V=>({url:V.url,title:V.title,path:V.path})),files:q.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path})),userId:l.uid};try{await Ke(je(J,"designs",t),Z,{merge:!0}),ne("Your design has been updated."),se("success"),le(!0);const V=Cn.now();D(_t(V))}catch(V){console.error("Error updating design:",V),ne("There was an issue updating your design."),se("error"),le(!0)}ye(V=>({...V,design:!1}))};L.useEffect(()=>{g&&(n(g.description||""),x(g.title||""),r(g.course||""),(async()=>{const W=je(J,"designs",t),q=await Gr(W);if(q.exists()){const Z=q.data();console.log("Fetched images:",Z.images),console.log("Fetched files:",Z.files),B(Z.images||[]),_(Z.files||[]),m(_t(Z.dateCreated)),D(_t(Z.dateModified))}})())},[g,t]);const Yt=U=>{const W=S.filter(Z=>!U.some(V=>V.path===Z.path));console.log("Remaining images after deletion:",W),B(W);const q=W.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));Ke(je(J,"designs",t),{images:q},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Z=>console.error("Failed to update Firestore:",Z))},wt=U=>{JSON.stringify(S)!==JSON.stringify(U)&&(B(U),console.log("Updated images received:",U))},Nt=async()=>{const U=O.filter(W=>W.deleted);if(console.log("Files to delete:",U),U.length>0){const W=mt(),q=U.map(Z=>{const V=pt(W,Z.path);return qt(V)});try{await Promise.all(q),console.log("Files deleted successfully");const Z=O.filter(V=>!V.deleted);_(Z),await rn(je(J,"designs",g.id),{files:Z.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path}))}),ne("Deleted files have been permanently removed."),se("success"),le(!0)}catch(Z){console.error("Failed to delete files: ",Z),ne("Failed to delete files."),se("error"),le(!0)}}},nt=async U=>{var V,K;try{await yr(U)}catch(G){console.error("Error deleting files:",G),ne("Failed to delete build files."),se("error"),le(!0)}const W=((V=w[U])==null?void 0:V.filter(G=>!G.deleted).map(({url:G,path:Ue,title:Ve})=>({url:G,path:Ue,title:Ve})))||[],q=((K=b[U])==null?void 0:K.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[],Z={};W.length>0&&(Z.images=W),q.length>0&&(Z.files=q),p[U]!==void 0&&(Z.description=p[U]);try{const G=je(J,"builds",U);await Ke(G,Z,{merge:!0}),ne("Your build has been updated."),se("success"),le(!0),Ne(),ye(Ue=>({...Ue,builds:!1}))}catch(G){console.error("Error updating build:",G),ne("Failed to update build."),se("error"),le(!0)}},Kt=(U,W)=>{M(q=>({...q,[U]:W}))},Le=(U,W)=>{j(q=>({...q,[U]:W})),ye(q=>({...q,builds:!0}))},Me=async U=>{const W=F[U];try{const q=je(J,"builds",U);await Ke(q,{title:W},{merge:!0}),M(Z=>{const V={...Z};return delete V[U],V}),Ne()}catch(q){console.error("Failed to save build title:",q)}},Ne=async()=>{if(!l){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",l==null?void 0:l.uid),console.log("Selected design ID for query:",g==null?void 0:g.id);let U;l.isAdmin?U=_e(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):U=_e(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",l.uid),Pe("dateCreated")),console.log("Builds query details:",JSON.stringify(U,null,2));const W=await Xe(U);console.log("Builds snapshot details:",JSON.stringify(W.docs.map(Z=>Z.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",W.docs.length);const q=W.docs.map(Z=>(console.log("Build doc path: ",Z.ref.path),{id:Z.id,...Z.data()}));u(q),console.log("New builds state after refresh:",q)}catch(U){console.error("Error refreshing builds:",U),U.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",U):console.error("An unexpected error occurred when trying to refresh builds:",U)}},rt=(U,W)=>{const q=je(J,"builds",U),Z=w[U].filter(K=>!W.some(G=>G.path===K.path));C(K=>({...K,[U]:Z}));const V=Z.map(K=>({url:K.url,title:K.title,path:K.path}));Ke(q,{images:V},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ne("Build Image deletions updated."),se("success")}).catch(K=>{console.error("Failed to update build images in Firestore:",K),ne("Failed to update build image deletions."),se("error")}),le(!0)},Bt=async U=>{const W=_e(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",l.uid)),q=await Xe(W);for(const Z of q.docs)await bt(je(J,"tests",Z.id));await bt(je(J,"builds",U)),await Ne(),ne("Build and its tests (if any) deleted successfully."),se("success"),le(!0)},$e=U=>{ve("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ze(()=>()=>Bt(U)),oe(!0)},He=(U,W)=>{C(q=>({...q,[U]:W}))},In=(U,W)=>{T(q=>({...q,[U]:W}))},yr=async U=>{var q;const W=((q=b[U])==null?void 0:q.filter(Z=>Z.deleted))||[];if(console.log("Build files to delete:",W),W.length>0){const Z=mt(),V=W.map(K=>{const G=pt(Z,K.path);return qt(G)});try{await Promise.all(V),console.log("Build files deleted successfully");const K=b[U].filter(G=>!G.deleted);T(G=>({...G,[U]:K})),await rn(je(J,"builds",U),{files:K.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),console.log("Firestore successfully updated to remove deleted files"),ne("Deleted build files have been permanently removed."),se("success"),le(!0)}catch(K){console.error("Failed to delete build files: ",K),ne("Failed to delete build files."),se("error"),le(!0)}}},jr=async(U,W)=>{var K;try{await Ir(U)}catch(G){console.error("Error deleting files:",G),ne("Failed to delete build files."),se("error"),le(!0)}const q={},Z=ee[U].filter(G=>!G.deleted).map(({url:G,path:Ue,title:Ve})=>({url:G,path:Ue,title:Ve})),V=((K=Re[U])==null?void 0:K.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[];E[U]!==void 0&&(q.description=E[U]),re[U]!==void 0&&(q.results=re[U]),X[U]!==void 0&&(q.conclusions=X[U]),q.images=Z,q.files=V;try{const G=je(J,"tests",U);await Ke(G,q,{merge:!0}),ne("Your test has been updated."),se("success"),le(!0),Pt(W)}catch(G){console.error(`Error updating test ID: ${U}:`,G),ne("There was an issue updating your test."),se("error"),le(!0)}},wr=(U,W)=>{ge(q=>({...q,[U]:W}))},Fn=async(U,W)=>{const q=ae[U],Z=je(J,"tests",U);await Ke(Z,{title:q},{merge:!0}),ge(V=>{const K={...V};return delete K[U],K}),Pt(W)},Cr=(U,W)=>{console.log(`Updating description for test ID ${U}:`,W),Y(q=>({...q,[U]:W})),ye(q=>({...q,tests:!0}))},Sr=(U,W)=>{console.log(`Updating results for test ID ${U}:`,W),te(q=>({...q,[U]:W})),ye(q=>({...q,tests:!0}))},Ar=(U,W)=>{ie(q=>({...q,[U]:W})),ye(q=>({...q,tests:!0}))};L.useEffect(()=>{!e&&l&&(async()=>{if(!l)return;let W;l.isAdmin?W=_e(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):W=_e(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",l.uid),Pe("dateCreated"));const q=await Xe(W),Z=[],V={},K={};for(const G of q.docs){const Ue=G.data(),Ve=G.id;Z.push({id:Ve,...Ue,images:Ue.images||[],files:Ue.files||[]}),K[Ve]=!0;let Xt;l.isAdmin?Xt=_e(Ce(J,"tests"),me("build_ID","==",Ve),Pe("dateCreated")):Xt=_e(Ce(J,"tests"),me("build_ID","==",Ve),me("userId","==",l.uid),Pe("dateCreated"));const _r=await Xe(Xt),Dn=[],Jt={},en={};for(const Ye of _r.docs){const Qe=Ye.data();Dn.push({id:Ye.id,...Qe}),Jt[Ye.id]=Qe.images||[],en[Ye.id]=Qe.files||[]}V[Ve]=Dn,ce(Ye=>{const Qe={...Ye};for(const Ct in Jt)Qe[Ct]=Jt[Ct];return Qe}),Te(Ye=>{const Qe={...Ye};for(const Ct in en)Qe[Ct]=en[Ct];return Qe})}u(Z),H(V),he(K)})()},[e,l,g.id,t]);const Pt=async U=>{if(!l){console.log("User details not loaded yet");return}try{let W;l.isAdmin?W=_e(Ce(J,"tests"),me("build_ID","==",U),Pe("dateCreated")):W=_e(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",l.uid),Pe("dateCreated"));const Z=(await Xe(W)).docs.map(G=>{const Ue=G.data();return{id:G.id,...Ue,images:Ue.images||[],files:Ue.files||[]}});H(G=>({...G,[U]:Z}));const V={},K={};Z.forEach(G=>{V[G.id]=G.images,K[G.id]=G.files}),ce(V),Te(K)}catch(W){console.error("Error fetching tests:",W)}},Tr=(U,W)=>{const q=je(J,"tests",U),Z=ee[U].filter(K=>!W.includes(K));ce(K=>({...K,[U]:Z}));const V=Z.map(({url:K,path:G,title:Ue})=>({url:K,path:G,title:Ue}));Ke(q,{images:V},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ne("Test Image deletions updated."),se("success")}).catch(K=>{console.error("Failed to update test images in Firestore:",K),ne("Failed to update test image deletions."),se("error")}),le(!0)},Un=(U,W)=>{ce(q=>({...q,[U]:W}))},kn=(U,W)=>{Te(q=>({...q,[U]:W}))},Ir=async U=>{var q;const W=((q=Re[U])==null?void 0:q.filter(Z=>Z.deleted))||[];if(W.length>0){const Z=mt(),V=W.map(K=>{const G=pt(Z,K.path);return qt(G)});try{await Promise.all(V);const K=Re[U].filter(G=>!G.deleted);Te(G=>({...G,[U]:K})),await rn(je(J,"tests",U),{files:K.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),ne("Deleted test files have been permanently removed."),se("success"),le(!0)}catch(K){console.error("Failed to delete test files: ",K),ne("Failed to delete test files."),se("error"),le(!0)}}},Fr=async(U,W)=>{await bt(je(J,"tests",U)),await Pt(W),ne("Test deleted successfully."),se("success"),le(!0)},Ur=(U,W)=>{ve("Are you sure you want to delete this test? This action cannot be undone."),Ze(()=>()=>Fr(U,W)),oe(!0)},kr=U=>{he(W=>({...W,[U]:!W[U]}))},Dr=()=>{const U=Object.entries(Fe).filter(([q,Z])=>Z).map(([q])=>q).join(", ");if(!U.length){k();return}const W=`You have unsaved changes in the following sections: ${U}. Are you sure you want to leave?`;ve(W),Ze(()=>()=>{ye({design:!1,builds:!1,tests:!1}),k()}),oe(!0)};return L.useEffect(()=>{const U=W=>{Object.values(Fe).some(Z=>Z)&&(W.preventDefault(),W.returnValue="")};return window.addEventListener("beforeunload",U),()=>window.removeEventListener("beforeunload",U)},[Fe]),i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:()=>{Object.values(Fe).some(W=>W)?Dr():k()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:jt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:d,onChange:U=>{x(U.target.value),ye(W=>({...W,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:c||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:A||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(zt,{id:"course",value:s,onChange:U=>{r(U.target.value),ye(W=>({...W,design:!0}))},fullWidth:!0,children:(l!=null&&l.classes?Object.entries(l.classes):[]).map(([U,W])=>i.jsx(ht,{value:U,children:`${W.number} - ${W.title}`},U))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(We,{initialValue:v,onChange:U=>{n(U),ye(W=>({...W,design:!0}))}}),i.jsx(at,{ref:P,path:`designs/${g.id}/images`,initialImages:S,onImagesUpdated:wt,onDelete:Yt,isOwnDesign:a}),i.jsx(vt,{path:`designs/${g.id}/files`,initialFiles:O,onFilesChange:_,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>I(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{R(!0),setTimeout(()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),h.map((U,W)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:F[U.id]!==void 0?i.jsx(Wt,{variant:"outlined",size:"small",fullWidth:!0,value:F[U.id],onChange:q=>Kt(U.id,q.target.value),onBlur:()=>Me(U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Oe,{onClick:()=>Me(U.id),size:"small",children:i.jsx(wn,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>M(q=>({...q,[U.id]:U.title||`Build ${W+1}`})),style:{cursor:"pointer"},children:U.title||`Build ${W+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>N(q=>({...q,[U.id]:!q[U.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:o[U.id]?i.jsx(jn,{}):i.jsx(nn,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>$e(U.id),children:i.jsx(Et,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{z(U.id),setTimeout(()=>{ue.current&&ue.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),o[U.id]&&i.jsxs(i.Fragment,{children:[i.jsx(We,{initialValue:p[U.id]||U.description,onChange:q=>{Le(U.id,q)}}),i.jsx(at,{path:`builds/${U.id}/images`,initialImages:U.images,onImagesUpdated:q=>He(U.id,q),onDelete:q=>rt(U.id,q),isOwnDesign:a}),i.jsx(vt,{path:`builds/${U.id}/files`,initialFiles:U.files,onFilesChange:q=>In(U.id,q),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>nt(U.id),children:"Update"})}),i.jsx("div",{children:$[U.id]&&$[U.id].length>0&&i.jsx("button",{onClick:()=>kr(U.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[U.id]?i.jsxs(i.Fragment,{children:[i.jsx(nn,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(jn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[U.id]&&$[U.id]&&$[U.id].map((q,Z)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:ae[q.id]!==void 0?i.jsx(Wt,{variant:"outlined",size:"small",fullWidth:!0,value:ae[q.id],onChange:V=>wr(q.id,V.target.value),onBlur:()=>Fn(q.id,U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Oe,{onClick:()=>Fn(q.id,U.id),size:"small",children:i.jsx(wn,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>ge(V=>({...V,[q.id]:q.title||`Test ${Z+1}`})),style:{cursor:"pointer"},children:q.title||`Test ${Z+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>fe(V=>({...V,[q.id]:!V[q.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:pe[q.id]?i.jsx(jn,{}):i.jsx(nn,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ur(q.id,U.id),children:i.jsx(Et,{})})]})]}),pe[q.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(We,{initialValue:E[q.id]||q.description,onChange:V=>{Cr(q.id,V)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(We,{initialValue:re[q.id]||q.results,onChange:V=>{Sr(q.id,V)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(We,{initialValue:X[q.id]||q.conclusions,onChange:V=>{Ar(q.id,V)}})]}),i.jsxs("div",{children:[i.jsx(at,{path:`tests/${q.id}/images`,initialImages:ee[q.id]||[],onImagesUpdated:V=>Un(q.id,V),onDelete:V=>Tr(q.id,V),isOwnDesign:a}),i.jsx(vt,{path:`tests/${q.id}/files`,initialFiles:Re[q.id]||[],onFilesChange:V=>kn(q.id,V),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>jr(q.id,U.id),children:"Update"})})]})]},q.id))]}),Q===U.id&&i.jsxs("div",{className:"new-test-record",ref:ue,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Bs,{designId:g.id,buildId:U.id,refreshTests:()=>Pt(U.id),setAddingTestIdForBuild:z,onImagesUpdated:q=>Un(U.id,q),onFilesChange:q=>kn(U.id,q)})]})]},U.id)),i.jsx("div",{children:y&&i.jsxs("div",{className:"new-build-record",ref:f,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Ns,{designId:g.id,setIsAddingBuild:R,refreshBuilds:Ne,onImagesUpdated:U=>He("temp-build-id",U),onFilesChange:U=>In("temp-build-id",U)})]})})]}),i.jsxs(ot,{open:Ie,onClose:()=>oe(!1),children:[i.jsx(xt,{children:"Confirmation Required"}),i.jsx(lt,{children:i.jsx(Ot,{children:de})}),i.jsxs(yt,{children:[i.jsx(Se,{onClick:()=>oe(!1),children:"Cancel"}),i.jsx(Se,{onClick:()=>{qe(),oe(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(dt,{open:xe,autoHideDuration:6e3,onClose:()=>le(!1),children:i.jsx(ct,{onClose:()=>le(!1),severity:De,sx:{width:"100%"},children:we})})]})},ft=(g,I,k)=>g[I]??k,Hs=()=>{const{userDetails:g,loading:I}=Mt();console.log("Dashboard loaded");const[k,l]=L.useState([]),[e,t]=L.useState([]),[a,d]=L.useState([]),[x,v]=L.useState(null),[n,s]=L.useState(!1),[r,c]=L.useState(!1),[m,A]=L.useState(!1),[D,S]=L.useState(""),[B,O]=L.useState(""),[_,P]=L.useState(!1),[y,R]=L.useState(null),[h,u]=L.useState(!1),[p,j]=L.useState(""),[w,C]=L.useState("info"),b=()=>{c(!1),s(!1),v(null),T()},T=L.useCallback(async()=>{if(!g)return;let F;const M=[],$=[],H=[];if(g.isSuperAdmin)F=_e(Ce(J,"designs"),Pe("dateCreated","desc"));else if(g.isAdmin){const z=g.classes?Object.keys(g.classes):[];if(z.length>0)F=_e(Ce(J,"designs"),me("course","in",z),Pe("dateCreated","desc"));else{t([]),d([]);return}}else F=_e(Ce(J,"designs"),me("userId","==",g.uid),Pe("dateCreated","desc"));(await Xe(F)).forEach(z=>{const E=z.data(),Y={id:z.id,title:ft(E,"title",""),description:ft(E,"description",""),course:ft(E,"course",""),dateCreated:E.dateCreated,dateModified:E.dateModified,userId:ft(E,"userId",""),images:ft(E,"images",[]),files:ft(E,"files",[])};g.isSuperAdmin?E.userId===g.uid?M.push(Y):E.userId!==g.uid&&E.course&&E.isAdmin?$.push(Y):E.userId!==g.uid&&!E.isAdmin&&H.push(Y):g.isAdmin?E.userId===g.uid?$.push(Y):H.push(Y):E.userId===g.uid&&H.push(Y)}),l(M),t($),d(H)},[g]);L.useEffect(()=>{!I&&g&&T()},[g,I,T]);const f=F=>{const M=[...k,...e,...a].find($=>$.id===F);v(M||null),c(!0)},o=F=>{R(F),S("Are you sure you want to delete this design? This action cannot be undone."),A(!0)},N=async()=>{if(y)if(B!==(g==null?void 0:g.uid))j("User ID confirmation failed. Enter the correct User ID."),C("error"),u(!0);else try{const F=_e(Ce(J,"builds"),me("design_ID","==",y),me("userId","==",g.uid)),M=await Xe(F);for(const $ of M.docs){const H=$.id,Q=_e(Ce(J,"tests"),me("build_ID","==",H),me("userId","==",g.uid)),z=await Xe(Q);for(const E of z.docs)await bt(je(J,"tests",E.id));await bt(je(J,"builds",H))}await bt(je(J,"designs",y)),l($=>$.filter(H=>H.id!==y)),t($=>$.filter(H=>H.id!==y)),d($=>$.filter(H=>H.id!==y)),j("Your design and its associated builds and tests have been deleted."),C("success"),u(!0)}catch(F){console.error("Error deleting design, builds, and tests: ",F),j("There was an issue deleting your design and its associated builds and tests."),C("error"),u(!0)}finally{O(""),P(!1),R(null)}};return i.jsxs(st,{className:"profile-container",sx:{p:4},children:[" ",!n&&!r&&i.jsxs(i.Fragment,{children:[i.jsx(st,{sx:{mb:3},children:i.jsx(ir,{setIsAdding:s})}),(g==null?void 0:g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Super Admin Designs"}),i.jsx(ut,{designs:k,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),i.jsx("h2",{children:"Educator Designs"}),i.jsx(ut,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(ut,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),(g==null?void 0:g.isAdmin)&&!g.isSuperAdmin&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Educator Designs"}),i.jsx(ut,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(ut,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),!(g!=null&&g.isAdmin)&&!(g!=null&&g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Student Designs"}),i.jsx(ut,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:g,showUserIdColumn:!1})]})]}),n&&i.jsx(Ms,{designs:k.concat(e),setDesigns:t,setIsAdding:s,getDesigns:T,onReturnToDashboard:b}),r&&i.jsx(Ls,{designs:k.concat(e),selectedDesign:x,setDesigns:t,setIsEditing:c,getDesigns:T,onReturnToDashboard:b}),i.jsxs(ot,{open:m,onClose:()=>A(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(xt,{children:"Confirm Deletion"}),i.jsx(lt,{children:i.jsx(Ot,{children:D})}),i.jsxs(yt,{children:[i.jsx(Se,{onClick:()=>A(!1),children:"No, cancel"}),i.jsx(Se,{onClick:()=>{P(!0),A(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(ot,{open:_,onClose:()=>P(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(xt,{children:"Confirm Your User ID"}),i.jsx(lt,{children:i.jsx(Wt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:B,onChange:F=>O(F.target.value)})}),i.jsxs(yt,{children:[i.jsx(Se,{onClick:()=>P(!1),children:"No, cancel"}),i.jsx(Se,{onClick:N,color:"primary",children:"Confirm"})]})]}),i.jsx(dt,{open:h,autoHideDuration:6e3,onClose:()=>u(!1),children:i.jsx(ct,{onClose:()=>u(!1),severity:w,sx:{width:"100%"},children:p})})]})},Zs=Wr.memo(Hs);export{Zs as default};
