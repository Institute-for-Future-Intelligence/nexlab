import{r as H,u as gs,H as ms,j as i,s as ps,d as bs,f as xs,I as vs,i as ys,J as js,B as tt,q as je,T as ws,K as Cs,P as Ss,M as As,N as Ts,O as qt,Q as Te,R as Is,t as Dt,U as _e,V as Bn,W as jt,X as fn,Y as Ft,Z as Fs,c as Je,_ as st,$ as rt,v as it,A as at,a0 as ut,a1 as ft,a2 as Ut,a3 as Pn,a4 as Ln,a5 as Us,a6 as wn,a7 as Et,a8 as dt,a9 as ks,aa as Ds,ab as Es,ac as Rs,ad as Rt,ae as _s,af as un,ag as Ct,ah as pt,ai as St,aj as bt,ak as hn,al as ye,am as J,an as wt,ao as $t,ap as ve,aq as Ms,ar as Fe,as as Be,at as be,au as Xe,av as Ke,aw as Qt,ax as ht,ay as Os}from"./index-CbhxhAqr.js";import Vt from"./purify.es-CQJ0hv7W.js";const Ns=p=>{const{alignItems:I,classes:E}=p;return xs({root:["root",I==="flex-start"&&"alignItemsFlexStart"]},vs,E)},Bs=ps("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(p,I)=>{const{ownerState:E}=p;return[I.root,E.alignItems==="flex-start"&&I.alignItemsFlexStart]}})(ys(({theme:p})=>({minWidth:56,color:(p.vars||p).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),Ps=H.forwardRef(function(I,E){const c=gs({props:I,name:"MuiListItemIcon"}),{className:e,...t}=c,d=H.useContext(ms),a={...c,alignItems:d.alignItems},x=Ns(a);return i.jsx(Bs,{className:bs(x.root,e),ownerState:a,ref:E,...t})}),Ls=H.memo(({setIsAdding:p})=>{console.log("Header loaded");const I=js(),E=()=>{I("/")};return i.jsxs(tt,{className:"lab-notebook-container",children:[i.jsx(tt,{sx:{display:"flex",alignItems:"center"},children:i.jsx(je,{variant:"text",onClick:E,className:"back-home-button",children:"← Home Page"})}),i.jsx(tt,{sx:{display:"flex",alignItems:"center",mb:2},children:i.jsx(ws,{className:"webpage_title",children:"My Laboratory Notebook"})}),i.jsx(tt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx(je,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>p(!0),children:"+ Create New"})})]})}),lt=({designs:p,handleEdit:I,handleDelete:E,isAdmin:c,userDetails:e,showUserIdColumn:t})=>{const d=a=>a?a instanceof fn?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx(Cs,{component:Ss,children:i.jsxs(As,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[i.jsx(Ts,{children:i.jsxs(qt,{sx:{height:"60px"},children:[i.jsx(Te,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),i.jsx(Te,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),t&&i.jsx(Te,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),i.jsx(Te,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),i.jsx(Te,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),i.jsx(Te,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),i.jsx(Te,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),i.jsx(Is,{children:p&&p.length>0?p.map(a=>{const x=a.userId===(e==null?void 0:e.uid);return i.jsxs(qt,{sx:{height:"80px"},children:[i.jsx(Te,{children:i.jsx("button",{onClick:()=>I(a.id),className:"hyperlink-style",children:a.title})}),i.jsx(Te,{children:a.course&&(e!=null&&e.classes)&&e.classes[a.course]?`${e.classes[a.course].number} - ${e.classes[a.course].title}`:"N/A"}),t&&i.jsx(Te,{children:a.userId}),i.jsx(Te,{children:d(a.dateCreated)}),i.jsx(Te,{children:d(a.dateModified)}),i.jsx(Te,{children:i.jsx(Dt,{title:"Edit",children:i.jsx("span",{children:i.jsx(_e,{onClick:()=>x&&I(a.id),color:"primary",disabled:!x,children:i.jsx(Bn,{})})})})}),i.jsx(Te,{children:i.jsx(Dt,{title:"Delete",children:i.jsx("span",{children:i.jsx(_e,{onClick:()=>x&&E(a.id),color:"error",disabled:!x,children:i.jsx(jt,{})})})})})]},a.id)}):i.jsx(qt,{children:i.jsx(Te,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function Hs(p,I){return I.forEach(function(E){E&&typeof E!="string"&&!Array.isArray(E)&&Object.keys(E).forEach(function(c){if(c!=="default"&&!(c in p)){var e=Object.getOwnPropertyDescriptor(E,c);Object.defineProperty(p,c,e.get?e:{enumerable:!0,get:function(){return E[c]}})}})}),Object.freeze(p)}function Hn(p,I){return new Promise(function(E,c){let e;return zs(p).then(function(t){try{return e=t,E(new Blob([I.slice(0,2),e,I.slice(2)],{type:"image/jpeg"}))}catch(d){return c(d)}},c)})}const zs=p=>new Promise((I,E)=>{const c=new FileReader;c.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return E("not a valid JPEG");for(d+=2;;){const a=t.getUint16(d);if(a===65498)break;const x=t.getUint16(d+2);if(a===65505&&t.getUint32(d+4)===1165519206){const y=d+10;let n;switch(t.getUint16(y)){case 18761:n=!0;break;case 19789:n=!1;break;default:return E("TIFF header contains invalid endian")}if(t.getUint16(y+2,n)!==42)return E("TIFF header contains invalid version");const r=t.getUint32(y+4,n),s=y+r+2+12*t.getUint16(y+r,n);for(let l=y+r+2;l<s;l+=12)if(t.getUint16(l,n)==274){if(t.getUint16(l+2,n)!==3)return E("Orientation data type is invalid");if(t.getUint32(l+4,n)!==1)return E("Orientation data count is invalid");t.setUint16(l+8,1,n);break}return I(e.slice(d,d+2+x))}d+=2+x}return I(new Blob)}),c.readAsArrayBuffer(p)});var _t={},Ws={get exports(){return _t},set exports(p){_t=p}};(function(p){var I,E,c={};Ws.exports=c,c.parse=function(e,t){for(var d=c.bin.readUshort,a=c.bin.readUint,x=0,y={},n=new Uint8Array(e),r=n.length-4;a(n,r)!=101010256;)r--;x=r,x+=4;var s=d(n,x+=4);d(n,x+=2);var l=a(n,x+=2),g=a(n,x+=4);x+=4,x=g;for(var T=0;T<s;T++){a(n,x),x+=4,x+=4,x+=4,a(n,x+=4),l=a(n,x+=4);var k=a(n,x+=4),S=d(n,x+=4),B=d(n,x+2),N=d(n,x+4);x+=6;var D=a(n,x+=8);x+=4,x+=S+B+N,c._readLocal(n,D,y,l,k,t)}return y},c._readLocal=function(e,t,d,a,x,y){var n=c.bin.readUshort,r=c.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var l=n(e,t+=8),g=n(e,t+=2);t+=2;var T=c.bin.readUTF8(e,t,l);if(t+=l,t+=g,y)d[T]={size:x,csize:a};else{var k=new Uint8Array(e.buffer,t);if(s==0)d[T]=new Uint8Array(k.buffer.slice(t,t+a));else{if(s!=8)throw"unknown compression method: "+s;var S=new Uint8Array(x);c.inflateRaw(k,S),d[T]=S}}},c.inflateRaw=function(e,t){return c.F.inflate(e,t)},c.inflate=function(e,t){return e[0],e[1],c.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},c.deflate=function(e,t){t==null&&(t={level:6});var d=0,a=new Uint8Array(50+Math.floor(1.1*e.length));a[d]=120,a[d+1]=156,d+=2,d=c.F.deflateRaw(e,a,d,t.level);var x=c.adler(e,0,e.length);return a[d+0]=x>>>24&255,a[d+1]=x>>>16&255,a[d+2]=x>>>8&255,a[d+3]=x>>>0&255,new Uint8Array(a.buffer,0,d+4)},c.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),a=c.F.deflateRaw(e,d,a,t.level);return new Uint8Array(d.buffer,0,a)},c.encode=function(e,t){t==null&&(t=!1);var d=0,a=c.bin.writeUint,x=c.bin.writeUshort,y={};for(var n in e){var r=!c._noNeed(n)&&!t,s=e[n],l=c.crc.crc(s,0,s.length);y[n]={cpr:r,usize:s.length,crc:l,file:r?c.deflateRaw(s):s}}for(var n in y)d+=y[n].file.length+30+46+2*c.bin.sizeUTF8(n);d+=22;var g=new Uint8Array(d),T=0,k=[];for(var n in y){var S=y[n];k.push(T),T=c._writeHeader(g,T,n,S,0)}var B=0,N=T;for(var n in y)S=y[n],k.push(T),T=c._writeHeader(g,T,n,S,1,k[B++]);var D=T-N;return a(g,T,101010256),T+=4,x(g,T+=4,B),x(g,T+=2,B),a(g,T+=2,D),a(g,T+=4,N),T+=4,T+=2,g.buffer},c._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},c._writeHeader=function(e,t,d,a,x,y){var n=c.bin.writeUint,r=c.bin.writeUshort,s=a.file;return n(e,t,x==0?67324752:33639248),t+=4,x==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,a.cpr?8:0),n(e,t+=2,0),n(e,t+=4,a.crc),n(e,t+=4,s.length),n(e,t+=4,a.usize),r(e,t+=4,c.bin.sizeUTF8(d)),r(e,t+=2,0),t+=2,x==1&&(t+=2,t+=2,n(e,t+=6,y),t+=4),t+=c.bin.writeUTF8(e,t,d),x==0&&(e.set(s,t),t+=s.length),t},c.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,a=0;a<8;a++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,a){for(var x=0;x<a;x++)e=c.crc.table[255&(e^t[d+x])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^c.crc.update(4294967295,e,t,d)}},c.adler=function(e,t,d){for(var a=1,x=0,y=t,n=t+d;y<n;){for(var r=Math.min(y+5552,n);y<r;)x+=a+=e[y++];a%=65521,x%=65521}return x<<16|a},c.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var a="",x=0;x<d;x++)a+=String.fromCharCode(e[t+x]);return a},writeASCII:function(e,t,d){for(var a=0;a<d.length;a++)e[t+a]=d.charCodeAt(a)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var a,x="",y=0;y<d;y++)x+="%"+c.bin.pad(e[t+y].toString(16));try{a=decodeURIComponent(x)}catch{return c.bin.readASCII(e,t,d)}return a},writeUTF8:function(e,t,d){for(var a=d.length,x=0,y=0;y<a;y++){var n=d.charCodeAt(y);if((4294967168&n)==0)e[t+x]=n,x++;else if((4294965248&n)==0)e[t+x]=192|n>>6,e[t+x+1]=128|n>>0&63,x+=2;else if((4294901760&n)==0)e[t+x]=224|n>>12,e[t+x+1]=128|n>>6&63,e[t+x+2]=128|n>>0&63,x+=3;else{if((4292870144&n)!=0)throw"e";e[t+x]=240|n>>18,e[t+x+1]=128|n>>12&63,e[t+x+2]=128|n>>6&63,e[t+x+3]=128|n>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var t=e.length,d=0,a=0;a<t;a++){var x=e.charCodeAt(a);if((4294967168&x)==0)d++;else if((4294965248&x)==0)d+=2;else if((4294901760&x)==0)d+=3;else{if((4292870144&x)!=0)throw"e";d+=4}}return d}},c.F={},c.F.deflateRaw=function(e,t,d,a){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],y=c.F.U,n=c.F._goodIndex;c.F._hash;var r=c.F._putsE,s=0,l=d<<3,g=0,T=e.length;if(a==0){for(;s<T;)r(t,l,s+(j=Math.min(65535,T-s))==T?1:0),l=c.F._copyExact(e,s,j,t,l+8),s+=j;return l>>>3}var k=y.lits,S=y.strt,B=y.prev,N=0,D=0,P=0,v=0,_=0,h=0;for(T>2&&(S[h=c.F._hash(e,0)]=0),s=0;s<T;s++){if(_=h,s+1<T-2){h=c.F._hash(e,s+1);var u=s+1&32767;B[u]=S[h],S[h]=u}if(g<=s){(N>14e3||D>26697)&&T-s>100&&(g<s&&(k[N]=s-g,N+=2,g=s),l=c.F._writeBlock(s==T-1||g==T?1:0,k,N,v,e,P,s-P,t,l),N=D=v=0,P=s);var m=0;s<T-2&&(m=c.F._bestMatch(e,s,B,_,Math.min(x[2],T-s),x[3]));var j=m>>>16,w=65535&m;if(m!=0){w=65535&m;var C=n(j=m>>>16,y.of0);y.lhst[257+C]++;var b=n(w,y.df0);y.dhst[b]++,v+=y.exb[C]+y.dxb[b],k[N]=j<<23|s-g,k[N+1]=w<<16|C<<8|b,N+=2,g=s+j}else y.lhst[e[s]]++;D++}}for(P==s&&e.length!=0||(g<s&&(k[N]=s-g,N+=2,g=s),l=c.F._writeBlock(1,k,N,v,e,P,s-P,t,l),N=0,D=0,N=D=v=0,P=s);(7&l)!=0;)l++;return l>>>3},c.F._bestMatch=function(e,t,d,a,x,y){var n=32767&t,r=d[n],s=n-r+32768&32767;if(r==n||a!=c.F._hash(e,t-s))return 0;for(var l=0,g=0,T=Math.min(32767,t);s<=T&&--y!=0&&r!=n;){if(l==0||e[t+l]==e[t+l-s]){var k=c.F._howLong(e,t,s);if(k>l){if(g=s,(l=k)>=x)break;s+2<k&&(k=s+2);for(var S=0,B=0;B<k-2;B++){var N=t-s+B+32768&32767,D=N-d[N]+32768&32767;D>S&&(S=D,r=N)}}}s+=(n=r)-(r=d[n])+32768&32767}return l<<16|g},c.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var a=t,x=Math.min(e.length,t+258);for(t+=3;t<x&&e[t]==e[t-d];)t++;return t-a},c.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},c.saved=0,c.F._writeBlock=function(e,t,d,a,x,y,n,r,s){var l,g,T,k,S,B,N,D,P,v=c.F.U,_=c.F._putsF,h=c.F._putsE;v.lhst[256]++,g=(l=c.F.getTrees())[0],T=l[1],k=l[2],S=l[3],B=l[4],N=l[5],D=l[6],P=l[7];var u=32+((s+3&7)==0?0:8-(s+3&7))+(n<<3),m=a+c.F.contSize(v.fltree,v.lhst)+c.F.contSize(v.fdtree,v.dhst),j=a+c.F.contSize(v.ltree,v.lhst)+c.F.contSize(v.dtree,v.dhst);j+=14+3*N+c.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var w=0;w<286;w++)v.lhst[w]=0;for(w=0;w<30;w++)v.dhst[w]=0;for(w=0;w<19;w++)v.ihst[w]=0;var C=u<m&&u<j?0:m<j?1:2;if(_(r,s,e),_(r,s+1,C),s+=3,C==0){for(;(7&s)!=0;)s++;s=c.F._copyExact(x,y,n,r,s)}else{var b,A;if(C==1&&(b=v.fltree,A=v.fdtree),C==2){c.F.makeCodes(v.ltree,g),c.F.revCodes(v.ltree,g),c.F.makeCodes(v.dtree,T),c.F.revCodes(v.dtree,T),c.F.makeCodes(v.itree,k),c.F.revCodes(v.itree,k),b=v.ltree,A=v.dtree,h(r,s,S-257),h(r,s+=5,B-1),h(r,s+=5,N-4),s+=4;for(var f=0;f<N;f++)h(r,s+3*f,v.itree[1+(v.ordr[f]<<1)]);s+=3*N,s=c.F._codeTiny(D,v.itree,r,s),s=c.F._codeTiny(P,v.itree,r,s)}for(var o=y,O=0;O<d;O+=2){for(var F=t[O],M=F>>>23,$=o+(8388607&F);o<$;)s=c.F._writeLit(x[o++],b,r,s);if(M!=0){var z=t[O+1],G=z>>16,W=z>>8&255,R=255&z;h(r,s=c.F._writeLit(257+W,b,r,s),M-v.of0[W]),s+=v.exb[W],_(r,s=c.F._writeLit(R,A,r,s),G-v.df0[R]),s+=v.dxb[R],o+=M}}s=c.F._writeLit(256,b,r,s)}return s},c.F._copyExact=function(e,t,d,a,x){var y=x>>>3;return a[y]=d,a[y+1]=d>>>8,a[y+2]=255-a[y],a[y+3]=255-a[y+1],y+=4,a.set(new Uint8Array(e.buffer,t,d),y),x+(d+4<<3)},c.F.getTrees=function(){for(var e=c.F.U,t=c.F._hufTree(e.lhst,e.ltree,15),d=c.F._hufTree(e.dhst,e.dtree,15),a=[],x=c.F._lenCodes(e.ltree,a),y=[],n=c.F._lenCodes(e.dtree,y),r=0;r<a.length;r+=2)e.ihst[a[r]]++;for(r=0;r<y.length;r+=2)e.ihst[y[r]]++;for(var s=c.F._hufTree(e.ihst,e.itree,7),l=19;l>4&&e.itree[1+(e.ordr[l-1]<<1)]==0;)l--;return[t,d,s,x,n,l,a,y]},c.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},c.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},c.F.contSize=function(e,t){for(var d=0,a=0;a<t.length;a++)d+=t[a]*e[1+(a<<1)];return d},c.F._codeTiny=function(e,t,d,a){for(var x=0;x<e.length;x+=2){var y=e[x],n=e[x+1];a=c.F._writeLit(y,t,d,a);var r=y==16?2:y==17?3:7;y>15&&(c.F._putsE(d,a,n,r),a+=r)}return a},c.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var a=0;a<d;a+=2){var x=e[a+1],y=a+3<d?e[a+3]:-1,n=a+5<d?e[a+5]:-1,r=a==0?-1:e[a-1];if(x==0&&y==x&&n==x){for(var s=a+5;s+2<d&&e[s+2]==x;)s+=2;(l=Math.min(s+1-a>>>1,138))<11?t.push(17,l-3):t.push(18,l-11),a+=2*l-2}else if(x==r&&y==x&&n==x){for(s=a+5;s+2<d&&e[s+2]==x;)s+=2;var l=Math.min(s+1-a>>>1,6);t.push(16,l-3),a+=2*l-2}else t.push(x,0)}return d>>>1},c.F._hufTree=function(e,t,d){var a=[],x=e.length,y=t.length,n=0;for(n=0;n<y;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<x;n++)e[n]!=0&&a.push({lit:n,f:e[n]});var r=a.length,s=a.slice(0);if(r==0)return 0;if(r==1){var l=a[0].lit;return s=l==0?1:0,t[1+(l<<1)]=1,t[1+(s<<1)]=1,1}a.sort(function(D,P){return D.f-P.f});var g=a[0],T=a[1],k=0,S=1,B=2;for(a[0]={lit:-1,f:g.f+T.f,l:g,r:T,d:0};S!=r-1;)g=k!=S&&(B==r||a[k].f<a[B].f)?a[k++]:a[B++],T=k!=S&&(B==r||a[k].f<a[B].f)?a[k++]:a[B++],a[S++]={lit:-1,f:g.f+T.f,l:g,r:T};var N=c.F.setDepth(a[S-1],0);for(N>d&&(c.F.restrictDepth(s,d,N),N=d),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return N},c.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(c.F.setDepth(e.l,t+1),c.F.setDepth(e.r,t+1))},c.F.restrictDepth=function(e,t,d){var a=0,x=1<<d-t,y=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),a=0;a<e.length&&e[a].d>t;a++){var n=e[a].d;e[a].d=t,y+=x-(1<<d-n)}for(y>>>=d-t;y>0;)(n=e[a].d)<t?(e[a].d++,y-=1<<t-n-1):a++;for(;a>=0;a--)e[a].d==t&&y<0&&(e[a].d--,y++);y!=0&&console.log("debt left")},c.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},c.F._writeLit=function(e,t,d,a){return c.F._putsF(d,a,t[e<<1]),a+t[1+(e<<1)]},c.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var a=c.F,x=a._bitsF,y=a._bitsE,n=a._decodeTiny,r=a.makeCodes,s=a.codes2map,l=a._get17,g=a.U,T=t==null;T&&(t=new d(e.length>>>2<<3));for(var k,S,B=0,N=0,D=0,P=0,v=0,_=0,h=0,u=0,m=0;B==0;)if(B=x(e,m,1),N=x(e,m+1,2),m+=3,N!=0){if(T&&(t=c.F._check(t,u+(1<<17))),N==1&&(k=g.flmap,S=g.fdmap,_=511,h=31),N==2){D=y(e,m,5)+257,P=y(e,m+5,5)+1,v=y(e,m+10,4)+4,m+=14;for(var j=0;j<38;j+=2)g.itree[j]=0,g.itree[j+1]=0;var w=1;for(j=0;j<v;j++){var C=y(e,m+3*j,3);g.itree[1+(g.ordr[j]<<1)]=C,C>w&&(w=C)}m+=3*v,r(g.itree,w),s(g.itree,w,g.imap),k=g.lmap,S=g.dmap,m=n(g.imap,(1<<w)-1,D+P,e,m,g.ttree);var b=a._copyOut(g.ttree,0,D,g.ltree);_=(1<<b)-1;var A=a._copyOut(g.ttree,D,P,g.dtree);h=(1<<A)-1,r(g.ltree,b),s(g.ltree,b,k),r(g.dtree,A),s(g.dtree,A,S)}for(;;){var f=k[l(e,m)&_];m+=15&f;var o=f>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var O=u+o-254;if(o>264){var F=g.ldef[o-257];O=u+(F>>>3)+y(e,m,7&F),m+=7&F}var M=S[l(e,m)&h];m+=15&M;var $=M>>>4,z=g.ddef[$],G=(z>>>4)+x(e,m,15&z);for(m+=15&z,T&&(t=c.F._check(t,u+(1<<17)));u<O;)t[u]=t[u++-G],t[u]=t[u++-G],t[u]=t[u++-G],t[u]=t[u++-G];u=O}}}else{(7&m)!=0&&(m+=8-(7&m));var W=4+(m>>>3),R=e[W-4]|e[W-3]<<8;T&&(t=c.F._check(t,u+R)),t.set(new d(e.buffer,e.byteOffset+W,R),u),m=W+R<<3,u+=R}return t.length==u?t:t.slice(0,u)},c.F._check=function(e,t){var d=e.length;if(t<=d)return e;var a=new Uint8Array(Math.max(d<<1,t));return a.set(e,0),a},c.F._decodeTiny=function(e,t,d,a,x,y){for(var n=c.F._bitsE,r=c.F._get17,s=0;s<d;){var l=e[r(a,x)&t];x+=15&l;var g=l>>>4;if(g<=15)y[s]=g,s++;else{var T=0,k=0;g==16?(k=3+n(a,x,2),x+=2,T=y[s-1]):g==17?(k=3+n(a,x,3),x+=3):g==18&&(k=11+n(a,x,7),x+=7);for(var S=s+k;s<S;)y[s]=T,s++}}return x},c.F._copyOut=function(e,t,d,a){for(var x=0,y=0,n=a.length>>>1;y<d;){var r=e[y+t];a[y<<1]=0,a[1+(y<<1)]=r,r>x&&(x=r),y++}for(;y<n;)a[y<<1]=0,a[1+(y<<1)]=0,y++;return x},c.F.makeCodes=function(e,t){for(var d,a,x,y,n=c.F.U,r=e.length,s=n.bl_count,l=0;l<=t;l++)s[l]=0;for(l=1;l<r;l+=2)s[e[l]]++;var g=n.next_code;for(d=0,s[0]=0,a=1;a<=t;a++)d=d+s[a-1]<<1,g[a]=d;for(x=0;x<r;x+=2)(y=e[x+1])!=0&&(e[x]=g[y],g[y]++)},c.F.codes2map=function(e,t,d){for(var a=e.length,x=c.F.U.rev15,y=0;y<a;y+=2)if(e[y+1]!=0)for(var n=y>>1,r=e[y+1],s=n<<4|r,l=t-r,g=e[y]<<l,T=g+(1<<l);g!=T;)d[x[g]>>>15-t]=s,g++},c.F.revCodes=function(e,t){for(var d=c.F.U.rev15,a=15-t,x=0;x<e.length;x+=2){var y=e[x]<<t-e[x+1];e[x]=d[y]>>>a}},c.F._putsE=function(e,t,d){d<<=7&t;var a=t>>>3;e[a]|=d,e[a+1]|=d>>>8},c.F._putsF=function(e,t,d){d<<=7&t;var a=t>>>3;e[a]|=d,e[a+1]|=d>>>8,e[a+2]|=d>>>16},c.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},c.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},c.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},c.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},c.F.U=(I=Uint16Array,E=Uint32Array,{next_code:new I(16),bl_count:new I(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new I(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new E(32),flmap:new I(512),fltree:[],fdmap:new I(32),fdtree:[],lmap:new I(32768),ltree:[],ttree:[],dmap:new I(32768),dtree:[],imap:new I(512),itree:[],rev15:new I(32768),lhst:new E(286),dhst:new E(30),ihst:new E(19),lits:new E(15e3),strt:new I(65536),prev:new I(32768)}),function(){for(var e=c.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function a(x,y,n){for(;y--!=0;)x.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];a(e.fltree,144,8),a(e.fltree,112,9),a(e.fltree,24,7),a(e.fltree,8,8),c.F.makeCodes(e.fltree,9),c.F.codes2map(e.fltree,9,e.flmap),c.F.revCodes(e.fltree,9),a(e.fdtree,32,5),c.F.makeCodes(e.fdtree,5),c.F.codes2map(e.fdtree,5,e.fdmap),c.F.revCodes(e.fdtree,5),a(e.itree,19,0),a(e.ltree,286,0),a(e.dtree,30,0),a(e.ttree,320,0)}()})();var qs=Hs({__proto__:null,default:_t},[_t]);const Ne=function(){var p={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let l="";for(let g=0;g<s;g++)l+=String.fromCharCode(n[r+g]);return l},writeASCII(n,r,s){for(let l=0;l<s.length;l++)n[r+l]=s.charCodeAt(l)},readBytes(n,r,s){const l=[];for(let g=0;g<s;g++)l.push(n[r+g]);return l},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let l,g="";for(let T=0;T<s;T++)g+=`%${p.pad(n[r+T].toString(16))}`;try{l=decodeURIComponent(g)}catch{return p.readASCII(n,r,s)}return l}};function I(n,r,s,l){const g=r*s,T=t(l),k=Math.ceil(r*T/8),S=new Uint8Array(4*g),B=new Uint32Array(S.buffer),{ctype:N}=l,{depth:D}=l,P=p.readUshort;if(N==6){const F=g<<2;if(D==8)for(var v=0;v<F;v+=4)S[v]=n[v],S[v+1]=n[v+1],S[v+2]=n[v+2],S[v+3]=n[v+3];if(D==16)for(v=0;v<F;v++)S[v]=n[v<<1]}else if(N==2){const F=l.tabs.tRNS;if(F==null){if(D==8)for(v=0;v<g;v++){var _=3*v;B[v]=255<<24|n[_+2]<<16|n[_+1]<<8|n[_]}if(D==16)for(v=0;v<g;v++)_=6*v,B[v]=255<<24|n[_+4]<<16|n[_+2]<<8|n[_]}else{var h=F[0];const M=F[1],$=F[2];if(D==8)for(v=0;v<g;v++){var u=v<<2;_=3*v,B[v]=255<<24|n[_+2]<<16|n[_+1]<<8|n[_],n[_]==h&&n[_+1]==M&&n[_+2]==$&&(S[u+3]=0)}if(D==16)for(v=0;v<g;v++)u=v<<2,_=6*v,B[v]=255<<24|n[_+4]<<16|n[_+2]<<8|n[_],P(n,_)==h&&P(n,_+2)==M&&P(n,_+4)==$&&(S[u+3]=0)}}else if(N==3){const F=l.tabs.PLTE,M=l.tabs.tRNS,$=M?M.length:0;if(D==1)for(var m=0;m<s;m++){var j=m*k,w=m*r;for(v=0;v<r;v++){u=w+v<<2;var C=3*(b=n[j+(v>>3)]>>7-((7&v)<<0)&1);S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255}}if(D==2)for(m=0;m<s;m++)for(j=m*k,w=m*r,v=0;v<r;v++)u=w+v<<2,C=3*(b=n[j+(v>>2)]>>6-((3&v)<<1)&3),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255;if(D==4)for(m=0;m<s;m++)for(j=m*k,w=m*r,v=0;v<r;v++)u=w+v<<2,C=3*(b=n[j+(v>>1)]>>4-((1&v)<<2)&15),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255;if(D==8)for(v=0;v<g;v++){var b;u=v<<2,C=3*(b=n[v]),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255}}else if(N==4){if(D==8)for(v=0;v<g;v++){u=v<<2;var A=n[f=v<<1];S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+1]}if(D==16)for(v=0;v<g;v++){var f;u=v<<2,A=n[f=v<<2],S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+2]}}else if(N==0)for(h=l.tabs.tRNS?l.tabs.tRNS:-1,m=0;m<s;m++){const F=m*k,M=m*r;if(D==1)for(var o=0;o<r;o++){var O=(A=255*(n[F+(o>>>3)]>>>7-(7&o)&1))==255*h?0:255;B[M+o]=O<<24|A<<16|A<<8|A}else if(D==2)for(o=0;o<r;o++)O=(A=85*(n[F+(o>>>2)]>>>6-((3&o)<<1)&3))==85*h?0:255,B[M+o]=O<<24|A<<16|A<<8|A;else if(D==4)for(o=0;o<r;o++)O=(A=17*(n[F+(o>>>1)]>>>4-((1&o)<<2)&15))==17*h?0:255,B[M+o]=O<<24|A<<16|A<<8|A;else if(D==8)for(o=0;o<r;o++)O=(A=n[F+o])==h?0:255,B[M+o]=O<<24|A<<16|A<<8|A;else if(D==16)for(o=0;o<r;o++)A=n[F+(o<<1)],O=P(n,F+(o<<1))==h?0:255,B[M+o]=O<<24|A<<16|A<<8|A}return S}function E(n,r,s,l){const g=t(n),T=Math.ceil(s*g/8),k=new Uint8Array((T+1+n.interlace)*l);return r=n.tabs.CgBI?e(r,k):c(r,k),n.interlace==0?r=d(r,n,0,s,l):n.interlace==1&&(r=function(B,N){const D=N.width,P=N.height,v=t(N),_=v>>3,h=Math.ceil(D*v/8),u=new Uint8Array(P*h);let m=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const o=C[A],O=b[A];let F=0,M=0,$=j[A];for(;$<P;)$+=o,M++;let z=w[A];for(;z<D;)z+=O,F++;const G=Math.ceil(F*v/8);d(B,N,m,F,M);let W=0,R=j[A];for(;R<P;){let Z=w[A],oe=m+W*G<<3;for(;Z<D;){var f;if(v==1&&(f=(f=B[oe>>3])>>7-(7&oe)&1,u[R*h+(Z>>3)]|=f<<7-((7&Z)<<0)),v==2&&(f=(f=B[oe>>3])>>6-(7&oe)&3,u[R*h+(Z>>2)]|=f<<6-((3&Z)<<1)),v==4&&(f=(f=B[oe>>3])>>4-(7&oe)&15,u[R*h+(Z>>1)]|=f<<4-((1&Z)<<2)),v>=8){const ee=R*h+Z*_;for(let te=0;te<_;te++)u[ee+te]=B[(oe>>3)+te]}oe+=v,Z+=O}W++,R+=o}F*M!=0&&(m+=M*(1+G)),A+=1}return u}(r,n)),r}function c(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const l=Uint8Array;let g,T,k=0,S=0,B=0,N=0,D=0,P=0,v=0,_=0,h=0;if(r[0]==3&&r[1]==0)return s||new l(0);const u=n.H,m=u.b,j=u.e,w=u.R,C=u.n,b=u.A,A=u.Z,f=u.m,o=s==null;for(o&&(s=new l(r.length>>>2<<5));k==0;)if(k=m(r,h,1),S=m(r,h+1,2),h+=3,S!=0){if(o&&(s=n.H.W(s,_+(1<<17))),S==1&&(g=f.J,T=f.h,P=511,v=31),S==2){B=j(r,h,5)+257,N=j(r,h+5,5)+1,D=j(r,h+10,4)+4,h+=14;let F=1;for(var O=0;O<38;O+=2)f.Q[O]=0,f.Q[O+1]=0;for(O=0;O<D;O++){const z=j(r,h+3*O,3);f.Q[1+(f.X[O]<<1)]=z,z>F&&(F=z)}h+=3*D,C(f.Q,F),b(f.Q,F,f.u),g=f.w,T=f.d,h=w(f.u,(1<<F)-1,B+N,r,h,f.v);const M=u.V(f.v,0,B,f.C);P=(1<<M)-1;const $=u.V(f.v,B,N,f.D);v=(1<<$)-1,C(f.C,M),b(f.C,M,g),C(f.D,$),b(f.D,$,T)}for(;;){const F=g[A(r,h)&P];h+=15&F;const M=F>>>4;if(!(M>>>8))s[_++]=M;else{if(M==256)break;{let $=_+M-254;if(M>264){const Z=f.q[M-257];$=_+(Z>>>3)+j(r,h,7&Z),h+=7&Z}const z=T[A(r,h)&v];h+=15&z;const G=z>>>4,W=f.c[G],R=(W>>>4)+m(r,h,15&W);for(h+=15&W;_<$;)s[_]=s[_++-R],s[_]=s[_++-R],s[_]=s[_++-R],s[_]=s[_++-R];_=$}}}}else{(7&h)!=0&&(h+=8-(7&h));const F=4+(h>>>3),M=r[F-4]|r[F-3]<<8;o&&(s=n.H.W(s,_+M)),s.set(new l(r.buffer,r.byteOffset+F,M),_),h=F+M<<3,_+=M}return s.length==_?s:s.slice(0,_)},n.H.W=function(r,s){const l=r.length;if(s<=l)return r;const g=new Uint8Array(l<<1);return g.set(r,0),g},n.H.R=function(r,s,l,g,T,k){const S=n.H.e,B=n.H.Z;let N=0;for(;N<l;){const D=r[B(g,T)&s];T+=15&D;const P=D>>>4;if(P<=15)k[N]=P,N++;else{let v=0,_=0;P==16?(_=3+S(g,T,2),T+=2,v=k[N-1]):P==17?(_=3+S(g,T,3),T+=3):P==18&&(_=11+S(g,T,7),T+=7);const h=N+_;for(;N<h;)k[N]=v,N++}}return T},n.H.V=function(r,s,l,g){let T=0,k=0;const S=g.length>>>1;for(;k<l;){const B=r[k+s];g[k<<1]=0,g[1+(k<<1)]=B,B>T&&(T=B),k++}for(;k<S;)g[k<<1]=0,g[1+(k<<1)]=0,k++;return T},n.H.n=function(r,s){const l=n.H.m,g=r.length;let T,k,S,B;const N=l.j;for(var D=0;D<=s;D++)N[D]=0;for(D=1;D<g;D+=2)N[r[D]]++;const P=l.K;for(T=0,N[0]=0,k=1;k<=s;k++)T=T+N[k-1]<<1,P[k]=T;for(S=0;S<g;S+=2)B=r[S+1],B!=0&&(r[S]=P[B],P[B]++)},n.H.A=function(r,s,l){const g=r.length,T=n.H.m.r;for(let k=0;k<g;k+=2)if(r[k+1]!=0){const S=k>>1,B=r[k+1],N=S<<4|B,D=s-B;let P=r[k]<<D;const v=P+(1<<D);for(;P!=v;)l[T[P]>>>15-s]=N,P++}},n.H.l=function(r,s){const l=n.H.m.r,g=15-s;for(let T=0;T<r.length;T+=2){const k=r[T]<<s-r[T+1];r[T]=l[k]>>>g}},n.H.M=function(r,s,l){l<<=7&s;const g=s>>>3;r[g]|=l,r[g+1]|=l>>>8},n.H.I=function(r,s,l){l<<=7&s;const g=s>>>3;r[g]|=l,r[g+1]|=l>>>8,r[g+2]|=l>>>16},n.H.e=function(r,s,l){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<l)-1},n.H.b=function(r,s,l){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<l)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let g=s;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,r.r[s]=(g>>>16|g<<16)>>>17}function l(g,T,k){for(;T--!=0;)g.push(0,k)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];l(r._,144,8),l(r._,112,9),l(r._,24,7),l(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),l(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),l(r.Q,19,0),l(r.C,286,0),l(r.D,30,0),l(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,r,s,l,g){let T=t(r);const k=Math.ceil(l*T/8);let S,B;T=Math.ceil(T/8);let N=n[s],D=0;if(N>1&&(n[s]=[0,0,1][N-2]),N==3)for(D=T;D<k;D++)n[D+1]=n[D+1]+(n[D+1-T]>>>1)&255;for(let P=0;P<g;P++)if(S=s+P*k,B=S+P+1,N=n[B-1],D=0,N==0)for(;D<k;D++)n[S+D]=n[B+D];else if(N==1){for(;D<T;D++)n[S+D]=n[B+D];for(;D<k;D++)n[S+D]=n[B+D]+n[S+D-T]}else if(N==2)for(;D<k;D++)n[S+D]=n[B+D]+n[S+D-k];else if(N==3){for(;D<T;D++)n[S+D]=n[B+D]+(n[S+D-k]>>>1);for(;D<k;D++)n[S+D]=n[B+D]+(n[S+D-k]+n[S+D-T]>>>1)}else{for(;D<T;D++)n[S+D]=n[B+D]+a(0,n[S+D-k],0);for(;D<k;D++)n[S+D]=n[B+D]+a(n[S+D-T],n[S+D-k],n[S+D-T-k])}return n}function a(n,r,s){const l=n+r-s,g=l-n,T=l-r,k=l-s;return g*g<=T*T&&g*g<=k*k?n:T*T<=k*k?r:s}function x(n,r,s){s.width=p.readUint(n,r),r+=4,s.height=p.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function y(n,r,s,l,g,T,k,S,B){const N=Math.min(r,g),D=Math.min(s,T);let P=0,v=0;for(let A=0;A<D;A++)for(let f=0;f<N;f++)if(k>=0&&S>=0?(P=A*r+f<<2,v=(S+A)*g+k+f<<2):(P=(-S+A)*r-k+f<<2,v=A*g+f<<2),B==0)l[v]=n[P],l[v+1]=n[P+1],l[v+2]=n[P+2],l[v+3]=n[P+3];else if(B==1){var _=n[P+3]*.00392156862745098,h=n[P]*_,u=n[P+1]*_,m=n[P+2]*_,j=l[v+3]*(1/255),w=l[v]*j,C=l[v+1]*j,b=l[v+2]*j;const o=1-_,O=_+j*o,F=O==0?0:1/O;l[v+3]=255*O,l[v+0]=(h+w*o)*F,l[v+1]=(u+C*o)*F,l[v+2]=(m+b*o)*F}else if(B==2)_=n[P+3],h=n[P],u=n[P+1],m=n[P+2],j=l[v+3],w=l[v],C=l[v+1],b=l[v+2],_==j&&h==w&&u==C&&m==b?(l[v]=0,l[v+1]=0,l[v+2]=0,l[v+3]=0):(l[v]=h,l[v+1]=u,l[v+2]=m,l[v+3]=_);else if(B==3){if(_=n[P+3],h=n[P],u=n[P+1],m=n[P+2],j=l[v+3],w=l[v],C=l[v+1],b=l[v+2],_==j&&h==w&&u==C&&m==b)continue;if(_<220&&j>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let l=8;const g=p,T=g.readUshort,k=g.readUint,S={tabs:{},frames:[]},B=new Uint8Array(s.length);let N,D=0,P=0;const v=[137,80,78,71,13,10,26,10];for(var _=0;_<8;_++)if(s[_]!=v[_])throw"The input is not a PNG file!";for(;l<s.length;){const A=g.readUint(s,l);l+=4;const f=g.readASCII(s,l,4);if(l+=4,f=="IHDR")x(s,l,S);else if(f=="iCCP"){for(var h=l;s[h]!=0;)h++;g.readASCII(s,l,h-l),s[h+1];const o=s.slice(h+2,l+A);let O=null;try{O=c(o)}catch{O=e(o)}S.tabs[f]=O}else if(f=="CgBI")S.tabs[f]=s.slice(l,l+4);else if(f=="IDAT"){for(_=0;_<A;_++)B[D+_]=s[l+_];D+=A}else if(f=="acTL")S.tabs[f]={num_frames:k(s,l),num_plays:k(s,l+4)},N=new Uint8Array(s.length);else if(f=="fcTL"){P!=0&&((b=S.frames[S.frames.length-1]).data=E(S,N.slice(0,P),b.rect.width,b.rect.height),P=0);const o={x:k(s,l+12),y:k(s,l+16),width:k(s,l+4),height:k(s,l+8)};let O=T(s,l+22);O=T(s,l+20)/(O==0?100:O);const F={rect:o,delay:Math.round(1e3*O),dispose:s[l+24],blend:s[l+25]};S.frames.push(F)}else if(f=="fdAT"){for(_=0;_<A-4;_++)N[P+_]=s[l+_+4];P+=A-4}else if(f=="pHYs")S.tabs[f]=[g.readUint(s,l),g.readUint(s,l+4),s[l+8]];else if(f=="cHRM")for(S.tabs[f]=[],_=0;_<8;_++)S.tabs[f].push(g.readUint(s,l+4*_));else if(f=="tEXt"||f=="zTXt"){S.tabs[f]==null&&(S.tabs[f]={});var u=g.nextZero(s,l),m=g.readASCII(s,l,u-l),j=l+A-u-1;if(f=="tEXt")C=g.readASCII(s,u+1,j);else{var w=c(s.slice(u+2,u+2+j));C=g.readUTF8(w,0,w.length)}S.tabs[f][m]=C}else if(f=="iTXt"){S.tabs[f]==null&&(S.tabs[f]={}),u=0,h=l,u=g.nextZero(s,h),m=g.readASCII(s,h,u-h);const o=s[h=u+1];var C;s[h+1],h+=2,u=g.nextZero(s,h),g.readASCII(s,h,u-h),h=u+1,u=g.nextZero(s,h),g.readUTF8(s,h,u-h),j=A-((h=u+1)-l),o==0?C=g.readUTF8(s,h,j):(w=c(s.slice(h,h+j)),C=g.readUTF8(w,0,w.length)),S.tabs[f][m]=C}else if(f=="PLTE")S.tabs[f]=g.readBytes(s,l,A);else if(f=="hIST"){const o=S.tabs.PLTE.length/3;for(S.tabs[f]=[],_=0;_<o;_++)S.tabs[f].push(T(s,l+2*_))}else if(f=="tRNS")S.ctype==3?S.tabs[f]=g.readBytes(s,l,A):S.ctype==0?S.tabs[f]=T(s,l):S.ctype==2&&(S.tabs[f]=[T(s,l),T(s,l+2),T(s,l+4)]);else if(f=="gAMA")S.tabs[f]=g.readUint(s,l)/1e5;else if(f=="sRGB")S.tabs[f]=s[l];else if(f=="bKGD")S.ctype==0||S.ctype==4?S.tabs[f]=[T(s,l)]:S.ctype==2||S.ctype==6?S.tabs[f]=[T(s,l),T(s,l+2),T(s,l+4)]:S.ctype==3&&(S.tabs[f]=s[l]);else if(f=="IEND")break;l+=A,g.readUint(s,l),l+=4}var b;return P!=0&&((b=S.frames[S.frames.length-1]).data=E(S,N.slice(0,P),b.rect.width,b.rect.height)),S.data=E(S,B,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(r){const s=r.width,l=r.height;if(r.tabs.acTL==null)return[I(r.data,s,l,r).buffer];const g=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const T=s*l*4,k=new Uint8Array(T),S=new Uint8Array(T),B=new Uint8Array(T);for(let D=0;D<r.frames.length;D++){const P=r.frames[D],v=P.rect.x,_=P.rect.y,h=P.rect.width,u=P.rect.height,m=I(P.data,h,u,r);if(D!=0)for(var N=0;N<T;N++)B[N]=k[N];if(P.blend==0?y(m,h,u,k,s,l,v,_,0):P.blend==1&&y(m,h,u,k,s,l,v,_,1),g.push(k.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)y(S,h,u,k,s,l,v,_,0);else if(P.dispose==2)for(N=0;N<T;N++)k[N]=B[N]}}return g},_paeth:a,_copyTile:y,_bin:p}}();(function(){const{_copyTile:p}=Ne,{_bin:I}=Ne,E=Ne._paeth;var c={table:function(){const h=new Uint32Array(256);for(let u=0;u<256;u++){let m=u;for(let j=0;j<8;j++)1&m?m=3988292384^m>>>1:m>>>=1;h[u]=m}return h}(),update(h,u,m,j){for(let w=0;w<j;w++)h=c.table[255&(h^u[m+w])]^h>>>8;return h},crc:(h,u,m)=>4294967295^c.update(4294967295,h,u,m)};function e(h,u,m,j){u[m]+=h[0]*j>>4,u[m+1]+=h[1]*j>>4,u[m+2]+=h[2]*j>>4,u[m+3]+=h[3]*j>>4}function t(h){return Math.max(0,Math.min(255,h))}function d(h,u){const m=h[0]-u[0],j=h[1]-u[1],w=h[2]-u[2],C=h[3]-u[3];return m*m+j*j+w*w+C*C}function a(h,u,m,j,w,C,b){b==null&&(b=1);const A=j.length,f=[];for(var o=0;o<A;o++){const R=j[o];f.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(o=0;o<A;o++){let R=4294967295;for(var O=0,F=0;F<A;F++){var M=d(f[o],f[F]);F!=o&&M<R&&(R=M,O=F)}}const $=new Uint32Array(w.buffer),z=new Int16Array(u*m*4),G=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<G.length;o++)G[o]=255*((G[o]+.5)/16-.5);for(let R=0;R<m;R++)for(let Z=0;Z<u;Z++){var W;o=4*(R*u+Z),b!=2?W=[t(h[o]+z[o]),t(h[o+1]+z[o+1]),t(h[o+2]+z[o+2]),t(h[o+3]+z[o+3])]:(M=G[4*(3&R)+(3&Z)],W=[t(h[o]+M),t(h[o+1]+M),t(h[o+2]+M),t(h[o+3]+M)]),O=0;let oe=16777215;for(F=0;F<A;F++){const re=d(W,f[F]);re<oe&&(oe=re,O=F)}const ee=f[O],te=[W[0]-ee[0],W[1]-ee[1],W[2]-ee[2],W[3]-ee[3]];b==1&&(Z!=u-1&&e(te,z,o+4,7),R!=m-1&&(Z!=0&&e(te,z,o+4*u-4,3),e(te,z,o+4*u,5),Z!=u-1&&e(te,z,o+4*u+4,1))),C[o>>2]=O,$[o>>2]=j[O]}}function x(h,u,m,j,w){w==null&&(w={});const{crc:C}=c,b=I.writeUint,A=I.writeUshort,f=I.writeASCII;let o=8;const O=h.frames.length>1;let F,M=!1,$=33+(O?20:0);if(w.sRGB!=null&&($+=13),w.pHYs!=null&&($+=21),w.iCCP!=null&&(F=pako.deflate(w.iCCP),$+=21+F.length+4),h.ctype==3){for(var z=h.plte.length,G=0;G<z;G++)h.plte[G]>>>24!=255&&(M=!0);$+=8+3*z+4+(M?8+1*z+4:0)}for(var W=0;W<h.frames.length;W++)O&&($+=38),$+=(ee=h.frames[W]).cimg.length+12,W!=0&&($+=4);$+=12;const R=new Uint8Array($),Z=[137,80,78,71,13,10,26,10];for(G=0;G<8;G++)R[G]=Z[G];if(b(R,o,13),o+=4,f(R,o,"IHDR"),o+=4,b(R,o,u),o+=4,b(R,o,m),o+=4,R[o]=h.depth,o++,R[o]=h.ctype,o++,R[o]=0,o++,R[o]=0,o++,R[o]=0,o++,b(R,o,C(R,o-17,17)),o+=4,w.sRGB!=null&&(b(R,o,1),o+=4,f(R,o,"sRGB"),o+=4,R[o]=w.sRGB,o++,b(R,o,C(R,o-5,5)),o+=4),w.iCCP!=null){const te=13+F.length;b(R,o,te),o+=4,f(R,o,"iCCP"),o+=4,f(R,o,"ICC profile"),o+=11,o+=2,R.set(F,o),o+=F.length,b(R,o,C(R,o-(te+4),te+4)),o+=4}if(w.pHYs!=null&&(b(R,o,9),o+=4,f(R,o,"pHYs"),o+=4,b(R,o,w.pHYs[0]),o+=4,b(R,o,w.pHYs[1]),o+=4,R[o]=w.pHYs[2],o++,b(R,o,C(R,o-13,13)),o+=4),O&&(b(R,o,8),o+=4,f(R,o,"acTL"),o+=4,b(R,o,h.frames.length),o+=4,b(R,o,w.loop!=null?w.loop:0),o+=4,b(R,o,C(R,o-12,12)),o+=4),h.ctype==3){for(b(R,o,3*(z=h.plte.length)),o+=4,f(R,o,"PLTE"),o+=4,G=0;G<z;G++){const te=3*G,re=h.plte[G],ie=255&re,ue=re>>>8&255,Ee=re>>>16&255;R[o+te+0]=ie,R[o+te+1]=ue,R[o+te+2]=Ee}if(o+=3*z,b(R,o,C(R,o-3*z-4,3*z+4)),o+=4,M){for(b(R,o,z),o+=4,f(R,o,"tRNS"),o+=4,G=0;G<z;G++)R[o+G]=h.plte[G]>>>24&255;o+=z,b(R,o,C(R,o-z-4,z+4)),o+=4}}let oe=0;for(W=0;W<h.frames.length;W++){var ee=h.frames[W];O&&(b(R,o,26),o+=4,f(R,o,"fcTL"),o+=4,b(R,o,oe++),o+=4,b(R,o,ee.rect.width),o+=4,b(R,o,ee.rect.height),o+=4,b(R,o,ee.rect.x),o+=4,b(R,o,ee.rect.y),o+=4,A(R,o,j[W]),o+=2,A(R,o,1e3),o+=2,R[o]=ee.dispose,o++,R[o]=ee.blend,o++,b(R,o,C(R,o-30,30)),o+=4);const te=ee.cimg;b(R,o,(z=te.length)+(W==0?0:4)),o+=4;const re=o;f(R,o,W==0?"IDAT":"fdAT"),o+=4,W!=0&&(b(R,o,oe++),o+=4),R.set(te,o),o+=z,b(R,o,C(R,re,o-re)),o+=4}return b(R,o,0),o+=4,f(R,o,"IEND"),o+=4,b(R,o,C(R,o-4,4)),o+=4,R.buffer}function y(h,u,m){for(let j=0;j<h.frames.length;j++){const w=h.frames[j];w.rect.width;const C=w.rect.height,b=new Uint8Array(C*w.bpl+C);w.cimg=l(w.img,C,w.bpp,w.bpl,b,u,m)}}function n(h,u,m,j,w){const C=w[0],b=w[1],A=w[2],f=w[3],o=w[4],O=w[5];let F=6,M=8,$=255;for(var z=0;z<h.length;z++){const me=new Uint8Array(h[z]);for(var G=me.length,W=0;W<G;W+=4)$&=me[W+3]}const R=$!=255,Z=function(de,ce,ge,xe,fe,we){const he=[];for(var ne=0;ne<de.length;ne++){const X=new Uint8Array(de[ne]),De=new Uint32Array(X.buffer);var Ae;let se=0,Me=0,ae=ce,Re=ge,Ie=xe?1:0;if(ne!=0){const Pt=we||xe||ne==1||he[ne-2].dispose!=0?1:2;let xt=0,At=1e9;for(let et=0;et<Pt;et++){var ke=new Uint8Array(de[ne-1-et]);const Lt=new Uint32Array(de[ne-1-et]);let Pe=ce,Le=ge,$e=-1,He=-1;for(let Qe=0;Qe<ge;Qe++)for(let Ve=0;Ve<ce;Ve++)De[pe=Qe*ce+Ve]!=Lt[pe]&&(Ve<Pe&&(Pe=Ve),Ve>$e&&($e=Ve),Qe<Le&&(Le=Qe),Qe>He&&(He=Qe));$e==-1&&(Pe=Le=$e=He=0),fe&&((1&Pe)==1&&Pe--,(1&Le)==1&&Le--);const Tt=($e-Pe+1)*(He-Le+1);Tt<At&&(At=Tt,xt=et,se=Pe,Me=Le,ae=$e-Pe+1,Re=He-Le+1)}ke=new Uint8Array(de[ne-1-xt]),xt==1&&(he[ne-1].dispose=2),Ae=new Uint8Array(ae*Re*4),p(ke,ce,ge,Ae,ae,Re,-se,-Me,0),Ie=p(X,ce,ge,Ae,ae,Re,-se,-Me,3)?1:0,Ie==1?s(X,ce,ge,Ae,{x:se,y:Me,width:ae,height:Re}):p(X,ce,ge,Ae,ae,Re,-se,-Me,0)}else Ae=X.slice(0);he.push({rect:{x:se,y:Me,width:ae,height:Re},img:Ae,blend:Ie,dispose:0})}if(xe)for(ne=0;ne<he.length;ne++){if((qe=he[ne]).blend==1)continue;const X=qe.rect,De=he[ne-1].rect,se=Math.min(X.x,De.x),Me=Math.min(X.y,De.y),ae={x:se,y:Me,width:Math.max(X.x+X.width,De.x+De.width)-se,height:Math.max(X.y+X.height,De.y+De.height)-Me};he[ne-1].dispose=1,ne-1!=0&&r(de,ce,ge,he,ne-1,ae,fe),r(de,ce,ge,he,ne,ae,fe)}let ot=0;if(de.length!=1)for(var pe=0;pe<he.length;pe++){var qe;ot+=(qe=he[pe]).rect.width*qe.rect.height}return he}(h,u,m,C,b,A),oe={},ee=[],te=[];if(j!=0){const me=[];for(W=0;W<Z.length;W++)me.push(Z[W].img.buffer);const de=function(fe){let we=0;for(var he=0;he<fe.length;he++)we+=fe[he].byteLength;const ne=new Uint8Array(we);let Ae=0;for(he=0;he<fe.length;he++){const ke=new Uint8Array(fe[he]),ot=ke.length;for(let pe=0;pe<ot;pe+=4){let qe=ke[pe],X=ke[pe+1],De=ke[pe+2];const se=ke[pe+3];se==0&&(qe=X=De=0),ne[Ae+pe]=qe,ne[Ae+pe+1]=X,ne[Ae+pe+2]=De,ne[Ae+pe+3]=se}Ae+=ot}return ne.buffer}(me),ce=T(de,j);for(W=0;W<ce.plte.length;W++)ee.push(ce.plte[W].est.rgba);let ge=0;for(W=0;W<Z.length;W++){const xe=(ie=Z[W]).img.length;var re=new Uint8Array(ce.inds.buffer,ge>>2,xe>>2);te.push(re);const fe=new Uint8Array(ce.abuf,ge,xe);O&&a(ie.img,ie.rect.width,ie.rect.height,ee,fe,re),ie.img.set(fe),ge+=xe}}else for(z=0;z<Z.length;z++){var ie=Z[z];const me=new Uint32Array(ie.img.buffer);var ue=ie.rect.width;for(G=me.length,re=new Uint8Array(G),te.push(re),W=0;W<G;W++){const de=me[W];if(W!=0&&de==me[W-1])re[W]=re[W-1];else if(W>ue&&de==me[W-ue])re[W]=re[W-ue];else{let ce=oe[de];if(ce==null&&(oe[de]=ce=ee.length,ee.push(de),ee.length>=300))break;re[W]=ce}}}const Ee=ee.length;for(Ee<=256&&o==0&&(M=Ee<=2?1:Ee<=4?2:Ee<=16?4:8,M=Math.max(M,f)),z=0;z<Z.length;z++){(ie=Z[z]).rect.x,ie.rect.y,ue=ie.rect.width;const me=ie.rect.height;let de=ie.img;new Uint32Array(de.buffer);let ce=4*ue,ge=4;if(Ee<=256&&o==0){ce=Math.ceil(M*ue/8);var Se=new Uint8Array(ce*me);const xe=te[z];for(let fe=0;fe<me;fe++){W=fe*ce;const we=fe*ue;if(M==8)for(var le=0;le<ue;le++)Se[W+le]=xe[we+le];else if(M==4)for(le=0;le<ue;le++)Se[W+(le>>1)]|=xe[we+le]<<4-4*(1&le);else if(M==2)for(le=0;le<ue;le++)Se[W+(le>>2)]|=xe[we+le]<<6-2*(3&le);else if(M==1)for(le=0;le<ue;le++)Se[W+(le>>3)]|=xe[we+le]<<7-1*(7&le)}de=Se,F=3,ge=1}else if(R==0&&Z.length==1){Se=new Uint8Array(ue*me*3);const xe=ue*me;for(W=0;W<xe;W++){const fe=3*W,we=4*W;Se[fe]=de[we],Se[fe+1]=de[we+1],Se[fe+2]=de[we+2]}de=Se,F=2,ge=3,ce=3*ue}ie.img=de,ie.bpl=ce,ie.bpp=ge}return{ctype:F,depth:M,plte:ee,frames:Z}}function r(h,u,m,j,w,C,b){const A=Uint8Array,f=Uint32Array,o=new A(h[w-1]),O=new f(h[w-1]),F=w+1<h.length?new A(h[w+1]):null,M=new A(h[w]),$=new f(M.buffer);let z=u,G=m,W=-1,R=-1;for(let oe=0;oe<C.height;oe++)for(let ee=0;ee<C.width;ee++){const te=C.x+ee,re=C.y+oe,ie=re*u+te,ue=$[ie];ue==0||j[w-1].dispose==0&&O[ie]==ue&&(F==null||F[4*ie+3]!=0)||(te<z&&(z=te),te>W&&(W=te),re<G&&(G=re),re>R&&(R=re))}W==-1&&(z=G=W=R=0),b&&((1&z)==1&&z--,(1&G)==1&&G--),C={x:z,y:G,width:W-z+1,height:R-G+1};const Z=j[w];Z.rect=C,Z.blend=1,Z.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(p(o,u,m,Z.img,C.width,C.height,-C.x,-C.y,0),s(M,u,m,Z.img,C)):p(M,u,m,Z.img,C.width,C.height,-C.x,-C.y,0)}function s(h,u,m,j,w){p(h,u,m,j,w.width,w.height,-w.x,-w.y,2)}function l(h,u,m,j,w,C,b){const A=[];let f,o=[0,1,2,3,4];C!=-1?o=[C]:(u*j>5e5||m==1)&&(o=[0]),b&&(f={level:0});const O=qs;for(var F=0;F<o.length;F++){for(let z=0;z<u;z++)g(w,h,z,j,m,o[F]);A.push(O.deflate(w,f))}let M,$=1e9;for(F=0;F<A.length;F++)A[F].length<$&&(M=F,$=A[F].length);return A[M]}function g(h,u,m,j,w,C){const b=m*j;let A=b+m;if(h[A]=C,A++,C==0)if(j<500)for(var f=0;f<j;f++)h[A+f]=u[b+f];else h.set(new Uint8Array(u.buffer,b,j),A);else if(C==1){for(f=0;f<w;f++)h[A+f]=u[b+f];for(f=w;f<j;f++)h[A+f]=u[b+f]-u[b+f-w]+256&255}else if(m==0){for(f=0;f<w;f++)h[A+f]=u[b+f];if(C==2)for(f=w;f<j;f++)h[A+f]=u[b+f];if(C==3)for(f=w;f<j;f++)h[A+f]=u[b+f]-(u[b+f-w]>>1)+256&255;if(C==4)for(f=w;f<j;f++)h[A+f]=u[b+f]-E(u[b+f-w],0,0)+256&255}else{if(C==2)for(f=0;f<j;f++)h[A+f]=u[b+f]+256-u[b+f-j]&255;if(C==3){for(f=0;f<w;f++)h[A+f]=u[b+f]+256-(u[b+f-j]>>1)&255;for(f=w;f<j;f++)h[A+f]=u[b+f]+256-(u[b+f-j]+u[b+f-w]>>1)&255}if(C==4){for(f=0;f<w;f++)h[A+f]=u[b+f]+256-E(0,u[b+f-j],0)&255;for(f=w;f<j;f++)h[A+f]=u[b+f]+256-E(u[b+f-w],u[b+f-j],u[b+f-w-j])&255}}}function T(h,u){const m=new Uint8Array(h),j=m.slice(0),w=new Uint32Array(j.buffer),C=k(j,u),b=C[0],A=C[1],f=m.length,o=new Uint8Array(f>>2);let O;if(m.length<2e7)for(var F=0;F<f;F+=4)O=S(b,M=m[F]*(1/255),$=m[F+1]*(1/255),z=m[F+2]*(1/255),G=m[F+3]*(1/255)),o[F>>2]=O.ind,w[F>>2]=O.est.rgba;else for(F=0;F<f;F+=4){var M=m[F]*.00392156862745098,$=m[F+1]*(1/255),z=m[F+2]*(1/255),G=m[F+3]*(1/255);for(O=b;O.left;)O=B(O.est,M,$,z,G)<=0?O.left:O.right;o[F>>2]=O.ind,w[F>>2]=O.est.rgba}return{abuf:j.buffer,inds:o,plte:A}}function k(h,u,m){m==null&&(m=1e-4);const j=new Uint32Array(h.buffer),w={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=P(h,w.i0,w.i1),w.est=v(w.bst);const C=[w];for(;C.length<u;){let A=0,f=0;for(var b=0;b<C.length;b++)C[b].est.L>A&&(A=C[b].est.L,f=b);if(A<m)break;const o=C[f],O=N(h,j,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=O||o.i1<=O){o.est.L=0;continue}const F={i0:o.i0,i1:O,bst:null,est:null,tdst:0,left:null,right:null};F.bst=P(h,F.i0,F.i1),F.est=v(F.bst);const M={i0:O,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(M.bst={R:[],m:[],N:o.bst.N-F.bst.N},b=0;b<16;b++)M.bst.R[b]=o.bst.R[b]-F.bst.R[b];for(b=0;b<4;b++)M.bst.m[b]=o.bst.m[b]-F.bst.m[b];M.est=v(M.bst),o.left=F,o.right=M,C[f]=F,C.push(M)}for(C.sort((A,f)=>f.bst.N-A.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[w,C]}function S(h,u,m,j,w){if(h.left==null)return h.tdst=function(F,M,$,z,G){const W=M-F[0],R=$-F[1],Z=z-F[2],oe=G-F[3];return W*W+R*R+Z*Z+oe*oe}(h.est.q,u,m,j,w),h;const C=B(h.est,u,m,j,w);let b=h.left,A=h.right;C>0&&(b=h.right,A=h.left);const f=S(b,u,m,j,w);if(f.tdst<=C*C)return f;const o=S(A,u,m,j,w);return o.tdst<f.tdst?o:f}function B(h,u,m,j,w){const{e:C}=h;return C[0]*u+C[1]*m+C[2]*j+C[3]*w-h.eMq}function N(h,u,m,j,w,C){for(j-=4;m<j;){for(;D(h,m,w)<=C;)m+=4;for(;D(h,j,w)>C;)j-=4;if(m>=j)break;const b=u[m>>2];u[m>>2]=u[j>>2],u[j>>2]=b,m+=4,j-=4}for(;D(h,m,w)>C;)m-=4;return m+4}function D(h,u,m){return h[u]*m[0]+h[u+1]*m[1]+h[u+2]*m[2]+h[u+3]*m[3]}function P(h,u,m){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=m-u>>2;for(let b=u;b<m;b+=4){const A=h[b]*.00392156862745098,f=h[b+1]*(1/255),o=h[b+2]*(1/255),O=h[b+3]*(1/255);w[0]+=A,w[1]+=f,w[2]+=o,w[3]+=O,j[0]+=A*A,j[1]+=A*f,j[2]+=A*o,j[3]+=A*O,j[5]+=f*f,j[6]+=f*o,j[7]+=f*O,j[10]+=o*o,j[11]+=o*O,j[15]+=O*O}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function v(h){const{R:u}=h,{m}=h,{N:j}=h,w=m[0],C=m[1],b=m[2],A=m[3],f=j==0?0:1/j,o=[u[0]-w*w*f,u[1]-w*C*f,u[2]-w*b*f,u[3]-w*A*f,u[4]-C*w*f,u[5]-C*C*f,u[6]-C*b*f,u[7]-C*A*f,u[8]-b*w*f,u[9]-b*C*f,u[10]-b*b*f,u[11]-b*A*f,u[12]-A*w*f,u[13]-A*C*f,u[14]-A*b*f,u[15]-A*A*f],O=o,F=_;let M=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,z=0;if(j!=0)for(let W=0;W<16&&(M=F.multVec(O,M),z=Math.sqrt(F.dot(M,M)),M=F.sml(1/z,M),!(W!=0&&Math.abs(z-$)<1e-9));W++)$=z;const G=[w*f,C*f,b*f,A*f];return{Cov:o,q:G,e:M,L:$,eMq255:F.dot(F.sml(255,G),M),eMq:F.dot(M,G),rgba:(Math.round(255*G[3])<<24|Math.round(255*G[2])<<16|Math.round(255*G[1])<<8|Math.round(255*G[0])<<0)>>>0}}var _={multVec:(h,u)=>[h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],h[4]*u[0]+h[5]*u[1]+h[6]*u[2]+h[7]*u[3],h[8]*u[0]+h[9]*u[1]+h[10]*u[2]+h[11]*u[3],h[12]*u[0]+h[13]*u[1]+h[14]*u[2]+h[15]*u[3]],dot:(h,u)=>h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],sml:(h,u)=>[h*u[0],h*u[1],h*u[2],h*u[3]]};Ne.encode=function(u,m,j,w,C,b,A){w==null&&(w=0),A==null&&(A=!1);const f=n(u,m,j,w,[!1,!1,!1,0,A,!1]);return y(f,-1),x(f,m,j,C,b)},Ne.encodeLL=function(u,m,j,w,C,b,A,f){const o={ctype:0+(w==1?0:2)+(C==0?0:4),depth:b,frames:[]},O=(w+C)*b,F=O*m;for(let M=0;M<u.length;M++)o.frames.push({rect:{x:0,y:0,width:m,height:j},img:new Uint8Array(u[M]),blend:0,dispose:1,bpp:Math.ceil(O/8),bpl:Math.ceil(F/8)});return y(o,0,!0),x(o,m,j,A,f)},Ne.encode.compress=n,Ne.encode.dither=a,Ne.quantize=T,Ne.quantize.getKDtree=k,Ne.quantize.getNearest=S})();const zn={toArrayBuffer(p,I){const E=p.width,c=p.height,e=E<<2,t=p.getContext("2d").getImageData(0,0,E,c),d=new Uint32Array(t.data.buffer),a=(32*E+31)/32<<2,x=a*c,y=122+x,n=new ArrayBuffer(y),r=new DataView(n),s=1<<20;let l,g,T,k,S=s,B=0,N=0,D=0;function P(h){r.setUint16(N,h,!0),N+=2}function v(h){r.setUint32(N,h,!0),N+=4}function _(h){N+=h}P(19778),v(y),_(4),v(122),v(108),v(E),v(-c>>>0),P(1),P(32),v(3),v(x),v(2835),v(2835),_(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),function h(){for(;B<c&&S>0;){for(k=122+B*a,l=0;l<e;)S--,g=d[D++],T=g>>>24,r.setUint32(k+l,g<<8|T),l+=4;B++}D<d.length?(S=s,setTimeout(h,zn._dly)):I(n)}()},toBlob(p,I){this.toArrayBuffer(p,E=>{I(new Blob([E],{type:"image/bmp"}))})},_dly:9};var Ue={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},$s={[Ue.CHROME]:16384,[Ue.FIREFOX]:11180,[Ue.DESKTOP_SAFARI]:16384,[Ue.IE]:8192,[Ue.IOS]:4096,[Ue.ETC]:8192};const gn=typeof window<"u",Wn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Mt=gn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Qs=(gn||Wn)&&(Mt&&Mt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),qn=(gn||Wn)&&(Mt&&Mt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function mn(p,I,E=Date.now()){return new Promise(c=>{const e=p.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let a=d.length;const x=new Uint8Array(a);for(;a--;)x[a]=d.charCodeAt(a);const y=new Blob([x],{type:t});y.name=I,y.lastModified=E,c(y)})}function $n(p){return new Promise((I,E)=>{const c=new qn;c.onload=()=>I(c.result),c.onerror=e=>E(e),c.readAsDataURL(p)})}function Qn(p){return new Promise((I,E)=>{const c=new Image;c.onload=()=>I(c),c.onerror=e=>E(e),c.src=p})}function nt(){if(nt.cachedResult!==void 0)return nt.cachedResult;let p=Ue.ETC;const{userAgent:I}=navigator;return/Chrom(e|ium)/i.test(I)?p=Ue.CHROME:/iP(ad|od|hone)/i.test(I)&&/WebKit/i.test(I)?p=Ue.IOS:/Safari/i.test(I)?p=Ue.DESKTOP_SAFARI:/Firefox/i.test(I)?p=Ue.FIREFOX:(/MSIE/i.test(I)||document.documentMode)&&(p=Ue.IE),nt.cachedResult=p,nt.cachedResult}function Vn(p,I){const E=nt(),c=$s[E];let e=p,t=I,d=e*t;const a=e>t?t/e:e/t;for(;d>c*c;){const x=(c+e)/2,y=(c+t)/2;x<y?(t=y,e=y*a):(t=x*a,e=x),d=e*t}return{width:e,height:t}}function Bt(p,I){let E,c;try{if(E=new OffscreenCanvas(p,I),c=E.getContext("2d"),c===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{E=document.createElement("canvas"),c=E.getContext("2d")}return E.width=p,E.height=I,[E,c]}function Gn(p,I){const{width:E,height:c}=Vn(p.width,p.height),[e,t]=Bt(E,c);return I&&/jpe?g/.test(I)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(p,0,0,e.width,e.height),e}function kt(){return kt.cachedResult!==void 0||(kt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),kt.cachedResult}function Ot(p,I={}){return new Promise(function(E,c){let e,t;var d=function(){try{return t=Gn(e,I.fileType||p.type),E([e,t])}catch(x){return c(x)}},a=function(x){try{var y=function(n){try{throw n}catch(r){return c(r)}};try{let n;return $n(p).then(function(r){try{return n=r,Qn(n).then(function(s){try{return e=s,function(){try{return d()}catch(l){return c(l)}}()}catch(l){return y(l)}},y)}catch(s){return y(s)}},y)}catch(n){y(n)}}catch(n){return c(n)}};try{if(kt()||[Ue.DESKTOP_SAFARI,Ue.MOBILE_SAFARI].includes(nt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(p).then(function(x){try{return e=x,d()}catch{return a()}},a)}catch{a()}})}function Nt(p,I,E,c,e=1){return new Promise(function(t,d){let a;if(I==="image/png"){let y,n,r;return y=p.getContext("2d"),{data:n}=y.getImageData(0,0,p.width,p.height),r=Ne.encode([n.buffer],p.width,p.height,4096*e),a=new Blob([r],{type:I}),a.name=E,a.lastModified=c,x.call(this)}{let y=function(){return x.call(this)};if(I==="image/bmp")return new Promise(n=>zn.toBlob(p,n)).then((function(n){try{return a=n,a.name=E,a.lastModified=c,y.call(this)}catch(r){return d(r)}}).bind(this),d);{let n=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&p instanceof OffscreenCanvas)return p.convertToBlob({type:I,quality:e}).then((function(r){try{return a=r,a.name=E,a.lastModified=c,n.call(this)}catch(s){return d(s)}}).bind(this),d);{let r;return r=p.toDataURL(I,e),mn(r,E,c).then((function(s){try{return a=s,n.call(this)}catch(l){return d(l)}}).bind(this),d)}}}function x(){return t(a)}})}function ze(p){p.width=0,p.height=0}function ct(){return new Promise(function(p,I){let E,c,e,t;return ct.cachedResult!==void 0?p(ct.cachedResult):mn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return E=d,Ot(E).then(function(a){try{return c=a[1],Nt(c,E.type,E.name,E.lastModified).then(function(x){try{return e=x,ze(c),Ot(e).then(function(y){try{return t=y[0],ct.cachedResult=t.width===1&&t.height===2,p(ct.cachedResult)}catch(n){return I(n)}},I)}catch(y){return I(y)}},I)}catch(x){return I(x)}},I)}catch(a){return I(a)}},I)})}function Yn(p){return new Promise((I,E)=>{const c=new qn;c.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return I(-2);const d=t.byteLength;let a=2;for(;a<d;){if(t.getUint16(a+2,!1)<=8)return I(-1);const x=t.getUint16(a,!1);if(a+=2,x==65505){if(t.getUint32(a+=2,!1)!=1165519206)return I(-1);const y=t.getUint16(a+=6,!1)==18761;a+=t.getUint32(a+4,y);const n=t.getUint16(a,y);a+=2;for(let r=0;r<n;r++)if(t.getUint16(a+12*r,y)==274)return I(t.getUint16(a+12*r+8,y))}else{if((65280&x)!=65280)break;a+=t.getUint16(a,!1)}}return I(-1)},c.onerror=e=>E(e),c.readAsArrayBuffer(p)})}function Zn(p,I){const{width:E}=p,{height:c}=p,{maxWidthOrHeight:e}=I;let t,d=p;return isFinite(e)&&(E>e||c>e)&&([d,t]=Bt(E,c),E>c?(d.width=e,d.height=c/E*e):(d.width=E/c*e,d.height=e),t.drawImage(p,0,0,d.width,d.height),ze(p)),d}function Kn(p,I){const{width:E}=p,{height:c}=p,[e,t]=Bt(E,c);switch(I>4&&I<9?(e.width=c,e.height=E):(e.width=E,e.height=c),I){case 2:t.transform(-1,0,0,1,E,0);break;case 3:t.transform(-1,0,0,-1,E,c);break;case 4:t.transform(1,0,0,-1,0,c);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,c,0);break;case 7:t.transform(0,-1,-1,0,c,E);break;case 8:t.transform(0,-1,1,0,0,E)}return t.drawImage(p,0,0,E,c),ze(p),e}function Cn(p,I,E=0){return new Promise(function(c,e){let t,d,a,x,y,n,r,s,l,g,T,k,S,B,N,D,P,v,_,h;function u(j=5){if(I.signal&&I.signal.aborted)throw I.signal.reason;t+=j,I.onProgress(Math.min(t,100))}function m(j){if(I.signal&&I.signal.aborted)throw I.signal.reason;t=Math.min(Math.max(j,t),100),I.onProgress(t)}return t=E,d=I.maxIteration||10,a=1024*I.maxSizeMB*1024,u(),Ot(p,I).then((function(j){try{return[,x]=j,u(),y=Zn(x,I),u(),new Promise(function(w,C){var b;if(!(b=I.exifOrientation))return Yn(p).then((function(f){try{return b=f,A.call(this)}catch(o){return C(o)}}).bind(this),C);function A(){return w(b)}return A.call(this)}).then((function(w){try{return n=w,u(),ct().then((function(C){try{return r=C?y:Kn(y,n),u(),s=I.initialQuality||1,l=I.fileType||p.type,Nt(r,l,p.name,p.lastModified,s).then((function(b){try{{let f=function(){if(d--&&(N>a||N>S)){let O,F;return O=h?.95*_.width:_.width,F=h?.95*_.height:_.height,[P,v]=Bt(O,F),v.drawImage(_,0,0,O,F),s*=l==="image/png"?.85:.95,Nt(P,l,p.name,p.lastModified,s).then(function(M){try{return D=M,ze(_),_=P,N=D.size,m(Math.min(99,Math.floor((B-N)/(B-a)*100))),f}catch($){return e($)}},e)}return[1]},o=function(){return ze(_),ze(P),ze(y),ze(r),ze(x),m(100),c(D)};if(g=b,u(),T=g.size>a,k=g.size>p.size,!T&&!k)return m(100),c(g);var A;return S=p.size,B=g.size,N=B,_=r,h=!I.alwaysKeepResolution&&T,(A=(function(O){for(;O;){if(O.then)return void O.then(A,e);try{if(O.pop){if(O.length)return O.pop()?o.call(this):O;O=f}else O=O.call(this)}catch(F){return e(F)}}}).bind(this))(f)}}catch(f){return e(f)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const Vs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Gt;function Gs(p,I){return new Promise((E,c)=>{Gt||(Gt=function(d){const a=[];return a.push(d),URL.createObjectURL(new Blob(a))}(Vs));const e=new Worker(Gt);e.addEventListener("message",function(d){if(I.signal&&I.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return c(new Error(d.data.error)),void e.terminate();E(d.data.file),e.terminate()}else I.onProgress(d.data.progress)}),e.addEventListener("error",c),I.signal&&I.signal.addEventListener("abort",()=>{c(I.signal.reason),e.terminate()}),e.postMessage({file:p,imageCompressionLibUrl:I.libURL,options:{...I,onProgress:void 0,signal:void 0}})})}function Ce(p,I){return new Promise(function(E,c){let e,t,d,a,x,y;if(e={...I},d=0,{onProgress:a}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=l=>{d=l,typeof a=="function"&&a(d)},!(p instanceof Blob||p instanceof Qs))return c(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(p.type))return c(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||y)return Cn(p,e).then((function(l){try{return t=l,s.call(this)}catch(g){return c(g)}}).bind(this),c);var n=(function(){try{return s.call(this)}catch(l){return c(l)}}).bind(this),r=function(l){try{return Cn(p,e).then(function(g){try{return t=g,n()}catch(T){return c(T)}},c)}catch(g){return c(g)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Gs(p,e).then(function(l){try{return t=l,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=p.name,t.lastModified=p.lastModified}catch{}try{e.preserveExif&&p.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===p.type)&&(t=Hn(p,t))}catch{}return E(t)}})}Ce.getDataUrlFromFile=$n,Ce.getFilefromDataUrl=mn,Ce.loadImage=Qn,Ce.drawImageInCanvas=Gn,Ce.drawFileInCanvas=Ot,Ce.canvasToFile=Nt,Ce.getExifOrientation=Yn,Ce.handleMaxWidthOrHeight=Zn,Ce.followExifOrientation=Kn,Ce.cleanupCanvasMemory=ze,Ce.isAutoOrientationInBrowser=ct,Ce.approximateBelowMaximumCanvasSizeOfBrowser=Vn,Ce.copyExifWithoutOrientation=Hn,Ce.getBrowserName=nt,Ce.version="2.0.2";var Yt,Sn;function Xn(){if(Sn)return Yt;Sn=1;function p(I){var E=typeof I;return I!=null&&(E=="object"||E=="function")}return Yt=p,Yt}var Zt,An;function Ys(){if(An)return Zt;An=1;var p=typeof Ft=="object"&&Ft&&Ft.Object===Object&&Ft;return Zt=p,Zt}var Kt,Tn;function Jn(){if(Tn)return Kt;Tn=1;var p=Ys(),I=typeof self=="object"&&self&&self.Object===Object&&self,E=p||I||Function("return this")();return Kt=E,Kt}var Xt,In;function Zs(){if(In)return Xt;In=1;var p=Jn(),I=function(){return p.Date.now()};return Xt=I,Xt}var Jt,Fn;function Ks(){if(Fn)return Jt;Fn=1;var p=/\s/;function I(E){for(var c=E.length;c--&&p.test(E.charAt(c)););return c}return Jt=I,Jt}var en,Un;function Xs(){if(Un)return en;Un=1;var p=Ks(),I=/^\s+/;function E(c){return c&&c.slice(0,p(c)+1).replace(I,"")}return en=E,en}var tn,kn;function es(){if(kn)return tn;kn=1;var p=Jn(),I=p.Symbol;return tn=I,tn}var nn,Dn;function Js(){if(Dn)return nn;Dn=1;var p=es(),I=Object.prototype,E=I.hasOwnProperty,c=I.toString,e=p?p.toStringTag:void 0;function t(d){var a=E.call(d,e),x=d[e];try{d[e]=void 0;var y=!0}catch{}var n=c.call(d);return y&&(a?d[e]=x:delete d[e]),n}return nn=t,nn}var sn,En;function er(){if(En)return sn;En=1;var p=Object.prototype,I=p.toString;function E(c){return I.call(c)}return sn=E,sn}var rn,Rn;function tr(){if(Rn)return rn;Rn=1;var p=es(),I=Js(),E=er(),c="[object Null]",e="[object Undefined]",t=p?p.toStringTag:void 0;function d(a){return a==null?a===void 0?e:c:t&&t in Object(a)?I(a):E(a)}return rn=d,rn}var an,_n;function nr(){if(_n)return an;_n=1;function p(I){return I!=null&&typeof I=="object"}return an=p,an}var on,Mn;function sr(){if(Mn)return on;Mn=1;var p=tr(),I=nr(),E="[object Symbol]";function c(e){return typeof e=="symbol"||I(e)&&p(e)==E}return on=c,on}var ln,On;function rr(){if(On)return ln;On=1;var p=Xs(),I=Xn(),E=sr(),c=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,d=/^0o[0-7]+$/i,a=parseInt;function x(y){if(typeof y=="number")return y;if(E(y))return c;if(I(y)){var n=typeof y.valueOf=="function"?y.valueOf():y;y=I(n)?n+"":n}if(typeof y!="string")return y===0?y:+y;y=p(y);var r=t.test(y);return r||d.test(y)?a(y.slice(2),r?2:8):e.test(y)?c:+y}return ln=x,ln}var dn,Nn;function ir(){if(Nn)return dn;Nn=1;var p=Xn(),I=Zs(),E=rr(),c="Expected a function",e=Math.max,t=Math.min;function d(a,x,y){var n,r,s,l,g,T,k=0,S=!1,B=!1,N=!0;if(typeof a!="function")throw new TypeError(c);x=E(x)||0,p(y)&&(S=!!y.leading,B="maxWait"in y,s=B?e(E(y.maxWait)||0,x):s,N="trailing"in y?!!y.trailing:N);function D(C){var b=n,A=r;return n=r=void 0,k=C,l=a.apply(A,b),l}function P(C){return k=C,g=setTimeout(h,x),S?D(C):l}function v(C){var b=C-T,A=C-k,f=x-b;return B?t(f,s-A):f}function _(C){var b=C-T,A=C-k;return T===void 0||b>=x||b<0||B&&A>=s}function h(){var C=I();if(_(C))return u(C);g=setTimeout(h,v(C))}function u(C){return g=void 0,N&&n?D(C):(n=r=void 0,l)}function m(){g!==void 0&&clearTimeout(g),k=0,n=T=r=g=void 0}function j(){return g===void 0?l:u(I())}function w(){var C=I(),b=_(C);if(n=arguments,r=this,T=C,b){if(g===void 0)return P(T);if(B)return clearTimeout(g),g=setTimeout(h,x),D(T)}return g===void 0&&(g=setTimeout(h,x)),l}return w.cancel=m,w.flush=j,w}return dn=d,dn}var ar=ir();const or=Fs(ar),lr=Je([i.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),i.jsx("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),dr=Je(i.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),cr=Je(i.jsx("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),ur=Je(i.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),fr=Je([i.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),i.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),gt=H.forwardRef(({path:p,initialImages:I=[],onImagesUpdated:E,onDelete:c,isOwnDesign:e},t)=>{const[d,a]=H.useState(I.map(o=>({...o,deleted:!1}))),[x,y]=H.useState(!1),[n,r]=H.useState(0),[s,l]=H.useState(!1),[g,T]=H.useState(null),[k,S]=H.useState(1),[B,N]=H.useState(!1),[D,P]=H.useState(!1),[v,_]=H.useState(""),[h,u]=H.useState("info"),m=H.useRef(null);H.useEffect(()=>{console.log("Initial images received:",I),a(I.map(o=>({...o,deleted:!!o.deleted})))},[I]);const j=async o=>{const O=Array.from(o.target.files||[]);y(!0);const F={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},M=O.map(async($,z)=>{let G=$;$.size>1024*1024&&(G=await Ce($,F),_("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),P(!0));const R=`${new Date().getTime()}-${G.name}`,Z=ut(),oe=ft(Z,`${p}/${R}`),ee=Pn(oe,G);return new Promise((te,re)=>{ee.on("state_changed",ie=>{const ue=ie.bytesTransferred/ie.totalBytes*100;r(ue)},ie=>{console.error("Upload failed:",ie),re(ie)},()=>{Ln(ee.snapshot.ref).then(ie=>{te({url:ie,path:oe.fullPath,title:""})})})})});Promise.all(M).then($=>{const z=[...d,...$];a(z),E&&E(z),_("Images uploaded successfully."),u("success"),P(!0),y(!1),r(0),m.current&&(m.current.value="")}).catch($=>{console.error("Error uploading images: ",$),_("Failed to upload images."),u("error"),P(!0),y(!1),r(0)})},w=o=>{a(O=>{const F=O.map((M,$)=>$===o?{...M,deleted:!0}:M);return E(F),F}),_("Image marked for deletion. Update to permanently delete."),u("info"),P(!0)},C=async()=>{const o=d.filter(O=>O.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const O=o.map(F=>{const M=ut(),$=ft(M,F.path);return Ut($)});try{await Promise.all(O),c(o),a(F=>F.filter(M=>!M.deleted)),_("Deleted images have been permanently removed."),u("success")}catch(F){console.error("Error committing deletions:",F),_("Failed to commit deletions."),u("error")}P(!0)}else console.log("No images marked for deletion.")},b=o=>{N(!B),T(o)};H.useEffect(()=>{const o=()=>{const O=!!document.fullscreenElement;N(O)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const A=(o,O)=>{O!=="clickaway"&&P(!1)},f=H.useCallback(or((o,O)=>{setTimeout(()=>{a(F=>{const M=F.map(($,z)=>z===o?{...$,title:O}:$);return E&&E(M),M})},0)},30),[E]);return H.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Dt,{title:"Upload Images",children:i.jsxs(je,{variant:"outlined",component:"label",startIcon:i.jsx(fr,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:x,ref:m,accept:"image/*"})]})}),x&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),d.filter(o=>!o.deleted).map((o,O)=>i.jsxs("div",{children:[i.jsx("img",{src:o.url,alt:`Uploaded design ${O}`,onClick:()=>{l(!0),T(O)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(_e,{onClick:()=>w(O),children:i.jsx(jt,{})}),i.jsx("textarea",{value:o.title,onChange:F=>f(O,F.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},O)),i.jsx(st,{open:s,onClose:()=>l(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:g!==null&&i.jsxs(rt,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:d[g].url,alt:`Zoomed Design ${g}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(_e,{onClick:()=>S(k*1.2),children:i.jsx(lr,{})}),i.jsx(_e,{onClick:()=>S(k/1.2),style:{marginLeft:"10px"},children:i.jsx(dr,{})}),i.jsx(_e,{onClick:()=>b(g),style:{marginLeft:"10px"},children:i.jsx(cr,{})}),B&&i.jsx(_e,{onClick:()=>b(g),style:{position:"absolute",top:20,right:20},children:i.jsx(ur,{})})]})]})}),i.jsx(it,{open:D,autoHideDuration:6e3,onClose:A,children:i.jsx(at,{onClose:A,severity:h,sx:{width:"100%"},children:v})})]})}),We=({onChange:p,initialValue:I})=>{const[E,c]=H.useState(Vt.sanitize(I||"")),e=H.useRef(!1),t=H.useRef(null),[d,a]=H.useState("");H.useEffect(()=>{e.current?c(Vt.sanitize(I||"")):e.current=!0},[I]);const x=(l,g)=>{const T=g.getData(),k=Vt.sanitize(T);c(k),p(k)},y=l=>{if(!t.current){console.warn("Editor not initialized");return}const g=t.current;g.model.change(T=>{const k=g.model.document.selection.getFirstPosition();T.insertText(l,k)}),a("")},n=l=>{y(l.target.value)},r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],s=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return i.jsxs("div",{children:[i.jsxs(tt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[i.jsx(Us,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(wn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Et,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:n,displayEmpty:!0,children:[i.jsx(dt,{value:"",disabled:!0,children:"Math"}),s.map(l=>i.jsx(dt,{value:l,children:l},l))]})}),i.jsx(wn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Et,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:n,displayEmpty:!0,children:[i.jsx(dt,{value:"",disabled:!0,children:"Greek"}),r.map(l=>i.jsx(dt,{value:l,children:l},l))]})})]}),i.jsx(ks.CKEditor,{editor:Ds,data:E,onReady:l=>{t.current=l},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:x})]})},hr=Je(i.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),gr=Je(i.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),mt=({path:p,initialFiles:I,onFilesChange:E,isOwnDesign:c})=>{const[e,t]=H.useState(I.map(m=>({...m,deleted:!!m.deleted}))),[d,a]=H.useState(!1),[x,y]=H.useState(0),[n,r]=H.useState({}),[s,l]=H.useState(!1),[g,T]=H.useState(""),[k,S]=H.useState("info"),B=H.useRef(null);H.useEffect(()=>{console.log("Initial files received:",I),t(I.map(m=>({...m,deleted:!!m.deleted})))},[I]),H.useEffect(()=>()=>{r({})},[]);const N=m=>{console.log("Updating files with",m),E(m),t(m)},D=async m=>{if(!m.target.files)return;const w=Array.from(m.target.files).filter(b=>b.size>5242880?(T("File size should not exceed 5 MB"),S("error"),l(!0),!1):!0);a(!0);const C=w.map(b=>{const A=new Date().getTime(),f=`${A}-${b.name}`,o=ut(),O=ft(o,`${p}/${f}`),F=Pn(O,b);return new Promise((M,$)=>{F.on("state_changed",z=>{const G=z.bytesTransferred/z.totalBytes*100;y(G)},z=>{console.error("Upload failed:",z),$(z)},()=>{Ln(F.snapshot.ref).then(z=>{M({id:A.toString(),url:z,name:b.name,path:O.fullPath})})})})});Promise.all(C).then(b=>{const A=[...e.filter(f=>!f.deleted),...b];N(A),T("Files uploaded successfully."),S("success"),l(!0),a(!1),y(0),B.current&&(B.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),T("Failed to upload files."),S("error"),l(!0),a(!1),y(0)})},P=m=>{const j=e.map(w=>w.id===m?{...w,deleted:!0}:w);N(j),T("File marked for deletion. Update to permanently delete."),S("info"),l(!0)},v=m=>{r(j=>{var w;return{...j,[m]:((w=e.find(C=>C.id===m))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},_=m=>{t(j=>{const w=j.map(C=>C.id===m&&n[m]!==void 0?{...C,name:n[m]}:C);return E(w),w}),r(j=>{const w={...j};return delete w[m],w}),T("File name updated successfully."),S("info"),l(!0)},h=(m,j)=>{r(w=>({...w,[m]:j}))},u=(m,j)=>{j!=="clickaway"&&l(!1)};return i.jsxs("div",{children:[c&&i.jsx(Dt,{title:"Upload Files",children:i.jsxs(je,{variant:"outlined",component:"label",startIcon:i.jsx(gr,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:D,disabled:d,ref:B})]})}),d&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(x),"%"]})}),i.jsx(Es,{children:e.map(m=>i.jsxs(Rs,{component:"div",disabled:m.deleted,children:[i.jsx(Ps,{children:i.jsx(hr,{})}),typeof n[m.id]=="string"?i.jsx(Rt,{variant:"outlined",size:"small",value:n[m.id],onChange:j=>h(m.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&_(m.id),fullWidth:!0}):i.jsx(_s,{primary:m.name,secondary:i.jsx("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),c&&(typeof n[m.id]=="string"?i.jsx(_e,{onClick:()=>_(m.id),edge:"end","aria-label":"save",children:i.jsx(un,{})}):i.jsxs(i.Fragment,{children:[i.jsx(_e,{onClick:()=>v(m.id),edge:"end","aria-label":"edit",children:i.jsx(Bn,{})}),i.jsx(_e,{onClick:()=>P(m.id),edge:"end","aria-label":"delete",children:i.jsx(jt,{})})]}))]},m.id))}),i.jsx(it,{open:s,autoHideDuration:6e3,onClose:u,children:i.jsx(at,{onClose:u,severity:k,sx:{width:"100%"},children:g})})]})},mr=({designs:p,setDesigns:I,setIsAdding:E,getDesigns:c,onReturnToDashboard:e})=>{const{userDetails:t}=Ct();console.log("Add Design loaded");const[d,a]=H.useState(""),[x,y]=H.useState(""),[n,r]=H.useState(""),[s,l]=H.useState([]),[g,T]=H.useState([]),k=H.useMemo(()=>s,[s]),[S,B]=H.useState(!1),[N,D]=H.useState(""),[P,v]=H.useState("info"),[_,h]=H.useState(!1),[u,m]=H.useState("");console.log("Adding New Design from user:",t);const j=H.useRef(null),w=()=>{h(!1)},C=(A,f)=>{f!=="clickaway"&&B(!1)};H.useEffect(()=>{if(t!=null&&t.classes){const A=Object.keys(t.classes)[0];y(A||"")}},[t==null?void 0:t.classes]);const b=async A=>{var F;if(A.preventDefault(),console.log("Files to be saved:",g),!t||!t.uid){console.error("User object is undefined or missing UID."),m("You must be signed in to add a design."),h(!0);return}if(!d){m("All fields are required."),h(!0);return}await((F=j.current)==null?void 0:F.commitDeletions());const f=s.filter(M=>!M.deleted),o=g.filter(M=>!M.deleted).map(M=>({id:M.id,url:M.url,name:M.name,path:M.path})),O={title:n,description:d,course:x,dateCreated:wt(),dateModified:wt(),images:f,files:o,userId:t.uid};try{const M=await hn(ye(J,"designs"),O),$={...O,id:M.id};I([...p,$]),D(`${n} has been Added.`),v("success"),B(!0),r(""),a(""),l([]),T([]),setTimeout(()=>{E(!1),c()},1e3)}catch(M){console.log(M),m("There was an issue adding your design."),h(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx(je,{variant:"text",onClick:e,className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:b,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsx("div",{style:{display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:A=>r(A.target.value),style:{width:"100%"}})]})}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Et,{id:"course",value:x,onChange:A=>y(A.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([A,f])=>i.jsx(dt,{value:A,children:`${f.number} - ${f.title}`},A))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(We,{onChange:a,initialValue:d}),i.jsx(gt,{ref:j,path:"designs/images",initialImages:k,onImagesUpdated:l,onDelete:A=>l(s.filter(f=>!A.includes(f)))}),i.jsx(mt,{path:"designs/files",initialFiles:g,onFilesChange:T}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(je,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(je,{onClick:()=>E(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(st,{open:_,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(pt,{id:"alert-dialog-title",children:"Notification"}),i.jsx(rt,{children:i.jsx(St,{id:"alert-dialog-description",children:u})}),i.jsx(bt,{children:i.jsx(je,{onClick:w,autoFocus:!0,children:"Ok"})})]}),i.jsx(it,{open:S,autoHideDuration:1e3,onClose:C,children:i.jsx(at,{onClose:C,severity:P,sx:{width:"100%"},children:N})})]})},pr=({designId:p,setIsAddingBuild:I,refreshBuilds:E})=>{const[c,e]=H.useState(""),[t,d]=H.useState(""),[a,x]=H.useState([]),[y,n]=H.useState([]),{userDetails:r}=Ct(),s=j=>{x(j)},l=j=>{n(j)};console.log("AddBuild loaded");const[g,T]=H.useState(!1),[k,S]=H.useState(""),[B,N]=H.useState(!1),[D,P]=H.useState(""),[v,_]=H.useState("info");console.log("Adding New Build by user:",r);const h=()=>{T(!1)},u=(j,w)=>{w!=="clickaway"&&N(!1)},m=async j=>{if(j.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),T(!0);return}if(!t){S("Build description is required."),T(!0);return}const w=a.filter(b=>!b.deleted),C=y.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await hn(ye(J,"builds"),{title:c,description:t,design_ID:p,dateCreated:wt(),userId:r.uid,images:w,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",r),P("Your build has been successfully added."),_("success"),N(!0),setTimeout(()=>{e(""),d(""),x([]),n([]),I(!1),E()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let A=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(A="You do not have permission to perform this operation."),P(A),_("error"),N(!0)}else P("Failed to add the build. Please try again later."),_("error"),N(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:m,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:c,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(We,{onChange:d,initialValue:t})," ",i.jsx(gt,{path:`builds/${p}/images`,initialImages:a,onImagesUpdated:s}),i.jsx(mt,{path:`builds/${p}/files`,initialFiles:y,onFilesChange:l}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>I(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(st,{open:g,onClose:h,children:[i.jsx(pt,{children:"Notification"}),i.jsx(rt,{children:i.jsx(St,{children:k})}),i.jsx(bt,{children:i.jsx(je,{onClick:h,children:"OK"})})]}),i.jsx(it,{open:B,autoHideDuration:6e3,onClose:u,children:i.jsx(at,{onClose:u,severity:v,sx:{width:"100%"},children:D})})]})},br=({designId:p,buildId:I,refreshTests:E,setAddingTestIdForBuild:c})=>{const[e,t]=H.useState(""),[d,a]=H.useState(""),[x,y]=H.useState(""),[n,r]=H.useState(""),[s,l]=H.useState([]),[g,T]=H.useState([]),{userDetails:k}=Ct();console.log("AddTest loaded");const[S,B]=H.useState(!1),[N,D]=H.useState(""),[P,v]=H.useState(!1),[_,h]=H.useState(""),[u,m]=H.useState("info"),j=C=>{T(C)},w=async()=>{if(!d){D("Test description cannot be empty!"),B(!0);return}const C=s.filter(A=>!A.deleted),b=g.filter(A=>!A.deleted).map(A=>({id:A.id,url:A.url,name:A.name,path:A.path}));try{await hn(ye(J,"tests"),{title:e,build_ID:I,design_ID:p,dateCreated:wt(),description:d,results:x,conclusions:n,userId:k==null?void 0:k.uid,images:C,files:b}),setTimeout(()=>{E(I),t(""),a(""),y(""),r(""),l([]),T([]),c(!1)},1e3),h("Test added successfully"),m("success"),v(!0)}catch(A){console.error("Error adding test: ",A),h("Failed to add the test"),m("error"),v(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(We,{onChange:a,initialValue:d}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(We,{onChange:y,initialValue:x}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(We,{onChange:r,initialValue:n}),i.jsx(gt,{path:`tests/${I}/images`,initialImages:s,onImagesUpdated:C=>{l(C)}}),i.jsx(mt,{path:`tests/${I}/files`,initialFiles:g,onFilesChange:j}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>c(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(st,{open:S,onClose:()=>B(!1),children:[i.jsx(pt,{children:"Notification"}),i.jsx(rt,{children:i.jsx(St,{children:N})}),i.jsx(bt,{children:i.jsx(je,{onClick:()=>B(!1),children:"OK"})})]}),i.jsx(it,{open:P,autoHideDuration:6e3,onClose:()=>v(!1),children:i.jsx(at,{onClose:()=>v(!1),severity:u,sx:{width:"100%"},children:_})})]})},cn=Je(i.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),yt=p=>p&&p instanceof fn?p.toDate().toLocaleString():"",xr=({selectedDesign:p,setIsEditing:I,getDesigns:E,onReturnToDashboard:c})=>{const{userDetails:e,loading:t}=Ct(),d=p.id,a=p.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",d),console.log("Editing Design by user:",e);const[x,y]=H.useState(""),[n,r]=H.useState(p.description),[s,l]=H.useState(p.course||""),[g,T]=H.useState(yt(p.dateCreated)),[k,S]=H.useState(yt(p.dateModified)),[B,N]=H.useState([]),[D,P]=H.useState([]),v=H.useRef(null),[_,h]=H.useState(!1),[u,m]=H.useState([]),[j,w]=H.useState({}),[C,b]=H.useState({}),[A,f]=H.useState({}),o=H.useRef(null),[O,F]=H.useState({}),[M,$]=H.useState({}),[z,G]=H.useState({}),[W,R]=H.useState(!1),[Z,oe]=H.useState({}),[ee,te]=H.useState({}),[re,ie]=H.useState({}),[ue,Ee]=H.useState({}),[Se,le]=H.useState({}),me=H.useRef(null),[de,ce]=H.useState({}),[ge,xe]=H.useState({}),[fe,we]=H.useState({}),[he,ne]=H.useState(!1),[Ae,ke]=H.useState(""),[ot,pe]=H.useState(()=>{}),[qe,X]=H.useState(!1),[De,se]=H.useState(""),[Me,ae]=H.useState("info"),[Re,Ie]=H.useState({design:!1,builds:!1,tests:!1}),Pt=async U=>{if(U.preventDefault(),!n){ke("All fields are required."),ne(!0);return}console.log("About to check image deletions",v.current),console.log(v.current),console.log(B.some(Q=>Q.deleted)),v.current&&B.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await v.current.commitDeletions());const q=B.filter(Q=>!Q.deleted);D.some(Q=>Q.deleted)&&await et();const L=D.filter(Q=>!Q.deleted);let Y={title:x,description:n,course:s,dateModified:wt(),images:q.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:L.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:e.uid};try{await Ke(ve(J,"designs",d),Y,{merge:!0}),se("Your design has been updated."),ae("success"),X(!0);const Q=fn.now();S(yt(Q))}catch(Q){console.error("Error updating design:",Q),se("There was an issue updating your design."),ae("error"),X(!0)}Ie(Q=>({...Q,design:!1}))};H.useEffect(()=>{p&&(r(p.description||""),y(p.title||""),l(p.course||""),(async()=>{const q=ve(J,"designs",d),L=await Ms(q);if(L.exists()){const Y=L.data();console.log("Fetched images:",Y.images),console.log("Fetched files:",Y.files),N(Y.images||[]),P(Y.files||[]),T(yt(Y.dateCreated)),S(yt(Y.dateModified))}})())},[p,d]);const xt=U=>{const q=B.filter(Y=>!U.some(Q=>Q.path===Y.path));console.log("Remaining images after deletion:",q),N(q);const L=q.map(Y=>({url:Y.url,title:Y.title,path:Y.path}));Ke(ve(J,"designs",d),{images:L},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Y=>console.error("Failed to update Firestore:",Y))},At=U=>{JSON.stringify(B)!==JSON.stringify(U)&&(N(U),console.log("Updated images received:",U))},et=async()=>{const U=D.filter(q=>q.deleted);if(console.log("Files to delete:",U),U.length>0){const q=ut(),L=U.map(Y=>{const Q=ft(q,Y.path);return Ut(Q)});try{await Promise.all(L),console.log("Files deleted successfully");const Y=D.filter(Q=>!Q.deleted);P(Y),await Qt(ve(J,"designs",p.id),{files:Y.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),se("Deleted files have been permanently removed."),ae("success"),X(!0)}catch(Y){console.error("Failed to delete files: ",Y),se("Failed to delete files."),ae("error"),X(!0)}}},Lt=async U=>{var Q,K;try{await ts(U)}catch(V){console.error("Error deleting files:",V),se("Failed to delete build files."),ae("error"),X(!0)}const q=((Q=C[U])==null?void 0:Q.filter(V=>!V.deleted).map(({url:V,path:Oe,title:Ge})=>({url:V,path:Oe,title:Ge})))||[],L=((K=A[U])==null?void 0:K.filter(V=>!V.deleted).map(V=>({id:V.id,url:V.url,name:V.name,path:V.path})))||[],Y={};q.length>0&&(Y.images=q),L.length>0&&(Y.files=L),j[U]!==void 0&&(Y.description=j[U]);try{const V=ve(J,"builds",U);await Ke(V,Y,{merge:!0}),se("Your build has been updated."),ae("success"),X(!0),He(),Ie(Oe=>({...Oe,builds:!1}))}catch(V){console.error("Error updating build:",V),se("Failed to update build."),ae("error"),X(!0)}},Pe=(U,q)=>{$(L=>({...L,[U]:q}))},Le=(U,q)=>{w(L=>({...L,[U]:q})),Ie(L=>({...L,builds:!0}))},$e=async U=>{const q=M[U];try{const L=ve(J,"builds",U);await Ke(L,{title:q},{merge:!0}),$(Y=>{const Q={...Y};return delete Q[U],Q}),He()}catch(L){console.error("Failed to save build title:",L)}},He=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",p==null?void 0:p.id);let U;e.isAdmin?U=Fe(ye(J,"builds"),be("design_ID","==",d),Be("dateCreated")):U=Fe(ye(J,"builds"),be("design_ID","==",d),be("userId","==",e.uid),Be("dateCreated")),console.log("Builds query details:",JSON.stringify(U,null,2));const q=await Xe(U);console.log("Builds snapshot details:",JSON.stringify(q.docs.map(Y=>Y.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",q.docs.length);const L=q.docs.map(Y=>(console.log("Build doc path: ",Y.ref.path),{id:Y.id,...Y.data()}));m(L),console.log("New builds state after refresh:",L)}catch(U){console.error("Error refreshing builds:",U),U.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",U):console.error("An unexpected error occurred when trying to refresh builds:",U)}},Tt=(U,q)=>{const L=ve(J,"builds",U),Y=C[U].filter(K=>!q.some(V=>V.path===K.path));b(K=>({...K,[U]:Y}));const Q=Y.map(K=>({url:K.url,title:K.title,path:K.path}));Ke(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),se("Build Image deletions updated."),ae("success")}).catch(K=>{console.error("Failed to update build images in Firestore:",K),se("Failed to update build image deletions."),ae("error")}),X(!0)},Qe=async U=>{const q=Fe(ye(J,"tests"),be("build_ID","==",U),be("userId","==",e.uid)),L=await Xe(q);for(const Y of L.docs)await ht(ve(J,"tests",Y.id));await ht(ve(J,"builds",U)),await He(),se("Build and its tests (if any) deleted successfully."),ae("success"),X(!0)},Ve=U=>{ke("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),pe(()=>()=>Qe(U)),ne(!0)},pn=(U,q)=>{b(L=>({...L,[U]:q}))},bn=(U,q)=>{f(L=>({...L,[U]:q}))},ts=async U=>{var L;const q=((L=A[U])==null?void 0:L.filter(Y=>Y.deleted))||[];if(console.log("Build files to delete:",q),q.length>0){const Y=ut(),Q=q.map(K=>{const V=ft(Y,K.path);return Ut(V)});try{await Promise.all(Q),console.log("Build files deleted successfully");const K=A[U].filter(V=>!V.deleted);f(V=>({...V,[U]:K})),await Qt(ve(J,"builds",U),{files:K.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path}))}),console.log("Firestore successfully updated to remove deleted files"),se("Deleted build files have been permanently removed."),ae("success"),X(!0)}catch(K){console.error("Failed to delete build files: ",K),se("Failed to delete build files."),ae("error"),X(!0)}}},ns=async(U,q)=>{var K;try{await ls(U)}catch(V){console.error("Error deleting files:",V),se("Failed to delete build files."),ae("error"),X(!0)}const L={},Y=ue[U].filter(V=>!V.deleted).map(({url:V,path:Oe,title:Ge})=>({url:V,path:Oe,title:Ge})),Q=((K=Se[U])==null?void 0:K.filter(V=>!V.deleted).map(V=>({id:V.id,url:V.url,name:V.name,path:V.path})))||[];Z[U]!==void 0&&(L.description=Z[U]),ee[U]!==void 0&&(L.results=ee[U]),re[U]!==void 0&&(L.conclusions=re[U]),L.images=Y,L.files=Q;try{const V=ve(J,"tests",U);await Ke(V,L,{merge:!0}),se("Your test has been updated."),ae("success"),X(!0),It(q)}catch(V){console.error(`Error updating test ID: ${U}:`,V),se("There was an issue updating your test."),ae("error"),X(!0)}},ss=(U,q)=>{xe(L=>({...L,[U]:q}))},xn=async(U,q)=>{const L=ge[U],Y=ve(J,"tests",U);await Ke(Y,{title:L},{merge:!0}),xe(Q=>{const K={...Q};return delete K[U],K}),It(q)},rs=(U,q)=>{console.log(`Updating description for test ID ${U}:`,q),oe(L=>({...L,[U]:q})),Ie(L=>({...L,tests:!0}))},is=(U,q)=>{console.log(`Updating results for test ID ${U}:`,q),te(L=>({...L,[U]:q})),Ie(L=>({...L,tests:!0}))},as=(U,q)=>{ie(L=>({...L,[U]:q})),Ie(L=>({...L,tests:!0}))};H.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let q;e.isAdmin?q=Fe(ye(J,"builds"),be("design_ID","==",d),Be("dateCreated")):q=Fe(ye(J,"builds"),be("design_ID","==",d),be("userId","==",e.uid),Be("dateCreated"));const L=await Xe(q);let Y=[],Q={},K={};for(const V of L.docs){const Oe=V.data(),Ge=V.id;Y.push({id:Ge,...Oe,images:Oe.images||[],files:Oe.files||[]}),K[Ge]=!0;let Ht;e.isAdmin?Ht=Fe(ye(J,"tests"),be("build_ID","==",Ge),Be("dateCreated")):Ht=Fe(ye(J,"tests"),be("build_ID","==",Ge),be("userId","==",e.uid),Be("dateCreated"));const hs=await Xe(Ht);let jn=[],zt={},Wt={};for(const Ze of hs.docs){const Ye=Ze.data();jn.push({id:Ze.id,...Ye}),zt[Ze.id]=Ye.images||[],Wt[Ze.id]=Ye.files||[]}Q[Ge]=jn,Ee(Ze=>{let Ye={...Ze};for(const vt in zt)Ye[vt]=zt[vt];return Ye}),le(Ze=>{let Ye={...Ze};for(const vt in Wt)Ye[vt]=Wt[vt];return Ye})}m(Y),G(Q),we(K)})()},[t,e,p.id,d]);const It=async U=>{if(!e){console.log("User details not loaded yet");return}try{let q;e.isAdmin?q=Fe(ye(J,"tests"),be("build_ID","==",U),Be("dateCreated")):q=Fe(ye(J,"tests"),be("build_ID","==",U),be("userId","==",e.uid),Be("dateCreated"));const Y=(await Xe(q)).docs.map(V=>({id:V.id,...V.data(),images:V.data().images||[],files:V.data().files||[]}));G(V=>({...V,[U]:Y}));let Q={},K={};Y.forEach(V=>{Q[V.id]=V.images,K[V.id]=V.files}),Ee(Q),le(K)}catch(q){console.error("Error fetching tests:",q)}},os=(U,q)=>{const L=ve(J,"tests",U),Y=ue[U].filter(K=>!q.includes(K));Ee(K=>({...K,[U]:Y}));const Q=Y.map(({url:K,path:V,title:Oe})=>({url:K,path:V,title:Oe}));Ke(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),se("Test Image deletions updated."),ae("success")}).catch(K=>{console.error("Failed to update test images in Firestore:",K),se("Failed to update test image deletions."),ae("error")}),X(!0)},vn=(U,q)=>{Ee(L=>({...L,[U]:q}))},yn=(U,q)=>{le(L=>({...L,[U]:q}))},ls=async U=>{var L;const q=((L=Se[U])==null?void 0:L.filter(Y=>Y.deleted))||[];if(q.length>0){const Y=ut(),Q=q.map(K=>{const V=ft(Y,K.path);return Ut(V)});try{await Promise.all(Q);const K=Se[U].filter(V=>!V.deleted);le(V=>({...V,[U]:K})),await Qt(ve(J,"tests",U),{files:K.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path}))}),se("Deleted test files have been permanently removed."),ae("success"),X(!0)}catch(K){console.error("Failed to delete test files: ",K),se("Failed to delete test files."),ae("error"),X(!0)}}},ds=async(U,q)=>{await ht(ve(J,"tests",U)),await It(q),se("Test deleted successfully."),ae("success"),X(!0)},cs=(U,q)=>{ke("Are you sure you want to delete this test? This action cannot be undone."),pe(()=>()=>ds(U,q)),ne(!0)},us=U=>{we(q=>({...q,[U]:!q[U]}))},fs=()=>{const U=Object.entries(Re).filter(([L,Y])=>Y).map(([L])=>L).join(", ");if(!U.length){c();return}const q=`You have unsaved changes in the following sections: ${U}. Are you sure you want to leave?`;ke(q),pe(()=>()=>{Ie({design:!1,builds:!1,tests:!1}),c()}),ne(!0)};return H.useEffect(()=>{const U=q=>{Object.values(Re).some(Y=>Y)&&(q.preventDefault(),q.returnValue="")};return window.addEventListener("beforeunload",U),()=>window.removeEventListener("beforeunload",U)},[Re]),i.jsxs("div",{className:"small-container",children:[i.jsx(je,{variant:"text",onClick:()=>{Object.values(Re).some(q=>q)?fs():c()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:Pt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:x,onChange:U=>{y(U.target.value),Ie(q=>({...q,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:g||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:k||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Et,{id:"course",value:s,onChange:U=>{l(U.target.value),Ie(q=>({...q,design:!0}))},fullWidth:!0,children:(e!=null&&e.classes?Object.entries(e.classes):[]).map(([U,q])=>i.jsx(dt,{value:U,children:`${q.number} - ${q.title}`},U))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(We,{initialValue:n,onChange:U=>{r(U),Ie(q=>({...q,design:!0}))}}),i.jsx(gt,{ref:v,path:`designs/${p.id}/images`,initialImages:B,onImagesUpdated:At,onDelete:xt,isOwnDesign:a}),i.jsx(mt,{path:`designs/${p.id}/files`,initialFiles:D,onFilesChange:P,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>I(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{h(!0),setTimeout(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),u.map((U,q)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:M[U.id]!==void 0?i.jsx(Rt,{variant:"outlined",size:"small",fullWidth:!0,value:M[U.id],onChange:L=>Pe(U.id,L.target.value),onBlur:()=>$e(U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(_e,{onClick:()=>$e(U.id),size:"small",children:i.jsx(un,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>$(L=>({...L,[U.id]:U.title||`Build ${q+1}`})),style:{cursor:"pointer"},children:U.title||`Build ${q+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>F(L=>({...L,[U.id]:!L[U.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:O[U.id]?i.jsx(cn,{}):i.jsx($t,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ve(U.id),children:i.jsx(jt,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{R(U.id),setTimeout(()=>{me.current&&me.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),O[U.id]&&i.jsxs(i.Fragment,{children:[i.jsx(We,{initialValue:j[U.id]||U.description,onChange:L=>{Le(U.id,L)}}),i.jsx(gt,{path:`builds/${U.id}/images`,initialImages:U.images,onImagesUpdated:L=>pn(U.id,L),onDelete:L=>Tt(U.id,L),isOwnDesign:a}),i.jsx(mt,{path:`builds/${U.id}/files`,initialFiles:U.files,onFilesChange:L=>bn(U.id,L),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Lt(U.id),children:"Update"})}),i.jsx("div",{children:z[U.id]&&z[U.id].length>0&&i.jsx("button",{onClick:()=>us(U.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:fe[U.id]?i.jsxs(i.Fragment,{children:[i.jsx($t,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(cn,{style:{marginRight:"8px"}}),"Tests"]})})}),!fe[U.id]&&z[U.id]&&z[U.id].map((L,Y)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:ge[L.id]!==void 0?i.jsx(Rt,{variant:"outlined",size:"small",fullWidth:!0,value:ge[L.id],onChange:Q=>ss(L.id,Q.target.value),onBlur:()=>xn(L.id,U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(_e,{onClick:()=>xn(L.id,U.id),size:"small",children:i.jsx(un,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>xe(Q=>({...Q,[L.id]:L.title||`Test ${Y+1}`})),style:{cursor:"pointer"},children:L.title||`Test ${Y+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>ce(Q=>({...Q,[L.id]:!Q[L.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:de[L.id]?i.jsx(cn,{}):i.jsx($t,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>cs(L.id,U.id),children:i.jsx(jt,{})})]})]}),de[L.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(We,{initialValue:Z[L.id]||L.description,onChange:Q=>{rs(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(We,{initialValue:ee[L.id]||L.results,onChange:Q=>{is(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(We,{initialValue:re[L.id]||L.conclusions,onChange:Q=>{as(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(gt,{path:`tests/${L.id}/images`,initialImages:ue[L.id]||[],onImagesUpdated:Q=>vn(L.id,Q),onDelete:Q=>os(L.id,Q),isOwnDesign:a}),i.jsx(mt,{path:`tests/${L.id}/files`,initialFiles:Se[L.id]||[],onFilesChange:Q=>yn(L.id,Q),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>ns(L.id,U.id),children:"Update"})})]})]},L.id))]}),W===U.id&&i.jsxs("div",{className:"new-test-record",ref:me,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(br,{designId:p.id,buildId:U.id,refreshTests:()=>It(U.id),setAddingTestIdForBuild:R,onImagesUpdated:L=>vn(U.id,L),onFilesChange:L=>yn(U.id,L)})]})]},U.id)),i.jsx("div",{children:_&&i.jsxs("div",{className:"new-build-record",ref:o,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(pr,{designId:p.id,setIsAddingBuild:h,refreshBuilds:He,onImagesUpdated:U=>pn(build.id,U),onFilesChange:U=>bn(build.id,U)})]})})]}),i.jsxs(st,{open:he,onClose:()=>ne(!1),children:[i.jsx(pt,{children:"Confirmation Required"}),i.jsx(rt,{children:i.jsx(St,{children:Ae})}),i.jsxs(bt,{children:[i.jsx(je,{onClick:()=>ne(!1),children:"Cancel"}),i.jsx(je,{onClick:()=>{ot(),ne(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(it,{open:qe,autoHideDuration:6e3,onClose:()=>X(!1),children:i.jsx(at,{onClose:()=>X(!1),severity:Me,sx:{width:"100%"},children:De})})]})},vr=()=>{const{userDetails:p,loading:I}=Ct();console.log("Dashboard loaded");const[E,c]=H.useState([]),[e,t]=H.useState([]),[d,a]=H.useState([]),[x,y]=H.useState(null),[n,r]=H.useState(!1),[s,l]=H.useState(!1),[g,T]=H.useState(!1),[k,S]=H.useState(""),[B,N]=H.useState(""),[D,P]=H.useState(!1),[v,_]=H.useState(null),[h,u]=H.useState(!1),[m,j]=H.useState(""),[w,C]=H.useState("info"),b=()=>{l(!1),r(!1),y(null),A()},A=H.useCallback(async()=>{if(!p)return;let F;const M=[],$=[],z=[];if(p.isSuperAdmin)F=Fe(ye(J,"designs"),Be("dateCreated","desc"));else if(p.isAdmin){const W=p.classes?Object.keys(p.classes):[];if(W.length>0)F=Fe(ye(J,"designs"),be("course","in",W),Be("dateCreated","desc"));else{t([]),a([]);return}}else F=Fe(ye(J,"designs"),be("userId","==",p.uid),Be("dateCreated","desc"));(await Xe(F)).forEach(W=>{const R=W.data(),Z={id:W.id,title:R.title,description:R.description,course:R.course,dateCreated:R.dateCreated,dateModified:R.dateModified,userId:R.userId,images:R.images||[],files:R.files||[]};p.isSuperAdmin?R.userId===p.uid?M.push(Z):R.userId!==p.uid&&R.course&&R.isAdmin?$.push(Z):R.userId!==p.uid&&!R.isAdmin&&z.push(Z):p.isAdmin?R.userId===p.uid?$.push(Z):z.push(Z):R.userId===p.uid&&z.push(Z)}),c(M),t($),a(z)},[p,J]);H.useEffect(()=>{!I&&p&&A()},[p,I,A]);const f=F=>{const M=[...E,...e,...d].find($=>$.id===F);y(M||null),l(!0)},o=F=>{_(F),S("Are you sure you want to delete this design? This action cannot be undone."),T(!0)},O=async()=>{if(v)if(B!==(p==null?void 0:p.uid))j("User ID confirmation failed. Enter the correct User ID."),C("error"),u(!0);else try{const F=Fe(ye(J,"builds"),be("design_ID","==",v),be("userId","==",p.uid)),M=await Xe(F);for(const $ of M.docs){const z=$.id,G=Fe(ye(J,"tests"),be("build_ID","==",z),be("userId","==",p.uid)),W=await Xe(G);for(const R of W.docs)await ht(ve(J,"tests",R.id));await ht(ve(J,"builds",z))}await ht(ve(J,"designs",v)),c($=>$.filter(z=>z.id!==v)),t($=>$.filter(z=>z.id!==v)),a($=>$.filter(z=>z.id!==v)),j("Your design and its associated builds and tests have been deleted."),C("success"),u(!0)}catch(F){console.error("Error deleting design, builds, and tests: ",F),j("There was an issue deleting your design and its associated builds and tests."),C("error"),u(!0)}finally{N(""),P(!1),_(null)}};return i.jsxs(tt,{className:"profile-container",sx:{p:4},children:[" ",!n&&!s&&i.jsxs(i.Fragment,{children:[i.jsx(tt,{sx:{mb:3},children:i.jsx(Ls,{setIsAdding:r})}),(p==null?void 0:p.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Super Admin Designs"}),i.jsx(lt,{designs:E,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:p,showUserIdColumn:!0}),i.jsx("h2",{children:"Educator Designs"}),i.jsx(lt,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:p,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(lt,{designs:d,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:p,showUserIdColumn:!0})]}),(p==null?void 0:p.isAdmin)&&!p.isSuperAdmin&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Educator Designs"}),i.jsx(lt,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:p,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(lt,{designs:d,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:p,showUserIdColumn:!0})]}),!(p!=null&&p.isAdmin)&&!(p!=null&&p.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Student Designs"}),i.jsx(lt,{designs:d,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:p,showUserIdColumn:!1})]})]}),n&&i.jsx(mr,{designs:E.concat(e),setDesigns:t,setIsAdding:r,getDesigns:A,onReturnToDashboard:b}),s&&i.jsx(xr,{designs:E.concat(e),selectedDesign:x,setDesigns:t,setIsEditing:l,getDesigns:A,onReturnToDashboard:b}),i.jsxs(st,{open:g,onClose:()=>T(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(pt,{children:"Confirm Deletion"}),i.jsx(rt,{children:i.jsx(St,{children:k})}),i.jsxs(bt,{children:[i.jsx(je,{onClick:()=>T(!1),children:"No, cancel"}),i.jsx(je,{onClick:()=>{P(!0),T(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(st,{open:D,onClose:()=>P(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(pt,{children:"Confirm Your User ID"}),i.jsx(rt,{children:i.jsx(Rt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:B,onChange:F=>N(F.target.value)})}),i.jsxs(bt,{children:[i.jsx(je,{onClick:()=>P(!1),children:"No, cancel"}),i.jsx(je,{onClick:O,color:"primary",children:"Confirm"})]})]}),i.jsx(it,{open:h,autoHideDuration:6e3,onClose:()=>u(!1),children:i.jsx(at,{onClose:()=>u(!1),severity:w,sx:{width:"100%"},children:m})})]})},wr=Os.memo(vr);export{wr as default};
