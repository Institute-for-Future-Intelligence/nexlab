import{p as P,q as R,r as v,j as e,B as u,z as I,bu as q,bv as H,a as T,$ as V,T as m,i as U,P as X,k as Y,l as _,m as M,n as b,o as G,v as N,t as O,I as L,aH as J,a8 as K,b1 as Z,A as w,C as B,a3 as ee,f as te}from"./ui-D_FIyQ7E.js";import{u as E,s as a,i as $,c as t,b as W,a as z,t as r,k as se,d as oe,P as F}from"./index-DwVItUg0.js";import{u as c,l as re}from"./labNotebookService-jB4EXFyd.js";import"./firebase-CTJJwFJC.js";import"./vendor-BFl3bqVE.js";const ie=()=>{const i=P(),y=R(i.breakpoints.down("md")),{userDetails:g}=E(),[h,k]=v.useState(""),p=c(o=>o.filters.searchQuery),D=c(o=>o.setSearchQuery),j=c(o=>o.filters.courseId),S=c(o=>o.setSelectedCourse);c(o=>o.viewMode),c(o=>o.setViewMode);const s=c(o=>o.setActivePanel);c(o=>o.fetchAllData),v.useEffect(()=>{k(p)},[]),v.useEffect(()=>{const o=setTimeout(()=>{h!==p&&D(h)},300);return()=>clearTimeout(o)},[h,p,D]);const l=Object.entries((g==null?void 0:g.classes)||{}).map(([o,f])=>({id:o,number:f.number,title:f.title,isCourseAdmin:f.isCourseAdmin})),x=()=>{s("create")};return e.jsxs(u,{sx:{display:"flex",flexDirection:y?"column":"row",gap:a[3],alignItems:y?"stretch":"center"},children:[e.jsx(u,{sx:{minWidth:y?"100%":300},children:e.jsx($,{value:j||"",onChange:o=>S(o||null),courses:[{id:"",number:"All",title:"All Courses",isCourseAdmin:!1},...l],size:"medium",showAdminBadge:!1})}),e.jsx(u,{sx:{flex:1},children:e.jsx(I,{placeholder:"Search designs...",value:h,onChange:o=>k(o.target.value),size:"medium",fullWidth:!0,InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(H,{sx:{color:t.text.tertiary}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:W.lg,backgroundColor:t.background.secondary,"& fieldset":{borderColor:t.neutral[200]},"&:hover fieldset":{borderColor:t.neutral[300]},"&.Mui-focused fieldset":{borderColor:t.primary[500]}}}})}),e.jsx(u,{children:e.jsx(T,{variant:"contained",startIcon:e.jsx(V,{}),onClick:x,sx:{backgroundColor:t.primary[500],color:t.text.inverse,fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.semibold,fontSize:r.fontSize.base,padding:`${a[3]} ${a[6]}`,borderRadius:W.xl,textTransform:"none",boxShadow:z.sm,"&:hover":{backgroundColor:t.primary[600],boxShadow:z.md}},children:y?"New":"New Design"})})]})},ne=({designs:i})=>{const y=se(),g=P(),h=R(g.breakpoints.down("md")),k=c(s=>s.builds),p=c(s=>s.tests),D=s=>{const l=k.filter(f=>f.design_ID===s),x=l.map(f=>f.id),o=p.filter(f=>x.includes(f.build_ID));return{buildCount:l.length,testCount:o.length}},j=s=>{if(!s)return"N/A";let l;s.toDate&&typeof s.toDate=="function"?l=s.toDate():s.seconds?l=new Date(s.seconds*1e3):l=new Date(s);const x=l.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),o=l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`${x}, ${o}`},S=s=>{y(`/laboratory-notebook/${s}`)};return i.length===0?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,p:a[6]},children:[e.jsx(m,{variant:"h5",sx:{fontFamily:r.fontFamily.display,color:t.text.secondary,mb:a[2]},children:"No Designs Yet"}),e.jsx(m,{variant:"body1",sx:{color:t.text.tertiary,textAlign:"center",maxWidth:500},children:"Start by creating your first design to visualize your experimental workflow."})]}):e.jsx(U,{component:X,sx:{borderRadius:W.xl,boxShadow:z.md,border:`1px solid ${t.neutral[200]}`},children:e.jsxs(Y,{children:[e.jsx(_,{children:e.jsxs(M,{sx:{backgroundColor:t.background.secondary},children:[e.jsx(b,{sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Title"}),!h&&e.jsx(b,{sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Description"}),e.jsx(b,{align:"center",sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Builds"}),e.jsx(b,{align:"center",sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Tests"}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Created"}),e.jsx(b,{sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Modified"})]}),e.jsx(b,{align:"center",sx:{fontFamily:r.fontFamily.secondary,fontWeight:r.fontWeight.bold,color:t.text.primary,fontSize:r.fontSize.sm},children:"Actions"})]})}),e.jsx(G,{children:i.map(s=>{const l=D(s.id);return e.jsxs(M,{sx:{"&:hover":{backgroundColor:t.primary[50],cursor:"pointer"},transition:oe.transitions.fast},onClick:()=>S(s.id),children:[e.jsx(b,{children:e.jsx(m,{variant:"body1",sx:{fontWeight:r.fontWeight.semibold,color:t.text.primary,fontFamily:r.fontFamily.secondary},children:s.title})}),!h&&e.jsx(b,{children:e.jsx(m,{variant:"body2",sx:{color:t.text.secondary,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",maxWidth:400},children:s.description||"No description"})}),e.jsx(b,{align:"center",children:e.jsx(N,{label:l.buildCount,size:"small",sx:{backgroundColor:l.buildCount>0?t.secondary[100]:t.neutral[100],color:l.buildCount>0?t.secondary[700]:t.text.tertiary,fontWeight:r.fontWeight.bold,minWidth:40}})}),e.jsx(b,{align:"center",children:e.jsx(N,{label:l.testCount,size:"small",sx:{backgroundColor:l.testCount>0?"#FFEDD5":t.neutral[100],color:l.testCount>0?"#C2410C":t.text.tertiary,fontWeight:r.fontWeight.bold,minWidth:40}})}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(b,{children:e.jsx(m,{variant:"body2",sx:{color:t.text.tertiary,fontSize:r.fontSize.sm},children:j(s.dateCreated)})}),e.jsx(b,{children:e.jsx(m,{variant:"body2",sx:{color:t.text.tertiary,fontSize:r.fontSize.sm},children:j(s.dateModified)})})]}),e.jsx(b,{align:"center",children:e.jsxs(u,{sx:{display:"flex",gap:a[1],justifyContent:"center"},children:[e.jsx(O,{title:"View Diagram",children:e.jsx(L,{size:"small",onClick:x=>{x.stopPropagation(),S(s.id)},sx:{color:t.primary[500],"&:hover":{backgroundColor:t.primary[50]}},children:e.jsx(J,{fontSize:"small"})})}),e.jsx(O,{title:"Delete Design",children:e.jsx(L,{size:"small",onClick:x=>{x.stopPropagation(),console.log("Delete design:",s.id)},sx:{color:t.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:e.jsx(K,{fontSize:"small"})})})]})})]},s.id)})})]})})},ae=()=>{const{userDetails:i}=E(),y=c(d=>d.setActivePanel);c(d=>d.addDesign);const g=c(d=>d.fetchAllData),[h,k]=v.useState(""),[p,D]=v.useState(""),[j,S]=v.useState(""),[s,l]=v.useState(!1),[x,o]=v.useState(null),f=Object.entries((i==null?void 0:i.classes)||{}).map(([d,C])=>({id:d,number:C.number,title:C.title,isCourseAdmin:C.isCourseAdmin})),A=()=>{y(null)},n=async d=>{if(d.preventDefault(),!h.trim()){o("Title is required");return}if(!p.trim()){o("Description is required");return}if(!j){o("Please select a course");return}if(!i){o("User not authenticated");return}l(!0),o(null);try{const C=await re.createDesign({title:h.trim(),description:p.trim(),course:j,userId:i.uid}),Q=Object.keys(i.classes||{});await g(i.uid,i.isAdmin,Q),y(null)}catch(C){console.error("Error creating design:",C),o(C instanceof Error?C.message:"Failed to create design")}finally{l(!1)}};return e.jsxs(u,{sx:{position:"fixed",right:0,top:0,height:"100vh",width:480,backgroundColor:t.background.primary,boxShadow:z["2xl"],zIndex:1300,display:"flex",flexDirection:"column",animation:"slideInRight 0.3s ease-out","@keyframes slideInRight":{from:{transform:"translateX(100%)"},to:{transform:"translateX(0)"}}},children:[e.jsx(u,{sx:{p:a[4],borderBottom:`1px solid ${t.neutral[200]}`,backgroundColor:t.primary[50]},children:e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{fontFamily:r.fontFamily.display,fontWeight:r.fontWeight.bold,color:t.text.primary},children:"Create New Design"}),e.jsx(L,{size:"small",onClick:A,disabled:s,children:e.jsx(Z,{})})]})}),e.jsxs(u,{component:"form",onSubmit:n,sx:{flex:1,overflowY:"auto",p:a[4],display:"flex",flexDirection:"column",gap:a[4]},children:[x&&e.jsx(w,{severity:"error",onClose:()=>o(null),children:x}),e.jsx(I,{label:"Title",value:h,onChange:d=>k(d.target.value),required:!0,fullWidth:!0,disabled:s,placeholder:"Enter design title",sx:{"& .MuiOutlinedInput-root":{borderRadius:W.lg}}}),e.jsx(I,{label:"Description",value:p,onChange:d=>D(d.target.value),required:!0,fullWidth:!0,multiline:!0,rows:6,disabled:s,placeholder:"Describe your design, its purpose, and goals",sx:{"& .MuiOutlinedInput-root":{borderRadius:W.lg}}}),e.jsx(u,{children:e.jsx($,{value:j,onChange:d=>S(d||""),courses:f,disabled:s,size:"medium",showAdminBadge:!1})}),e.jsx(w,{severity:"info",sx:{borderRadius:W.lg},children:e.jsx(m,{variant:"body2",children:"After creating your design, you can add builds and tests to it from the graph view."})})]}),e.jsxs(u,{sx:{p:a[4],borderTop:`1px solid ${t.neutral[200]}`,display:"flex",gap:a[2]},children:[e.jsx(T,{variant:"outlined",onClick:A,fullWidth:!0,disabled:s,children:"Cancel"}),e.jsx(T,{type:"submit",variant:"contained",onClick:n,fullWidth:!0,disabled:s,startIcon:s?e.jsx(B,{size:20}):e.jsx(ee,{}),sx:{backgroundColor:t.primary[500],"&:hover":{backgroundColor:t.primary[600]}},children:s?"Creating...":"Create Design"})]})]})},he=()=>{const{userDetails:i,loading:y}=E(),[g,h]=v.useState(!1),k=P(),p=R(k.breakpoints.down("md")),D=c(n=>n.isLoading),j=c(n=>n.error),S=c(n=>n.fetchAllData),s=c(n=>n.designs),l=c(n=>n.activePanel),x=c(n=>n.filters.searchQuery),o=c(n=>n.filters.courseId),f=te.useMemo(()=>{let n=s;if(o&&(n=n.filter(d=>d.course===o)),x){const d=x.toLowerCase();n=n.filter(C=>C.title.toLowerCase().includes(d)||C.description.toLowerCase().includes(d))}return n},[s,x,o]);return v.useEffect(()=>{if(!y&&i&&!g){const n=Object.keys(i.classes||{});S(i.uid,i.isAdmin,n),h(!0)}},[i,y,S,g]),y||D&&!g?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"80vh",gap:a[4]},children:[e.jsx(B,{size:60,sx:{color:t.primary[500]}}),e.jsx(m,{variant:"h6",sx:{fontFamily:r.fontFamily.display,color:t.text.secondary},children:"Loading your laboratory notebook..."})]}):j?e.jsxs(u,{sx:{p:a[6]},children:[e.jsx(F,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(w,{severity:"error",sx:{mt:a[4],borderRadius:"12px"},children:[e.jsx(m,{variant:"h6",sx:{mb:1},children:"Error Loading Data"}),e.jsx(m,{variant:"body2",children:j})]})]}):i&&(i.isAdmin||i.isSuperAdmin||i.classes&&Object.keys(i.classes).length>0)?e.jsxs(u,{sx:{p:p?a[3]:a[6],backgroundColor:t.background.primary,minHeight:"100vh"},children:[e.jsx(F,{title:"Laboratory Notebook",subtitle:"Manage your experimental designs, builds, and tests"}),e.jsx(u,{sx:{mb:a[6]},children:e.jsx(ie,{})}),g&&e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{display:"flex",gap:a[4],mb:a[4],flexWrap:"wrap"},children:e.jsxs(u,{sx:{flex:1,minWidth:200,p:a[4],backgroundColor:t.primary[50],borderRadius:W.xl,border:`1px solid ${t.primary[200]}`},children:[e.jsx(m,{variant:"h3",sx:{fontFamily:r.fontFamily.display,fontWeight:r.fontWeight.bold,color:t.primary[700],mb:a[1]},children:f.length}),e.jsx(m,{variant:"body2",sx:{color:t.text.secondary,fontWeight:r.fontWeight.medium},children:"Total Designs"})]})}),e.jsx(ne,{designs:f})]}),l==="create"&&e.jsx(ae,{})]}):e.jsxs(u,{sx:{p:a[6]},children:[e.jsx(F,{title:"Laboratory Notebook",subtitle:"Visualize and manage your experimental designs"}),e.jsxs(w,{severity:"info",sx:{mt:a[4],borderRadius:"12px"},children:[e.jsx(m,{variant:"h6",sx:{mb:1},children:"Course Enrollment Required"}),e.jsx(m,{variant:"body2",children:"The Laboratory Notebook is accessible to users enrolled in an academic course. Please enroll in a course via 'My Account' by following the instructions provided by your academic instructor."})]})]})};export{he as default};
