const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C1w9W7xM.js","assets/ui-Ce4HUEU5.js","assets/vendor-BFl3bqVE.js","assets/firebase-CTJJwFJC.js","assets/index-BA2bQjcR.css"])))=>i.map(i=>d[i]);
var X=Object.defineProperty;var Z=(o,i,e)=>i in o?X(o,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[i]=e;var A=(o,i,e)=>Z(o,typeof i!="symbol"?i+"":i,e);import{m as J,n as U,p as Y,_ as R,b as z,s as E,c as B,t as N}from"./index-C1w9W7xM.js";import{l as ee,P as ie,q as P,h as _,_ as w,e as I,i as k,R as L,v,t as G,y as S,f as j,x as V}from"./firebase-CTJJwFJC.js";import{j as y,V as se,W as te,B as de,bF as oe,T as O,X as ae,Z as le,a as q}from"./ui-Ce4HUEU5.js";const M=o=>o?o instanceof ee||o.toDate&&typeof o.toDate=="function"?o.toDate():o.seconds?new Date(o.seconds*1e3):new Date:new Date,Q={courseId:null,searchQuery:"",dateRange:{start:null,end:null},nodeTypes:{designs:!0,builds:!0,tests:!0}},$={x:0,y:0,zoom:1},be=J()(U(Y((o,i)=>({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,layoutType:"horizontal",viewMode:"graph",isExpanded:!1,deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null},filters:Q,viewport:$,fetchAllData:async(e,s=!1,t=[])=>{o({isLoading:!0,error:null});try{const{collection:d,query:r,where:n,getDocs:u,orderBy:b}=await R(async()=>{const{collection:g,query:p,where:h,getDocs:D,orderBy:l}=await import("./firebase-CTJJwFJC.js").then(K=>K.B);return{collection:g,query:p,where:h,getDocs:D,orderBy:l}},[]),{db:m}=await R(async()=>{const{db:g}=await import("./index-C1w9W7xM.js").then(p=>p.K);return{db:g}},__vite__mapDeps([0,1,2,3,4]));let C;s&&t.length>0?C=r(d(m,"designs"),n("course","in",t),b("dateCreated","desc")):C=r(d(m,"designs"),n("userId","==",e),b("dateCreated","desc"));const c=(await u(C)).docs.map(g=>{const p=g.data();return{id:g.id,title:p.title||"",description:p.description||"",course:p.course||"",dateCreated:p.dateCreated,dateModified:p.dateModified,userId:p.userId||"",images:p.images||[],files:p.files||[]}}),f=c.map(g=>g.id);let T=[];if(f.length>0){const g=[];for(let h=0;h<f.length;h+=10){const D=f.slice(h,h+10),l=r(d(m,"builds"),n("design_ID","in",D));g.push(u(l))}T=(await Promise.all(g)).flatMap(h=>h.docs.map(D=>{const l=D.data();return{id:D.id,title:l.title||"",description:l.description||"",design_ID:l.design_ID||"",dateCreated:l.dateCreated,userId:l.userId||"",images:l.images||[],files:l.files||[]}}))}const x=T.map(g=>g.id);let F=[];if(x.length>0){const g=[];for(let h=0;h<x.length;h+=10){const D=x.slice(h,h+10),l=r(d(m,"tests"),n("build_ID","in",D));g.push(u(l))}F=(await Promise.all(g)).flatMap(h=>h.docs.map(D=>{const l=D.data();return{id:D.id,title:l.title||"",description:l.description||"",results:l.results||"",conclusions:l.conclusions||"",build_ID:l.build_ID||"",design_ID:l.design_ID||"",dateCreated:l.dateCreated,userId:l.userId||"",images:l.images||[],files:l.files||[]}}))}o({designs:c,builds:T,tests:F,isLoading:!1}),i().buildGraph()}catch(d){console.error("Error fetching lab notebook data:",d),o({error:d instanceof Error?d.message:"Failed to fetch data",isLoading:!1})}},setDesigns:e=>{o({designs:e}),i().buildGraph()},addDesign:e=>{o(s=>({designs:[...s.designs,e]})),i().buildGraph()},updateDesignLocal:(e,s)=>{o(t=>({designs:t.designs.map(d=>d.id===e?{...d,...s}:d)})),i().buildGraph()},removeDesign:e=>{o(s=>({designs:s.designs.filter(t=>t.id!==e),builds:s.builds.filter(t=>t.design_ID!==e),tests:s.tests.filter(t=>t.design_ID!==e)})),i().buildGraph()},setBuilds:e=>{o({builds:e}),i().buildGraph()},addBuild:e=>{o(s=>({builds:[...s.builds,e]})),i().buildGraph()},updateBuildLocal:(e,s)=>{o(t=>({builds:t.builds.map(d=>d.id===e?{...d,...s}:d)})),i().buildGraph()},removeBuild:e=>{o(s=>({builds:s.builds.filter(t=>t.id!==e),tests:s.tests.filter(t=>t.build_ID!==e)})),i().buildGraph()},setTests:e=>{o({tests:e}),i().buildGraph()},addTest:e=>{o(s=>({tests:[...s.tests,e]})),i().buildGraph()},updateTestLocal:(e,s)=>{o(t=>({tests:t.tests.map(d=>d.id===e?{...d,...s}:d)})),i().buildGraph()},removeTest:e=>{o(s=>({tests:s.tests.filter(t=>t.id!==e)})),i().buildGraph()},buildGraph:()=>{const e=i(),{designs:s,builds:t,tests:d,filters:r}=e;let n=s,u=t,b=d;if(r.courseId){n=n.filter(f=>f.course===r.courseId);const a=n.map(f=>f.id);u=u.filter(f=>a.includes(f.design_ID));const c=u.map(f=>f.id);b=b.filter(f=>c.includes(f.build_ID))}if(r.searchQuery){const a=r.searchQuery.toLowerCase();n=n.filter(c=>c.title.toLowerCase().includes(a)||c.description.toLowerCase().includes(a)),u=u.filter(c=>c.title.toLowerCase().includes(a)||c.description.toLowerCase().includes(a)),b=b.filter(c=>c.title.toLowerCase().includes(a)||c.description.toLowerCase().includes(a))}r.nodeTypes.designs||(n=[]),r.nodeTypes.builds||(u=[]),r.nodeTypes.tests||(b=[]);const m=[],C=[];n.forEach((a,c)=>{const f=u.filter(x=>x.design_ID===a.id).length,T=b.filter(x=>x.design_ID===a.id).length;m.push({id:`design-${a.id}`,type:"designNode",position:{x:0,y:c*200},data:{type:"design",designId:a.id,label:a.title,title:a.title,description:a.description,dateCreated:M(a.dateCreated),dateModified:M(a.dateModified),userId:a.userId,images:a.images||[],files:a.files||[],course:a.course,buildCount:f,testCount:T}})}),u.forEach((a,c)=>{const f=b.filter(T=>T.build_ID===a.id).length;m.push({id:`build-${a.id}`,type:"buildNode",position:{x:400,y:c*180},data:{type:"build",buildId:a.id,designId:a.design_ID,label:a.title,title:a.title,description:a.description,dateCreated:M(a.dateCreated),dateModified:M(a.dateModified),userId:a.userId,images:a.images||[],files:a.files||[],testCount:f}}),C.push({id:`edge-design-${a.design_ID}-build-${a.id}`,source:`design-${a.design_ID}`,target:`build-${a.id}`,type:"smoothstep",animated:!1})}),b.forEach((a,c)=>{m.push({id:`test-${a.id}`,type:"testNode",position:{x:800,y:c*180},data:{type:"test",testId:a.id,buildId:a.build_ID,designId:a.design_ID,label:a.title,title:a.title,description:a.description,results:a.results,conclusions:a.conclusions,dateCreated:M(a.dateCreated),dateModified:M(a.dateModified),userId:a.userId,images:a.images||[],files:a.files||[]}}),C.push({id:`edge-build-${a.build_ID}-test-${a.id}`,source:`build-${a.build_ID}`,target:`test-${a.id}`,type:"smoothstep",animated:!1})}),o({nodes:m,edges:C})},selectNode:e=>{o({selectedNodeId:e}),e&&o({activePanel:"detail"})},setHoveredNode:e=>{o({hoveredNodeId:e})},updateNodePosition:(e,s)=>{o(t=>({nodes:t.nodes.map(d=>d.id===e?{...d,position:s}:d)}))},resetGraph:()=>{o({nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null})},setLoading:e=>o({isLoading:e}),setError:e=>o({error:e}),setActivePanel:e=>o({activePanel:e}),setLayoutType:e=>o({layoutType:e}),setViewMode:e=>o({viewMode:e}),setIsExpanded:e=>o({isExpanded:e}),openDeleteDialog:(e,s,t)=>o({deleteDialog:{open:!0,nodeId:e,nodeType:s,nodeName:t}}),closeDeleteDialog:()=>o({deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null}}),confirmDelete:async()=>{const e=i(),{nodeId:s,nodeType:t}=e.deleteDialog;if(!(!s||!t))try{const{labNotebookService:d}=await R(async()=>{const{labNotebookService:u}=await Promise.resolve().then(()=>ce);return{labNotebookService:u}},void 0),r=e.nodes.find(u=>u.id.includes(s));if(!r)return;const n=r.data.userId;t==="build"?(await d.deleteBuild(s,n),i().removeBuild(s)):t==="test"&&(await d.deleteTest(s,n),i().removeTest(s)),i().closeDeleteDialog(),i().selectNode(null),i().setActivePanel(null),await i().fetchAllData(n,!1,[])}catch(d){console.error("Error deleting:",d),o({error:d instanceof Error?d.message:"Failed to delete"})}},setSelectedCourse:e=>{o(s=>({filters:{...s.filters,courseId:e}})),i().buildGraph()},setSearchQuery:e=>{o(s=>({filters:{...s.filters,searchQuery:e}})),i().buildGraph()},setDateRange:(e,s)=>{o(t=>({filters:{...t.filters,dateRange:{start:e,end:s}}})),i().buildGraph()},toggleNodeTypeFilter:e=>{o(s=>({filters:{...s.filters,nodeTypes:{...s.filters.nodeTypes,[e]:!s.filters.nodeTypes[e]}}})),i().buildGraph()},resetFilters:()=>{o({filters:Q}),i().buildGraph()},setViewport:e=>o({viewport:e}),resetViewport:()=>o({viewport:$}),getGraphMetrics:()=>{const e=i();return{designCount:e.designs.length,buildCount:e.builds.length,testCount:e.tests.length,totalNodes:e.nodes.length,totalEdges:e.edges.length}},getNodeById:e=>i().nodes.find(s=>s.id===e),getDesignById:e=>i().designs.find(s=>s.id===e),getBuildById:e=>i().builds.find(s=>s.id===e),getTestById:e=>i().tests.find(s=>s.id===e),getBuildsByDesignId:e=>i().builds.filter(s=>s.design_ID===e),getTestsByBuildId:e=>i().tests.filter(s=>s.build_ID===e),reset:()=>{o({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,filters:Q,viewport:$})}}),{name:"lab-notebook-storage",partialize:o=>({layoutType:o.layoutType,viewMode:o.viewMode,viewport:o.viewport})}),{name:"LabNotebookStore"}));class re{constructor(){A(this,"db",null)}initialize(){this.db||(this.db=ie())}async createDesign(i){this.initialize();const e={title:i.title,description:i.description,course:i.course,userId:i.userId,dateCreated:_(),dateModified:_(),images:i.images||[],files:i.files||[]},s=await P(w(this.db,"designs"),e);return console.log("Design created with ID:",s.id),s.id}async updateDesign(i){this.initialize();const e={dateModified:_()};i.title!==void 0&&(e.title=i.title),i.description!==void 0&&(e.description=i.description),i.course!==void 0&&(e.course=i.course),i.images!==void 0&&(e.images=i.images),i.files!==void 0&&(e.files=i.files);const s=I(this.db,"designs",i.id);await k(s,e),console.log("Design updated:",i.id)}async deleteDesign(i,e){this.initialize();const s=L(w(this.db,"builds"),v("design_ID","==",i),v("userId","==",e)),t=await G(s);for(const d of t.docs){const r=d.id,n=L(w(this.db,"tests"),v("build_ID","==",r),v("userId","==",e)),u=await G(n);for(const b of u.docs)await S(I(this.db,"tests",b.id)),console.log("Test deleted:",b.id);await S(I(this.db,"builds",r)),console.log("Build deleted:",r)}await S(I(this.db,"designs",i)),console.log("Design deleted:",i)}async getDesign(i){this.initialize();const e=I(this.db,"designs",i),s=await j(e);if(s.exists()){const t=s.data();return{id:s.id,title:t.title||"",description:t.description||"",course:t.course||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}}return null}async createBuild(i){this.initialize();const e={title:i.title,description:i.description,design_ID:i.designId,userId:i.userId,dateCreated:_(),dateModified:_(),images:i.images||[],files:i.files||[]},s=await P(w(this.db,"builds"),e);return console.log("Build created with ID:",s.id),s.id}async updateBuild(i){this.initialize();const e={dateModified:_()};i.title!==void 0&&(e.title=i.title),i.description!==void 0&&(e.description=i.description),i.images!==void 0&&(e.images=i.images),i.files!==void 0&&(e.files=i.files);const s=I(this.db,"builds",i.id);await k(s,e),console.log("Build updated:",i.id)}async deleteBuild(i,e){this.initialize();const s=L(w(this.db,"tests"),v("build_ID","==",i),v("userId","==",e)),t=await G(s);for(const d of t.docs)await S(I(this.db,"tests",d.id)),console.log("Test deleted:",d.id);await S(I(this.db,"builds",i)),console.log("Build deleted:",i)}async getBuild(i){this.initialize();const e=I(this.db,"builds",i),s=await j(e);if(s.exists()){const t=s.data();return{id:s.id,title:t.title||"",description:t.description||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,userId:t.userId||"",images:t.images||[],files:t.files||[]}}return null}async getBuildsByDesign(i){this.initialize();const e=L(w(this.db,"builds"),v("design_ID","==",i),V("dateCreated","desc"));return(await G(e)).docs.map(t=>{const d=t.data();return{id:t.id,title:d.title||"",description:d.description||"",design_ID:d.design_ID||"",dateCreated:d.dateCreated,dateModified:d.dateModified,userId:d.userId||"",images:d.images||[],files:d.files||[]}})}async createTest(i){this.initialize();const e={title:i.title,description:i.description,results:i.results,conclusions:i.conclusions,build_ID:i.buildId,design_ID:i.designId,userId:i.userId,dateCreated:_(),dateModified:_(),images:i.images||[],files:i.files||[]},s=await P(w(this.db,"tests"),e);return console.log("Test created with ID:",s.id),s.id}async updateTest(i){this.initialize();const e={dateModified:_()};i.title!==void 0&&(e.title=i.title),i.description!==void 0&&(e.description=i.description),i.results!==void 0&&(e.results=i.results),i.conclusions!==void 0&&(e.conclusions=i.conclusions),i.images!==void 0&&(e.images=i.images),i.files!==void 0&&(e.files=i.files);const s=I(this.db,"tests",i.id);await k(s,e),console.log("Test updated:",i.id)}async deleteTest(i,e){this.initialize(),await S(I(this.db,"tests",i)),console.log("Test deleted:",i)}async getTest(i){this.initialize();const e=I(this.db,"tests",i),s=await j(e);if(s.exists()){const t=s.data();return{id:s.id,title:t.title||"",description:t.description||"",results:t.results||"",conclusions:t.conclusions||"",build_ID:t.build_ID||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}}return null}async getTestsByBuild(i){this.initialize();const e=L(w(this.db,"tests"),v("build_ID","==",i),V("dateCreated","desc"));return(await G(e)).docs.map(t=>{const d=t.data();return{id:t.id,title:d.title||"",description:d.description||"",results:d.results||"",conclusions:d.conclusions||"",build_ID:d.build_ID||"",design_ID:d.design_ID||"",dateCreated:d.dateCreated,dateModified:d.dateModified,userId:d.userId||"",images:d.images||[],files:d.files||[]}})}}let W=null;const H=()=>(W||(W=new re),W),ne=H(),ce=Object.freeze(Object.defineProperty({__proto__:null,getLabNotebookService:H,labNotebookService:ne},Symbol.toStringTag,{value:"Module"})),pe=({open:o,title:i,message:e,confirmLabel:s="Confirm",cancelLabel:t="Cancel",onConfirm:d,onCancel:r,isDestructive:n=!1})=>y.jsxs(se,{open:o,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:z.xl}},children:[y.jsx(te,{children:y.jsxs(de,{sx:{display:"flex",alignItems:"center",gap:E[2]},children:[n&&y.jsx(oe,{sx:{color:B.error,fontSize:28}}),y.jsx(O,{variant:"h5",sx:{fontFamily:N.fontFamily.display,fontWeight:N.fontWeight.bold,color:B.text.primary},children:i})]})}),y.jsx(ae,{children:y.jsx(O,{variant:"body1",sx:{color:B.text.secondary,lineHeight:N.lineHeight.relaxed},children:e})}),y.jsxs(le,{sx:{p:E[3],gap:E[2]},children:[y.jsx(q,{onClick:r,variant:"outlined",sx:{borderRadius:z.md,textTransform:"none",fontWeight:N.fontWeight.medium},children:t}),y.jsx(q,{onClick:d,variant:"contained",sx:{borderRadius:z.md,textTransform:"none",fontWeight:N.fontWeight.medium,backgroundColor:n?B.error:B.primary[500],"&:hover":{backgroundColor:n?"#C62828":B.primary[600]}},children:s})]})]});export{pe as C,ne as l,be as u};
