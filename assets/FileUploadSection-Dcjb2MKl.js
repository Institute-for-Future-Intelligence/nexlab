const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cn8t_j2A.js","assets/ui-CvbxGYbq.js","assets/vendor-BFl3bqVE.js","assets/firebase-CTJJwFJC.js","assets/index-BA2bQjcR.css"])))=>i.map(i=>d[i]);
var Jt=Object.defineProperty;var er=(y,g,p)=>g in y?Jt(y,g,{enumerable:!0,configurable:!0,writable:!0,value:p}):y[g]=p;var wt=(y,g,p)=>er(y,typeof g!="symbol"?g+"":g,p);import{h as tr,i as rr,p as nr,_ as Ve,b as re,s as $,c as N,t as G,R as ir,a as It,v as pt}from"./index-Cn8t_j2A.js";import{l as sr,P as or,q as lt,h as De,_ as Ee,e as xe,i as dt,R as Qe,v as ke,t as Ge,y as Le,f as ct,x as At,k as Xe,r as Ye,z as Et,n as kt,p as Rt}from"./firebase-CTJJwFJC.js";import{j as P,V as jt,W as ar,B as se,bG as lr,T as ae,X as Tt,Z as dr,a as Je,r as le,t as et,I as Ne,bH as cr,bI as Ct,bJ as _t,a7 as Dt,aJ as Mt,al as zt,A as Pt,G as St,E as fr,bz as ur,H as hr,z as gr,ac as pr,bx as br,a8 as Bt,aU as mr,aK as bt,a0 as yr,a1 as xr,ba as vr,a2 as wr,bA as Ir,v as Ar,bB as Cr,bC as _r,at as Ft,bD as Dr,bE as Sr}from"./ui-CvbxGYbq.js";import Ke from"./purify.es-CQJ0hv7W.js";const Oe=y=>y?y instanceof sr||y.toDate&&typeof y.toDate=="function"?y.toDate():y.seconds?new Date(y.seconds*1e3):new Date:new Date,ft={courseId:null,searchQuery:"",dateRange:{start:null,end:null},nodeTypes:{designs:!0,builds:!0,tests:!0}},ut={x:0,y:0,zoom:1},Qr=tr()(rr(nr((y,g)=>({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,layoutType:"horizontal",viewMode:"graph",isExpanded:!1,deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null},filters:ft,viewport:ut,fetchAllData:async(p,i=!1,e=[])=>{y({isLoading:!0,error:null});try{const{collection:t,query:l,where:o,getDocs:m,orderBy:v}=await Ve(async()=>{const{collection:k,query:F,where:_,getDocs:M,orderBy:h}=await import("./firebase-CTJJwFJC.js").then(U=>U.B);return{collection:k,query:F,where:_,getDocs:M,orderBy:h}},[]),{db:n}=await Ve(async()=>{const{db:k}=await import("./index-Cn8t_j2A.js").then(F=>F.G);return{db:k}},__vite__mapDeps([0,1,2,3,4]));let s;if(i&&e.length>0){const{doc:k,getDoc:F}=await Ve(async()=>{const{doc:c,getDoc:w}=await import("./firebase-CTJJwFJC.js").then(A=>A.B);return{doc:c,getDoc:w}},[]),_=await F(k(n,"users",p)),M=_.exists()?_.data():null,h=(M==null?void 0:M.classes)||{},U=Object.entries(h).filter(([c,w])=>w.isCourseAdmin).map(([c,w])=>c),f=Object.entries(h).filter(([c,w])=>!w.isCourseAdmin).map(([c,w])=>c);if(U.length>0&&f.length>0){const c=l(t(n,"designs"),o("course","in",U),v("dateCreated","desc")),w=l(t(n,"designs"),o("course","in",f),o("userId","==",p),v("dateCreated","desc")),[A,C]=await Promise.all([m(c),m(w)]),S=A.docs.map(O=>({id:O.id,...O.data()})),I=C.docs.map(O=>({id:O.id,...O.data()})),u=[...S,...I].map(O=>({id:O.id,title:O.title||"",description:O.description||"",course:O.course||"",dateCreated:O.dateCreated,dateModified:O.dateModified,userId:O.userId||"",images:O.images||[],files:O.files||[]})),d=u.map(O=>O.id);let z=[];if(d.length>0){const O=[];for(let H=0;H<d.length;H+=10){const L=d.slice(H,H+10),T=l(t(n,"builds"),o("design_ID","in",L));O.push(m(T))}z=(await Promise.all(O)).flatMap(H=>H.docs.map(L=>{const T=L.data();return{id:L.id,title:T.title||"",description:T.description||"",design_ID:T.design_ID||"",dateCreated:T.dateCreated,userId:T.userId||"",images:T.images||[],files:T.files||[]}}))}const E=z.map(O=>O.id);let B=[];if(E.length>0){const O=[];for(let H=0;H<E.length;H+=10){const L=E.slice(H,H+10),T=l(t(n,"tests"),o("build_ID","in",L));O.push(m(T))}B=(await Promise.all(O)).flatMap(H=>H.docs.map(L=>{const T=L.data();return{id:L.id,title:T.title||"",description:T.description||"",build_ID:T.build_ID||"",dateCreated:T.dateCreated,userId:T.userId||"",images:T.images||[],files:T.files||[]}}))}y({designs:u,builds:z,tests:B,isLoading:!1});return}else U.length>0?s=l(t(n,"designs"),o("course","in",U),v("dateCreated","desc")):s=l(t(n,"designs"),o("course","in",f),o("userId","==",p),v("dateCreated","desc"))}else s=l(t(n,"designs"),o("userId","==",p),v("dateCreated","desc"));const a=(await m(s)).docs.map(k=>{const F=k.data();return{id:k.id,title:F.title||"",description:F.description||"",course:F.course||"",dateCreated:F.dateCreated,dateModified:F.dateModified,userId:F.userId||"",images:F.images||[],files:F.files||[]}}),b=a.map(k=>k.id);let D=[];if(b.length>0){const k=[];for(let _=0;_<b.length;_+=10){const M=b.slice(_,_+10),h=l(t(n,"builds"),o("design_ID","in",M));k.push(m(h))}D=(await Promise.all(k)).flatMap(_=>_.docs.map(M=>{const h=M.data();return{id:M.id,title:h.title||"",description:h.description||"",design_ID:h.design_ID||"",dateCreated:h.dateCreated,userId:h.userId||"",images:h.images||[],files:h.files||[]}}))}const j=D.map(k=>k.id);let x=[];if(j.length>0){const k=[];for(let _=0;_<j.length;_+=10){const M=j.slice(_,_+10),h=l(t(n,"tests"),o("build_ID","in",M));k.push(m(h))}x=(await Promise.all(k)).flatMap(_=>_.docs.map(M=>{const h=M.data();return{id:M.id,title:h.title||"",description:h.description||"",results:h.results||"",conclusions:h.conclusions||"",build_ID:h.build_ID||"",design_ID:h.design_ID||"",dateCreated:h.dateCreated,userId:h.userId||"",images:h.images||[],files:h.files||[]}}))}y({designs:a,builds:D,tests:x,isLoading:!1}),g().buildGraph()}catch(t){console.error("Error fetching lab notebook data:",t);const l=t instanceof Error?t.message:String(t),o=l.includes("permission")||l.includes("insufficient")||l.includes("PERMISSION_DENIED");y({error:o?"Database permissions not configured. Please contact your administrator or deploy Firebase security rules. See docs/FIREBASE_RULES_SETUP.md for instructions.":t instanceof Error?t.message:"Failed to fetch data",isLoading:!1})}},setDesigns:p=>{y({designs:p}),g().buildGraph()},addDesign:p=>{y(i=>({designs:[...i.designs,p]})),g().buildGraph()},updateDesignLocal:(p,i)=>{y(e=>({designs:e.designs.map(t=>t.id===p?{...t,...i}:t)})),g().buildGraph()},removeDesign:p=>{y(i=>({designs:i.designs.filter(e=>e.id!==p),builds:i.builds.filter(e=>e.design_ID!==p),tests:i.tests.filter(e=>e.design_ID!==p)})),g().buildGraph()},setBuilds:p=>{y({builds:p}),g().buildGraph()},addBuild:p=>{y(i=>({builds:[...i.builds,p]})),g().buildGraph()},updateBuildLocal:(p,i)=>{y(e=>({builds:e.builds.map(t=>t.id===p?{...t,...i}:t)})),g().buildGraph()},removeBuild:p=>{y(i=>({builds:i.builds.filter(e=>e.id!==p),tests:i.tests.filter(e=>e.build_ID!==p)})),g().buildGraph()},setTests:p=>{y({tests:p}),g().buildGraph()},addTest:p=>{y(i=>({tests:[...i.tests,p]})),g().buildGraph()},updateTestLocal:(p,i)=>{y(e=>({tests:e.tests.map(t=>t.id===p?{...t,...i}:t)})),g().buildGraph()},removeTest:p=>{y(i=>({tests:i.tests.filter(e=>e.id!==p)})),g().buildGraph()},buildGraph:()=>{const p=g(),{designs:i,builds:e,tests:t,filters:l}=p;let o=i,m=e,v=t;if(l.courseId){o=o.filter(b=>b.course===l.courseId);const r=o.map(b=>b.id);m=m.filter(b=>r.includes(b.design_ID));const a=m.map(b=>b.id);v=v.filter(b=>a.includes(b.build_ID))}if(l.searchQuery){const r=l.searchQuery.toLowerCase();o=o.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r)),m=m.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r)),v=v.filter(a=>a.title.toLowerCase().includes(r)||a.description.toLowerCase().includes(r))}l.nodeTypes.designs||(o=[]),l.nodeTypes.builds||(m=[]),l.nodeTypes.tests||(v=[]);const n=[],s=[];o.forEach((r,a)=>{const b=m.filter(j=>j.design_ID===r.id).length,D=v.filter(j=>j.design_ID===r.id).length;n.push({id:`design-${r.id}`,type:"designNode",position:{x:0,y:a*200},data:{type:"design",designId:r.id,label:r.title,title:r.title,description:r.description,dateCreated:Oe(r.dateCreated),dateModified:Oe(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],course:r.course,buildCount:b,testCount:D}})}),m.forEach((r,a)=>{const b=v.filter(D=>D.build_ID===r.id).length;n.push({id:`build-${r.id}`,type:"buildNode",position:{x:400,y:a*180},data:{type:"build",buildId:r.id,designId:r.design_ID,label:r.title,title:r.title,description:r.description,dateCreated:Oe(r.dateCreated),dateModified:Oe(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[],testCount:b}}),s.push({id:`edge-design-${r.design_ID}-build-${r.id}`,source:`design-${r.design_ID}`,target:`build-${r.id}`,type:"smoothstep",animated:!1})}),v.forEach((r,a)=>{n.push({id:`test-${r.id}`,type:"testNode",position:{x:800,y:a*180},data:{type:"test",testId:r.id,buildId:r.build_ID,designId:r.design_ID,label:r.title,title:r.title,description:r.description,results:r.results,conclusions:r.conclusions,dateCreated:Oe(r.dateCreated),dateModified:Oe(r.dateModified),userId:r.userId,images:r.images||[],files:r.files||[]}}),s.push({id:`edge-build-${r.build_ID}-test-${r.id}`,source:`build-${r.build_ID}`,target:`test-${r.id}`,type:"smoothstep",animated:!1})}),y({nodes:n,edges:s})},selectNode:p=>{y({selectedNodeId:p}),p&&y({activePanel:"detail"})},setHoveredNode:p=>{y({hoveredNodeId:p})},updateNodePosition:(p,i)=>{y(e=>({nodes:e.nodes.map(t=>t.id===p?{...t,position:i}:t)}))},resetGraph:()=>{y({nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null})},setLoading:p=>y({isLoading:p}),setError:p=>y({error:p}),setActivePanel:p=>y({activePanel:p}),setLayoutType:p=>y({layoutType:p}),setViewMode:p=>y({viewMode:p}),setIsExpanded:p=>y({isExpanded:p}),openDeleteDialog:(p,i,e)=>y({deleteDialog:{open:!0,nodeId:p,nodeType:i,nodeName:e}}),closeDeleteDialog:()=>y({deleteDialog:{open:!1,nodeId:null,nodeType:null,nodeName:null}}),confirmDelete:async()=>{const p=g(),{nodeId:i,nodeType:e}=p.deleteDialog;if(!(!i||!e))try{const{labNotebookService:t}=await Ve(async()=>{const{labNotebookService:m}=await Promise.resolve().then(()=>Er);return{labNotebookService:m}},void 0),l=p.nodes.find(m=>m.id.includes(i));if(!l)return;const o=l.data.userId;e==="build"?(await t.deleteBuild(i,o),g().removeBuild(i)):e==="test"&&(await t.deleteTest(i,o),g().removeTest(i)),g().closeDeleteDialog(),g().selectNode(null),g().setActivePanel(null),await g().fetchAllData(o,!1,[])}catch(t){console.error("Error deleting:",t),y({error:t instanceof Error?t.message:"Failed to delete"})}},setSelectedCourse:p=>{y(i=>({filters:{...i.filters,courseId:p}})),g().buildGraph()},setSearchQuery:p=>{y(i=>({filters:{...i.filters,searchQuery:p}})),g().buildGraph()},setDateRange:(p,i)=>{y(e=>({filters:{...e.filters,dateRange:{start:p,end:i}}})),g().buildGraph()},toggleNodeTypeFilter:p=>{y(i=>({filters:{...i.filters,nodeTypes:{...i.filters.nodeTypes,[p]:!i.filters.nodeTypes[p]}}})),g().buildGraph()},resetFilters:()=>{y({filters:ft}),g().buildGraph()},setViewport:p=>y({viewport:p}),resetViewport:()=>y({viewport:ut}),getGraphMetrics:()=>{const p=g();return{designCount:p.designs.length,buildCount:p.builds.length,testCount:p.tests.length,totalNodes:p.nodes.length,totalEdges:p.edges.length}},getNodeById:p=>g().nodes.find(i=>i.id===p),getDesignById:p=>g().designs.find(i=>i.id===p),getBuildById:p=>g().builds.find(i=>i.id===p),getTestById:p=>g().tests.find(i=>i.id===p),getBuildsByDesignId:p=>g().builds.filter(i=>i.design_ID===p),getTestsByBuildId:p=>g().tests.filter(i=>i.build_ID===p),reset:()=>{y({designs:[],builds:[],tests:[],nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,isLoading:!1,error:null,activePanel:null,filters:ft,viewport:ut})}}),{name:"lab-notebook-storage",partialize:y=>({layoutType:y.layoutType,viewMode:y.viewMode,viewport:y.viewport})}),{name:"LabNotebookStore"}));class Fr{constructor(){wt(this,"db",null)}initialize(){this.db||(this.db=or())}async createDesign(g){this.initialize();const p={title:g.title,description:g.description,course:g.course,userId:g.userId,dateCreated:De(),dateModified:De(),images:g.images||[],files:g.files||[]},i=await lt(Ee(this.db,"designs"),p);return console.log("Design created with ID:",i.id),i.id}async updateDesign(g){this.initialize();const p={dateModified:De()};g.title!==void 0&&(p.title=g.title),g.description!==void 0&&(p.description=g.description),g.course!==void 0&&(p.course=g.course),g.images!==void 0&&(p.images=g.images),g.files!==void 0&&(p.files=g.files);const i=xe(this.db,"designs",g.id);await dt(i,p),console.log("Design updated:",g.id)}async deleteDesign(g,p){this.initialize();const i=Qe(Ee(this.db,"builds"),ke("design_ID","==",g),ke("userId","==",p)),e=await Ge(i);for(const t of e.docs){const l=t.id,o=Qe(Ee(this.db,"tests"),ke("build_ID","==",l),ke("userId","==",p)),m=await Ge(o);for(const v of m.docs)await Le(xe(this.db,"tests",v.id)),console.log("Test deleted:",v.id);await Le(xe(this.db,"builds",l)),console.log("Build deleted:",l)}await Le(xe(this.db,"designs",g)),console.log("Design deleted:",g)}async getDesign(g){this.initialize();const p=xe(this.db,"designs",g),i=await ct(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",course:e.course||"",dateCreated:e.dateCreated,dateModified:e.dateModified,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async createBuild(g){this.initialize();const p={title:g.title,description:g.description,design_ID:g.designId,userId:g.userId,dateCreated:De(),dateModified:De(),images:g.images||[],files:g.files||[]},i=await lt(Ee(this.db,"builds"),p);return console.log("Build created with ID:",i.id),i.id}async updateBuild(g){this.initialize();const p={dateModified:De()};g.title!==void 0&&(p.title=g.title),g.description!==void 0&&(p.description=g.description),g.images!==void 0&&(p.images=g.images),g.files!==void 0&&(p.files=g.files);const i=xe(this.db,"builds",g.id);await dt(i,p),console.log("Build updated:",g.id)}async deleteBuild(g,p){this.initialize();const i=Qe(Ee(this.db,"tests"),ke("build_ID","==",g),ke("userId","==",p)),e=await Ge(i);for(const t of e.docs)await Le(xe(this.db,"tests",t.id)),console.log("Test deleted:",t.id);await Le(xe(this.db,"builds",g)),console.log("Build deleted:",g)}async getBuild(g){this.initialize();const p=xe(this.db,"builds",g),i=await ct(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",design_ID:e.design_ID||"",dateCreated:e.dateCreated,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async getBuildsByDesign(g){this.initialize();const p=Qe(Ee(this.db,"builds"),ke("design_ID","==",g),At("dateCreated","desc"));return(await Ge(p)).docs.map(e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}})}async createTest(g){this.initialize();const p={title:g.title,description:g.description,results:g.results,conclusions:g.conclusions,build_ID:g.buildId,design_ID:g.designId,userId:g.userId,dateCreated:De(),dateModified:De(),images:g.images||[],files:g.files||[]},i=await lt(Ee(this.db,"tests"),p);return console.log("Test created with ID:",i.id),i.id}async updateTest(g){this.initialize();const p={dateModified:De()};g.title!==void 0&&(p.title=g.title),g.description!==void 0&&(p.description=g.description),g.results!==void 0&&(p.results=g.results),g.conclusions!==void 0&&(p.conclusions=g.conclusions),g.images!==void 0&&(p.images=g.images),g.files!==void 0&&(p.files=g.files);const i=xe(this.db,"tests",g.id);await dt(i,p),console.log("Test updated:",g.id)}async deleteTest(g,p){this.initialize(),await Le(xe(this.db,"tests",g)),console.log("Test deleted:",g)}async getTest(g){this.initialize();const p=xe(this.db,"tests",g),i=await ct(p);if(i.exists()){const e=i.data();return{id:i.id,title:e.title||"",description:e.description||"",results:e.results||"",conclusions:e.conclusions||"",build_ID:e.build_ID||"",design_ID:e.design_ID||"",dateCreated:e.dateCreated,dateModified:e.dateModified,userId:e.userId||"",images:e.images||[],files:e.files||[]}}return null}async getTestsByBuild(g){this.initialize();const p=Qe(Ee(this.db,"tests"),ke("build_ID","==",g),At("dateCreated","desc"));return(await Ge(p)).docs.map(e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",results:t.results||"",conclusions:t.conclusions||"",build_ID:t.build_ID||"",design_ID:t.design_ID||"",dateCreated:t.dateCreated,dateModified:t.dateModified,userId:t.userId||"",images:t.images||[],files:t.files||[]}})}}let ht=null;const Lt=()=>(ht||(ht=new Fr),ht),Ur=Lt(),Er=Object.freeze(Object.defineProperty({__proto__:null,getLabNotebookService:Lt,labNotebookService:Ur},Symbol.toStringTag,{value:"Module"})),Gr=({open:y,title:g,message:p,confirmLabel:i="Confirm",cancelLabel:e="Cancel",onConfirm:t,onCancel:l,isDestructive:o=!1})=>P.jsxs(jt,{open:y,onClose:l,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:re.xl}},children:[P.jsx(ar,{children:P.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:$[2]},children:[o&&P.jsx(lr,{sx:{color:N.error,fontSize:28}}),P.jsx(ae,{variant:"h5",sx:{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.bold,color:N.text.primary},children:g})]})}),P.jsx(Tt,{children:P.jsx(ae,{variant:"body1",sx:{color:N.text.secondary,lineHeight:G.lineHeight.relaxed},children:p})}),P.jsxs(dr,{sx:{p:$[3],gap:$[2]},children:[P.jsx(Je,{onClick:l,variant:"outlined",sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium},children:e}),P.jsx(Je,{onClick:t,variant:"contained",sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium,backgroundColor:o?N.error:N.primary[500],"&:hover":{backgroundColor:o?"#C62828":N.primary[600]}},children:i})]})]}),qr=({content:y,maxLines:g})=>{const p=Ke.sanitize(y||"");return P.jsx(se,{sx:{"& p":{margin:0,marginBottom:$[2],color:N.text.primary,fontSize:G.fontSize.base,fontFamily:G.fontFamily.secondary,lineHeight:1.6},"& p:last-child":{marginBottom:0},"& h1, & h2, & h3":{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.bold,color:N.text.primary,marginTop:$[3],marginBottom:$[2]},"& h1":{fontSize:G.fontSize["2xl"]},"& h2":{fontSize:G.fontSize.xl},"& h3":{fontSize:G.fontSize.lg},"& strong":{fontWeight:G.fontWeight.semibold},"& em":{fontStyle:"italic"},"& u":{textDecoration:"underline"},"& s":{textDecoration:"line-through"},"& a":{color:N.primary[500],textDecoration:"none","&:hover":{textDecoration:"underline"}},"& ul, & ol":{paddingLeft:$[6],marginBottom:$[2],fontFamily:G.fontFamily.secondary},"& li":{marginBottom:$[1],fontFamily:G.fontFamily.secondary},"& blockquote":{borderLeft:`4px solid ${N.primary[500]}`,paddingLeft:$[4],marginLeft:0,marginBottom:$[2],fontStyle:"italic",color:N.text.secondary,fontFamily:G.fontFamily.secondary},"& code":{backgroundColor:N.background.secondary,padding:`${$[.5]} ${$[1.5]}`,borderRadius:"4px",fontSize:G.fontSize.sm,fontFamily:"monospace"},"& pre":{backgroundColor:N.background.secondary,padding:$[3],borderRadius:"8px",overflow:"auto",marginBottom:$[2],"& code":{backgroundColor:"transparent",padding:0}},...g&&{display:"-webkit-box",WebkitLineClamp:g,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"}},dangerouslySetInnerHTML:{__html:p}})},Vr=({value:y,onChange:g,placeholder:p="Start writing...",minHeight:i=200,disabled:e=!1})=>{const[t,l]=le.useState(Ke.sanitize(y||"")),[o,m]=le.useState(null),[v,n]=le.useState(null),s=le.useRef(null),r=le.useRef(!1);le.useEffect(()=>{if(r.current){const h=Ke.sanitize(y||"");h!==t&&l(h)}else r.current=!0},[y]);const a=h=>{const U=Ke.sanitize(h);l(U),g(U)},b=h=>{if(!s.current){console.warn("Editor not initialized");return}const U=s.current.getEditor(),f=U.getSelection();if(f)U.insertText(f.index,h),U.setSelection(f.index+h.length);else{const c=U.getText().length;U.insertText(c,h),U.setSelection(c+h.length)}m(null),n(null),U.focus()},D=h=>{m(h.currentTarget),n(null)},j=h=>{n(h.currentTarget),m(null)},x=()=>{m(null),n(null)},k=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],F=["+","−","×","÷","±","=","≈","≠","≤","≥","<",">","°","∞","√","∑","∫","π","Δ","∂","∇","∈","∉","⊂","⊃","∩","∪","∅"],_={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],["blockquote","code-block"],["link"],["clean"]]},M=["header","bold","italic","underline","strike","list","script","indent","blockquote","code-block","link"];return P.jsxs(se,{children:[P.jsxs(se,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:$[1],mb:$[2]},children:[P.jsx(ae,{variant:"body2",sx:{color:N.text.secondary,fontSize:G.fontSize.sm,fontWeight:G.fontWeight.medium,mr:$[1]},children:"Insert:"}),P.jsx(et,{title:"Math Symbols",placement:"top",children:P.jsx(Ne,{onClick:D,disabled:e,size:"small",sx:{border:`1px solid ${N.neutral[300]}`,borderRadius:re.md,backgroundColor:o?N.primary[50]:N.background.primary,"&:hover":{backgroundColor:N.primary[50],borderColor:N.primary[400]}},children:P.jsx(cr,{sx:{fontSize:18,color:N.primary[600]}})})}),P.jsx(et,{title:"Greek Letters",placement:"top",children:P.jsx(Ne,{onClick:j,disabled:e,size:"small",sx:{border:`1px solid ${N.neutral[300]}`,borderRadius:re.md,backgroundColor:v?N.primary[50]:N.background.primary,fontWeight:G.fontWeight.bold,fontSize:G.fontSize.lg,color:N.primary[600],"&:hover":{backgroundColor:N.primary[50],borderColor:N.primary[400]}},children:"Ω"})})]}),P.jsx(Ct,{open:!!o,anchorEl:o,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:re.lg,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",mt:$[1]}},children:P.jsxs(se,{sx:{p:$[2],maxWidth:320},children:[P.jsx(ae,{variant:"subtitle2",sx:{fontWeight:G.fontWeight.semibold,color:N.text.primary,mb:$[2]},children:"Math Symbols"}),P.jsx(se,{sx:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",gap:$[1]},children:F.map(h=>P.jsx(_t,{onClick:()=>b(h),sx:{width:32,height:32,borderRadius:re.md,border:`1px solid ${N.neutral[200]}`,backgroundColor:N.background.primary,fontSize:G.fontSize.lg,fontWeight:G.fontWeight.medium,color:N.text.primary,transition:"all 0.2s","&:hover":{backgroundColor:N.primary[50],borderColor:N.primary[400],transform:"scale(1.1)"}},children:h},h))})]})}),P.jsx(Ct,{open:!!v,anchorEl:v,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:re.lg,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",mt:$[1]}},children:P.jsxs(se,{sx:{p:$[2],maxWidth:360},children:[P.jsx(ae,{variant:"subtitle2",sx:{fontWeight:G.fontWeight.semibold,color:N.text.primary,mb:$[2]},children:"Greek Letters"}),P.jsx(se,{sx:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:$[1]},children:k.map(h=>P.jsx(_t,{onClick:()=>b(h),sx:{width:28,height:28,borderRadius:re.md,border:`1px solid ${N.neutral[200]}`,backgroundColor:N.background.primary,fontSize:G.fontSize.base,fontWeight:G.fontWeight.medium,color:N.text.primary,transition:"all 0.2s","&:hover":{backgroundColor:N.primary[50],borderColor:N.primary[400],transform:"scale(1.15)"}},children:h},h))})]})}),P.jsx(se,{sx:{"& .quill":{borderRadius:re.lg,border:`1px solid ${N.neutral[300]}`,backgroundColor:N.background.primary},"& .ql-toolbar":{borderTopLeftRadius:re.lg,borderTopRightRadius:re.lg,borderBottom:`1px solid ${N.neutral[200]}`,backgroundColor:N.background.secondary},"& .ql-container":{borderBottomLeftRadius:re.lg,borderBottomRightRadius:re.lg,minHeight:`${i}px`,fontSize:G.fontSize.base,fontFamily:G.fontFamily.body},"& .ql-editor":{minHeight:`${i}px`,color:N.text.primary},"& .ql-editor.ql-blank::before":{color:N.text.tertiary,fontStyle:"normal"}},children:P.jsx(ir,{ref:s,value:t,onChange:a,modules:_,formats:M,theme:"snow",placeholder:p,readOnly:e})})]})};function kr(y,g){return g.forEach(function(p){p&&typeof p!="string"&&!Array.isArray(p)&&Object.keys(p).forEach(function(i){if(i!=="default"&&!(i in y)){var e=Object.getOwnPropertyDescriptor(p,i);Object.defineProperty(y,i,e.get?e:{enumerable:!0,get:function(){return p[i]}})}})}),Object.freeze(y)}function Ot(y,g){return new Promise(function(p,i){let e;return Rr(y).then(function(t){try{return e=t,p(new Blob([g.slice(0,2),e,g.slice(2)],{type:"image/jpeg"}))}catch(l){return i(l)}},i)})}const Rr=y=>new Promise((g,p)=>{const i=new FileReader;i.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let l=0;if(t.getUint16(l)!==65496)return p("not a valid JPEG");for(l+=2;;){const o=t.getUint16(l);if(o===65498)break;const m=t.getUint16(l+2);if(o===65505&&t.getUint32(l+4)===1165519206){const v=l+10;let n;switch(t.getUint16(v)){case 18761:n=!0;break;case 19789:n=!1;break;default:return p("TIFF header contains invalid endian")}if(t.getUint16(v+2,n)!==42)return p("TIFF header contains invalid version");const s=t.getUint32(v+4,n),r=v+s+2+12*t.getUint16(v+s,n);for(let a=v+s+2;a<r;a+=12)if(t.getUint16(a,n)==274){if(t.getUint16(a+2,n)!==3)return p("Orientation data type is invalid");if(t.getUint32(a+4,n)!==1)return p("Orientation data count is invalid");t.setUint16(a+8,1,n);break}return g(e.slice(l,l+2+m))}l+=2+m}return g(new Blob)}),i.readAsArrayBuffer(y)});var tt={},jr={get exports(){return tt},set exports(y){tt=y}};(function(y){var g,p,i={};jr.exports=i,i.parse=function(e,t){for(var l=i.bin.readUshort,o=i.bin.readUint,m=0,v={},n=new Uint8Array(e),s=n.length-4;o(n,s)!=101010256;)s--;m=s,m+=4;var r=l(n,m+=4);l(n,m+=2);var a=o(n,m+=2),b=o(n,m+=4);m+=4,m=b;for(var D=0;D<r;D++){o(n,m),m+=4,m+=4,m+=4,o(n,m+=4),a=o(n,m+=4);var j=o(n,m+=4),x=l(n,m+=4),k=l(n,m+2),F=l(n,m+4);m+=6;var _=o(n,m+=8);m+=4,m+=x+k+F,i._readLocal(n,_,v,a,j,t)}return v},i._readLocal=function(e,t,l,o,m,v){var n=i.bin.readUshort,s=i.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var a=n(e,t+=8),b=n(e,t+=2);t+=2;var D=i.bin.readUTF8(e,t,a);if(t+=a,t+=b,v)l[D]={size:m,csize:o};else{var j=new Uint8Array(e.buffer,t);if(r==0)l[D]=new Uint8Array(j.buffer.slice(t,t+o));else{if(r!=8)throw"unknown compression method: "+r;var x=new Uint8Array(m);i.inflateRaw(j,x),l[D]=x}}},i.inflateRaw=function(e,t){return i.F.inflate(e,t)},i.inflate=function(e,t){return e[0],e[1],i.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},i.deflate=function(e,t){t==null&&(t={level:6});var l=0,o=new Uint8Array(50+Math.floor(1.1*e.length));o[l]=120,o[l+1]=156,l+=2,l=i.F.deflateRaw(e,o,l,t.level);var m=i.adler(e,0,e.length);return o[l+0]=m>>>24&255,o[l+1]=m>>>16&255,o[l+2]=m>>>8&255,o[l+3]=m>>>0&255,new Uint8Array(o.buffer,0,l+4)},i.deflateRaw=function(e,t){t==null&&(t={level:6});var l=new Uint8Array(50+Math.floor(1.1*e.length)),o=i.F.deflateRaw(e,l,o,t.level);return new Uint8Array(l.buffer,0,o)},i.encode=function(e,t){t==null&&(t=!1);var l=0,o=i.bin.writeUint,m=i.bin.writeUshort,v={};for(var n in e){var s=!i._noNeed(n)&&!t,r=e[n],a=i.crc.crc(r,0,r.length);v[n]={cpr:s,usize:r.length,crc:a,file:s?i.deflateRaw(r):r}}for(var n in v)l+=v[n].file.length+30+46+2*i.bin.sizeUTF8(n);l+=22;var b=new Uint8Array(l),D=0,j=[];for(var n in v){var x=v[n];j.push(D),D=i._writeHeader(b,D,n,x,0)}var k=0,F=D;for(var n in v)x=v[n],j.push(D),D=i._writeHeader(b,D,n,x,1,j[k++]);var _=D-F;return o(b,D,101010256),D+=4,m(b,D+=4,k),m(b,D+=2,k),o(b,D+=2,_),o(b,D+=4,F),D+=4,D+=2,b.buffer},i._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},i._writeHeader=function(e,t,l,o,m,v){var n=i.bin.writeUint,s=i.bin.writeUshort,r=o.file;return n(e,t,m==0?67324752:33639248),t+=4,m==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,o.cpr?8:0),n(e,t+=2,0),n(e,t+=4,o.crc),n(e,t+=4,r.length),n(e,t+=4,o.usize),s(e,t+=4,i.bin.sizeUTF8(l)),s(e,t+=2,0),t+=2,m==1&&(t+=2,t+=2,n(e,t+=6,v),t+=4),t+=i.bin.writeUTF8(e,t,l),m==0&&(e.set(r,t),t+=r.length),t},i.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var l=t,o=0;o<8;o++)1&l?l=3988292384^l>>>1:l>>>=1;e[t]=l}return e}(),update:function(e,t,l,o){for(var m=0;m<o;m++)e=i.crc.table[255&(e^t[l+m])]^e>>>8;return e},crc:function(e,t,l){return 4294967295^i.crc.update(4294967295,e,t,l)}},i.adler=function(e,t,l){for(var o=1,m=0,v=t,n=t+l;v<n;){for(var s=Math.min(v+5552,n);v<s;)m+=o+=e[v++];o%=65521,m%=65521}return m<<16|o},i.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,l){e[t]=255&l,e[t+1]=l>>8&255,e[t+2]=l>>16&255,e[t+3]=l>>24&255},readASCII:function(e,t,l){for(var o="",m=0;m<l;m++)o+=String.fromCharCode(e[t+m]);return o},writeASCII:function(e,t,l){for(var o=0;o<l.length;o++)e[t+o]=l.charCodeAt(o)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,l){for(var o,m="",v=0;v<l;v++)m+="%"+i.bin.pad(e[t+v].toString(16));try{o=decodeURIComponent(m)}catch{return i.bin.readASCII(e,t,l)}return o},writeUTF8:function(e,t,l){for(var o=l.length,m=0,v=0;v<o;v++){var n=l.charCodeAt(v);if((4294967168&n)==0)e[t+m]=n,m++;else if((4294965248&n)==0)e[t+m]=192|n>>6,e[t+m+1]=128|n>>0&63,m+=2;else if((4294901760&n)==0)e[t+m]=224|n>>12,e[t+m+1]=128|n>>6&63,e[t+m+2]=128|n>>0&63,m+=3;else{if((4292870144&n)!=0)throw"e";e[t+m]=240|n>>18,e[t+m+1]=128|n>>12&63,e[t+m+2]=128|n>>6&63,e[t+m+3]=128|n>>0&63,m+=4}}return m},sizeUTF8:function(e){for(var t=e.length,l=0,o=0;o<t;o++){var m=e.charCodeAt(o);if((4294967168&m)==0)l++;else if((4294965248&m)==0)l+=2;else if((4294901760&m)==0)l+=3;else{if((4292870144&m)!=0)throw"e";l+=4}}return l}},i.F={},i.F.deflateRaw=function(e,t,l,o){var m=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],v=i.F.U,n=i.F._goodIndex;i.F._hash;var s=i.F._putsE,r=0,a=l<<3,b=0,D=e.length;if(o==0){for(;r<D;)s(t,a,r+(A=Math.min(65535,D-r))==D?1:0),a=i.F._copyExact(e,r,A,t,a+8),r+=A;return a>>>3}var j=v.lits,x=v.strt,k=v.prev,F=0,_=0,M=0,h=0,U=0,f=0;for(D>2&&(x[f=i.F._hash(e,0)]=0),r=0;r<D;r++){if(U=f,r+1<D-2){f=i.F._hash(e,r+1);var c=r+1&32767;k[c]=x[f],x[f]=c}if(b<=r){(F>14e3||_>26697)&&D-r>100&&(b<r&&(j[F]=r-b,F+=2,b=r),a=i.F._writeBlock(r==D-1||b==D?1:0,j,F,h,e,M,r-M,t,a),F=_=h=0,M=r);var w=0;r<D-2&&(w=i.F._bestMatch(e,r,k,U,Math.min(m[2],D-r),m[3]));var A=w>>>16,C=65535&w;if(w!=0){C=65535&w;var S=n(A=w>>>16,v.of0);v.lhst[257+S]++;var I=n(C,v.df0);v.dhst[I]++,h+=v.exb[S]+v.dxb[I],j[F]=A<<23|r-b,j[F+1]=C<<16|S<<8|I,F+=2,b=r+A}else v.lhst[e[r]]++;_++}}for(M==r&&e.length!=0||(b<r&&(j[F]=r-b,F+=2,b=r),a=i.F._writeBlock(1,j,F,h,e,M,r-M,t,a),F=0,_=0,F=_=h=0,M=r);(7&a)!=0;)a++;return a>>>3},i.F._bestMatch=function(e,t,l,o,m,v){var n=32767&t,s=l[n],r=n-s+32768&32767;if(s==n||o!=i.F._hash(e,t-r))return 0;for(var a=0,b=0,D=Math.min(32767,t);r<=D&&--v!=0&&s!=n;){if(a==0||e[t+a]==e[t+a-r]){var j=i.F._howLong(e,t,r);if(j>a){if(b=r,(a=j)>=m)break;r+2<j&&(j=r+2);for(var x=0,k=0;k<j-2;k++){var F=t-r+k+32768&32767,_=F-l[F]+32768&32767;_>x&&(x=_,s=F)}}}r+=(n=s)-(s=l[n])+32768&32767}return a<<16|b},i.F._howLong=function(e,t,l){if(e[t]!=e[t-l]||e[t+1]!=e[t+1-l]||e[t+2]!=e[t+2-l])return 0;var o=t,m=Math.min(e.length,t+258);for(t+=3;t<m&&e[t]==e[t-l];)t++;return t-o},i.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},i.saved=0,i.F._writeBlock=function(e,t,l,o,m,v,n,s,r){var a,b,D,j,x,k,F,_,M,h=i.F.U,U=i.F._putsF,f=i.F._putsE;h.lhst[256]++,b=(a=i.F.getTrees())[0],D=a[1],j=a[2],x=a[3],k=a[4],F=a[5],_=a[6],M=a[7];var c=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),w=o+i.F.contSize(h.fltree,h.lhst)+i.F.contSize(h.fdtree,h.dhst),A=o+i.F.contSize(h.ltree,h.lhst)+i.F.contSize(h.dtree,h.dhst);A+=14+3*F+i.F.contSize(h.itree,h.ihst)+(2*h.ihst[16]+3*h.ihst[17]+7*h.ihst[18]);for(var C=0;C<286;C++)h.lhst[C]=0;for(C=0;C<30;C++)h.dhst[C]=0;for(C=0;C<19;C++)h.ihst[C]=0;var S=c<w&&c<A?0:w<A?1:2;if(U(s,r,e),U(s,r+1,S),r+=3,S==0){for(;(7&r)!=0;)r++;r=i.F._copyExact(m,v,n,s,r)}else{var I,R;if(S==1&&(I=h.fltree,R=h.fdtree),S==2){i.F.makeCodes(h.ltree,b),i.F.revCodes(h.ltree,b),i.F.makeCodes(h.dtree,D),i.F.revCodes(h.dtree,D),i.F.makeCodes(h.itree,j),i.F.revCodes(h.itree,j),I=h.ltree,R=h.dtree,f(s,r,x-257),f(s,r+=5,k-1),f(s,r+=5,F-4),r+=4;for(var u=0;u<F;u++)f(s,r+3*u,h.itree[1+(h.ordr[u]<<1)]);r+=3*F,r=i.F._codeTiny(_,h.itree,s,r),r=i.F._codeTiny(M,h.itree,s,r)}for(var d=v,z=0;z<l;z+=2){for(var E=t[z],B=E>>>23,O=d+(8388607&E);d<O;)r=i.F._writeLit(m[d++],I,s,r);if(B!=0){var W=t[z+1],H=W>>16,L=W>>8&255,T=255&W;f(s,r=i.F._writeLit(257+L,I,s,r),B-h.of0[L]),r+=h.exb[L],U(s,r=i.F._writeLit(T,R,s,r),H-h.df0[T]),r+=h.dxb[T],d+=B}}r=i.F._writeLit(256,I,s,r)}return r},i.F._copyExact=function(e,t,l,o,m){var v=m>>>3;return o[v]=l,o[v+1]=l>>>8,o[v+2]=255-o[v],o[v+3]=255-o[v+1],v+=4,o.set(new Uint8Array(e.buffer,t,l),v),m+(l+4<<3)},i.F.getTrees=function(){for(var e=i.F.U,t=i.F._hufTree(e.lhst,e.ltree,15),l=i.F._hufTree(e.dhst,e.dtree,15),o=[],m=i.F._lenCodes(e.ltree,o),v=[],n=i.F._lenCodes(e.dtree,v),s=0;s<o.length;s+=2)e.ihst[o[s]]++;for(s=0;s<v.length;s+=2)e.ihst[v[s]]++;for(var r=i.F._hufTree(e.ihst,e.itree,7),a=19;a>4&&e.itree[1+(e.ordr[a-1]<<1)]==0;)a--;return[t,l,r,m,n,a,o,v]},i.F.getSecond=function(e){for(var t=[],l=0;l<e.length;l+=2)t.push(e[l+1]);return t},i.F.nonZero=function(e){for(var t="",l=0;l<e.length;l+=2)e[l+1]!=0&&(t+=(l>>1)+",");return t},i.F.contSize=function(e,t){for(var l=0,o=0;o<t.length;o++)l+=t[o]*e[1+(o<<1)];return l},i.F._codeTiny=function(e,t,l,o){for(var m=0;m<e.length;m+=2){var v=e[m],n=e[m+1];o=i.F._writeLit(v,t,l,o);var s=v==16?2:v==17?3:7;v>15&&(i.F._putsE(l,o,n,s),o+=s)}return o},i.F._lenCodes=function(e,t){for(var l=e.length;l!=2&&e[l-1]==0;)l-=2;for(var o=0;o<l;o+=2){var m=e[o+1],v=o+3<l?e[o+3]:-1,n=o+5<l?e[o+5]:-1,s=o==0?-1:e[o-1];if(m==0&&v==m&&n==m){for(var r=o+5;r+2<l&&e[r+2]==m;)r+=2;(a=Math.min(r+1-o>>>1,138))<11?t.push(17,a-3):t.push(18,a-11),o+=2*a-2}else if(m==s&&v==m&&n==m){for(r=o+5;r+2<l&&e[r+2]==m;)r+=2;var a=Math.min(r+1-o>>>1,6);t.push(16,a-3),o+=2*a-2}else t.push(m,0)}return l>>>1},i.F._hufTree=function(e,t,l){var o=[],m=e.length,v=t.length,n=0;for(n=0;n<v;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<m;n++)e[n]!=0&&o.push({lit:n,f:e[n]});var s=o.length,r=o.slice(0);if(s==0)return 0;if(s==1){var a=o[0].lit;return r=a==0?1:0,t[1+(a<<1)]=1,t[1+(r<<1)]=1,1}o.sort(function(_,M){return _.f-M.f});var b=o[0],D=o[1],j=0,x=1,k=2;for(o[0]={lit:-1,f:b.f+D.f,l:b,r:D,d:0};x!=s-1;)b=j!=x&&(k==s||o[j].f<o[k].f)?o[j++]:o[k++],D=j!=x&&(k==s||o[j].f<o[k].f)?o[j++]:o[k++],o[x++]={lit:-1,f:b.f+D.f,l:b,r:D};var F=i.F.setDepth(o[x-1],0);for(F>l&&(i.F.restrictDepth(r,l,F),F=l),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return F},i.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(i.F.setDepth(e.l,t+1),i.F.setDepth(e.r,t+1))},i.F.restrictDepth=function(e,t,l){var o=0,m=1<<l-t,v=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),o=0;o<e.length&&e[o].d>t;o++){var n=e[o].d;e[o].d=t,v+=m-(1<<l-n)}for(v>>>=l-t;v>0;)(n=e[o].d)<t?(e[o].d++,v-=1<<t-n-1):o++;for(;o>=0;o--)e[o].d==t&&v<0&&(e[o].d--,v++);v!=0&&console.log("debt left")},i.F._goodIndex=function(e,t){var l=0;return t[16|l]<=e&&(l|=16),t[8|l]<=e&&(l|=8),t[4|l]<=e&&(l|=4),t[2|l]<=e&&(l|=2),t[1|l]<=e&&(l|=1),l},i.F._writeLit=function(e,t,l,o){return i.F._putsF(l,o,t[e<<1]),o+t[1+(e<<1)]},i.F.inflate=function(e,t){var l=Uint8Array;if(e[0]==3&&e[1]==0)return t||new l(0);var o=i.F,m=o._bitsF,v=o._bitsE,n=o._decodeTiny,s=o.makeCodes,r=o.codes2map,a=o._get17,b=o.U,D=t==null;D&&(t=new l(e.length>>>2<<3));for(var j,x,k=0,F=0,_=0,M=0,h=0,U=0,f=0,c=0,w=0;k==0;)if(k=m(e,w,1),F=m(e,w+1,2),w+=3,F!=0){if(D&&(t=i.F._check(t,c+(1<<17))),F==1&&(j=b.flmap,x=b.fdmap,U=511,f=31),F==2){_=v(e,w,5)+257,M=v(e,w+5,5)+1,h=v(e,w+10,4)+4,w+=14;for(var A=0;A<38;A+=2)b.itree[A]=0,b.itree[A+1]=0;var C=1;for(A=0;A<h;A++){var S=v(e,w+3*A,3);b.itree[1+(b.ordr[A]<<1)]=S,S>C&&(C=S)}w+=3*h,s(b.itree,C),r(b.itree,C,b.imap),j=b.lmap,x=b.dmap,w=n(b.imap,(1<<C)-1,_+M,e,w,b.ttree);var I=o._copyOut(b.ttree,0,_,b.ltree);U=(1<<I)-1;var R=o._copyOut(b.ttree,_,M,b.dtree);f=(1<<R)-1,s(b.ltree,I),r(b.ltree,I,j),s(b.dtree,R),r(b.dtree,R,x)}for(;;){var u=j[a(e,w)&U];w+=15&u;var d=u>>>4;if(!(d>>>8))t[c++]=d;else{if(d==256)break;var z=c+d-254;if(d>264){var E=b.ldef[d-257];z=c+(E>>>3)+v(e,w,7&E),w+=7&E}var B=x[a(e,w)&f];w+=15&B;var O=B>>>4,W=b.ddef[O],H=(W>>>4)+m(e,w,15&W);for(w+=15&W,D&&(t=i.F._check(t,c+(1<<17)));c<z;)t[c]=t[c++-H],t[c]=t[c++-H],t[c]=t[c++-H],t[c]=t[c++-H];c=z}}}else{(7&w)!=0&&(w+=8-(7&w));var L=4+(w>>>3),T=e[L-4]|e[L-3]<<8;D&&(t=i.F._check(t,c+T)),t.set(new l(e.buffer,e.byteOffset+L,T),c),w=L+T<<3,c+=T}return t.length==c?t:t.slice(0,c)},i.F._check=function(e,t){var l=e.length;if(t<=l)return e;var o=new Uint8Array(Math.max(l<<1,t));return o.set(e,0),o},i.F._decodeTiny=function(e,t,l,o,m,v){for(var n=i.F._bitsE,s=i.F._get17,r=0;r<l;){var a=e[s(o,m)&t];m+=15&a;var b=a>>>4;if(b<=15)v[r]=b,r++;else{var D=0,j=0;b==16?(j=3+n(o,m,2),m+=2,D=v[r-1]):b==17?(j=3+n(o,m,3),m+=3):b==18&&(j=11+n(o,m,7),m+=7);for(var x=r+j;r<x;)v[r]=D,r++}}return m},i.F._copyOut=function(e,t,l,o){for(var m=0,v=0,n=o.length>>>1;v<l;){var s=e[v+t];o[v<<1]=0,o[1+(v<<1)]=s,s>m&&(m=s),v++}for(;v<n;)o[v<<1]=0,o[1+(v<<1)]=0,v++;return m},i.F.makeCodes=function(e,t){for(var l,o,m,v,n=i.F.U,s=e.length,r=n.bl_count,a=0;a<=t;a++)r[a]=0;for(a=1;a<s;a+=2)r[e[a]]++;var b=n.next_code;for(l=0,r[0]=0,o=1;o<=t;o++)l=l+r[o-1]<<1,b[o]=l;for(m=0;m<s;m+=2)(v=e[m+1])!=0&&(e[m]=b[v],b[v]++)},i.F.codes2map=function(e,t,l){for(var o=e.length,m=i.F.U.rev15,v=0;v<o;v+=2)if(e[v+1]!=0)for(var n=v>>1,s=e[v+1],r=n<<4|s,a=t-s,b=e[v]<<a,D=b+(1<<a);b!=D;)l[m[b]>>>15-t]=r,b++},i.F.revCodes=function(e,t){for(var l=i.F.U.rev15,o=15-t,m=0;m<e.length;m+=2){var v=e[m]<<t-e[m+1];e[m]=l[v]>>>o}},i.F._putsE=function(e,t,l){l<<=7&t;var o=t>>>3;e[o]|=l,e[o+1]|=l>>>8},i.F._putsF=function(e,t,l){l<<=7&t;var o=t>>>3;e[o]|=l,e[o+1]|=l>>>8,e[o+2]|=l>>>16},i.F._bitsE=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<l)-1},i.F._bitsF=function(e,t,l){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<l)-1},i.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},i.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},i.F.U=(g=Uint16Array,p=Uint32Array,{next_code:new g(16),bl_count:new g(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new g(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new p(32),flmap:new g(512),fltree:[],fdmap:new g(32),fdtree:[],lmap:new g(32768),ltree:[],ttree:[],dmap:new g(32768),dtree:[],imap:new g(512),itree:[],rev15:new g(32768),lhst:new p(286),dhst:new p(30),ihst:new p(19),lits:new p(15e3),strt:new g(65536),prev:new g(32768)}),function(){for(var e=i.F.U,t=0;t<32768;t++){var l=t;l=(4278255360&(l=(4042322160&(l=(3435973836&(l=(2863311530&l)>>>1|(1431655765&l)<<1))>>>2|(858993459&l)<<2))>>>4|(252645135&l)<<4))>>>8|(16711935&l)<<8,e.rev15[t]=(l>>>16|l<<16)>>>17}function o(m,v,n){for(;v--!=0;)m.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];o(e.fltree,144,8),o(e.fltree,112,9),o(e.fltree,24,7),o(e.fltree,8,8),i.F.makeCodes(e.fltree,9),i.F.codes2map(e.fltree,9,e.flmap),i.F.revCodes(e.fltree,9),o(e.fdtree,32,5),i.F.makeCodes(e.fdtree,5),i.F.codes2map(e.fdtree,5,e.fdmap),i.F.revCodes(e.fdtree,5),o(e.itree,19,0),o(e.ltree,286,0),o(e.dtree,30,0),o(e.ttree,320,0)}()})();var Tr=kr({__proto__:null,default:tt},[tt]);const we=function(){var y={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let a="";for(let b=0;b<r;b++)a+=String.fromCharCode(n[s+b]);return a},writeASCII(n,s,r){for(let a=0;a<r.length;a++)n[s+a]=r.charCodeAt(a)},readBytes(n,s,r){const a=[];for(let b=0;b<r;b++)a.push(n[s+b]);return a},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let a,b="";for(let D=0;D<r;D++)b+=`%${y.pad(n[s+D].toString(16))}`;try{a=decodeURIComponent(b)}catch{return y.readASCII(n,s,r)}return a}};function g(n,s,r,a){const b=s*r,D=t(a),j=Math.ceil(s*D/8),x=new Uint8Array(4*b),k=new Uint32Array(x.buffer),{ctype:F}=a,{depth:_}=a,M=y.readUshort;if(F==6){const E=b<<2;if(_==8)for(var h=0;h<E;h+=4)x[h]=n[h],x[h+1]=n[h+1],x[h+2]=n[h+2],x[h+3]=n[h+3];if(_==16)for(h=0;h<E;h++)x[h]=n[h<<1]}else if(F==2){const E=a.tabs.tRNS;if(E==null){if(_==8)for(h=0;h<b;h++){var U=3*h;k[h]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U]}if(_==16)for(h=0;h<b;h++)U=6*h,k[h]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U]}else{var f=E[0];const B=E[1],O=E[2];if(_==8)for(h=0;h<b;h++){var c=h<<2;U=3*h,k[h]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U],n[U]==f&&n[U+1]==B&&n[U+2]==O&&(x[c+3]=0)}if(_==16)for(h=0;h<b;h++)c=h<<2,U=6*h,k[h]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U],M(n,U)==f&&M(n,U+2)==B&&M(n,U+4)==O&&(x[c+3]=0)}}else if(F==3){const E=a.tabs.PLTE,B=a.tabs.tRNS,O=B?B.length:0;if(_==1)for(var w=0;w<r;w++){var A=w*j,C=w*s;for(h=0;h<s;h++){c=C+h<<2;var S=3*(I=n[A+(h>>3)]>>7-((7&h)<<0)&1);x[c]=E[S],x[c+1]=E[S+1],x[c+2]=E[S+2],x[c+3]=I<O?B[I]:255}}if(_==2)for(w=0;w<r;w++)for(A=w*j,C=w*s,h=0;h<s;h++)c=C+h<<2,S=3*(I=n[A+(h>>2)]>>6-((3&h)<<1)&3),x[c]=E[S],x[c+1]=E[S+1],x[c+2]=E[S+2],x[c+3]=I<O?B[I]:255;if(_==4)for(w=0;w<r;w++)for(A=w*j,C=w*s,h=0;h<s;h++)c=C+h<<2,S=3*(I=n[A+(h>>1)]>>4-((1&h)<<2)&15),x[c]=E[S],x[c+1]=E[S+1],x[c+2]=E[S+2],x[c+3]=I<O?B[I]:255;if(_==8)for(h=0;h<b;h++){var I;c=h<<2,S=3*(I=n[h]),x[c]=E[S],x[c+1]=E[S+1],x[c+2]=E[S+2],x[c+3]=I<O?B[I]:255}}else if(F==4){if(_==8)for(h=0;h<b;h++){c=h<<2;var R=n[u=h<<1];x[c]=R,x[c+1]=R,x[c+2]=R,x[c+3]=n[u+1]}if(_==16)for(h=0;h<b;h++){var u;c=h<<2,R=n[u=h<<2],x[c]=R,x[c+1]=R,x[c+2]=R,x[c+3]=n[u+2]}}else if(F==0)for(f=a.tabs.tRNS?a.tabs.tRNS:-1,w=0;w<r;w++){const E=w*j,B=w*s;if(_==1)for(var d=0;d<s;d++){var z=(R=255*(n[E+(d>>>3)]>>>7-(7&d)&1))==255*f?0:255;k[B+d]=z<<24|R<<16|R<<8|R}else if(_==2)for(d=0;d<s;d++)z=(R=85*(n[E+(d>>>2)]>>>6-((3&d)<<1)&3))==85*f?0:255,k[B+d]=z<<24|R<<16|R<<8|R;else if(_==4)for(d=0;d<s;d++)z=(R=17*(n[E+(d>>>1)]>>>4-((1&d)<<2)&15))==17*f?0:255,k[B+d]=z<<24|R<<16|R<<8|R;else if(_==8)for(d=0;d<s;d++)z=(R=n[E+d])==f?0:255,k[B+d]=z<<24|R<<16|R<<8|R;else if(_==16)for(d=0;d<s;d++)R=n[E+(d<<1)],z=M(n,E+(d<<1))==f?0:255,k[B+d]=z<<24|R<<16|R<<8|R}return x}function p(n,s,r,a){const b=t(n),D=Math.ceil(r*b/8),j=new Uint8Array((D+1+n.interlace)*a);return s=n.tabs.CgBI?e(s,j):i(s,j),n.interlace==0?s=l(s,n,0,r,a):n.interlace==1&&(s=function(k,F){const _=F.width,M=F.height,h=t(F),U=h>>3,f=Math.ceil(_*h/8),c=new Uint8Array(M*f);let w=0;const A=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],S=[8,8,8,4,4,2,2],I=[8,8,4,4,2,2,1];let R=0;for(;R<7;){const d=S[R],z=I[R];let E=0,B=0,O=A[R];for(;O<M;)O+=d,B++;let W=C[R];for(;W<_;)W+=z,E++;const H=Math.ceil(E*h/8);l(k,F,w,E,B);let L=0,T=A[R];for(;T<M;){let Q=C[R],Y=w+L*H<<3;for(;Q<_;){var u;if(h==1&&(u=(u=k[Y>>3])>>7-(7&Y)&1,c[T*f+(Q>>3)]|=u<<7-((7&Q)<<0)),h==2&&(u=(u=k[Y>>3])>>6-(7&Y)&3,c[T*f+(Q>>2)]|=u<<6-((3&Q)<<1)),h==4&&(u=(u=k[Y>>3])>>4-(7&Y)&15,c[T*f+(Q>>1)]|=u<<4-((1&Q)<<2)),h>=8){const V=T*f+Q*U;for(let q=0;q<U;q++)c[V+q]=k[(Y>>3)+q]}Y+=h,Q+=z}L++,T+=d}E*B!=0&&(w+=B*(1+H)),R+=1}return c}(s,n)),s}function i(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const a=Uint8Array;let b,D,j=0,x=0,k=0,F=0,_=0,M=0,h=0,U=0,f=0;if(s[0]==3&&s[1]==0)return r||new a(0);const c=n.H,w=c.b,A=c.e,C=c.R,S=c.n,I=c.A,R=c.Z,u=c.m,d=r==null;for(d&&(r=new a(s.length>>>2<<5));j==0;)if(j=w(s,f,1),x=w(s,f+1,2),f+=3,x!=0){if(d&&(r=n.H.W(r,U+(1<<17))),x==1&&(b=u.J,D=u.h,M=511,h=31),x==2){k=A(s,f,5)+257,F=A(s,f+5,5)+1,_=A(s,f+10,4)+4,f+=14;let E=1;for(var z=0;z<38;z+=2)u.Q[z]=0,u.Q[z+1]=0;for(z=0;z<_;z++){const W=A(s,f+3*z,3);u.Q[1+(u.X[z]<<1)]=W,W>E&&(E=W)}f+=3*_,S(u.Q,E),I(u.Q,E,u.u),b=u.w,D=u.d,f=C(u.u,(1<<E)-1,k+F,s,f,u.v);const B=c.V(u.v,0,k,u.C);M=(1<<B)-1;const O=c.V(u.v,k,F,u.D);h=(1<<O)-1,S(u.C,B),I(u.C,B,b),S(u.D,O),I(u.D,O,D)}for(;;){const E=b[R(s,f)&M];f+=15&E;const B=E>>>4;if(!(B>>>8))r[U++]=B;else{if(B==256)break;{let O=U+B-254;if(B>264){const Q=u.q[B-257];O=U+(Q>>>3)+A(s,f,7&Q),f+=7&Q}const W=D[R(s,f)&h];f+=15&W;const H=W>>>4,L=u.c[H],T=(L>>>4)+w(s,f,15&L);for(f+=15&L;U<O;)r[U]=r[U++-T],r[U]=r[U++-T],r[U]=r[U++-T],r[U]=r[U++-T];U=O}}}}else{(7&f)!=0&&(f+=8-(7&f));const E=4+(f>>>3),B=s[E-4]|s[E-3]<<8;d&&(r=n.H.W(r,U+B)),r.set(new a(s.buffer,s.byteOffset+E,B),U),f=E+B<<3,U+=B}return r.length==U?r:r.slice(0,U)},n.H.W=function(s,r){const a=s.length;if(r<=a)return s;const b=new Uint8Array(a<<1);return b.set(s,0),b},n.H.R=function(s,r,a,b,D,j){const x=n.H.e,k=n.H.Z;let F=0;for(;F<a;){const _=s[k(b,D)&r];D+=15&_;const M=_>>>4;if(M<=15)j[F]=M,F++;else{let h=0,U=0;M==16?(U=3+x(b,D,2),D+=2,h=j[F-1]):M==17?(U=3+x(b,D,3),D+=3):M==18&&(U=11+x(b,D,7),D+=7);const f=F+U;for(;F<f;)j[F]=h,F++}}return D},n.H.V=function(s,r,a,b){let D=0,j=0;const x=b.length>>>1;for(;j<a;){const k=s[j+r];b[j<<1]=0,b[1+(j<<1)]=k,k>D&&(D=k),j++}for(;j<x;)b[j<<1]=0,b[1+(j<<1)]=0,j++;return D},n.H.n=function(s,r){const a=n.H.m,b=s.length;let D,j,x,k;const F=a.j;for(var _=0;_<=r;_++)F[_]=0;for(_=1;_<b;_+=2)F[s[_]]++;const M=a.K;for(D=0,F[0]=0,j=1;j<=r;j++)D=D+F[j-1]<<1,M[j]=D;for(x=0;x<b;x+=2)k=s[x+1],k!=0&&(s[x]=M[k],M[k]++)},n.H.A=function(s,r,a){const b=s.length,D=n.H.m.r;for(let j=0;j<b;j+=2)if(s[j+1]!=0){const x=j>>1,k=s[j+1],F=x<<4|k,_=r-k;let M=s[j]<<_;const h=M+(1<<_);for(;M!=h;)a[D[M]>>>15-r]=F,M++}},n.H.l=function(s,r){const a=n.H.m.r,b=15-r;for(let D=0;D<s.length;D+=2){const j=s[D]<<r-s[D+1];s[D]=a[j]>>>b}},n.H.M=function(s,r,a){a<<=7&r;const b=r>>>3;s[b]|=a,s[b+1]|=a>>>8},n.H.I=function(s,r,a){a<<=7&r;const b=r>>>3;s[b]|=a,s[b+1]|=a>>>8,s[b+2]|=a>>>16},n.H.e=function(s,r,a){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<a)-1},n.H.b=function(s,r,a){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<a)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let b=r;b=(2863311530&b)>>>1|(1431655765&b)<<1,b=(3435973836&b)>>>2|(858993459&b)<<2,b=(4042322160&b)>>>4|(252645135&b)<<4,b=(4278255360&b)>>>8|(16711935&b)<<8,s.r[r]=(b>>>16|b<<16)>>>17}function a(b,D,j){for(;D--!=0;)b.push(0,j)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];a(s._,144,8),a(s._,112,9),a(s._,24,7),a(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),a(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),a(s.Q,19,0),a(s.C,286,0),a(s.D,30,0),a(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function l(n,s,r,a,b){let D=t(s);const j=Math.ceil(a*D/8);let x,k;D=Math.ceil(D/8);let F=n[r],_=0;if(F>1&&(n[r]=[0,0,1][F-2]),F==3)for(_=D;_<j;_++)n[_+1]=n[_+1]+(n[_+1-D]>>>1)&255;for(let M=0;M<b;M++)if(x=r+M*j,k=x+M+1,F=n[k-1],_=0,F==0)for(;_<j;_++)n[x+_]=n[k+_];else if(F==1){for(;_<D;_++)n[x+_]=n[k+_];for(;_<j;_++)n[x+_]=n[k+_]+n[x+_-D]}else if(F==2)for(;_<j;_++)n[x+_]=n[k+_]+n[x+_-j];else if(F==3){for(;_<D;_++)n[x+_]=n[k+_]+(n[x+_-j]>>>1);for(;_<j;_++)n[x+_]=n[k+_]+(n[x+_-j]+n[x+_-D]>>>1)}else{for(;_<D;_++)n[x+_]=n[k+_]+o(0,n[x+_-j],0);for(;_<j;_++)n[x+_]=n[k+_]+o(n[x+_-D],n[x+_-j],n[x+_-D-j])}return n}function o(n,s,r){const a=n+s-r,b=a-n,D=a-s,j=a-r;return b*b<=D*D&&b*b<=j*j?n:D*D<=j*j?s:r}function m(n,s,r){r.width=y.readUint(n,s),s+=4,r.height=y.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function v(n,s,r,a,b,D,j,x,k){const F=Math.min(s,b),_=Math.min(r,D);let M=0,h=0;for(let R=0;R<_;R++)for(let u=0;u<F;u++)if(j>=0&&x>=0?(M=R*s+u<<2,h=(x+R)*b+j+u<<2):(M=(-x+R)*s-j+u<<2,h=R*b+u<<2),k==0)a[h]=n[M],a[h+1]=n[M+1],a[h+2]=n[M+2],a[h+3]=n[M+3];else if(k==1){var U=n[M+3]*.00392156862745098,f=n[M]*U,c=n[M+1]*U,w=n[M+2]*U,A=a[h+3]*(1/255),C=a[h]*A,S=a[h+1]*A,I=a[h+2]*A;const d=1-U,z=U+A*d,E=z==0?0:1/z;a[h+3]=255*z,a[h+0]=(f+C*d)*E,a[h+1]=(c+S*d)*E,a[h+2]=(w+I*d)*E}else if(k==2)U=n[M+3],f=n[M],c=n[M+1],w=n[M+2],A=a[h+3],C=a[h],S=a[h+1],I=a[h+2],U==A&&f==C&&c==S&&w==I?(a[h]=0,a[h+1]=0,a[h+2]=0,a[h+3]=0):(a[h]=f,a[h+1]=c,a[h+2]=w,a[h+3]=U);else if(k==3){if(U=n[M+3],f=n[M],c=n[M+1],w=n[M+2],A=a[h+3],C=a[h],S=a[h+1],I=a[h+2],U==A&&f==C&&c==S&&w==I)continue;if(U<220&&A>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let a=8;const b=y,D=b.readUshort,j=b.readUint,x={tabs:{},frames:[]},k=new Uint8Array(r.length);let F,_=0,M=0;const h=[137,80,78,71,13,10,26,10];for(var U=0;U<8;U++)if(r[U]!=h[U])throw"The input is not a PNG file!";for(;a<r.length;){const R=b.readUint(r,a);a+=4;const u=b.readASCII(r,a,4);if(a+=4,u=="IHDR")m(r,a,x);else if(u=="iCCP"){for(var f=a;r[f]!=0;)f++;b.readASCII(r,a,f-a),r[f+1];const d=r.slice(f+2,a+R);let z=null;try{z=i(d)}catch{z=e(d)}x.tabs[u]=z}else if(u=="CgBI")x.tabs[u]=r.slice(a,a+4);else if(u=="IDAT"){for(U=0;U<R;U++)k[_+U]=r[a+U];_+=R}else if(u=="acTL")x.tabs[u]={num_frames:j(r,a),num_plays:j(r,a+4)},F=new Uint8Array(r.length);else if(u=="fcTL"){M!=0&&((I=x.frames[x.frames.length-1]).data=p(x,F.slice(0,M),I.rect.width,I.rect.height),M=0);const d={x:j(r,a+12),y:j(r,a+16),width:j(r,a+4),height:j(r,a+8)};let z=D(r,a+22);z=D(r,a+20)/(z==0?100:z);const E={rect:d,delay:Math.round(1e3*z),dispose:r[a+24],blend:r[a+25]};x.frames.push(E)}else if(u=="fdAT"){for(U=0;U<R-4;U++)F[M+U]=r[a+U+4];M+=R-4}else if(u=="pHYs")x.tabs[u]=[b.readUint(r,a),b.readUint(r,a+4),r[a+8]];else if(u=="cHRM")for(x.tabs[u]=[],U=0;U<8;U++)x.tabs[u].push(b.readUint(r,a+4*U));else if(u=="tEXt"||u=="zTXt"){x.tabs[u]==null&&(x.tabs[u]={});var c=b.nextZero(r,a),w=b.readASCII(r,a,c-a),A=a+R-c-1;if(u=="tEXt")S=b.readASCII(r,c+1,A);else{var C=i(r.slice(c+2,c+2+A));S=b.readUTF8(C,0,C.length)}x.tabs[u][w]=S}else if(u=="iTXt"){x.tabs[u]==null&&(x.tabs[u]={}),c=0,f=a,c=b.nextZero(r,f),w=b.readASCII(r,f,c-f);const d=r[f=c+1];var S;r[f+1],f+=2,c=b.nextZero(r,f),b.readASCII(r,f,c-f),f=c+1,c=b.nextZero(r,f),b.readUTF8(r,f,c-f),A=R-((f=c+1)-a),d==0?S=b.readUTF8(r,f,A):(C=i(r.slice(f,f+A)),S=b.readUTF8(C,0,C.length)),x.tabs[u][w]=S}else if(u=="PLTE")x.tabs[u]=b.readBytes(r,a,R);else if(u=="hIST"){const d=x.tabs.PLTE.length/3;for(x.tabs[u]=[],U=0;U<d;U++)x.tabs[u].push(D(r,a+2*U))}else if(u=="tRNS")x.ctype==3?x.tabs[u]=b.readBytes(r,a,R):x.ctype==0?x.tabs[u]=D(r,a):x.ctype==2&&(x.tabs[u]=[D(r,a),D(r,a+2),D(r,a+4)]);else if(u=="gAMA")x.tabs[u]=b.readUint(r,a)/1e5;else if(u=="sRGB")x.tabs[u]=r[a];else if(u=="bKGD")x.ctype==0||x.ctype==4?x.tabs[u]=[D(r,a)]:x.ctype==2||x.ctype==6?x.tabs[u]=[D(r,a),D(r,a+2),D(r,a+4)]:x.ctype==3&&(x.tabs[u]=r[a]);else if(u=="IEND")break;a+=R,b.readUint(r,a),a+=4}var I;return M!=0&&((I=x.frames[x.frames.length-1]).data=p(x,F.slice(0,M),I.rect.width,I.rect.height)),x.data=p(x,k,x.width,x.height),delete x.compress,delete x.interlace,delete x.filter,x},toRGBA8:function(s){const r=s.width,a=s.height;if(s.tabs.acTL==null)return[g(s.data,r,a,s).buffer];const b=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const D=r*a*4,j=new Uint8Array(D),x=new Uint8Array(D),k=new Uint8Array(D);for(let _=0;_<s.frames.length;_++){const M=s.frames[_],h=M.rect.x,U=M.rect.y,f=M.rect.width,c=M.rect.height,w=g(M.data,f,c,s);if(_!=0)for(var F=0;F<D;F++)k[F]=j[F];if(M.blend==0?v(w,f,c,j,r,a,h,U,0):M.blend==1&&v(w,f,c,j,r,a,h,U,1),b.push(j.buffer.slice(0)),M.dispose!=0){if(M.dispose==1)v(x,f,c,j,r,a,h,U,0);else if(M.dispose==2)for(F=0;F<D;F++)j[F]=k[F]}}return b},_paeth:o,_copyTile:v,_bin:y}}();(function(){const{_copyTile:y}=we,{_bin:g}=we,p=we._paeth;var i={table:function(){const f=new Uint32Array(256);for(let c=0;c<256;c++){let w=c;for(let A=0;A<8;A++)1&w?w=3988292384^w>>>1:w>>>=1;f[c]=w}return f}(),update(f,c,w,A){for(let C=0;C<A;C++)f=i.table[255&(f^c[w+C])]^f>>>8;return f},crc:(f,c,w)=>4294967295^i.update(4294967295,f,c,w)};function e(f,c,w,A){c[w]+=f[0]*A>>4,c[w+1]+=f[1]*A>>4,c[w+2]+=f[2]*A>>4,c[w+3]+=f[3]*A>>4}function t(f){return Math.max(0,Math.min(255,f))}function l(f,c){const w=f[0]-c[0],A=f[1]-c[1],C=f[2]-c[2],S=f[3]-c[3];return w*w+A*A+C*C+S*S}function o(f,c,w,A,C,S,I){I==null&&(I=1);const R=A.length,u=[];for(var d=0;d<R;d++){const T=A[d];u.push([T>>>0&255,T>>>8&255,T>>>16&255,T>>>24&255])}for(d=0;d<R;d++){let T=4294967295;for(var z=0,E=0;E<R;E++){var B=l(u[d],u[E]);E!=d&&B<T&&(T=B,z=E)}}const O=new Uint32Array(C.buffer),W=new Int16Array(c*w*4),H=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(d=0;d<H.length;d++)H[d]=255*((H[d]+.5)/16-.5);for(let T=0;T<w;T++)for(let Q=0;Q<c;Q++){var L;d=4*(T*c+Q),I!=2?L=[t(f[d]+W[d]),t(f[d+1]+W[d+1]),t(f[d+2]+W[d+2]),t(f[d+3]+W[d+3])]:(B=H[4*(3&T)+(3&Q)],L=[t(f[d]+B),t(f[d+1]+B),t(f[d+2]+B),t(f[d+3]+B)]),z=0;let Y=16777215;for(E=0;E<R;E++){const K=l(L,u[E]);K<Y&&(Y=K,z=E)}const V=u[z],q=[L[0]-V[0],L[1]-V[1],L[2]-V[2],L[3]-V[3]];I==1&&(Q!=c-1&&e(q,W,d+4,7),T!=w-1&&(Q!=0&&e(q,W,d+4*c-4,3),e(q,W,d+4*c,5),Q!=c-1&&e(q,W,d+4*c+4,1))),S[d>>2]=z,O[d>>2]=A[z]}}function m(f,c,w,A,C){C==null&&(C={});const{crc:S}=i,I=g.writeUint,R=g.writeUshort,u=g.writeASCII;let d=8;const z=f.frames.length>1;let E,B=!1,O=33+(z?20:0);if(C.sRGB!=null&&(O+=13),C.pHYs!=null&&(O+=21),C.iCCP!=null&&(E=pako.deflate(C.iCCP),O+=21+E.length+4),f.ctype==3){for(var W=f.plte.length,H=0;H<W;H++)f.plte[H]>>>24!=255&&(B=!0);O+=8+3*W+4+(B?8+1*W+4:0)}for(var L=0;L<f.frames.length;L++)z&&(O+=38),O+=(V=f.frames[L]).cimg.length+12,L!=0&&(O+=4);O+=12;const T=new Uint8Array(O),Q=[137,80,78,71,13,10,26,10];for(H=0;H<8;H++)T[H]=Q[H];if(I(T,d,13),d+=4,u(T,d,"IHDR"),d+=4,I(T,d,c),d+=4,I(T,d,w),d+=4,T[d]=f.depth,d++,T[d]=f.ctype,d++,T[d]=0,d++,T[d]=0,d++,T[d]=0,d++,I(T,d,S(T,d-17,17)),d+=4,C.sRGB!=null&&(I(T,d,1),d+=4,u(T,d,"sRGB"),d+=4,T[d]=C.sRGB,d++,I(T,d,S(T,d-5,5)),d+=4),C.iCCP!=null){const q=13+E.length;I(T,d,q),d+=4,u(T,d,"iCCP"),d+=4,u(T,d,"ICC profile"),d+=11,d+=2,T.set(E,d),d+=E.length,I(T,d,S(T,d-(q+4),q+4)),d+=4}if(C.pHYs!=null&&(I(T,d,9),d+=4,u(T,d,"pHYs"),d+=4,I(T,d,C.pHYs[0]),d+=4,I(T,d,C.pHYs[1]),d+=4,T[d]=C.pHYs[2],d++,I(T,d,S(T,d-13,13)),d+=4),z&&(I(T,d,8),d+=4,u(T,d,"acTL"),d+=4,I(T,d,f.frames.length),d+=4,I(T,d,C.loop!=null?C.loop:0),d+=4,I(T,d,S(T,d-12,12)),d+=4),f.ctype==3){for(I(T,d,3*(W=f.plte.length)),d+=4,u(T,d,"PLTE"),d+=4,H=0;H<W;H++){const q=3*H,K=f.plte[H],te=255&K,oe=K>>>8&255,Re=K>>>16&255;T[d+q+0]=te,T[d+q+1]=oe,T[d+q+2]=Re}if(d+=3*W,I(T,d,S(T,d-3*W-4,3*W+4)),d+=4,B){for(I(T,d,W),d+=4,u(T,d,"tRNS"),d+=4,H=0;H<W;H++)T[d+H]=f.plte[H]>>>24&255;d+=W,I(T,d,S(T,d-W-4,W+4)),d+=4}}let Y=0;for(L=0;L<f.frames.length;L++){var V=f.frames[L];z&&(I(T,d,26),d+=4,u(T,d,"fcTL"),d+=4,I(T,d,Y++),d+=4,I(T,d,V.rect.width),d+=4,I(T,d,V.rect.height),d+=4,I(T,d,V.rect.x),d+=4,I(T,d,V.rect.y),d+=4,R(T,d,A[L]),d+=2,R(T,d,1e3),d+=2,T[d]=V.dispose,d++,T[d]=V.blend,d++,I(T,d,S(T,d-30,30)),d+=4);const q=V.cimg;I(T,d,(W=q.length)+(L==0?0:4)),d+=4;const K=d;u(T,d,L==0?"IDAT":"fdAT"),d+=4,L!=0&&(I(T,d,Y++),d+=4),T.set(q,d),d+=W,I(T,d,S(T,K,d-K)),d+=4}return I(T,d,0),d+=4,u(T,d,"IEND"),d+=4,I(T,d,S(T,d-4,4)),d+=4,T.buffer}function v(f,c,w){for(let A=0;A<f.frames.length;A++){const C=f.frames[A];C.rect.width;const S=C.rect.height,I=new Uint8Array(S*C.bpl+S);C.cimg=a(C.img,S,C.bpp,C.bpl,I,c,w)}}function n(f,c,w,A,C){const S=C[0],I=C[1],R=C[2],u=C[3],d=C[4],z=C[5];let E=6,B=8,O=255;for(var W=0;W<f.length;W++){const ce=new Uint8Array(f[W]);for(var H=ce.length,L=0;L<H;L+=4)O&=ce[L+3]}const T=O!=255,Q=function(J,Z,de,he,ne,be){const ie=[];for(var X=0;X<J.length;X++){const ge=new Uint8Array(J[X]),ve=new Uint32Array(ge.buffer);var me;let ye=0,_e=0,Ae=Z,Te=de,ot=he?1:0;if(X!=0){const Xt=be||he||X==1||ie[X-2].dispose!=0?1:2;let at=0,xt=1e9;for(let He=0;He<Xt;He++){var Se=new Uint8Array(J[X-1-He]);const Yt=new Uint32Array(J[X-1-He]);let Fe=Z,Ue=de,Be=-1,$e=-1;for(let Me=0;Me<de;Me++)for(let ze=0;ze<Z;ze++)ve[fe=Me*Z+ze]!=Yt[fe]&&(ze<Fe&&(Fe=ze),ze>Be&&(Be=ze),Me<Ue&&(Ue=Me),Me>$e&&($e=Me));Be==-1&&(Fe=Ue=Be=$e=0),ne&&((1&Fe)==1&&Fe--,(1&Ue)==1&&Ue--);const vt=(Be-Fe+1)*($e-Ue+1);vt<xt&&(xt=vt,at=He,ye=Fe,_e=Ue,Ae=Be-Fe+1,Te=$e-Ue+1)}Se=new Uint8Array(J[X-1-at]),at==1&&(ie[X-1].dispose=2),me=new Uint8Array(Ae*Te*4),y(Se,Z,de,me,Ae,Te,-ye,-_e,0),ot=y(ge,Z,de,me,Ae,Te,-ye,-_e,3)?1:0,ot==1?r(ge,Z,de,me,{x:ye,y:_e,width:Ae,height:Te}):y(ge,Z,de,me,Ae,Te,-ye,-_e,0)}else me=ge.slice(0);ie.push({rect:{x:ye,y:_e,width:Ae,height:Te},img:me,blend:ot,dispose:0})}if(he)for(X=0;X<ie.length;X++){if((je=ie[X]).blend==1)continue;const ge=je.rect,ve=ie[X-1].rect,ye=Math.min(ge.x,ve.x),_e=Math.min(ge.y,ve.y),Ae={x:ye,y:_e,width:Math.max(ge.x+ge.width,ve.x+ve.width)-ye,height:Math.max(ge.y+ge.height,ve.y+ve.height)-_e};ie[X-1].dispose=1,X-1!=0&&s(J,Z,de,ie,X-1,Ae,ne),s(J,Z,de,ie,X,Ae,ne)}let qe=0;if(J.length!=1)for(var fe=0;fe<ie.length;fe++){var je;qe+=(je=ie[fe]).rect.width*je.rect.height}return ie}(f,c,w,S,I,R),Y={},V=[],q=[];if(A!=0){const ce=[];for(L=0;L<Q.length;L++)ce.push(Q[L].img.buffer);const J=function(ne){let be=0;for(var ie=0;ie<ne.length;ie++)be+=ne[ie].byteLength;const X=new Uint8Array(be);let me=0;for(ie=0;ie<ne.length;ie++){const Se=new Uint8Array(ne[ie]),qe=Se.length;for(let fe=0;fe<qe;fe+=4){let je=Se[fe],ge=Se[fe+1],ve=Se[fe+2];const ye=Se[fe+3];ye==0&&(je=ge=ve=0),X[me+fe]=je,X[me+fe+1]=ge,X[me+fe+2]=ve,X[me+fe+3]=ye}me+=qe}return X.buffer}(ce),Z=D(J,A);for(L=0;L<Z.plte.length;L++)V.push(Z.plte[L].est.rgba);let de=0;for(L=0;L<Q.length;L++){const he=(te=Q[L]).img.length;var K=new Uint8Array(Z.inds.buffer,de>>2,he>>2);q.push(K);const ne=new Uint8Array(Z.abuf,de,he);z&&o(te.img,te.rect.width,te.rect.height,V,ne,K),te.img.set(ne),de+=he}}else for(W=0;W<Q.length;W++){var te=Q[W];const ce=new Uint32Array(te.img.buffer);var oe=te.rect.width;for(H=ce.length,K=new Uint8Array(H),q.push(K),L=0;L<H;L++){const J=ce[L];if(L!=0&&J==ce[L-1])K[L]=K[L-1];else if(L>oe&&J==ce[L-oe])K[L]=K[L-oe];else{let Z=Y[J];if(Z==null&&(Y[J]=Z=V.length,V.push(J),V.length>=300))break;K[L]=Z}}}const Re=V.length;for(Re<=256&&d==0&&(B=Re<=2?1:Re<=4?2:Re<=16?4:8,B=Math.max(B,u)),W=0;W<Q.length;W++){(te=Q[W]).rect.x,te.rect.y,oe=te.rect.width;const ce=te.rect.height;let J=te.img;new Uint32Array(J.buffer);let Z=4*oe,de=4;if(Re<=256&&d==0){Z=Math.ceil(B*oe/8);var Ie=new Uint8Array(Z*ce);const he=q[W];for(let ne=0;ne<ce;ne++){L=ne*Z;const be=ne*oe;if(B==8)for(var ee=0;ee<oe;ee++)Ie[L+ee]=he[be+ee];else if(B==4)for(ee=0;ee<oe;ee++)Ie[L+(ee>>1)]|=he[be+ee]<<4-4*(1&ee);else if(B==2)for(ee=0;ee<oe;ee++)Ie[L+(ee>>2)]|=he[be+ee]<<6-2*(3&ee);else if(B==1)for(ee=0;ee<oe;ee++)Ie[L+(ee>>3)]|=he[be+ee]<<7-1*(7&ee)}J=Ie,E=3,de=1}else if(T==0&&Q.length==1){Ie=new Uint8Array(oe*ce*3);const he=oe*ce;for(L=0;L<he;L++){const ne=3*L,be=4*L;Ie[ne]=J[be],Ie[ne+1]=J[be+1],Ie[ne+2]=J[be+2]}J=Ie,E=2,de=3,Z=3*oe}te.img=J,te.bpl=Z,te.bpp=de}return{ctype:E,depth:B,plte:V,frames:Q}}function s(f,c,w,A,C,S,I){const R=Uint8Array,u=Uint32Array,d=new R(f[C-1]),z=new u(f[C-1]),E=C+1<f.length?new R(f[C+1]):null,B=new R(f[C]),O=new u(B.buffer);let W=c,H=w,L=-1,T=-1;for(let Y=0;Y<S.height;Y++)for(let V=0;V<S.width;V++){const q=S.x+V,K=S.y+Y,te=K*c+q,oe=O[te];oe==0||A[C-1].dispose==0&&z[te]==oe&&(E==null||E[4*te+3]!=0)||(q<W&&(W=q),q>L&&(L=q),K<H&&(H=K),K>T&&(T=K))}L==-1&&(W=H=L=T=0),I&&((1&W)==1&&W--,(1&H)==1&&H--),S={x:W,y:H,width:L-W+1,height:T-H+1};const Q=A[C];Q.rect=S,Q.blend=1,Q.img=new Uint8Array(S.width*S.height*4),A[C-1].dispose==0?(y(d,c,w,Q.img,S.width,S.height,-S.x,-S.y,0),r(B,c,w,Q.img,S)):y(B,c,w,Q.img,S.width,S.height,-S.x,-S.y,0)}function r(f,c,w,A,C){y(f,c,w,A,C.width,C.height,-C.x,-C.y,2)}function a(f,c,w,A,C,S,I){const R=[];let u,d=[0,1,2,3,4];S!=-1?d=[S]:(c*A>5e5||w==1)&&(d=[0]),I&&(u={level:0});const z=Tr;for(var E=0;E<d.length;E++){for(let W=0;W<c;W++)b(C,f,W,A,w,d[E]);R.push(z.deflate(C,u))}let B,O=1e9;for(E=0;E<R.length;E++)R[E].length<O&&(B=E,O=R[E].length);return R[B]}function b(f,c,w,A,C,S){const I=w*A;let R=I+w;if(f[R]=S,R++,S==0)if(A<500)for(var u=0;u<A;u++)f[R+u]=c[I+u];else f.set(new Uint8Array(c.buffer,I,A),R);else if(S==1){for(u=0;u<C;u++)f[R+u]=c[I+u];for(u=C;u<A;u++)f[R+u]=c[I+u]-c[I+u-C]+256&255}else if(w==0){for(u=0;u<C;u++)f[R+u]=c[I+u];if(S==2)for(u=C;u<A;u++)f[R+u]=c[I+u];if(S==3)for(u=C;u<A;u++)f[R+u]=c[I+u]-(c[I+u-C]>>1)+256&255;if(S==4)for(u=C;u<A;u++)f[R+u]=c[I+u]-p(c[I+u-C],0,0)+256&255}else{if(S==2)for(u=0;u<A;u++)f[R+u]=c[I+u]+256-c[I+u-A]&255;if(S==3){for(u=0;u<C;u++)f[R+u]=c[I+u]+256-(c[I+u-A]>>1)&255;for(u=C;u<A;u++)f[R+u]=c[I+u]+256-(c[I+u-A]+c[I+u-C]>>1)&255}if(S==4){for(u=0;u<C;u++)f[R+u]=c[I+u]+256-p(0,c[I+u-A],0)&255;for(u=C;u<A;u++)f[R+u]=c[I+u]+256-p(c[I+u-C],c[I+u-A],c[I+u-C-A])&255}}}function D(f,c){const w=new Uint8Array(f),A=w.slice(0),C=new Uint32Array(A.buffer),S=j(A,c),I=S[0],R=S[1],u=w.length,d=new Uint8Array(u>>2);let z;if(w.length<2e7)for(var E=0;E<u;E+=4)z=x(I,B=w[E]*(1/255),O=w[E+1]*(1/255),W=w[E+2]*(1/255),H=w[E+3]*(1/255)),d[E>>2]=z.ind,C[E>>2]=z.est.rgba;else for(E=0;E<u;E+=4){var B=w[E]*.00392156862745098,O=w[E+1]*(1/255),W=w[E+2]*(1/255),H=w[E+3]*(1/255);for(z=I;z.left;)z=k(z.est,B,O,W,H)<=0?z.left:z.right;d[E>>2]=z.ind,C[E>>2]=z.est.rgba}return{abuf:A.buffer,inds:d,plte:R}}function j(f,c,w){w==null&&(w=1e-4);const A=new Uint32Array(f.buffer),C={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};C.bst=M(f,C.i0,C.i1),C.est=h(C.bst);const S=[C];for(;S.length<c;){let R=0,u=0;for(var I=0;I<S.length;I++)S[I].est.L>R&&(R=S[I].est.L,u=I);if(R<w)break;const d=S[u],z=F(f,A,d.i0,d.i1,d.est.e,d.est.eMq255);if(d.i0>=z||d.i1<=z){d.est.L=0;continue}const E={i0:d.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};E.bst=M(f,E.i0,E.i1),E.est=h(E.bst);const B={i0:z,i1:d.i1,bst:null,est:null,tdst:0,left:null,right:null};for(B.bst={R:[],m:[],N:d.bst.N-E.bst.N},I=0;I<16;I++)B.bst.R[I]=d.bst.R[I]-E.bst.R[I];for(I=0;I<4;I++)B.bst.m[I]=d.bst.m[I]-E.bst.m[I];B.est=h(B.bst),d.left=E,d.right=B,S[u]=E,S.push(B)}for(S.sort((R,u)=>u.bst.N-R.bst.N),I=0;I<S.length;I++)S[I].ind=I;return[C,S]}function x(f,c,w,A,C){if(f.left==null)return f.tdst=function(E,B,O,W,H){const L=B-E[0],T=O-E[1],Q=W-E[2],Y=H-E[3];return L*L+T*T+Q*Q+Y*Y}(f.est.q,c,w,A,C),f;const S=k(f.est,c,w,A,C);let I=f.left,R=f.right;S>0&&(I=f.right,R=f.left);const u=x(I,c,w,A,C);if(u.tdst<=S*S)return u;const d=x(R,c,w,A,C);return d.tdst<u.tdst?d:u}function k(f,c,w,A,C){const{e:S}=f;return S[0]*c+S[1]*w+S[2]*A+S[3]*C-f.eMq}function F(f,c,w,A,C,S){for(A-=4;w<A;){for(;_(f,w,C)<=S;)w+=4;for(;_(f,A,C)>S;)A-=4;if(w>=A)break;const I=c[w>>2];c[w>>2]=c[A>>2],c[A>>2]=I,w+=4,A-=4}for(;_(f,w,C)>S;)w-=4;return w+4}function _(f,c,w){return f[c]*w[0]+f[c+1]*w[1]+f[c+2]*w[2]+f[c+3]*w[3]}function M(f,c,w){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0],S=w-c>>2;for(let I=c;I<w;I+=4){const R=f[I]*.00392156862745098,u=f[I+1]*(1/255),d=f[I+2]*(1/255),z=f[I+3]*(1/255);C[0]+=R,C[1]+=u,C[2]+=d,C[3]+=z,A[0]+=R*R,A[1]+=R*u,A[2]+=R*d,A[3]+=R*z,A[5]+=u*u,A[6]+=u*d,A[7]+=u*z,A[10]+=d*d,A[11]+=d*z,A[15]+=z*z}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:C,N:S}}function h(f){const{R:c}=f,{m:w}=f,{N:A}=f,C=w[0],S=w[1],I=w[2],R=w[3],u=A==0?0:1/A,d=[c[0]-C*C*u,c[1]-C*S*u,c[2]-C*I*u,c[3]-C*R*u,c[4]-S*C*u,c[5]-S*S*u,c[6]-S*I*u,c[7]-S*R*u,c[8]-I*C*u,c[9]-I*S*u,c[10]-I*I*u,c[11]-I*R*u,c[12]-R*C*u,c[13]-R*S*u,c[14]-R*I*u,c[15]-R*R*u],z=d,E=U;let B=[Math.random(),Math.random(),Math.random(),Math.random()],O=0,W=0;if(A!=0)for(let L=0;L<16&&(B=E.multVec(z,B),W=Math.sqrt(E.dot(B,B)),B=E.sml(1/W,B),!(L!=0&&Math.abs(W-O)<1e-9));L++)O=W;const H=[C*u,S*u,I*u,R*u];return{Cov:d,q:H,e:B,L:O,eMq255:E.dot(E.sml(255,H),B),eMq:E.dot(B,H),rgba:(Math.round(255*H[3])<<24|Math.round(255*H[2])<<16|Math.round(255*H[1])<<8|Math.round(255*H[0])<<0)>>>0}}var U={multVec:(f,c)=>[f[0]*c[0]+f[1]*c[1]+f[2]*c[2]+f[3]*c[3],f[4]*c[0]+f[5]*c[1]+f[6]*c[2]+f[7]*c[3],f[8]*c[0]+f[9]*c[1]+f[10]*c[2]+f[11]*c[3],f[12]*c[0]+f[13]*c[1]+f[14]*c[2]+f[15]*c[3]],dot:(f,c)=>f[0]*c[0]+f[1]*c[1]+f[2]*c[2]+f[3]*c[3],sml:(f,c)=>[f*c[0],f*c[1],f*c[2],f*c[3]]};we.encode=function(c,w,A,C,S,I,R){C==null&&(C=0),R==null&&(R=!1);const u=n(c,w,A,C,[!1,!1,!1,0,R,!1]);return v(u,-1),m(u,w,A,S,I)},we.encodeLL=function(c,w,A,C,S,I,R,u){const d={ctype:0+(C==1?0:2)+(S==0?0:4),depth:I,frames:[]},z=(C+S)*I,E=z*w;for(let B=0;B<c.length;B++)d.frames.push({rect:{x:0,y:0,width:w,height:A},img:new Uint8Array(c[B]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(E/8)});return v(d,0,!0),m(d,w,A,R,u)},we.encode.compress=n,we.encode.dither=o,we.quantize=D,we.quantize.getKDtree=j,we.quantize.getNearest=x})();const Wt={toArrayBuffer(y,g){const p=y.width,i=y.height,e=p<<2,t=y.getContext("2d").getImageData(0,0,p,i),l=new Uint32Array(t.data.buffer),o=(32*p+31)/32<<2,m=o*i,v=122+m,n=new ArrayBuffer(v),s=new DataView(n),r=1<<20;let a,b,D,j,x=r,k=0,F=0,_=0;function M(f){s.setUint16(F,f,!0),F+=2}function h(f){s.setUint32(F,f,!0),F+=4}function U(f){F+=f}M(19778),h(v),U(4),h(122),h(108),h(p),h(-i>>>0),M(1),M(32),h(3),h(m),h(2835),h(2835),U(8),h(16711680),h(65280),h(255),h(4278190080),h(1466527264),function f(){for(;k<i&&x>0;){for(j=122+k*o,a=0;a<e;)x--,b=l[_++],D=b>>>24,s.setUint32(j+a,b<<8|D),a+=4;k++}_<l.length?(x=r,setTimeout(f,Wt._dly)):g(n)}()},toBlob(y,g){this.toArrayBuffer(y,p=>{g(new Blob([p],{type:"image/bmp"}))})},_dly:9};var pe={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Mr={[pe.CHROME]:16384,[pe.FIREFOX]:11180,[pe.DESKTOP_SAFARI]:16384,[pe.IE]:8192,[pe.IOS]:4096,[pe.ETC]:8192};const mt=typeof window<"u",Nt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,rt=mt&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),zr=(mt||Nt)&&(rt&&rt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Ht=(mt||Nt)&&(rt&&rt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function yt(y,g,p=Date.now()){return new Promise(i=>{const e=y.split(","),t=e[0].match(/:(.*?);/)[1],l=globalThis.atob(e[1]);let o=l.length;const m=new Uint8Array(o);for(;o--;)m[o]=l.charCodeAt(o);const v=new Blob([m],{type:t});v.name=g,v.lastModified=p,i(v)})}function $t(y){return new Promise((g,p)=>{const i=new Ht;i.onload=()=>g(i.result),i.onerror=e=>p(e),i.readAsDataURL(y)})}function Qt(y){return new Promise((g,p)=>{const i=new Image;i.onload=()=>g(i),i.onerror=e=>p(e),i.src=y})}function Pe(){if(Pe.cachedResult!==void 0)return Pe.cachedResult;let y=pe.ETC;const{userAgent:g}=navigator;return/Chrom(e|ium)/i.test(g)?y=pe.CHROME:/iP(ad|od|hone)/i.test(g)&&/WebKit/i.test(g)?y=pe.IOS:/Safari/i.test(g)?y=pe.DESKTOP_SAFARI:/Firefox/i.test(g)?y=pe.FIREFOX:(/MSIE/i.test(g)||document.documentMode)&&(y=pe.IE),Pe.cachedResult=y,Pe.cachedResult}function Gt(y,g){const p=Pe(),i=Mr[p];let e=y,t=g,l=e*t;const o=e>t?t/e:e/t;for(;l>i*i;){const m=(i+e)/2,v=(i+t)/2;m<v?(t=v,e=v*o):(t=m*o,e=m),l=e*t}return{width:e,height:t}}function st(y,g){let p,i;try{if(p=new OffscreenCanvas(y,g),i=p.getContext("2d"),i===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{p=document.createElement("canvas"),i=p.getContext("2d")}return p.width=y,p.height=g,[p,i]}function qt(y,g){const{width:p,height:i}=Gt(y.width,y.height),[e,t]=st(p,i);return g&&/jpe?g/.test(g)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(y,0,0,e.width,e.height),e}function Ze(){return Ze.cachedResult!==void 0||(Ze.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ze.cachedResult}function nt(y,g={}){return new Promise(function(p,i){let e,t;var l=function(){try{return t=qt(e,g.fileType||y.type),p([e,t])}catch(m){return i(m)}},o=function(m){try{var v=function(n){try{throw n}catch(s){return i(s)}};try{let n;return $t(y).then(function(s){try{return n=s,Qt(n).then(function(r){try{return e=r,function(){try{return l()}catch(a){return i(a)}}()}catch(a){return v(a)}},v)}catch(r){return v(r)}},v)}catch(n){v(n)}}catch(n){return i(n)}};try{if(Ze()||[pe.DESKTOP_SAFARI,pe.MOBILE_SAFARI].includes(Pe()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(y).then(function(m){try{return e=m,l()}catch{return o()}},o)}catch{o()}})}function it(y,g,p,i,e=1){return new Promise(function(t,l){let o;if(g==="image/png"){let v,n,s;return v=y.getContext("2d"),{data:n}=v.getImageData(0,0,y.width,y.height),s=we.encode([n.buffer],y.width,y.height,4096*e),o=new Blob([s],{type:g}),o.name=p,o.lastModified=i,m.call(this)}{let v=function(){return m.call(this)};if(g==="image/bmp")return new Promise(n=>Wt.toBlob(y,n)).then((function(n){try{return o=n,o.name=p,o.lastModified=i,v.call(this)}catch(s){return l(s)}}).bind(this),l);{let n=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&y instanceof OffscreenCanvas)return y.convertToBlob({type:g,quality:e}).then((function(s){try{return o=s,o.name=p,o.lastModified=i,n.call(this)}catch(r){return l(r)}}).bind(this),l);{let s;return s=y.toDataURL(g,e),yt(s,p,i).then((function(r){try{return o=r,n.call(this)}catch(a){return l(a)}}).bind(this),l)}}}function m(){return t(o)}})}function Ce(y){y.width=0,y.height=0}function We(){return new Promise(function(y,g){let p,i,e,t;return We.cachedResult!==void 0?y(We.cachedResult):yt("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(l){try{return p=l,nt(p).then(function(o){try{return i=o[1],it(i,p.type,p.name,p.lastModified).then(function(m){try{return e=m,Ce(i),nt(e).then(function(v){try{return t=v[0],We.cachedResult=t.width===1&&t.height===2,y(We.cachedResult)}catch(n){return g(n)}},g)}catch(v){return g(v)}},g)}catch(m){return g(m)}},g)}catch(o){return g(o)}},g)})}function Vt(y){return new Promise((g,p)=>{const i=new Ht;i.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return g(-2);const l=t.byteLength;let o=2;for(;o<l;){if(t.getUint16(o+2,!1)<=8)return g(-1);const m=t.getUint16(o,!1);if(o+=2,m==65505){if(t.getUint32(o+=2,!1)!=1165519206)return g(-1);const v=t.getUint16(o+=6,!1)==18761;o+=t.getUint32(o+4,v);const n=t.getUint16(o,v);o+=2;for(let s=0;s<n;s++)if(t.getUint16(o+12*s,v)==274)return g(t.getUint16(o+12*s+8,v))}else{if((65280&m)!=65280)break;o+=t.getUint16(o,!1)}}return g(-1)},i.onerror=e=>p(e),i.readAsArrayBuffer(y)})}function Kt(y,g){const{width:p}=y,{height:i}=y,{maxWidthOrHeight:e}=g;let t,l=y;return isFinite(e)&&(p>e||i>e)&&([l,t]=st(p,i),p>i?(l.width=e,l.height=i/p*e):(l.width=p/i*e,l.height=e),t.drawImage(y,0,0,l.width,l.height),Ce(y)),l}function Zt(y,g){const{width:p}=y,{height:i}=y,[e,t]=st(p,i);switch(g>4&&g<9?(e.width=i,e.height=p):(e.width=p,e.height=i),g){case 2:t.transform(-1,0,0,1,p,0);break;case 3:t.transform(-1,0,0,-1,p,i);break;case 4:t.transform(1,0,0,-1,0,i);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,i,0);break;case 7:t.transform(0,-1,-1,0,i,p);break;case 8:t.transform(0,-1,1,0,0,p)}return t.drawImage(y,0,0,p,i),Ce(y),e}function Ut(y,g,p=0){return new Promise(function(i,e){let t,l,o,m,v,n,s,r,a,b,D,j,x,k,F,_,M,h,U,f;function c(A=5){if(g.signal&&g.signal.aborted)throw g.signal.reason;t+=A,g.onProgress(Math.min(t,100))}function w(A){if(g.signal&&g.signal.aborted)throw g.signal.reason;t=Math.min(Math.max(A,t),100),g.onProgress(t)}return t=p,l=g.maxIteration||10,o=1024*g.maxSizeMB*1024,c(),nt(y,g).then((function(A){try{return[,m]=A,c(),v=Kt(m,g),c(),new Promise(function(C,S){var I;if(!(I=g.exifOrientation))return Vt(y).then((function(u){try{return I=u,R.call(this)}catch(d){return S(d)}}).bind(this),S);function R(){return C(I)}return R.call(this)}).then((function(C){try{return n=C,c(),We().then((function(S){try{return s=S?v:Zt(v,n),c(),r=g.initialQuality||1,a=g.fileType||y.type,it(s,a,y.name,y.lastModified,r).then((function(I){try{{let u=function(){if(l--&&(F>o||F>x)){let z,E;return z=f?.95*U.width:U.width,E=f?.95*U.height:U.height,[M,h]=st(z,E),h.drawImage(U,0,0,z,E),r*=a==="image/png"?.85:.95,it(M,a,y.name,y.lastModified,r).then(function(B){try{return _=B,Ce(U),U=M,F=_.size,w(Math.min(99,Math.floor((k-F)/(k-o)*100))),u}catch(O){return e(O)}},e)}return[1]},d=function(){return Ce(U),Ce(M),Ce(v),Ce(s),Ce(m),w(100),i(_)};if(b=I,c(),D=b.size>o,j=b.size>y.size,!D&&!j)return w(100),i(b);var R;return x=y.size,k=b.size,F=k,U=s,f=!g.alwaysKeepResolution&&D,(R=(function(z){for(;z;){if(z.then)return void z.then(R,e);try{if(z.pop){if(z.length)return z.pop()?d.call(this):z;z=u}else z=z.call(this)}catch(E){return e(E)}}}).bind(this))(u)}}catch(u){return e(u)}}).bind(this),e)}catch(I){return e(I)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)})}const Pr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let gt;function Br(y,g){return new Promise((p,i)=>{gt||(gt=function(l){const o=[];return o.push(l),URL.createObjectURL(new Blob(o))}(Pr));const e=new Worker(gt);e.addEventListener("message",function(l){if(g.signal&&g.signal.aborted)e.terminate();else if(l.data.progress===void 0){if(l.data.error)return i(new Error(l.data.error)),void e.terminate();p(l.data.file),e.terminate()}else g.onProgress(l.data.progress)}),e.addEventListener("error",i),g.signal&&g.signal.addEventListener("abort",()=>{i(g.signal.reason),e.terminate()}),e.postMessage({file:y,imageCompressionLibUrl:g.libURL,options:{...g,onProgress:void 0,signal:void 0}})})}function ue(y,g){return new Promise(function(p,i){let e,t,l,o,m,v;if(e={...g},l=0,{onProgress:o}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,m=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=a=>{l=a,typeof o=="function"&&o(l)},!(y instanceof Blob||y instanceof zr))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(y.type))return i(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!m||typeof Worker!="function"||v)return Ut(y,e).then((function(a){try{return t=a,r.call(this)}catch(b){return i(b)}}).bind(this),i);var n=(function(){try{return r.call(this)}catch(a){return i(a)}}).bind(this),s=function(a){try{return Ut(y,e).then(function(b){try{return t=b,n()}catch(D){return i(D)}},i)}catch(b){return i(b)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Br(y,e).then(function(a){try{return t=a,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=y.name,t.lastModified=y.lastModified}catch{}try{e.preserveExif&&y.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===y.type)&&(t=Ot(y,t))}catch{}return p(t)}})}ue.getDataUrlFromFile=$t,ue.getFilefromDataUrl=yt,ue.loadImage=Qt,ue.drawImageInCanvas=qt,ue.drawFileInCanvas=nt,ue.canvasToFile=it,ue.getExifOrientation=Vt,ue.handleMaxWidthOrHeight=Kt,ue.followExifOrientation=Zt,ue.cleanupCanvasMemory=Ce,ue.isAutoOrientationInBrowser=We,ue.approximateBelowMaximumCanvasSizeOfBrowser=Gt,ue.copyExifWithoutOrientation=Ot,ue.getBrowserName=Pe,ue.version="2.0.2";const Kr=({images:y,onImagesChange:g,storagePath:p,disabled:i=!1})=>{const[e,t]=le.useState(!1),[l,o]=le.useState(0),[m,v]=le.useState(null),[n,s]=le.useState(null),r=le.useRef(null),a=async x=>{const k=Array.from(x.target.files||[]);if(k.length!==0){t(!0),s(null),o(0);try{const F=Xe(),_=[];for(let M=0;M<k.length;M++){const h=k[M];let U=h;h.size>1024*1024&&(U=await ue(h,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0}));const f=`${Date.now()}_${pt()}.${U.type.split("/")[1]}`,c=`${p}/${f}`,w=Ye(F,c),A=Et(w,U);await new Promise((C,S)=>{A.on("state_changed",I=>{const R=(M+I.bytesTransferred/I.totalBytes)/k.length*100;o(R)},I=>{console.error("Upload error:",I),S(I)},async()=>{const I=await kt(A.snapshot.ref);_.push({url:I,path:c,title:h.name.replace(/\.[^/.]+$/,"")}),C()})})}g([...y,..._])}catch(F){console.error("Error uploading images:",F),s("Failed to upload images. Please try again.")}finally{t(!1),o(0),r.current&&(r.current.value="")}}},b=async x=>{const k=y[x];try{const F=Xe(),_=Ye(F,k.path);await Rt(_);const M=y.filter((h,U)=>U!==x);g(M)}catch(F){console.error("Error deleting image:",F),s("Failed to delete image. It may have been already deleted.");const _=y.filter((M,h)=>h!==x);g(_)}},D=le.useCallback((x,k)=>{const F=[...y];F[x]={...F[x],title:k},g(F)},[y,g]),j=x=>{v(x)};return P.jsxs(se,{children:[P.jsxs(se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:$[3]},children:[P.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:$[2]},children:[P.jsx(Dt,{sx:{color:N.text.tertiary}}),P.jsx(ae,{variant:"h6",sx:{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.semibold,color:N.text.primary},children:"Images"}),P.jsxs(ae,{variant:"body2",sx:{color:N.text.tertiary,fontSize:G.fontSize.sm},children:[y.length," ",y.length===1?"image":"images"]})]}),P.jsx(Je,{variant:"outlined",startIcon:P.jsx(Mt,{}),onClick:()=>{var x;return(x=r.current)==null?void 0:x.click()},disabled:i||e,sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium},children:"Upload Images"}),P.jsx("input",{ref:r,type:"file",accept:"image/*",multiple:!0,style:{display:"none"},onChange:a,disabled:i})]}),e&&P.jsxs(se,{sx:{mb:$[3]},children:[P.jsx(zt,{variant:"determinate",value:l}),P.jsxs(ae,{variant:"caption",sx:{color:N.text.tertiary,mt:$[1],display:"block"},children:["Uploading... ",Math.round(l),"%"]})]}),n&&P.jsx(Pt,{severity:"error",onClose:()=>s(null),sx:{mb:$[3]},children:n}),y.length>0?P.jsx(St,{container:!0,spacing:$[2],children:y.map((x,k)=>P.jsx(St,{item:!0,xs:12,sm:6,md:4,children:P.jsxs(fr,{sx:{borderRadius:re.lg,boxShadow:It.sm,transition:"all 0.2s","&:hover":{boxShadow:It.md}},children:[P.jsx(ur,{component:"img",height:"160",image:x.url,alt:x.title,sx:{objectFit:"cover",cursor:"pointer"},onClick:()=>j(x)}),P.jsx(hr,{sx:{p:$[2]},children:P.jsx(gr,{fullWidth:!0,size:"small",placeholder:"Image title...",value:x.title,onChange:F=>D(k,F.target.value),disabled:i,sx:{"& .MuiInputBase-root":{fontSize:G.fontSize.sm}}})}),P.jsxs(pr,{sx:{px:$[2],pb:$[2],pt:0,justifyContent:"space-between"},children:[P.jsx(et,{title:"View fullscreen",children:P.jsx(Ne,{size:"small",onClick:()=>j(x),children:P.jsx(br,{fontSize:"small"})})}),P.jsx(et,{title:"Delete image",children:P.jsx(Ne,{size:"small",onClick:()=>b(k),disabled:i,sx:{color:N.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:P.jsx(Bt,{fontSize:"small"})})})]})]})},k))}):P.jsxs(se,{sx:{border:`2px dashed ${N.neutral[300]}`,borderRadius:re.lg,p:$[6],textAlign:"center",backgroundColor:N.background.secondary},children:[P.jsx(Dt,{sx:{fontSize:48,color:N.text.tertiary,mb:$[2]}}),P.jsx(ae,{variant:"body1",sx:{color:N.text.secondary,mb:$[1]},children:"No images yet"}),P.jsxs(ae,{variant:"body2",sx:{color:N.text.tertiary,fontSize:G.fontSize.sm},children:['Click "Upload Images" to add images to this ',p.includes("design")?"design":p.includes("build")?"build":"test"]})]}),P.jsx(jt,{open:!!m,onClose:()=>v(null),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{backgroundColor:N.background.primary,borderRadius:re.xl}},children:P.jsx(Tt,{sx:{p:0,position:"relative"},children:m&&P.jsxs(P.Fragment,{children:[P.jsx(Ne,{onClick:()=>v(null),sx:{position:"absolute",top:$[2],right:$[2],backgroundColor:"rgba(0, 0, 0, 0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"},zIndex:1},children:P.jsx(mr,{})}),P.jsx("img",{src:m.url,alt:m.title,style:{width:"100%",height:"auto",display:"block"}}),m.title&&P.jsx(se,{sx:{p:$[3],backgroundColor:N.background.secondary},children:P.jsx(ae,{variant:"h6",sx:{fontFamily:G.fontFamily.display,color:N.text.primary},children:m.title})})]})})})]})},Lr=y=>{var p;switch((p=y.split(".").pop())==null?void 0:p.toLowerCase()){case"pdf":return P.jsx(Sr,{sx:{color:"#D32F2F"}});case"doc":case"docx":return P.jsx(Ft,{sx:{color:"#1976D2"}});case"xls":case"xlsx":case"csv":return P.jsx(Dr,{sx:{color:"#2E7D32"}});case"txt":case"md":return P.jsx(Ft,{sx:{color:N.text.secondary}});case"json":case"xml":case"html":case"css":case"js":case"ts":return P.jsx(_r,{sx:{color:"#F57C00"}});case"zip":case"rar":case"7z":return P.jsx(Cr,{sx:{color:"#5E35B1"}});default:return P.jsx(bt,{sx:{color:N.text.tertiary}})}},Zr=({files:y,onFilesChange:g,storagePath:p,disabled:i=!1,maxFileSize:e=10,allowedTypes:t=[]})=>{const[l,o]=le.useState(!1),[m,v]=le.useState(0),[n,s]=le.useState(""),[r,a]=le.useState(null),b=le.useRef(null),D=le.useCallback(k=>{var _;const F=e*1024*1024;if(k.size>F)return`File size exceeds ${e}MB limit`;if(t.length>0){const M=`.${(_=k.name.split(".").pop())==null?void 0:_.toLowerCase()}`;if(!t.some(U=>U.startsWith(".")?U.toLowerCase()===M:k.type===U))return`File type not allowed. Allowed types: ${t.join(", ")}`}return null},[e,t]),j=async k=>{const F=Array.from(k.target.files||[]);if(F.length!==0){o(!0),a(null),v(0);try{const _=Xe(),M=[];for(let h=0;h<F.length;h++){const U=F[h];s(U.name);const f=D(U);if(f){a(f);continue}const c=U.name.split(".").pop(),w=`${Date.now()}_${pt()}.${c}`,A=`${p}/files/${w}`,C=Ye(_,A),S=Et(C,U);await new Promise((I,R)=>{S.on("state_changed",u=>{const d=(h+u.bytesTransferred/u.totalBytes)/F.length*100;v(d)},u=>{console.error("Upload error:",u),R(u)},async()=>{const u=await kt(S.snapshot.ref);M.push({id:pt(),url:u,name:U.name,path:A}),I()})})}g([...y,...M])}catch(_){console.error("Error uploading files:",_),a("Failed to upload files. Please try again.")}finally{o(!1),v(0),s(""),b.current&&(b.current.value="")}}},x=async k=>{const F=y[k];try{const _=Xe(),M=Ye(_,F.path);await Rt(M);const h=y.filter((U,f)=>f!==k);g(h)}catch(_){console.error("Error deleting file:",_),a("Failed to delete file. It may have been already deleted.");const M=y.filter((h,U)=>U!==k);g(M)}};return P.jsxs(se,{children:[P.jsxs(se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:$[3]},children:[P.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:$[2]},children:[P.jsx(bt,{sx:{color:N.text.tertiary}}),P.jsx(ae,{variant:"h6",sx:{fontFamily:G.fontFamily.display,fontWeight:G.fontWeight.semibold,color:N.text.primary},children:"Files"}),P.jsxs(ae,{variant:"body2",sx:{color:N.text.tertiary,fontSize:G.fontSize.sm},children:[y.length," ",y.length===1?"file":"files"]})]}),P.jsx(Je,{variant:"outlined",startIcon:P.jsx(Mt,{}),onClick:()=>{var k;return(k=b.current)==null?void 0:k.click()},disabled:i||l,sx:{borderRadius:re.md,textTransform:"none",fontWeight:G.fontWeight.medium},children:"Upload Files"}),P.jsx("input",{ref:b,type:"file",multiple:!0,style:{display:"none"},onChange:j,disabled:i,accept:t.length>0?t.join(","):void 0})]}),l&&P.jsxs(se,{sx:{mb:$[3]},children:[P.jsxs(ae,{variant:"caption",sx:{color:N.text.secondary,mb:$[1],display:"block"},children:["Uploading ",n,"..."]}),P.jsx(zt,{variant:"determinate",value:m}),P.jsxs(ae,{variant:"caption",sx:{color:N.text.tertiary,mt:$[1],display:"block"},children:[Math.round(m),"%"]})]}),r&&P.jsx(Pt,{severity:"error",onClose:()=>a(null),sx:{mb:$[3]},children:r}),y.length>0?P.jsx(yr,{sx:{border:`1px solid ${N.neutral[200]}`,borderRadius:re.lg,backgroundColor:N.background.secondary,overflow:"hidden"},children:y.map((k,F)=>{var _;return P.jsxs(xr,{sx:{borderBottom:F<y.length-1?`1px solid ${N.neutral[200]}`:"none","&:hover":{backgroundColor:N.neutral[50]}},children:[P.jsx(vr,{children:Lr(k.name)}),P.jsx(wr,{primary:P.jsx(ae,{variant:"body2",sx:{fontWeight:G.fontWeight.medium,color:N.text.primary},children:k.name}),secondary:P.jsxs(ae,{variant:"caption",sx:{color:N.text.tertiary},children:[(_=k.name.split(".").pop())==null?void 0:_.toUpperCase()," file"]})}),P.jsx(Ir,{children:P.jsx(Ne,{edge:"end",onClick:()=>x(F),disabled:i,sx:{color:N.error,"&:hover":{backgroundColor:"#FEE2E2"}},children:P.jsx(Bt,{})})})]},k.id)})}):P.jsxs(se,{sx:{border:`2px dashed ${N.neutral[300]}`,borderRadius:re.lg,p:$[6],textAlign:"center",backgroundColor:N.background.secondary},children:[P.jsx(bt,{sx:{fontSize:48,color:N.text.tertiary,mb:$[2]}}),P.jsx(ae,{variant:"body1",sx:{color:N.text.secondary,mb:$[1]},children:"No files attached"}),P.jsx(ae,{variant:"body2",sx:{color:N.text.tertiary,fontSize:G.fontSize.sm},children:'Click "Upload Files" to attach documents, data files, or other resources'}),e&&P.jsx(Ar,{label:`Max file size: ${e}MB`,size:"small",sx:{mt:$[2]}})]})]})};export{Gr as C,Zr as F,Kr as I,qr as R,Vr as a,Ur as l,Qr as u};
