import{r as H,u as ms,H as ps,j as i,s as bs,d as xs,f as vs,I as ys,i as js,J as ws,B as tt,q as Se,T as Cs,K as Ss,P as As,M as Ts,N as Is,O as $t,Q as ke,R as Fs,t as Et,U as Me,V as Bn,W as wt,X as hn,Y as Ut,Z as Us,c as Xe,_ as rt,$ as it,v as at,A as ot,a0 as ft,a1 as ht,a2 as kt,a3 as Pn,a4 as Ln,a5 as ks,a6 as wn,a7 as Rt,a8 as ct,a9 as Ds,aa as Es,ab as Rs,ac as _s,ad as _t,ae as Ms,af as fn,ag as St,ah as pt,ai as At,aj as bt,ak as gn,al as Ce,am as J,an as Ct,ao as Qt,ap as je,aq as Os,ar as Ee,as as Pe,at as me,au as Ke,av as Ze,aw as Vt,ax as gt,ay as Ns}from"./index-DMeyLJhI.js";import Gt from"./purify.es-CQJ0hv7W.js";const Bs=m=>{const{alignItems:I,classes:D}=m;return vs({root:["root",I==="flex-start"&&"alignItemsFlexStart"]},ys,D)},Ps=bs("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(m,I)=>{const{ownerState:D}=m;return[I.root,D.alignItems==="flex-start"&&I.alignItemsFlexStart]}})(js(({theme:m})=>({minWidth:56,color:(m.vars||m).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),Ls=H.forwardRef(function(I,D){const o=ms({props:I,name:"MuiListItemIcon"}),{className:e,...t}=o,a=H.useContext(ps),d={...o,alignItems:a.alignItems},v=Bs(d);return i.jsx(Ps,{className:xs(v.root,e),ownerState:d,ref:D,...t})}),Hn=H.memo(({setIsAdding:m})=>{console.log("Header loaded");const I=ws(),D=()=>{I("/")};return i.jsxs(tt,{className:"lab-notebook-container",children:[i.jsx(tt,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Se,{variant:"text",onClick:D,className:"back-home-button",children:"← Home Page"})}),i.jsx(tt,{sx:{display:"flex",alignItems:"center",mb:2},children:i.jsx(Cs,{className:"webpage_title",children:"My Laboratory Notebook"})}),i.jsx(tt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx(Se,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>m(!0),children:"+ Create New"})})]})});Hn.displayName="Header";const lt=({designs:m,handleEdit:I,handleDelete:D,userDetails:o,showUserIdColumn:e})=>{const t=a=>a?a instanceof hn?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx(Ss,{component:As,children:i.jsxs(Ts,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[i.jsx(Is,{children:i.jsxs($t,{sx:{height:"60px"},children:[i.jsx(ke,{sx:{fontWeight:"bold",width:e?"30%":"40%"},children:"Title"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),e&&i.jsx(ke,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),i.jsx(ke,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),i.jsx(Fs,{children:m&&m.length>0?m.map(a=>{const d=a.userId===(o==null?void 0:o.uid);return i.jsxs($t,{sx:{height:"80px"},children:[i.jsx(ke,{children:i.jsx("button",{onClick:()=>I(a.id),className:"hyperlink-style",children:a.title})}),i.jsx(ke,{children:a.course&&(o!=null&&o.classes)&&o.classes[a.course]?`${o.classes[a.course].number} - ${o.classes[a.course].title}`:"N/A"}),e&&i.jsx(ke,{children:a.userId}),i.jsx(ke,{children:t(a.dateCreated)}),i.jsx(ke,{children:t(a.dateModified)}),i.jsx(ke,{children:i.jsx(Et,{title:"Edit",children:i.jsx("span",{children:i.jsx(Me,{onClick:()=>d&&I(a.id),color:"primary",disabled:!d,children:i.jsx(Bn,{})})})})}),i.jsx(ke,{children:i.jsx(Et,{title:"Delete",children:i.jsx("span",{children:i.jsx(Me,{onClick:()=>d&&D(a.id),color:"error",disabled:!d,children:i.jsx(wt,{})})})})})]},a.id)}):i.jsx($t,{children:i.jsx(ke,{colSpan:e?6:5,children:"No Designs Found"})})})]})})};function Hs(m,I){return I.forEach(function(D){D&&typeof D!="string"&&!Array.isArray(D)&&Object.keys(D).forEach(function(o){if(o!=="default"&&!(o in m)){var e=Object.getOwnPropertyDescriptor(D,o);Object.defineProperty(m,o,e.get?e:{enumerable:!0,get:function(){return D[o]}})}})}),Object.freeze(m)}function zn(m,I){return new Promise(function(D,o){let e;return zs(m).then(function(t){try{return e=t,D(new Blob([I.slice(0,2),e,I.slice(2)],{type:"image/jpeg"}))}catch(a){return o(a)}},o)})}const zs=m=>new Promise((I,D)=>{const o=new FileReader;o.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let a=0;if(t.getUint16(a)!==65496)return D("not a valid JPEG");for(a+=2;;){const d=t.getUint16(a);if(d===65498)break;const v=t.getUint16(a+2);if(d===65505&&t.getUint32(a+4)===1165519206){const x=a+10;let n;switch(t.getUint16(x)){case 18761:n=!0;break;case 19789:n=!1;break;default:return D("TIFF header contains invalid endian")}if(t.getUint16(x+2,n)!==42)return D("TIFF header contains invalid version");const r=t.getUint32(x+4,n),s=x+r+2+12*t.getUint16(x+r,n);for(let c=x+r+2;c<s;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return D("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return D("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return I(e.slice(a,a+2+v))}a+=2+v}return I(new Blob)}),o.readAsArrayBuffer(m)});var Mt={},Ws={get exports(){return Mt},set exports(m){Mt=m}};(function(m){var I,D,o={};Ws.exports=o,o.parse=function(e,t){for(var a=o.bin.readUshort,d=o.bin.readUint,v=0,x={},n=new Uint8Array(e),r=n.length-4;d(n,r)!=101010256;)r--;v=r,v+=4;var s=a(n,v+=4);a(n,v+=2);var c=d(n,v+=2),g=d(n,v+=4);v+=4,v=g;for(var T=0;T<s;T++){d(n,v),v+=4,v+=4,v+=4,d(n,v+=4),c=d(n,v+=4);var k=d(n,v+=4),S=a(n,v+=4),B=a(n,v+2),O=a(n,v+4);v+=6;var E=d(n,v+=8);v+=4,v+=S+B+O,o._readLocal(n,E,x,c,k,t)}return x},o._readLocal=function(e,t,a,d,v,x){var n=o.bin.readUshort,r=o.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var c=n(e,t+=8),g=n(e,t+=2);t+=2;var T=o.bin.readUTF8(e,t,c);if(t+=c,t+=g,x)a[T]={size:v,csize:d};else{var k=new Uint8Array(e.buffer,t);if(s==0)a[T]=new Uint8Array(k.buffer.slice(t,t+d));else{if(s!=8)throw"unknown compression method: "+s;var S=new Uint8Array(v);o.inflateRaw(k,S),a[T]=S}}},o.inflateRaw=function(e,t){return o.F.inflate(e,t)},o.inflate=function(e,t){return e[0],e[1],o.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},o.deflate=function(e,t){t==null&&(t={level:6});var a=0,d=new Uint8Array(50+Math.floor(1.1*e.length));d[a]=120,d[a+1]=156,a+=2,a=o.F.deflateRaw(e,d,a,t.level);var v=o.adler(e,0,e.length);return d[a+0]=v>>>24&255,d[a+1]=v>>>16&255,d[a+2]=v>>>8&255,d[a+3]=v>>>0&255,new Uint8Array(d.buffer,0,a+4)},o.deflateRaw=function(e,t){t==null&&(t={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),d=o.F.deflateRaw(e,a,d,t.level);return new Uint8Array(a.buffer,0,d)},o.encode=function(e,t){t==null&&(t=!1);var a=0,d=o.bin.writeUint,v=o.bin.writeUshort,x={};for(var n in e){var r=!o._noNeed(n)&&!t,s=e[n],c=o.crc.crc(s,0,s.length);x[n]={cpr:r,usize:s.length,crc:c,file:r?o.deflateRaw(s):s}}for(var n in x)a+=x[n].file.length+30+46+2*o.bin.sizeUTF8(n);a+=22;var g=new Uint8Array(a),T=0,k=[];for(var n in x){var S=x[n];k.push(T),T=o._writeHeader(g,T,n,S,0)}var B=0,O=T;for(var n in x)S=x[n],k.push(T),T=o._writeHeader(g,T,n,S,1,k[B++]);var E=T-O;return d(g,T,101010256),T+=4,v(g,T+=4,B),v(g,T+=2,B),d(g,T+=2,E),d(g,T+=4,O),T+=4,T+=2,g.buffer},o._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},o._writeHeader=function(e,t,a,d,v,x){var n=o.bin.writeUint,r=o.bin.writeUshort,s=d.file;return n(e,t,v==0?67324752:33639248),t+=4,v==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,d.cpr?8:0),n(e,t+=2,0),n(e,t+=4,d.crc),n(e,t+=4,s.length),n(e,t+=4,d.usize),r(e,t+=4,o.bin.sizeUTF8(a)),r(e,t+=2,0),t+=2,v==1&&(t+=2,t+=2,n(e,t+=6,x),t+=4),t+=o.bin.writeUTF8(e,t,a),v==0&&(e.set(s,t),t+=s.length),t},o.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var a=t,d=0;d<8;d++)1&a?a=3988292384^a>>>1:a>>>=1;e[t]=a}return e}(),update:function(e,t,a,d){for(var v=0;v<d;v++)e=o.crc.table[255&(e^t[a+v])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^o.crc.update(4294967295,e,t,a)}},o.adler=function(e,t,a){for(var d=1,v=0,x=t,n=t+a;x<n;){for(var r=Math.min(x+5552,n);x<r;)v+=d+=e[x++];d%=65521,v%=65521}return v<<16|d},o.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255,e[t+2]=a>>16&255,e[t+3]=a>>24&255},readASCII:function(e,t,a){for(var d="",v=0;v<a;v++)d+=String.fromCharCode(e[t+v]);return d},writeASCII:function(e,t,a){for(var d=0;d<a.length;d++)e[t+d]=a.charCodeAt(d)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,a){for(var d,v="",x=0;x<a;x++)v+="%"+o.bin.pad(e[t+x].toString(16));try{d=decodeURIComponent(v)}catch{return o.bin.readASCII(e,t,a)}return d},writeUTF8:function(e,t,a){for(var d=a.length,v=0,x=0;x<d;x++){var n=a.charCodeAt(x);if((4294967168&n)==0)e[t+v]=n,v++;else if((4294965248&n)==0)e[t+v]=192|n>>6,e[t+v+1]=128|n>>0&63,v+=2;else if((4294901760&n)==0)e[t+v]=224|n>>12,e[t+v+1]=128|n>>6&63,e[t+v+2]=128|n>>0&63,v+=3;else{if((4292870144&n)!=0)throw"e";e[t+v]=240|n>>18,e[t+v+1]=128|n>>12&63,e[t+v+2]=128|n>>6&63,e[t+v+3]=128|n>>0&63,v+=4}}return v},sizeUTF8:function(e){for(var t=e.length,a=0,d=0;d<t;d++){var v=e.charCodeAt(d);if((4294967168&v)==0)a++;else if((4294965248&v)==0)a+=2;else if((4294901760&v)==0)a+=3;else{if((4292870144&v)!=0)throw"e";a+=4}}return a}},o.F={},o.F.deflateRaw=function(e,t,a,d){var v=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][d],x=o.F.U,n=o.F._goodIndex;o.F._hash;var r=o.F._putsE,s=0,c=a<<3,g=0,T=e.length;if(d==0){for(;s<T;)r(t,c,s+(j=Math.min(65535,T-s))==T?1:0),c=o.F._copyExact(e,s,j,t,c+8),s+=j;return c>>>3}var k=x.lits,S=x.strt,B=x.prev,O=0,E=0,P=0,y=0,_=0,h=0;for(T>2&&(S[h=o.F._hash(e,0)]=0),s=0;s<T;s++){if(_=h,s+1<T-2){h=o.F._hash(e,s+1);var u=s+1&32767;B[u]=S[h],S[h]=u}if(g<=s){(O>14e3||E>26697)&&T-s>100&&(g<s&&(k[O]=s-g,O+=2,g=s),c=o.F._writeBlock(s==T-1||g==T?1:0,k,O,y,e,P,s-P,t,c),O=E=y=0,P=s);var p=0;s<T-2&&(p=o.F._bestMatch(e,s,B,_,Math.min(v[2],T-s),v[3]));var j=p>>>16,w=65535&p;if(p!=0){w=65535&p;var C=n(j=p>>>16,x.of0);x.lhst[257+C]++;var b=n(w,x.df0);x.dhst[b]++,y+=x.exb[C]+x.dxb[b],k[O]=j<<23|s-g,k[O+1]=w<<16|C<<8|b,O+=2,g=s+j}else x.lhst[e[s]]++;E++}}for(P==s&&e.length!=0||(g<s&&(k[O]=s-g,O+=2,g=s),c=o.F._writeBlock(1,k,O,y,e,P,s-P,t,c),O=0,E=0,O=E=y=0,P=s);(7&c)!=0;)c++;return c>>>3},o.F._bestMatch=function(e,t,a,d,v,x){var n=32767&t,r=a[n],s=n-r+32768&32767;if(r==n||d!=o.F._hash(e,t-s))return 0;for(var c=0,g=0,T=Math.min(32767,t);s<=T&&--x!=0&&r!=n;){if(c==0||e[t+c]==e[t+c-s]){var k=o.F._howLong(e,t,s);if(k>c){if(g=s,(c=k)>=v)break;s+2<k&&(k=s+2);for(var S=0,B=0;B<k-2;B++){var O=t-s+B+32768&32767,E=O-a[O]+32768&32767;E>S&&(S=E,r=O)}}}s+=(n=r)-(r=a[n])+32768&32767}return c<<16|g},o.F._howLong=function(e,t,a){if(e[t]!=e[t-a]||e[t+1]!=e[t+1-a]||e[t+2]!=e[t+2-a])return 0;var d=t,v=Math.min(e.length,t+258);for(t+=3;t<v&&e[t]==e[t-a];)t++;return t-d},o.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},o.saved=0,o.F._writeBlock=function(e,t,a,d,v,x,n,r,s){var c,g,T,k,S,B,O,E,P,y=o.F.U,_=o.F._putsF,h=o.F._putsE;y.lhst[256]++,g=(c=o.F.getTrees())[0],T=c[1],k=c[2],S=c[3],B=c[4],O=c[5],E=c[6],P=c[7];var u=32+((s+3&7)==0?0:8-(s+3&7))+(n<<3),p=d+o.F.contSize(y.fltree,y.lhst)+o.F.contSize(y.fdtree,y.dhst),j=d+o.F.contSize(y.ltree,y.lhst)+o.F.contSize(y.dtree,y.dhst);j+=14+3*O+o.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var w=0;w<286;w++)y.lhst[w]=0;for(w=0;w<30;w++)y.dhst[w]=0;for(w=0;w<19;w++)y.ihst[w]=0;var C=u<p&&u<j?0:p<j?1:2;if(_(r,s,e),_(r,s+1,C),s+=3,C==0){for(;(7&s)!=0;)s++;s=o.F._copyExact(v,x,n,r,s)}else{var b,A;if(C==1&&(b=y.fltree,A=y.fdtree),C==2){o.F.makeCodes(y.ltree,g),o.F.revCodes(y.ltree,g),o.F.makeCodes(y.dtree,T),o.F.revCodes(y.dtree,T),o.F.makeCodes(y.itree,k),o.F.revCodes(y.itree,k),b=y.ltree,A=y.dtree,h(r,s,S-257),h(r,s+=5,B-1),h(r,s+=5,O-4),s+=4;for(var f=0;f<O;f++)h(r,s+3*f,y.itree[1+(y.ordr[f]<<1)]);s+=3*O,s=o.F._codeTiny(E,y.itree,r,s),s=o.F._codeTiny(P,y.itree,r,s)}for(var l=x,N=0;N<a;N+=2){for(var F=t[N],M=F>>>23,$=l+(8388607&F);l<$;)s=o.F._writeLit(v[l++],b,r,s);if(M!=0){var z=t[N+1],V=z>>16,W=z>>8&255,R=255&z;h(r,s=o.F._writeLit(257+W,b,r,s),M-y.of0[W]),s+=y.exb[W],_(r,s=o.F._writeLit(R,A,r,s),V-y.df0[R]),s+=y.dxb[R],l+=M}}s=o.F._writeLit(256,b,r,s)}return s},o.F._copyExact=function(e,t,a,d,v){var x=v>>>3;return d[x]=a,d[x+1]=a>>>8,d[x+2]=255-d[x],d[x+3]=255-d[x+1],x+=4,d.set(new Uint8Array(e.buffer,t,a),x),v+(a+4<<3)},o.F.getTrees=function(){for(var e=o.F.U,t=o.F._hufTree(e.lhst,e.ltree,15),a=o.F._hufTree(e.dhst,e.dtree,15),d=[],v=o.F._lenCodes(e.ltree,d),x=[],n=o.F._lenCodes(e.dtree,x),r=0;r<d.length;r+=2)e.ihst[d[r]]++;for(r=0;r<x.length;r+=2)e.ihst[x[r]]++;for(var s=o.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,a,s,v,n,c,d,x]},o.F.getSecond=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(e[a+1]);return t},o.F.nonZero=function(e){for(var t="",a=0;a<e.length;a+=2)e[a+1]!=0&&(t+=(a>>1)+",");return t},o.F.contSize=function(e,t){for(var a=0,d=0;d<t.length;d++)a+=t[d]*e[1+(d<<1)];return a},o.F._codeTiny=function(e,t,a,d){for(var v=0;v<e.length;v+=2){var x=e[v],n=e[v+1];d=o.F._writeLit(x,t,a,d);var r=x==16?2:x==17?3:7;x>15&&(o.F._putsE(a,d,n,r),d+=r)}return d},o.F._lenCodes=function(e,t){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var d=0;d<a;d+=2){var v=e[d+1],x=d+3<a?e[d+3]:-1,n=d+5<a?e[d+5]:-1,r=d==0?-1:e[d-1];if(v==0&&x==v&&n==v){for(var s=d+5;s+2<a&&e[s+2]==v;)s+=2;(c=Math.min(s+1-d>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),d+=2*c-2}else if(v==r&&x==v&&n==v){for(s=d+5;s+2<a&&e[s+2]==v;)s+=2;var c=Math.min(s+1-d>>>1,6);t.push(16,c-3),d+=2*c-2}else t.push(v,0)}return a>>>1},o.F._hufTree=function(e,t,a){var d=[],v=e.length,x=t.length,n=0;for(n=0;n<x;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<v;n++)e[n]!=0&&d.push({lit:n,f:e[n]});var r=d.length,s=d.slice(0);if(r==0)return 0;if(r==1){var c=d[0].lit;return s=c==0?1:0,t[1+(c<<1)]=1,t[1+(s<<1)]=1,1}d.sort(function(E,P){return E.f-P.f});var g=d[0],T=d[1],k=0,S=1,B=2;for(d[0]={lit:-1,f:g.f+T.f,l:g,r:T,d:0};S!=r-1;)g=k!=S&&(B==r||d[k].f<d[B].f)?d[k++]:d[B++],T=k!=S&&(B==r||d[k].f<d[B].f)?d[k++]:d[B++],d[S++]={lit:-1,f:g.f+T.f,l:g,r:T};var O=o.F.setDepth(d[S-1],0);for(O>a&&(o.F.restrictDepth(s,a,O),O=a),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return O},o.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(o.F.setDepth(e.l,t+1),o.F.setDepth(e.r,t+1))},o.F.restrictDepth=function(e,t,a){var d=0,v=1<<a-t,x=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),d=0;d<e.length&&e[d].d>t;d++){var n=e[d].d;e[d].d=t,x+=v-(1<<a-n)}for(x>>>=a-t;x>0;)(n=e[d].d)<t?(e[d].d++,x-=1<<t-n-1):d++;for(;d>=0;d--)e[d].d==t&&x<0&&(e[d].d--,x++);x!=0&&console.log("debt left")},o.F._goodIndex=function(e,t){var a=0;return t[16|a]<=e&&(a|=16),t[8|a]<=e&&(a|=8),t[4|a]<=e&&(a|=4),t[2|a]<=e&&(a|=2),t[1|a]<=e&&(a|=1),a},o.F._writeLit=function(e,t,a,d){return o.F._putsF(a,d,t[e<<1]),d+t[1+(e<<1)]},o.F.inflate=function(e,t){var a=Uint8Array;if(e[0]==3&&e[1]==0)return t||new a(0);var d=o.F,v=d._bitsF,x=d._bitsE,n=d._decodeTiny,r=d.makeCodes,s=d.codes2map,c=d._get17,g=d.U,T=t==null;T&&(t=new a(e.length>>>2<<3));for(var k,S,B=0,O=0,E=0,P=0,y=0,_=0,h=0,u=0,p=0;B==0;)if(B=v(e,p,1),O=v(e,p+1,2),p+=3,O!=0){if(T&&(t=o.F._check(t,u+(1<<17))),O==1&&(k=g.flmap,S=g.fdmap,_=511,h=31),O==2){E=x(e,p,5)+257,P=x(e,p+5,5)+1,y=x(e,p+10,4)+4,p+=14;for(var j=0;j<38;j+=2)g.itree[j]=0,g.itree[j+1]=0;var w=1;for(j=0;j<y;j++){var C=x(e,p+3*j,3);g.itree[1+(g.ordr[j]<<1)]=C,C>w&&(w=C)}p+=3*y,r(g.itree,w),s(g.itree,w,g.imap),k=g.lmap,S=g.dmap,p=n(g.imap,(1<<w)-1,E+P,e,p,g.ttree);var b=d._copyOut(g.ttree,0,E,g.ltree);_=(1<<b)-1;var A=d._copyOut(g.ttree,E,P,g.dtree);h=(1<<A)-1,r(g.ltree,b),s(g.ltree,b,k),r(g.dtree,A),s(g.dtree,A,S)}for(;;){var f=k[c(e,p)&_];p+=15&f;var l=f>>>4;if(!(l>>>8))t[u++]=l;else{if(l==256)break;var N=u+l-254;if(l>264){var F=g.ldef[l-257];N=u+(F>>>3)+x(e,p,7&F),p+=7&F}var M=S[c(e,p)&h];p+=15&M;var $=M>>>4,z=g.ddef[$],V=(z>>>4)+v(e,p,15&z);for(p+=15&z,T&&(t=o.F._check(t,u+(1<<17)));u<N;)t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V];u=N}}}else{(7&p)!=0&&(p+=8-(7&p));var W=4+(p>>>3),R=e[W-4]|e[W-3]<<8;T&&(t=o.F._check(t,u+R)),t.set(new a(e.buffer,e.byteOffset+W,R),u),p=W+R<<3,u+=R}return t.length==u?t:t.slice(0,u)},o.F._check=function(e,t){var a=e.length;if(t<=a)return e;var d=new Uint8Array(Math.max(a<<1,t));return d.set(e,0),d},o.F._decodeTiny=function(e,t,a,d,v,x){for(var n=o.F._bitsE,r=o.F._get17,s=0;s<a;){var c=e[r(d,v)&t];v+=15&c;var g=c>>>4;if(g<=15)x[s]=g,s++;else{var T=0,k=0;g==16?(k=3+n(d,v,2),v+=2,T=x[s-1]):g==17?(k=3+n(d,v,3),v+=3):g==18&&(k=11+n(d,v,7),v+=7);for(var S=s+k;s<S;)x[s]=T,s++}}return v},o.F._copyOut=function(e,t,a,d){for(var v=0,x=0,n=d.length>>>1;x<a;){var r=e[x+t];d[x<<1]=0,d[1+(x<<1)]=r,r>v&&(v=r),x++}for(;x<n;)d[x<<1]=0,d[1+(x<<1)]=0,x++;return v},o.F.makeCodes=function(e,t){for(var a,d,v,x,n=o.F.U,r=e.length,s=n.bl_count,c=0;c<=t;c++)s[c]=0;for(c=1;c<r;c+=2)s[e[c]]++;var g=n.next_code;for(a=0,s[0]=0,d=1;d<=t;d++)a=a+s[d-1]<<1,g[d]=a;for(v=0;v<r;v+=2)(x=e[v+1])!=0&&(e[v]=g[x],g[x]++)},o.F.codes2map=function(e,t,a){for(var d=e.length,v=o.F.U.rev15,x=0;x<d;x+=2)if(e[x+1]!=0)for(var n=x>>1,r=e[x+1],s=n<<4|r,c=t-r,g=e[x]<<c,T=g+(1<<c);g!=T;)a[v[g]>>>15-t]=s,g++},o.F.revCodes=function(e,t){for(var a=o.F.U.rev15,d=15-t,v=0;v<e.length;v+=2){var x=e[v]<<t-e[v+1];e[v]=a[x]>>>d}},o.F._putsE=function(e,t,a){a<<=7&t;var d=t>>>3;e[d]|=a,e[d+1]|=a>>>8},o.F._putsF=function(e,t,a){a<<=7&t;var d=t>>>3;e[d]|=a,e[d+1]|=a>>>8,e[d+2]|=a>>>16},o.F._bitsE=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<a)-1},o.F._bitsF=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<a)-1},o.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},o.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},o.F.U=(I=Uint16Array,D=Uint32Array,{next_code:new I(16),bl_count:new I(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new I(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new I(512),fltree:[],fdmap:new I(32),fdtree:[],lmap:new I(32768),ltree:[],ttree:[],dmap:new I(32768),dtree:[],imap:new I(512),itree:[],rev15:new I(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new I(65536),prev:new I(32768)}),function(){for(var e=o.F.U,t=0;t<32768;t++){var a=t;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[t]=(a>>>16|a<<16)>>>17}function d(v,x,n){for(;x--!=0;)v.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];d(e.fltree,144,8),d(e.fltree,112,9),d(e.fltree,24,7),d(e.fltree,8,8),o.F.makeCodes(e.fltree,9),o.F.codes2map(e.fltree,9,e.flmap),o.F.revCodes(e.fltree,9),d(e.fdtree,32,5),o.F.makeCodes(e.fdtree,5),o.F.codes2map(e.fdtree,5,e.fdmap),o.F.revCodes(e.fdtree,5),d(e.itree,19,0),d(e.ltree,286,0),d(e.dtree,30,0),d(e.ttree,320,0)}()})();var qs=Hs({__proto__:null,default:Mt},[Mt]);const Be=function(){var m={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let c="";for(let g=0;g<s;g++)c+=String.fromCharCode(n[r+g]);return c},writeASCII(n,r,s){for(let c=0;c<s.length;c++)n[r+c]=s.charCodeAt(c)},readBytes(n,r,s){const c=[];for(let g=0;g<s;g++)c.push(n[r+g]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let c,g="";for(let T=0;T<s;T++)g+=`%${m.pad(n[r+T].toString(16))}`;try{c=decodeURIComponent(g)}catch{return m.readASCII(n,r,s)}return c}};function I(n,r,s,c){const g=r*s,T=t(c),k=Math.ceil(r*T/8),S=new Uint8Array(4*g),B=new Uint32Array(S.buffer),{ctype:O}=c,{depth:E}=c,P=m.readUshort;if(O==6){const F=g<<2;if(E==8)for(var y=0;y<F;y+=4)S[y]=n[y],S[y+1]=n[y+1],S[y+2]=n[y+2],S[y+3]=n[y+3];if(E==16)for(y=0;y<F;y++)S[y]=n[y<<1]}else if(O==2){const F=c.tabs.tRNS;if(F==null){if(E==8)for(y=0;y<g;y++){var _=3*y;B[y]=255<<24|n[_+2]<<16|n[_+1]<<8|n[_]}if(E==16)for(y=0;y<g;y++)_=6*y,B[y]=255<<24|n[_+4]<<16|n[_+2]<<8|n[_]}else{var h=F[0];const M=F[1],$=F[2];if(E==8)for(y=0;y<g;y++){var u=y<<2;_=3*y,B[y]=255<<24|n[_+2]<<16|n[_+1]<<8|n[_],n[_]==h&&n[_+1]==M&&n[_+2]==$&&(S[u+3]=0)}if(E==16)for(y=0;y<g;y++)u=y<<2,_=6*y,B[y]=255<<24|n[_+4]<<16|n[_+2]<<8|n[_],P(n,_)==h&&P(n,_+2)==M&&P(n,_+4)==$&&(S[u+3]=0)}}else if(O==3){const F=c.tabs.PLTE,M=c.tabs.tRNS,$=M?M.length:0;if(E==1)for(var p=0;p<s;p++){var j=p*k,w=p*r;for(y=0;y<r;y++){u=w+y<<2;var C=3*(b=n[j+(y>>3)]>>7-((7&y)<<0)&1);S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255}}if(E==2)for(p=0;p<s;p++)for(j=p*k,w=p*r,y=0;y<r;y++)u=w+y<<2,C=3*(b=n[j+(y>>2)]>>6-((3&y)<<1)&3),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255;if(E==4)for(p=0;p<s;p++)for(j=p*k,w=p*r,y=0;y<r;y++)u=w+y<<2,C=3*(b=n[j+(y>>1)]>>4-((1&y)<<2)&15),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255;if(E==8)for(y=0;y<g;y++){var b;u=y<<2,C=3*(b=n[y]),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?M[b]:255}}else if(O==4){if(E==8)for(y=0;y<g;y++){u=y<<2;var A=n[f=y<<1];S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+1]}if(E==16)for(y=0;y<g;y++){var f;u=y<<2,A=n[f=y<<2],S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+2]}}else if(O==0)for(h=c.tabs.tRNS?c.tabs.tRNS:-1,p=0;p<s;p++){const F=p*k,M=p*r;if(E==1)for(var l=0;l<r;l++){var N=(A=255*(n[F+(l>>>3)]>>>7-(7&l)&1))==255*h?0:255;B[M+l]=N<<24|A<<16|A<<8|A}else if(E==2)for(l=0;l<r;l++)N=(A=85*(n[F+(l>>>2)]>>>6-((3&l)<<1)&3))==85*h?0:255,B[M+l]=N<<24|A<<16|A<<8|A;else if(E==4)for(l=0;l<r;l++)N=(A=17*(n[F+(l>>>1)]>>>4-((1&l)<<2)&15))==17*h?0:255,B[M+l]=N<<24|A<<16|A<<8|A;else if(E==8)for(l=0;l<r;l++)N=(A=n[F+l])==h?0:255,B[M+l]=N<<24|A<<16|A<<8|A;else if(E==16)for(l=0;l<r;l++)A=n[F+(l<<1)],N=P(n,F+(l<<1))==h?0:255,B[M+l]=N<<24|A<<16|A<<8|A}return S}function D(n,r,s,c){const g=t(n),T=Math.ceil(s*g/8),k=new Uint8Array((T+1+n.interlace)*c);return r=n.tabs.CgBI?e(r,k):o(r,k),n.interlace==0?r=a(r,n,0,s,c):n.interlace==1&&(r=function(B,O){const E=O.width,P=O.height,y=t(O),_=y>>3,h=Math.ceil(E*y/8),u=new Uint8Array(P*h);let p=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const l=C[A],N=b[A];let F=0,M=0,$=j[A];for(;$<P;)$+=l,M++;let z=w[A];for(;z<E;)z+=N,F++;const V=Math.ceil(F*y/8);a(B,O,p,F,M);let W=0,R=j[A];for(;R<P;){let Z=w[A],se=p+W*V<<3;for(;Z<E;){var f;if(y==1&&(f=(f=B[se>>3])>>7-(7&se)&1,u[R*h+(Z>>3)]|=f<<7-((7&Z)<<0)),y==2&&(f=(f=B[se>>3])>>6-(7&se)&3,u[R*h+(Z>>2)]|=f<<6-((3&Z)<<1)),y==4&&(f=(f=B[se>>3])>>4-(7&se)&15,u[R*h+(Z>>1)]|=f<<4-((1&Z)<<2)),y>=8){const te=R*h+Z*_;for(let X=0;X<_;X++)u[te+X]=B[(se>>3)+X]}se+=y,Z+=N}W++,R+=l}F*M!=0&&(p+=M*(1+V)),A+=1}return u}(r,n)),r}function o(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const c=Uint8Array;let g,T,k=0,S=0,B=0,O=0,E=0,P=0,y=0,_=0,h=0;if(r[0]==3&&r[1]==0)return s||new c(0);const u=n.H,p=u.b,j=u.e,w=u.R,C=u.n,b=u.A,A=u.Z,f=u.m,l=s==null;for(l&&(s=new c(r.length>>>2<<5));k==0;)if(k=p(r,h,1),S=p(r,h+1,2),h+=3,S!=0){if(l&&(s=n.H.W(s,_+(1<<17))),S==1&&(g=f.J,T=f.h,P=511,y=31),S==2){B=j(r,h,5)+257,O=j(r,h+5,5)+1,E=j(r,h+10,4)+4,h+=14;let F=1;for(var N=0;N<38;N+=2)f.Q[N]=0,f.Q[N+1]=0;for(N=0;N<E;N++){const z=j(r,h+3*N,3);f.Q[1+(f.X[N]<<1)]=z,z>F&&(F=z)}h+=3*E,C(f.Q,F),b(f.Q,F,f.u),g=f.w,T=f.d,h=w(f.u,(1<<F)-1,B+O,r,h,f.v);const M=u.V(f.v,0,B,f.C);P=(1<<M)-1;const $=u.V(f.v,B,O,f.D);y=(1<<$)-1,C(f.C,M),b(f.C,M,g),C(f.D,$),b(f.D,$,T)}for(;;){const F=g[A(r,h)&P];h+=15&F;const M=F>>>4;if(!(M>>>8))s[_++]=M;else{if(M==256)break;{let $=_+M-254;if(M>264){const Z=f.q[M-257];$=_+(Z>>>3)+j(r,h,7&Z),h+=7&Z}const z=T[A(r,h)&y];h+=15&z;const V=z>>>4,W=f.c[V],R=(W>>>4)+p(r,h,15&W);for(h+=15&W;_<$;)s[_]=s[_++-R],s[_]=s[_++-R],s[_]=s[_++-R],s[_]=s[_++-R];_=$}}}}else{(7&h)!=0&&(h+=8-(7&h));const F=4+(h>>>3),M=r[F-4]|r[F-3]<<8;l&&(s=n.H.W(s,_+M)),s.set(new c(r.buffer,r.byteOffset+F,M),_),h=F+M<<3,_+=M}return s.length==_?s:s.slice(0,_)},n.H.W=function(r,s){const c=r.length;if(s<=c)return r;const g=new Uint8Array(c<<1);return g.set(r,0),g},n.H.R=function(r,s,c,g,T,k){const S=n.H.e,B=n.H.Z;let O=0;for(;O<c;){const E=r[B(g,T)&s];T+=15&E;const P=E>>>4;if(P<=15)k[O]=P,O++;else{let y=0,_=0;P==16?(_=3+S(g,T,2),T+=2,y=k[O-1]):P==17?(_=3+S(g,T,3),T+=3):P==18&&(_=11+S(g,T,7),T+=7);const h=O+_;for(;O<h;)k[O]=y,O++}}return T},n.H.V=function(r,s,c,g){let T=0,k=0;const S=g.length>>>1;for(;k<c;){const B=r[k+s];g[k<<1]=0,g[1+(k<<1)]=B,B>T&&(T=B),k++}for(;k<S;)g[k<<1]=0,g[1+(k<<1)]=0,k++;return T},n.H.n=function(r,s){const c=n.H.m,g=r.length;let T,k,S,B;const O=c.j;for(var E=0;E<=s;E++)O[E]=0;for(E=1;E<g;E+=2)O[r[E]]++;const P=c.K;for(T=0,O[0]=0,k=1;k<=s;k++)T=T+O[k-1]<<1,P[k]=T;for(S=0;S<g;S+=2)B=r[S+1],B!=0&&(r[S]=P[B],P[B]++)},n.H.A=function(r,s,c){const g=r.length,T=n.H.m.r;for(let k=0;k<g;k+=2)if(r[k+1]!=0){const S=k>>1,B=r[k+1],O=S<<4|B,E=s-B;let P=r[k]<<E;const y=P+(1<<E);for(;P!=y;)c[T[P]>>>15-s]=O,P++}},n.H.l=function(r,s){const c=n.H.m.r,g=15-s;for(let T=0;T<r.length;T+=2){const k=r[T]<<s-r[T+1];r[T]=c[k]>>>g}},n.H.M=function(r,s,c){c<<=7&s;const g=s>>>3;r[g]|=c,r[g+1]|=c>>>8},n.H.I=function(r,s,c){c<<=7&s;const g=s>>>3;r[g]|=c,r[g+1]|=c>>>8,r[g+2]|=c>>>16},n.H.e=function(r,s,c){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<c)-1},n.H.b=function(r,s,c){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<c)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let g=s;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,r.r[s]=(g>>>16|g<<16)>>>17}function c(g,T,k){for(;T--!=0;)g.push(0,k)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];c(r._,144,8),c(r._,112,9),c(r._,24,7),c(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),c(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),c(r.Q,19,0),c(r.C,286,0),c(r.D,30,0),c(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function a(n,r,s,c,g){let T=t(r);const k=Math.ceil(c*T/8);let S,B;T=Math.ceil(T/8);let O=n[s],E=0;if(O>1&&(n[s]=[0,0,1][O-2]),O==3)for(E=T;E<k;E++)n[E+1]=n[E+1]+(n[E+1-T]>>>1)&255;for(let P=0;P<g;P++)if(S=s+P*k,B=S+P+1,O=n[B-1],E=0,O==0)for(;E<k;E++)n[S+E]=n[B+E];else if(O==1){for(;E<T;E++)n[S+E]=n[B+E];for(;E<k;E++)n[S+E]=n[B+E]+n[S+E-T]}else if(O==2)for(;E<k;E++)n[S+E]=n[B+E]+n[S+E-k];else if(O==3){for(;E<T;E++)n[S+E]=n[B+E]+(n[S+E-k]>>>1);for(;E<k;E++)n[S+E]=n[B+E]+(n[S+E-k]+n[S+E-T]>>>1)}else{for(;E<T;E++)n[S+E]=n[B+E]+d(0,n[S+E-k],0);for(;E<k;E++)n[S+E]=n[B+E]+d(n[S+E-T],n[S+E-k],n[S+E-T-k])}return n}function d(n,r,s){const c=n+r-s,g=c-n,T=c-r,k=c-s;return g*g<=T*T&&g*g<=k*k?n:T*T<=k*k?r:s}function v(n,r,s){s.width=m.readUint(n,r),r+=4,s.height=m.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function x(n,r,s,c,g,T,k,S,B){const O=Math.min(r,g),E=Math.min(s,T);let P=0,y=0;for(let A=0;A<E;A++)for(let f=0;f<O;f++)if(k>=0&&S>=0?(P=A*r+f<<2,y=(S+A)*g+k+f<<2):(P=(-S+A)*r-k+f<<2,y=A*g+f<<2),B==0)c[y]=n[P],c[y+1]=n[P+1],c[y+2]=n[P+2],c[y+3]=n[P+3];else if(B==1){var _=n[P+3]*.00392156862745098,h=n[P]*_,u=n[P+1]*_,p=n[P+2]*_,j=c[y+3]*(1/255),w=c[y]*j,C=c[y+1]*j,b=c[y+2]*j;const l=1-_,N=_+j*l,F=N==0?0:1/N;c[y+3]=255*N,c[y+0]=(h+w*l)*F,c[y+1]=(u+C*l)*F,c[y+2]=(p+b*l)*F}else if(B==2)_=n[P+3],h=n[P],u=n[P+1],p=n[P+2],j=c[y+3],w=c[y],C=c[y+1],b=c[y+2],_==j&&h==w&&u==C&&p==b?(c[y]=0,c[y+1]=0,c[y+2]=0,c[y+3]=0):(c[y]=h,c[y+1]=u,c[y+2]=p,c[y+3]=_);else if(B==3){if(_=n[P+3],h=n[P],u=n[P+1],p=n[P+2],j=c[y+3],w=c[y],C=c[y+1],b=c[y+2],_==j&&h==w&&u==C&&p==b)continue;if(_<220&&j>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let c=8;const g=m,T=g.readUshort,k=g.readUint,S={tabs:{},frames:[]},B=new Uint8Array(s.length);let O,E=0,P=0;const y=[137,80,78,71,13,10,26,10];for(var _=0;_<8;_++)if(s[_]!=y[_])throw"The input is not a PNG file!";for(;c<s.length;){const A=g.readUint(s,c);c+=4;const f=g.readASCII(s,c,4);if(c+=4,f=="IHDR")v(s,c,S);else if(f=="iCCP"){for(var h=c;s[h]!=0;)h++;g.readASCII(s,c,h-c),s[h+1];const l=s.slice(h+2,c+A);let N=null;try{N=o(l)}catch{N=e(l)}S.tabs[f]=N}else if(f=="CgBI")S.tabs[f]=s.slice(c,c+4);else if(f=="IDAT"){for(_=0;_<A;_++)B[E+_]=s[c+_];E+=A}else if(f=="acTL")S.tabs[f]={num_frames:k(s,c),num_plays:k(s,c+4)},O=new Uint8Array(s.length);else if(f=="fcTL"){P!=0&&((b=S.frames[S.frames.length-1]).data=D(S,O.slice(0,P),b.rect.width,b.rect.height),P=0);const l={x:k(s,c+12),y:k(s,c+16),width:k(s,c+4),height:k(s,c+8)};let N=T(s,c+22);N=T(s,c+20)/(N==0?100:N);const F={rect:l,delay:Math.round(1e3*N),dispose:s[c+24],blend:s[c+25]};S.frames.push(F)}else if(f=="fdAT"){for(_=0;_<A-4;_++)O[P+_]=s[c+_+4];P+=A-4}else if(f=="pHYs")S.tabs[f]=[g.readUint(s,c),g.readUint(s,c+4),s[c+8]];else if(f=="cHRM")for(S.tabs[f]=[],_=0;_<8;_++)S.tabs[f].push(g.readUint(s,c+4*_));else if(f=="tEXt"||f=="zTXt"){S.tabs[f]==null&&(S.tabs[f]={});var u=g.nextZero(s,c),p=g.readASCII(s,c,u-c),j=c+A-u-1;if(f=="tEXt")C=g.readASCII(s,u+1,j);else{var w=o(s.slice(u+2,u+2+j));C=g.readUTF8(w,0,w.length)}S.tabs[f][p]=C}else if(f=="iTXt"){S.tabs[f]==null&&(S.tabs[f]={}),u=0,h=c,u=g.nextZero(s,h),p=g.readASCII(s,h,u-h);const l=s[h=u+1];var C;s[h+1],h+=2,u=g.nextZero(s,h),g.readASCII(s,h,u-h),h=u+1,u=g.nextZero(s,h),g.readUTF8(s,h,u-h),j=A-((h=u+1)-c),l==0?C=g.readUTF8(s,h,j):(w=o(s.slice(h,h+j)),C=g.readUTF8(w,0,w.length)),S.tabs[f][p]=C}else if(f=="PLTE")S.tabs[f]=g.readBytes(s,c,A);else if(f=="hIST"){const l=S.tabs.PLTE.length/3;for(S.tabs[f]=[],_=0;_<l;_++)S.tabs[f].push(T(s,c+2*_))}else if(f=="tRNS")S.ctype==3?S.tabs[f]=g.readBytes(s,c,A):S.ctype==0?S.tabs[f]=T(s,c):S.ctype==2&&(S.tabs[f]=[T(s,c),T(s,c+2),T(s,c+4)]);else if(f=="gAMA")S.tabs[f]=g.readUint(s,c)/1e5;else if(f=="sRGB")S.tabs[f]=s[c];else if(f=="bKGD")S.ctype==0||S.ctype==4?S.tabs[f]=[T(s,c)]:S.ctype==2||S.ctype==6?S.tabs[f]=[T(s,c),T(s,c+2),T(s,c+4)]:S.ctype==3&&(S.tabs[f]=s[c]);else if(f=="IEND")break;c+=A,g.readUint(s,c),c+=4}var b;return P!=0&&((b=S.frames[S.frames.length-1]).data=D(S,O.slice(0,P),b.rect.width,b.rect.height)),S.data=D(S,B,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(r){const s=r.width,c=r.height;if(r.tabs.acTL==null)return[I(r.data,s,c,r).buffer];const g=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const T=s*c*4,k=new Uint8Array(T),S=new Uint8Array(T),B=new Uint8Array(T);for(let E=0;E<r.frames.length;E++){const P=r.frames[E],y=P.rect.x,_=P.rect.y,h=P.rect.width,u=P.rect.height,p=I(P.data,h,u,r);if(E!=0)for(var O=0;O<T;O++)B[O]=k[O];if(P.blend==0?x(p,h,u,k,s,c,y,_,0):P.blend==1&&x(p,h,u,k,s,c,y,_,1),g.push(k.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)x(S,h,u,k,s,c,y,_,0);else if(P.dispose==2)for(O=0;O<T;O++)k[O]=B[O]}}return g},_paeth:d,_copyTile:x,_bin:m}}();(function(){const{_copyTile:m}=Be,{_bin:I}=Be,D=Be._paeth;var o={table:function(){const h=new Uint32Array(256);for(let u=0;u<256;u++){let p=u;for(let j=0;j<8;j++)1&p?p=3988292384^p>>>1:p>>>=1;h[u]=p}return h}(),update(h,u,p,j){for(let w=0;w<j;w++)h=o.table[255&(h^u[p+w])]^h>>>8;return h},crc:(h,u,p)=>4294967295^o.update(4294967295,h,u,p)};function e(h,u,p,j){u[p]+=h[0]*j>>4,u[p+1]+=h[1]*j>>4,u[p+2]+=h[2]*j>>4,u[p+3]+=h[3]*j>>4}function t(h){return Math.max(0,Math.min(255,h))}function a(h,u){const p=h[0]-u[0],j=h[1]-u[1],w=h[2]-u[2],C=h[3]-u[3];return p*p+j*j+w*w+C*C}function d(h,u,p,j,w,C,b){b==null&&(b=1);const A=j.length,f=[];for(var l=0;l<A;l++){const R=j[l];f.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(l=0;l<A;l++){let R=4294967295;for(var N=0,F=0;F<A;F++){var M=a(f[l],f[F]);F!=l&&M<R&&(R=M,N=F)}}const $=new Uint32Array(w.buffer),z=new Int16Array(u*p*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(l=0;l<V.length;l++)V[l]=255*((V[l]+.5)/16-.5);for(let R=0;R<p;R++)for(let Z=0;Z<u;Z++){var W;l=4*(R*u+Z),b!=2?W=[t(h[l]+z[l]),t(h[l+1]+z[l+1]),t(h[l+2]+z[l+2]),t(h[l+3]+z[l+3])]:(M=V[4*(3&R)+(3&Z)],W=[t(h[l]+M),t(h[l+1]+M),t(h[l+2]+M),t(h[l+3]+M)]),N=0;let se=16777215;for(F=0;F<A;F++){const ie=a(W,f[F]);ie<se&&(se=ie,N=F)}const te=f[N],X=[W[0]-te[0],W[1]-te[1],W[2]-te[2],W[3]-te[3]];b==1&&(Z!=u-1&&e(X,z,l+4,7),R!=p-1&&(Z!=0&&e(X,z,l+4*u-4,3),e(X,z,l+4*u,5),Z!=u-1&&e(X,z,l+4*u+4,1))),C[l>>2]=N,$[l>>2]=j[N]}}function v(h,u,p,j,w){w==null&&(w={});const{crc:C}=o,b=I.writeUint,A=I.writeUshort,f=I.writeASCII;let l=8;const N=h.frames.length>1;let F,M=!1,$=33+(N?20:0);if(w.sRGB!=null&&($+=13),w.pHYs!=null&&($+=21),w.iCCP!=null&&(F=pako.deflate(w.iCCP),$+=21+F.length+4),h.ctype==3){for(var z=h.plte.length,V=0;V<z;V++)h.plte[V]>>>24!=255&&(M=!0);$+=8+3*z+4+(M?8+1*z+4:0)}for(var W=0;W<h.frames.length;W++)N&&($+=38),$+=(te=h.frames[W]).cimg.length+12,W!=0&&($+=4);$+=12;const R=new Uint8Array($),Z=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)R[V]=Z[V];if(b(R,l,13),l+=4,f(R,l,"IHDR"),l+=4,b(R,l,u),l+=4,b(R,l,p),l+=4,R[l]=h.depth,l++,R[l]=h.ctype,l++,R[l]=0,l++,R[l]=0,l++,R[l]=0,l++,b(R,l,C(R,l-17,17)),l+=4,w.sRGB!=null&&(b(R,l,1),l+=4,f(R,l,"sRGB"),l+=4,R[l]=w.sRGB,l++,b(R,l,C(R,l-5,5)),l+=4),w.iCCP!=null){const X=13+F.length;b(R,l,X),l+=4,f(R,l,"iCCP"),l+=4,f(R,l,"ICC profile"),l+=11,l+=2,R.set(F,l),l+=F.length,b(R,l,C(R,l-(X+4),X+4)),l+=4}if(w.pHYs!=null&&(b(R,l,9),l+=4,f(R,l,"pHYs"),l+=4,b(R,l,w.pHYs[0]),l+=4,b(R,l,w.pHYs[1]),l+=4,R[l]=w.pHYs[2],l++,b(R,l,C(R,l-13,13)),l+=4),N&&(b(R,l,8),l+=4,f(R,l,"acTL"),l+=4,b(R,l,h.frames.length),l+=4,b(R,l,w.loop!=null?w.loop:0),l+=4,b(R,l,C(R,l-12,12)),l+=4),h.ctype==3){for(b(R,l,3*(z=h.plte.length)),l+=4,f(R,l,"PLTE"),l+=4,V=0;V<z;V++){const X=3*V,ie=h.plte[V],ee=255&ie,ce=ie>>>8&255,_e=ie>>>16&255;R[l+X+0]=ee,R[l+X+1]=ce,R[l+X+2]=_e}if(l+=3*z,b(R,l,C(R,l-3*z-4,3*z+4)),l+=4,M){for(b(R,l,z),l+=4,f(R,l,"tRNS"),l+=4,V=0;V<z;V++)R[l+V]=h.plte[V]>>>24&255;l+=z,b(R,l,C(R,l-z-4,z+4)),l+=4}}let se=0;for(W=0;W<h.frames.length;W++){var te=h.frames[W];N&&(b(R,l,26),l+=4,f(R,l,"fcTL"),l+=4,b(R,l,se++),l+=4,b(R,l,te.rect.width),l+=4,b(R,l,te.rect.height),l+=4,b(R,l,te.rect.x),l+=4,b(R,l,te.rect.y),l+=4,A(R,l,j[W]),l+=2,A(R,l,1e3),l+=2,R[l]=te.dispose,l++,R[l]=te.blend,l++,b(R,l,C(R,l-30,30)),l+=4);const X=te.cimg;b(R,l,(z=X.length)+(W==0?0:4)),l+=4;const ie=l;f(R,l,W==0?"IDAT":"fdAT"),l+=4,W!=0&&(b(R,l,se++),l+=4),R.set(X,l),l+=z,b(R,l,C(R,ie,l-ie)),l+=4}return b(R,l,0),l+=4,f(R,l,"IEND"),l+=4,b(R,l,C(R,l-4,4)),l+=4,R.buffer}function x(h,u,p){for(let j=0;j<h.frames.length;j++){const w=h.frames[j];w.rect.width;const C=w.rect.height,b=new Uint8Array(C*w.bpl+C);w.cimg=c(w.img,C,w.bpp,w.bpl,b,u,p)}}function n(h,u,p,j,w){const C=w[0],b=w[1],A=w[2],f=w[3],l=w[4],N=w[5];let F=6,M=8,$=255;for(var z=0;z<h.length;z++){const pe=new Uint8Array(h[z]);for(var V=pe.length,W=0;W<V;W+=4)$&=pe[W+3]}const R=$!=255,Z=function(fe,ae,ge,be,he,Ie){const oe=[];for(var de=0;de<fe.length;de++){const we=new Uint8Array(fe[de]),ne=new Uint32Array(we.buffer);var xe;let De=0,re=0,Fe=ae,ye=ge,xt=be?1:0;if(de!=0){const Lt=Ie||be||de==1||oe[de-2].dispose!=0?1:2;let vt=0,Tt=1e9;for(let Je=0;Je<Lt;Je++){var Le=new Uint8Array(fe[de-1-Je]);const Ht=new Uint32Array(fe[de-1-Je]);let He=ae,Oe=ge,Ne=-1,et=-1;for(let $e=0;$e<ge;$e++)for(let ze=0;ze<ae;ze++)ne[ve=$e*ae+ze]!=Ht[ve]&&(ze<He&&(He=ze),ze>Ne&&(Ne=ze),$e<Oe&&(Oe=$e),$e>et&&(et=$e));Ne==-1&&(He=Oe=Ne=et=0),he&&((1&He)==1&&He--,(1&Oe)==1&&Oe--);const It=(Ne-He+1)*(et-Oe+1);It<Tt&&(Tt=It,vt=Je,De=He,re=Oe,Fe=Ne-He+1,ye=et-Oe+1)}Le=new Uint8Array(fe[de-1-vt]),vt==1&&(oe[de-1].dispose=2),xe=new Uint8Array(Fe*ye*4),m(Le,ae,ge,xe,Fe,ye,-De,-re,0),xt=m(we,ae,ge,xe,Fe,ye,-De,-re,3)?1:0,xt==1?s(we,ae,ge,xe,{x:De,y:re,width:Fe,height:ye}):m(we,ae,ge,xe,Fe,ye,-De,-re,0)}else xe=we.slice(0);oe.push({rect:{x:De,y:re,width:Fe,height:ye},img:xe,blend:xt,dispose:0})}if(be)for(de=0;de<oe.length;de++){if((le=oe[de]).blend==1)continue;const we=le.rect,ne=oe[de-1].rect,De=Math.min(we.x,ne.x),re=Math.min(we.y,ne.y),Fe={x:De,y:re,width:Math.max(we.x+we.width,ne.x+ne.width)-De,height:Math.max(we.y+we.height,ne.y+ne.height)-re};oe[de-1].dispose=1,de-1!=0&&r(fe,ae,ge,oe,de-1,Fe,he),r(fe,ae,ge,oe,de,Fe,he)}let Ge=0;if(fe.length!=1)for(var ve=0;ve<oe.length;ve++){var le;Ge+=(le=oe[ve]).rect.width*le.rect.height}return oe}(h,u,p,C,b,A),se={},te=[],X=[];if(j!=0){const pe=[];for(W=0;W<Z.length;W++)pe.push(Z[W].img.buffer);const fe=function(he){let Ie=0;for(var oe=0;oe<he.length;oe++)Ie+=he[oe].byteLength;const de=new Uint8Array(Ie);let xe=0;for(oe=0;oe<he.length;oe++){const Le=new Uint8Array(he[oe]),Ge=Le.length;for(let ve=0;ve<Ge;ve+=4){let le=Le[ve],we=Le[ve+1],ne=Le[ve+2];const De=Le[ve+3];De==0&&(le=we=ne=0),de[xe+ve]=le,de[xe+ve+1]=we,de[xe+ve+2]=ne,de[xe+ve+3]=De}xe+=Ge}return de.buffer}(pe),ae=T(fe,j);for(W=0;W<ae.plte.length;W++)te.push(ae.plte[W].est.rgba);let ge=0;for(W=0;W<Z.length;W++){const be=(ee=Z[W]).img.length;var ie=new Uint8Array(ae.inds.buffer,ge>>2,be>>2);X.push(ie);const he=new Uint8Array(ae.abuf,ge,be);N&&d(ee.img,ee.rect.width,ee.rect.height,te,he,ie),ee.img.set(he),ge+=be}}else for(z=0;z<Z.length;z++){var ee=Z[z];const pe=new Uint32Array(ee.img.buffer);var ce=ee.rect.width;for(V=pe.length,ie=new Uint8Array(V),X.push(ie),W=0;W<V;W++){const fe=pe[W];if(W!=0&&fe==pe[W-1])ie[W]=ie[W-1];else if(W>ce&&fe==pe[W-ce])ie[W]=ie[W-ce];else{let ae=se[fe];if(ae==null&&(se[fe]=ae=te.length,te.push(fe),te.length>=300))break;ie[W]=ae}}}const _e=te.length;for(_e<=256&&l==0&&(M=_e<=2?1:_e<=4?2:_e<=16?4:8,M=Math.max(M,f)),z=0;z<Z.length;z++){(ee=Z[z]).rect.x,ee.rect.y,ce=ee.rect.width;const pe=ee.rect.height;let fe=ee.img;new Uint32Array(fe.buffer);let ae=4*ce,ge=4;if(_e<=256&&l==0){ae=Math.ceil(M*ce/8);var Te=new Uint8Array(ae*pe);const be=X[z];for(let he=0;he<pe;he++){W=he*ae;const Ie=he*ce;if(M==8)for(var ue=0;ue<ce;ue++)Te[W+ue]=be[Ie+ue];else if(M==4)for(ue=0;ue<ce;ue++)Te[W+(ue>>1)]|=be[Ie+ue]<<4-4*(1&ue);else if(M==2)for(ue=0;ue<ce;ue++)Te[W+(ue>>2)]|=be[Ie+ue]<<6-2*(3&ue);else if(M==1)for(ue=0;ue<ce;ue++)Te[W+(ue>>3)]|=be[Ie+ue]<<7-1*(7&ue)}fe=Te,F=3,ge=1}else if(R==0&&Z.length==1){Te=new Uint8Array(ce*pe*3);const be=ce*pe;for(W=0;W<be;W++){const he=3*W,Ie=4*W;Te[he]=fe[Ie],Te[he+1]=fe[Ie+1],Te[he+2]=fe[Ie+2]}fe=Te,F=2,ge=3,ae=3*ce}ee.img=fe,ee.bpl=ae,ee.bpp=ge}return{ctype:F,depth:M,plte:te,frames:Z}}function r(h,u,p,j,w,C,b){const A=Uint8Array,f=Uint32Array,l=new A(h[w-1]),N=new f(h[w-1]),F=w+1<h.length?new A(h[w+1]):null,M=new A(h[w]),$=new f(M.buffer);let z=u,V=p,W=-1,R=-1;for(let se=0;se<C.height;se++)for(let te=0;te<C.width;te++){const X=C.x+te,ie=C.y+se,ee=ie*u+X,ce=$[ee];ce==0||j[w-1].dispose==0&&N[ee]==ce&&(F==null||F[4*ee+3]!=0)||(X<z&&(z=X),X>W&&(W=X),ie<V&&(V=ie),ie>R&&(R=ie))}W==-1&&(z=V=W=R=0),b&&((1&z)==1&&z--,(1&V)==1&&V--),C={x:z,y:V,width:W-z+1,height:R-V+1};const Z=j[w];Z.rect=C,Z.blend=1,Z.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(m(l,u,p,Z.img,C.width,C.height,-C.x,-C.y,0),s(M,u,p,Z.img,C)):m(M,u,p,Z.img,C.width,C.height,-C.x,-C.y,0)}function s(h,u,p,j,w){m(h,u,p,j,w.width,w.height,-w.x,-w.y,2)}function c(h,u,p,j,w,C,b){const A=[];let f,l=[0,1,2,3,4];C!=-1?l=[C]:(u*j>5e5||p==1)&&(l=[0]),b&&(f={level:0});const N=qs;for(var F=0;F<l.length;F++){for(let z=0;z<u;z++)g(w,h,z,j,p,l[F]);A.push(N.deflate(w,f))}let M,$=1e9;for(F=0;F<A.length;F++)A[F].length<$&&(M=F,$=A[F].length);return A[M]}function g(h,u,p,j,w,C){const b=p*j;let A=b+p;if(h[A]=C,A++,C==0)if(j<500)for(var f=0;f<j;f++)h[A+f]=u[b+f];else h.set(new Uint8Array(u.buffer,b,j),A);else if(C==1){for(f=0;f<w;f++)h[A+f]=u[b+f];for(f=w;f<j;f++)h[A+f]=u[b+f]-u[b+f-w]+256&255}else if(p==0){for(f=0;f<w;f++)h[A+f]=u[b+f];if(C==2)for(f=w;f<j;f++)h[A+f]=u[b+f];if(C==3)for(f=w;f<j;f++)h[A+f]=u[b+f]-(u[b+f-w]>>1)+256&255;if(C==4)for(f=w;f<j;f++)h[A+f]=u[b+f]-D(u[b+f-w],0,0)+256&255}else{if(C==2)for(f=0;f<j;f++)h[A+f]=u[b+f]+256-u[b+f-j]&255;if(C==3){for(f=0;f<w;f++)h[A+f]=u[b+f]+256-(u[b+f-j]>>1)&255;for(f=w;f<j;f++)h[A+f]=u[b+f]+256-(u[b+f-j]+u[b+f-w]>>1)&255}if(C==4){for(f=0;f<w;f++)h[A+f]=u[b+f]+256-D(0,u[b+f-j],0)&255;for(f=w;f<j;f++)h[A+f]=u[b+f]+256-D(u[b+f-w],u[b+f-j],u[b+f-w-j])&255}}}function T(h,u){const p=new Uint8Array(h),j=p.slice(0),w=new Uint32Array(j.buffer),C=k(j,u),b=C[0],A=C[1],f=p.length,l=new Uint8Array(f>>2);let N;if(p.length<2e7)for(var F=0;F<f;F+=4)N=S(b,M=p[F]*(1/255),$=p[F+1]*(1/255),z=p[F+2]*(1/255),V=p[F+3]*(1/255)),l[F>>2]=N.ind,w[F>>2]=N.est.rgba;else for(F=0;F<f;F+=4){var M=p[F]*.00392156862745098,$=p[F+1]*(1/255),z=p[F+2]*(1/255),V=p[F+3]*(1/255);for(N=b;N.left;)N=B(N.est,M,$,z,V)<=0?N.left:N.right;l[F>>2]=N.ind,w[F>>2]=N.est.rgba}return{abuf:j.buffer,inds:l,plte:A}}function k(h,u,p){p==null&&(p=1e-4);const j=new Uint32Array(h.buffer),w={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=P(h,w.i0,w.i1),w.est=y(w.bst);const C=[w];for(;C.length<u;){let A=0,f=0;for(var b=0;b<C.length;b++)C[b].est.L>A&&(A=C[b].est.L,f=b);if(A<p)break;const l=C[f],N=O(h,j,l.i0,l.i1,l.est.e,l.est.eMq255);if(l.i0>=N||l.i1<=N){l.est.L=0;continue}const F={i0:l.i0,i1:N,bst:null,est:null,tdst:0,left:null,right:null};F.bst=P(h,F.i0,F.i1),F.est=y(F.bst);const M={i0:N,i1:l.i1,bst:null,est:null,tdst:0,left:null,right:null};for(M.bst={R:[],m:[],N:l.bst.N-F.bst.N},b=0;b<16;b++)M.bst.R[b]=l.bst.R[b]-F.bst.R[b];for(b=0;b<4;b++)M.bst.m[b]=l.bst.m[b]-F.bst.m[b];M.est=y(M.bst),l.left=F,l.right=M,C[f]=F,C.push(M)}for(C.sort((A,f)=>f.bst.N-A.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[w,C]}function S(h,u,p,j,w){if(h.left==null)return h.tdst=function(F,M,$,z,V){const W=M-F[0],R=$-F[1],Z=z-F[2],se=V-F[3];return W*W+R*R+Z*Z+se*se}(h.est.q,u,p,j,w),h;const C=B(h.est,u,p,j,w);let b=h.left,A=h.right;C>0&&(b=h.right,A=h.left);const f=S(b,u,p,j,w);if(f.tdst<=C*C)return f;const l=S(A,u,p,j,w);return l.tdst<f.tdst?l:f}function B(h,u,p,j,w){const{e:C}=h;return C[0]*u+C[1]*p+C[2]*j+C[3]*w-h.eMq}function O(h,u,p,j,w,C){for(j-=4;p<j;){for(;E(h,p,w)<=C;)p+=4;for(;E(h,j,w)>C;)j-=4;if(p>=j)break;const b=u[p>>2];u[p>>2]=u[j>>2],u[j>>2]=b,p+=4,j-=4}for(;E(h,p,w)>C;)p-=4;return p+4}function E(h,u,p){return h[u]*p[0]+h[u+1]*p[1]+h[u+2]*p[2]+h[u+3]*p[3]}function P(h,u,p){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=p-u>>2;for(let b=u;b<p;b+=4){const A=h[b]*.00392156862745098,f=h[b+1]*(1/255),l=h[b+2]*(1/255),N=h[b+3]*(1/255);w[0]+=A,w[1]+=f,w[2]+=l,w[3]+=N,j[0]+=A*A,j[1]+=A*f,j[2]+=A*l,j[3]+=A*N,j[5]+=f*f,j[6]+=f*l,j[7]+=f*N,j[10]+=l*l,j[11]+=l*N,j[15]+=N*N}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function y(h){const{R:u}=h,{m:p}=h,{N:j}=h,w=p[0],C=p[1],b=p[2],A=p[3],f=j==0?0:1/j,l=[u[0]-w*w*f,u[1]-w*C*f,u[2]-w*b*f,u[3]-w*A*f,u[4]-C*w*f,u[5]-C*C*f,u[6]-C*b*f,u[7]-C*A*f,u[8]-b*w*f,u[9]-b*C*f,u[10]-b*b*f,u[11]-b*A*f,u[12]-A*w*f,u[13]-A*C*f,u[14]-A*b*f,u[15]-A*A*f],N=l,F=_;let M=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,z=0;if(j!=0)for(let W=0;W<16&&(M=F.multVec(N,M),z=Math.sqrt(F.dot(M,M)),M=F.sml(1/z,M),!(W!=0&&Math.abs(z-$)<1e-9));W++)$=z;const V=[w*f,C*f,b*f,A*f];return{Cov:l,q:V,e:M,L:$,eMq255:F.dot(F.sml(255,V),M),eMq:F.dot(M,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var _={multVec:(h,u)=>[h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],h[4]*u[0]+h[5]*u[1]+h[6]*u[2]+h[7]*u[3],h[8]*u[0]+h[9]*u[1]+h[10]*u[2]+h[11]*u[3],h[12]*u[0]+h[13]*u[1]+h[14]*u[2]+h[15]*u[3]],dot:(h,u)=>h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],sml:(h,u)=>[h*u[0],h*u[1],h*u[2],h*u[3]]};Be.encode=function(u,p,j,w,C,b,A){w==null&&(w=0),A==null&&(A=!1);const f=n(u,p,j,w,[!1,!1,!1,0,A,!1]);return x(f,-1),v(f,p,j,C,b)},Be.encodeLL=function(u,p,j,w,C,b,A,f){const l={ctype:0+(w==1?0:2)+(C==0?0:4),depth:b,frames:[]},N=(w+C)*b,F=N*p;for(let M=0;M<u.length;M++)l.frames.push({rect:{x:0,y:0,width:p,height:j},img:new Uint8Array(u[M]),blend:0,dispose:1,bpp:Math.ceil(N/8),bpl:Math.ceil(F/8)});return x(l,0,!0),v(l,p,j,A,f)},Be.encode.compress=n,Be.encode.dither=d,Be.quantize=T,Be.quantize.getKDtree=k,Be.quantize.getNearest=S})();const Wn={toArrayBuffer(m,I){const D=m.width,o=m.height,e=D<<2,t=m.getContext("2d").getImageData(0,0,D,o),a=new Uint32Array(t.data.buffer),d=(32*D+31)/32<<2,v=d*o,x=122+v,n=new ArrayBuffer(x),r=new DataView(n),s=1<<20;let c,g,T,k,S=s,B=0,O=0,E=0;function P(h){r.setUint16(O,h,!0),O+=2}function y(h){r.setUint32(O,h,!0),O+=4}function _(h){O+=h}P(19778),y(x),_(4),y(122),y(108),y(D),y(-o>>>0),P(1),P(32),y(3),y(v),y(2835),y(2835),_(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),function h(){for(;B<o&&S>0;){for(k=122+B*d,c=0;c<e;)S--,g=a[E++],T=g>>>24,r.setUint32(k+c,g<<8|T),c+=4;B++}E<a.length?(S=s,setTimeout(h,Wn._dly)):I(n)}()},toBlob(m,I){this.toArrayBuffer(m,D=>{I(new Blob([D],{type:"image/bmp"}))})},_dly:9};var Re={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},$s={[Re.CHROME]:16384,[Re.FIREFOX]:11180,[Re.DESKTOP_SAFARI]:16384,[Re.IE]:8192,[Re.IOS]:4096,[Re.ETC]:8192};const mn=typeof window<"u",qn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ot=mn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Qs=(mn||qn)&&(Ot&&Ot.getOriginalSymbol(window,"File")||typeof File<"u"&&File),$n=(mn||qn)&&(Ot&&Ot.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function pn(m,I,D=Date.now()){return new Promise(o=>{const e=m.split(","),t=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let d=a.length;const v=new Uint8Array(d);for(;d--;)v[d]=a.charCodeAt(d);const x=new Blob([v],{type:t});x.name=I,x.lastModified=D,o(x)})}function Qn(m){return new Promise((I,D)=>{const o=new $n;o.onload=()=>I(o.result),o.onerror=e=>D(e),o.readAsDataURL(m)})}function Vn(m){return new Promise((I,D)=>{const o=new Image;o.onload=()=>I(o),o.onerror=e=>D(e),o.src=m})}function nt(){if(nt.cachedResult!==void 0)return nt.cachedResult;let m=Re.ETC;const{userAgent:I}=navigator;return/Chrom(e|ium)/i.test(I)?m=Re.CHROME:/iP(ad|od|hone)/i.test(I)&&/WebKit/i.test(I)?m=Re.IOS:/Safari/i.test(I)?m=Re.DESKTOP_SAFARI:/Firefox/i.test(I)?m=Re.FIREFOX:(/MSIE/i.test(I)||document.documentMode)&&(m=Re.IE),nt.cachedResult=m,nt.cachedResult}function Gn(m,I){const D=nt(),o=$s[D];let e=m,t=I,a=e*t;const d=e>t?t/e:e/t;for(;a>o*o;){const v=(o+e)/2,x=(o+t)/2;v<x?(t=x,e=x*d):(t=v*d,e=v),a=e*t}return{width:e,height:t}}function Pt(m,I){let D,o;try{if(D=new OffscreenCanvas(m,I),o=D.getContext("2d"),o===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{D=document.createElement("canvas"),o=D.getContext("2d")}return D.width=m,D.height=I,[D,o]}function Yn(m,I){const{width:D,height:o}=Gn(m.width,m.height),[e,t]=Pt(D,o);return I&&/jpe?g/.test(I)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(m,0,0,e.width,e.height),e}function Dt(){return Dt.cachedResult!==void 0||(Dt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Dt.cachedResult}function Nt(m,I={}){return new Promise(function(D,o){let e,t;var a=function(){try{return t=Yn(e,I.fileType||m.type),D([e,t])}catch(v){return o(v)}},d=function(v){try{var x=function(n){try{throw n}catch(r){return o(r)}};try{let n;return Qn(m).then(function(r){try{return n=r,Vn(n).then(function(s){try{return e=s,function(){try{return a()}catch(c){return o(c)}}()}catch(c){return x(c)}},x)}catch(s){return x(s)}},x)}catch(n){x(n)}}catch(n){return o(n)}};try{if(Dt()||[Re.DESKTOP_SAFARI,Re.MOBILE_SAFARI].includes(nt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(m).then(function(v){try{return e=v,a()}catch{return d()}},d)}catch{d()}})}function Bt(m,I,D,o,e=1){return new Promise(function(t,a){let d;if(I==="image/png"){let x,n,r;return x=m.getContext("2d"),{data:n}=x.getImageData(0,0,m.width,m.height),r=Be.encode([n.buffer],m.width,m.height,4096*e),d=new Blob([r],{type:I}),d.name=D,d.lastModified=o,v.call(this)}{let x=function(){return v.call(this)};if(I==="image/bmp")return new Promise(n=>Wn.toBlob(m,n)).then((function(n){try{return d=n,d.name=D,d.lastModified=o,x.call(this)}catch(r){return a(r)}}).bind(this),a);{let n=function(){return x.call(this)};if(typeof OffscreenCanvas=="function"&&m instanceof OffscreenCanvas)return m.convertToBlob({type:I,quality:e}).then((function(r){try{return d=r,d.name=D,d.lastModified=o,n.call(this)}catch(s){return a(s)}}).bind(this),a);{let r;return r=m.toDataURL(I,e),pn(r,D,o).then((function(s){try{return d=s,n.call(this)}catch(c){return a(c)}}).bind(this),a)}}}function v(){return t(d)}})}function We(m){m.width=0,m.height=0}function ut(){return new Promise(function(m,I){let D,o,e,t;return ut.cachedResult!==void 0?m(ut.cachedResult):pn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return D=a,Nt(D).then(function(d){try{return o=d[1],Bt(o,D.type,D.name,D.lastModified).then(function(v){try{return e=v,We(o),Nt(e).then(function(x){try{return t=x[0],ut.cachedResult=t.width===1&&t.height===2,m(ut.cachedResult)}catch(n){return I(n)}},I)}catch(x){return I(x)}},I)}catch(v){return I(v)}},I)}catch(d){return I(d)}},I)})}function Zn(m){return new Promise((I,D)=>{const o=new $n;o.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return I(-2);const a=t.byteLength;let d=2;for(;d<a;){if(t.getUint16(d+2,!1)<=8)return I(-1);const v=t.getUint16(d,!1);if(d+=2,v==65505){if(t.getUint32(d+=2,!1)!=1165519206)return I(-1);const x=t.getUint16(d+=6,!1)==18761;d+=t.getUint32(d+4,x);const n=t.getUint16(d,x);d+=2;for(let r=0;r<n;r++)if(t.getUint16(d+12*r,x)==274)return I(t.getUint16(d+12*r+8,x))}else{if((65280&v)!=65280)break;d+=t.getUint16(d,!1)}}return I(-1)},o.onerror=e=>D(e),o.readAsArrayBuffer(m)})}function Kn(m,I){const{width:D}=m,{height:o}=m,{maxWidthOrHeight:e}=I;let t,a=m;return isFinite(e)&&(D>e||o>e)&&([a,t]=Pt(D,o),D>o?(a.width=e,a.height=o/D*e):(a.width=D/o*e,a.height=e),t.drawImage(m,0,0,a.width,a.height),We(m)),a}function Xn(m,I){const{width:D}=m,{height:o}=m,[e,t]=Pt(D,o);switch(I>4&&I<9?(e.width=o,e.height=D):(e.width=D,e.height=o),I){case 2:t.transform(-1,0,0,1,D,0);break;case 3:t.transform(-1,0,0,-1,D,o);break;case 4:t.transform(1,0,0,-1,0,o);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,o,0);break;case 7:t.transform(0,-1,-1,0,o,D);break;case 8:t.transform(0,-1,1,0,0,D)}return t.drawImage(m,0,0,D,o),We(m),e}function Cn(m,I,D=0){return new Promise(function(o,e){let t,a,d,v,x,n,r,s,c,g,T,k,S,B,O,E,P,y,_,h;function u(j=5){if(I.signal&&I.signal.aborted)throw I.signal.reason;t+=j,I.onProgress(Math.min(t,100))}function p(j){if(I.signal&&I.signal.aborted)throw I.signal.reason;t=Math.min(Math.max(j,t),100),I.onProgress(t)}return t=D,a=I.maxIteration||10,d=1024*I.maxSizeMB*1024,u(),Nt(m,I).then((function(j){try{return[,v]=j,u(),x=Kn(v,I),u(),new Promise(function(w,C){var b;if(!(b=I.exifOrientation))return Zn(m).then((function(f){try{return b=f,A.call(this)}catch(l){return C(l)}}).bind(this),C);function A(){return w(b)}return A.call(this)}).then((function(w){try{return n=w,u(),ut().then((function(C){try{return r=C?x:Xn(x,n),u(),s=I.initialQuality||1,c=I.fileType||m.type,Bt(r,c,m.name,m.lastModified,s).then((function(b){try{{let f=function(){if(a--&&(O>d||O>S)){let N,F;return N=h?.95*_.width:_.width,F=h?.95*_.height:_.height,[P,y]=Pt(N,F),y.drawImage(_,0,0,N,F),s*=c==="image/png"?.85:.95,Bt(P,c,m.name,m.lastModified,s).then(function(M){try{return E=M,We(_),_=P,O=E.size,p(Math.min(99,Math.floor((B-O)/(B-d)*100))),f}catch($){return e($)}},e)}return[1]},l=function(){return We(_),We(P),We(x),We(r),We(v),p(100),o(E)};if(g=b,u(),T=g.size>d,k=g.size>m.size,!T&&!k)return p(100),o(g);var A;return S=m.size,B=g.size,O=B,_=r,h=!I.alwaysKeepResolution&&T,(A=(function(N){for(;N;){if(N.then)return void N.then(A,e);try{if(N.pop){if(N.length)return N.pop()?l.call(this):N;N=f}else N=N.call(this)}catch(F){return e(F)}}}).bind(this))(f)}}catch(f){return e(f)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const Vs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Yt;function Gs(m,I){return new Promise((D,o)=>{Yt||(Yt=function(a){const d=[];return d.push(a),URL.createObjectURL(new Blob(d))}(Vs));const e=new Worker(Yt);e.addEventListener("message",function(a){if(I.signal&&I.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return o(new Error(a.data.error)),void e.terminate();D(a.data.file),e.terminate()}else I.onProgress(a.data.progress)}),e.addEventListener("error",o),I.signal&&I.signal.addEventListener("abort",()=>{o(I.signal.reason),e.terminate()}),e.postMessage({file:m,imageCompressionLibUrl:I.libURL,options:{...I,onProgress:void 0,signal:void 0}})})}function Ae(m,I){return new Promise(function(D,o){let e,t,a,d,v,x;if(e={...I},a=0,{onProgress:d}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,v=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{a=c,typeof d=="function"&&d(a)},!(m instanceof Blob||m instanceof Qs))return o(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(m.type))return o(new Error("The file given is not an image"));if(x=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!v||typeof Worker!="function"||x)return Cn(m,e).then((function(c){try{return t=c,s.call(this)}catch(g){return o(g)}}).bind(this),o);var n=(function(){try{return s.call(this)}catch(c){return o(c)}}).bind(this),r=function(c){try{return Cn(m,e).then(function(g){try{return t=g,n()}catch(T){return o(T)}},o)}catch(g){return o(g)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Gs(m,e).then(function(c){try{return t=c,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=m.name,t.lastModified=m.lastModified}catch{}try{e.preserveExif&&m.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===m.type)&&(t=zn(m,t))}catch{}return D(t)}})}Ae.getDataUrlFromFile=Qn,Ae.getFilefromDataUrl=pn,Ae.loadImage=Vn,Ae.drawImageInCanvas=Yn,Ae.drawFileInCanvas=Nt,Ae.canvasToFile=Bt,Ae.getExifOrientation=Zn,Ae.handleMaxWidthOrHeight=Kn,Ae.followExifOrientation=Xn,Ae.cleanupCanvasMemory=We,Ae.isAutoOrientationInBrowser=ut,Ae.approximateBelowMaximumCanvasSizeOfBrowser=Gn,Ae.copyExifWithoutOrientation=zn,Ae.getBrowserName=nt,Ae.version="2.0.2";var Zt,Sn;function Jn(){if(Sn)return Zt;Sn=1;function m(I){var D=typeof I;return I!=null&&(D=="object"||D=="function")}return Zt=m,Zt}var Kt,An;function Ys(){if(An)return Kt;An=1;var m=typeof Ut=="object"&&Ut&&Ut.Object===Object&&Ut;return Kt=m,Kt}var Xt,Tn;function es(){if(Tn)return Xt;Tn=1;var m=Ys(),I=typeof self=="object"&&self&&self.Object===Object&&self,D=m||I||Function("return this")();return Xt=D,Xt}var Jt,In;function Zs(){if(In)return Jt;In=1;var m=es(),I=function(){return m.Date.now()};return Jt=I,Jt}var en,Fn;function Ks(){if(Fn)return en;Fn=1;var m=/\s/;function I(D){for(var o=D.length;o--&&m.test(D.charAt(o)););return o}return en=I,en}var tn,Un;function Xs(){if(Un)return tn;Un=1;var m=Ks(),I=/^\s+/;function D(o){return o&&o.slice(0,m(o)+1).replace(I,"")}return tn=D,tn}var nn,kn;function ts(){if(kn)return nn;kn=1;var m=es(),I=m.Symbol;return nn=I,nn}var sn,Dn;function Js(){if(Dn)return sn;Dn=1;var m=ts(),I=Object.prototype,D=I.hasOwnProperty,o=I.toString,e=m?m.toStringTag:void 0;function t(a){var d=D.call(a,e),v=a[e];try{a[e]=void 0;var x=!0}catch{}var n=o.call(a);return x&&(d?a[e]=v:delete a[e]),n}return sn=t,sn}var rn,En;function er(){if(En)return rn;En=1;var m=Object.prototype,I=m.toString;function D(o){return I.call(o)}return rn=D,rn}var an,Rn;function tr(){if(Rn)return an;Rn=1;var m=ts(),I=Js(),D=er(),o="[object Null]",e="[object Undefined]",t=m?m.toStringTag:void 0;function a(d){return d==null?d===void 0?e:o:t&&t in Object(d)?I(d):D(d)}return an=a,an}var on,_n;function nr(){if(_n)return on;_n=1;function m(I){return I!=null&&typeof I=="object"}return on=m,on}var ln,Mn;function sr(){if(Mn)return ln;Mn=1;var m=tr(),I=nr(),D="[object Symbol]";function o(e){return typeof e=="symbol"||I(e)&&m(e)==D}return ln=o,ln}var dn,On;function rr(){if(On)return dn;On=1;var m=Xs(),I=Jn(),D=sr(),o=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,a=/^0o[0-7]+$/i,d=parseInt;function v(x){if(typeof x=="number")return x;if(D(x))return o;if(I(x)){var n=typeof x.valueOf=="function"?x.valueOf():x;x=I(n)?n+"":n}if(typeof x!="string")return x===0?x:+x;x=m(x);var r=t.test(x);return r||a.test(x)?d(x.slice(2),r?2:8):e.test(x)?o:+x}return dn=v,dn}var cn,Nn;function ir(){if(Nn)return cn;Nn=1;var m=Jn(),I=Zs(),D=rr(),o="Expected a function",e=Math.max,t=Math.min;function a(d,v,x){var n,r,s,c,g,T,k=0,S=!1,B=!1,O=!0;if(typeof d!="function")throw new TypeError(o);v=D(v)||0,m(x)&&(S=!!x.leading,B="maxWait"in x,s=B?e(D(x.maxWait)||0,v):s,O="trailing"in x?!!x.trailing:O);function E(C){var b=n,A=r;return n=r=void 0,k=C,c=d.apply(A,b),c}function P(C){return k=C,g=setTimeout(h,v),S?E(C):c}function y(C){var b=C-T,A=C-k,f=v-b;return B?t(f,s-A):f}function _(C){var b=C-T,A=C-k;return T===void 0||b>=v||b<0||B&&A>=s}function h(){var C=I();if(_(C))return u(C);g=setTimeout(h,y(C))}function u(C){return g=void 0,O&&n?E(C):(n=r=void 0,c)}function p(){g!==void 0&&clearTimeout(g),k=0,n=T=r=g=void 0}function j(){return g===void 0?c:u(I())}function w(){var C=I(),b=_(C);if(n=arguments,r=this,T=C,b){if(g===void 0)return P(T);if(B)return clearTimeout(g),g=setTimeout(h,v),E(T)}return g===void 0&&(g=setTimeout(h,v)),c}return w.cancel=p,w.flush=j,w}return cn=a,cn}var ar=ir();const or=Us(ar),lr=Xe([i.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),i.jsx("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),dr=Xe(i.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),cr=Xe(i.jsx("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),ur=Xe(i.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),fr=Xe([i.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),i.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),st=H.forwardRef(({path:m,initialImages:I=[],onImagesUpdated:D,onDelete:o,isOwnDesign:e},t)=>{const[a,d]=H.useState(I.map(l=>({...l,deleted:!1}))),[v,x]=H.useState(!1),[n,r]=H.useState(0),[s,c]=H.useState(!1),[g,T]=H.useState(null),[k,S]=H.useState(1),[B,O]=H.useState(!1),[E,P]=H.useState(!1),[y,_]=H.useState(""),[h,u]=H.useState("info"),p=H.useRef(null);H.useEffect(()=>{console.log("Initial images received:",I),d(I.map(l=>({...l,deleted:!!l.deleted})))},[I]);const j=async l=>{const N=Array.from(l.target.files||[]);x(!0);const F={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},M=N.map(async($,z)=>{let V=$;$.size>1024*1024&&(V=await Ae($,F),_("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),P(!0));const R=`${new Date().getTime()}-${V.name}`,Z=ft(),se=ht(Z,`${m}/${R}`),te=Pn(se,V);return new Promise((X,ie)=>{te.on("state_changed",ee=>{const ce=ee.bytesTransferred/ee.totalBytes*100;r(ce)},ee=>{console.error("Upload failed:",ee),ie(ee)},()=>{Ln(te.snapshot.ref).then(ee=>{X({url:ee,path:se.fullPath,title:""})})})})});Promise.all(M).then($=>{const z=[...a,...$];d(z),D&&D(z),_("Images uploaded successfully."),u("success"),P(!0),x(!1),r(0),p.current&&(p.current.value="")}).catch($=>{console.error("Error uploading images: ",$),_("Failed to upload images."),u("error"),P(!0),x(!1),r(0)})},w=l=>{d(N=>{const F=N.map((M,$)=>$===l?{...M,deleted:!0}:M);return D(F),F}),_("Image marked for deletion. Update to permanently delete."),u("info"),P(!0)},C=async()=>{const l=a.filter(N=>N.deleted);if(console.log("Attempting to delete images:",l),l.length>0){const N=l.map(F=>{const M=ft(),$=ht(M,F.path);return kt($)});try{await Promise.all(N),o(l),d(F=>F.filter(M=>!M.deleted)),_("Deleted images have been permanently removed."),u("success")}catch(F){console.error("Error committing deletions:",F),_("Failed to commit deletions."),u("error")}P(!0)}else console.log("No images marked for deletion.")},b=l=>{O(!B),T(l)};H.useEffect(()=>{const l=()=>{const N=!!document.fullscreenElement;O(N)};return document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[]);const A=(l,N)=>{N!=="clickaway"&&P(!1)},f=H.useCallback(or((l,N)=>{setTimeout(()=>{d(F=>{const M=F.map(($,z)=>z===l?{...$,title:N}:$);return D&&D(M),M})},0)},30),[D]);return H.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Et,{title:"Upload Images",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(fr,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:v,ref:p,accept:"image/*"})]})}),v&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),a.filter(l=>!l.deleted).map((l,N)=>i.jsxs("div",{children:[i.jsx("img",{src:l.url,alt:`Uploaded design ${N}`,onClick:()=>{c(!0),T(N)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Me,{onClick:()=>w(N),children:i.jsx(wt,{})}),i.jsx("textarea",{value:l.title,onChange:F=>f(N,F.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},N)),i.jsx(rt,{open:s,onClose:()=>c(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:g!==null&&i.jsxs(it,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:a[g].url,alt:`Zoomed Design ${g}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Me,{onClick:()=>S(k*1.2),children:i.jsx(lr,{})}),i.jsx(Me,{onClick:()=>S(k/1.2),style:{marginLeft:"10px"},children:i.jsx(dr,{})}),i.jsx(Me,{onClick:()=>b(g),style:{marginLeft:"10px"},children:i.jsx(cr,{})}),B&&i.jsx(Me,{onClick:()=>b(g),style:{position:"absolute",top:20,right:20},children:i.jsx(ur,{})})]})]})}),i.jsx(at,{open:E,autoHideDuration:6e3,onClose:A,children:i.jsx(ot,{onClose:A,severity:h,sx:{width:"100%"},children:y})})]})});st.displayName="ImageUpload";const qe=({onChange:m,initialValue:I})=>{const[D,o]=H.useState(Gt.sanitize(I||"")),e=H.useRef(!1),t=H.useRef(null),[a,d]=H.useState("");H.useEffect(()=>{e.current?o(Gt.sanitize(I||"")):e.current=!0},[I]);const v=(c,g)=>{const T=g.getData(),k=Gt.sanitize(T);o(k),m(k)},x=c=>{if(!t.current){console.warn("Editor not initialized");return}const g=t.current;g.model.change(T=>{const k=g.model.document.selection.getFirstPosition();T.insertText(c,k)}),d("")},n=c=>{x(c.target.value)},r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],s=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return i.jsxs("div",{children:[i.jsxs(tt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[i.jsx(ks,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(wn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Rt,{labelId:"math-operators-label",id:"math-operators",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(ct,{value:"",disabled:!0,children:"Math"}),s.map(c=>i.jsx(ct,{value:c,children:c},c))]})}),i.jsx(wn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Rt,{labelId:"greek-letters-label",id:"greek-letters",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(ct,{value:"",disabled:!0,children:"Greek"}),r.map(c=>i.jsx(ct,{value:c,children:c},c))]})})]}),i.jsx(Ds.CKEditor,{editor:Es,data:D,onReady:c=>{t.current=c},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"]},onChange:v})]})},hr=Xe(i.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),gr=Xe(i.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),mt=({path:m,initialFiles:I,onFilesChange:D,isOwnDesign:o})=>{const[e,t]=H.useState(I.map(p=>({...p,deleted:!!p.deleted}))),[a,d]=H.useState(!1),[v,x]=H.useState(0),[n,r]=H.useState({}),[s,c]=H.useState(!1),[g,T]=H.useState(""),[k,S]=H.useState("info"),B=H.useRef(null);H.useEffect(()=>{console.log("Initial files received:",I),t(I.map(p=>({...p,deleted:!!p.deleted})))},[I]),H.useEffect(()=>()=>{r({})},[]);const O=p=>{console.log("Updating files with",p),D(p),t(p)},E=async p=>{if(!p.target.files)return;const w=Array.from(p.target.files).filter(b=>b.size>5242880?(T("File size should not exceed 5 MB"),S("error"),c(!0),!1):!0);d(!0);const C=w.map(b=>{const A=new Date().getTime(),f=`${A}-${b.name}`,l=ft(),N=ht(l,`${m}/${f}`),F=Pn(N,b);return new Promise((M,$)=>{F.on("state_changed",z=>{const V=z.bytesTransferred/z.totalBytes*100;x(V)},z=>{console.error("Upload failed:",z),$(z)},()=>{Ln(F.snapshot.ref).then(z=>{M({id:A.toString(),url:z,name:b.name,path:N.fullPath})})})})});Promise.all(C).then(b=>{const A=[...e.filter(f=>!f.deleted),...b];O(A),T("Files uploaded successfully."),S("success"),c(!0),d(!1),x(0),B.current&&(B.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),T("Failed to upload files."),S("error"),c(!0),d(!1),x(0)})},P=p=>{const j=e.map(w=>w.id===p?{...w,deleted:!0}:w);O(j),T("File marked for deletion. Update to permanently delete."),S("info"),c(!0)},y=p=>{r(j=>{var w;return{...j,[p]:((w=e.find(C=>C.id===p))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},_=p=>{t(j=>{const w=j.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return D(w),w}),r(j=>{const w={...j};return delete w[p],w}),T("File name updated successfully."),S("info"),c(!0)},h=(p,j)=>{r(w=>({...w,[p]:j}))},u=(p,j)=>{j!=="clickaway"&&c(!1)};return i.jsxs("div",{children:[o&&i.jsx(Et,{title:"Upload Files",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(gr,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:E,disabled:a,ref:B})]})}),a&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(v),"%"]})}),i.jsx(Rs,{children:e.map(p=>i.jsxs(_s,{style:{opacity:p.deleted?.5:1},children:[i.jsx(Ls,{children:i.jsx(hr,{})}),typeof n[p.id]=="string"?i.jsx(_t,{variant:"outlined",size:"small",value:n[p.id],onChange:j=>h(p.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&_(p.id),fullWidth:!0}):i.jsx(Ms,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),o&&(typeof n[p.id]=="string"?i.jsx(Me,{onClick:()=>_(p.id),edge:"end","aria-label":"save",children:i.jsx(fn,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Me,{onClick:()=>y(p.id),edge:"end","aria-label":"edit",children:i.jsx(Bn,{})}),i.jsx(Me,{onClick:()=>P(p.id),edge:"end","aria-label":"delete",children:i.jsx(wt,{})})]}))]},p.id))}),i.jsx(at,{open:s,autoHideDuration:6e3,onClose:u,children:i.jsx(ot,{onClose:u,severity:k,sx:{width:"100%"},children:g})})]})},mr=({designs:m,setDesigns:I,setIsAdding:D,getDesigns:o,onReturnToDashboard:e})=>{const{userDetails:t}=St();console.log("Add Design loaded");const[a,d]=H.useState(""),[v,x]=H.useState(""),[n,r]=H.useState(""),[s,c]=H.useState([]),[g,T]=H.useState([]),k=H.useMemo(()=>s,[s]),[S,B]=H.useState(!1),[O,E]=H.useState(""),[P,y]=H.useState("info"),[_,h]=H.useState(!1),[u,p]=H.useState("");console.log("Adding New Design from user:",t);const j=H.useRef(null),w=()=>{h(!1)},C=(A,f)=>{f!=="clickaway"&&B(!1)};H.useEffect(()=>{if(t!=null&&t.classes){const A=Object.keys(t.classes)[0];x(A||"")}},[t==null?void 0:t.classes]);const b=async A=>{var F;if(A.preventDefault(),console.log("Files to be saved:",g),!t||!t.uid){console.error("User object is undefined or missing UID."),p("You must be signed in to add a design."),h(!0);return}if(!a){p("All fields are required."),h(!0);return}await((F=j.current)==null?void 0:F.commitDeletions());const f=s.filter(M=>!M.deleted),l=g.filter(M=>!M.deleted).map(M=>({id:M.id,url:M.url,name:M.name,path:M.path})),N={title:n,description:a,course:v,dateCreated:Ct(),dateModified:Ct(),images:f,files:l,userId:t.uid};try{const M=await gn(Ce(J,"designs"),N),$={...N,id:M.id};I([...m,$]),E(`${n} has been Added.`),y("success"),B(!0),r(""),d(""),c([]),T([]),setTimeout(()=>{D(!1),o()},1e3)}catch(M){console.log(M),p("There was an issue adding your design."),h(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:e,className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:b,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsx("div",{style:{display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:A=>r(A.target.value),style:{width:"100%"}})]})}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Rt,{id:"course",value:v,onChange:A=>x(A.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([A,f])=>i.jsx(ct,{value:A,children:`${f.number} - ${f.title}`},A))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(qe,{onChange:d,initialValue:a}),i.jsx(st,{ref:j,path:"designs/images",initialImages:k,onImagesUpdated:c,onDelete:A=>c(s.filter(f=>!A.includes(f))),isOwnDesign:!0}),i.jsx(mt,{path:"designs/files",initialFiles:g,onFilesChange:T,isOwnDesign:!0}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(Se,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(Se,{onClick:()=>D(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(rt,{open:_,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(pt,{id:"alert-dialog-title",children:"Notification"}),i.jsx(it,{children:i.jsx(At,{id:"alert-dialog-description",children:u})}),i.jsx(bt,{children:i.jsx(Se,{onClick:w,autoFocus:!0,children:"Ok"})})]}),i.jsx(at,{open:S,autoHideDuration:1e3,onClose:C,children:i.jsx(ot,{onClose:C,severity:P,sx:{width:"100%"},children:O})})]})},pr=({designId:m,setIsAddingBuild:I,refreshBuilds:D})=>{const[o,e]=H.useState(""),[t,a]=H.useState(""),[d,v]=H.useState([]),[x,n]=H.useState([]),{userDetails:r}=St(),s=j=>{v(j)},c=j=>{n(j)};console.log("AddBuild loaded");const[g,T]=H.useState(!1),[k,S]=H.useState(""),[B,O]=H.useState(!1),[E,P]=H.useState(""),[y,_]=H.useState("info");console.log("Adding New Build by user:",r);const h=()=>{T(!1)},u=(j,w)=>{w!=="clickaway"&&O(!1)},p=async j=>{if(j.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),T(!0);return}if(!t){S("Build description is required."),T(!0);return}const w=d.filter(b=>!b.deleted),C=x.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await gn(Ce(J,"builds"),{title:o,description:t,design_ID:m,dateCreated:Ct(),userId:r.uid,images:w,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",r),P("Your build has been successfully added."),_("success"),O(!0),setTimeout(()=>{e(""),a(""),v([]),n([]),I(!1),D()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let A=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(A="You do not have permission to perform this operation."),P(A),_("error"),O(!0)}else P("Failed to add the build. Please try again later."),_("error"),O(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:o,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(qe,{onChange:a,initialValue:t})," ",i.jsx(st,{path:`builds/${m}/images`,initialImages:d,onImagesUpdated:s,onDelete:j=>v(w=>w.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(mt,{path:`builds/${m}/files`,initialFiles:x,onFilesChange:c,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>I(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(rt,{open:g,onClose:h,children:[i.jsx(pt,{children:"Notification"}),i.jsx(it,{children:i.jsx(At,{children:k})}),i.jsx(bt,{children:i.jsx(Se,{onClick:h,children:"OK"})})]}),i.jsx(at,{open:B,autoHideDuration:6e3,onClose:u,children:i.jsx(ot,{onClose:u,severity:y,sx:{width:"100%"},children:E})})]})},br=({designId:m,buildId:I,refreshTests:D,setAddingTestIdForBuild:o})=>{const[e,t]=H.useState(""),[a,d]=H.useState(""),[v,x]=H.useState(""),[n,r]=H.useState(""),[s,c]=H.useState([]),[g,T]=H.useState([]),{userDetails:k}=St();console.log("AddTest loaded");const[S,B]=H.useState(!1),[O,E]=H.useState(""),[P,y]=H.useState(!1),[_,h]=H.useState(""),[u,p]=H.useState("info"),j=C=>{T(C)},w=async()=>{if(!a){E("Test description cannot be empty!"),B(!0);return}const C=s.filter(A=>!A.deleted),b=g.filter(A=>!A.deleted).map(A=>({id:A.id,url:A.url,name:A.name,path:A.path}));try{await gn(Ce(J,"tests"),{title:e,build_ID:I,design_ID:m,dateCreated:Ct(),description:a,results:v,conclusions:n,userId:k==null?void 0:k.uid,images:C,files:b}),setTimeout(()=>{D(I),t(""),d(""),x(""),r(""),c([]),T([]),o(!1)},1e3),h("Test added successfully"),p("success"),y(!0)}catch(A){console.error("Error adding test: ",A),h("Failed to add the test"),p("error"),y(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(qe,{onChange:d,initialValue:a}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(qe,{onChange:x,initialValue:v}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(qe,{onChange:r,initialValue:n}),i.jsx(st,{path:`tests/${I}/images`,initialImages:s,onImagesUpdated:C=>{c(C)},onDelete:C=>c(b=>b.filter(A=>!C.includes(A))),isOwnDesign:!0}),i.jsx(mt,{path:`tests/${I}/files`,initialFiles:g,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>o(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(rt,{open:S,onClose:()=>B(!1),children:[i.jsx(pt,{children:"Notification"}),i.jsx(it,{children:i.jsx(At,{children:O})}),i.jsx(bt,{children:i.jsx(Se,{onClick:()=>B(!1),children:"OK"})})]}),i.jsx(at,{open:P,autoHideDuration:6e3,onClose:()=>y(!1),children:i.jsx(ot,{onClose:()=>y(!1),severity:u,sx:{width:"100%"},children:_})})]})},un=Xe(i.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),jt=m=>m&&m instanceof hn?m.toDate().toLocaleString():"",xr=({selectedDesign:m,setIsEditing:I,onReturnToDashboard:D})=>{const{userDetails:o,loading:e}=St(),t=m.id,a=m.userId===(o==null?void 0:o.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",o);const[d,v]=H.useState(""),[x,n]=H.useState(m.description),[r,s]=H.useState(m.course||""),[c,g]=H.useState(jt(m.dateCreated)),[T,k]=H.useState(jt(m.dateModified)),[S,B]=H.useState([]),[O,E]=H.useState([]),P=H.useRef(null),[y,_]=H.useState(!1),[h,u]=H.useState([]),[p,j]=H.useState({}),[w,C]=H.useState({}),[b,A]=H.useState({}),f=H.useRef(null),[l,N]=H.useState({}),[F,M]=H.useState({}),[$,z]=H.useState({}),[V,W]=H.useState(!1),[R,Z]=H.useState({}),[se,te]=H.useState({}),[X,ie]=H.useState({}),[ee,ce]=H.useState({}),[_e,Te]=H.useState({}),ue=H.useRef(null),[pe,fe]=H.useState({}),[ae,ge]=H.useState({}),[be,he]=H.useState({}),[Ie,oe]=H.useState(!1),[de,xe]=H.useState(""),[Le,Ge]=H.useState(()=>()=>{}),[ve,le]=H.useState(!1),[we,ne]=H.useState(""),[De,re]=H.useState("info"),[Fe,ye]=H.useState({design:!1,builds:!1,tests:!1}),xt=async U=>{if(U.preventDefault(),!x){xe("All fields are required."),oe(!0);return}console.log("About to check image deletions",P.current),console.log(P.current),console.log(S.some(Q=>Q.deleted)),P.current&&S.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await P.current.commitDeletions());const q=S.filter(Q=>!Q.deleted);O.some(Q=>Q.deleted)&&await Tt();const L=O.filter(Q=>!Q.deleted),Y={title:d,description:x,course:r,dateModified:Ct(),images:q.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:L.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:o.uid};try{await Ze(je(J,"designs",t),Y,{merge:!0}),ne("Your design has been updated."),re("success"),le(!0);const Q=hn.now();k(jt(Q))}catch(Q){console.error("Error updating design:",Q),ne("There was an issue updating your design."),re("error"),le(!0)}ye(Q=>({...Q,design:!1}))};H.useEffect(()=>{m&&(n(m.description||""),v(m.title||""),s(m.course||""),(async()=>{const q=je(J,"designs",t),L=await Os(q);if(L.exists()){const Y=L.data();console.log("Fetched images:",Y.images),console.log("Fetched files:",Y.files),B(Y.images||[]),E(Y.files||[]),g(jt(Y.dateCreated)),k(jt(Y.dateModified))}})())},[m,t]);const Lt=U=>{const q=S.filter(Y=>!U.some(Q=>Q.path===Y.path));console.log("Remaining images after deletion:",q),B(q);const L=q.map(Y=>({url:Y.url,title:Y.title,path:Y.path}));Ze(je(J,"designs",t),{images:L},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Y=>console.error("Failed to update Firestore:",Y))},vt=U=>{JSON.stringify(S)!==JSON.stringify(U)&&(B(U),console.log("Updated images received:",U))},Tt=async()=>{const U=O.filter(q=>q.deleted);if(console.log("Files to delete:",U),U.length>0){const q=ft(),L=U.map(Y=>{const Q=ht(q,Y.path);return kt(Q)});try{await Promise.all(L),console.log("Files deleted successfully");const Y=O.filter(Q=>!Q.deleted);E(Y),await Vt(je(J,"designs",m.id),{files:Y.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),ne("Deleted files have been permanently removed."),re("success"),le(!0)}catch(Y){console.error("Failed to delete files: ",Y),ne("Failed to delete files."),re("error"),le(!0)}}},Je=async U=>{var Q,K;try{await ns(U)}catch(G){console.error("Error deleting files:",G),ne("Failed to delete build files."),re("error"),le(!0)}const q=((Q=w[U])==null?void 0:Q.filter(G=>!G.deleted).map(({url:G,path:Ue,title:Qe})=>({url:G,path:Ue,title:Qe})))||[],L=((K=b[U])==null?void 0:K.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[],Y={};q.length>0&&(Y.images=q),L.length>0&&(Y.files=L),p[U]!==void 0&&(Y.description=p[U]);try{const G=je(J,"builds",U);await Ze(G,Y,{merge:!0}),ne("Your build has been updated."),re("success"),le(!0),Ne(),ye(Ue=>({...Ue,builds:!1}))}catch(G){console.error("Error updating build:",G),ne("Failed to update build."),re("error"),le(!0)}},Ht=(U,q)=>{M(L=>({...L,[U]:q}))},He=(U,q)=>{j(L=>({...L,[U]:q})),ye(L=>({...L,builds:!0}))},Oe=async U=>{const q=F[U];try{const L=je(J,"builds",U);await Ze(L,{title:q},{merge:!0}),M(Y=>{const Q={...Y};return delete Q[U],Q}),Ne()}catch(L){console.error("Failed to save build title:",L)}},Ne=async()=>{if(!o){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",o==null?void 0:o.uid),console.log("Selected design ID for query:",m==null?void 0:m.id);let U;o.isAdmin?U=Ee(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):U=Ee(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",o.uid),Pe("dateCreated")),console.log("Builds query details:",JSON.stringify(U,null,2));const q=await Ke(U);console.log("Builds snapshot details:",JSON.stringify(q.docs.map(Y=>Y.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",q.docs.length);const L=q.docs.map(Y=>(console.log("Build doc path: ",Y.ref.path),{id:Y.id,...Y.data()}));u(L),console.log("New builds state after refresh:",L)}catch(U){console.error("Error refreshing builds:",U),U.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",U):console.error("An unexpected error occurred when trying to refresh builds:",U)}},et=(U,q)=>{const L=je(J,"builds",U),Y=w[U].filter(K=>!q.some(G=>G.path===K.path));C(K=>({...K,[U]:Y}));const Q=Y.map(K=>({url:K.url,title:K.title,path:K.path}));Ze(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ne("Build Image deletions updated."),re("success")}).catch(K=>{console.error("Failed to update build images in Firestore:",K),ne("Failed to update build image deletions."),re("error")}),le(!0)},It=async U=>{const q=Ee(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",o.uid)),L=await Ke(q);for(const Y of L.docs)await gt(je(J,"tests",Y.id));await gt(je(J,"builds",U)),await Ne(),ne("Build and its tests (if any) deleted successfully."),re("success"),le(!0)},$e=U=>{xe("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ge(()=>()=>It(U)),oe(!0)},ze=(U,q)=>{C(L=>({...L,[U]:q}))},bn=(U,q)=>{A(L=>({...L,[U]:q}))},ns=async U=>{var L;const q=((L=b[U])==null?void 0:L.filter(Y=>Y.deleted))||[];if(console.log("Build files to delete:",q),q.length>0){const Y=ft(),Q=q.map(K=>{const G=ht(Y,K.path);return kt(G)});try{await Promise.all(Q),console.log("Build files deleted successfully");const K=b[U].filter(G=>!G.deleted);A(G=>({...G,[U]:K})),await Vt(je(J,"builds",U),{files:K.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),console.log("Firestore successfully updated to remove deleted files"),ne("Deleted build files have been permanently removed."),re("success"),le(!0)}catch(K){console.error("Failed to delete build files: ",K),ne("Failed to delete build files."),re("error"),le(!0)}}},ss=async(U,q)=>{var K;try{await ds(U)}catch(G){console.error("Error deleting files:",G),ne("Failed to delete build files."),re("error"),le(!0)}const L={},Y=ee[U].filter(G=>!G.deleted).map(({url:G,path:Ue,title:Qe})=>({url:G,path:Ue,title:Qe})),Q=((K=_e[U])==null?void 0:K.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[];R[U]!==void 0&&(L.description=R[U]),se[U]!==void 0&&(L.results=se[U]),X[U]!==void 0&&(L.conclusions=X[U]),L.images=Y,L.files=Q;try{const G=je(J,"tests",U);await Ze(G,L,{merge:!0}),ne("Your test has been updated."),re("success"),le(!0),Ft(q)}catch(G){console.error(`Error updating test ID: ${U}:`,G),ne("There was an issue updating your test."),re("error"),le(!0)}},rs=(U,q)=>{ge(L=>({...L,[U]:q}))},xn=async(U,q)=>{const L=ae[U],Y=je(J,"tests",U);await Ze(Y,{title:L},{merge:!0}),ge(Q=>{const K={...Q};return delete K[U],K}),Ft(q)},is=(U,q)=>{console.log(`Updating description for test ID ${U}:`,q),Z(L=>({...L,[U]:q})),ye(L=>({...L,tests:!0}))},as=(U,q)=>{console.log(`Updating results for test ID ${U}:`,q),te(L=>({...L,[U]:q})),ye(L=>({...L,tests:!0}))},os=(U,q)=>{ie(L=>({...L,[U]:q})),ye(L=>({...L,tests:!0}))};H.useEffect(()=>{!e&&o&&(async()=>{if(!o)return;let q;o.isAdmin?q=Ee(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):q=Ee(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",o.uid),Pe("dateCreated"));const L=await Ke(q),Y=[],Q={},K={};for(const G of L.docs){const Ue=G.data(),Qe=G.id;Y.push({id:Qe,...Ue,images:Ue.images||[],files:Ue.files||[]}),K[Qe]=!0;let zt;o.isAdmin?zt=Ee(Ce(J,"tests"),me("build_ID","==",Qe),Pe("dateCreated")):zt=Ee(Ce(J,"tests"),me("build_ID","==",Qe),me("userId","==",o.uid),Pe("dateCreated"));const gs=await Ke(zt),jn=[],Wt={},qt={};for(const Ye of gs.docs){const Ve=Ye.data();jn.push({id:Ye.id,...Ve}),Wt[Ye.id]=Ve.images||[],qt[Ye.id]=Ve.files||[]}Q[Qe]=jn,ce(Ye=>{const Ve={...Ye};for(const yt in Wt)Ve[yt]=Wt[yt];return Ve}),Te(Ye=>{const Ve={...Ye};for(const yt in qt)Ve[yt]=qt[yt];return Ve})}u(Y),z(Q),he(K)})()},[e,o,m.id,t]);const Ft=async U=>{if(!o){console.log("User details not loaded yet");return}try{let q;o.isAdmin?q=Ee(Ce(J,"tests"),me("build_ID","==",U),Pe("dateCreated")):q=Ee(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",o.uid),Pe("dateCreated"));const Y=(await Ke(q)).docs.map(G=>{const Ue=G.data();return{id:G.id,...Ue,images:Ue.images||[],files:Ue.files||[]}});z(G=>({...G,[U]:Y}));const Q={},K={};Y.forEach(G=>{Q[G.id]=G.images,K[G.id]=G.files}),ce(Q),Te(K)}catch(q){console.error("Error fetching tests:",q)}},ls=(U,q)=>{const L=je(J,"tests",U),Y=ee[U].filter(K=>!q.includes(K));ce(K=>({...K,[U]:Y}));const Q=Y.map(({url:K,path:G,title:Ue})=>({url:K,path:G,title:Ue}));Ze(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ne("Test Image deletions updated."),re("success")}).catch(K=>{console.error("Failed to update test images in Firestore:",K),ne("Failed to update test image deletions."),re("error")}),le(!0)},vn=(U,q)=>{ce(L=>({...L,[U]:q}))},yn=(U,q)=>{Te(L=>({...L,[U]:q}))},ds=async U=>{var L;const q=((L=_e[U])==null?void 0:L.filter(Y=>Y.deleted))||[];if(q.length>0){const Y=ft(),Q=q.map(K=>{const G=ht(Y,K.path);return kt(G)});try{await Promise.all(Q);const K=_e[U].filter(G=>!G.deleted);Te(G=>({...G,[U]:K})),await Vt(je(J,"tests",U),{files:K.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),ne("Deleted test files have been permanently removed."),re("success"),le(!0)}catch(K){console.error("Failed to delete test files: ",K),ne("Failed to delete test files."),re("error"),le(!0)}}},cs=async(U,q)=>{await gt(je(J,"tests",U)),await Ft(q),ne("Test deleted successfully."),re("success"),le(!0)},us=(U,q)=>{xe("Are you sure you want to delete this test? This action cannot be undone."),Ge(()=>()=>cs(U,q)),oe(!0)},fs=U=>{he(q=>({...q,[U]:!q[U]}))},hs=()=>{const U=Object.entries(Fe).filter(([L,Y])=>Y).map(([L])=>L).join(", ");if(!U.length){D();return}const q=`You have unsaved changes in the following sections: ${U}. Are you sure you want to leave?`;xe(q),Ge(()=>()=>{ye({design:!1,builds:!1,tests:!1}),D()}),oe(!0)};return H.useEffect(()=>{const U=q=>{Object.values(Fe).some(Y=>Y)&&(q.preventDefault(),q.returnValue="")};return window.addEventListener("beforeunload",U),()=>window.removeEventListener("beforeunload",U)},[Fe]),i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:()=>{Object.values(Fe).some(q=>q)?hs():D()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:xt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:d,onChange:U=>{v(U.target.value),ye(q=>({...q,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:c||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:T||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Rt,{id:"course",value:r,onChange:U=>{s(U.target.value),ye(q=>({...q,design:!0}))},fullWidth:!0,children:(o!=null&&o.classes?Object.entries(o.classes):[]).map(([U,q])=>i.jsx(ct,{value:U,children:`${q.number} - ${q.title}`},U))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(qe,{initialValue:x,onChange:U=>{n(U),ye(q=>({...q,design:!0}))}}),i.jsx(st,{ref:P,path:`designs/${m.id}/images`,initialImages:S,onImagesUpdated:vt,onDelete:Lt,isOwnDesign:a}),i.jsx(mt,{path:`designs/${m.id}/files`,initialFiles:O,onFilesChange:E,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>I(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{_(!0),setTimeout(()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),h.map((U,q)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:F[U.id]!==void 0?i.jsx(_t,{variant:"outlined",size:"small",fullWidth:!0,value:F[U.id],onChange:L=>Ht(U.id,L.target.value),onBlur:()=>Oe(U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Me,{onClick:()=>Oe(U.id),size:"small",children:i.jsx(fn,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>M(L=>({...L,[U.id]:U.title||`Build ${q+1}`})),style:{cursor:"pointer"},children:U.title||`Build ${q+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>N(L=>({...L,[U.id]:!L[U.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:l[U.id]?i.jsx(un,{}):i.jsx(Qt,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>$e(U.id),children:i.jsx(wt,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{W(U.id),setTimeout(()=>{ue.current&&ue.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),l[U.id]&&i.jsxs(i.Fragment,{children:[i.jsx(qe,{initialValue:p[U.id]||U.description,onChange:L=>{He(U.id,L)}}),i.jsx(st,{path:`builds/${U.id}/images`,initialImages:U.images,onImagesUpdated:L=>ze(U.id,L),onDelete:L=>et(U.id,L),isOwnDesign:a}),i.jsx(mt,{path:`builds/${U.id}/files`,initialFiles:U.files,onFilesChange:L=>bn(U.id,L),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Je(U.id),children:"Update"})}),i.jsx("div",{children:$[U.id]&&$[U.id].length>0&&i.jsx("button",{onClick:()=>fs(U.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[U.id]?i.jsxs(i.Fragment,{children:[i.jsx(Qt,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(un,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[U.id]&&$[U.id]&&$[U.id].map((L,Y)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:ae[L.id]!==void 0?i.jsx(_t,{variant:"outlined",size:"small",fullWidth:!0,value:ae[L.id],onChange:Q=>rs(L.id,Q.target.value),onBlur:()=>xn(L.id,U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Me,{onClick:()=>xn(L.id,U.id),size:"small",children:i.jsx(fn,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>ge(Q=>({...Q,[L.id]:L.title||`Test ${Y+1}`})),style:{cursor:"pointer"},children:L.title||`Test ${Y+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>fe(Q=>({...Q,[L.id]:!Q[L.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:pe[L.id]?i.jsx(un,{}):i.jsx(Qt,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>us(L.id,U.id),children:i.jsx(wt,{})})]})]}),pe[L.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(qe,{initialValue:R[L.id]||L.description,onChange:Q=>{is(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(qe,{initialValue:se[L.id]||L.results,onChange:Q=>{as(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(qe,{initialValue:X[L.id]||L.conclusions,onChange:Q=>{os(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(st,{path:`tests/${L.id}/images`,initialImages:ee[L.id]||[],onImagesUpdated:Q=>vn(L.id,Q),onDelete:Q=>ls(L.id,Q),isOwnDesign:a}),i.jsx(mt,{path:`tests/${L.id}/files`,initialFiles:_e[L.id]||[],onFilesChange:Q=>yn(L.id,Q),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>ss(L.id,U.id),children:"Update"})})]})]},L.id))]}),V===U.id&&i.jsxs("div",{className:"new-test-record",ref:ue,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(br,{designId:m.id,buildId:U.id,refreshTests:()=>Ft(U.id),setAddingTestIdForBuild:W,onImagesUpdated:L=>vn(U.id,L),onFilesChange:L=>yn(U.id,L)})]})]},U.id)),i.jsx("div",{children:y&&i.jsxs("div",{className:"new-build-record",ref:f,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(pr,{designId:m.id,setIsAddingBuild:_,refreshBuilds:Ne,onImagesUpdated:U=>ze("temp-build-id",U),onFilesChange:U=>bn("temp-build-id",U)})]})})]}),i.jsxs(rt,{open:Ie,onClose:()=>oe(!1),children:[i.jsx(pt,{children:"Confirmation Required"}),i.jsx(it,{children:i.jsx(At,{children:de})}),i.jsxs(bt,{children:[i.jsx(Se,{onClick:()=>oe(!1),children:"Cancel"}),i.jsx(Se,{onClick:()=>{Le(),oe(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(at,{open:ve,autoHideDuration:6e3,onClose:()=>le(!1),children:i.jsx(ot,{onClose:()=>le(!1),severity:De,sx:{width:"100%"},children:we})})]})},dt=(m,I,D)=>m[I]??D,vr=()=>{const{userDetails:m,loading:I}=St();console.log("Dashboard loaded");const[D,o]=H.useState([]),[e,t]=H.useState([]),[a,d]=H.useState([]),[v,x]=H.useState(null),[n,r]=H.useState(!1),[s,c]=H.useState(!1),[g,T]=H.useState(!1),[k,S]=H.useState(""),[B,O]=H.useState(""),[E,P]=H.useState(!1),[y,_]=H.useState(null),[h,u]=H.useState(!1),[p,j]=H.useState(""),[w,C]=H.useState("info"),b=()=>{c(!1),r(!1),x(null),A()},A=H.useCallback(async()=>{if(!m)return;let F;const M=[],$=[],z=[];if(m.isSuperAdmin)F=Ee(Ce(J,"designs"),Pe("dateCreated","desc"));else if(m.isAdmin){const W=m.classes?Object.keys(m.classes):[];if(W.length>0)F=Ee(Ce(J,"designs"),me("course","in",W),Pe("dateCreated","desc"));else{t([]),d([]);return}}else F=Ee(Ce(J,"designs"),me("userId","==",m.uid),Pe("dateCreated","desc"));(await Ke(F)).forEach(W=>{const R=W.data(),Z={id:W.id,title:dt(R,"title",""),description:dt(R,"description",""),course:dt(R,"course",""),dateCreated:R.dateCreated,dateModified:R.dateModified,userId:dt(R,"userId",""),images:dt(R,"images",[]),files:dt(R,"files",[])};m.isSuperAdmin?R.userId===m.uid?M.push(Z):R.userId!==m.uid&&R.course&&R.isAdmin?$.push(Z):R.userId!==m.uid&&!R.isAdmin&&z.push(Z):m.isAdmin?R.userId===m.uid?$.push(Z):z.push(Z):R.userId===m.uid&&z.push(Z)}),o(M),t($),d(z)},[m]);H.useEffect(()=>{!I&&m&&A()},[m,I,A]);const f=F=>{const M=[...D,...e,...a].find($=>$.id===F);x(M||null),c(!0)},l=F=>{_(F),S("Are you sure you want to delete this design? This action cannot be undone."),T(!0)},N=async()=>{if(y)if(B!==(m==null?void 0:m.uid))j("User ID confirmation failed. Enter the correct User ID."),C("error"),u(!0);else try{const F=Ee(Ce(J,"builds"),me("design_ID","==",y),me("userId","==",m.uid)),M=await Ke(F);for(const $ of M.docs){const z=$.id,V=Ee(Ce(J,"tests"),me("build_ID","==",z),me("userId","==",m.uid)),W=await Ke(V);for(const R of W.docs)await gt(je(J,"tests",R.id));await gt(je(J,"builds",z))}await gt(je(J,"designs",y)),o($=>$.filter(z=>z.id!==y)),t($=>$.filter(z=>z.id!==y)),d($=>$.filter(z=>z.id!==y)),j("Your design and its associated builds and tests have been deleted."),C("success"),u(!0)}catch(F){console.error("Error deleting design, builds, and tests: ",F),j("There was an issue deleting your design and its associated builds and tests."),C("error"),u(!0)}finally{O(""),P(!1),_(null)}};return i.jsxs(tt,{className:"profile-container",sx:{p:4},children:[" ",!n&&!s&&i.jsxs(i.Fragment,{children:[i.jsx(tt,{sx:{mb:3},children:i.jsx(Hn,{setIsAdding:r})}),(m==null?void 0:m.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Super Admin Designs"}),i.jsx(lt,{designs:D,handleEdit:f,handleDelete:l,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),i.jsx("h2",{children:"Educator Designs"}),i.jsx(lt,{designs:e,handleEdit:f,handleDelete:l,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(lt,{designs:a,handleEdit:f,handleDelete:l,isAdmin:!1,userDetails:m,showUserIdColumn:!0})]}),(m==null?void 0:m.isAdmin)&&!m.isSuperAdmin&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Educator Designs"}),i.jsx(lt,{designs:e,handleEdit:f,handleDelete:l,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(lt,{designs:a,handleEdit:f,handleDelete:l,isAdmin:!1,userDetails:m,showUserIdColumn:!0})]}),!(m!=null&&m.isAdmin)&&!(m!=null&&m.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Student Designs"}),i.jsx(lt,{designs:a,handleEdit:f,handleDelete:l,isAdmin:!1,userDetails:m,showUserIdColumn:!1})]})]}),n&&i.jsx(mr,{designs:D.concat(e),setDesigns:t,setIsAdding:r,getDesigns:A,onReturnToDashboard:b}),s&&i.jsx(xr,{designs:D.concat(e),selectedDesign:v,setDesigns:t,setIsEditing:c,getDesigns:A,onReturnToDashboard:b}),i.jsxs(rt,{open:g,onClose:()=>T(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(pt,{children:"Confirm Deletion"}),i.jsx(it,{children:i.jsx(At,{children:k})}),i.jsxs(bt,{children:[i.jsx(Se,{onClick:()=>T(!1),children:"No, cancel"}),i.jsx(Se,{onClick:()=>{P(!0),T(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(rt,{open:E,onClose:()=>P(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(pt,{children:"Confirm Your User ID"}),i.jsx(it,{children:i.jsx(_t,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:B,onChange:F=>O(F.target.value)})}),i.jsxs(bt,{children:[i.jsx(Se,{onClick:()=>P(!1),children:"No, cancel"}),i.jsx(Se,{onClick:N,color:"primary",children:"Confirm"})]})]}),i.jsx(at,{open:h,autoHideDuration:6e3,onClose:()=>u(!1),children:i.jsx(ot,{onClose:()=>u(!1),severity:w,sx:{width:"100%"},children:p})})]})},wr=Ns.memo(vr);export{wr as default};
