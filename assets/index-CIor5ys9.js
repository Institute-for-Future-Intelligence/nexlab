import{r as q,j as i,B as tt,c as Se,T as Er,a6 as _r,P as Rr,a7 as Or,a8 as Mr,a9 as tn,aa as De,ab as Nr,e as Ht,I as Oe,a as at,b as ot,l as st,n as it,S as lt,A as dt,a2 as Br,a1 as En,a3 as zt,M as ht,w as Pr,x as Lr,aZ as qr,z as Wt,y as Hr,m as xt,o as Rt,p as yt,d as zr}from"./ui-DUOFynya.js";import{u as Wr,E as tr,D as Et,r as ct,C as $r,b as Qr,c as Vr,S as wn,d as Ot,e as J,V as nn}from"./index-B1uxxpKs.js";import{q as Cn,k as mt,r as pt,n as Lt,w as nr,l as rr,p as Sn,_ as Ce,h as _t,e as je,f as Gr,R as Ee,x as Pe,v as me,t as Ke,m as Ye,i as rn,y as bt}from"./firebase-BbBYlhCW.js";import{c as Pt,g as Xe}from"./vendor-wzZzN_Jv.js";import sn from"./purify.es-CQJ0hv7W.js";const sr=q.memo(({setIsAdding:m})=>{console.log("Header loaded");const T=Wr(),D=()=>{T("/")};return i.jsxs(tt,{className:"lab-notebook-container",children:[i.jsx(tt,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Se,{variant:"text",onClick:D,className:"back-home-button",children:"← Home Page"})}),i.jsx(tt,{sx:{display:"flex",alignItems:"center",mb:2},children:i.jsx(Er,{className:"webpage_title",children:"My Laboratory Notebook"})}),i.jsx(tt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx(Se,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>m(!0),children:"+ Create New"})})]})});sr.displayName="Header";const ut=({designs:m,handleEdit:T,handleDelete:D,userDetails:l,showUserIdColumn:e})=>{const t=a=>a?a instanceof Cn?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx(_r,{component:Rr,children:i.jsxs(Or,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[i.jsx(Mr,{children:i.jsxs(tn,{sx:{height:"60px"},children:[i.jsx(De,{sx:{fontWeight:"bold",width:e?"30%":"40%"},children:"Title"}),i.jsx(De,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),e&&i.jsx(De,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),i.jsx(De,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),i.jsx(De,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),i.jsx(De,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),i.jsx(De,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),i.jsx(Nr,{children:m&&m.length>0?m.map(a=>{const c=a.userId===(l==null?void 0:l.uid);return i.jsxs(tn,{sx:{height:"80px"},children:[i.jsx(De,{children:i.jsx("button",{onClick:()=>T(a.id),className:"hyperlink-style",children:a.title})}),i.jsx(De,{children:a.course&&(l!=null&&l.classes)&&l.classes[a.course]?`${l.classes[a.course].number} - ${l.classes[a.course].title}`:"N/A"}),e&&i.jsx(De,{children:a.userId}),i.jsx(De,{children:t(a.dateCreated)}),i.jsx(De,{children:t(a.dateModified)}),i.jsx(De,{children:i.jsx(Ht,{title:"Edit",children:i.jsx("span",{children:i.jsx(Oe,{onClick:()=>c&&T(a.id),color:"primary",disabled:!c,children:i.jsx(tr,{})})})})}),i.jsx(De,{children:i.jsx(Ht,{title:"Delete",children:i.jsx("span",{children:i.jsx(Oe,{onClick:()=>c&&D(a.id),color:"error",disabled:!c,children:i.jsx(Et,{})})})})})]},a.id)}):i.jsx(tn,{children:i.jsx(De,{colSpan:e?6:5,children:"No Designs Found"})})})]})})};function Zr(m,T){return T.forEach(function(D){D&&typeof D!="string"&&!Array.isArray(D)&&Object.keys(D).forEach(function(l){if(l!=="default"&&!(l in m)){var e=Object.getOwnPropertyDescriptor(D,l);Object.defineProperty(m,l,e.get?e:{enumerable:!0,get:function(){return D[l]}})}})}),Object.freeze(m)}function ir(m,T){return new Promise(function(D,l){let e;return Yr(m).then(function(t){try{return e=t,D(new Blob([T.slice(0,2),e,T.slice(2)],{type:"image/jpeg"}))}catch(a){return l(a)}},l)})}const Yr=m=>new Promise((T,D)=>{const l=new FileReader;l.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let a=0;if(t.getUint16(a)!==65496)return D("not a valid JPEG");for(a+=2;;){const c=t.getUint16(a);if(c===65498)break;const x=t.getUint16(a+2);if(c===65505&&t.getUint32(a+4)===1165519206){const v=a+10;let n;switch(t.getUint16(v)){case 18761:n=!0;break;case 19789:n=!1;break;default:return D("TIFF header contains invalid endian")}if(t.getUint16(v+2,n)!==42)return D("TIFF header contains invalid version");const s=t.getUint32(v+4,n),r=v+s+2+12*t.getUint16(v+s,n);for(let d=v+s+2;d<r;d+=12)if(t.getUint16(d,n)==274){if(t.getUint16(d+2,n)!==3)return D("Orientation data type is invalid");if(t.getUint32(d+4,n)!==1)return D("Orientation data count is invalid");t.setUint16(d+8,1,n);break}return T(e.slice(a,a+2+x))}a+=2+x}return T(new Blob)}),l.readAsArrayBuffer(m)});var $t={},Kr={get exports(){return $t},set exports(m){$t=m}};(function(m){var T,D,l={};Kr.exports=l,l.parse=function(e,t){for(var a=l.bin.readUshort,c=l.bin.readUint,x=0,v={},n=new Uint8Array(e),s=n.length-4;c(n,s)!=101010256;)s--;x=s,x+=4;var r=a(n,x+=4);a(n,x+=2);var d=c(n,x+=2),g=c(n,x+=4);x+=4,x=g;for(var I=0;I<r;I++){c(n,x),x+=4,x+=4,x+=4,c(n,x+=4),d=c(n,x+=4);var k=c(n,x+=4),S=a(n,x+=4),B=a(n,x+2),M=a(n,x+4);x+=6;var E=c(n,x+=8);x+=4,x+=S+B+M,l._readLocal(n,E,v,d,k,t)}return v},l._readLocal=function(e,t,a,c,x,v){var n=l.bin.readUshort,s=l.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var d=n(e,t+=8),g=n(e,t+=2);t+=2;var I=l.bin.readUTF8(e,t,d);if(t+=d,t+=g,v)a[I]={size:x,csize:c};else{var k=new Uint8Array(e.buffer,t);if(r==0)a[I]=new Uint8Array(k.buffer.slice(t,t+c));else{if(r!=8)throw"unknown compression method: "+r;var S=new Uint8Array(x);l.inflateRaw(k,S),a[I]=S}}},l.inflateRaw=function(e,t){return l.F.inflate(e,t)},l.inflate=function(e,t){return e[0],e[1],l.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},l.deflate=function(e,t){t==null&&(t={level:6});var a=0,c=new Uint8Array(50+Math.floor(1.1*e.length));c[a]=120,c[a+1]=156,a+=2,a=l.F.deflateRaw(e,c,a,t.level);var x=l.adler(e,0,e.length);return c[a+0]=x>>>24&255,c[a+1]=x>>>16&255,c[a+2]=x>>>8&255,c[a+3]=x>>>0&255,new Uint8Array(c.buffer,0,a+4)},l.deflateRaw=function(e,t){t==null&&(t={level:6});var a=new Uint8Array(50+Math.floor(1.1*e.length)),c=l.F.deflateRaw(e,a,c,t.level);return new Uint8Array(a.buffer,0,c)},l.encode=function(e,t){t==null&&(t=!1);var a=0,c=l.bin.writeUint,x=l.bin.writeUshort,v={};for(var n in e){var s=!l._noNeed(n)&&!t,r=e[n],d=l.crc.crc(r,0,r.length);v[n]={cpr:s,usize:r.length,crc:d,file:s?l.deflateRaw(r):r}}for(var n in v)a+=v[n].file.length+30+46+2*l.bin.sizeUTF8(n);a+=22;var g=new Uint8Array(a),I=0,k=[];for(var n in v){var S=v[n];k.push(I),I=l._writeHeader(g,I,n,S,0)}var B=0,M=I;for(var n in v)S=v[n],k.push(I),I=l._writeHeader(g,I,n,S,1,k[B++]);var E=I-M;return c(g,I,101010256),I+=4,x(g,I+=4,B),x(g,I+=2,B),c(g,I+=2,E),c(g,I+=4,M),I+=4,I+=2,g.buffer},l._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},l._writeHeader=function(e,t,a,c,x,v){var n=l.bin.writeUint,s=l.bin.writeUshort,r=c.file;return n(e,t,x==0?67324752:33639248),t+=4,x==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,c.cpr?8:0),n(e,t+=2,0),n(e,t+=4,c.crc),n(e,t+=4,r.length),n(e,t+=4,c.usize),s(e,t+=4,l.bin.sizeUTF8(a)),s(e,t+=2,0),t+=2,x==1&&(t+=2,t+=2,n(e,t+=6,v),t+=4),t+=l.bin.writeUTF8(e,t,a),x==0&&(e.set(r,t),t+=r.length),t},l.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var a=t,c=0;c<8;c++)1&a?a=3988292384^a>>>1:a>>>=1;e[t]=a}return e}(),update:function(e,t,a,c){for(var x=0;x<c;x++)e=l.crc.table[255&(e^t[a+x])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^l.crc.update(4294967295,e,t,a)}},l.adler=function(e,t,a){for(var c=1,x=0,v=t,n=t+a;v<n;){for(var s=Math.min(v+5552,n);v<s;)x+=c+=e[v++];c%=65521,x%=65521}return x<<16|c},l.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,a){e[t]=255&a,e[t+1]=a>>8&255,e[t+2]=a>>16&255,e[t+3]=a>>24&255},readASCII:function(e,t,a){for(var c="",x=0;x<a;x++)c+=String.fromCharCode(e[t+x]);return c},writeASCII:function(e,t,a){for(var c=0;c<a.length;c++)e[t+c]=a.charCodeAt(c)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,a){for(var c,x="",v=0;v<a;v++)x+="%"+l.bin.pad(e[t+v].toString(16));try{c=decodeURIComponent(x)}catch{return l.bin.readASCII(e,t,a)}return c},writeUTF8:function(e,t,a){for(var c=a.length,x=0,v=0;v<c;v++){var n=a.charCodeAt(v);if((4294967168&n)==0)e[t+x]=n,x++;else if((4294965248&n)==0)e[t+x]=192|n>>6,e[t+x+1]=128|n>>0&63,x+=2;else if((4294901760&n)==0)e[t+x]=224|n>>12,e[t+x+1]=128|n>>6&63,e[t+x+2]=128|n>>0&63,x+=3;else{if((4292870144&n)!=0)throw"e";e[t+x]=240|n>>18,e[t+x+1]=128|n>>12&63,e[t+x+2]=128|n>>6&63,e[t+x+3]=128|n>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var t=e.length,a=0,c=0;c<t;c++){var x=e.charCodeAt(c);if((4294967168&x)==0)a++;else if((4294965248&x)==0)a+=2;else if((4294901760&x)==0)a+=3;else{if((4292870144&x)!=0)throw"e";a+=4}}return a}},l.F={},l.F.deflateRaw=function(e,t,a,c){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],v=l.F.U,n=l.F._goodIndex;l.F._hash;var s=l.F._putsE,r=0,d=a<<3,g=0,I=e.length;if(c==0){for(;r<I;)s(t,d,r+(j=Math.min(65535,I-r))==I?1:0),d=l.F._copyExact(e,r,j,t,d+8),r+=j;return d>>>3}var k=v.lits,S=v.strt,B=v.prev,M=0,E=0,P=0,y=0,R=0,h=0;for(I>2&&(S[h=l.F._hash(e,0)]=0),r=0;r<I;r++){if(R=h,r+1<I-2){h=l.F._hash(e,r+1);var u=r+1&32767;B[u]=S[h],S[h]=u}if(g<=r){(M>14e3||E>26697)&&I-r>100&&(g<r&&(k[M]=r-g,M+=2,g=r),d=l.F._writeBlock(r==I-1||g==I?1:0,k,M,y,e,P,r-P,t,d),M=E=y=0,P=r);var p=0;r<I-2&&(p=l.F._bestMatch(e,r,B,R,Math.min(x[2],I-r),x[3]));var j=p>>>16,w=65535&p;if(p!=0){w=65535&p;var C=n(j=p>>>16,v.of0);v.lhst[257+C]++;var b=n(w,v.df0);v.dhst[b]++,y+=v.exb[C]+v.dxb[b],k[M]=j<<23|r-g,k[M+1]=w<<16|C<<8|b,M+=2,g=r+j}else v.lhst[e[r]]++;E++}}for(P==r&&e.length!=0||(g<r&&(k[M]=r-g,M+=2,g=r),d=l.F._writeBlock(1,k,M,y,e,P,r-P,t,d),M=0,E=0,M=E=y=0,P=r);(7&d)!=0;)d++;return d>>>3},l.F._bestMatch=function(e,t,a,c,x,v){var n=32767&t,s=a[n],r=n-s+32768&32767;if(s==n||c!=l.F._hash(e,t-r))return 0;for(var d=0,g=0,I=Math.min(32767,t);r<=I&&--v!=0&&s!=n;){if(d==0||e[t+d]==e[t+d-r]){var k=l.F._howLong(e,t,r);if(k>d){if(g=r,(d=k)>=x)break;r+2<k&&(k=r+2);for(var S=0,B=0;B<k-2;B++){var M=t-r+B+32768&32767,E=M-a[M]+32768&32767;E>S&&(S=E,s=M)}}}r+=(n=s)-(s=a[n])+32768&32767}return d<<16|g},l.F._howLong=function(e,t,a){if(e[t]!=e[t-a]||e[t+1]!=e[t+1-a]||e[t+2]!=e[t+2-a])return 0;var c=t,x=Math.min(e.length,t+258);for(t+=3;t<x&&e[t]==e[t-a];)t++;return t-c},l.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},l.saved=0,l.F._writeBlock=function(e,t,a,c,x,v,n,s,r){var d,g,I,k,S,B,M,E,P,y=l.F.U,R=l.F._putsF,h=l.F._putsE;y.lhst[256]++,g=(d=l.F.getTrees())[0],I=d[1],k=d[2],S=d[3],B=d[4],M=d[5],E=d[6],P=d[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),p=c+l.F.contSize(y.fltree,y.lhst)+l.F.contSize(y.fdtree,y.dhst),j=c+l.F.contSize(y.ltree,y.lhst)+l.F.contSize(y.dtree,y.dhst);j+=14+3*M+l.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var w=0;w<286;w++)y.lhst[w]=0;for(w=0;w<30;w++)y.dhst[w]=0;for(w=0;w<19;w++)y.ihst[w]=0;var C=u<p&&u<j?0:p<j?1:2;if(R(s,r,e),R(s,r+1,C),r+=3,C==0){for(;(7&r)!=0;)r++;r=l.F._copyExact(x,v,n,s,r)}else{var b,A;if(C==1&&(b=y.fltree,A=y.fdtree),C==2){l.F.makeCodes(y.ltree,g),l.F.revCodes(y.ltree,g),l.F.makeCodes(y.dtree,I),l.F.revCodes(y.dtree,I),l.F.makeCodes(y.itree,k),l.F.revCodes(y.itree,k),b=y.ltree,A=y.dtree,h(s,r,S-257),h(s,r+=5,B-1),h(s,r+=5,M-4),r+=4;for(var f=0;f<M;f++)h(s,r+3*f,y.itree[1+(y.ordr[f]<<1)]);r+=3*M,r=l.F._codeTiny(E,y.itree,s,r),r=l.F._codeTiny(P,y.itree,s,r)}for(var o=v,N=0;N<a;N+=2){for(var F=t[N],O=F>>>23,$=o+(8388607&F);o<$;)r=l.F._writeLit(x[o++],b,s,r);if(O!=0){var H=t[N+1],V=H>>16,z=H>>8&255,_=255&H;h(s,r=l.F._writeLit(257+z,b,s,r),O-y.of0[z]),r+=y.exb[z],R(s,r=l.F._writeLit(_,A,s,r),V-y.df0[_]),r+=y.dxb[_],o+=O}}r=l.F._writeLit(256,b,s,r)}return r},l.F._copyExact=function(e,t,a,c,x){var v=x>>>3;return c[v]=a,c[v+1]=a>>>8,c[v+2]=255-c[v],c[v+3]=255-c[v+1],v+=4,c.set(new Uint8Array(e.buffer,t,a),v),x+(a+4<<3)},l.F.getTrees=function(){for(var e=l.F.U,t=l.F._hufTree(e.lhst,e.ltree,15),a=l.F._hufTree(e.dhst,e.dtree,15),c=[],x=l.F._lenCodes(e.ltree,c),v=[],n=l.F._lenCodes(e.dtree,v),s=0;s<c.length;s+=2)e.ihst[c[s]]++;for(s=0;s<v.length;s+=2)e.ihst[v[s]]++;for(var r=l.F._hufTree(e.ihst,e.itree,7),d=19;d>4&&e.itree[1+(e.ordr[d-1]<<1)]==0;)d--;return[t,a,r,x,n,d,c,v]},l.F.getSecond=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(e[a+1]);return t},l.F.nonZero=function(e){for(var t="",a=0;a<e.length;a+=2)e[a+1]!=0&&(t+=(a>>1)+",");return t},l.F.contSize=function(e,t){for(var a=0,c=0;c<t.length;c++)a+=t[c]*e[1+(c<<1)];return a},l.F._codeTiny=function(e,t,a,c){for(var x=0;x<e.length;x+=2){var v=e[x],n=e[x+1];c=l.F._writeLit(v,t,a,c);var s=v==16?2:v==17?3:7;v>15&&(l.F._putsE(a,c,n,s),c+=s)}return c},l.F._lenCodes=function(e,t){for(var a=e.length;a!=2&&e[a-1]==0;)a-=2;for(var c=0;c<a;c+=2){var x=e[c+1],v=c+3<a?e[c+3]:-1,n=c+5<a?e[c+5]:-1,s=c==0?-1:e[c-1];if(x==0&&v==x&&n==x){for(var r=c+5;r+2<a&&e[r+2]==x;)r+=2;(d=Math.min(r+1-c>>>1,138))<11?t.push(17,d-3):t.push(18,d-11),c+=2*d-2}else if(x==s&&v==x&&n==x){for(r=c+5;r+2<a&&e[r+2]==x;)r+=2;var d=Math.min(r+1-c>>>1,6);t.push(16,d-3),c+=2*d-2}else t.push(x,0)}return a>>>1},l.F._hufTree=function(e,t,a){var c=[],x=e.length,v=t.length,n=0;for(n=0;n<v;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<x;n++)e[n]!=0&&c.push({lit:n,f:e[n]});var s=c.length,r=c.slice(0);if(s==0)return 0;if(s==1){var d=c[0].lit;return r=d==0?1:0,t[1+(d<<1)]=1,t[1+(r<<1)]=1,1}c.sort(function(E,P){return E.f-P.f});var g=c[0],I=c[1],k=0,S=1,B=2;for(c[0]={lit:-1,f:g.f+I.f,l:g,r:I,d:0};S!=s-1;)g=k!=S&&(B==s||c[k].f<c[B].f)?c[k++]:c[B++],I=k!=S&&(B==s||c[k].f<c[B].f)?c[k++]:c[B++],c[S++]={lit:-1,f:g.f+I.f,l:g,r:I};var M=l.F.setDepth(c[S-1],0);for(M>a&&(l.F.restrictDepth(r,a,M),M=a),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return M},l.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(l.F.setDepth(e.l,t+1),l.F.setDepth(e.r,t+1))},l.F.restrictDepth=function(e,t,a){var c=0,x=1<<a-t,v=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),c=0;c<e.length&&e[c].d>t;c++){var n=e[c].d;e[c].d=t,v+=x-(1<<a-n)}for(v>>>=a-t;v>0;)(n=e[c].d)<t?(e[c].d++,v-=1<<t-n-1):c++;for(;c>=0;c--)e[c].d==t&&v<0&&(e[c].d--,v++);v!=0&&console.log("debt left")},l.F._goodIndex=function(e,t){var a=0;return t[16|a]<=e&&(a|=16),t[8|a]<=e&&(a|=8),t[4|a]<=e&&(a|=4),t[2|a]<=e&&(a|=2),t[1|a]<=e&&(a|=1),a},l.F._writeLit=function(e,t,a,c){return l.F._putsF(a,c,t[e<<1]),c+t[1+(e<<1)]},l.F.inflate=function(e,t){var a=Uint8Array;if(e[0]==3&&e[1]==0)return t||new a(0);var c=l.F,x=c._bitsF,v=c._bitsE,n=c._decodeTiny,s=c.makeCodes,r=c.codes2map,d=c._get17,g=c.U,I=t==null;I&&(t=new a(e.length>>>2<<3));for(var k,S,B=0,M=0,E=0,P=0,y=0,R=0,h=0,u=0,p=0;B==0;)if(B=x(e,p,1),M=x(e,p+1,2),p+=3,M!=0){if(I&&(t=l.F._check(t,u+(1<<17))),M==1&&(k=g.flmap,S=g.fdmap,R=511,h=31),M==2){E=v(e,p,5)+257,P=v(e,p+5,5)+1,y=v(e,p+10,4)+4,p+=14;for(var j=0;j<38;j+=2)g.itree[j]=0,g.itree[j+1]=0;var w=1;for(j=0;j<y;j++){var C=v(e,p+3*j,3);g.itree[1+(g.ordr[j]<<1)]=C,C>w&&(w=C)}p+=3*y,s(g.itree,w),r(g.itree,w,g.imap),k=g.lmap,S=g.dmap,p=n(g.imap,(1<<w)-1,E+P,e,p,g.ttree);var b=c._copyOut(g.ttree,0,E,g.ltree);R=(1<<b)-1;var A=c._copyOut(g.ttree,E,P,g.dtree);h=(1<<A)-1,s(g.ltree,b),r(g.ltree,b,k),s(g.dtree,A),r(g.dtree,A,S)}for(;;){var f=k[d(e,p)&R];p+=15&f;var o=f>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var N=u+o-254;if(o>264){var F=g.ldef[o-257];N=u+(F>>>3)+v(e,p,7&F),p+=7&F}var O=S[d(e,p)&h];p+=15&O;var $=O>>>4,H=g.ddef[$],V=(H>>>4)+x(e,p,15&H);for(p+=15&H,I&&(t=l.F._check(t,u+(1<<17)));u<N;)t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V];u=N}}}else{(7&p)!=0&&(p+=8-(7&p));var z=4+(p>>>3),_=e[z-4]|e[z-3]<<8;I&&(t=l.F._check(t,u+_)),t.set(new a(e.buffer,e.byteOffset+z,_),u),p=z+_<<3,u+=_}return t.length==u?t:t.slice(0,u)},l.F._check=function(e,t){var a=e.length;if(t<=a)return e;var c=new Uint8Array(Math.max(a<<1,t));return c.set(e,0),c},l.F._decodeTiny=function(e,t,a,c,x,v){for(var n=l.F._bitsE,s=l.F._get17,r=0;r<a;){var d=e[s(c,x)&t];x+=15&d;var g=d>>>4;if(g<=15)v[r]=g,r++;else{var I=0,k=0;g==16?(k=3+n(c,x,2),x+=2,I=v[r-1]):g==17?(k=3+n(c,x,3),x+=3):g==18&&(k=11+n(c,x,7),x+=7);for(var S=r+k;r<S;)v[r]=I,r++}}return x},l.F._copyOut=function(e,t,a,c){for(var x=0,v=0,n=c.length>>>1;v<a;){var s=e[v+t];c[v<<1]=0,c[1+(v<<1)]=s,s>x&&(x=s),v++}for(;v<n;)c[v<<1]=0,c[1+(v<<1)]=0,v++;return x},l.F.makeCodes=function(e,t){for(var a,c,x,v,n=l.F.U,s=e.length,r=n.bl_count,d=0;d<=t;d++)r[d]=0;for(d=1;d<s;d+=2)r[e[d]]++;var g=n.next_code;for(a=0,r[0]=0,c=1;c<=t;c++)a=a+r[c-1]<<1,g[c]=a;for(x=0;x<s;x+=2)(v=e[x+1])!=0&&(e[x]=g[v],g[v]++)},l.F.codes2map=function(e,t,a){for(var c=e.length,x=l.F.U.rev15,v=0;v<c;v+=2)if(e[v+1]!=0)for(var n=v>>1,s=e[v+1],r=n<<4|s,d=t-s,g=e[v]<<d,I=g+(1<<d);g!=I;)a[x[g]>>>15-t]=r,g++},l.F.revCodes=function(e,t){for(var a=l.F.U.rev15,c=15-t,x=0;x<e.length;x+=2){var v=e[x]<<t-e[x+1];e[x]=a[v]>>>c}},l.F._putsE=function(e,t,a){a<<=7&t;var c=t>>>3;e[c]|=a,e[c+1]|=a>>>8},l.F._putsF=function(e,t,a){a<<=7&t;var c=t>>>3;e[c]|=a,e[c+1]|=a>>>8,e[c+2]|=a>>>16},l.F._bitsE=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<a)-1},l.F._bitsF=function(e,t,a){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<a)-1},l.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},l.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},l.F.U=(T=Uint16Array,D=Uint32Array,{next_code:new T(16),bl_count:new T(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new T(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new T(512),fltree:[],fdmap:new T(32),fdtree:[],lmap:new T(32768),ltree:[],ttree:[],dmap:new T(32768),dtree:[],imap:new T(512),itree:[],rev15:new T(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new T(65536),prev:new T(32768)}),function(){for(var e=l.F.U,t=0;t<32768;t++){var a=t;a=(4278255360&(a=(4042322160&(a=(3435973836&(a=(2863311530&a)>>>1|(1431655765&a)<<1))>>>2|(858993459&a)<<2))>>>4|(252645135&a)<<4))>>>8|(16711935&a)<<8,e.rev15[t]=(a>>>16|a<<16)>>>17}function c(x,v,n){for(;v--!=0;)x.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];c(e.fltree,144,8),c(e.fltree,112,9),c(e.fltree,24,7),c(e.fltree,8,8),l.F.makeCodes(e.fltree,9),l.F.codes2map(e.fltree,9,e.flmap),l.F.revCodes(e.fltree,9),c(e.fdtree,32,5),l.F.makeCodes(e.fdtree,5),l.F.codes2map(e.fdtree,5,e.fdmap),l.F.revCodes(e.fdtree,5),c(e.itree,19,0),c(e.ltree,286,0),c(e.dtree,30,0),c(e.ttree,320,0)}()})();var Xr=Zr({__proto__:null,default:$t},[$t]);const Be=function(){var m={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let d="";for(let g=0;g<r;g++)d+=String.fromCharCode(n[s+g]);return d},writeASCII(n,s,r){for(let d=0;d<r.length;d++)n[s+d]=r.charCodeAt(d)},readBytes(n,s,r){const d=[];for(let g=0;g<r;g++)d.push(n[s+g]);return d},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let d,g="";for(let I=0;I<r;I++)g+=`%${m.pad(n[s+I].toString(16))}`;try{d=decodeURIComponent(g)}catch{return m.readASCII(n,s,r)}return d}};function T(n,s,r,d){const g=s*r,I=t(d),k=Math.ceil(s*I/8),S=new Uint8Array(4*g),B=new Uint32Array(S.buffer),{ctype:M}=d,{depth:E}=d,P=m.readUshort;if(M==6){const F=g<<2;if(E==8)for(var y=0;y<F;y+=4)S[y]=n[y],S[y+1]=n[y+1],S[y+2]=n[y+2],S[y+3]=n[y+3];if(E==16)for(y=0;y<F;y++)S[y]=n[y<<1]}else if(M==2){const F=d.tabs.tRNS;if(F==null){if(E==8)for(y=0;y<g;y++){var R=3*y;B[y]=255<<24|n[R+2]<<16|n[R+1]<<8|n[R]}if(E==16)for(y=0;y<g;y++)R=6*y,B[y]=255<<24|n[R+4]<<16|n[R+2]<<8|n[R]}else{var h=F[0];const O=F[1],$=F[2];if(E==8)for(y=0;y<g;y++){var u=y<<2;R=3*y,B[y]=255<<24|n[R+2]<<16|n[R+1]<<8|n[R],n[R]==h&&n[R+1]==O&&n[R+2]==$&&(S[u+3]=0)}if(E==16)for(y=0;y<g;y++)u=y<<2,R=6*y,B[y]=255<<24|n[R+4]<<16|n[R+2]<<8|n[R],P(n,R)==h&&P(n,R+2)==O&&P(n,R+4)==$&&(S[u+3]=0)}}else if(M==3){const F=d.tabs.PLTE,O=d.tabs.tRNS,$=O?O.length:0;if(E==1)for(var p=0;p<r;p++){var j=p*k,w=p*s;for(y=0;y<s;y++){u=w+y<<2;var C=3*(b=n[j+(y>>3)]>>7-((7&y)<<0)&1);S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?O[b]:255}}if(E==2)for(p=0;p<r;p++)for(j=p*k,w=p*s,y=0;y<s;y++)u=w+y<<2,C=3*(b=n[j+(y>>2)]>>6-((3&y)<<1)&3),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?O[b]:255;if(E==4)for(p=0;p<r;p++)for(j=p*k,w=p*s,y=0;y<s;y++)u=w+y<<2,C=3*(b=n[j+(y>>1)]>>4-((1&y)<<2)&15),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?O[b]:255;if(E==8)for(y=0;y<g;y++){var b;u=y<<2,C=3*(b=n[y]),S[u]=F[C],S[u+1]=F[C+1],S[u+2]=F[C+2],S[u+3]=b<$?O[b]:255}}else if(M==4){if(E==8)for(y=0;y<g;y++){u=y<<2;var A=n[f=y<<1];S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+1]}if(E==16)for(y=0;y<g;y++){var f;u=y<<2,A=n[f=y<<2],S[u]=A,S[u+1]=A,S[u+2]=A,S[u+3]=n[f+2]}}else if(M==0)for(h=d.tabs.tRNS?d.tabs.tRNS:-1,p=0;p<r;p++){const F=p*k,O=p*s;if(E==1)for(var o=0;o<s;o++){var N=(A=255*(n[F+(o>>>3)]>>>7-(7&o)&1))==255*h?0:255;B[O+o]=N<<24|A<<16|A<<8|A}else if(E==2)for(o=0;o<s;o++)N=(A=85*(n[F+(o>>>2)]>>>6-((3&o)<<1)&3))==85*h?0:255,B[O+o]=N<<24|A<<16|A<<8|A;else if(E==4)for(o=0;o<s;o++)N=(A=17*(n[F+(o>>>1)]>>>4-((1&o)<<2)&15))==17*h?0:255,B[O+o]=N<<24|A<<16|A<<8|A;else if(E==8)for(o=0;o<s;o++)N=(A=n[F+o])==h?0:255,B[O+o]=N<<24|A<<16|A<<8|A;else if(E==16)for(o=0;o<s;o++)A=n[F+(o<<1)],N=P(n,F+(o<<1))==h?0:255,B[O+o]=N<<24|A<<16|A<<8|A}return S}function D(n,s,r,d){const g=t(n),I=Math.ceil(r*g/8),k=new Uint8Array((I+1+n.interlace)*d);return s=n.tabs.CgBI?e(s,k):l(s,k),n.interlace==0?s=a(s,n,0,r,d):n.interlace==1&&(s=function(B,M){const E=M.width,P=M.height,y=t(M),R=y>>3,h=Math.ceil(E*y/8),u=new Uint8Array(P*h);let p=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const o=C[A],N=b[A];let F=0,O=0,$=j[A];for(;$<P;)$+=o,O++;let H=w[A];for(;H<E;)H+=N,F++;const V=Math.ceil(F*y/8);a(B,M,p,F,O);let z=0,_=j[A];for(;_<P;){let Y=w[A],re=p+z*V<<3;for(;Y<E;){var f;if(y==1&&(f=(f=B[re>>3])>>7-(7&re)&1,u[_*h+(Y>>3)]|=f<<7-((7&Y)<<0)),y==2&&(f=(f=B[re>>3])>>6-(7&re)&3,u[_*h+(Y>>2)]|=f<<6-((3&Y)<<1)),y==4&&(f=(f=B[re>>3])>>4-(7&re)&15,u[_*h+(Y>>1)]|=f<<4-((1&Y)<<2)),y>=8){const te=_*h+Y*R;for(let X=0;X<R;X++)u[te+X]=B[(re>>3)+X]}re+=y,Y+=N}z++,_+=o}F*O!=0&&(p+=O*(1+V)),A+=1}return u}(s,n)),s}function l(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const d=Uint8Array;let g,I,k=0,S=0,B=0,M=0,E=0,P=0,y=0,R=0,h=0;if(s[0]==3&&s[1]==0)return r||new d(0);const u=n.H,p=u.b,j=u.e,w=u.R,C=u.n,b=u.A,A=u.Z,f=u.m,o=r==null;for(o&&(r=new d(s.length>>>2<<5));k==0;)if(k=p(s,h,1),S=p(s,h+1,2),h+=3,S!=0){if(o&&(r=n.H.W(r,R+(1<<17))),S==1&&(g=f.J,I=f.h,P=511,y=31),S==2){B=j(s,h,5)+257,M=j(s,h+5,5)+1,E=j(s,h+10,4)+4,h+=14;let F=1;for(var N=0;N<38;N+=2)f.Q[N]=0,f.Q[N+1]=0;for(N=0;N<E;N++){const H=j(s,h+3*N,3);f.Q[1+(f.X[N]<<1)]=H,H>F&&(F=H)}h+=3*E,C(f.Q,F),b(f.Q,F,f.u),g=f.w,I=f.d,h=w(f.u,(1<<F)-1,B+M,s,h,f.v);const O=u.V(f.v,0,B,f.C);P=(1<<O)-1;const $=u.V(f.v,B,M,f.D);y=(1<<$)-1,C(f.C,O),b(f.C,O,g),C(f.D,$),b(f.D,$,I)}for(;;){const F=g[A(s,h)&P];h+=15&F;const O=F>>>4;if(!(O>>>8))r[R++]=O;else{if(O==256)break;{let $=R+O-254;if(O>264){const Y=f.q[O-257];$=R+(Y>>>3)+j(s,h,7&Y),h+=7&Y}const H=I[A(s,h)&y];h+=15&H;const V=H>>>4,z=f.c[V],_=(z>>>4)+p(s,h,15&z);for(h+=15&z;R<$;)r[R]=r[R++-_],r[R]=r[R++-_],r[R]=r[R++-_],r[R]=r[R++-_];R=$}}}}else{(7&h)!=0&&(h+=8-(7&h));const F=4+(h>>>3),O=s[F-4]|s[F-3]<<8;o&&(r=n.H.W(r,R+O)),r.set(new d(s.buffer,s.byteOffset+F,O),R),h=F+O<<3,R+=O}return r.length==R?r:r.slice(0,R)},n.H.W=function(s,r){const d=s.length;if(r<=d)return s;const g=new Uint8Array(d<<1);return g.set(s,0),g},n.H.R=function(s,r,d,g,I,k){const S=n.H.e,B=n.H.Z;let M=0;for(;M<d;){const E=s[B(g,I)&r];I+=15&E;const P=E>>>4;if(P<=15)k[M]=P,M++;else{let y=0,R=0;P==16?(R=3+S(g,I,2),I+=2,y=k[M-1]):P==17?(R=3+S(g,I,3),I+=3):P==18&&(R=11+S(g,I,7),I+=7);const h=M+R;for(;M<h;)k[M]=y,M++}}return I},n.H.V=function(s,r,d,g){let I=0,k=0;const S=g.length>>>1;for(;k<d;){const B=s[k+r];g[k<<1]=0,g[1+(k<<1)]=B,B>I&&(I=B),k++}for(;k<S;)g[k<<1]=0,g[1+(k<<1)]=0,k++;return I},n.H.n=function(s,r){const d=n.H.m,g=s.length;let I,k,S,B;const M=d.j;for(var E=0;E<=r;E++)M[E]=0;for(E=1;E<g;E+=2)M[s[E]]++;const P=d.K;for(I=0,M[0]=0,k=1;k<=r;k++)I=I+M[k-1]<<1,P[k]=I;for(S=0;S<g;S+=2)B=s[S+1],B!=0&&(s[S]=P[B],P[B]++)},n.H.A=function(s,r,d){const g=s.length,I=n.H.m.r;for(let k=0;k<g;k+=2)if(s[k+1]!=0){const S=k>>1,B=s[k+1],M=S<<4|B,E=r-B;let P=s[k]<<E;const y=P+(1<<E);for(;P!=y;)d[I[P]>>>15-r]=M,P++}},n.H.l=function(s,r){const d=n.H.m.r,g=15-r;for(let I=0;I<s.length;I+=2){const k=s[I]<<r-s[I+1];s[I]=d[k]>>>g}},n.H.M=function(s,r,d){d<<=7&r;const g=r>>>3;s[g]|=d,s[g+1]|=d>>>8},n.H.I=function(s,r,d){d<<=7&r;const g=r>>>3;s[g]|=d,s[g+1]|=d>>>8,s[g+2]|=d>>>16},n.H.e=function(s,r,d){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<d)-1},n.H.b=function(s,r,d){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<d)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let g=r;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,s.r[r]=(g>>>16|g<<16)>>>17}function d(g,I,k){for(;I--!=0;)g.push(0,k)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];d(s._,144,8),d(s._,112,9),d(s._,24,7),d(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),d(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),d(s.Q,19,0),d(s.C,286,0),d(s.D,30,0),d(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function a(n,s,r,d,g){let I=t(s);const k=Math.ceil(d*I/8);let S,B;I=Math.ceil(I/8);let M=n[r],E=0;if(M>1&&(n[r]=[0,0,1][M-2]),M==3)for(E=I;E<k;E++)n[E+1]=n[E+1]+(n[E+1-I]>>>1)&255;for(let P=0;P<g;P++)if(S=r+P*k,B=S+P+1,M=n[B-1],E=0,M==0)for(;E<k;E++)n[S+E]=n[B+E];else if(M==1){for(;E<I;E++)n[S+E]=n[B+E];for(;E<k;E++)n[S+E]=n[B+E]+n[S+E-I]}else if(M==2)for(;E<k;E++)n[S+E]=n[B+E]+n[S+E-k];else if(M==3){for(;E<I;E++)n[S+E]=n[B+E]+(n[S+E-k]>>>1);for(;E<k;E++)n[S+E]=n[B+E]+(n[S+E-k]+n[S+E-I]>>>1)}else{for(;E<I;E++)n[S+E]=n[B+E]+c(0,n[S+E-k],0);for(;E<k;E++)n[S+E]=n[B+E]+c(n[S+E-I],n[S+E-k],n[S+E-I-k])}return n}function c(n,s,r){const d=n+s-r,g=d-n,I=d-s,k=d-r;return g*g<=I*I&&g*g<=k*k?n:I*I<=k*k?s:r}function x(n,s,r){r.width=m.readUint(n,s),s+=4,r.height=m.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function v(n,s,r,d,g,I,k,S,B){const M=Math.min(s,g),E=Math.min(r,I);let P=0,y=0;for(let A=0;A<E;A++)for(let f=0;f<M;f++)if(k>=0&&S>=0?(P=A*s+f<<2,y=(S+A)*g+k+f<<2):(P=(-S+A)*s-k+f<<2,y=A*g+f<<2),B==0)d[y]=n[P],d[y+1]=n[P+1],d[y+2]=n[P+2],d[y+3]=n[P+3];else if(B==1){var R=n[P+3]*.00392156862745098,h=n[P]*R,u=n[P+1]*R,p=n[P+2]*R,j=d[y+3]*(1/255),w=d[y]*j,C=d[y+1]*j,b=d[y+2]*j;const o=1-R,N=R+j*o,F=N==0?0:1/N;d[y+3]=255*N,d[y+0]=(h+w*o)*F,d[y+1]=(u+C*o)*F,d[y+2]=(p+b*o)*F}else if(B==2)R=n[P+3],h=n[P],u=n[P+1],p=n[P+2],j=d[y+3],w=d[y],C=d[y+1],b=d[y+2],R==j&&h==w&&u==C&&p==b?(d[y]=0,d[y+1]=0,d[y+2]=0,d[y+3]=0):(d[y]=h,d[y+1]=u,d[y+2]=p,d[y+3]=R);else if(B==3){if(R=n[P+3],h=n[P],u=n[P+1],p=n[P+2],j=d[y+3],w=d[y],C=d[y+1],b=d[y+2],R==j&&h==w&&u==C&&p==b)continue;if(R<220&&j>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let d=8;const g=m,I=g.readUshort,k=g.readUint,S={tabs:{},frames:[]},B=new Uint8Array(r.length);let M,E=0,P=0;const y=[137,80,78,71,13,10,26,10];for(var R=0;R<8;R++)if(r[R]!=y[R])throw"The input is not a PNG file!";for(;d<r.length;){const A=g.readUint(r,d);d+=4;const f=g.readASCII(r,d,4);if(d+=4,f=="IHDR")x(r,d,S);else if(f=="iCCP"){for(var h=d;r[h]!=0;)h++;g.readASCII(r,d,h-d),r[h+1];const o=r.slice(h+2,d+A);let N=null;try{N=l(o)}catch{N=e(o)}S.tabs[f]=N}else if(f=="CgBI")S.tabs[f]=r.slice(d,d+4);else if(f=="IDAT"){for(R=0;R<A;R++)B[E+R]=r[d+R];E+=A}else if(f=="acTL")S.tabs[f]={num_frames:k(r,d),num_plays:k(r,d+4)},M=new Uint8Array(r.length);else if(f=="fcTL"){P!=0&&((b=S.frames[S.frames.length-1]).data=D(S,M.slice(0,P),b.rect.width,b.rect.height),P=0);const o={x:k(r,d+12),y:k(r,d+16),width:k(r,d+4),height:k(r,d+8)};let N=I(r,d+22);N=I(r,d+20)/(N==0?100:N);const F={rect:o,delay:Math.round(1e3*N),dispose:r[d+24],blend:r[d+25]};S.frames.push(F)}else if(f=="fdAT"){for(R=0;R<A-4;R++)M[P+R]=r[d+R+4];P+=A-4}else if(f=="pHYs")S.tabs[f]=[g.readUint(r,d),g.readUint(r,d+4),r[d+8]];else if(f=="cHRM")for(S.tabs[f]=[],R=0;R<8;R++)S.tabs[f].push(g.readUint(r,d+4*R));else if(f=="tEXt"||f=="zTXt"){S.tabs[f]==null&&(S.tabs[f]={});var u=g.nextZero(r,d),p=g.readASCII(r,d,u-d),j=d+A-u-1;if(f=="tEXt")C=g.readASCII(r,u+1,j);else{var w=l(r.slice(u+2,u+2+j));C=g.readUTF8(w,0,w.length)}S.tabs[f][p]=C}else if(f=="iTXt"){S.tabs[f]==null&&(S.tabs[f]={}),u=0,h=d,u=g.nextZero(r,h),p=g.readASCII(r,h,u-h);const o=r[h=u+1];var C;r[h+1],h+=2,u=g.nextZero(r,h),g.readASCII(r,h,u-h),h=u+1,u=g.nextZero(r,h),g.readUTF8(r,h,u-h),j=A-((h=u+1)-d),o==0?C=g.readUTF8(r,h,j):(w=l(r.slice(h,h+j)),C=g.readUTF8(w,0,w.length)),S.tabs[f][p]=C}else if(f=="PLTE")S.tabs[f]=g.readBytes(r,d,A);else if(f=="hIST"){const o=S.tabs.PLTE.length/3;for(S.tabs[f]=[],R=0;R<o;R++)S.tabs[f].push(I(r,d+2*R))}else if(f=="tRNS")S.ctype==3?S.tabs[f]=g.readBytes(r,d,A):S.ctype==0?S.tabs[f]=I(r,d):S.ctype==2&&(S.tabs[f]=[I(r,d),I(r,d+2),I(r,d+4)]);else if(f=="gAMA")S.tabs[f]=g.readUint(r,d)/1e5;else if(f=="sRGB")S.tabs[f]=r[d];else if(f=="bKGD")S.ctype==0||S.ctype==4?S.tabs[f]=[I(r,d)]:S.ctype==2||S.ctype==6?S.tabs[f]=[I(r,d),I(r,d+2),I(r,d+4)]:S.ctype==3&&(S.tabs[f]=r[d]);else if(f=="IEND")break;d+=A,g.readUint(r,d),d+=4}var b;return P!=0&&((b=S.frames[S.frames.length-1]).data=D(S,M.slice(0,P),b.rect.width,b.rect.height)),S.data=D(S,B,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(s){const r=s.width,d=s.height;if(s.tabs.acTL==null)return[T(s.data,r,d,s).buffer];const g=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const I=r*d*4,k=new Uint8Array(I),S=new Uint8Array(I),B=new Uint8Array(I);for(let E=0;E<s.frames.length;E++){const P=s.frames[E],y=P.rect.x,R=P.rect.y,h=P.rect.width,u=P.rect.height,p=T(P.data,h,u,s);if(E!=0)for(var M=0;M<I;M++)B[M]=k[M];if(P.blend==0?v(p,h,u,k,r,d,y,R,0):P.blend==1&&v(p,h,u,k,r,d,y,R,1),g.push(k.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)v(S,h,u,k,r,d,y,R,0);else if(P.dispose==2)for(M=0;M<I;M++)k[M]=B[M]}}return g},_paeth:c,_copyTile:v,_bin:m}}();(function(){const{_copyTile:m}=Be,{_bin:T}=Be,D=Be._paeth;var l={table:function(){const h=new Uint32Array(256);for(let u=0;u<256;u++){let p=u;for(let j=0;j<8;j++)1&p?p=3988292384^p>>>1:p>>>=1;h[u]=p}return h}(),update(h,u,p,j){for(let w=0;w<j;w++)h=l.table[255&(h^u[p+w])]^h>>>8;return h},crc:(h,u,p)=>4294967295^l.update(4294967295,h,u,p)};function e(h,u,p,j){u[p]+=h[0]*j>>4,u[p+1]+=h[1]*j>>4,u[p+2]+=h[2]*j>>4,u[p+3]+=h[3]*j>>4}function t(h){return Math.max(0,Math.min(255,h))}function a(h,u){const p=h[0]-u[0],j=h[1]-u[1],w=h[2]-u[2],C=h[3]-u[3];return p*p+j*j+w*w+C*C}function c(h,u,p,j,w,C,b){b==null&&(b=1);const A=j.length,f=[];for(var o=0;o<A;o++){const _=j[o];f.push([_>>>0&255,_>>>8&255,_>>>16&255,_>>>24&255])}for(o=0;o<A;o++){let _=4294967295;for(var N=0,F=0;F<A;F++){var O=a(f[o],f[F]);F!=o&&O<_&&(_=O,N=F)}}const $=new Uint32Array(w.buffer),H=new Int16Array(u*p*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<V.length;o++)V[o]=255*((V[o]+.5)/16-.5);for(let _=0;_<p;_++)for(let Y=0;Y<u;Y++){var z;o=4*(_*u+Y),b!=2?z=[t(h[o]+H[o]),t(h[o+1]+H[o+1]),t(h[o+2]+H[o+2]),t(h[o+3]+H[o+3])]:(O=V[4*(3&_)+(3&Y)],z=[t(h[o]+O),t(h[o+1]+O),t(h[o+2]+O),t(h[o+3]+O)]),N=0;let re=16777215;for(F=0;F<A;F++){const ie=a(z,f[F]);ie<re&&(re=ie,N=F)}const te=f[N],X=[z[0]-te[0],z[1]-te[1],z[2]-te[2],z[3]-te[3]];b==1&&(Y!=u-1&&e(X,H,o+4,7),_!=p-1&&(Y!=0&&e(X,H,o+4*u-4,3),e(X,H,o+4*u,5),Y!=u-1&&e(X,H,o+4*u+4,1))),C[o>>2]=N,$[o>>2]=j[N]}}function x(h,u,p,j,w){w==null&&(w={});const{crc:C}=l,b=T.writeUint,A=T.writeUshort,f=T.writeASCII;let o=8;const N=h.frames.length>1;let F,O=!1,$=33+(N?20:0);if(w.sRGB!=null&&($+=13),w.pHYs!=null&&($+=21),w.iCCP!=null&&(F=pako.deflate(w.iCCP),$+=21+F.length+4),h.ctype==3){for(var H=h.plte.length,V=0;V<H;V++)h.plte[V]>>>24!=255&&(O=!0);$+=8+3*H+4+(O?8+1*H+4:0)}for(var z=0;z<h.frames.length;z++)N&&($+=38),$+=(te=h.frames[z]).cimg.length+12,z!=0&&($+=4);$+=12;const _=new Uint8Array($),Y=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)_[V]=Y[V];if(b(_,o,13),o+=4,f(_,o,"IHDR"),o+=4,b(_,o,u),o+=4,b(_,o,p),o+=4,_[o]=h.depth,o++,_[o]=h.ctype,o++,_[o]=0,o++,_[o]=0,o++,_[o]=0,o++,b(_,o,C(_,o-17,17)),o+=4,w.sRGB!=null&&(b(_,o,1),o+=4,f(_,o,"sRGB"),o+=4,_[o]=w.sRGB,o++,b(_,o,C(_,o-5,5)),o+=4),w.iCCP!=null){const X=13+F.length;b(_,o,X),o+=4,f(_,o,"iCCP"),o+=4,f(_,o,"ICC profile"),o+=11,o+=2,_.set(F,o),o+=F.length,b(_,o,C(_,o-(X+4),X+4)),o+=4}if(w.pHYs!=null&&(b(_,o,9),o+=4,f(_,o,"pHYs"),o+=4,b(_,o,w.pHYs[0]),o+=4,b(_,o,w.pHYs[1]),o+=4,_[o]=w.pHYs[2],o++,b(_,o,C(_,o-13,13)),o+=4),N&&(b(_,o,8),o+=4,f(_,o,"acTL"),o+=4,b(_,o,h.frames.length),o+=4,b(_,o,w.loop!=null?w.loop:0),o+=4,b(_,o,C(_,o-12,12)),o+=4),h.ctype==3){for(b(_,o,3*(H=h.plte.length)),o+=4,f(_,o,"PLTE"),o+=4,V=0;V<H;V++){const X=3*V,ie=h.plte[V],ee=255&ie,ce=ie>>>8&255,Re=ie>>>16&255;_[o+X+0]=ee,_[o+X+1]=ce,_[o+X+2]=Re}if(o+=3*H,b(_,o,C(_,o-3*H-4,3*H+4)),o+=4,O){for(b(_,o,H),o+=4,f(_,o,"tRNS"),o+=4,V=0;V<H;V++)_[o+V]=h.plte[V]>>>24&255;o+=H,b(_,o,C(_,o-H-4,H+4)),o+=4}}let re=0;for(z=0;z<h.frames.length;z++){var te=h.frames[z];N&&(b(_,o,26),o+=4,f(_,o,"fcTL"),o+=4,b(_,o,re++),o+=4,b(_,o,te.rect.width),o+=4,b(_,o,te.rect.height),o+=4,b(_,o,te.rect.x),o+=4,b(_,o,te.rect.y),o+=4,A(_,o,j[z]),o+=2,A(_,o,1e3),o+=2,_[o]=te.dispose,o++,_[o]=te.blend,o++,b(_,o,C(_,o-30,30)),o+=4);const X=te.cimg;b(_,o,(H=X.length)+(z==0?0:4)),o+=4;const ie=o;f(_,o,z==0?"IDAT":"fdAT"),o+=4,z!=0&&(b(_,o,re++),o+=4),_.set(X,o),o+=H,b(_,o,C(_,ie,o-ie)),o+=4}return b(_,o,0),o+=4,f(_,o,"IEND"),o+=4,b(_,o,C(_,o-4,4)),o+=4,_.buffer}function v(h,u,p){for(let j=0;j<h.frames.length;j++){const w=h.frames[j];w.rect.width;const C=w.rect.height,b=new Uint8Array(C*w.bpl+C);w.cimg=d(w.img,C,w.bpp,w.bpl,b,u,p)}}function n(h,u,p,j,w){const C=w[0],b=w[1],A=w[2],f=w[3],o=w[4],N=w[5];let F=6,O=8,$=255;for(var H=0;H<h.length;H++){const pe=new Uint8Array(h[H]);for(var V=pe.length,z=0;z<V;z+=4)$&=pe[z+3]}const _=$!=255,Y=function(fe,ae,ge,be,he,Ie){const oe=[];for(var de=0;de<fe.length;de++){const we=new Uint8Array(fe[de]),ne=new Uint32Array(we.buffer);var ve;let ke=0,se=0,Fe=ae,ye=ge,jt=be?1:0;if(de!=0){const Yt=Ie||be||de==1||oe[de-2].dispose!=0?1:2;let wt=0,Mt=1e9;for(let Je=0;Je<Yt;Je++){var Le=new Uint8Array(fe[de-1-Je]);const Kt=new Uint32Array(fe[de-1-Je]);let qe=ae,Me=ge,Ne=-1,et=-1;for(let $e=0;$e<ge;$e++)for(let He=0;He<ae;He++)ne[xe=$e*ae+He]!=Kt[xe]&&(He<qe&&(qe=He),He>Ne&&(Ne=He),$e<Me&&(Me=$e),$e>et&&(et=$e));Ne==-1&&(qe=Me=Ne=et=0),he&&((1&qe)==1&&qe--,(1&Me)==1&&Me--);const Nt=(Ne-qe+1)*(et-Me+1);Nt<Mt&&(Mt=Nt,wt=Je,ke=qe,se=Me,Fe=Ne-qe+1,ye=et-Me+1)}Le=new Uint8Array(fe[de-1-wt]),wt==1&&(oe[de-1].dispose=2),ve=new Uint8Array(Fe*ye*4),m(Le,ae,ge,ve,Fe,ye,-ke,-se,0),jt=m(we,ae,ge,ve,Fe,ye,-ke,-se,3)?1:0,jt==1?r(we,ae,ge,ve,{x:ke,y:se,width:Fe,height:ye}):m(we,ae,ge,ve,Fe,ye,-ke,-se,0)}else ve=we.slice(0);oe.push({rect:{x:ke,y:se,width:Fe,height:ye},img:ve,blend:jt,dispose:0})}if(be)for(de=0;de<oe.length;de++){if((le=oe[de]).blend==1)continue;const we=le.rect,ne=oe[de-1].rect,ke=Math.min(we.x,ne.x),se=Math.min(we.y,ne.y),Fe={x:ke,y:se,width:Math.max(we.x+we.width,ne.x+ne.width)-ke,height:Math.max(we.y+we.height,ne.y+ne.height)-se};oe[de-1].dispose=1,de-1!=0&&s(fe,ae,ge,oe,de-1,Fe,he),s(fe,ae,ge,oe,de,Fe,he)}let Ge=0;if(fe.length!=1)for(var xe=0;xe<oe.length;xe++){var le;Ge+=(le=oe[xe]).rect.width*le.rect.height}return oe}(h,u,p,C,b,A),re={},te=[],X=[];if(j!=0){const pe=[];for(z=0;z<Y.length;z++)pe.push(Y[z].img.buffer);const fe=function(he){let Ie=0;for(var oe=0;oe<he.length;oe++)Ie+=he[oe].byteLength;const de=new Uint8Array(Ie);let ve=0;for(oe=0;oe<he.length;oe++){const Le=new Uint8Array(he[oe]),Ge=Le.length;for(let xe=0;xe<Ge;xe+=4){let le=Le[xe],we=Le[xe+1],ne=Le[xe+2];const ke=Le[xe+3];ke==0&&(le=we=ne=0),de[ve+xe]=le,de[ve+xe+1]=we,de[ve+xe+2]=ne,de[ve+xe+3]=ke}ve+=Ge}return de.buffer}(pe),ae=I(fe,j);for(z=0;z<ae.plte.length;z++)te.push(ae.plte[z].est.rgba);let ge=0;for(z=0;z<Y.length;z++){const be=(ee=Y[z]).img.length;var ie=new Uint8Array(ae.inds.buffer,ge>>2,be>>2);X.push(ie);const he=new Uint8Array(ae.abuf,ge,be);N&&c(ee.img,ee.rect.width,ee.rect.height,te,he,ie),ee.img.set(he),ge+=be}}else for(H=0;H<Y.length;H++){var ee=Y[H];const pe=new Uint32Array(ee.img.buffer);var ce=ee.rect.width;for(V=pe.length,ie=new Uint8Array(V),X.push(ie),z=0;z<V;z++){const fe=pe[z];if(z!=0&&fe==pe[z-1])ie[z]=ie[z-1];else if(z>ce&&fe==pe[z-ce])ie[z]=ie[z-ce];else{let ae=re[fe];if(ae==null&&(re[fe]=ae=te.length,te.push(fe),te.length>=300))break;ie[z]=ae}}}const Re=te.length;for(Re<=256&&o==0&&(O=Re<=2?1:Re<=4?2:Re<=16?4:8,O=Math.max(O,f)),H=0;H<Y.length;H++){(ee=Y[H]).rect.x,ee.rect.y,ce=ee.rect.width;const pe=ee.rect.height;let fe=ee.img;new Uint32Array(fe.buffer);let ae=4*ce,ge=4;if(Re<=256&&o==0){ae=Math.ceil(O*ce/8);var Te=new Uint8Array(ae*pe);const be=X[H];for(let he=0;he<pe;he++){z=he*ae;const Ie=he*ce;if(O==8)for(var ue=0;ue<ce;ue++)Te[z+ue]=be[Ie+ue];else if(O==4)for(ue=0;ue<ce;ue++)Te[z+(ue>>1)]|=be[Ie+ue]<<4-4*(1&ue);else if(O==2)for(ue=0;ue<ce;ue++)Te[z+(ue>>2)]|=be[Ie+ue]<<6-2*(3&ue);else if(O==1)for(ue=0;ue<ce;ue++)Te[z+(ue>>3)]|=be[Ie+ue]<<7-1*(7&ue)}fe=Te,F=3,ge=1}else if(_==0&&Y.length==1){Te=new Uint8Array(ce*pe*3);const be=ce*pe;for(z=0;z<be;z++){const he=3*z,Ie=4*z;Te[he]=fe[Ie],Te[he+1]=fe[Ie+1],Te[he+2]=fe[Ie+2]}fe=Te,F=2,ge=3,ae=3*ce}ee.img=fe,ee.bpl=ae,ee.bpp=ge}return{ctype:F,depth:O,plte:te,frames:Y}}function s(h,u,p,j,w,C,b){const A=Uint8Array,f=Uint32Array,o=new A(h[w-1]),N=new f(h[w-1]),F=w+1<h.length?new A(h[w+1]):null,O=new A(h[w]),$=new f(O.buffer);let H=u,V=p,z=-1,_=-1;for(let re=0;re<C.height;re++)for(let te=0;te<C.width;te++){const X=C.x+te,ie=C.y+re,ee=ie*u+X,ce=$[ee];ce==0||j[w-1].dispose==0&&N[ee]==ce&&(F==null||F[4*ee+3]!=0)||(X<H&&(H=X),X>z&&(z=X),ie<V&&(V=ie),ie>_&&(_=ie))}z==-1&&(H=V=z=_=0),b&&((1&H)==1&&H--,(1&V)==1&&V--),C={x:H,y:V,width:z-H+1,height:_-V+1};const Y=j[w];Y.rect=C,Y.blend=1,Y.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(m(o,u,p,Y.img,C.width,C.height,-C.x,-C.y,0),r(O,u,p,Y.img,C)):m(O,u,p,Y.img,C.width,C.height,-C.x,-C.y,0)}function r(h,u,p,j,w){m(h,u,p,j,w.width,w.height,-w.x,-w.y,2)}function d(h,u,p,j,w,C,b){const A=[];let f,o=[0,1,2,3,4];C!=-1?o=[C]:(u*j>5e5||p==1)&&(o=[0]),b&&(f={level:0});const N=Xr;for(var F=0;F<o.length;F++){for(let H=0;H<u;H++)g(w,h,H,j,p,o[F]);A.push(N.deflate(w,f))}let O,$=1e9;for(F=0;F<A.length;F++)A[F].length<$&&(O=F,$=A[F].length);return A[O]}function g(h,u,p,j,w,C){const b=p*j;let A=b+p;if(h[A]=C,A++,C==0)if(j<500)for(var f=0;f<j;f++)h[A+f]=u[b+f];else h.set(new Uint8Array(u.buffer,b,j),A);else if(C==1){for(f=0;f<w;f++)h[A+f]=u[b+f];for(f=w;f<j;f++)h[A+f]=u[b+f]-u[b+f-w]+256&255}else if(p==0){for(f=0;f<w;f++)h[A+f]=u[b+f];if(C==2)for(f=w;f<j;f++)h[A+f]=u[b+f];if(C==3)for(f=w;f<j;f++)h[A+f]=u[b+f]-(u[b+f-w]>>1)+256&255;if(C==4)for(f=w;f<j;f++)h[A+f]=u[b+f]-D(u[b+f-w],0,0)+256&255}else{if(C==2)for(f=0;f<j;f++)h[A+f]=u[b+f]+256-u[b+f-j]&255;if(C==3){for(f=0;f<w;f++)h[A+f]=u[b+f]+256-(u[b+f-j]>>1)&255;for(f=w;f<j;f++)h[A+f]=u[b+f]+256-(u[b+f-j]+u[b+f-w]>>1)&255}if(C==4){for(f=0;f<w;f++)h[A+f]=u[b+f]+256-D(0,u[b+f-j],0)&255;for(f=w;f<j;f++)h[A+f]=u[b+f]+256-D(u[b+f-w],u[b+f-j],u[b+f-w-j])&255}}}function I(h,u){const p=new Uint8Array(h),j=p.slice(0),w=new Uint32Array(j.buffer),C=k(j,u),b=C[0],A=C[1],f=p.length,o=new Uint8Array(f>>2);let N;if(p.length<2e7)for(var F=0;F<f;F+=4)N=S(b,O=p[F]*(1/255),$=p[F+1]*(1/255),H=p[F+2]*(1/255),V=p[F+3]*(1/255)),o[F>>2]=N.ind,w[F>>2]=N.est.rgba;else for(F=0;F<f;F+=4){var O=p[F]*.00392156862745098,$=p[F+1]*(1/255),H=p[F+2]*(1/255),V=p[F+3]*(1/255);for(N=b;N.left;)N=B(N.est,O,$,H,V)<=0?N.left:N.right;o[F>>2]=N.ind,w[F>>2]=N.est.rgba}return{abuf:j.buffer,inds:o,plte:A}}function k(h,u,p){p==null&&(p=1e-4);const j=new Uint32Array(h.buffer),w={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=P(h,w.i0,w.i1),w.est=y(w.bst);const C=[w];for(;C.length<u;){let A=0,f=0;for(var b=0;b<C.length;b++)C[b].est.L>A&&(A=C[b].est.L,f=b);if(A<p)break;const o=C[f],N=M(h,j,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=N||o.i1<=N){o.est.L=0;continue}const F={i0:o.i0,i1:N,bst:null,est:null,tdst:0,left:null,right:null};F.bst=P(h,F.i0,F.i1),F.est=y(F.bst);const O={i0:N,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(O.bst={R:[],m:[],N:o.bst.N-F.bst.N},b=0;b<16;b++)O.bst.R[b]=o.bst.R[b]-F.bst.R[b];for(b=0;b<4;b++)O.bst.m[b]=o.bst.m[b]-F.bst.m[b];O.est=y(O.bst),o.left=F,o.right=O,C[f]=F,C.push(O)}for(C.sort((A,f)=>f.bst.N-A.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[w,C]}function S(h,u,p,j,w){if(h.left==null)return h.tdst=function(F,O,$,H,V){const z=O-F[0],_=$-F[1],Y=H-F[2],re=V-F[3];return z*z+_*_+Y*Y+re*re}(h.est.q,u,p,j,w),h;const C=B(h.est,u,p,j,w);let b=h.left,A=h.right;C>0&&(b=h.right,A=h.left);const f=S(b,u,p,j,w);if(f.tdst<=C*C)return f;const o=S(A,u,p,j,w);return o.tdst<f.tdst?o:f}function B(h,u,p,j,w){const{e:C}=h;return C[0]*u+C[1]*p+C[2]*j+C[3]*w-h.eMq}function M(h,u,p,j,w,C){for(j-=4;p<j;){for(;E(h,p,w)<=C;)p+=4;for(;E(h,j,w)>C;)j-=4;if(p>=j)break;const b=u[p>>2];u[p>>2]=u[j>>2],u[j>>2]=b,p+=4,j-=4}for(;E(h,p,w)>C;)p-=4;return p+4}function E(h,u,p){return h[u]*p[0]+h[u+1]*p[1]+h[u+2]*p[2]+h[u+3]*p[3]}function P(h,u,p){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=p-u>>2;for(let b=u;b<p;b+=4){const A=h[b]*.00392156862745098,f=h[b+1]*(1/255),o=h[b+2]*(1/255),N=h[b+3]*(1/255);w[0]+=A,w[1]+=f,w[2]+=o,w[3]+=N,j[0]+=A*A,j[1]+=A*f,j[2]+=A*o,j[3]+=A*N,j[5]+=f*f,j[6]+=f*o,j[7]+=f*N,j[10]+=o*o,j[11]+=o*N,j[15]+=N*N}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function y(h){const{R:u}=h,{m:p}=h,{N:j}=h,w=p[0],C=p[1],b=p[2],A=p[3],f=j==0?0:1/j,o=[u[0]-w*w*f,u[1]-w*C*f,u[2]-w*b*f,u[3]-w*A*f,u[4]-C*w*f,u[5]-C*C*f,u[6]-C*b*f,u[7]-C*A*f,u[8]-b*w*f,u[9]-b*C*f,u[10]-b*b*f,u[11]-b*A*f,u[12]-A*w*f,u[13]-A*C*f,u[14]-A*b*f,u[15]-A*A*f],N=o,F=R;let O=[Math.random(),Math.random(),Math.random(),Math.random()],$=0,H=0;if(j!=0)for(let z=0;z<16&&(O=F.multVec(N,O),H=Math.sqrt(F.dot(O,O)),O=F.sml(1/H,O),!(z!=0&&Math.abs(H-$)<1e-9));z++)$=H;const V=[w*f,C*f,b*f,A*f];return{Cov:o,q:V,e:O,L:$,eMq255:F.dot(F.sml(255,V),O),eMq:F.dot(O,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var R={multVec:(h,u)=>[h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],h[4]*u[0]+h[5]*u[1]+h[6]*u[2]+h[7]*u[3],h[8]*u[0]+h[9]*u[1]+h[10]*u[2]+h[11]*u[3],h[12]*u[0]+h[13]*u[1]+h[14]*u[2]+h[15]*u[3]],dot:(h,u)=>h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],sml:(h,u)=>[h*u[0],h*u[1],h*u[2],h*u[3]]};Be.encode=function(u,p,j,w,C,b,A){w==null&&(w=0),A==null&&(A=!1);const f=n(u,p,j,w,[!1,!1,!1,0,A,!1]);return v(f,-1),x(f,p,j,C,b)},Be.encodeLL=function(u,p,j,w,C,b,A,f){const o={ctype:0+(w==1?0:2)+(C==0?0:4),depth:b,frames:[]},N=(w+C)*b,F=N*p;for(let O=0;O<u.length;O++)o.frames.push({rect:{x:0,y:0,width:p,height:j},img:new Uint8Array(u[O]),blend:0,dispose:1,bpp:Math.ceil(N/8),bpl:Math.ceil(F/8)});return v(o,0,!0),x(o,p,j,A,f)},Be.encode.compress=n,Be.encode.dither=c,Be.quantize=I,Be.quantize.getKDtree=k,Be.quantize.getNearest=S})();const ar={toArrayBuffer(m,T){const D=m.width,l=m.height,e=D<<2,t=m.getContext("2d").getImageData(0,0,D,l),a=new Uint32Array(t.data.buffer),c=(32*D+31)/32<<2,x=c*l,v=122+x,n=new ArrayBuffer(v),s=new DataView(n),r=1<<20;let d,g,I,k,S=r,B=0,M=0,E=0;function P(h){s.setUint16(M,h,!0),M+=2}function y(h){s.setUint32(M,h,!0),M+=4}function R(h){M+=h}P(19778),y(v),R(4),y(122),y(108),y(D),y(-l>>>0),P(1),P(32),y(3),y(x),y(2835),y(2835),R(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),function h(){for(;B<l&&S>0;){for(k=122+B*c,d=0;d<e;)S--,g=a[E++],I=g>>>24,s.setUint32(k+d,g<<8|I),d+=4;B++}E<a.length?(S=r,setTimeout(h,ar._dly)):T(n)}()},toBlob(m,T){this.toArrayBuffer(m,D=>{T(new Blob([D],{type:"image/bmp"}))})},_dly:9};var _e={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Jr={[_e.CHROME]:16384,[_e.FIREFOX]:11180,[_e.DESKTOP_SAFARI]:16384,[_e.IE]:8192,[_e.IOS]:4096,[_e.ETC]:8192};const An=typeof window<"u",or=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Qt=An&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),es=(An||or)&&(Qt&&Qt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),lr=(An||or)&&(Qt&&Qt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Tn(m,T,D=Date.now()){return new Promise(l=>{const e=m.split(","),t=e[0].match(/:(.*?);/)[1],a=globalThis.atob(e[1]);let c=a.length;const x=new Uint8Array(c);for(;c--;)x[c]=a.charCodeAt(c);const v=new Blob([x],{type:t});v.name=T,v.lastModified=D,l(v)})}function dr(m){return new Promise((T,D)=>{const l=new lr;l.onload=()=>T(l.result),l.onerror=e=>D(e),l.readAsDataURL(m)})}function cr(m){return new Promise((T,D)=>{const l=new Image;l.onload=()=>T(l),l.onerror=e=>D(e),l.src=m})}function nt(){if(nt.cachedResult!==void 0)return nt.cachedResult;let m=_e.ETC;const{userAgent:T}=navigator;return/Chrom(e|ium)/i.test(T)?m=_e.CHROME:/iP(ad|od|hone)/i.test(T)&&/WebKit/i.test(T)?m=_e.IOS:/Safari/i.test(T)?m=_e.DESKTOP_SAFARI:/Firefox/i.test(T)?m=_e.FIREFOX:(/MSIE/i.test(T)||document.documentMode)&&(m=_e.IE),nt.cachedResult=m,nt.cachedResult}function ur(m,T){const D=nt(),l=Jr[D];let e=m,t=T,a=e*t;const c=e>t?t/e:e/t;for(;a>l*l;){const x=(l+e)/2,v=(l+t)/2;x<v?(t=v,e=v*c):(t=x*c,e=x),a=e*t}return{width:e,height:t}}function Zt(m,T){let D,l;try{if(D=new OffscreenCanvas(m,T),l=D.getContext("2d"),l===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{D=document.createElement("canvas"),l=D.getContext("2d")}return D.width=m,D.height=T,[D,l]}function fr(m,T){const{width:D,height:l}=ur(m.width,m.height),[e,t]=Zt(D,l);return T&&/jpe?g/.test(T)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(m,0,0,e.width,e.height),e}function qt(){return qt.cachedResult!==void 0||(qt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),qt.cachedResult}function Vt(m,T={}){return new Promise(function(D,l){let e,t;var a=function(){try{return t=fr(e,T.fileType||m.type),D([e,t])}catch(x){return l(x)}},c=function(x){try{var v=function(n){try{throw n}catch(s){return l(s)}};try{let n;return dr(m).then(function(s){try{return n=s,cr(n).then(function(r){try{return e=r,function(){try{return a()}catch(d){return l(d)}}()}catch(d){return v(d)}},v)}catch(r){return v(r)}},v)}catch(n){v(n)}}catch(n){return l(n)}};try{if(qt()||[_e.DESKTOP_SAFARI,_e.MOBILE_SAFARI].includes(nt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(m).then(function(x){try{return e=x,a()}catch{return c()}},c)}catch{c()}})}function Gt(m,T,D,l,e=1){return new Promise(function(t,a){let c;if(T==="image/png"){let v,n,s;return v=m.getContext("2d"),{data:n}=v.getImageData(0,0,m.width,m.height),s=Be.encode([n.buffer],m.width,m.height,4096*e),c=new Blob([s],{type:T}),c.name=D,c.lastModified=l,x.call(this)}{let v=function(){return x.call(this)};if(T==="image/bmp")return new Promise(n=>ar.toBlob(m,n)).then((function(n){try{return c=n,c.name=D,c.lastModified=l,v.call(this)}catch(s){return a(s)}}).bind(this),a);{let n=function(){return v.call(this)};if(typeof OffscreenCanvas=="function"&&m instanceof OffscreenCanvas)return m.convertToBlob({type:T,quality:e}).then((function(s){try{return c=s,c.name=D,c.lastModified=l,n.call(this)}catch(r){return a(r)}}).bind(this),a);{let s;return s=m.toDataURL(T,e),Tn(s,D,l).then((function(r){try{return c=r,n.call(this)}catch(d){return a(d)}}).bind(this),a)}}}function x(){return t(c)}})}function ze(m){m.width=0,m.height=0}function gt(){return new Promise(function(m,T){let D,l,e,t;return gt.cachedResult!==void 0?m(gt.cachedResult):Tn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return D=a,Vt(D).then(function(c){try{return l=c[1],Gt(l,D.type,D.name,D.lastModified).then(function(x){try{return e=x,ze(l),Vt(e).then(function(v){try{return t=v[0],gt.cachedResult=t.width===1&&t.height===2,m(gt.cachedResult)}catch(n){return T(n)}},T)}catch(v){return T(v)}},T)}catch(x){return T(x)}},T)}catch(c){return T(c)}},T)})}function hr(m){return new Promise((T,D)=>{const l=new lr;l.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return T(-2);const a=t.byteLength;let c=2;for(;c<a;){if(t.getUint16(c+2,!1)<=8)return T(-1);const x=t.getUint16(c,!1);if(c+=2,x==65505){if(t.getUint32(c+=2,!1)!=1165519206)return T(-1);const v=t.getUint16(c+=6,!1)==18761;c+=t.getUint32(c+4,v);const n=t.getUint16(c,v);c+=2;for(let s=0;s<n;s++)if(t.getUint16(c+12*s,v)==274)return T(t.getUint16(c+12*s+8,v))}else{if((65280&x)!=65280)break;c+=t.getUint16(c,!1)}}return T(-1)},l.onerror=e=>D(e),l.readAsArrayBuffer(m)})}function gr(m,T){const{width:D}=m,{height:l}=m,{maxWidthOrHeight:e}=T;let t,a=m;return isFinite(e)&&(D>e||l>e)&&([a,t]=Zt(D,l),D>l?(a.width=e,a.height=l/D*e):(a.width=D/l*e,a.height=e),t.drawImage(m,0,0,a.width,a.height),ze(m)),a}function mr(m,T){const{width:D}=m,{height:l}=m,[e,t]=Zt(D,l);switch(T>4&&T<9?(e.width=l,e.height=D):(e.width=D,e.height=l),T){case 2:t.transform(-1,0,0,1,D,0);break;case 3:t.transform(-1,0,0,-1,D,l);break;case 4:t.transform(1,0,0,-1,0,l);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,l,0);break;case 7:t.transform(0,-1,-1,0,l,D);break;case 8:t.transform(0,-1,1,0,0,D)}return t.drawImage(m,0,0,D,l),ze(m),e}function _n(m,T,D=0){return new Promise(function(l,e){let t,a,c,x,v,n,s,r,d,g,I,k,S,B,M,E,P,y,R,h;function u(j=5){if(T.signal&&T.signal.aborted)throw T.signal.reason;t+=j,T.onProgress(Math.min(t,100))}function p(j){if(T.signal&&T.signal.aborted)throw T.signal.reason;t=Math.min(Math.max(j,t),100),T.onProgress(t)}return t=D,a=T.maxIteration||10,c=1024*T.maxSizeMB*1024,u(),Vt(m,T).then((function(j){try{return[,x]=j,u(),v=gr(x,T),u(),new Promise(function(w,C){var b;if(!(b=T.exifOrientation))return hr(m).then((function(f){try{return b=f,A.call(this)}catch(o){return C(o)}}).bind(this),C);function A(){return w(b)}return A.call(this)}).then((function(w){try{return n=w,u(),gt().then((function(C){try{return s=C?v:mr(v,n),u(),r=T.initialQuality||1,d=T.fileType||m.type,Gt(s,d,m.name,m.lastModified,r).then((function(b){try{{let f=function(){if(a--&&(M>c||M>S)){let N,F;return N=h?.95*R.width:R.width,F=h?.95*R.height:R.height,[P,y]=Zt(N,F),y.drawImage(R,0,0,N,F),r*=d==="image/png"?.85:.95,Gt(P,d,m.name,m.lastModified,r).then(function(O){try{return E=O,ze(R),R=P,M=E.size,p(Math.min(99,Math.floor((B-M)/(B-c)*100))),f}catch($){return e($)}},e)}return[1]},o=function(){return ze(R),ze(P),ze(v),ze(s),ze(x),p(100),l(E)};if(g=b,u(),I=g.size>c,k=g.size>m.size,!I&&!k)return p(100),l(g);var A;return S=m.size,B=g.size,M=B,R=s,h=!T.alwaysKeepResolution&&I,(A=(function(N){for(;N;){if(N.then)return void N.then(A,e);try{if(N.pop){if(N.length)return N.pop()?o.call(this):N;N=f}else N=N.call(this)}catch(F){return e(F)}}}).bind(this))(f)}}catch(f){return e(f)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const ts=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let an;function ns(m,T){return new Promise((D,l)=>{an||(an=function(a){const c=[];return c.push(a),URL.createObjectURL(new Blob(c))}(ts));const e=new Worker(an);e.addEventListener("message",function(a){if(T.signal&&T.signal.aborted)e.terminate();else if(a.data.progress===void 0){if(a.data.error)return l(new Error(a.data.error)),void e.terminate();D(a.data.file),e.terminate()}else T.onProgress(a.data.progress)}),e.addEventListener("error",l),T.signal&&T.signal.addEventListener("abort",()=>{l(T.signal.reason),e.terminate()}),e.postMessage({file:m,imageCompressionLibUrl:T.libURL,options:{...T,onProgress:void 0,signal:void 0}})})}function Ae(m,T){return new Promise(function(D,l){let e,t,a,c,x,v;if(e={...T},a=0,{onProgress:c}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=d=>{a=d,typeof c=="function"&&c(a)},!(m instanceof Blob||m instanceof es))return l(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(m.type))return l(new Error("The file given is not an image"));if(v=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||v)return _n(m,e).then((function(d){try{return t=d,r.call(this)}catch(g){return l(g)}}).bind(this),l);var n=(function(){try{return r.call(this)}catch(d){return l(d)}}).bind(this),s=function(d){try{return _n(m,e).then(function(g){try{return t=g,n()}catch(I){return l(I)}},l)}catch(g){return l(g)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",ns(m,e).then(function(d){try{return t=d,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=m.name,t.lastModified=m.lastModified}catch{}try{e.preserveExif&&m.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===m.type)&&(t=ir(m,t))}catch{}return D(t)}})}Ae.getDataUrlFromFile=dr,Ae.getFilefromDataUrl=Tn,Ae.loadImage=cr,Ae.drawImageInCanvas=fr,Ae.drawFileInCanvas=Vt,Ae.canvasToFile=Gt,Ae.getExifOrientation=hr,Ae.handleMaxWidthOrHeight=gr,Ae.followExifOrientation=mr,Ae.cleanupCanvasMemory=ze,Ae.isAutoOrientationInBrowser=gt,Ae.approximateBelowMaximumCanvasSizeOfBrowser=ur,Ae.copyExifWithoutOrientation=ir,Ae.getBrowserName=nt,Ae.version="2.0.2";var on,Rn;function pr(){if(Rn)return on;Rn=1;function m(T){var D=typeof T;return T!=null&&(D=="object"||D=="function")}return on=m,on}var ln,On;function rs(){if(On)return ln;On=1;var m=typeof Pt=="object"&&Pt&&Pt.Object===Object&&Pt;return ln=m,ln}var dn,Mn;function br(){if(Mn)return dn;Mn=1;var m=rs(),T=typeof self=="object"&&self&&self.Object===Object&&self,D=m||T||Function("return this")();return dn=D,dn}var cn,Nn;function ss(){if(Nn)return cn;Nn=1;var m=br(),T=function(){return m.Date.now()};return cn=T,cn}var un,Bn;function is(){if(Bn)return un;Bn=1;var m=/\s/;function T(D){for(var l=D.length;l--&&m.test(D.charAt(l)););return l}return un=T,un}var fn,Pn;function as(){if(Pn)return fn;Pn=1;var m=is(),T=/^\s+/;function D(l){return l&&l.slice(0,m(l)+1).replace(T,"")}return fn=D,fn}var hn,Ln;function vr(){if(Ln)return hn;Ln=1;var m=br(),T=m.Symbol;return hn=T,hn}var gn,qn;function os(){if(qn)return gn;qn=1;var m=vr(),T=Object.prototype,D=T.hasOwnProperty,l=T.toString,e=m?m.toStringTag:void 0;function t(a){var c=D.call(a,e),x=a[e];try{a[e]=void 0;var v=!0}catch{}var n=l.call(a);return v&&(c?a[e]=x:delete a[e]),n}return gn=t,gn}var mn,Hn;function ls(){if(Hn)return mn;Hn=1;var m=Object.prototype,T=m.toString;function D(l){return T.call(l)}return mn=D,mn}var pn,zn;function ds(){if(zn)return pn;zn=1;var m=vr(),T=os(),D=ls(),l="[object Null]",e="[object Undefined]",t=m?m.toStringTag:void 0;function a(c){return c==null?c===void 0?e:l:t&&t in Object(c)?T(c):D(c)}return pn=a,pn}var bn,Wn;function cs(){if(Wn)return bn;Wn=1;function m(T){return T!=null&&typeof T=="object"}return bn=m,bn}var vn,$n;function us(){if($n)return vn;$n=1;var m=ds(),T=cs(),D="[object Symbol]";function l(e){return typeof e=="symbol"||T(e)&&m(e)==D}return vn=l,vn}var xn,Qn;function fs(){if(Qn)return xn;Qn=1;var m=as(),T=pr(),D=us(),l=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,a=/^0o[0-7]+$/i,c=parseInt;function x(v){if(typeof v=="number")return v;if(D(v))return l;if(T(v)){var n=typeof v.valueOf=="function"?v.valueOf():v;v=T(n)?n+"":n}if(typeof v!="string")return v===0?v:+v;v=m(v);var s=t.test(v);return s||a.test(v)?c(v.slice(2),s?2:8):e.test(v)?l:+v}return xn=x,xn}var yn,Vn;function hs(){if(Vn)return yn;Vn=1;var m=pr(),T=ss(),D=fs(),l="Expected a function",e=Math.max,t=Math.min;function a(c,x,v){var n,s,r,d,g,I,k=0,S=!1,B=!1,M=!0;if(typeof c!="function")throw new TypeError(l);x=D(x)||0,m(v)&&(S=!!v.leading,B="maxWait"in v,r=B?e(D(v.maxWait)||0,x):r,M="trailing"in v?!!v.trailing:M);function E(C){var b=n,A=s;return n=s=void 0,k=C,d=c.apply(A,b),d}function P(C){return k=C,g=setTimeout(h,x),S?E(C):d}function y(C){var b=C-I,A=C-k,f=x-b;return B?t(f,r-A):f}function R(C){var b=C-I,A=C-k;return I===void 0||b>=x||b<0||B&&A>=r}function h(){var C=T();if(R(C))return u(C);g=setTimeout(h,y(C))}function u(C){return g=void 0,M&&n?E(C):(n=s=void 0,d)}function p(){g!==void 0&&clearTimeout(g),k=0,n=I=s=g=void 0}function j(){return g===void 0?d:u(T())}function w(){var C=T(),b=R(C);if(n=arguments,s=this,I=C,b){if(g===void 0)return P(I);if(B)return clearTimeout(g),g=setTimeout(h,x),E(I)}return g===void 0&&(g=setTimeout(h,x)),d}return w.cancel=p,w.flush=j,w}return yn=a,yn}var gs=hs();const ms=Xe(gs);var St={},Gn;function ps(){if(Gn)return St;Gn=1;var m=at();Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;var T=m(ct()),D=ot();return St.default=(0,T.default)([(0,D.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,D.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),St}var bs=ps();const vs=Xe(bs);var At={},Zn;function xs(){if(Zn)return At;Zn=1;var m=at();Object.defineProperty(At,"__esModule",{value:!0}),At.default=void 0;var T=m(ct()),D=ot();return At.default=(0,T.default)((0,D.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),At}var ys=xs();const js=Xe(ys);var Tt={},Yn;function ws(){if(Yn)return Tt;Yn=1;var m=at();Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=void 0;var T=m(ct()),D=ot();return Tt.default=(0,T.default)((0,D.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Tt}var Cs=ws();const Ss=Xe(Cs);var It={},Kn;function As(){if(Kn)return It;Kn=1;var m=at();Object.defineProperty(It,"__esModule",{value:!0}),It.default=void 0;var T=m(ct()),D=ot();return It.default=(0,T.default)([(0,D.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,D.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),It}var Ts=As();const Is=Xe(Ts),rt=q.forwardRef(({path:m,initialImages:T=[],onImagesUpdated:D,onDelete:l,isOwnDesign:e},t)=>{const[a,c]=q.useState(T.map(o=>({...o,deleted:!1}))),[x,v]=q.useState(!1),[n,s]=q.useState(0),[r,d]=q.useState(!1),[g,I]=q.useState(null),[k,S]=q.useState(1),[B,M]=q.useState(!1),[E,P]=q.useState(!1),[y,R]=q.useState(""),[h,u]=q.useState("info"),p=q.useRef(null);q.useEffect(()=>{console.log("Initial images received:",T),c(T.map(o=>({...o,deleted:!!o.deleted})))},[T]);const j=async o=>{const N=Array.from(o.target.files||[]);v(!0);const F={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},O=N.map(async($,H)=>{let V=$;$.size>1024*1024&&(V=await Ae($,F),R("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),P(!0));const _=`${new Date().getTime()}-${V.name}`,Y=mt(),re=pt(Y,`${m}/${_}`),te=nr(re,V);return new Promise((X,ie)=>{te.on("state_changed",ee=>{const ce=ee.bytesTransferred/ee.totalBytes*100;s(ce)},ee=>{console.error("Upload failed:",ee),ie(ee)},()=>{rr(te.snapshot.ref).then(ee=>{X({url:ee,path:re.fullPath,title:""})})})})});Promise.all(O).then($=>{const H=[...a,...$];c(H),D&&D(H),R("Images uploaded successfully."),u("success"),P(!0),v(!1),s(0),p.current&&(p.current.value="")}).catch($=>{console.error("Error uploading images: ",$),R("Failed to upload images."),u("error"),P(!0),v(!1),s(0)})},w=o=>{c(N=>{const F=N.map((O,$)=>$===o?{...O,deleted:!0}:O);return D(F),F}),R("Image marked for deletion. Update to permanently delete."),u("info"),P(!0)},C=async()=>{const o=a.filter(N=>N.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const N=o.map(F=>{const O=mt(),$=pt(O,F.path);return Lt($)});try{await Promise.all(N),l(o),c(F=>F.filter(O=>!O.deleted)),R("Deleted images have been permanently removed."),u("success")}catch(F){console.error("Error committing deletions:",F),R("Failed to commit deletions."),u("error")}P(!0)}else console.log("No images marked for deletion.")},b=o=>{M(!B),I(o)};q.useEffect(()=>{const o=()=>{const N=!!document.fullscreenElement;M(N)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const A=(o,N)=>{N!=="clickaway"&&P(!1)},f=q.useCallback(ms((o,N)=>{setTimeout(()=>{c(F=>{const O=F.map(($,H)=>H===o?{...$,title:N}:$);return D&&D(O),O})},0)},30),[D]);return q.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Ht,{title:"Upload Images",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(Is,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:x,ref:p,accept:"image/*"})]})}),x&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),a.filter(o=>!o.deleted).map((o,N)=>i.jsxs("div",{children:[i.jsx("img",{src:o.url,alt:`Uploaded design ${N}`,onClick:()=>{d(!0),I(N)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Oe,{onClick:()=>w(N),children:i.jsx(Et,{})}),i.jsx("textarea",{value:o.title,onChange:F=>f(N,F.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},N)),i.jsx(st,{open:r,onClose:()=>d(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:g!==null&&i.jsxs(it,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:a[g].url,alt:`Zoomed Design ${g}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Oe,{onClick:()=>S(k*1.2),children:i.jsx(vs,{})}),i.jsx(Oe,{onClick:()=>S(k/1.2),style:{marginLeft:"10px"},children:i.jsx(js,{})}),i.jsx(Oe,{onClick:()=>b(g),style:{marginLeft:"10px"},children:i.jsx(Ss,{})}),B&&i.jsx(Oe,{onClick:()=>b(g),style:{position:"absolute",top:20,right:20},children:i.jsx($r,{})})]})]})}),i.jsx(lt,{open:E,autoHideDuration:6e3,onClose:A,children:i.jsx(dt,{onClose:A,severity:h,sx:{width:"100%"},children:y})})]})});rt.displayName="ImageUpload";const We=({onChange:m,initialValue:T})=>{const[D,l]=q.useState(sn.sanitize(T||"")),e=q.useRef(!1),t=q.useRef(null),[a,c]=q.useState("");q.useEffect(()=>{e.current?l(sn.sanitize(T||"")):e.current=!0},[T]);const x=(d,g)=>{const I=g.getData(),k=sn.sanitize(I);l(k),m(k)},v=d=>{if(!t.current){console.warn("Editor not initialized");return}const g=t.current;g.model.change(I=>{const k=g.model.document.selection.getFirstPosition();I.insertText(d,k)}),c("")},n=d=>{v(d.target.value)},s=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],r=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return i.jsxs("div",{children:[i.jsxs(tt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[i.jsx(Br,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(En,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(zt,{labelId:"math-operators-label",id:"math-operators",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(ht,{value:"",disabled:!0,children:"Math"}),r.map(d=>i.jsx(ht,{value:d,children:d},d))]})}),i.jsx(En,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(zt,{labelId:"greek-letters-label",id:"greek-letters",value:a,onChange:n,displayEmpty:!0,children:[i.jsx(ht,{value:"",disabled:!0,children:"Greek"}),s.map(d=>i.jsx(ht,{value:d,children:d},d))]})})]}),i.jsx(Qr,{editor:Vr,data:D,onReady:d=>{t.current=d},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"]},onChange:x})]})};var Ft={},Xn;function Fs(){if(Xn)return Ft;Xn=1;var m=at();Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.default=void 0;var T=m(ct()),D=ot();return Ft.default=(0,T.default)((0,D.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Ft}var Us=Fs();const Ds=Xe(Us);var Ut={},Jn;function ks(){if(Jn)return Ut;Jn=1;var m=at();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var T=m(ct()),D=ot();return Ut.default=(0,T.default)((0,D.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Ut}var Es=ks();const _s=Xe(Es),vt=({path:m,initialFiles:T,onFilesChange:D,isOwnDesign:l})=>{const[e,t]=q.useState(T.map(p=>({...p,deleted:!!p.deleted}))),[a,c]=q.useState(!1),[x,v]=q.useState(0),[n,s]=q.useState({}),[r,d]=q.useState(!1),[g,I]=q.useState(""),[k,S]=q.useState("info"),B=q.useRef(null);q.useEffect(()=>{console.log("Initial files received:",T),t(T.map(p=>({...p,deleted:!!p.deleted})))},[T]),q.useEffect(()=>()=>{s({})},[]);const M=p=>{console.log("Updating files with",p),D(p),t(p)},E=async p=>{if(!p.target.files)return;const w=Array.from(p.target.files).filter(b=>b.size>5242880?(I("File size should not exceed 5 MB"),S("error"),d(!0),!1):!0);c(!0);const C=w.map(b=>{const A=new Date().getTime(),f=`${A}-${b.name}`,o=mt(),N=pt(o,`${m}/${f}`),F=nr(N,b);return new Promise((O,$)=>{F.on("state_changed",H=>{const V=H.bytesTransferred/H.totalBytes*100;v(V)},H=>{console.error("Upload failed:",H),$(H)},()=>{rr(F.snapshot.ref).then(H=>{O({id:A.toString(),url:H,name:b.name,path:N.fullPath})})})})});Promise.all(C).then(b=>{const A=[...e.filter(f=>!f.deleted),...b];M(A),I("Files uploaded successfully."),S("success"),d(!0),c(!1),v(0),B.current&&(B.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),I("Failed to upload files."),S("error"),d(!0),c(!1),v(0)})},P=p=>{const j=e.map(w=>w.id===p?{...w,deleted:!0}:w);M(j),I("File marked for deletion. Update to permanently delete."),S("info"),d(!0)},y=p=>{s(j=>{var w;return{...j,[p]:((w=e.find(C=>C.id===p))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},R=p=>{t(j=>{const w=j.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return D(w),w}),s(j=>{const w={...j};return delete w[p],w}),I("File name updated successfully."),S("info"),d(!0)},h=(p,j)=>{s(w=>({...w,[p]:j}))},u=(p,j)=>{j!=="clickaway"&&d(!1)};return i.jsxs("div",{children:[l&&i.jsx(Ht,{title:"Upload Files",children:i.jsxs(Se,{variant:"outlined",component:"label",startIcon:i.jsx(_s,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:E,disabled:a,ref:B})]})}),a&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(x),"%"]})}),i.jsx(Pr,{children:e.map(p=>i.jsxs(Lr,{style:{opacity:p.deleted?.5:1},children:[i.jsx(qr,{children:i.jsx(Ds,{})}),typeof n[p.id]=="string"?i.jsx(Wt,{variant:"outlined",size:"small",value:n[p.id],onChange:j=>h(p.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&R(p.id),fullWidth:!0}):i.jsx(Hr,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),l&&(typeof n[p.id]=="string"?i.jsx(Oe,{onClick:()=>R(p.id),edge:"end","aria-label":"save",children:i.jsx(wn,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{onClick:()=>y(p.id),edge:"end","aria-label":"edit",children:i.jsx(tr,{})}),i.jsx(Oe,{onClick:()=>P(p.id),edge:"end","aria-label":"delete",children:i.jsx(Et,{})})]}))]},p.id))}),i.jsx(lt,{open:r,autoHideDuration:6e3,onClose:u,children:i.jsx(dt,{onClose:u,severity:k,sx:{width:"100%"},children:g})})]})},Rs=({designs:m,setDesigns:T,setIsAdding:D,getDesigns:l,onReturnToDashboard:e})=>{const{userDetails:t}=Ot();console.log("Add Design loaded");const[a,c]=q.useState(""),[x,v]=q.useState(""),[n,s]=q.useState(""),[r,d]=q.useState([]),[g,I]=q.useState([]),k=q.useMemo(()=>r,[r]),[S,B]=q.useState(!1),[M,E]=q.useState(""),[P,y]=q.useState("info"),[R,h]=q.useState(!1),[u,p]=q.useState("");console.log("Adding New Design from user:",t);const j=q.useRef(null),w=()=>{h(!1)},C=(A,f)=>{f!=="clickaway"&&B(!1)};q.useEffect(()=>{if(t!=null&&t.classes){const A=Object.keys(t.classes)[0];v(A||"")}},[t==null?void 0:t.classes]);const b=async A=>{var F;if(A.preventDefault(),console.log("Files to be saved:",g),!t||!t.uid){console.error("User object is undefined or missing UID."),p("You must be signed in to add a design."),h(!0);return}if(!a){p("All fields are required."),h(!0);return}await((F=j.current)==null?void 0:F.commitDeletions());const f=r.filter(O=>!O.deleted),o=g.filter(O=>!O.deleted).map(O=>({id:O.id,url:O.url,name:O.name,path:O.path})),N={title:n,description:a,course:x,dateCreated:_t(),dateModified:_t(),images:f,files:o,userId:t.uid};try{const O=await Sn(Ce(J,"designs"),N),$={...N,id:O.id};T([...m,$]),E(`${n} has been Added.`),y("success"),B(!0),s(""),c(""),d([]),I([]),setTimeout(()=>{D(!1),l()},1e3)}catch(O){console.log(O),p("There was an issue adding your design."),h(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:e,className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:b,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsx("div",{style:{display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:A=>s(A.target.value),style:{width:"100%"}})]})}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(zt,{id:"course",value:x,onChange:A=>v(A.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([A,f])=>i.jsx(ht,{value:A,children:`${f.number} - ${f.title}`},A))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(We,{onChange:c,initialValue:a}),i.jsx(rt,{ref:j,path:"designs/images",initialImages:k,onImagesUpdated:d,onDelete:A=>d(r.filter(f=>!A.includes(f))),isOwnDesign:!0}),i.jsx(vt,{path:"designs/files",initialFiles:g,onFilesChange:I,isOwnDesign:!0}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(Se,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(Se,{onClick:()=>D(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(st,{open:R,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(xt,{id:"alert-dialog-title",children:"Notification"}),i.jsx(it,{children:i.jsx(Rt,{id:"alert-dialog-description",children:u})}),i.jsx(yt,{children:i.jsx(Se,{onClick:w,autoFocus:!0,children:"Ok"})})]}),i.jsx(lt,{open:S,autoHideDuration:1e3,onClose:C,children:i.jsx(dt,{onClose:C,severity:P,sx:{width:"100%"},children:M})})]})},Os=({designId:m,setIsAddingBuild:T,refreshBuilds:D})=>{const[l,e]=q.useState(""),[t,a]=q.useState(""),[c,x]=q.useState([]),[v,n]=q.useState([]),{userDetails:s}=Ot(),r=j=>{x(j)},d=j=>{n(j)};console.log("AddBuild loaded");const[g,I]=q.useState(!1),[k,S]=q.useState(""),[B,M]=q.useState(!1),[E,P]=q.useState(""),[y,R]=q.useState("info");console.log("Adding New Build by user:",s);const h=()=>{I(!1)},u=(j,w)=>{w!=="clickaway"&&M(!1)},p=async j=>{if(j.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),I(!0);return}if(!t){S("Build description is required."),I(!0);return}const w=c.filter(b=>!b.deleted),C=v.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await Sn(Ce(J,"builds"),{title:l,description:t,design_ID:m,dateCreated:_t(),userId:s.uid,images:w,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",s),P("Your build has been successfully added."),R("success"),M(!0),setTimeout(()=>{e(""),a(""),x([]),n([]),T(!1),D()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let A=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(A="You do not have permission to perform this operation."),P(A),R("error"),M(!0)}else P("Failed to add the build. Please try again later."),R("error"),M(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:l,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(We,{onChange:a,initialValue:t})," ",i.jsx(rt,{path:`builds/${m}/images`,initialImages:c,onImagesUpdated:r,onDelete:j=>x(w=>w.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(vt,{path:`builds/${m}/files`,initialFiles:v,onFilesChange:d,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>T(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(st,{open:g,onClose:h,children:[i.jsx(xt,{children:"Notification"}),i.jsx(it,{children:i.jsx(Rt,{children:k})}),i.jsx(yt,{children:i.jsx(Se,{onClick:h,children:"OK"})})]}),i.jsx(lt,{open:B,autoHideDuration:6e3,onClose:u,children:i.jsx(dt,{onClose:u,severity:y,sx:{width:"100%"},children:E})})]})},Ms=({designId:m,buildId:T,refreshTests:D,setAddingTestIdForBuild:l})=>{const[e,t]=q.useState(""),[a,c]=q.useState(""),[x,v]=q.useState(""),[n,s]=q.useState(""),[r,d]=q.useState([]),[g,I]=q.useState([]),{userDetails:k}=Ot();console.log("AddTest loaded");const[S,B]=q.useState(!1),[M,E]=q.useState(""),[P,y]=q.useState(!1),[R,h]=q.useState(""),[u,p]=q.useState("info"),j=C=>{I(C)},w=async()=>{if(!a){E("Test description cannot be empty!"),B(!0);return}const C=r.filter(A=>!A.deleted),b=g.filter(A=>!A.deleted).map(A=>({id:A.id,url:A.url,name:A.name,path:A.path}));try{await Sn(Ce(J,"tests"),{title:e,build_ID:T,design_ID:m,dateCreated:_t(),description:a,results:x,conclusions:n,userId:k==null?void 0:k.uid,images:C,files:b}),setTimeout(()=>{D(T),t(""),c(""),v(""),s(""),d([]),I([]),l(!1)},1e3),h("Test added successfully"),p("success"),y(!0)}catch(A){console.error("Error adding test: ",A),h("Failed to add the test"),p("error"),y(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(We,{onChange:c,initialValue:a}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(We,{onChange:v,initialValue:x}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(We,{onChange:s,initialValue:n}),i.jsx(rt,{path:`tests/${T}/images`,initialImages:r,onImagesUpdated:C=>{d(C)},onDelete:C=>d(b=>b.filter(A=>!C.includes(A))),isOwnDesign:!0}),i.jsx(vt,{path:`tests/${T}/files`,initialFiles:g,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>l(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(st,{open:S,onClose:()=>B(!1),children:[i.jsx(xt,{children:"Notification"}),i.jsx(it,{children:i.jsx(Rt,{children:M})}),i.jsx(yt,{children:i.jsx(Se,{onClick:()=>B(!1),children:"OK"})})]}),i.jsx(lt,{open:P,autoHideDuration:6e3,onClose:()=>y(!1),children:i.jsx(dt,{onClose:()=>y(!1),severity:u,sx:{width:"100%"},children:R})})]})};var Dt={},er;function Ns(){if(er)return Dt;er=1;var m=at();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var T=m(ct()),D=ot();return Dt.default=(0,T.default)((0,D.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),Dt}var Bs=Ns();const jn=Xe(Bs),kt=m=>m&&m instanceof Cn?m.toDate().toLocaleString():"",Ps=({selectedDesign:m,setIsEditing:T,onReturnToDashboard:D})=>{const{userDetails:l,loading:e}=Ot(),t=m.id,a=m.userId===(l==null?void 0:l.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",l);const[c,x]=q.useState(""),[v,n]=q.useState(m.description),[s,r]=q.useState(m.course||""),[d,g]=q.useState(kt(m.dateCreated)),[I,k]=q.useState(kt(m.dateModified)),[S,B]=q.useState([]),[M,E]=q.useState([]),P=q.useRef(null),[y,R]=q.useState(!1),[h,u]=q.useState([]),[p,j]=q.useState({}),[w,C]=q.useState({}),[b,A]=q.useState({}),f=q.useRef(null),[o,N]=q.useState({}),[F,O]=q.useState({}),[$,H]=q.useState({}),[V,z]=q.useState(!1),[_,Y]=q.useState({}),[re,te]=q.useState({}),[X,ie]=q.useState({}),[ee,ce]=q.useState({}),[Re,Te]=q.useState({}),ue=q.useRef(null),[pe,fe]=q.useState({}),[ae,ge]=q.useState({}),[be,he]=q.useState({}),[Ie,oe]=q.useState(!1),[de,ve]=q.useState(""),[Le,Ge]=q.useState(()=>()=>{}),[xe,le]=q.useState(!1),[we,ne]=q.useState(""),[ke,se]=q.useState("info"),[Fe,ye]=q.useState({design:!1,builds:!1,tests:!1}),jt=async U=>{if(U.preventDefault(),!v){ve("All fields are required."),oe(!0);return}console.log("About to check image deletions",P.current),console.log(P.current),console.log(S.some(Q=>Q.deleted)),P.current&&S.some(Q=>Q.deleted)&&(console.log("Committing deletions"),await P.current.commitDeletions());const W=S.filter(Q=>!Q.deleted);M.some(Q=>Q.deleted)&&await Mt();const L=M.filter(Q=>!Q.deleted),Z={title:c,description:v,course:s,dateModified:_t(),images:W.map(Q=>({url:Q.url,title:Q.title,path:Q.path})),files:L.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})),userId:l.uid};try{await Ye(je(J,"designs",t),Z,{merge:!0}),ne("Your design has been updated."),se("success"),le(!0);const Q=Cn.now();k(kt(Q))}catch(Q){console.error("Error updating design:",Q),ne("There was an issue updating your design."),se("error"),le(!0)}ye(Q=>({...Q,design:!1}))};q.useEffect(()=>{m&&(n(m.description||""),x(m.title||""),r(m.course||""),(async()=>{const W=je(J,"designs",t),L=await Gr(W);if(L.exists()){const Z=L.data();console.log("Fetched images:",Z.images),console.log("Fetched files:",Z.files),B(Z.images||[]),E(Z.files||[]),g(kt(Z.dateCreated)),k(kt(Z.dateModified))}})())},[m,t]);const Yt=U=>{const W=S.filter(Z=>!U.some(Q=>Q.path===Z.path));console.log("Remaining images after deletion:",W),B(W);const L=W.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));Ye(je(J,"designs",t),{images:L},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Z=>console.error("Failed to update Firestore:",Z))},wt=U=>{JSON.stringify(S)!==JSON.stringify(U)&&(B(U),console.log("Updated images received:",U))},Mt=async()=>{const U=M.filter(W=>W.deleted);if(console.log("Files to delete:",U),U.length>0){const W=mt(),L=U.map(Z=>{const Q=pt(W,Z.path);return Lt(Q)});try{await Promise.all(L),console.log("Files deleted successfully");const Z=M.filter(Q=>!Q.deleted);E(Z),await rn(je(J,"designs",m.id),{files:Z.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),ne("Deleted files have been permanently removed."),se("success"),le(!0)}catch(Z){console.error("Failed to delete files: ",Z),ne("Failed to delete files."),se("error"),le(!0)}}},Je=async U=>{var Q,K;try{await xr(U)}catch(G){console.error("Error deleting files:",G),ne("Failed to delete build files."),se("error"),le(!0)}const W=((Q=w[U])==null?void 0:Q.filter(G=>!G.deleted).map(({url:G,path:Ue,title:Qe})=>({url:G,path:Ue,title:Qe})))||[],L=((K=b[U])==null?void 0:K.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[],Z={};W.length>0&&(Z.images=W),L.length>0&&(Z.files=L),p[U]!==void 0&&(Z.description=p[U]);try{const G=je(J,"builds",U);await Ye(G,Z,{merge:!0}),ne("Your build has been updated."),se("success"),le(!0),Ne(),ye(Ue=>({...Ue,builds:!1}))}catch(G){console.error("Error updating build:",G),ne("Failed to update build."),se("error"),le(!0)}},Kt=(U,W)=>{O(L=>({...L,[U]:W}))},qe=(U,W)=>{j(L=>({...L,[U]:W})),ye(L=>({...L,builds:!0}))},Me=async U=>{const W=F[U];try{const L=je(J,"builds",U);await Ye(L,{title:W},{merge:!0}),O(Z=>{const Q={...Z};return delete Q[U],Q}),Ne()}catch(L){console.error("Failed to save build title:",L)}},Ne=async()=>{if(!l){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",l==null?void 0:l.uid),console.log("Selected design ID for query:",m==null?void 0:m.id);let U;l.isAdmin?U=Ee(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):U=Ee(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",l.uid),Pe("dateCreated")),console.log("Builds query details:",JSON.stringify(U,null,2));const W=await Ke(U);console.log("Builds snapshot details:",JSON.stringify(W.docs.map(Z=>Z.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",W.docs.length);const L=W.docs.map(Z=>(console.log("Build doc path: ",Z.ref.path),{id:Z.id,...Z.data()}));u(L),console.log("New builds state after refresh:",L)}catch(U){console.error("Error refreshing builds:",U),U.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",U):console.error("An unexpected error occurred when trying to refresh builds:",U)}},et=(U,W)=>{const L=je(J,"builds",U),Z=w[U].filter(K=>!W.some(G=>G.path===K.path));C(K=>({...K,[U]:Z}));const Q=Z.map(K=>({url:K.url,title:K.title,path:K.path}));Ye(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ne("Build Image deletions updated."),se("success")}).catch(K=>{console.error("Failed to update build images in Firestore:",K),ne("Failed to update build image deletions."),se("error")}),le(!0)},Nt=async U=>{const W=Ee(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",l.uid)),L=await Ke(W);for(const Z of L.docs)await bt(je(J,"tests",Z.id));await bt(je(J,"builds",U)),await Ne(),ne("Build and its tests (if any) deleted successfully."),se("success"),le(!0)},$e=U=>{ve("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ge(()=>()=>Nt(U)),oe(!0)},He=(U,W)=>{C(L=>({...L,[U]:W}))},In=(U,W)=>{A(L=>({...L,[U]:W}))},xr=async U=>{var L;const W=((L=b[U])==null?void 0:L.filter(Z=>Z.deleted))||[];if(console.log("Build files to delete:",W),W.length>0){const Z=mt(),Q=W.map(K=>{const G=pt(Z,K.path);return Lt(G)});try{await Promise.all(Q),console.log("Build files deleted successfully");const K=b[U].filter(G=>!G.deleted);A(G=>({...G,[U]:K})),await rn(je(J,"builds",U),{files:K.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),console.log("Firestore successfully updated to remove deleted files"),ne("Deleted build files have been permanently removed."),se("success"),le(!0)}catch(K){console.error("Failed to delete build files: ",K),ne("Failed to delete build files."),se("error"),le(!0)}}},yr=async(U,W)=>{var K;try{await Tr(U)}catch(G){console.error("Error deleting files:",G),ne("Failed to delete build files."),se("error"),le(!0)}const L={},Z=ee[U].filter(G=>!G.deleted).map(({url:G,path:Ue,title:Qe})=>({url:G,path:Ue,title:Qe})),Q=((K=Re[U])==null?void 0:K.filter(G=>!G.deleted).map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})))||[];_[U]!==void 0&&(L.description=_[U]),re[U]!==void 0&&(L.results=re[U]),X[U]!==void 0&&(L.conclusions=X[U]),L.images=Z,L.files=Q;try{const G=je(J,"tests",U);await Ye(G,L,{merge:!0}),ne("Your test has been updated."),se("success"),le(!0),Bt(W)}catch(G){console.error(`Error updating test ID: ${U}:`,G),ne("There was an issue updating your test."),se("error"),le(!0)}},jr=(U,W)=>{ge(L=>({...L,[U]:W}))},Fn=async(U,W)=>{const L=ae[U],Z=je(J,"tests",U);await Ye(Z,{title:L},{merge:!0}),ge(Q=>{const K={...Q};return delete K[U],K}),Bt(W)},wr=(U,W)=>{console.log(`Updating description for test ID ${U}:`,W),Y(L=>({...L,[U]:W})),ye(L=>({...L,tests:!0}))},Cr=(U,W)=>{console.log(`Updating results for test ID ${U}:`,W),te(L=>({...L,[U]:W})),ye(L=>({...L,tests:!0}))},Sr=(U,W)=>{ie(L=>({...L,[U]:W})),ye(L=>({...L,tests:!0}))};q.useEffect(()=>{!e&&l&&(async()=>{if(!l)return;let W;l.isAdmin?W=Ee(Ce(J,"builds"),me("design_ID","==",t),Pe("dateCreated")):W=Ee(Ce(J,"builds"),me("design_ID","==",t),me("userId","==",l.uid),Pe("dateCreated"));const L=await Ke(W),Z=[],Q={},K={};for(const G of L.docs){const Ue=G.data(),Qe=G.id;Z.push({id:Qe,...Ue,images:Ue.images||[],files:Ue.files||[]}),K[Qe]=!0;let Xt;l.isAdmin?Xt=Ee(Ce(J,"tests"),me("build_ID","==",Qe),Pe("dateCreated")):Xt=Ee(Ce(J,"tests"),me("build_ID","==",Qe),me("userId","==",l.uid),Pe("dateCreated"));const kr=await Ke(Xt),kn=[],Jt={},en={};for(const Ze of kr.docs){const Ve=Ze.data();kn.push({id:Ze.id,...Ve}),Jt[Ze.id]=Ve.images||[],en[Ze.id]=Ve.files||[]}Q[Qe]=kn,ce(Ze=>{const Ve={...Ze};for(const Ct in Jt)Ve[Ct]=Jt[Ct];return Ve}),Te(Ze=>{const Ve={...Ze};for(const Ct in en)Ve[Ct]=en[Ct];return Ve})}u(Z),H(Q),he(K)})()},[e,l,m.id,t]);const Bt=async U=>{if(!l){console.log("User details not loaded yet");return}try{let W;l.isAdmin?W=Ee(Ce(J,"tests"),me("build_ID","==",U),Pe("dateCreated")):W=Ee(Ce(J,"tests"),me("build_ID","==",U),me("userId","==",l.uid),Pe("dateCreated"));const Z=(await Ke(W)).docs.map(G=>{const Ue=G.data();return{id:G.id,...Ue,images:Ue.images||[],files:Ue.files||[]}});H(G=>({...G,[U]:Z}));const Q={},K={};Z.forEach(G=>{Q[G.id]=G.images,K[G.id]=G.files}),ce(Q),Te(K)}catch(W){console.error("Error fetching tests:",W)}},Ar=(U,W)=>{const L=je(J,"tests",U),Z=ee[U].filter(K=>!W.includes(K));ce(K=>({...K,[U]:Z}));const Q=Z.map(({url:K,path:G,title:Ue})=>({url:K,path:G,title:Ue}));Ye(L,{images:Q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ne("Test Image deletions updated."),se("success")}).catch(K=>{console.error("Failed to update test images in Firestore:",K),ne("Failed to update test image deletions."),se("error")}),le(!0)},Un=(U,W)=>{ce(L=>({...L,[U]:W}))},Dn=(U,W)=>{Te(L=>({...L,[U]:W}))},Tr=async U=>{var L;const W=((L=Re[U])==null?void 0:L.filter(Z=>Z.deleted))||[];if(W.length>0){const Z=mt(),Q=W.map(K=>{const G=pt(Z,K.path);return Lt(G)});try{await Promise.all(Q);const K=Re[U].filter(G=>!G.deleted);Te(G=>({...G,[U]:K})),await rn(je(J,"tests",U),{files:K.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),ne("Deleted test files have been permanently removed."),se("success"),le(!0)}catch(K){console.error("Failed to delete test files: ",K),ne("Failed to delete test files."),se("error"),le(!0)}}},Ir=async(U,W)=>{await bt(je(J,"tests",U)),await Bt(W),ne("Test deleted successfully."),se("success"),le(!0)},Fr=(U,W)=>{ve("Are you sure you want to delete this test? This action cannot be undone."),Ge(()=>()=>Ir(U,W)),oe(!0)},Ur=U=>{he(W=>({...W,[U]:!W[U]}))},Dr=()=>{const U=Object.entries(Fe).filter(([L,Z])=>Z).map(([L])=>L).join(", ");if(!U.length){D();return}const W=`You have unsaved changes in the following sections: ${U}. Are you sure you want to leave?`;ve(W),Ge(()=>()=>{ye({design:!1,builds:!1,tests:!1}),D()}),oe(!0)};return q.useEffect(()=>{const U=W=>{Object.values(Fe).some(Z=>Z)&&(W.preventDefault(),W.returnValue="")};return window.addEventListener("beforeunload",U),()=>window.removeEventListener("beforeunload",U)},[Fe]),i.jsxs("div",{className:"small-container",children:[i.jsx(Se,{variant:"text",onClick:()=>{Object.values(Fe).some(W=>W)?Dr():D()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:jt,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:c,onChange:U=>{x(U.target.value),ye(W=>({...W,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:d||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:I||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(zt,{id:"course",value:s,onChange:U=>{r(U.target.value),ye(W=>({...W,design:!0}))},fullWidth:!0,children:(l!=null&&l.classes?Object.entries(l.classes):[]).map(([U,W])=>i.jsx(ht,{value:U,children:`${W.number} - ${W.title}`},U))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(We,{initialValue:v,onChange:U=>{n(U),ye(W=>({...W,design:!0}))}}),i.jsx(rt,{ref:P,path:`designs/${m.id}/images`,initialImages:S,onImagesUpdated:wt,onDelete:Yt,isOwnDesign:a}),i.jsx(vt,{path:`designs/${m.id}/files`,initialFiles:M,onFilesChange:E,isOwnDesign:a}),a&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>T(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&i.jsxs("button",{className:"button muted-button",onClick:()=>{R(!0),setTimeout(()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),h.map((U,W)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:F[U.id]!==void 0?i.jsx(Wt,{variant:"outlined",size:"small",fullWidth:!0,value:F[U.id],onChange:L=>Kt(U.id,L.target.value),onBlur:()=>Me(U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Oe,{onClick:()=>Me(U.id),size:"small",children:i.jsx(wn,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>O(L=>({...L,[U.id]:U.title||`Build ${W+1}`})),style:{cursor:"pointer"},children:U.title||`Build ${W+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>N(L=>({...L,[U.id]:!L[U.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:o[U.id]?i.jsx(jn,{}):i.jsx(nn,{})}),a&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>$e(U.id),children:i.jsx(Et,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{z(U.id),setTimeout(()=>{ue.current&&ue.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),o[U.id]&&i.jsxs(i.Fragment,{children:[i.jsx(We,{initialValue:p[U.id]||U.description,onChange:L=>{qe(U.id,L)}}),i.jsx(rt,{path:`builds/${U.id}/images`,initialImages:U.images,onImagesUpdated:L=>He(U.id,L),onDelete:L=>et(U.id,L),isOwnDesign:a}),i.jsx(vt,{path:`builds/${U.id}/files`,initialFiles:U.files,onFilesChange:L=>In(U.id,L),isOwnDesign:a}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Je(U.id),children:"Update"})}),i.jsx("div",{children:$[U.id]&&$[U.id].length>0&&i.jsx("button",{onClick:()=>Ur(U.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[U.id]?i.jsxs(i.Fragment,{children:[i.jsx(nn,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(jn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[U.id]&&$[U.id]&&$[U.id].map((L,Z)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:ae[L.id]!==void 0?i.jsx(Wt,{variant:"outlined",size:"small",fullWidth:!0,value:ae[L.id],onChange:Q=>jr(L.id,Q.target.value),onBlur:()=>Fn(L.id,U.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Oe,{onClick:()=>Fn(L.id,U.id),size:"small",children:i.jsx(wn,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>ge(Q=>({...Q,[L.id]:L.title||`Test ${Z+1}`})),style:{cursor:"pointer"},children:L.title||`Test ${Z+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>fe(Q=>({...Q,[L.id]:!Q[L.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:pe[L.id]?i.jsx(jn,{}):i.jsx(nn,{})}),a&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Fr(L.id,U.id),children:i.jsx(Et,{})})]})]}),pe[L.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(We,{initialValue:_[L.id]||L.description,onChange:Q=>{wr(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(We,{initialValue:re[L.id]||L.results,onChange:Q=>{Cr(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(We,{initialValue:X[L.id]||L.conclusions,onChange:Q=>{Sr(L.id,Q)}})]}),i.jsxs("div",{children:[i.jsx(rt,{path:`tests/${L.id}/images`,initialImages:ee[L.id]||[],onImagesUpdated:Q=>Un(L.id,Q),onDelete:Q=>Ar(L.id,Q),isOwnDesign:a}),i.jsx(vt,{path:`tests/${L.id}/files`,initialFiles:Re[L.id]||[],onFilesChange:Q=>Dn(L.id,Q),isOwnDesign:a})]}),a&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>yr(L.id,U.id),children:"Update"})})]})]},L.id))]}),V===U.id&&i.jsxs("div",{className:"new-test-record",ref:ue,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Ms,{designId:m.id,buildId:U.id,refreshTests:()=>Bt(U.id),setAddingTestIdForBuild:z,onImagesUpdated:L=>Un(U.id,L),onFilesChange:L=>Dn(U.id,L)})]})]},U.id)),i.jsx("div",{children:y&&i.jsxs("div",{className:"new-build-record",ref:f,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Os,{designId:m.id,setIsAddingBuild:R,refreshBuilds:Ne,onImagesUpdated:U=>He("temp-build-id",U),onFilesChange:U=>In("temp-build-id",U)})]})})]}),i.jsxs(st,{open:Ie,onClose:()=>oe(!1),children:[i.jsx(xt,{children:"Confirmation Required"}),i.jsx(it,{children:i.jsx(Rt,{children:de})}),i.jsxs(yt,{children:[i.jsx(Se,{onClick:()=>oe(!1),children:"Cancel"}),i.jsx(Se,{onClick:()=>{Le(),oe(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(lt,{open:xe,autoHideDuration:6e3,onClose:()=>le(!1),children:i.jsx(dt,{onClose:()=>le(!1),severity:ke,sx:{width:"100%"},children:we})})]})},ft=(m,T,D)=>m[T]??D,Ls=()=>{const{userDetails:m,loading:T}=Ot();console.log("Dashboard loaded");const[D,l]=q.useState([]),[e,t]=q.useState([]),[a,c]=q.useState([]),[x,v]=q.useState(null),[n,s]=q.useState(!1),[r,d]=q.useState(!1),[g,I]=q.useState(!1),[k,S]=q.useState(""),[B,M]=q.useState(""),[E,P]=q.useState(!1),[y,R]=q.useState(null),[h,u]=q.useState(!1),[p,j]=q.useState(""),[w,C]=q.useState("info"),b=()=>{d(!1),s(!1),v(null),A()},A=q.useCallback(async()=>{if(!m)return;let F;const O=[],$=[],H=[];if(m.isSuperAdmin)F=Ee(Ce(J,"designs"),Pe("dateCreated","desc"));else if(m.isAdmin){const z=m.classes?Object.keys(m.classes):[];if(z.length>0)F=Ee(Ce(J,"designs"),me("course","in",z),Pe("dateCreated","desc"));else{t([]),c([]);return}}else F=Ee(Ce(J,"designs"),me("userId","==",m.uid),Pe("dateCreated","desc"));(await Ke(F)).forEach(z=>{const _=z.data(),Y={id:z.id,title:ft(_,"title",""),description:ft(_,"description",""),course:ft(_,"course",""),dateCreated:_.dateCreated,dateModified:_.dateModified,userId:ft(_,"userId",""),images:ft(_,"images",[]),files:ft(_,"files",[])};m.isSuperAdmin?_.userId===m.uid?O.push(Y):_.userId!==m.uid&&_.course&&_.isAdmin?$.push(Y):_.userId!==m.uid&&!_.isAdmin&&H.push(Y):m.isAdmin?_.userId===m.uid?$.push(Y):H.push(Y):_.userId===m.uid&&H.push(Y)}),l(O),t($),c(H)},[m]);q.useEffect(()=>{!T&&m&&A()},[m,T,A]);const f=F=>{const O=[...D,...e,...a].find($=>$.id===F);v(O||null),d(!0)},o=F=>{R(F),S("Are you sure you want to delete this design? This action cannot be undone."),I(!0)},N=async()=>{if(y)if(B!==(m==null?void 0:m.uid))j("User ID confirmation failed. Enter the correct User ID."),C("error"),u(!0);else try{const F=Ee(Ce(J,"builds"),me("design_ID","==",y),me("userId","==",m.uid)),O=await Ke(F);for(const $ of O.docs){const H=$.id,V=Ee(Ce(J,"tests"),me("build_ID","==",H),me("userId","==",m.uid)),z=await Ke(V);for(const _ of z.docs)await bt(je(J,"tests",_.id));await bt(je(J,"builds",H))}await bt(je(J,"designs",y)),l($=>$.filter(H=>H.id!==y)),t($=>$.filter(H=>H.id!==y)),c($=>$.filter(H=>H.id!==y)),j("Your design and its associated builds and tests have been deleted."),C("success"),u(!0)}catch(F){console.error("Error deleting design, builds, and tests: ",F),j("There was an issue deleting your design and its associated builds and tests."),C("error"),u(!0)}finally{M(""),P(!1),R(null)}};return i.jsxs(tt,{className:"profile-container",sx:{p:4},children:[" ",!n&&!r&&i.jsxs(i.Fragment,{children:[i.jsx(tt,{sx:{mb:3},children:i.jsx(sr,{setIsAdding:s})}),(m==null?void 0:m.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Super Admin Designs"}),i.jsx(ut,{designs:D,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),i.jsx("h2",{children:"Educator Designs"}),i.jsx(ut,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(ut,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:m,showUserIdColumn:!0})]}),(m==null?void 0:m.isAdmin)&&!m.isSuperAdmin&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Educator Designs"}),i.jsx(ut,{designs:e,handleEdit:f,handleDelete:o,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),i.jsx("h2",{children:"Student Designs"}),i.jsx(ut,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:m,showUserIdColumn:!0})]}),!(m!=null&&m.isAdmin)&&!(m!=null&&m.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Student Designs"}),i.jsx(ut,{designs:a,handleEdit:f,handleDelete:o,isAdmin:!1,userDetails:m,showUserIdColumn:!1})]})]}),n&&i.jsx(Rs,{designs:D.concat(e),setDesigns:t,setIsAdding:s,getDesigns:A,onReturnToDashboard:b}),r&&i.jsx(Ps,{designs:D.concat(e),selectedDesign:x,setDesigns:t,setIsEditing:d,getDesigns:A,onReturnToDashboard:b}),i.jsxs(st,{open:g,onClose:()=>I(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(xt,{children:"Confirm Deletion"}),i.jsx(it,{children:i.jsx(Rt,{children:k})}),i.jsxs(yt,{children:[i.jsx(Se,{onClick:()=>I(!1),children:"No, cancel"}),i.jsx(Se,{onClick:()=>{P(!0),I(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(st,{open:E,onClose:()=>P(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(xt,{children:"Confirm Your User ID"}),i.jsx(it,{children:i.jsx(Wt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:B,onChange:F=>M(F.target.value)})}),i.jsxs(yt,{children:[i.jsx(Se,{onClick:()=>P(!1),children:"No, cancel"}),i.jsx(Se,{onClick:N,color:"primary",children:"Confirm"})]})]}),i.jsx(lt,{open:h,autoHideDuration:6e3,onClose:()=>u(!1),children:i.jsx(dt,{onClose:()=>u(!1),severity:w,sx:{width:"100%"},children:p})})]})},Qs=zr.memo(Ls);export{Qs as default};
