import{r as H,b3 as Rn,b4 as _n,j as i,B as ve,a as Ie,T as ze,am as $r,P as Pt,an as Vr,ao as Qr,ap as cn,aq as Ne,ar as Gr,as as Yr,N as fr,z as Kt,I as He,c as ot,d as at,D as ht,m as gt,V as mt,W as pt,aj as hr,ai as Dn,ak as Xt,_ as yt,t as Zr,v as Kr,b8 as Xr,x as Wt,w as Jr,q as es,l as At,n as Lt,o as Tt,k as ts}from"./ui-ySD7tZ62.js";import{u as ns,a as We,c as K,s as ee,b as Me,d as jt,t as $,f as Ht,r as lt,C as rs,R as ss,g as $t,h as se,V as un}from"./index-D2vmUsH3.js";import{q as En,k as St,r as wt,n as Yt,z as gr,l as mr,p as Mn,_ as Te,h as qt,e as Fe,f as is,R as Oe,x as Ve,v as xe,t as it,m as st,i as fn,y as Ct}from"./firebase-DpGenoA-.js";import{E as pr}from"./Edit-DTdacdKf.js";import{g as tt}from"./vendor-BFl3bqVE.js";import hn from"./purify.es-CQJ0hv7W.js";const br=H.memo(({setIsAdding:g})=>{console.log("Header loaded");const A=ns(),U=Rn(),a=_n(U.breakpoints.down("md")),e=()=>{A("/")};return i.jsxs(ve,{sx:{p:a?ee[4]:ee[6],backgroundColor:K.primary[50],borderRadius:Me["2xl"],mb:ee[6],border:`1px solid ${K.primary[200]}`,boxShadow:We.sm},children:[i.jsx(ve,{sx:{mb:ee[4]},children:i.jsx(Ie,{variant:"text",onClick:e,sx:{fontFamily:$.fontFamily.secondary,fontSize:a?$.fontSize.base:$.fontSize.lg,color:K.primary[600],textTransform:"none",fontWeight:$.fontWeight.medium,"&:hover":{backgroundColor:K.primary[100],color:K.primary[700]},transition:jt.transitions.fast},children:"← Home Page"})}),i.jsxs(ve,{sx:{mb:ee[6]},children:[i.jsx(ze,{variant:"h2",sx:{fontFamily:$.fontFamily.display,fontSize:a?$.fontSize["3xl"]:$.fontSize["5xl"],fontWeight:$.fontWeight.bold,color:K.primary[700],lineHeight:$.lineHeight.tight,mb:ee[2]},children:"Laboratory Notebook"}),i.jsx(ze,{variant:"body1",sx:{fontFamily:$.fontFamily.primary,fontSize:a?$.fontSize.base:$.fontSize.lg,color:K.text.secondary,lineHeight:$.lineHeight.relaxed},children:"Manage your lab experiments, designs, and research projects"})]}),i.jsx(ve,{sx:{display:"flex",justifyContent:"flex-start"},children:i.jsx(Ie,{variant:"contained",onClick:()=>g(!0),sx:{fontFamily:$.fontFamily.display,fontSize:a?$.fontSize.lg:$.fontSize.xl,fontWeight:$.fontWeight.semibold,textTransform:"none",px:a?ee[4]:ee[6],py:ee[3],backgroundColor:K.primary[500],borderRadius:Me.xl,boxShadow:We.md,transition:jt.transitions.fast,"&:hover":{backgroundColor:K.primary[600],boxShadow:We.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"}},children:"+ Create New Design"})})]})});br.displayName="Header";const bt=({designs:g,handleEdit:A,handleDelete:U,userDetails:a,showUserIdColumn:e})=>{const t=d=>d?d instanceof En?d.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):d instanceof Date?d.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return i.jsx($r,{component:Pt,sx:{borderRadius:Me["2xl"],boxShadow:We.lg,border:`1px solid ${K.neutral[200]}`,overflow:"hidden"},children:i.jsxs(Vr,{sx:{"& .MuiTableCell-root":{fontSize:$.fontSize.base,fontFamily:$.fontFamily.primary,borderBottom:`1px solid ${K.neutral[200]}`},"& .MuiTableCell-head":{fontSize:$.fontSize.lg,fontFamily:$.fontFamily.display,fontWeight:$.fontWeight.semibold,backgroundColor:K.primary[500],color:K.text.inverse,textTransform:"uppercase",letterSpacing:"0.5px"},"& .MuiTableRow-root:hover":{backgroundColor:K.primary[25]}},children:[i.jsx(Qr,{children:i.jsxs(cn,{sx:{height:"64px"},children:[i.jsx(Ne,{sx:{width:e?"30%":"35%"},children:"Design Title"}),i.jsx(Ne,{sx:{width:"20%"},children:"Course"}),e&&i.jsx(Ne,{sx:{width:"15%"},children:"User"}),i.jsx(Ne,{sx:{width:"15%"},children:"Created"}),i.jsx(Ne,{sx:{width:"15%"},children:"Modified"}),i.jsx(Ne,{sx:{width:"15%",textAlign:"center"},children:"Actions"})]})}),i.jsx(Gr,{children:g&&g.length>0?g.map(d=>{const l=d.userId===(a==null?void 0:a.uid),x=d.course&&(a!=null&&a.classes)&&a.classes[d.course]?a.classes[d.course]:null;return i.jsxs(cn,{sx:{height:"72px",transition:jt.transitions.fast,"&:hover":{backgroundColor:K.primary[25],transform:"translateY(-1px)",boxShadow:We.sm}},children:[i.jsx(Ne,{children:i.jsxs(ve,{sx:{display:"flex",alignItems:"center",gap:ee[3]},children:[i.jsx(Yr,{sx:{width:40,height:40,backgroundColor:K.primary[100],color:K.primary[700],fontSize:$.fontSize.sm,fontWeight:$.fontWeight.semibold},children:d.title.charAt(0).toUpperCase()}),i.jsx(ze,{variant:"body1",sx:{fontFamily:$.fontFamily.secondary,fontSize:$.fontSize.base,fontWeight:$.fontWeight.semibold,color:K.text.primary,cursor:"pointer","&:hover":{color:K.primary[600],textDecoration:"underline"}},onClick:()=>A(d.id),children:d.title})]})}),i.jsx(Ne,{children:x?i.jsx(fr,{label:`${x.number}`,size:"small",sx:{backgroundColor:K.secondary[100],color:K.secondary[700],fontFamily:$.fontFamily.secondary,fontWeight:$.fontWeight.medium,fontSize:$.fontSize.sm}}):i.jsx(ze,{variant:"body2",sx:{color:K.text.disabled,fontStyle:"italic"},children:"No Course"})}),e&&i.jsx(Ne,{children:i.jsx(ze,{variant:"body2",sx:{fontFamily:"monospace",fontSize:$.fontSize.sm,color:K.text.secondary,wordBreak:"break-all"},children:d.userId})}),i.jsx(Ne,{children:i.jsx(ze,{variant:"body2",sx:{color:K.text.secondary,fontSize:$.fontSize.sm},children:t(d.dateCreated)})}),i.jsx(Ne,{children:i.jsx(ze,{variant:"body2",sx:{color:K.text.secondary,fontSize:$.fontSize.sm},children:t(d.dateModified)})}),i.jsx(Ne,{sx:{textAlign:"center"},children:i.jsxs(ve,{sx:{display:"flex",justifyContent:"center",gap:ee[1]},children:[i.jsx(Kt,{title:l?"Edit Design":"Cannot edit others' designs",children:i.jsx("span",{children:i.jsx(He,{size:"small",onClick:()=>l&&A(d.id),disabled:!l,sx:{color:l?K.primary[600]:K.text.disabled,"&:hover":{backgroundColor:l?K.primary[100]:"transparent"}},children:i.jsx(pr,{fontSize:"small"})})})}),i.jsx(Kt,{title:l?"Delete Design":"Cannot delete others' designs",children:i.jsx("span",{children:i.jsx(He,{size:"small",onClick:()=>l&&U(d.id),disabled:!l,sx:{color:l?K.error:K.text.disabled,"&:hover":{backgroundColor:l?K.error+"20":"transparent"}},children:i.jsx(Ht,{fontSize:"small"})})})})]})})]},d.id)}):i.jsx(cn,{children:i.jsx(Ne,{colSpan:e?6:5,sx:{textAlign:"center",py:ee[8],color:K.text.secondary,fontStyle:"italic"},children:i.jsx(ze,{variant:"body1",children:"No designs found. Create your first design to get started!"})})})})]})})};function os(g,A){return A.forEach(function(U){U&&typeof U!="string"&&!Array.isArray(U)&&Object.keys(U).forEach(function(a){if(a!=="default"&&!(a in g)){var e=Object.getOwnPropertyDescriptor(U,a);Object.defineProperty(g,a,e.get?e:{enumerable:!0,get:function(){return U[a]}})}})}),Object.freeze(g)}function xr(g,A){return new Promise(function(U,a){let e;return as(g).then(function(t){try{return e=t,U(new Blob([A.slice(0,2),e,A.slice(2)],{type:"image/jpeg"}))}catch(d){return a(d)}},a)})}const as=g=>new Promise((A,U)=>{const a=new FileReader;a.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return U("not a valid JPEG");for(d+=2;;){const l=t.getUint16(d);if(l===65498)break;const x=t.getUint16(d+2);if(l===65505&&t.getUint32(d+4)===1165519206){const y=d+10;let n;switch(t.getUint16(y)){case 18761:n=!0;break;case 19789:n=!1;break;default:return U("TIFF header contains invalid endian")}if(t.getUint16(y+2,n)!==42)return U("TIFF header contains invalid version");const s=t.getUint32(y+4,n),r=y+s+2+12*t.getUint16(y+s,n);for(let c=y+s+2;c<r;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return U("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return U("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return A(e.slice(d,d+2+x))}d+=2+x}return A(new Blob)}),a.readAsArrayBuffer(g)});var Jt={},ls={get exports(){return Jt},set exports(g){Jt=g}};(function(g){var A,U,a={};ls.exports=a,a.parse=function(e,t){for(var d=a.bin.readUshort,l=a.bin.readUint,x=0,y={},n=new Uint8Array(e),s=n.length-4;l(n,s)!=101010256;)s--;x=s,x+=4;var r=d(n,x+=4);d(n,x+=2);var c=l(n,x+=2),m=l(n,x+=4);x+=4,x=m;for(var F=0;F<r;F++){l(n,x),x+=4,x+=4,x+=4,l(n,x+=4),c=l(n,x+=4);var D=l(n,x+=4),S=d(n,x+=4),z=d(n,x+2),M=d(n,x+4);x+=6;var R=l(n,x+=8);x+=4,x+=S+z+M,a._readLocal(n,R,y,c,D,t)}return y},a._readLocal=function(e,t,d,l,x,y){var n=a.bin.readUshort,s=a.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var c=n(e,t+=8),m=n(e,t+=2);t+=2;var F=a.bin.readUTF8(e,t,c);if(t+=c,t+=m,y)d[F]={size:x,csize:l};else{var D=new Uint8Array(e.buffer,t);if(r==0)d[F]=new Uint8Array(D.buffer.slice(t,t+l));else{if(r!=8)throw"unknown compression method: "+r;var S=new Uint8Array(x);a.inflateRaw(D,S),d[F]=S}}},a.inflateRaw=function(e,t){return a.F.inflate(e,t)},a.inflate=function(e,t){return e[0],e[1],a.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},a.deflate=function(e,t){t==null&&(t={level:6});var d=0,l=new Uint8Array(50+Math.floor(1.1*e.length));l[d]=120,l[d+1]=156,d+=2,d=a.F.deflateRaw(e,l,d,t.level);var x=a.adler(e,0,e.length);return l[d+0]=x>>>24&255,l[d+1]=x>>>16&255,l[d+2]=x>>>8&255,l[d+3]=x>>>0&255,new Uint8Array(l.buffer,0,d+4)},a.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),l=a.F.deflateRaw(e,d,l,t.level);return new Uint8Array(d.buffer,0,l)},a.encode=function(e,t){t==null&&(t=!1);var d=0,l=a.bin.writeUint,x=a.bin.writeUshort,y={};for(var n in e){var s=!a._noNeed(n)&&!t,r=e[n],c=a.crc.crc(r,0,r.length);y[n]={cpr:s,usize:r.length,crc:c,file:s?a.deflateRaw(r):r}}for(var n in y)d+=y[n].file.length+30+46+2*a.bin.sizeUTF8(n);d+=22;var m=new Uint8Array(d),F=0,D=[];for(var n in y){var S=y[n];D.push(F),F=a._writeHeader(m,F,n,S,0)}var z=0,M=F;for(var n in y)S=y[n],D.push(F),F=a._writeHeader(m,F,n,S,1,D[z++]);var R=F-M;return l(m,F,101010256),F+=4,x(m,F+=4,z),x(m,F+=2,z),l(m,F+=2,R),l(m,F+=4,M),F+=4,F+=2,m.buffer},a._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},a._writeHeader=function(e,t,d,l,x,y){var n=a.bin.writeUint,s=a.bin.writeUshort,r=l.file;return n(e,t,x==0?67324752:33639248),t+=4,x==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,l.cpr?8:0),n(e,t+=2,0),n(e,t+=4,l.crc),n(e,t+=4,r.length),n(e,t+=4,l.usize),s(e,t+=4,a.bin.sizeUTF8(d)),s(e,t+=2,0),t+=2,x==1&&(t+=2,t+=2,n(e,t+=6,y),t+=4),t+=a.bin.writeUTF8(e,t,d),x==0&&(e.set(r,t),t+=r.length),t},a.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,l=0;l<8;l++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,l){for(var x=0;x<l;x++)e=a.crc.table[255&(e^t[d+x])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^a.crc.update(4294967295,e,t,d)}},a.adler=function(e,t,d){for(var l=1,x=0,y=t,n=t+d;y<n;){for(var s=Math.min(y+5552,n);y<s;)x+=l+=e[y++];l%=65521,x%=65521}return x<<16|l},a.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var l="",x=0;x<d;x++)l+=String.fromCharCode(e[t+x]);return l},writeASCII:function(e,t,d){for(var l=0;l<d.length;l++)e[t+l]=d.charCodeAt(l)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var l,x="",y=0;y<d;y++)x+="%"+a.bin.pad(e[t+y].toString(16));try{l=decodeURIComponent(x)}catch{return a.bin.readASCII(e,t,d)}return l},writeUTF8:function(e,t,d){for(var l=d.length,x=0,y=0;y<l;y++){var n=d.charCodeAt(y);if((4294967168&n)==0)e[t+x]=n,x++;else if((4294965248&n)==0)e[t+x]=192|n>>6,e[t+x+1]=128|n>>0&63,x+=2;else if((4294901760&n)==0)e[t+x]=224|n>>12,e[t+x+1]=128|n>>6&63,e[t+x+2]=128|n>>0&63,x+=3;else{if((4292870144&n)!=0)throw"e";e[t+x]=240|n>>18,e[t+x+1]=128|n>>12&63,e[t+x+2]=128|n>>6&63,e[t+x+3]=128|n>>0&63,x+=4}}return x},sizeUTF8:function(e){for(var t=e.length,d=0,l=0;l<t;l++){var x=e.charCodeAt(l);if((4294967168&x)==0)d++;else if((4294965248&x)==0)d+=2;else if((4294901760&x)==0)d+=3;else{if((4292870144&x)!=0)throw"e";d+=4}}return d}},a.F={},a.F.deflateRaw=function(e,t,d,l){var x=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][l],y=a.F.U,n=a.F._goodIndex;a.F._hash;var s=a.F._putsE,r=0,c=d<<3,m=0,F=e.length;if(l==0){for(;r<F;)s(t,c,r+(j=Math.min(65535,F-r))==F?1:0),c=a.F._copyExact(e,r,j,t,c+8),r+=j;return c>>>3}var D=y.lits,S=y.strt,z=y.prev,M=0,R=0,B=0,v=0,E=0,f=0;for(F>2&&(S[f=a.F._hash(e,0)]=0),r=0;r<F;r++){if(E=f,r+1<F-2){f=a.F._hash(e,r+1);var u=r+1&32767;z[u]=S[f],S[f]=u}if(m<=r){(M>14e3||R>26697)&&F-r>100&&(m<r&&(D[M]=r-m,M+=2,m=r),c=a.F._writeBlock(r==F-1||m==F?1:0,D,M,v,e,B,r-B,t,c),M=R=v=0,B=r);var p=0;r<F-2&&(p=a.F._bestMatch(e,r,z,E,Math.min(x[2],F-r),x[3]));var j=p>>>16,w=65535&p;if(p!=0){w=65535&p;var C=n(j=p>>>16,y.of0);y.lhst[257+C]++;var b=n(w,y.df0);y.dhst[b]++,v+=y.exb[C]+y.dxb[b],D[M]=j<<23|r-m,D[M+1]=w<<16|C<<8|b,M+=2,m=r+j}else y.lhst[e[r]]++;R++}}for(B==r&&e.length!=0||(m<r&&(D[M]=r-m,M+=2,m=r),c=a.F._writeBlock(1,D,M,v,e,B,r-B,t,c),M=0,R=0,M=R=v=0,B=r);(7&c)!=0;)c++;return c>>>3},a.F._bestMatch=function(e,t,d,l,x,y){var n=32767&t,s=d[n],r=n-s+32768&32767;if(s==n||l!=a.F._hash(e,t-r))return 0;for(var c=0,m=0,F=Math.min(32767,t);r<=F&&--y!=0&&s!=n;){if(c==0||e[t+c]==e[t+c-r]){var D=a.F._howLong(e,t,r);if(D>c){if(m=r,(c=D)>=x)break;r+2<D&&(D=r+2);for(var S=0,z=0;z<D-2;z++){var M=t-r+z+32768&32767,R=M-d[M]+32768&32767;R>S&&(S=R,s=M)}}}r+=(n=s)-(s=d[n])+32768&32767}return c<<16|m},a.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var l=t,x=Math.min(e.length,t+258);for(t+=3;t<x&&e[t]==e[t-d];)t++;return t-l},a.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},a.saved=0,a.F._writeBlock=function(e,t,d,l,x,y,n,s,r){var c,m,F,D,S,z,M,R,B,v=a.F.U,E=a.F._putsF,f=a.F._putsE;v.lhst[256]++,m=(c=a.F.getTrees())[0],F=c[1],D=c[2],S=c[3],z=c[4],M=c[5],R=c[6],B=c[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),p=l+a.F.contSize(v.fltree,v.lhst)+a.F.contSize(v.fdtree,v.dhst),j=l+a.F.contSize(v.ltree,v.lhst)+a.F.contSize(v.dtree,v.dhst);j+=14+3*M+a.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var w=0;w<286;w++)v.lhst[w]=0;for(w=0;w<30;w++)v.dhst[w]=0;for(w=0;w<19;w++)v.ihst[w]=0;var C=u<p&&u<j?0:p<j?1:2;if(E(s,r,e),E(s,r+1,C),r+=3,C==0){for(;(7&r)!=0;)r++;r=a.F._copyExact(x,y,n,s,r)}else{var b,T;if(C==1&&(b=v.fltree,T=v.fdtree),C==2){a.F.makeCodes(v.ltree,m),a.F.revCodes(v.ltree,m),a.F.makeCodes(v.dtree,F),a.F.revCodes(v.dtree,F),a.F.makeCodes(v.itree,D),a.F.revCodes(v.itree,D),b=v.ltree,T=v.dtree,f(s,r,S-257),f(s,r+=5,z-1),f(s,r+=5,M-4),r+=4;for(var h=0;h<M;h++)f(s,r+3*h,v.itree[1+(v.ordr[h]<<1)]);r+=3*M,r=a.F._codeTiny(R,v.itree,s,r),r=a.F._codeTiny(B,v.itree,s,r)}for(var o=y,_=0;_<d;_+=2){for(var I=t[_],P=I>>>23,V=o+(8388607&I);o<V;)r=a.F._writeLit(x[o++],b,s,r);if(P!=0){var W=t[_+1],Q=W>>16,q=W>>8&255,O=255&W;f(s,r=a.F._writeLit(257+q,b,s,r),P-v.of0[q]),r+=v.exb[q],E(s,r=a.F._writeLit(O,T,s,r),Q-v.df0[O]),r+=v.dxb[O],o+=P}}r=a.F._writeLit(256,b,s,r)}return r},a.F._copyExact=function(e,t,d,l,x){var y=x>>>3;return l[y]=d,l[y+1]=d>>>8,l[y+2]=255-l[y],l[y+3]=255-l[y+1],y+=4,l.set(new Uint8Array(e.buffer,t,d),y),x+(d+4<<3)},a.F.getTrees=function(){for(var e=a.F.U,t=a.F._hufTree(e.lhst,e.ltree,15),d=a.F._hufTree(e.dhst,e.dtree,15),l=[],x=a.F._lenCodes(e.ltree,l),y=[],n=a.F._lenCodes(e.dtree,y),s=0;s<l.length;s+=2)e.ihst[l[s]]++;for(s=0;s<y.length;s+=2)e.ihst[y[s]]++;for(var r=a.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,d,r,x,n,c,l,y]},a.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},a.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},a.F.contSize=function(e,t){for(var d=0,l=0;l<t.length;l++)d+=t[l]*e[1+(l<<1)];return d},a.F._codeTiny=function(e,t,d,l){for(var x=0;x<e.length;x+=2){var y=e[x],n=e[x+1];l=a.F._writeLit(y,t,d,l);var s=y==16?2:y==17?3:7;y>15&&(a.F._putsE(d,l,n,s),l+=s)}return l},a.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var l=0;l<d;l+=2){var x=e[l+1],y=l+3<d?e[l+3]:-1,n=l+5<d?e[l+5]:-1,s=l==0?-1:e[l-1];if(x==0&&y==x&&n==x){for(var r=l+5;r+2<d&&e[r+2]==x;)r+=2;(c=Math.min(r+1-l>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),l+=2*c-2}else if(x==s&&y==x&&n==x){for(r=l+5;r+2<d&&e[r+2]==x;)r+=2;var c=Math.min(r+1-l>>>1,6);t.push(16,c-3),l+=2*c-2}else t.push(x,0)}return d>>>1},a.F._hufTree=function(e,t,d){var l=[],x=e.length,y=t.length,n=0;for(n=0;n<y;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<x;n++)e[n]!=0&&l.push({lit:n,f:e[n]});var s=l.length,r=l.slice(0);if(s==0)return 0;if(s==1){var c=l[0].lit;return r=c==0?1:0,t[1+(c<<1)]=1,t[1+(r<<1)]=1,1}l.sort(function(R,B){return R.f-B.f});var m=l[0],F=l[1],D=0,S=1,z=2;for(l[0]={lit:-1,f:m.f+F.f,l:m,r:F,d:0};S!=s-1;)m=D!=S&&(z==s||l[D].f<l[z].f)?l[D++]:l[z++],F=D!=S&&(z==s||l[D].f<l[z].f)?l[D++]:l[z++],l[S++]={lit:-1,f:m.f+F.f,l:m,r:F};var M=a.F.setDepth(l[S-1],0);for(M>d&&(a.F.restrictDepth(r,d,M),M=d),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return M},a.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(a.F.setDepth(e.l,t+1),a.F.setDepth(e.r,t+1))},a.F.restrictDepth=function(e,t,d){var l=0,x=1<<d-t,y=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),l=0;l<e.length&&e[l].d>t;l++){var n=e[l].d;e[l].d=t,y+=x-(1<<d-n)}for(y>>>=d-t;y>0;)(n=e[l].d)<t?(e[l].d++,y-=1<<t-n-1):l++;for(;l>=0;l--)e[l].d==t&&y<0&&(e[l].d--,y++);y!=0&&console.log("debt left")},a.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},a.F._writeLit=function(e,t,d,l){return a.F._putsF(d,l,t[e<<1]),l+t[1+(e<<1)]},a.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var l=a.F,x=l._bitsF,y=l._bitsE,n=l._decodeTiny,s=l.makeCodes,r=l.codes2map,c=l._get17,m=l.U,F=t==null;F&&(t=new d(e.length>>>2<<3));for(var D,S,z=0,M=0,R=0,B=0,v=0,E=0,f=0,u=0,p=0;z==0;)if(z=x(e,p,1),M=x(e,p+1,2),p+=3,M!=0){if(F&&(t=a.F._check(t,u+(1<<17))),M==1&&(D=m.flmap,S=m.fdmap,E=511,f=31),M==2){R=y(e,p,5)+257,B=y(e,p+5,5)+1,v=y(e,p+10,4)+4,p+=14;for(var j=0;j<38;j+=2)m.itree[j]=0,m.itree[j+1]=0;var w=1;for(j=0;j<v;j++){var C=y(e,p+3*j,3);m.itree[1+(m.ordr[j]<<1)]=C,C>w&&(w=C)}p+=3*v,s(m.itree,w),r(m.itree,w,m.imap),D=m.lmap,S=m.dmap,p=n(m.imap,(1<<w)-1,R+B,e,p,m.ttree);var b=l._copyOut(m.ttree,0,R,m.ltree);E=(1<<b)-1;var T=l._copyOut(m.ttree,R,B,m.dtree);f=(1<<T)-1,s(m.ltree,b),r(m.ltree,b,D),s(m.dtree,T),r(m.dtree,T,S)}for(;;){var h=D[c(e,p)&E];p+=15&h;var o=h>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var _=u+o-254;if(o>264){var I=m.ldef[o-257];_=u+(I>>>3)+y(e,p,7&I),p+=7&I}var P=S[c(e,p)&f];p+=15&P;var V=P>>>4,W=m.ddef[V],Q=(W>>>4)+x(e,p,15&W);for(p+=15&W,F&&(t=a.F._check(t,u+(1<<17)));u<_;)t[u]=t[u++-Q],t[u]=t[u++-Q],t[u]=t[u++-Q],t[u]=t[u++-Q];u=_}}}else{(7&p)!=0&&(p+=8-(7&p));var q=4+(p>>>3),O=e[q-4]|e[q-3]<<8;F&&(t=a.F._check(t,u+O)),t.set(new d(e.buffer,e.byteOffset+q,O),u),p=q+O<<3,u+=O}return t.length==u?t:t.slice(0,u)},a.F._check=function(e,t){var d=e.length;if(t<=d)return e;var l=new Uint8Array(Math.max(d<<1,t));return l.set(e,0),l},a.F._decodeTiny=function(e,t,d,l,x,y){for(var n=a.F._bitsE,s=a.F._get17,r=0;r<d;){var c=e[s(l,x)&t];x+=15&c;var m=c>>>4;if(m<=15)y[r]=m,r++;else{var F=0,D=0;m==16?(D=3+n(l,x,2),x+=2,F=y[r-1]):m==17?(D=3+n(l,x,3),x+=3):m==18&&(D=11+n(l,x,7),x+=7);for(var S=r+D;r<S;)y[r]=F,r++}}return x},a.F._copyOut=function(e,t,d,l){for(var x=0,y=0,n=l.length>>>1;y<d;){var s=e[y+t];l[y<<1]=0,l[1+(y<<1)]=s,s>x&&(x=s),y++}for(;y<n;)l[y<<1]=0,l[1+(y<<1)]=0,y++;return x},a.F.makeCodes=function(e,t){for(var d,l,x,y,n=a.F.U,s=e.length,r=n.bl_count,c=0;c<=t;c++)r[c]=0;for(c=1;c<s;c+=2)r[e[c]]++;var m=n.next_code;for(d=0,r[0]=0,l=1;l<=t;l++)d=d+r[l-1]<<1,m[l]=d;for(x=0;x<s;x+=2)(y=e[x+1])!=0&&(e[x]=m[y],m[y]++)},a.F.codes2map=function(e,t,d){for(var l=e.length,x=a.F.U.rev15,y=0;y<l;y+=2)if(e[y+1]!=0)for(var n=y>>1,s=e[y+1],r=n<<4|s,c=t-s,m=e[y]<<c,F=m+(1<<c);m!=F;)d[x[m]>>>15-t]=r,m++},a.F.revCodes=function(e,t){for(var d=a.F.U.rev15,l=15-t,x=0;x<e.length;x+=2){var y=e[x]<<t-e[x+1];e[x]=d[y]>>>l}},a.F._putsE=function(e,t,d){d<<=7&t;var l=t>>>3;e[l]|=d,e[l+1]|=d>>>8},a.F._putsF=function(e,t,d){d<<=7&t;var l=t>>>3;e[l]|=d,e[l+1]|=d>>>8,e[l+2]|=d>>>16},a.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},a.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},a.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},a.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},a.F.U=(A=Uint16Array,U=Uint32Array,{next_code:new A(16),bl_count:new A(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new A(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new U(32),flmap:new A(512),fltree:[],fdmap:new A(32),fdtree:[],lmap:new A(32768),ltree:[],ttree:[],dmap:new A(32768),dtree:[],imap:new A(512),itree:[],rev15:new A(32768),lhst:new U(286),dhst:new U(30),ihst:new U(19),lits:new U(15e3),strt:new A(65536),prev:new A(32768)}),function(){for(var e=a.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function l(x,y,n){for(;y--!=0;)x.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];l(e.fltree,144,8),l(e.fltree,112,9),l(e.fltree,24,7),l(e.fltree,8,8),a.F.makeCodes(e.fltree,9),a.F.codes2map(e.fltree,9,e.flmap),a.F.revCodes(e.fltree,9),l(e.fdtree,32,5),a.F.makeCodes(e.fdtree,5),a.F.codes2map(e.fdtree,5,e.fdmap),a.F.revCodes(e.fdtree,5),l(e.itree,19,0),l(e.ltree,286,0),l(e.dtree,30,0),l(e.ttree,320,0)}()})();var ds=os({__proto__:null,default:Jt},[Jt]);const $e=function(){var g={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let c="";for(let m=0;m<r;m++)c+=String.fromCharCode(n[s+m]);return c},writeASCII(n,s,r){for(let c=0;c<r.length;c++)n[s+c]=r.charCodeAt(c)},readBytes(n,s,r){const c=[];for(let m=0;m<r;m++)c.push(n[s+m]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let c,m="";for(let F=0;F<r;F++)m+=`%${g.pad(n[s+F].toString(16))}`;try{c=decodeURIComponent(m)}catch{return g.readASCII(n,s,r)}return c}};function A(n,s,r,c){const m=s*r,F=t(c),D=Math.ceil(s*F/8),S=new Uint8Array(4*m),z=new Uint32Array(S.buffer),{ctype:M}=c,{depth:R}=c,B=g.readUshort;if(M==6){const I=m<<2;if(R==8)for(var v=0;v<I;v+=4)S[v]=n[v],S[v+1]=n[v+1],S[v+2]=n[v+2],S[v+3]=n[v+3];if(R==16)for(v=0;v<I;v++)S[v]=n[v<<1]}else if(M==2){const I=c.tabs.tRNS;if(I==null){if(R==8)for(v=0;v<m;v++){var E=3*v;z[v]=255<<24|n[E+2]<<16|n[E+1]<<8|n[E]}if(R==16)for(v=0;v<m;v++)E=6*v,z[v]=255<<24|n[E+4]<<16|n[E+2]<<8|n[E]}else{var f=I[0];const P=I[1],V=I[2];if(R==8)for(v=0;v<m;v++){var u=v<<2;E=3*v,z[v]=255<<24|n[E+2]<<16|n[E+1]<<8|n[E],n[E]==f&&n[E+1]==P&&n[E+2]==V&&(S[u+3]=0)}if(R==16)for(v=0;v<m;v++)u=v<<2,E=6*v,z[v]=255<<24|n[E+4]<<16|n[E+2]<<8|n[E],B(n,E)==f&&B(n,E+2)==P&&B(n,E+4)==V&&(S[u+3]=0)}}else if(M==3){const I=c.tabs.PLTE,P=c.tabs.tRNS,V=P?P.length:0;if(R==1)for(var p=0;p<r;p++){var j=p*D,w=p*s;for(v=0;v<s;v++){u=w+v<<2;var C=3*(b=n[j+(v>>3)]>>7-((7&v)<<0)&1);S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=b<V?P[b]:255}}if(R==2)for(p=0;p<r;p++)for(j=p*D,w=p*s,v=0;v<s;v++)u=w+v<<2,C=3*(b=n[j+(v>>2)]>>6-((3&v)<<1)&3),S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=b<V?P[b]:255;if(R==4)for(p=0;p<r;p++)for(j=p*D,w=p*s,v=0;v<s;v++)u=w+v<<2,C=3*(b=n[j+(v>>1)]>>4-((1&v)<<2)&15),S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=b<V?P[b]:255;if(R==8)for(v=0;v<m;v++){var b;u=v<<2,C=3*(b=n[v]),S[u]=I[C],S[u+1]=I[C+1],S[u+2]=I[C+2],S[u+3]=b<V?P[b]:255}}else if(M==4){if(R==8)for(v=0;v<m;v++){u=v<<2;var T=n[h=v<<1];S[u]=T,S[u+1]=T,S[u+2]=T,S[u+3]=n[h+1]}if(R==16)for(v=0;v<m;v++){var h;u=v<<2,T=n[h=v<<2],S[u]=T,S[u+1]=T,S[u+2]=T,S[u+3]=n[h+2]}}else if(M==0)for(f=c.tabs.tRNS?c.tabs.tRNS:-1,p=0;p<r;p++){const I=p*D,P=p*s;if(R==1)for(var o=0;o<s;o++){var _=(T=255*(n[I+(o>>>3)]>>>7-(7&o)&1))==255*f?0:255;z[P+o]=_<<24|T<<16|T<<8|T}else if(R==2)for(o=0;o<s;o++)_=(T=85*(n[I+(o>>>2)]>>>6-((3&o)<<1)&3))==85*f?0:255,z[P+o]=_<<24|T<<16|T<<8|T;else if(R==4)for(o=0;o<s;o++)_=(T=17*(n[I+(o>>>1)]>>>4-((1&o)<<2)&15))==17*f?0:255,z[P+o]=_<<24|T<<16|T<<8|T;else if(R==8)for(o=0;o<s;o++)_=(T=n[I+o])==f?0:255,z[P+o]=_<<24|T<<16|T<<8|T;else if(R==16)for(o=0;o<s;o++)T=n[I+(o<<1)],_=B(n,I+(o<<1))==f?0:255,z[P+o]=_<<24|T<<16|T<<8|T}return S}function U(n,s,r,c){const m=t(n),F=Math.ceil(r*m/8),D=new Uint8Array((F+1+n.interlace)*c);return s=n.tabs.CgBI?e(s,D):a(s,D),n.interlace==0?s=d(s,n,0,r,c):n.interlace==1&&(s=function(z,M){const R=M.width,B=M.height,v=t(M),E=v>>3,f=Math.ceil(R*v/8),u=new Uint8Array(B*f);let p=0;const j=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],b=[8,8,4,4,2,2,1];let T=0;for(;T<7;){const o=C[T],_=b[T];let I=0,P=0,V=j[T];for(;V<B;)V+=o,P++;let W=w[T];for(;W<R;)W+=_,I++;const Q=Math.ceil(I*v/8);d(z,M,p,I,P);let q=0,O=j[T];for(;O<B;){let X=w[T],re=p+q*Q<<3;for(;X<R;){var h;if(v==1&&(h=(h=z[re>>3])>>7-(7&re)&1,u[O*f+(X>>3)]|=h<<7-((7&X)<<0)),v==2&&(h=(h=z[re>>3])>>6-(7&re)&3,u[O*f+(X>>2)]|=h<<6-((3&X)<<1)),v==4&&(h=(h=z[re>>3])>>4-(7&re)&15,u[O*f+(X>>1)]|=h<<4-((1&X)<<2)),v>=8){const J=O*f+X*E;for(let ne=0;ne<E;ne++)u[J+ne]=z[(re>>3)+ne]}re+=v,X+=_}q++,O+=o}I*P!=0&&(p+=P*(1+Q)),T+=1}return u}(s,n)),s}function a(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const c=Uint8Array;let m,F,D=0,S=0,z=0,M=0,R=0,B=0,v=0,E=0,f=0;if(s[0]==3&&s[1]==0)return r||new c(0);const u=n.H,p=u.b,j=u.e,w=u.R,C=u.n,b=u.A,T=u.Z,h=u.m,o=r==null;for(o&&(r=new c(s.length>>>2<<5));D==0;)if(D=p(s,f,1),S=p(s,f+1,2),f+=3,S!=0){if(o&&(r=n.H.W(r,E+(1<<17))),S==1&&(m=h.J,F=h.h,B=511,v=31),S==2){z=j(s,f,5)+257,M=j(s,f+5,5)+1,R=j(s,f+10,4)+4,f+=14;let I=1;for(var _=0;_<38;_+=2)h.Q[_]=0,h.Q[_+1]=0;for(_=0;_<R;_++){const W=j(s,f+3*_,3);h.Q[1+(h.X[_]<<1)]=W,W>I&&(I=W)}f+=3*R,C(h.Q,I),b(h.Q,I,h.u),m=h.w,F=h.d,f=w(h.u,(1<<I)-1,z+M,s,f,h.v);const P=u.V(h.v,0,z,h.C);B=(1<<P)-1;const V=u.V(h.v,z,M,h.D);v=(1<<V)-1,C(h.C,P),b(h.C,P,m),C(h.D,V),b(h.D,V,F)}for(;;){const I=m[T(s,f)&B];f+=15&I;const P=I>>>4;if(!(P>>>8))r[E++]=P;else{if(P==256)break;{let V=E+P-254;if(P>264){const X=h.q[P-257];V=E+(X>>>3)+j(s,f,7&X),f+=7&X}const W=F[T(s,f)&v];f+=15&W;const Q=W>>>4,q=h.c[Q],O=(q>>>4)+p(s,f,15&q);for(f+=15&q;E<V;)r[E]=r[E++-O],r[E]=r[E++-O],r[E]=r[E++-O],r[E]=r[E++-O];E=V}}}}else{(7&f)!=0&&(f+=8-(7&f));const I=4+(f>>>3),P=s[I-4]|s[I-3]<<8;o&&(r=n.H.W(r,E+P)),r.set(new c(s.buffer,s.byteOffset+I,P),E),f=I+P<<3,E+=P}return r.length==E?r:r.slice(0,E)},n.H.W=function(s,r){const c=s.length;if(r<=c)return s;const m=new Uint8Array(c<<1);return m.set(s,0),m},n.H.R=function(s,r,c,m,F,D){const S=n.H.e,z=n.H.Z;let M=0;for(;M<c;){const R=s[z(m,F)&r];F+=15&R;const B=R>>>4;if(B<=15)D[M]=B,M++;else{let v=0,E=0;B==16?(E=3+S(m,F,2),F+=2,v=D[M-1]):B==17?(E=3+S(m,F,3),F+=3):B==18&&(E=11+S(m,F,7),F+=7);const f=M+E;for(;M<f;)D[M]=v,M++}}return F},n.H.V=function(s,r,c,m){let F=0,D=0;const S=m.length>>>1;for(;D<c;){const z=s[D+r];m[D<<1]=0,m[1+(D<<1)]=z,z>F&&(F=z),D++}for(;D<S;)m[D<<1]=0,m[1+(D<<1)]=0,D++;return F},n.H.n=function(s,r){const c=n.H.m,m=s.length;let F,D,S,z;const M=c.j;for(var R=0;R<=r;R++)M[R]=0;for(R=1;R<m;R+=2)M[s[R]]++;const B=c.K;for(F=0,M[0]=0,D=1;D<=r;D++)F=F+M[D-1]<<1,B[D]=F;for(S=0;S<m;S+=2)z=s[S+1],z!=0&&(s[S]=B[z],B[z]++)},n.H.A=function(s,r,c){const m=s.length,F=n.H.m.r;for(let D=0;D<m;D+=2)if(s[D+1]!=0){const S=D>>1,z=s[D+1],M=S<<4|z,R=r-z;let B=s[D]<<R;const v=B+(1<<R);for(;B!=v;)c[F[B]>>>15-r]=M,B++}},n.H.l=function(s,r){const c=n.H.m.r,m=15-r;for(let F=0;F<s.length;F+=2){const D=s[F]<<r-s[F+1];s[F]=c[D]>>>m}},n.H.M=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8},n.H.I=function(s,r,c){c<<=7&r;const m=r>>>3;s[m]|=c,s[m+1]|=c>>>8,s[m+2]|=c>>>16},n.H.e=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<c)-1},n.H.b=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<c)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let m=r;m=(2863311530&m)>>>1|(1431655765&m)<<1,m=(3435973836&m)>>>2|(858993459&m)<<2,m=(4042322160&m)>>>4|(252645135&m)<<4,m=(4278255360&m)>>>8|(16711935&m)<<8,s.r[r]=(m>>>16|m<<16)>>>17}function c(m,F,D){for(;F--!=0;)m.push(0,D)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];c(s._,144,8),c(s._,112,9),c(s._,24,7),c(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),c(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),c(s.Q,19,0),c(s.C,286,0),c(s.D,30,0),c(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,s,r,c,m){let F=t(s);const D=Math.ceil(c*F/8);let S,z;F=Math.ceil(F/8);let M=n[r],R=0;if(M>1&&(n[r]=[0,0,1][M-2]),M==3)for(R=F;R<D;R++)n[R+1]=n[R+1]+(n[R+1-F]>>>1)&255;for(let B=0;B<m;B++)if(S=r+B*D,z=S+B+1,M=n[z-1],R=0,M==0)for(;R<D;R++)n[S+R]=n[z+R];else if(M==1){for(;R<F;R++)n[S+R]=n[z+R];for(;R<D;R++)n[S+R]=n[z+R]+n[S+R-F]}else if(M==2)for(;R<D;R++)n[S+R]=n[z+R]+n[S+R-D];else if(M==3){for(;R<F;R++)n[S+R]=n[z+R]+(n[S+R-D]>>>1);for(;R<D;R++)n[S+R]=n[z+R]+(n[S+R-D]+n[S+R-F]>>>1)}else{for(;R<F;R++)n[S+R]=n[z+R]+l(0,n[S+R-D],0);for(;R<D;R++)n[S+R]=n[z+R]+l(n[S+R-F],n[S+R-D],n[S+R-F-D])}return n}function l(n,s,r){const c=n+s-r,m=c-n,F=c-s,D=c-r;return m*m<=F*F&&m*m<=D*D?n:F*F<=D*D?s:r}function x(n,s,r){r.width=g.readUint(n,s),s+=4,r.height=g.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function y(n,s,r,c,m,F,D,S,z){const M=Math.min(s,m),R=Math.min(r,F);let B=0,v=0;for(let T=0;T<R;T++)for(let h=0;h<M;h++)if(D>=0&&S>=0?(B=T*s+h<<2,v=(S+T)*m+D+h<<2):(B=(-S+T)*s-D+h<<2,v=T*m+h<<2),z==0)c[v]=n[B],c[v+1]=n[B+1],c[v+2]=n[B+2],c[v+3]=n[B+3];else if(z==1){var E=n[B+3]*.00392156862745098,f=n[B]*E,u=n[B+1]*E,p=n[B+2]*E,j=c[v+3]*(1/255),w=c[v]*j,C=c[v+1]*j,b=c[v+2]*j;const o=1-E,_=E+j*o,I=_==0?0:1/_;c[v+3]=255*_,c[v+0]=(f+w*o)*I,c[v+1]=(u+C*o)*I,c[v+2]=(p+b*o)*I}else if(z==2)E=n[B+3],f=n[B],u=n[B+1],p=n[B+2],j=c[v+3],w=c[v],C=c[v+1],b=c[v+2],E==j&&f==w&&u==C&&p==b?(c[v]=0,c[v+1]=0,c[v+2]=0,c[v+3]=0):(c[v]=f,c[v+1]=u,c[v+2]=p,c[v+3]=E);else if(z==3){if(E=n[B+3],f=n[B],u=n[B+1],p=n[B+2],j=c[v+3],w=c[v],C=c[v+1],b=c[v+2],E==j&&f==w&&u==C&&p==b)continue;if(E<220&&j>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let c=8;const m=g,F=m.readUshort,D=m.readUint,S={tabs:{},frames:[]},z=new Uint8Array(r.length);let M,R=0,B=0;const v=[137,80,78,71,13,10,26,10];for(var E=0;E<8;E++)if(r[E]!=v[E])throw"The input is not a PNG file!";for(;c<r.length;){const T=m.readUint(r,c);c+=4;const h=m.readASCII(r,c,4);if(c+=4,h=="IHDR")x(r,c,S);else if(h=="iCCP"){for(var f=c;r[f]!=0;)f++;m.readASCII(r,c,f-c),r[f+1];const o=r.slice(f+2,c+T);let _=null;try{_=a(o)}catch{_=e(o)}S.tabs[h]=_}else if(h=="CgBI")S.tabs[h]=r.slice(c,c+4);else if(h=="IDAT"){for(E=0;E<T;E++)z[R+E]=r[c+E];R+=T}else if(h=="acTL")S.tabs[h]={num_frames:D(r,c),num_plays:D(r,c+4)},M=new Uint8Array(r.length);else if(h=="fcTL"){B!=0&&((b=S.frames[S.frames.length-1]).data=U(S,M.slice(0,B),b.rect.width,b.rect.height),B=0);const o={x:D(r,c+12),y:D(r,c+16),width:D(r,c+4),height:D(r,c+8)};let _=F(r,c+22);_=F(r,c+20)/(_==0?100:_);const I={rect:o,delay:Math.round(1e3*_),dispose:r[c+24],blend:r[c+25]};S.frames.push(I)}else if(h=="fdAT"){for(E=0;E<T-4;E++)M[B+E]=r[c+E+4];B+=T-4}else if(h=="pHYs")S.tabs[h]=[m.readUint(r,c),m.readUint(r,c+4),r[c+8]];else if(h=="cHRM")for(S.tabs[h]=[],E=0;E<8;E++)S.tabs[h].push(m.readUint(r,c+4*E));else if(h=="tEXt"||h=="zTXt"){S.tabs[h]==null&&(S.tabs[h]={});var u=m.nextZero(r,c),p=m.readASCII(r,c,u-c),j=c+T-u-1;if(h=="tEXt")C=m.readASCII(r,u+1,j);else{var w=a(r.slice(u+2,u+2+j));C=m.readUTF8(w,0,w.length)}S.tabs[h][p]=C}else if(h=="iTXt"){S.tabs[h]==null&&(S.tabs[h]={}),u=0,f=c,u=m.nextZero(r,f),p=m.readASCII(r,f,u-f);const o=r[f=u+1];var C;r[f+1],f+=2,u=m.nextZero(r,f),m.readASCII(r,f,u-f),f=u+1,u=m.nextZero(r,f),m.readUTF8(r,f,u-f),j=T-((f=u+1)-c),o==0?C=m.readUTF8(r,f,j):(w=a(r.slice(f,f+j)),C=m.readUTF8(w,0,w.length)),S.tabs[h][p]=C}else if(h=="PLTE")S.tabs[h]=m.readBytes(r,c,T);else if(h=="hIST"){const o=S.tabs.PLTE.length/3;for(S.tabs[h]=[],E=0;E<o;E++)S.tabs[h].push(F(r,c+2*E))}else if(h=="tRNS")S.ctype==3?S.tabs[h]=m.readBytes(r,c,T):S.ctype==0?S.tabs[h]=F(r,c):S.ctype==2&&(S.tabs[h]=[F(r,c),F(r,c+2),F(r,c+4)]);else if(h=="gAMA")S.tabs[h]=m.readUint(r,c)/1e5;else if(h=="sRGB")S.tabs[h]=r[c];else if(h=="bKGD")S.ctype==0||S.ctype==4?S.tabs[h]=[F(r,c)]:S.ctype==2||S.ctype==6?S.tabs[h]=[F(r,c),F(r,c+2),F(r,c+4)]:S.ctype==3&&(S.tabs[h]=r[c]);else if(h=="IEND")break;c+=T,m.readUint(r,c),c+=4}var b;return B!=0&&((b=S.frames[S.frames.length-1]).data=U(S,M.slice(0,B),b.rect.width,b.rect.height)),S.data=U(S,z,S.width,S.height),delete S.compress,delete S.interlace,delete S.filter,S},toRGBA8:function(s){const r=s.width,c=s.height;if(s.tabs.acTL==null)return[A(s.data,r,c,s).buffer];const m=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const F=r*c*4,D=new Uint8Array(F),S=new Uint8Array(F),z=new Uint8Array(F);for(let R=0;R<s.frames.length;R++){const B=s.frames[R],v=B.rect.x,E=B.rect.y,f=B.rect.width,u=B.rect.height,p=A(B.data,f,u,s);if(R!=0)for(var M=0;M<F;M++)z[M]=D[M];if(B.blend==0?y(p,f,u,D,r,c,v,E,0):B.blend==1&&y(p,f,u,D,r,c,v,E,1),m.push(D.buffer.slice(0)),B.dispose!=0){if(B.dispose==1)y(S,f,u,D,r,c,v,E,0);else if(B.dispose==2)for(M=0;M<F;M++)D[M]=z[M]}}return m},_paeth:l,_copyTile:y,_bin:g}}();(function(){const{_copyTile:g}=$e,{_bin:A}=$e,U=$e._paeth;var a={table:function(){const f=new Uint32Array(256);for(let u=0;u<256;u++){let p=u;for(let j=0;j<8;j++)1&p?p=3988292384^p>>>1:p>>>=1;f[u]=p}return f}(),update(f,u,p,j){for(let w=0;w<j;w++)f=a.table[255&(f^u[p+w])]^f>>>8;return f},crc:(f,u,p)=>4294967295^a.update(4294967295,f,u,p)};function e(f,u,p,j){u[p]+=f[0]*j>>4,u[p+1]+=f[1]*j>>4,u[p+2]+=f[2]*j>>4,u[p+3]+=f[3]*j>>4}function t(f){return Math.max(0,Math.min(255,f))}function d(f,u){const p=f[0]-u[0],j=f[1]-u[1],w=f[2]-u[2],C=f[3]-u[3];return p*p+j*j+w*w+C*C}function l(f,u,p,j,w,C,b){b==null&&(b=1);const T=j.length,h=[];for(var o=0;o<T;o++){const O=j[o];h.push([O>>>0&255,O>>>8&255,O>>>16&255,O>>>24&255])}for(o=0;o<T;o++){let O=4294967295;for(var _=0,I=0;I<T;I++){var P=d(h[o],h[I]);I!=o&&P<O&&(O=P,_=I)}}const V=new Uint32Array(w.buffer),W=new Int16Array(u*p*4),Q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<Q.length;o++)Q[o]=255*((Q[o]+.5)/16-.5);for(let O=0;O<p;O++)for(let X=0;X<u;X++){var q;o=4*(O*u+X),b!=2?q=[t(f[o]+W[o]),t(f[o+1]+W[o+1]),t(f[o+2]+W[o+2]),t(f[o+3]+W[o+3])]:(P=Q[4*(3&O)+(3&X)],q=[t(f[o]+P),t(f[o+1]+P),t(f[o+2]+P),t(f[o+3]+P)]),_=0;let re=16777215;for(I=0;I<T;I++){const le=d(q,h[I]);le<re&&(re=le,_=I)}const J=h[_],ne=[q[0]-J[0],q[1]-J[1],q[2]-J[2],q[3]-J[3]];b==1&&(X!=u-1&&e(ne,W,o+4,7),O!=p-1&&(X!=0&&e(ne,W,o+4*u-4,3),e(ne,W,o+4*u,5),X!=u-1&&e(ne,W,o+4*u+4,1))),C[o>>2]=_,V[o>>2]=j[_]}}function x(f,u,p,j,w){w==null&&(w={});const{crc:C}=a,b=A.writeUint,T=A.writeUshort,h=A.writeASCII;let o=8;const _=f.frames.length>1;let I,P=!1,V=33+(_?20:0);if(w.sRGB!=null&&(V+=13),w.pHYs!=null&&(V+=21),w.iCCP!=null&&(I=pako.deflate(w.iCCP),V+=21+I.length+4),f.ctype==3){for(var W=f.plte.length,Q=0;Q<W;Q++)f.plte[Q]>>>24!=255&&(P=!0);V+=8+3*W+4+(P?8+1*W+4:0)}for(var q=0;q<f.frames.length;q++)_&&(V+=38),V+=(J=f.frames[q]).cimg.length+12,q!=0&&(V+=4);V+=12;const O=new Uint8Array(V),X=[137,80,78,71,13,10,26,10];for(Q=0;Q<8;Q++)O[Q]=X[Q];if(b(O,o,13),o+=4,h(O,o,"IHDR"),o+=4,b(O,o,u),o+=4,b(O,o,p),o+=4,O[o]=f.depth,o++,O[o]=f.ctype,o++,O[o]=0,o++,O[o]=0,o++,O[o]=0,o++,b(O,o,C(O,o-17,17)),o+=4,w.sRGB!=null&&(b(O,o,1),o+=4,h(O,o,"sRGB"),o+=4,O[o]=w.sRGB,o++,b(O,o,C(O,o-5,5)),o+=4),w.iCCP!=null){const ne=13+I.length;b(O,o,ne),o+=4,h(O,o,"iCCP"),o+=4,h(O,o,"ICC profile"),o+=11,o+=2,O.set(I,o),o+=I.length,b(O,o,C(O,o-(ne+4),ne+4)),o+=4}if(w.pHYs!=null&&(b(O,o,9),o+=4,h(O,o,"pHYs"),o+=4,b(O,o,w.pHYs[0]),o+=4,b(O,o,w.pHYs[1]),o+=4,O[o]=w.pHYs[2],o++,b(O,o,C(O,o-13,13)),o+=4),_&&(b(O,o,8),o+=4,h(O,o,"acTL"),o+=4,b(O,o,f.frames.length),o+=4,b(O,o,w.loop!=null?w.loop:0),o+=4,b(O,o,C(O,o-12,12)),o+=4),f.ctype==3){for(b(O,o,3*(W=f.plte.length)),o+=4,h(O,o,"PLTE"),o+=4,Q=0;Q<W;Q++){const ne=3*Q,le=f.plte[Q],ie=255&le,he=le>>>8&255,Pe=le>>>16&255;O[o+ne+0]=ie,O[o+ne+1]=he,O[o+ne+2]=Pe}if(o+=3*W,b(O,o,C(O,o-3*W-4,3*W+4)),o+=4,P){for(b(O,o,W),o+=4,h(O,o,"tRNS"),o+=4,Q=0;Q<W;Q++)O[o+Q]=f.plte[Q]>>>24&255;o+=W,b(O,o,C(O,o-W-4,W+4)),o+=4}}let re=0;for(q=0;q<f.frames.length;q++){var J=f.frames[q];_&&(b(O,o,26),o+=4,h(O,o,"fcTL"),o+=4,b(O,o,re++),o+=4,b(O,o,J.rect.width),o+=4,b(O,o,J.rect.height),o+=4,b(O,o,J.rect.x),o+=4,b(O,o,J.rect.y),o+=4,T(O,o,j[q]),o+=2,T(O,o,1e3),o+=2,O[o]=J.dispose,o++,O[o]=J.blend,o++,b(O,o,C(O,o-30,30)),o+=4);const ne=J.cimg;b(O,o,(W=ne.length)+(q==0?0:4)),o+=4;const le=o;h(O,o,q==0?"IDAT":"fdAT"),o+=4,q!=0&&(b(O,o,re++),o+=4),O.set(ne,o),o+=W,b(O,o,C(O,le,o-le)),o+=4}return b(O,o,0),o+=4,h(O,o,"IEND"),o+=4,b(O,o,C(O,o-4,4)),o+=4,O.buffer}function y(f,u,p){for(let j=0;j<f.frames.length;j++){const w=f.frames[j];w.rect.width;const C=w.rect.height,b=new Uint8Array(C*w.bpl+C);w.cimg=c(w.img,C,w.bpp,w.bpl,b,u,p)}}function n(f,u,p,j,w){const C=w[0],b=w[1],T=w[2],h=w[3],o=w[4],_=w[5];let I=6,P=8,V=255;for(var W=0;W<f.length;W++){const ye=new Uint8Array(f[W]);for(var Q=ye.length,q=0;q<Q;q+=4)V&=ye[q+3]}const O=V!=255,X=function(me,de,be,je,pe,Ue){const ce=[];for(var fe=0;fe<me.length;fe++){const Ae=new Uint8Array(me[fe]),oe=new Uint32Array(Ae.buffer);var Se;let Ee=0,ae=0,Re=de,Ce=be,It=je?1:0;if(fe!=0){const sn=Ue||je||fe==1||ce[fe-2].dispose!=0?1:2;let kt=0,Vt=1e9;for(let dt=0;dt<sn;dt++){var Qe=new Uint8Array(me[fe-1-dt]);const on=new Uint32Array(me[fe-1-dt]);let Ge=de,qe=be,Le=-1,ct=-1;for(let Xe=0;Xe<be;Xe++)for(let Ye=0;Ye<de;Ye++)oe[we=Xe*de+Ye]!=on[we]&&(Ye<Ge&&(Ge=Ye),Ye>Le&&(Le=Ye),Xe<qe&&(qe=Xe),Xe>ct&&(ct=Xe));Le==-1&&(Ge=qe=Le=ct=0),pe&&((1&Ge)==1&&Ge--,(1&qe)==1&&qe--);const Qt=(Le-Ge+1)*(ct-qe+1);Qt<Vt&&(Vt=Qt,kt=dt,Ee=Ge,ae=qe,Re=Le-Ge+1,Ce=ct-qe+1)}Qe=new Uint8Array(me[fe-1-kt]),kt==1&&(ce[fe-1].dispose=2),Se=new Uint8Array(Re*Ce*4),g(Qe,de,be,Se,Re,Ce,-Ee,-ae,0),It=g(Ae,de,be,Se,Re,Ce,-Ee,-ae,3)?1:0,It==1?r(Ae,de,be,Se,{x:Ee,y:ae,width:Re,height:Ce}):g(Ae,de,be,Se,Re,Ce,-Ee,-ae,0)}else Se=Ae.slice(0);ce.push({rect:{x:Ee,y:ae,width:Re,height:Ce},img:Se,blend:It,dispose:0})}if(je)for(fe=0;fe<ce.length;fe++){if((ue=ce[fe]).blend==1)continue;const Ae=ue.rect,oe=ce[fe-1].rect,Ee=Math.min(Ae.x,oe.x),ae=Math.min(Ae.y,oe.y),Re={x:Ee,y:ae,width:Math.max(Ae.x+Ae.width,oe.x+oe.width)-Ee,height:Math.max(Ae.y+Ae.height,oe.y+oe.height)-ae};ce[fe-1].dispose=1,fe-1!=0&&s(me,de,be,ce,fe-1,Re,pe),s(me,de,be,ce,fe,Re,pe)}let nt=0;if(me.length!=1)for(var we=0;we<ce.length;we++){var ue;nt+=(ue=ce[we]).rect.width*ue.rect.height}return ce}(f,u,p,C,b,T),re={},J=[],ne=[];if(j!=0){const ye=[];for(q=0;q<X.length;q++)ye.push(X[q].img.buffer);const me=function(pe){let Ue=0;for(var ce=0;ce<pe.length;ce++)Ue+=pe[ce].byteLength;const fe=new Uint8Array(Ue);let Se=0;for(ce=0;ce<pe.length;ce++){const Qe=new Uint8Array(pe[ce]),nt=Qe.length;for(let we=0;we<nt;we+=4){let ue=Qe[we],Ae=Qe[we+1],oe=Qe[we+2];const Ee=Qe[we+3];Ee==0&&(ue=Ae=oe=0),fe[Se+we]=ue,fe[Se+we+1]=Ae,fe[Se+we+2]=oe,fe[Se+we+3]=Ee}Se+=nt}return fe.buffer}(ye),de=F(me,j);for(q=0;q<de.plte.length;q++)J.push(de.plte[q].est.rgba);let be=0;for(q=0;q<X.length;q++){const je=(ie=X[q]).img.length;var le=new Uint8Array(de.inds.buffer,be>>2,je>>2);ne.push(le);const pe=new Uint8Array(de.abuf,be,je);_&&l(ie.img,ie.rect.width,ie.rect.height,J,pe,le),ie.img.set(pe),be+=je}}else for(W=0;W<X.length;W++){var ie=X[W];const ye=new Uint32Array(ie.img.buffer);var he=ie.rect.width;for(Q=ye.length,le=new Uint8Array(Q),ne.push(le),q=0;q<Q;q++){const me=ye[q];if(q!=0&&me==ye[q-1])le[q]=le[q-1];else if(q>he&&me==ye[q-he])le[q]=le[q-he];else{let de=re[me];if(de==null&&(re[me]=de=J.length,J.push(me),J.length>=300))break;le[q]=de}}}const Pe=J.length;for(Pe<=256&&o==0&&(P=Pe<=2?1:Pe<=4?2:Pe<=16?4:8,P=Math.max(P,h)),W=0;W<X.length;W++){(ie=X[W]).rect.x,ie.rect.y,he=ie.rect.width;const ye=ie.rect.height;let me=ie.img;new Uint32Array(me.buffer);let de=4*he,be=4;if(Pe<=256&&o==0){de=Math.ceil(P*he/8);var De=new Uint8Array(de*ye);const je=ne[W];for(let pe=0;pe<ye;pe++){q=pe*de;const Ue=pe*he;if(P==8)for(var ge=0;ge<he;ge++)De[q+ge]=je[Ue+ge];else if(P==4)for(ge=0;ge<he;ge++)De[q+(ge>>1)]|=je[Ue+ge]<<4-4*(1&ge);else if(P==2)for(ge=0;ge<he;ge++)De[q+(ge>>2)]|=je[Ue+ge]<<6-2*(3&ge);else if(P==1)for(ge=0;ge<he;ge++)De[q+(ge>>3)]|=je[Ue+ge]<<7-1*(7&ge)}me=De,I=3,be=1}else if(O==0&&X.length==1){De=new Uint8Array(he*ye*3);const je=he*ye;for(q=0;q<je;q++){const pe=3*q,Ue=4*q;De[pe]=me[Ue],De[pe+1]=me[Ue+1],De[pe+2]=me[Ue+2]}me=De,I=2,be=3,de=3*he}ie.img=me,ie.bpl=de,ie.bpp=be}return{ctype:I,depth:P,plte:J,frames:X}}function s(f,u,p,j,w,C,b){const T=Uint8Array,h=Uint32Array,o=new T(f[w-1]),_=new h(f[w-1]),I=w+1<f.length?new T(f[w+1]):null,P=new T(f[w]),V=new h(P.buffer);let W=u,Q=p,q=-1,O=-1;for(let re=0;re<C.height;re++)for(let J=0;J<C.width;J++){const ne=C.x+J,le=C.y+re,ie=le*u+ne,he=V[ie];he==0||j[w-1].dispose==0&&_[ie]==he&&(I==null||I[4*ie+3]!=0)||(ne<W&&(W=ne),ne>q&&(q=ne),le<Q&&(Q=le),le>O&&(O=le))}q==-1&&(W=Q=q=O=0),b&&((1&W)==1&&W--,(1&Q)==1&&Q--),C={x:W,y:Q,width:q-W+1,height:O-Q+1};const X=j[w];X.rect=C,X.blend=1,X.img=new Uint8Array(C.width*C.height*4),j[w-1].dispose==0?(g(o,u,p,X.img,C.width,C.height,-C.x,-C.y,0),r(P,u,p,X.img,C)):g(P,u,p,X.img,C.width,C.height,-C.x,-C.y,0)}function r(f,u,p,j,w){g(f,u,p,j,w.width,w.height,-w.x,-w.y,2)}function c(f,u,p,j,w,C,b){const T=[];let h,o=[0,1,2,3,4];C!=-1?o=[C]:(u*j>5e5||p==1)&&(o=[0]),b&&(h={level:0});const _=ds;for(var I=0;I<o.length;I++){for(let W=0;W<u;W++)m(w,f,W,j,p,o[I]);T.push(_.deflate(w,h))}let P,V=1e9;for(I=0;I<T.length;I++)T[I].length<V&&(P=I,V=T[I].length);return T[P]}function m(f,u,p,j,w,C){const b=p*j;let T=b+p;if(f[T]=C,T++,C==0)if(j<500)for(var h=0;h<j;h++)f[T+h]=u[b+h];else f.set(new Uint8Array(u.buffer,b,j),T);else if(C==1){for(h=0;h<w;h++)f[T+h]=u[b+h];for(h=w;h<j;h++)f[T+h]=u[b+h]-u[b+h-w]+256&255}else if(p==0){for(h=0;h<w;h++)f[T+h]=u[b+h];if(C==2)for(h=w;h<j;h++)f[T+h]=u[b+h];if(C==3)for(h=w;h<j;h++)f[T+h]=u[b+h]-(u[b+h-w]>>1)+256&255;if(C==4)for(h=w;h<j;h++)f[T+h]=u[b+h]-U(u[b+h-w],0,0)+256&255}else{if(C==2)for(h=0;h<j;h++)f[T+h]=u[b+h]+256-u[b+h-j]&255;if(C==3){for(h=0;h<w;h++)f[T+h]=u[b+h]+256-(u[b+h-j]>>1)&255;for(h=w;h<j;h++)f[T+h]=u[b+h]+256-(u[b+h-j]+u[b+h-w]>>1)&255}if(C==4){for(h=0;h<w;h++)f[T+h]=u[b+h]+256-U(0,u[b+h-j],0)&255;for(h=w;h<j;h++)f[T+h]=u[b+h]+256-U(u[b+h-w],u[b+h-j],u[b+h-w-j])&255}}}function F(f,u){const p=new Uint8Array(f),j=p.slice(0),w=new Uint32Array(j.buffer),C=D(j,u),b=C[0],T=C[1],h=p.length,o=new Uint8Array(h>>2);let _;if(p.length<2e7)for(var I=0;I<h;I+=4)_=S(b,P=p[I]*(1/255),V=p[I+1]*(1/255),W=p[I+2]*(1/255),Q=p[I+3]*(1/255)),o[I>>2]=_.ind,w[I>>2]=_.est.rgba;else for(I=0;I<h;I+=4){var P=p[I]*.00392156862745098,V=p[I+1]*(1/255),W=p[I+2]*(1/255),Q=p[I+3]*(1/255);for(_=b;_.left;)_=z(_.est,P,V,W,Q)<=0?_.left:_.right;o[I>>2]=_.ind,w[I>>2]=_.est.rgba}return{abuf:j.buffer,inds:o,plte:T}}function D(f,u,p){p==null&&(p=1e-4);const j=new Uint32Array(f.buffer),w={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=B(f,w.i0,w.i1),w.est=v(w.bst);const C=[w];for(;C.length<u;){let T=0,h=0;for(var b=0;b<C.length;b++)C[b].est.L>T&&(T=C[b].est.L,h=b);if(T<p)break;const o=C[h],_=M(f,j,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=_||o.i1<=_){o.est.L=0;continue}const I={i0:o.i0,i1:_,bst:null,est:null,tdst:0,left:null,right:null};I.bst=B(f,I.i0,I.i1),I.est=v(I.bst);const P={i0:_,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:o.bst.N-I.bst.N},b=0;b<16;b++)P.bst.R[b]=o.bst.R[b]-I.bst.R[b];for(b=0;b<4;b++)P.bst.m[b]=o.bst.m[b]-I.bst.m[b];P.est=v(P.bst),o.left=I,o.right=P,C[h]=I,C.push(P)}for(C.sort((T,h)=>h.bst.N-T.bst.N),b=0;b<C.length;b++)C[b].ind=b;return[w,C]}function S(f,u,p,j,w){if(f.left==null)return f.tdst=function(I,P,V,W,Q){const q=P-I[0],O=V-I[1],X=W-I[2],re=Q-I[3];return q*q+O*O+X*X+re*re}(f.est.q,u,p,j,w),f;const C=z(f.est,u,p,j,w);let b=f.left,T=f.right;C>0&&(b=f.right,T=f.left);const h=S(b,u,p,j,w);if(h.tdst<=C*C)return h;const o=S(T,u,p,j,w);return o.tdst<h.tdst?o:h}function z(f,u,p,j,w){const{e:C}=f;return C[0]*u+C[1]*p+C[2]*j+C[3]*w-f.eMq}function M(f,u,p,j,w,C){for(j-=4;p<j;){for(;R(f,p,w)<=C;)p+=4;for(;R(f,j,w)>C;)j-=4;if(p>=j)break;const b=u[p>>2];u[p>>2]=u[j>>2],u[j>>2]=b,p+=4,j-=4}for(;R(f,p,w)>C;)p-=4;return p+4}function R(f,u,p){return f[u]*p[0]+f[u+1]*p[1]+f[u+2]*p[2]+f[u+3]*p[3]}function B(f,u,p){const j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=p-u>>2;for(let b=u;b<p;b+=4){const T=f[b]*.00392156862745098,h=f[b+1]*(1/255),o=f[b+2]*(1/255),_=f[b+3]*(1/255);w[0]+=T,w[1]+=h,w[2]+=o,w[3]+=_,j[0]+=T*T,j[1]+=T*h,j[2]+=T*o,j[3]+=T*_,j[5]+=h*h,j[6]+=h*o,j[7]+=h*_,j[10]+=o*o,j[11]+=o*_,j[15]+=_*_}return j[4]=j[1],j[8]=j[2],j[9]=j[6],j[12]=j[3],j[13]=j[7],j[14]=j[11],{R:j,m:w,N:C}}function v(f){const{R:u}=f,{m:p}=f,{N:j}=f,w=p[0],C=p[1],b=p[2],T=p[3],h=j==0?0:1/j,o=[u[0]-w*w*h,u[1]-w*C*h,u[2]-w*b*h,u[3]-w*T*h,u[4]-C*w*h,u[5]-C*C*h,u[6]-C*b*h,u[7]-C*T*h,u[8]-b*w*h,u[9]-b*C*h,u[10]-b*b*h,u[11]-b*T*h,u[12]-T*w*h,u[13]-T*C*h,u[14]-T*b*h,u[15]-T*T*h],_=o,I=E;let P=[Math.random(),Math.random(),Math.random(),Math.random()],V=0,W=0;if(j!=0)for(let q=0;q<16&&(P=I.multVec(_,P),W=Math.sqrt(I.dot(P,P)),P=I.sml(1/W,P),!(q!=0&&Math.abs(W-V)<1e-9));q++)V=W;const Q=[w*h,C*h,b*h,T*h];return{Cov:o,q:Q,e:P,L:V,eMq255:I.dot(I.sml(255,Q),P),eMq:I.dot(P,Q),rgba:(Math.round(255*Q[3])<<24|Math.round(255*Q[2])<<16|Math.round(255*Q[1])<<8|Math.round(255*Q[0])<<0)>>>0}}var E={multVec:(f,u)=>[f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],f[4]*u[0]+f[5]*u[1]+f[6]*u[2]+f[7]*u[3],f[8]*u[0]+f[9]*u[1]+f[10]*u[2]+f[11]*u[3],f[12]*u[0]+f[13]*u[1]+f[14]*u[2]+f[15]*u[3]],dot:(f,u)=>f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],sml:(f,u)=>[f*u[0],f*u[1],f*u[2],f*u[3]]};$e.encode=function(u,p,j,w,C,b,T){w==null&&(w=0),T==null&&(T=!1);const h=n(u,p,j,w,[!1,!1,!1,0,T,!1]);return y(h,-1),x(h,p,j,C,b)},$e.encodeLL=function(u,p,j,w,C,b,T,h){const o={ctype:0+(w==1?0:2)+(C==0?0:4),depth:b,frames:[]},_=(w+C)*b,I=_*p;for(let P=0;P<u.length;P++)o.frames.push({rect:{x:0,y:0,width:p,height:j},img:new Uint8Array(u[P]),blend:0,dispose:1,bpp:Math.ceil(_/8),bpl:Math.ceil(I/8)});return y(o,0,!0),x(o,p,j,T,h)},$e.encode.compress=n,$e.encode.dither=l,$e.quantize=F,$e.quantize.getKDtree=D,$e.quantize.getNearest=S})();const yr={toArrayBuffer(g,A){const U=g.width,a=g.height,e=U<<2,t=g.getContext("2d").getImageData(0,0,U,a),d=new Uint32Array(t.data.buffer),l=(32*U+31)/32<<2,x=l*a,y=122+x,n=new ArrayBuffer(y),s=new DataView(n),r=1<<20;let c,m,F,D,S=r,z=0,M=0,R=0;function B(f){s.setUint16(M,f,!0),M+=2}function v(f){s.setUint32(M,f,!0),M+=4}function E(f){M+=f}B(19778),v(y),E(4),v(122),v(108),v(U),v(-a>>>0),B(1),B(32),v(3),v(x),v(2835),v(2835),E(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),function f(){for(;z<a&&S>0;){for(D=122+z*l,c=0;c<e;)S--,m=d[R++],F=m>>>24,s.setUint32(D+c,m<<8|F),c+=4;z++}R<d.length?(S=r,setTimeout(f,yr._dly)):A(n)}()},toBlob(g,A){this.toArrayBuffer(g,U=>{A(new Blob([U],{type:"image/bmp"}))})},_dly:9};var Be={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},cs={[Be.CHROME]:16384,[Be.FIREFOX]:11180,[Be.DESKTOP_SAFARI]:16384,[Be.IE]:8192,[Be.IOS]:4096,[Be.ETC]:8192};const On=typeof window<"u",vr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,en=On&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),us=(On||vr)&&(en&&en.getOriginalSymbol(window,"File")||typeof File<"u"&&File),jr=(On||vr)&&(en&&en.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function zn(g,A,U=Date.now()){return new Promise(a=>{const e=g.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let l=d.length;const x=new Uint8Array(l);for(;l--;)x[l]=d.charCodeAt(l);const y=new Blob([x],{type:t});y.name=A,y.lastModified=U,a(y)})}function Sr(g){return new Promise((A,U)=>{const a=new jr;a.onload=()=>A(a.result),a.onerror=e=>U(e),a.readAsDataURL(g)})}function wr(g){return new Promise((A,U)=>{const a=new Image;a.onload=()=>A(a),a.onerror=e=>U(e),a.src=g})}function ut(){if(ut.cachedResult!==void 0)return ut.cachedResult;let g=Be.ETC;const{userAgent:A}=navigator;return/Chrom(e|ium)/i.test(A)?g=Be.CHROME:/iP(ad|od|hone)/i.test(A)&&/WebKit/i.test(A)?g=Be.IOS:/Safari/i.test(A)?g=Be.DESKTOP_SAFARI:/Firefox/i.test(A)?g=Be.FIREFOX:(/MSIE/i.test(A)||document.documentMode)&&(g=Be.IE),ut.cachedResult=g,ut.cachedResult}function Cr(g,A){const U=ut(),a=cs[U];let e=g,t=A,d=e*t;const l=e>t?t/e:e/t;for(;d>a*a;){const x=(a+e)/2,y=(a+t)/2;x<y?(t=y,e=y*l):(t=x*l,e=x),d=e*t}return{width:e,height:t}}function rn(g,A){let U,a;try{if(U=new OffscreenCanvas(g,A),a=U.getContext("2d"),a===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{U=document.createElement("canvas"),a=U.getContext("2d")}return U.width=g,U.height=A,[U,a]}function Fr(g,A){const{width:U,height:a}=Cr(g.width,g.height),[e,t]=rn(U,a);return A&&/jpe?g/.test(A)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(g,0,0,e.width,e.height),e}function Zt(){return Zt.cachedResult!==void 0||(Zt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Zt.cachedResult}function tn(g,A={}){return new Promise(function(U,a){let e,t;var d=function(){try{return t=Fr(e,A.fileType||g.type),U([e,t])}catch(x){return a(x)}},l=function(x){try{var y=function(n){try{throw n}catch(s){return a(s)}};try{let n;return Sr(g).then(function(s){try{return n=s,wr(n).then(function(r){try{return e=r,function(){try{return d()}catch(c){return a(c)}}()}catch(c){return y(c)}},y)}catch(r){return y(r)}},y)}catch(n){y(n)}}catch(n){return a(n)}};try{if(Zt()||[Be.DESKTOP_SAFARI,Be.MOBILE_SAFARI].includes(ut()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(g).then(function(x){try{return e=x,d()}catch{return l()}},l)}catch{l()}})}function nn(g,A,U,a,e=1){return new Promise(function(t,d){let l;if(A==="image/png"){let y,n,s;return y=g.getContext("2d"),{data:n}=y.getImageData(0,0,g.width,g.height),s=$e.encode([n.buffer],g.width,g.height,4096*e),l=new Blob([s],{type:A}),l.name=U,l.lastModified=a,x.call(this)}{let y=function(){return x.call(this)};if(A==="image/bmp")return new Promise(n=>yr.toBlob(g,n)).then((function(n){try{return l=n,l.name=U,l.lastModified=a,y.call(this)}catch(s){return d(s)}}).bind(this),d);{let n=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&g instanceof OffscreenCanvas)return g.convertToBlob({type:A,quality:e}).then((function(s){try{return l=s,l.name=U,l.lastModified=a,n.call(this)}catch(r){return d(r)}}).bind(this),d);{let s;return s=g.toDataURL(A,e),zn(s,U,a).then((function(r){try{return l=r,n.call(this)}catch(c){return d(c)}}).bind(this),d)}}}function x(){return t(l)}})}function Ze(g){g.width=0,g.height=0}function vt(){return new Promise(function(g,A){let U,a,e,t;return vt.cachedResult!==void 0?g(vt.cachedResult):zn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return U=d,tn(U).then(function(l){try{return a=l[1],nn(a,U.type,U.name,U.lastModified).then(function(x){try{return e=x,Ze(a),tn(e).then(function(y){try{return t=y[0],vt.cachedResult=t.width===1&&t.height===2,g(vt.cachedResult)}catch(n){return A(n)}},A)}catch(y){return A(y)}},A)}catch(x){return A(x)}},A)}catch(l){return A(l)}},A)})}function Ar(g){return new Promise((A,U)=>{const a=new jr;a.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return A(-2);const d=t.byteLength;let l=2;for(;l<d;){if(t.getUint16(l+2,!1)<=8)return A(-1);const x=t.getUint16(l,!1);if(l+=2,x==65505){if(t.getUint32(l+=2,!1)!=1165519206)return A(-1);const y=t.getUint16(l+=6,!1)==18761;l+=t.getUint32(l+4,y);const n=t.getUint16(l,y);l+=2;for(let s=0;s<n;s++)if(t.getUint16(l+12*s,y)==274)return A(t.getUint16(l+12*s+8,y))}else{if((65280&x)!=65280)break;l+=t.getUint16(l,!1)}}return A(-1)},a.onerror=e=>U(e),a.readAsArrayBuffer(g)})}function Tr(g,A){const{width:U}=g,{height:a}=g,{maxWidthOrHeight:e}=A;let t,d=g;return isFinite(e)&&(U>e||a>e)&&([d,t]=rn(U,a),U>a?(d.width=e,d.height=a/U*e):(d.width=U/a*e,d.height=e),t.drawImage(g,0,0,d.width,d.height),Ze(g)),d}function Ir(g,A){const{width:U}=g,{height:a}=g,[e,t]=rn(U,a);switch(A>4&&A<9?(e.width=a,e.height=U):(e.width=U,e.height=a),A){case 2:t.transform(-1,0,0,1,U,0);break;case 3:t.transform(-1,0,0,-1,U,a);break;case 4:t.transform(1,0,0,-1,0,a);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,a,0);break;case 7:t.transform(0,-1,-1,0,a,U);break;case 8:t.transform(0,-1,1,0,0,U)}return t.drawImage(g,0,0,U,a),Ze(g),e}function qn(g,A,U=0){return new Promise(function(a,e){let t,d,l,x,y,n,s,r,c,m,F,D,S,z,M,R,B,v,E,f;function u(j=5){if(A.signal&&A.signal.aborted)throw A.signal.reason;t+=j,A.onProgress(Math.min(t,100))}function p(j){if(A.signal&&A.signal.aborted)throw A.signal.reason;t=Math.min(Math.max(j,t),100),A.onProgress(t)}return t=U,d=A.maxIteration||10,l=1024*A.maxSizeMB*1024,u(),tn(g,A).then((function(j){try{return[,x]=j,u(),y=Tr(x,A),u(),new Promise(function(w,C){var b;if(!(b=A.exifOrientation))return Ar(g).then((function(h){try{return b=h,T.call(this)}catch(o){return C(o)}}).bind(this),C);function T(){return w(b)}return T.call(this)}).then((function(w){try{return n=w,u(),vt().then((function(C){try{return s=C?y:Ir(y,n),u(),r=A.initialQuality||1,c=A.fileType||g.type,nn(s,c,g.name,g.lastModified,r).then((function(b){try{{let h=function(){if(d--&&(M>l||M>S)){let _,I;return _=f?.95*E.width:E.width,I=f?.95*E.height:E.height,[B,v]=rn(_,I),v.drawImage(E,0,0,_,I),r*=c==="image/png"?.85:.95,nn(B,c,g.name,g.lastModified,r).then(function(P){try{return R=P,Ze(E),E=B,M=R.size,p(Math.min(99,Math.floor((z-M)/(z-l)*100))),h}catch(V){return e(V)}},e)}return[1]},o=function(){return Ze(E),Ze(B),Ze(y),Ze(s),Ze(x),p(100),a(R)};if(m=b,u(),F=m.size>l,D=m.size>g.size,!F&&!D)return p(100),a(m);var T;return S=g.size,z=m.size,M=z,E=s,f=!A.alwaysKeepResolution&&F,(T=(function(_){for(;_;){if(_.then)return void _.then(T,e);try{if(_.pop){if(_.length)return _.pop()?o.call(this):_;_=h}else _=_.call(this)}catch(I){return e(I)}}}).bind(this))(h)}}catch(h){return e(h)}}).bind(this),e)}catch(b){return e(b)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const fs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let gn;function hs(g,A){return new Promise((U,a)=>{gn||(gn=function(d){const l=[];return l.push(d),URL.createObjectURL(new Blob(l))}(fs));const e=new Worker(gn);e.addEventListener("message",function(d){if(A.signal&&A.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return a(new Error(d.data.error)),void e.terminate();U(d.data.file),e.terminate()}else A.onProgress(d.data.progress)}),e.addEventListener("error",a),A.signal&&A.signal.addEventListener("abort",()=>{a(A.signal.reason),e.terminate()}),e.postMessage({file:g,imageCompressionLibUrl:A.libURL,options:{...A,onProgress:void 0,signal:void 0}})})}function ke(g,A){return new Promise(function(U,a){let e,t,d,l,x,y;if(e={...A},d=0,{onProgress:l}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,x=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{d=c,typeof l=="function"&&l(d)},!(g instanceof Blob||g instanceof us))return a(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(g.type))return a(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!x||typeof Worker!="function"||y)return qn(g,e).then((function(c){try{return t=c,r.call(this)}catch(m){return a(m)}}).bind(this),a);var n=(function(){try{return r.call(this)}catch(c){return a(c)}}).bind(this),s=function(c){try{return qn(g,e).then(function(m){try{return t=m,n()}catch(F){return a(F)}},a)}catch(m){return a(m)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",hs(g,e).then(function(c){try{return t=c,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=g.name,t.lastModified=g.lastModified}catch{}try{e.preserveExif&&g.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===g.type)&&(t=xr(g,t))}catch{}return U(t)}})}ke.getDataUrlFromFile=Sr,ke.getFilefromDataUrl=zn,ke.loadImage=wr,ke.drawImageInCanvas=Fr,ke.drawFileInCanvas=tn,ke.canvasToFile=nn,ke.getExifOrientation=Ar,ke.handleMaxWidthOrHeight=Tr,ke.followExifOrientation=Ir,ke.cleanupCanvasMemory=Ze,ke.isAutoOrientationInBrowser=vt,ke.approximateBelowMaximumCanvasSizeOfBrowser=Cr,ke.copyExifWithoutOrientation=xr,ke.getBrowserName=ut,ke.version="2.0.2";var mn,Ln;function kr(){if(Ln)return mn;Ln=1;function g(A){var U=typeof A;return A!=null&&(U=="object"||U=="function")}return mn=g,mn}var pn,$n;function gs(){if($n)return pn;$n=1;var g=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return pn=g,pn}var bn,Vn;function Dr(){if(Vn)return bn;Vn=1;var g=gs(),A=typeof self=="object"&&self&&self.Object===Object&&self,U=g||A||Function("return this")();return bn=U,bn}var xn,Qn;function ms(){if(Qn)return xn;Qn=1;var g=Dr(),A=function(){return g.Date.now()};return xn=A,xn}var yn,Gn;function ps(){if(Gn)return yn;Gn=1;var g=/\s/;function A(U){for(var a=U.length;a--&&g.test(U.charAt(a)););return a}return yn=A,yn}var vn,Yn;function bs(){if(Yn)return vn;Yn=1;var g=ps(),A=/^\s+/;function U(a){return a&&a.slice(0,g(a)+1).replace(A,"")}return vn=U,vn}var jn,Zn;function Ur(){if(Zn)return jn;Zn=1;var g=Dr(),A=g.Symbol;return jn=A,jn}var Sn,Kn;function xs(){if(Kn)return Sn;Kn=1;var g=Ur(),A=Object.prototype,U=A.hasOwnProperty,a=A.toString,e=g?g.toStringTag:void 0;function t(d){var l=U.call(d,e),x=d[e];try{d[e]=void 0;var y=!0}catch{}var n=a.call(d);return y&&(l?d[e]=x:delete d[e]),n}return Sn=t,Sn}var wn,Xn;function ys(){if(Xn)return wn;Xn=1;var g=Object.prototype,A=g.toString;function U(a){return A.call(a)}return wn=U,wn}var Cn,Jn;function vs(){if(Jn)return Cn;Jn=1;var g=Ur(),A=xs(),U=ys(),a="[object Null]",e="[object Undefined]",t=g?g.toStringTag:void 0;function d(l){return l==null?l===void 0?e:a:t&&t in Object(l)?A(l):U(l)}return Cn=d,Cn}var Fn,er;function js(){if(er)return Fn;er=1;function g(A){return A!=null&&typeof A=="object"}return Fn=g,Fn}var An,tr;function Ss(){if(tr)return An;tr=1;var g=vs(),A=js(),U="[object Symbol]";function a(e){return typeof e=="symbol"||A(e)&&g(e)==U}return An=a,An}var Tn,nr;function ws(){if(nr)return Tn;nr=1;var g=bs(),A=kr(),U=Ss(),a=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,d=/^0o[0-7]+$/i,l=parseInt;function x(y){if(typeof y=="number")return y;if(U(y))return a;if(A(y)){var n=typeof y.valueOf=="function"?y.valueOf():y;y=A(n)?n+"":n}if(typeof y!="string")return y===0?y:+y;y=g(y);var s=t.test(y);return s||d.test(y)?l(y.slice(2),s?2:8):e.test(y)?a:+y}return Tn=x,Tn}var In,rr;function Cs(){if(rr)return In;rr=1;var g=kr(),A=ms(),U=ws(),a="Expected a function",e=Math.max,t=Math.min;function d(l,x,y){var n,s,r,c,m,F,D=0,S=!1,z=!1,M=!0;if(typeof l!="function")throw new TypeError(a);x=U(x)||0,g(y)&&(S=!!y.leading,z="maxWait"in y,r=z?e(U(y.maxWait)||0,x):r,M="trailing"in y?!!y.trailing:M);function R(C){var b=n,T=s;return n=s=void 0,D=C,c=l.apply(T,b),c}function B(C){return D=C,m=setTimeout(f,x),S?R(C):c}function v(C){var b=C-F,T=C-D,h=x-b;return z?t(h,r-T):h}function E(C){var b=C-F,T=C-D;return F===void 0||b>=x||b<0||z&&T>=r}function f(){var C=A();if(E(C))return u(C);m=setTimeout(f,v(C))}function u(C){return m=void 0,M&&n?R(C):(n=s=void 0,c)}function p(){m!==void 0&&clearTimeout(m),D=0,n=F=s=m=void 0}function j(){return m===void 0?c:u(A())}function w(){var C=A(),b=E(C);if(n=arguments,s=this,F=C,b){if(m===void 0)return B(F);if(z)return clearTimeout(m),m=setTimeout(f,x),R(F)}return m===void 0&&(m=setTimeout(f,x)),c}return w.cancel=p,w.flush=j,w}return In=d,In}var Fs=Cs();const As=tt(Fs);var Ut={},sr;function Ts(){if(sr)return Ut;sr=1;var g=ot();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var A=g(lt()),U=at();return Ut.default=(0,A.default)([(0,U.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,U.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),Ut}var Is=Ts();const ks=tt(Is);var Rt={},ir;function Ds(){if(ir)return Rt;ir=1;var g=ot();Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default=void 0;var A=g(lt()),U=at();return Rt.default=(0,A.default)((0,U.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),Rt}var Us=Ds();const Rs=tt(Us);var _t={},or;function _s(){if(or)return _t;or=1;var g=ot();Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var A=g(lt()),U=at();return _t.default=(0,A.default)((0,U.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),_t}var Es=_s();const Ms=tt(Es);var Et={},ar;function Os(){if(ar)return Et;ar=1;var g=ot();Object.defineProperty(Et,"__esModule",{value:!0}),Et.default=void 0;var A=g(lt()),U=at();return Et.default=(0,A.default)([(0,U.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,U.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Et}var zs=Os();const Bs=tt(zs),ft=H.forwardRef(({path:g,initialImages:A=[],onImagesUpdated:U,onDelete:a,isOwnDesign:e},t)=>{const[d,l]=H.useState(A.map(o=>({...o,deleted:!1}))),[x,y]=H.useState(!1),[n,s]=H.useState(0),[r,c]=H.useState(!1),[m,F]=H.useState(null),[D,S]=H.useState(1),[z,M]=H.useState(!1),[R,B]=H.useState(!1),[v,E]=H.useState(""),[f,u]=H.useState("info"),p=H.useRef(null);H.useEffect(()=>{console.log("Initial images received:",A),l(A.map(o=>({...o,deleted:!!o.deleted})))},[A]);const j=async o=>{const _=Array.from(o.target.files||[]);y(!0);const I={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},P=_.map(async(V,W)=>{let Q=V;V.size>1024*1024&&(Q=await ke(V,I),E("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),B(!0));const O=`${new Date().getTime()}-${Q.name}`,X=St(),re=wt(X,`${g}/${O}`),J=gr(re,Q);return new Promise((ne,le)=>{J.on("state_changed",ie=>{const he=ie.bytesTransferred/ie.totalBytes*100;s(he)},ie=>{console.error("Upload failed:",ie),le(ie)},()=>{mr(J.snapshot.ref).then(ie=>{ne({url:ie,path:re.fullPath,title:""})})})})});Promise.all(P).then(V=>{const W=[...d,...V];l(W),U&&U(W),E("Images uploaded successfully."),u("success"),B(!0),y(!1),s(0),p.current&&(p.current.value="")}).catch(V=>{console.error("Error uploading images: ",V),E("Failed to upload images."),u("error"),B(!0),y(!1),s(0)})},w=o=>{l(_=>{const I=_.map((P,V)=>V===o?{...P,deleted:!0}:P);return U(I),I}),E("Image marked for deletion. Update to permanently delete."),u("info"),B(!0)},C=async()=>{const o=d.filter(_=>_.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const _=o.map(I=>{const P=St(),V=wt(P,I.path);return Yt(V)});try{await Promise.all(_),a(o),l(I=>I.filter(P=>!P.deleted)),E("Deleted images have been permanently removed."),u("success")}catch(I){console.error("Error committing deletions:",I),E("Failed to commit deletions."),u("error")}B(!0)}else console.log("No images marked for deletion.")},b=o=>{M(!z),F(o)};H.useEffect(()=>{const o=()=>{const _=!!document.fullscreenElement;M(_)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const T=(o,_)=>{_!=="clickaway"&&B(!1)},h=H.useCallback(As((o,_)=>{setTimeout(()=>{l(I=>{const P=I.map((V,W)=>W===o?{...V,title:_}:V);return U&&U(P),P})},0)},30),[U]);return H.useImperativeHandle(t,()=>({commitDeletions:C})),i.jsxs("div",{children:[e&&i.jsx(Kt,{title:"Upload Images",children:i.jsxs(Ie,{variant:"outlined",component:"label",startIcon:i.jsx(Bs,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:j,disabled:x,ref:p,accept:"image/*"})]})}),x&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),d.filter(o=>!o.deleted).map((o,_)=>i.jsxs("div",{children:[i.jsx("img",{src:o.url,alt:`Uploaded design ${_}`,onClick:()=>{c(!0),F(_)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(He,{onClick:()=>w(_),children:i.jsx(Ht,{})}),i.jsx("textarea",{value:o.title,onChange:I=>h(_,I.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},_)),i.jsx(ht,{open:r,onClose:()=>c(!1),fullScreen:z,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:z?"none":void 0,maxHeight:z?"none":void 0,height:z?"100%":void 0,width:z?"100%":void 0,overflowY:"auto"}},children:m!==null&&i.jsxs(gt,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:d[m].url,alt:`Zoomed Design ${m}`,style:{maxWidth:"100%",maxHeight:z?"100vh":void 0,transform:`scale(${D})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(He,{onClick:()=>S(D*1.2),children:i.jsx(ks,{})}),i.jsx(He,{onClick:()=>S(D/1.2),style:{marginLeft:"10px"},children:i.jsx(Rs,{})}),i.jsx(He,{onClick:()=>b(m),style:{marginLeft:"10px"},children:i.jsx(Ms,{})}),z&&i.jsx(He,{onClick:()=>b(m),style:{position:"absolute",top:20,right:20},children:i.jsx(rs,{})})]})]})}),i.jsx(mt,{open:R,autoHideDuration:6e3,onClose:T,children:i.jsx(pt,{onClose:T,severity:f,sx:{width:"100%"},children:v})})]})});ft.displayName="ImageUpload";const Ke=({onChange:g,initialValue:A})=>{const[U,a]=H.useState(hn.sanitize(A||"")),e=H.useRef(!1),t=H.useRef(null),[d,l]=H.useState("");H.useEffect(()=>{e.current?a(hn.sanitize(A||"")):e.current=!0},[A]);const x=(F,D,S,z)=>{const M=hn.sanitize(F);a(M),g(M)},y=F=>{if(!t.current){console.warn("Editor not initialized");return}const D=t.current.getEditor(),S=D.getSelection();if(S)D.insertText(S.index,F),D.setSelection(S.index+F.length);else{const z=D.getText().length;D.insertText(z,F),D.setSelection(z+F.length)}l(""),D.focus()},n=F=>{y(F.target.value)},s=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],r=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"],c={toolbar:[[{header:[1,2,3,!1]}],["bold","italic"],[{list:"ordered"},{list:"bullet"}],["blockquote",{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},m=["header","bold","italic","list","blockquote","indent","link"];return i.jsxs("div",{children:[i.jsxs(ve,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginBottom:2},children:[i.jsx(hr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(Dn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Xt,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:n,displayEmpty:!0,children:[i.jsx(yt,{value:"",disabled:!0,children:"Math"}),r.map(F=>i.jsx(yt,{value:F,children:F},F))]})}),i.jsx(Dn,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(Xt,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:n,displayEmpty:!0,children:[i.jsx(yt,{value:"",disabled:!0,children:"Greek"}),s.map(F=>i.jsx(yt,{value:F,children:F},F))]})})]}),i.jsx(ss,{ref:t,value:U,onChange:x,modules:c,formats:m,theme:"snow",placeholder:"Start writing...",style:{backgroundColor:"white",borderRadius:"4px",minHeight:"200px"}})]})};var Mt={},lr;function Ns(){if(lr)return Mt;lr=1;var g=ot();Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var A=g(lt()),U=at();return Mt.default=(0,A.default)((0,U.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Mt}var Ps=Ns();const Un=tt(Ps);var Ot={},dr;function Ws(){if(dr)return Ot;dr=1;var g=ot();Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var A=g(lt()),U=at();return Ot.default=(0,A.default)((0,U.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Ot}var Hs=Ws();const qs=tt(Hs);var zt={},cr;function Ls(){if(cr)return zt;cr=1;var g=ot();Object.defineProperty(zt,"__esModule",{value:!0}),zt.default=void 0;var A=g(lt()),U=at();return zt.default=(0,A.default)((0,U.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),zt}var $s=Ls();const Vs=tt($s),Ft=({path:g,initialFiles:A,onFilesChange:U,isOwnDesign:a})=>{const[e,t]=H.useState(A.map(p=>({...p,deleted:!!p.deleted}))),[d,l]=H.useState(!1),[x,y]=H.useState(0),[n,s]=H.useState({}),[r,c]=H.useState(!1),[m,F]=H.useState(""),[D,S]=H.useState("info"),z=H.useRef(null);H.useEffect(()=>{console.log("Initial files received:",A),t(A.map(p=>({...p,deleted:!!p.deleted})))},[A]),H.useEffect(()=>()=>{s({})},[]);const M=p=>{console.log("Updating files with",p),U(p),t(p)},R=async p=>{if(!p.target.files)return;const w=Array.from(p.target.files).filter(b=>b.size>5242880?(F("File size should not exceed 5 MB"),S("error"),c(!0),!1):!0);l(!0);const C=w.map(b=>{const T=new Date().getTime(),h=`${T}-${b.name}`,o=St(),_=wt(o,`${g}/${h}`),I=gr(_,b);return new Promise((P,V)=>{I.on("state_changed",W=>{const Q=W.bytesTransferred/W.totalBytes*100;y(Q)},W=>{console.error("Upload failed:",W),V(W)},()=>{mr(I.snapshot.ref).then(W=>{P({id:T.toString(),url:W,name:b.name,path:_.fullPath})})})})});Promise.all(C).then(b=>{const T=[...e.filter(h=>!h.deleted),...b];M(T),F("Files uploaded successfully."),S("success"),c(!0),l(!1),y(0),z.current&&(z.current.value="")}).catch(b=>{console.error("Error uploading files: ",b),F("Failed to upload files."),S("error"),c(!0),l(!1),y(0)})},B=p=>{const j=e.map(w=>w.id===p?{...w,deleted:!0}:w);M(j),F("File marked for deletion. Update to permanently delete."),S("info"),c(!0)},v=p=>{s(j=>{var w;return{...j,[p]:((w=e.find(C=>C.id===p))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},E=p=>{t(j=>{const w=j.map(C=>C.id===p&&n[p]!==void 0?{...C,name:n[p]}:C);return U(w),w}),s(j=>{const w={...j};return delete w[p],w}),F("File name updated successfully."),S("info"),c(!0)},f=(p,j)=>{s(w=>({...w,[p]:j}))},u=(p,j)=>{j!=="clickaway"&&c(!1)};return i.jsxs("div",{children:[a&&i.jsx(Kt,{title:"Upload Files",children:i.jsxs(Ie,{variant:"outlined",component:"label",startIcon:i.jsx(Vs,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:R,disabled:d,ref:z})]})}),d&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(x),"%"]})}),i.jsx(Zr,{children:e.map(p=>i.jsxs(Kr,{style:{opacity:p.deleted?.5:1},children:[i.jsx(Xr,{children:i.jsx(qs,{})}),typeof n[p.id]=="string"?i.jsx(Wt,{variant:"outlined",size:"small",value:n[p.id],onChange:j=>f(p.id,j.target.value),onKeyPress:j=>j.key==="Enter"&&E(p.id),fullWidth:!0}):i.jsx(Jr,{primary:p.name,secondary:i.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),a&&(typeof n[p.id]=="string"?i.jsx(He,{onClick:()=>E(p.id),edge:"end","aria-label":"save",children:i.jsx(Un,{})}):i.jsxs(i.Fragment,{children:[i.jsx(He,{onClick:()=>v(p.id),edge:"end","aria-label":"edit",children:i.jsx(pr,{})}),i.jsx(He,{onClick:()=>B(p.id),edge:"end","aria-label":"delete",children:i.jsx(Ht,{})})]}))]},p.id))}),i.jsx(mt,{open:r,autoHideDuration:6e3,onClose:u,children:i.jsx(pt,{onClose:u,severity:D,sx:{width:"100%"},children:m})})]})},Qs=({designs:g,setDesigns:A,setIsAdding:U,getDesigns:a,onReturnToDashboard:e})=>{const{userDetails:t}=$t(),d=Rn(),l=_n(d.breakpoints.down("md"));console.log("Add Design loaded");const[x,y]=H.useState(""),[n,s]=H.useState(""),[r,c]=H.useState(""),[m,F]=H.useState([]),[D,S]=H.useState([]),z=H.useMemo(()=>m,[m]),[M,R]=H.useState(!1),[B,v]=H.useState(""),[E,f]=H.useState("info"),[u,p]=H.useState(!1),[j,w]=H.useState("");console.log("Adding New Design from user:",t);const C=H.useRef(null),b=()=>{p(!1)},T=(o,_)=>{_!=="clickaway"&&R(!1)};H.useEffect(()=>{if(t!=null&&t.classes){const o=Object.keys(t.classes)[0];s(o||"")}},[t==null?void 0:t.classes]);const h=async o=>{var V;if(o.preventDefault(),console.log("Files to be saved:",D),!t||!t.uid){console.error("User object is undefined or missing UID."),w("You must be signed in to add a design."),p(!0);return}if(!x){w("All fields are required."),p(!0);return}await((V=C.current)==null?void 0:V.commitDeletions());const _=m.filter(W=>!W.deleted),I=D.filter(W=>!W.deleted).map(W=>({id:W.id,url:W.url,name:W.name,path:W.path})),P={title:r,description:x,course:n,dateCreated:qt(),dateModified:qt(),images:_,files:I,userId:t.uid};try{const W=await Mn(Te(se,"designs"),P),Q={...P,id:W.id};A([...g,Q]),v(`${r} has been Added.`),f("success"),R(!0),c(""),y(""),F([]),S([]),setTimeout(()=>{U(!1),a()},1e3)}catch(W){console.log(W),w("There was an issue adding your design."),p(!0)}};return i.jsxs(ve,{sx:{p:l?ee[3]:ee[6],backgroundColor:K.background.primary,minHeight:"100vh"},children:[i.jsxs(ve,{sx:{mb:ee[6]},children:[i.jsx(Ie,{variant:"text",onClick:e,sx:{fontFamily:$.fontFamily.secondary,fontSize:l?$.fontSize.base:$.fontSize.lg,color:K.primary[600],textTransform:"none",fontWeight:$.fontWeight.medium,mb:ee[4],"&:hover":{backgroundColor:K.primary[100],color:K.primary[700]},transition:jt.transitions.fast},children:"← All Designs"}),i.jsxs(Pt,{sx:{p:l?ee[4]:ee[6],backgroundColor:K.primary[50],borderRadius:Me["2xl"],border:`1px solid ${K.primary[200]}`,boxShadow:We.sm},children:[i.jsx(ze,{variant:"h2",sx:{fontFamily:$.fontFamily.display,fontSize:l?$.fontSize["3xl"]:$.fontSize["5xl"],fontWeight:$.fontWeight.bold,color:K.primary[700],lineHeight:$.lineHeight.tight,mb:ee[2]},children:"Create New Design"}),i.jsx(ze,{variant:"body1",sx:{fontFamily:$.fontFamily.primary,fontSize:l?$.fontSize.base:$.fontSize.lg,color:K.text.secondary,lineHeight:$.lineHeight.relaxed},children:"Design and document your laboratory experiments and research projects"})]})]}),i.jsx(Pt,{sx:{p:l?ee[4]:ee[6],backgroundColor:K.background.elevated,borderRadius:Me["2xl"],border:`1px solid ${K.neutral[200]}`,boxShadow:We.lg},children:i.jsxs("form",{onSubmit:h,children:[i.jsx(ve,{sx:{mb:ee[5]},children:i.jsx(Wt,{id:"title",label:"Design Title",value:r,onChange:o=>c(o.target.value),fullWidth:!0,required:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:Me.lg,fontFamily:$.fontFamily.primary,fontSize:$.fontSize.base},"& .MuiInputLabel-root":{fontFamily:$.fontFamily.secondary,fontSize:$.fontSize.base,fontWeight:$.fontWeight.medium}}})}),i.jsx(ve,{sx:{mb:ee[5]},children:i.jsxs(Dn,{fullWidth:!0,required:!0,children:[i.jsx(hr,{sx:{fontFamily:$.fontFamily.secondary,fontSize:$.fontSize.base,fontWeight:$.fontWeight.medium},children:"Course"}),i.jsx(Xt,{id:"course",value:n,onChange:o=>s(o.target.value),disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,sx:{borderRadius:Me.lg,fontFamily:$.fontFamily.primary,fontSize:$.fontSize.base},children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([o,_])=>i.jsx(yt,{value:o,children:`${_.number} - ${_.title}`},o))})]})}),i.jsxs(ve,{sx:{mb:ee[5]},children:[i.jsx(ze,{variant:"h5",sx:{fontFamily:$.fontFamily.display,fontSize:$.fontSize.xl,fontWeight:$.fontWeight.semibold,color:K.text.primary,mb:ee[3]},children:"Design Description"}),i.jsxs(Pt,{sx:{p:ee[4],backgroundColor:K.background.secondary,borderRadius:Me.lg,border:`1px solid ${K.neutral[200]}`,mb:ee[3]},children:[i.jsx(ze,{variant:"body2",sx:{fontFamily:$.fontFamily.primary,fontSize:$.fontSize.sm,color:K.text.secondary,mb:ee[2],fontWeight:$.fontWeight.medium},children:"Please include the following elements in your description:"}),i.jsxs(ve,{component:"ul",sx:{pl:ee[4],m:0,"& li":{fontFamily:$.fontFamily.primary,fontSize:$.fontSize.sm,color:K.text.secondary,mb:ee[1]}},children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]})]}),i.jsx(Ke,{onChange:y,initialValue:x})]}),i.jsx(es,{sx:{my:ee[5]}}),i.jsxs(ve,{sx:{mb:ee[5]},children:[i.jsx(ze,{variant:"h5",sx:{fontFamily:$.fontFamily.display,fontSize:$.fontSize.xl,fontWeight:$.fontWeight.semibold,color:K.text.primary,mb:ee[3]},children:"Attachments"}),i.jsx(ft,{ref:C,path:"designs/images",initialImages:z,onImagesUpdated:F,onDelete:o=>F(m.filter(_=>!o.includes(_))),isOwnDesign:!0}),i.jsx(ve,{sx:{mt:ee[4]},children:i.jsx(Ft,{path:"designs/files",initialFiles:D,onFilesChange:S,isOwnDesign:!0})})]}),i.jsxs(ve,{sx:{display:"flex",justifyContent:"flex-end",gap:ee[3],mt:ee[6],flexDirection:l?"column":"row"},children:[i.jsx(Ie,{onClick:()=>U(!1),variant:"outlined",sx:{fontFamily:$.fontFamily.display,fontSize:$.fontSize.lg,fontWeight:$.fontWeight.semibold,textTransform:"none",px:ee[6],py:ee[3],borderRadius:Me.xl,borderColor:K.error,color:K.error,"&:hover":{borderColor:K.error,backgroundColor:K.error+"10",boxShadow:We.md},transition:jt.transitions.fast},children:"Cancel"}),i.jsx(Ie,{type:"submit",variant:"contained",sx:{fontFamily:$.fontFamily.display,fontSize:$.fontSize.lg,fontWeight:$.fontWeight.semibold,textTransform:"none",px:ee[6],py:ee[3],backgroundColor:K.primary[500],borderRadius:Me.xl,boxShadow:We.md,"&:hover":{backgroundColor:K.primary[600],boxShadow:We.lg,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0px)"},transition:jt.transitions.fast},children:"Create Design"})]})]})}),i.jsxs(ht,{open:u,onClose:b,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",PaperProps:{sx:{borderRadius:Me["2xl"],boxShadow:We.xl}},children:[i.jsx(At,{id:"alert-dialog-title",sx:{fontFamily:$.fontFamily.display,fontSize:$.fontSize.xl,fontWeight:$.fontWeight.semibold,color:K.text.primary},children:"Notification"}),i.jsx(gt,{children:i.jsx(Lt,{id:"alert-dialog-description",sx:{fontFamily:$.fontFamily.primary,fontSize:$.fontSize.base,color:K.text.secondary},children:j})}),i.jsx(Tt,{children:i.jsx(Ie,{onClick:b,autoFocus:!0,sx:{fontFamily:$.fontFamily.display,fontSize:$.fontSize.base,fontWeight:$.fontWeight.medium,textTransform:"none",borderRadius:Me.lg},children:"Ok"})})]}),i.jsx(mt,{open:M,autoHideDuration:1e3,onClose:T,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:i.jsx(pt,{onClose:T,severity:E,sx:{width:"100%",borderRadius:Me.lg,fontFamily:$.fontFamily.primary,fontSize:$.fontSize.base},children:B})})]})},Gs=({designId:g,setIsAddingBuild:A,refreshBuilds:U})=>{const[a,e]=H.useState(""),[t,d]=H.useState(""),[l,x]=H.useState([]),[y,n]=H.useState([]),{userDetails:s}=$t(),r=j=>{x(j)},c=j=>{n(j)};console.log("AddBuild loaded");const[m,F]=H.useState(!1),[D,S]=H.useState(""),[z,M]=H.useState(!1),[R,B]=H.useState(""),[v,E]=H.useState("info");console.log("Adding New Build by user:",s);const f=()=>{F(!1)},u=(j,w)=>{w!=="clickaway"&&M(!1)},p=async j=>{if(j.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),S("You must be signed in to add a build."),F(!0);return}if(!t){S("Build description is required."),F(!0);return}const w=l.filter(b=>!b.deleted),C=y.filter(b=>!b.deleted).map(b=>({id:b.id,url:b.url,name:b.name,path:b.path}));try{const b=await Mn(Te(se,"builds"),{title:a,description:t,design_ID:g,dateCreated:qt(),userId:s.uid,images:w,files:C});console.log("Build added with ID: ",b.id),console.log("Added New Build by user:",s),B("Your build has been successfully added."),E("success"),M(!0),setTimeout(()=>{e(""),d(""),x([]),n([]),A(!1),U()},1e3)}catch(b){if(console.error("Error adding build: ",b),b instanceof Error){let T=`Failed to add the build. ${b.message}`;b.message==="permission-denied"&&(T="You do not have permission to perform this operation."),B(T),E("error"),M(!0)}else B("Failed to add the build. Please try again later."),E("error"),M(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:p,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:a,onChange:j=>e(j.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(Ke,{onChange:d,initialValue:t})," ",i.jsx(ft,{path:`builds/${g}/images`,initialImages:l,onImagesUpdated:r,onDelete:j=>x(w=>w.filter(C=>!j.includes(C))),isOwnDesign:!0}),i.jsx(Ft,{path:`builds/${g}/files`,initialFiles:y,onFilesChange:c,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>A(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(ht,{open:m,onClose:f,children:[i.jsx(At,{children:"Notification"}),i.jsx(gt,{children:i.jsx(Lt,{children:D})}),i.jsx(Tt,{children:i.jsx(Ie,{onClick:f,children:"OK"})})]}),i.jsx(mt,{open:z,autoHideDuration:6e3,onClose:u,children:i.jsx(pt,{onClose:u,severity:v,sx:{width:"100%"},children:R})})]})},Ys=({designId:g,buildId:A,refreshTests:U,setAddingTestIdForBuild:a})=>{const[e,t]=H.useState(""),[d,l]=H.useState(""),[x,y]=H.useState(""),[n,s]=H.useState(""),[r,c]=H.useState([]),[m,F]=H.useState([]),{userDetails:D}=$t();console.log("AddTest loaded");const[S,z]=H.useState(!1),[M,R]=H.useState(""),[B,v]=H.useState(!1),[E,f]=H.useState(""),[u,p]=H.useState("info"),j=C=>{F(C)},w=async()=>{if(!d){R("Test description cannot be empty!"),z(!0);return}const C=r.filter(T=>!T.deleted),b=m.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{await Mn(Te(se,"tests"),{title:e,build_ID:A,design_ID:g,dateCreated:qt(),description:d,results:x,conclusions:n,userId:D==null?void 0:D.uid,images:C,files:b}),setTimeout(()=>{U(A),t(""),l(""),y(""),s(""),c([]),F([]),a(!1)},1e3),f("Test added successfully"),p("success"),v(!0)}catch(T){console.error("Error adding test: ",T),f("Failed to add the test"),p("error"),v(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(Ke,{onChange:l,initialValue:d}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(Ke,{onChange:y,initialValue:x}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(Ke,{onChange:s,initialValue:n}),i.jsx(ft,{path:`tests/${A}/images`,initialImages:r,onImagesUpdated:C=>{c(C)},onDelete:C=>c(b=>b.filter(T=>!C.includes(T))),isOwnDesign:!0}),i.jsx(Ft,{path:`tests/${A}/files`,initialFiles:m,onFilesChange:j,isOwnDesign:!0}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:w,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>a(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(ht,{open:S,onClose:()=>z(!1),children:[i.jsx(At,{children:"Notification"}),i.jsx(gt,{children:i.jsx(Lt,{children:M})}),i.jsx(Tt,{children:i.jsx(Ie,{onClick:()=>z(!1),children:"OK"})})]}),i.jsx(mt,{open:B,autoHideDuration:6e3,onClose:()=>v(!1),children:i.jsx(pt,{onClose:()=>v(!1),severity:u,sx:{width:"100%"},children:E})})]})};var Bt={},ur;function Zs(){if(ur)return Bt;ur=1;var g=ot();Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=void 0;var A=g(lt()),U=at();return Bt.default=(0,A.default)((0,U.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),Bt}var Ks=Zs();const kn=tt(Ks),Nt=g=>g&&g instanceof En?g.toDate().toLocaleString():"",Xs=({selectedDesign:g,setIsEditing:A,onReturnToDashboard:U})=>{const{userDetails:a,loading:e}=$t(),t=g.id,d=g.userId===(a==null?void 0:a.uid);console.log("Edit page loaded"),console.log("Design ID:",t),console.log("Editing Design by user:",a);const[l,x]=H.useState(""),[y,n]=H.useState(g.description),[s,r]=H.useState(g.course||""),[c,m]=H.useState(Nt(g.dateCreated)),[F,D]=H.useState(Nt(g.dateModified)),[S,z]=H.useState([]),[M,R]=H.useState([]),B=H.useRef(null),[v,E]=H.useState(!1),[f,u]=H.useState([]),[p,j]=H.useState({}),[w,C]=H.useState({}),[b,T]=H.useState({}),h=H.useRef(null),[o,_]=H.useState({}),[I,P]=H.useState({}),[V,W]=H.useState({}),[Q,q]=H.useState(!1),[O,X]=H.useState({}),[re,J]=H.useState({}),[ne,le]=H.useState({}),[ie,he]=H.useState({}),[Pe,De]=H.useState({}),ge=H.useRef(null),[ye,me]=H.useState({}),[de,be]=H.useState({}),[je,pe]=H.useState({}),[Ue,ce]=H.useState(!1),[fe,Se]=H.useState(""),[Qe,nt]=H.useState(()=>()=>{}),[we,ue]=H.useState(!1),[Ae,oe]=H.useState(""),[Ee,ae]=H.useState("info"),[Re,Ce]=H.useState({design:!1,builds:!1,tests:!1}),It=async k=>{if(k.preventDefault(),!y){Se("All fields are required."),ce(!0);return}console.log("About to check image deletions",B.current),console.log(B.current),console.log(S.some(G=>G.deleted)),B.current&&S.some(G=>G.deleted)&&(console.log("Committing deletions"),await B.current.commitDeletions());const L=S.filter(G=>!G.deleted);M.some(G=>G.deleted)&&await Vt();const N=M.filter(G=>!G.deleted),Z={title:l,description:y,course:s,dateModified:qt(),images:L.map(G=>({url:G.url,title:G.title,path:G.path})),files:N.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})),userId:a.uid};try{await st(Fe(se,"designs",t),Z,{merge:!0}),oe("Your design has been updated."),ae("success"),ue(!0);const G=En.now();D(Nt(G))}catch(G){console.error("Error updating design:",G),oe("There was an issue updating your design."),ae("error"),ue(!0)}Ce(G=>({...G,design:!1}))};H.useEffect(()=>{g&&(n(g.description||""),x(g.title||""),r(g.course||""),(async()=>{const L=Fe(se,"designs",t),N=await is(L);if(N.exists()){const Z=N.data();console.log("Fetched images:",Z.images),console.log("Fetched files:",Z.files),z(Z.images||[]),R(Z.files||[]),m(Nt(Z.dateCreated)),D(Nt(Z.dateModified))}})())},[g,t]);const sn=k=>{const L=S.filter(Z=>!k.some(G=>G.path===Z.path));console.log("Remaining images after deletion:",L),z(L);const N=L.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));st(Fe(se,"designs",t),{images:N},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Z=>console.error("Failed to update Firestore:",Z))},kt=k=>{JSON.stringify(S)!==JSON.stringify(k)&&(z(k),console.log("Updated images received:",k))},Vt=async()=>{const k=M.filter(L=>L.deleted);if(console.log("Files to delete:",k),k.length>0){const L=St(),N=k.map(Z=>{const G=wt(L,Z.path);return Yt(G)});try{await Promise.all(N),console.log("Files deleted successfully");const Z=M.filter(G=>!G.deleted);R(Z),await fn(Fe(se,"designs",g.id),{files:Z.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),oe("Deleted files have been permanently removed."),ae("success"),ue(!0)}catch(Z){console.error("Failed to delete files: ",Z),oe("Failed to delete files."),ae("error"),ue(!0)}}},dt=async k=>{var G,te;try{await Rr(k)}catch(Y){console.error("Error deleting files:",Y),oe("Failed to delete build files."),ae("error"),ue(!0)}const L=((G=w[k])==null?void 0:G.filter(Y=>!Y.deleted).map(({url:Y,path:_e,title:Je})=>({url:Y,path:_e,title:Je})))||[],N=((te=b[k])==null?void 0:te.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[],Z={};L.length>0&&(Z.images=L),N.length>0&&(Z.files=N),p[k]!==void 0&&(Z.description=p[k]);try{const Y=Fe(se,"builds",k);await st(Y,Z,{merge:!0}),oe("Your build has been updated."),ae("success"),ue(!0),Le(),Ce(_e=>({..._e,builds:!1}))}catch(Y){console.error("Error updating build:",Y),oe("Failed to update build."),ae("error"),ue(!0)}},on=(k,L)=>{P(N=>({...N,[k]:L}))},Ge=(k,L)=>{j(N=>({...N,[k]:L})),Ce(N=>({...N,builds:!0}))},qe=async k=>{const L=I[k];try{const N=Fe(se,"builds",k);await st(N,{title:L},{merge:!0}),P(Z=>{const G={...Z};return delete G[k],G}),Le()}catch(N){console.error("Failed to save build title:",N)}},Le=async()=>{if(!a){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",a==null?void 0:a.uid),console.log("Selected design ID for query:",g==null?void 0:g.id);let k;a.isAdmin?k=Oe(Te(se,"builds"),xe("design_ID","==",t),Ve("dateCreated")):k=Oe(Te(se,"builds"),xe("design_ID","==",t),xe("userId","==",a.uid),Ve("dateCreated")),console.log("Builds query details:",JSON.stringify(k,null,2));const L=await it(k);console.log("Builds snapshot details:",JSON.stringify(L.docs.map(Z=>Z.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",L.docs.length);const N=L.docs.map(Z=>(console.log("Build doc path: ",Z.ref.path),{id:Z.id,...Z.data()}));u(N),console.log("New builds state after refresh:",N)}catch(k){console.error("Error refreshing builds:",k),k.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",k):console.error("An unexpected error occurred when trying to refresh builds:",k)}},ct=(k,L)=>{const N=Fe(se,"builds",k),Z=w[k].filter(te=>!L.some(Y=>Y.path===te.path));C(te=>({...te,[k]:Z}));const G=Z.map(te=>({url:te.url,title:te.title,path:te.path}));st(N,{images:G},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),oe("Build Image deletions updated."),ae("success")}).catch(te=>{console.error("Failed to update build images in Firestore:",te),oe("Failed to update build image deletions."),ae("error")}),ue(!0)},Qt=async k=>{const L=Oe(Te(se,"tests"),xe("build_ID","==",k),xe("userId","==",a.uid)),N=await it(L);for(const Z of N.docs)await Ct(Fe(se,"tests",Z.id));await Ct(Fe(se,"builds",k)),await Le(),oe("Build and its tests (if any) deleted successfully."),ae("success"),ue(!0)},Xe=k=>{Se("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),nt(()=>()=>Qt(k)),ce(!0)},Ye=(k,L)=>{C(N=>({...N,[k]:L}))},Bn=(k,L)=>{T(N=>({...N,[k]:L}))},Rr=async k=>{var N;const L=((N=b[k])==null?void 0:N.filter(Z=>Z.deleted))||[];if(console.log("Build files to delete:",L),L.length>0){const Z=St(),G=L.map(te=>{const Y=wt(Z,te.path);return Yt(Y)});try{await Promise.all(G),console.log("Build files deleted successfully");const te=b[k].filter(Y=>!Y.deleted);T(Y=>({...Y,[k]:te})),await fn(Fe(se,"builds",k),{files:te.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),console.log("Firestore successfully updated to remove deleted files"),oe("Deleted build files have been permanently removed."),ae("success"),ue(!0)}catch(te){console.error("Failed to delete build files: ",te),oe("Failed to delete build files."),ae("error"),ue(!0)}}},_r=async(k,L)=>{var te;try{await Nr(k)}catch(Y){console.error("Error deleting files:",Y),oe("Failed to delete build files."),ae("error"),ue(!0)}const N={},Z=ie[k].filter(Y=>!Y.deleted).map(({url:Y,path:_e,title:Je})=>({url:Y,path:_e,title:Je})),G=((te=Pe[k])==null?void 0:te.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[];O[k]!==void 0&&(N.description=O[k]),re[k]!==void 0&&(N.results=re[k]),ne[k]!==void 0&&(N.conclusions=ne[k]),N.images=Z,N.files=G;try{const Y=Fe(se,"tests",k);await st(Y,N,{merge:!0}),oe("Your test has been updated."),ae("success"),ue(!0),Gt(L)}catch(Y){console.error(`Error updating test ID: ${k}:`,Y),oe("There was an issue updating your test."),ae("error"),ue(!0)}},Er=(k,L)=>{be(N=>({...N,[k]:L}))},Nn=async(k,L)=>{const N=de[k],Z=Fe(se,"tests",k);await st(Z,{title:N},{merge:!0}),be(G=>{const te={...G};return delete te[k],te}),Gt(L)},Mr=(k,L)=>{console.log(`Updating description for test ID ${k}:`,L),X(N=>({...N,[k]:L})),Ce(N=>({...N,tests:!0}))},Or=(k,L)=>{console.log(`Updating results for test ID ${k}:`,L),J(N=>({...N,[k]:L})),Ce(N=>({...N,tests:!0}))},zr=(k,L)=>{le(N=>({...N,[k]:L})),Ce(N=>({...N,tests:!0}))};H.useEffect(()=>{!e&&a&&(async()=>{if(!a)return;let L;a.isAdmin?L=Oe(Te(se,"builds"),xe("design_ID","==",t),Ve("dateCreated")):L=Oe(Te(se,"builds"),xe("design_ID","==",t),xe("userId","==",a.uid),Ve("dateCreated"));const N=await it(L),Z=[],G={},te={};for(const Y of N.docs){const _e=Y.data(),Je=Y.id;Z.push({id:Je,..._e,images:_e.images||[],files:_e.files||[]}),te[Je]=!0;let an;a.isAdmin?an=Oe(Te(se,"tests"),xe("build_ID","==",Je),Ve("dateCreated")):an=Oe(Te(se,"tests"),xe("build_ID","==",Je),xe("userId","==",a.uid),Ve("dateCreated"));const Lr=await it(an),Hn=[],ln={},dn={};for(const rt of Lr.docs){const et=rt.data();Hn.push({id:rt.id,...et}),ln[rt.id]=et.images||[],dn[rt.id]=et.files||[]}G[Je]=Hn,he(rt=>{const et={...rt};for(const Dt in ln)et[Dt]=ln[Dt];return et}),De(rt=>{const et={...rt};for(const Dt in dn)et[Dt]=dn[Dt];return et})}u(Z),W(G),pe(te)})()},[e,a,g.id,t]);const Gt=async k=>{if(!a){console.log("User details not loaded yet");return}try{let L;a.isAdmin?L=Oe(Te(se,"tests"),xe("build_ID","==",k),Ve("dateCreated")):L=Oe(Te(se,"tests"),xe("build_ID","==",k),xe("userId","==",a.uid),Ve("dateCreated"));const Z=(await it(L)).docs.map(Y=>{const _e=Y.data();return{id:Y.id,..._e,images:_e.images||[],files:_e.files||[]}});W(Y=>({...Y,[k]:Z}));const G={},te={};Z.forEach(Y=>{G[Y.id]=Y.images,te[Y.id]=Y.files}),he(G),De(te)}catch(L){console.error("Error fetching tests:",L)}},Br=(k,L)=>{const N=Fe(se,"tests",k),Z=ie[k].filter(te=>!L.includes(te));he(te=>({...te,[k]:Z}));const G=Z.map(({url:te,path:Y,title:_e})=>({url:te,path:Y,title:_e}));st(N,{images:G},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),oe("Test Image deletions updated."),ae("success")}).catch(te=>{console.error("Failed to update test images in Firestore:",te),oe("Failed to update test image deletions."),ae("error")}),ue(!0)},Pn=(k,L)=>{he(N=>({...N,[k]:L}))},Wn=(k,L)=>{De(N=>({...N,[k]:L}))},Nr=async k=>{var N;const L=((N=Pe[k])==null?void 0:N.filter(Z=>Z.deleted))||[];if(L.length>0){const Z=St(),G=L.map(te=>{const Y=wt(Z,te.path);return Yt(Y)});try{await Promise.all(G);const te=Pe[k].filter(Y=>!Y.deleted);De(Y=>({...Y,[k]:te})),await fn(Fe(se,"tests",k),{files:te.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),oe("Deleted test files have been permanently removed."),ae("success"),ue(!0)}catch(te){console.error("Failed to delete test files: ",te),oe("Failed to delete test files."),ae("error"),ue(!0)}}},Pr=async(k,L)=>{await Ct(Fe(se,"tests",k)),await Gt(L),oe("Test deleted successfully."),ae("success"),ue(!0)},Wr=(k,L)=>{Se("Are you sure you want to delete this test? This action cannot be undone."),nt(()=>()=>Pr(k,L)),ce(!0)},Hr=k=>{pe(L=>({...L,[k]:!L[k]}))},qr=()=>{const k=Object.entries(Re).filter(([N,Z])=>Z).map(([N])=>N).join(", ");if(!k.length){U();return}const L=`You have unsaved changes in the following sections: ${k}. Are you sure you want to leave?`;Se(L),nt(()=>()=>{Ce({design:!1,builds:!1,tests:!1}),U()}),ce(!0)};return H.useEffect(()=>{const k=L=>{Object.values(Re).some(Z=>Z)&&(L.preventDefault(),L.returnValue="")};return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[Re]),i.jsxs("div",{className:"small-container",children:[i.jsx(Ie,{variant:"text",onClick:()=>{Object.values(Re).some(L=>L)?qr():U()},className:"profile-button",children:"← All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:It,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:l,onChange:k=>{x(k.target.value),Ce(L=>({...L,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),i.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:c||"",readOnly:!0,style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),i.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:F||"",readOnly:!0,style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),i.jsx(Xt,{id:"course",value:s,onChange:k=>{r(k.target.value),Ce(L=>({...L,design:!0}))},fullWidth:!0,children:(a!=null&&a.classes?Object.entries(a.classes):[]).map(([k,L])=>i.jsx(yt,{value:k,children:`${L.number} - ${L.title}`},k))}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(Ke,{initialValue:y,onChange:k=>{n(k),Ce(L=>({...L,design:!0}))}}),i.jsx(ft,{ref:B,path:`designs/${g.id}/images`,initialImages:S,onImagesUpdated:kt,onDelete:sn,isOwnDesign:d}),i.jsx(Ft,{path:`designs/${g.id}/files`,initialFiles:M,onFilesChange:R,isOwnDesign:d}),d&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>A(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),d&&i.jsxs("button",{className:"button muted-button",onClick:()=>{E(!0),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),f.map((k,L)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:I[k.id]!==void 0?i.jsx(Wt,{variant:"outlined",size:"small",fullWidth:!0,value:I[k.id],onChange:N=>on(k.id,N.target.value),onBlur:()=>qe(k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(He,{onClick:()=>qe(k.id),size:"small",children:i.jsx(Un,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>P(N=>({...N,[k.id]:k.title||`Build ${L+1}`})),style:{cursor:"pointer"},children:k.title||`Build ${L+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>_(N=>({...N,[k.id]:!N[k.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:o[k.id]?i.jsx(kn,{}):i.jsx(un,{})}),d&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Xe(k.id),children:i.jsx(Ht,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{q(k.id),setTimeout(()=>{ge.current&&ge.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),o[k.id]&&i.jsxs(i.Fragment,{children:[i.jsx(Ke,{initialValue:p[k.id]||k.description,onChange:N=>{Ge(k.id,N)}}),i.jsx(ft,{path:`builds/${k.id}/images`,initialImages:k.images,onImagesUpdated:N=>Ye(k.id,N),onDelete:N=>ct(k.id,N),isOwnDesign:d}),i.jsx(Ft,{path:`builds/${k.id}/files`,initialFiles:k.files,onFilesChange:N=>Bn(k.id,N),isOwnDesign:d}),d&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>dt(k.id),children:"Update"})}),i.jsx("div",{children:V[k.id]&&V[k.id].length>0&&i.jsx("button",{onClick:()=>Hr(k.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:je[k.id]?i.jsxs(i.Fragment,{children:[i.jsx(un,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(kn,{style:{marginRight:"8px"}}),"Tests"]})})}),!je[k.id]&&V[k.id]&&V[k.id].map((N,Z)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:de[N.id]!==void 0?i.jsx(Wt,{variant:"outlined",size:"small",fullWidth:!0,value:de[N.id],onChange:G=>Er(N.id,G.target.value),onBlur:()=>Nn(N.id,k.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(He,{onClick:()=>Nn(N.id,k.id),size:"small",children:i.jsx(Un,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>be(G=>({...G,[N.id]:N.title||`Test ${Z+1}`})),style:{cursor:"pointer"},children:N.title||`Test ${Z+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>me(G=>({...G,[N.id]:!G[N.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:ye[N.id]?i.jsx(kn,{}):i.jsx(un,{})}),d&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Wr(N.id,k.id),children:i.jsx(Ht,{})})]})]}),ye[N.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(Ke,{initialValue:O[N.id]||N.description,onChange:G=>{Mr(N.id,G)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(Ke,{initialValue:re[N.id]||N.results,onChange:G=>{Or(N.id,G)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(Ke,{initialValue:ne[N.id]||N.conclusions,onChange:G=>{zr(N.id,G)}})]}),i.jsxs("div",{children:[i.jsx(ft,{path:`tests/${N.id}/images`,initialImages:ie[N.id]||[],onImagesUpdated:G=>Pn(N.id,G),onDelete:G=>Br(N.id,G),isOwnDesign:d}),i.jsx(Ft,{path:`tests/${N.id}/files`,initialFiles:Pe[N.id]||[],onFilesChange:G=>Wn(N.id,G),isOwnDesign:d})]}),d&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>_r(N.id,k.id),children:"Update"})})]})]},N.id))]}),Q===k.id&&i.jsxs("div",{className:"new-test-record",ref:ge,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Ys,{designId:g.id,buildId:k.id,refreshTests:()=>Gt(k.id),setAddingTestIdForBuild:q,onImagesUpdated:N=>Pn(k.id,N),onFilesChange:N=>Wn(k.id,N)})]})]},k.id)),i.jsx("div",{children:v&&i.jsxs("div",{className:"new-build-record",ref:h,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Gs,{designId:g.id,setIsAddingBuild:E,refreshBuilds:Le,onImagesUpdated:k=>Ye("temp-build-id",k),onFilesChange:k=>Bn("temp-build-id",k)})]})})]}),i.jsxs(ht,{open:Ue,onClose:()=>ce(!1),children:[i.jsx(At,{children:"Confirmation Required"}),i.jsx(gt,{children:i.jsx(Lt,{children:fe})}),i.jsxs(Tt,{children:[i.jsx(Ie,{onClick:()=>ce(!1),children:"Cancel"}),i.jsx(Ie,{onClick:()=>{Qe(),ce(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(mt,{open:we,autoHideDuration:6e3,onClose:()=>ue(!1),children:i.jsx(pt,{onClose:()=>ue(!1),severity:Ee,sx:{width:"100%"},children:Ae})})]})},xt=(g,A,U)=>g[A]??U,Js=()=>{const{userDetails:g,loading:A}=$t(),U=Rn(),a=_n(U.breakpoints.down("md"));console.log("Dashboard loaded");const[e,t]=H.useState([]),[d,l]=H.useState([]),[x,y]=H.useState([]),[n,s]=H.useState(null),[r,c]=H.useState(!1),[m,F]=H.useState(!1),[D,S]=H.useState(!1),[z,M]=H.useState(""),[R,B]=H.useState(""),[v,E]=H.useState(!1),[f,u]=H.useState(null),[p,j]=H.useState(!1),[w,C]=H.useState(""),[b,T]=H.useState("info"),h=()=>{F(!1),c(!1),s(null),o()},o=H.useCallback(async()=>{if(!g)return;let W;const Q=[],q=[],O=[];if(g.isSuperAdmin)W=Oe(Te(se,"designs"),Ve("dateCreated","desc"));else if(g.isAdmin){const re=g.classes?Object.keys(g.classes):[];if(re.length>0)W=Oe(Te(se,"designs"),xe("course","in",re),Ve("dateCreated","desc"));else{l([]),y([]);return}}else W=Oe(Te(se,"designs"),xe("userId","==",g.uid),Ve("dateCreated","desc"));(await it(W)).forEach(re=>{const J=re.data(),ne={id:re.id,title:xt(J,"title",""),description:xt(J,"description",""),course:xt(J,"course",""),dateCreated:J.dateCreated,dateModified:J.dateModified,userId:xt(J,"userId",""),images:xt(J,"images",[]),files:xt(J,"files",[])};g.isSuperAdmin?J.userId===g.uid?Q.push(ne):J.userId!==g.uid&&J.course&&J.isAdmin?q.push(ne):J.userId!==g.uid&&!J.isAdmin&&O.push(ne):g.isAdmin?J.userId===g.uid?q.push(ne):O.push(ne):J.userId===g.uid&&O.push(ne)}),t(Q),l(q),y(O)},[g]);H.useEffect(()=>{!A&&g&&o()},[g,A,o]);const _=W=>{const Q=[...e,...d,...x].find(q=>q.id===W);s(Q||null),F(!0)},I=W=>{u(W),M("Are you sure you want to delete this design? This action cannot be undone."),S(!0)},P=async()=>{if(f)if(R!==(g==null?void 0:g.uid))C("User ID confirmation failed. Enter the correct User ID."),T("error"),j(!0);else try{const W=Oe(Te(se,"builds"),xe("design_ID","==",f),xe("userId","==",g.uid)),Q=await it(W);for(const q of Q.docs){const O=q.id,X=Oe(Te(se,"tests"),xe("build_ID","==",O),xe("userId","==",g.uid)),re=await it(X);for(const J of re.docs)await Ct(Fe(se,"tests",J.id));await Ct(Fe(se,"builds",O))}await Ct(Fe(se,"designs",f)),t(q=>q.filter(O=>O.id!==f)),l(q=>q.filter(O=>O.id!==f)),y(q=>q.filter(O=>O.id!==f)),C("Your design and its associated builds and tests have been deleted."),T("success"),j(!0)}catch(W){console.error("Error deleting design, builds, and tests: ",W),C("There was an issue deleting your design and its associated builds and tests."),T("error"),j(!0)}finally{B(""),E(!1),u(null)}},V=(W,Q,q)=>i.jsx(ve,{sx:{mb:ee[4],mt:ee[6]},children:i.jsx(Pt,{sx:{p:a?ee[3]:ee[4],backgroundColor:K.background.secondary,borderRadius:Me.lg,border:`1px solid ${K.neutral[200]}`,boxShadow:We.sm},children:i.jsxs(ve,{sx:{display:"flex",alignItems:"center",gap:ee[3],flexDirection:a?"column":"row",textAlign:a?"center":"left"},children:[i.jsx(ze,{variant:"h4",sx:{fontFamily:$.fontFamily.display,fontSize:a?$.fontSize.xl:$.fontSize["2xl"],fontWeight:$.fontWeight.bold,color:K.text.primary},children:W}),i.jsx(fr,{label:`${Q} ${Q===1?"Design":"Designs"}`,size:"small",sx:{backgroundColor:q,color:K.text.inverse,fontFamily:$.fontFamily.secondary,fontWeight:$.fontWeight.semibold,fontSize:$.fontSize.sm}})]})})});return i.jsxs(ve,{sx:{p:a?ee[3]:ee[6],backgroundColor:K.background.primary,minHeight:"100vh"},children:[!r&&!m&&i.jsxs(i.Fragment,{children:[i.jsx(br,{setIsAdding:c}),(g==null?void 0:g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[V("My Designs",e.length,K.primary[500]),i.jsx(bt,{designs:e,handleEdit:_,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),V("Educator Designs",d.length,K.secondary[500]),i.jsx(bt,{designs:d,handleEdit:_,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),V("Student Designs",x.length,K.info),i.jsx(bt,{designs:x,handleEdit:_,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),(g==null?void 0:g.isAdmin)&&!g.isSuperAdmin&&i.jsxs(i.Fragment,{children:[V("My Educator Designs",d.length,K.secondary[500]),i.jsx(bt,{designs:d,handleEdit:_,handleDelete:I,isAdmin:!0,userDetails:g,showUserIdColumn:!0}),V("Student Designs",x.length,K.info),i.jsx(bt,{designs:x,handleEdit:_,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!0})]}),!(g!=null&&g.isAdmin)&&!(g!=null&&g.isSuperAdmin)&&i.jsxs(i.Fragment,{children:[V("My Designs",x.length,K.primary[500]),i.jsx(bt,{designs:x,handleEdit:_,handleDelete:I,isAdmin:!1,userDetails:g,showUserIdColumn:!1})]})]}),r&&i.jsx(Qs,{designs:e.concat(d),setDesigns:l,setIsAdding:c,getDesigns:o,onReturnToDashboard:h}),m&&i.jsx(Xs,{designs:e.concat(d),selectedDesign:n,setDesigns:l,setIsEditing:F,getDesigns:o,onReturnToDashboard:h}),i.jsxs(ht,{open:D,onClose:()=>S(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(At,{children:"Confirm Deletion"}),i.jsx(gt,{children:i.jsx(Lt,{children:z})}),i.jsxs(Tt,{children:[i.jsx(Ie,{onClick:()=>S(!1),children:"No, cancel"}),i.jsx(Ie,{onClick:()=>{E(!0),S(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(ht,{open:v,onClose:()=>E(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(At,{children:"Confirm Your User ID"}),i.jsx(gt,{children:i.jsx(Wt,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:R,onChange:W=>B(W.target.value)})}),i.jsxs(Tt,{children:[i.jsx(Ie,{onClick:()=>E(!1),children:"No, cancel"}),i.jsx(Ie,{onClick:P,color:"primary",children:"Confirm"})]})]}),i.jsx(mt,{open:p,autoHideDuration:6e3,onClose:()=>j(!1),children:i.jsx(pt,{onClose:()=>j(!1),severity:b,sx:{width:"100%"},children:w})})]})},oi=ts.memo(Js);export{oi as default};
